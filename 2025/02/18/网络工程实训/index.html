
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>网络工程实训 | 雲流のLowest World</title>
    <meta name="author" content="C1oudfL0w0" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
    <!-- cdn挂掉的时候要可以引用本地 -->
<!-- <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script> -->
<script src="/blog/js/vue.global.prod.min.js"></script>


<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />


<link rel="stylesheet" href="/blog/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<link rel="stylesheet" href="/blog/css/search.css" />
<script> const mixins = {}; </script>

<!-- 引入jQuery-->
<!-- <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> -->
<script src="/blog/js/jquery.min.js"></script>

<!--改成了prismjs高亮-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- 引入不蒜子-->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<!-- 引入clipboard -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="雲流のLowest World" type="application/atom+xml">
</head>

<body>
    <!--flag{never_g0nna g1ve_you up}-->

    <!-- 页面点击特效 -->
    <script type="text/javascript" src="/blog/js/love-click.js"></script>

    <!-- 浏览器标题 -->
    <script async type="text/javascript" src="/blog/js/FunnyTitle.js"></script>

    <!-- 动态背景 -->
    

    <!--文章目录-->
    
    <div id="toc" class="toc-article">
    <h3><i class="fas fa-stream"></i>  目录</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">2.</span> <span class="toc-text">案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">2.1.</span> <span class="toc-text">需求</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E6%9E%84%E5%BB%BA%E4%B8%8EIP%E5%9C%B0%E5%9D%80%E8%A7%84%E5%88%92"><span class="toc-number">3.</span> <span class="toc-text">拓扑构建与IP地址规划</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">3.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IP%E5%9C%B0%E5%9D%80"><span class="toc-number">3.1.1.</span> <span class="toc-text">IP地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86"><span class="toc-number">3.1.2.</span> <span class="toc-text">子网划分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E6%8B%93%E6%89%91%E5%9B%BE"><span class="toc-number">3.2.</span> <span class="toc-text">构建拓扑图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IP%E5%88%92%E5%88%86"><span class="toc-number">3.3.</span> <span class="toc-text">IP划分</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">4.</span> <span class="toc-text">基本配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E5%91%BD%E5%90%8D%E4%BF%AE%E6%94%B9"><span class="toc-number">4.1.</span> <span class="toc-text">主机命名修改</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%89%B9%E6%9D%83%E5%AF%86%E7%A0%81"><span class="toc-number">4.2.</span> <span class="toc-text">配置特权密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Console%E7%AB%AF%E5%8F%A3%E5%AF%86%E7%A0%81"><span class="toc-number">4.3.</span> <span class="toc-text">Console端口密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEVTY%E7%9A%84%E5%AF%86%E7%A0%81"><span class="toc-number">4.4.</span> <span class="toc-text">配置VTY的密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">4.5.</span> <span class="toc-text">保存配置文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">5.</span> <span class="toc-text">路由器配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80-1"><span class="toc-number">5.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E7%A1%AC%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">5.1.1.</span> <span class="toc-text">路由器硬件结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E5%9C%B0%E5%9D%80%E8%A7%84%E5%88%92"><span class="toc-number">5.2.</span> <span class="toc-text">路由器地址规划</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#loopback%E5%9C%B0%E5%9D%80%E8%A7%84%E5%88%92"><span class="toc-number">5.3.</span> <span class="toc-text">loopback地址规划</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%A4%E6%8D%A2%E6%9C%BAVLAN%E9%85%8D%E7%BD%AE"><span class="toc-number">6.</span> <span class="toc-text">交换机VLAN配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80-2"><span class="toc-number">6.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#VLAN"><span class="toc-number">6.1.1.</span> <span class="toc-text">VLAN</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E5%B1%82%E2%80%94%E2%80%94%E4%BA%92%E8%81%94%E5%9C%B0%E5%9D%80%E8%A7%84%E5%88%92"><span class="toc-number">6.2.</span> <span class="toc-text">三层——互联地址规划</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E4%B8%89%E5%B1%82%E2%80%94%E2%80%94%E9%85%8D%E7%BD%AEtrunk%E9%93%BE%E6%8E%A5"><span class="toc-number">6.3.</span> <span class="toc-text">二三层——配置trunk链接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E4%B8%89%E5%B1%82%E2%80%94%E2%80%94%E9%85%8D%E7%BD%AEVTP%E5%9F%9F"><span class="toc-number">6.4.</span> <span class="toc-text">二三层——配置VTP域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E4%B8%89%E5%B1%82%E2%80%94%E2%80%94%E4%B8%9A%E5%8A%A1%E5%9C%B0%E5%9D%80%E8%A7%84%E5%88%92"><span class="toc-number">6.5.</span> <span class="toc-text">二三层——业务地址规划</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E5%B1%82%E2%80%94%E2%80%94%E7%AB%AF%E5%8F%A3%E5%88%92%E5%88%86%E5%88%B0VLAN"><span class="toc-number">6.6.</span> <span class="toc-text">二层——端口划分到VLAN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%88%E7%AB%AF%E6%9C%BA%E9%85%8D%E7%BD%AE"><span class="toc-number">6.7.</span> <span class="toc-text">终端机配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE"><span class="toc-number">7.</span> <span class="toc-text">网络路由配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80-3"><span class="toc-number">7.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="toc-number">7.1.1.</span> <span class="toc-text">路由表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%88%86%E7%B1%BB"><span class="toc-number">7.1.2.</span> <span class="toc-text">路由分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP%E8%B7%AF%E7%94%B1%E8%BF%87%E7%A8%8B"><span class="toc-number">7.1.3.</span> <span class="toc-text">IP路由过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AEOSPF"><span class="toc-number">7.1.4.</span> <span class="toc-text">动态路由协议OSPF</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91-OSPF"><span class="toc-number">7.2.</span> <span class="toc-text">内网 OSPF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1"><span class="toc-number">7.3.</span> <span class="toc-text">网络默认路由</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2NAT"><span class="toc-number">8.</span> <span class="toc-text">网络地址转换NAT</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80-4"><span class="toc-number">8.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2%E5%8E%9F%E7%90%86"><span class="toc-number">8.1.1.</span> <span class="toc-text">网络地址转换原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">8.2.</span> <span class="toc-text">配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E5%88%97%E8%A1%A8ACL"><span class="toc-number">9.</span> <span class="toc-text">配置访问控制列表ACL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80-5"><span class="toc-number">9.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ACL"><span class="toc-number">9.1.1.</span> <span class="toc-text">ACL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E5%85%AC%E5%8F%B8%E9%83%A8%E9%97%A8%E9%97%B4%E4%BA%92%E8%AE%BF%E7%9A%84%E6%9D%83%E9%99%90%E8%AE%BE%E7%BD%AE"><span class="toc-number">9.2.</span> <span class="toc-text">总公司部门间互访的权限设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%86%85%E9%83%A8%E7%BD%91%E7%BB%9C%E5%AF%B9Internet%E7%9A%84%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span class="toc-number">9.3.</span> <span class="toc-text">配置内部网络对Internet的访问权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%AE%BE%E8%AE%A1%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">9.4.</span> <span class="toc-text">内部网络安全设计的配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E4%B8%93%E7%94%A8%E7%BD%91VPN"><span class="toc-number">10.</span> <span class="toc-text">配置虚拟专用网VPN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80-6"><span class="toc-number">10.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#VPN"><span class="toc-number">10.1.1.</span> <span class="toc-text">VPN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPSec"><span class="toc-number">10.1.2.</span> <span class="toc-text">IPSec</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E9%85%8D%E7%BD%AE-1"><span class="toc-number">10.2.</span> <span class="toc-text">路由器配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NAT%E6%B5%81%E9%87%8F%E8%B1%81%E5%85%8D"><span class="toc-number">10.3.</span> <span class="toc-text">NAT流量豁免</span></a></li></ol></li></ol>
    </div>
  

    <!--返回顶部-->
    <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
        <a title="返回顶部">↑</a>
    </div>
    <script src="/blog/js/totop.js"></script>

    <div id="layout">
        
            <div id="content-background" ref="contentBackground" data-images="https://pic.imgdb.cn/item/65d61d809f345e8d03b8bc7a.png"></div>
            
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>第一次加载文章图片可能会花费较长时间</p>
                    <p>要不挂个梯子试试？（x</p>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/blog/images/loading.gif" />
                </div>
            </div>
        </transition>
        <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
        <a href="/blog/search">
            <i class="fa-solid fa-search fa-fw"></i>
            <span>&ensp;Search</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
            <a href="/blog/search">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-search fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Search</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>网络工程实训</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/2/18
        </span>
        
        
        <!--文章字数统计-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <!-- 安装插件npm install hexo-wordcount --save -->
        <span class="post-count">8.8k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">44分</span>
      </span>
    </span>
    
    <!--不蒜子统计访问数-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    总文章阅读量：<span id="busuanzi_value_page_pv"></span>次
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>必可活用于工控配交换机（</p>
<span id="more"></span>

<h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><p>某公司在A、B两地分别设有总公司和分公司。现需要为该公司建设企业网络，需要将总公司和分公司互联，以实现企业内部安全、高效的数据通信及资源共享；同时，总公司和分公司都需要接入Internet网络。目前，公司只申请到有限数量的公网IP地址，企业网络内部需要使用私有IP地址，但需全网接入Internet。</p>
<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><ol>
<li>总公司包括<strong>财务部、开发部、销售部以及服务器区</strong>，分公司包括<strong>开发部和销售部</strong>，为了提高数据传输效率、保证数据传输安全等因素，需要按照部门对公司内部网络进行广播域分割，公司所有服务器需要在一个独立的广播域内。（使用VLAN技术）</li>
<li>内部均使用私有IP地址，但需要与Internet网络通信。（使用NAT技术）</li>
<li>为了保证内部网络安全，以及内部网络各部门之间访问权限的限制，需要根据公司具体要求过滤内部网络与外部网络之间的数据包，以及内部网络各部门之间的数据包。（使用访问控制列表ACL）</li>
<li>使用路由协议或者静态&#x2F;默认路由，实现内部网络的连通以及对Internet网络的访问。（OSPF协议+静态路由+ 默认路由）</li>
<li>需要实现总公司与分公司之间安全、可靠的传输内部数据。（使用VPN技术）</li>
</ol>
<hr>
<h1 id="拓扑构建与IP地址规划"><a href="#拓扑构建与IP地址规划" class="headerlink" title="拓扑构建与IP地址规划"></a>拓扑构建与IP地址规划</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h3><p>此事在计算机网络中亦有记载：<a href="https://c1oudfl0w0.github.io/blog/2024/01/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#IP%E5%9C%B0%E5%9D%80">https://c1oudfl0w0.github.io/blog/2024/01/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#IP%E5%9C%B0%E5%9D%80</a></p>
<h3 id="子网划分"><a href="#子网划分" class="headerlink" title="子网划分"></a>子网划分</h3><p>节省IP地址资源</p>
<p>借用IP地址的若干主机位来充当子网号，从而将原网络划分为若干子网</p>
<p>如B类网络 156.12.0.0，可划分为 156.12.64.0 和 156.12.128.0</p>
<hr>
<h2 id="构建拓扑图"><a href="#构建拓扑图" class="headerlink" title="构建拓扑图"></a>构建拓扑图</h2><p>路由器这一层需要三个路由器，分别对应<strong>总公司、分公司和公网 Internet</strong></p>
<p>此处选择 2811 型号的路由器，模块采用 HWIC-2T，用于通过WAN接口与互联网通信，注意关闭电源才能加模块</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250226203646856.png" alt="image-20250226203646856"></p>
<p>然后路由器之间使用串行 DCE 连接</p>
<br>

<p>三层交换机，总公司和分公司都需要多层交换机</p>
<p>这里选择 3560 24PS 型号</p>
<br>

<p>二层交换机，几个部门就对应几个二层交换机</p>
<p>这里选择 2960 型号</p>
<br>

<p>最底层的终端设备，两个公司除了服务器区为 Server 以外均为 PC，Internet 网络上通过交换机有 Server 和 PC</p>
<p>基本拓扑图：</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250227200406712.png" alt="image-20250227200406712"></p>
<hr>
<h2 id="IP划分"><a href="#IP划分" class="headerlink" title="IP划分"></a>IP划分</h2><ol>
<li><p>为总公司和分公司分别分配17位子网掩码的地址段</p>
<table>
<thead>
<tr>
<th>公司名称</th>
<th>IP 地址段</th>
</tr>
</thead>
<tbody><tr>
<td>总公司</td>
<td>172.16.0.0&#x2F;17</td>
</tr>
<tr>
<td>分公司</td>
<td>172.16.128.0&#x2F;17</td>
</tr>
</tbody></table>
</li>
<li><p>总公司和分公司内部可使用 24 位掩码的 IP 地址段</p>
<p>总公司<strong>三层设备</strong>的互联地址使用 172.16.126.0&#x2F;24 的地址段；分公司三层设备的互联地址使用 172.16.254.0&#x2F;24 的地址段。为了节省 IP 地址，三层设备的互联地址均使用 30 位子网掩码</p>
<table>
<thead>
<tr>
<th>公司名称</th>
<th>网关路由器</th>
<th>核心交换机1</th>
<th>子网掩码</th>
</tr>
</thead>
<tbody><tr>
<td>总公司</td>
<td>172.16.126.1</td>
<td>172.16.126.2</td>
<td>255.255.255.252</td>
</tr>
<tr>
<td>分公司</td>
<td>172.16.254.1</td>
<td>172.16.254.2</td>
<td>255.255.255.252</td>
</tr>
</tbody></table>
</li>
<li><p>为总公司和分公司的<strong>网关路由器</strong>分别配置 loopback 接口的 IP 地址，作为其管理地址</p>
<table>
<thead>
<tr>
<th>公司名称</th>
<th>IP 地址</th>
</tr>
</thead>
<tbody><tr>
<td>总公司</td>
<td>192.168.0.1&#x2F;32</td>
</tr>
<tr>
<td>分公司</td>
<td>192.168.0.2&#x2F;32</td>
</tr>
</tbody></table>
</li>
<li><p>为总公司的可管理交换机规划管理IP地址，这里使用的 IP 地址网段为总公司网段 172.16.0.0&#x2F;17 中最小的一个 24 位子网掩码的网段 172.16.1.0&#x2F;24</p>
<p>C段下主机标识的最高位“1”代表核心交换机，“2”代表接入交换机；最低位的数字代表该交换机在这类交换机中的编号</p>
<table>
<thead>
<tr>
<th>部门</th>
<th>IP 地址</th>
</tr>
</thead>
<tbody><tr>
<td>核心交换机1</td>
<td>172.16.1.101&#x2F;24</td>
</tr>
<tr>
<td>接入交换机1</td>
<td>172.16.1.201&#x2F;24</td>
</tr>
<tr>
<td>接入交换机2</td>
<td>172.16.1.202&#x2F;24</td>
</tr>
<tr>
<td>接入交换机3</td>
<td>172.16.1.203&#x2F;24</td>
</tr>
<tr>
<td>接入交换机4</td>
<td>172.16.1.204&#x2F;24</td>
</tr>
</tbody></table>
<p>分公司如下：</p>
<table>
<thead>
<tr>
<th>交换机名称</th>
<th>IP 地址</th>
</tr>
</thead>
<tbody><tr>
<td>核心交换机</td>
<td>172.16.129.101&#x2F;24</td>
</tr>
<tr>
<td>接入交换机</td>
<td>172.16.129.201&#x2F;24</td>
</tr>
</tbody></table>
</li>
<li><p>配置 VLAN，为每个部门分配一个 24 位子网掩码的网络号，每个网段的网关 IP 地址统一使用 .254</p>
<p>总公司</p>
<table>
<thead>
<tr>
<th>部门</th>
<th>VLAN 名</th>
<th>VLAN ID</th>
<th>IP 地址段</th>
<th>网关 IP 地址</th>
</tr>
</thead>
<tbody><tr>
<td>服务器区</td>
<td>VLAN_Server</td>
<td>2</td>
<td>172.16.2.0&#x2F;24</td>
<td>172.16.2.254</td>
</tr>
<tr>
<td>开发部</td>
<td>VLAN_KFB</td>
<td>3</td>
<td>172.16.3.0&#x2F;24</td>
<td>172.16.3.254</td>
</tr>
<tr>
<td>销售部</td>
<td>VLAN_XSB</td>
<td>4</td>
<td>172.16.4.0&#x2F;24</td>
<td>172.16.4.254</td>
</tr>
<tr>
<td>财务部</td>
<td>VLAN_CWB</td>
<td>5</td>
<td>172.16.5.0&#x2F;24</td>
<td>172.16.5.254</td>
</tr>
</tbody></table>
<p>分公司</p>
<table>
<thead>
<tr>
<th>部门</th>
<th>VLAN 名</th>
<th>VLAN ID</th>
<th>IP 地址段</th>
<th>网关 IP 地址</th>
</tr>
</thead>
<tbody><tr>
<td>开发部</td>
<td>VLAN_Sub_KFB</td>
<td>30</td>
<td>172.16.130.0&#x2F;24</td>
<td>172.16.130.254</td>
</tr>
<tr>
<td>销售部</td>
<td>VLAN_Sub_XSB</td>
<td>40</td>
<td>172.16.131.0&#x2F;24</td>
<td>172.16.131.254</td>
</tr>
</tbody></table>
</li>
<li><p>模拟Internet网络</p>
<table>
<thead>
<tr>
<th>Internet</th>
<th>总公司</th>
<th>分公司</th>
<th>子网掩码</th>
</tr>
</thead>
<tbody><tr>
<td>23.1.1.254</td>
<td>23.1.1.1</td>
<td></td>
<td>255.255.255.0</td>
</tr>
<tr>
<td>23.1.2.254</td>
<td></td>
<td>23.1.2.1</td>
<td>255.255.255.0</td>
</tr>
<tr>
<td>23.1.3.254</td>
<td>PC：23.1.3.1</td>
<td></td>
<td>255.255.255.0</td>
</tr>
</tbody></table>
</li>
</ol>
<p>结合设备，最终的IP划分：</p>
<table>
<thead>
<tr>
<th>分布</th>
<th>设备名称</th>
<th>接口</th>
<th>Vlan</th>
<th>IP地址</th>
<th>子网掩码</th>
<th>所接设备及接口</th>
</tr>
</thead>
<tbody><tr>
<td>总公司</td>
<td>Router-2811-0</td>
<td>F0&#x2F;0</td>
<td></td>
<td>172.16.126.1</td>
<td>255.255.255.252</td>
<td>Switch-3560-24PS-0 F0&#x2F;1</td>
</tr>
<tr>
<td></td>
<td></td>
<td>S0&#x2F;0&#x2F;0</td>
<td></td>
<td>23.1.1.1</td>
<td>255.255.255.0</td>
<td>Router-2811-2 S0&#x2F;0&#x2F;0</td>
</tr>
<tr>
<td></td>
<td></td>
<td>loopback0</td>
<td></td>
<td>192.168.0.1</td>
<td>255.255.255.255</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Switch-3560-24PS-0</td>
<td>F0&#x2F;1</td>
<td></td>
<td>172.16.126.2</td>
<td>255.255.255.252</td>
<td>Router-2811-0 F0&#x2F;0</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;2</td>
<td></td>
<td></td>
<td></td>
<td>Switch-2960-24TT-0 F0&#x2F;1</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;3</td>
<td></td>
<td></td>
<td></td>
<td>Switch-2960-24TT-1 F0&#x2F;1</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;4</td>
<td></td>
<td></td>
<td></td>
<td>Switch-2960-24TT-2 F0&#x2F;1</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;5</td>
<td></td>
<td></td>
<td></td>
<td>Switch-2960-24TT-3 F0&#x2F;1</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Vlan1</td>
<td></td>
<td>172.16.1.101</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Vlan2</td>
<td></td>
<td>172.16.2.254</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Vlan3</td>
<td></td>
<td>172.16.3.254</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Vlan4</td>
<td></td>
<td>172.16.4.254</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Vlan5</td>
<td></td>
<td>172.16.5.254</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Switch-2960-24TT-0</td>
<td>F0&#x2F;1</td>
<td></td>
<td></td>
<td></td>
<td>Switch-3560-24PS-0 F0&#x2F;2</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;2</td>
<td>2</td>
<td></td>
<td></td>
<td>Server-PT-0 F0</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;3</td>
<td>2</td>
<td></td>
<td></td>
<td>Server-PT-1 F0</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Vlan1</td>
<td></td>
<td>172.16.1.201</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Switch-2960-24TT-1</td>
<td>F0&#x2F;1</td>
<td></td>
<td></td>
<td></td>
<td>Switch-3560-24PS-0 F0&#x2F;3</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;2</td>
<td>3</td>
<td></td>
<td></td>
<td>PC-PT-0 F0</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Vlan1</td>
<td></td>
<td>172.16.1.202</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Switch-2960-24TT-2</td>
<td>F0&#x2F;1</td>
<td></td>
<td></td>
<td></td>
<td>Switch-3560-24PS-0 F0&#x2F;4</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;2</td>
<td>4</td>
<td></td>
<td></td>
<td>PC-PT-1 F0</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Vlan1</td>
<td></td>
<td>172.16.1.203</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Switch-2960-24TT-3</td>
<td>F0&#x2F;1</td>
<td></td>
<td></td>
<td></td>
<td>Switch-3560-24PS-0 F0&#x2F;5</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;2</td>
<td>5</td>
<td></td>
<td></td>
<td>PC-PT-2 F0</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Vlan1</td>
<td></td>
<td>172.16.1.204</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Server-PT-0</td>
<td>F0</td>
<td></td>
<td>172.16.2.1</td>
<td>255.255.0.0</td>
<td>Switch-2960-24TT-0 F0&#x2F;2</td>
</tr>
<tr>
<td></td>
<td>Server-PT-1</td>
<td>F0</td>
<td></td>
<td>172.16.2.2</td>
<td>255.255.0.0</td>
<td>Switch-2960-24TT-0 F0&#x2F;3</td>
</tr>
<tr>
<td></td>
<td>PC-PT-0</td>
<td>F0</td>
<td></td>
<td>172.16.3.1</td>
<td>255.255.0.0</td>
<td>Switch-2960-24TT-1 F0&#x2F;2</td>
</tr>
<tr>
<td></td>
<td>PC-PT-1</td>
<td>F0</td>
<td></td>
<td>172.16.4.1</td>
<td>255.255.0.0</td>
<td>Switch-2960-24TT-2 F0&#x2F;2</td>
</tr>
<tr>
<td></td>
<td>PC-PT-2</td>
<td>F0</td>
<td></td>
<td>172.16.5.1</td>
<td>255.255.0.0</td>
<td>Switch-2960-24TT-3 F0&#x2F;2</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>分公司</td>
<td>Router-2811-1</td>
<td>F0&#x2F;0</td>
<td></td>
<td>172.16.254.1</td>
<td>255.255.255.252</td>
<td>Switch-3560-24PS-1 F0&#x2F;1</td>
</tr>
<tr>
<td></td>
<td></td>
<td>S0&#x2F;0&#x2F;1</td>
<td></td>
<td>23.1.2.1</td>
<td>255.255.255.0</td>
<td>Router-2811-2 S0&#x2F;0&#x2F;1</td>
</tr>
<tr>
<td></td>
<td></td>
<td>loopback0</td>
<td></td>
<td>192.168.0.2</td>
<td>255.255.255.255</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Switch-3560-24PS-1</td>
<td>F0&#x2F;1</td>
<td></td>
<td>172.16.254.2</td>
<td>255.255.255.252</td>
<td>Router-2811-1 F0&#x2F;0</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;2</td>
<td></td>
<td></td>
<td></td>
<td>Switch-2960-24TT-4 F0&#x2F;1</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;3</td>
<td></td>
<td></td>
<td></td>
<td>Switch-2960-24TT-5 F0&#x2F;1</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Vlan1</td>
<td></td>
<td>172.16.129.101</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Vlan30</td>
<td></td>
<td>172.16.130.254</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Vlan40</td>
<td></td>
<td>172.16.131.254</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Switch-2960-24TT-4</td>
<td>F0&#x2F;1</td>
<td></td>
<td></td>
<td></td>
<td>Switch-3560-24PS-1 F0&#x2F;2</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;2</td>
<td>30</td>
<td></td>
<td></td>
<td>PC-PT-3 F0</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Vlan1</td>
<td></td>
<td>172.16.129.201</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Switch-2960-24TT-5</td>
<td>F0&#x2F;1</td>
<td></td>
<td></td>
<td></td>
<td>Switch-3560-24PS-1 F0&#x2F;3</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;2</td>
<td>40</td>
<td></td>
<td></td>
<td>PC-PT-4 F0</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Vlan1</td>
<td></td>
<td>172.16.129.202</td>
<td>255.255.255.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>PC-PT-3</td>
<td>F0</td>
<td></td>
<td>172.16.130.1</td>
<td>255.255.0.0</td>
<td>Switch-2960-24TT-4 F0&#x2F;2</td>
</tr>
<tr>
<td></td>
<td>PC-PT-4</td>
<td>F0</td>
<td></td>
<td>172.16.131.1</td>
<td>255.255.0.0</td>
<td>Switch-2960-24TT-5 F0&#x2F;2</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>外网Internet</td>
<td>Router-2811-2</td>
<td>S0&#x2F;0&#x2F;0</td>
<td></td>
<td>23.1.1.254</td>
<td>255.255.255.0</td>
<td>Router-2811-0 S0&#x2F;0&#x2F;0</td>
</tr>
<tr>
<td></td>
<td></td>
<td>S0&#x2F;0&#x2F;1</td>
<td></td>
<td>23.1.2.254</td>
<td>255.255.255.0</td>
<td>Router-2811-1 S0&#x2F;0&#x2F;1</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;0</td>
<td></td>
<td>23.1.3.254</td>
<td>255.255.255.0</td>
<td>Switch-2960-24TT-6 F0&#x2F;1</td>
</tr>
<tr>
<td></td>
<td>Switch-2960-24TT-6</td>
<td>F0&#x2F;1</td>
<td></td>
<td></td>
<td></td>
<td>Router-2811-2 F0&#x2F;0</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;2</td>
<td></td>
<td></td>
<td></td>
<td>PC-PT-5 F0</td>
</tr>
<tr>
<td></td>
<td></td>
<td>F0&#x2F;3</td>
<td></td>
<td></td>
<td></td>
<td>Server-PT-2 F0</td>
</tr>
<tr>
<td></td>
<td>PC-PT-5</td>
<td>F0</td>
<td></td>
<td>23.1.3.1</td>
<td>255.255.255.0</td>
<td>Switch-2960-24TT-6 F0&#x2F;2</td>
</tr>
<tr>
<td></td>
<td>Server-PT-2</td>
<td>F0</td>
<td></td>
<td>23.1.3.2</td>
<td>255.255.255.0</td>
<td>Switch-2960-24TT-6 F0&#x2F;3</td>
</tr>
</tbody></table>
<hr>
<h1 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h1><p>关闭域名查询</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#no ip domain-lookup</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h2 id="主机命名修改"><a href="#主机命名修改" class="headerlink" title="主机命名修改"></a>主机命名修改</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">old_hostname<span class="token operator">></span>enable
old_hostname<span class="token comment">#configure terminal</span>
old_hostname<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#hostname new_name</span>
new_name<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>规范示例：设备地理位置-设备类型&#x2F;网络位置-设备型号-设备编号</p>
<h2 id="配置特权密码"><a href="#配置特权密码" class="headerlink" title="配置特权密码"></a>配置特权密码</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hostname<span class="token operator">></span>enable
<span class="token function">hostname</span><span class="token comment">#configure terminal</span>
hostname<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#enable password 123456</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250227201025606.png" alt="image-20250227201025606"></p>
<h2 id="Console端口密码"><a href="#Console端口密码" class="headerlink" title="Console端口密码"></a>Console端口密码</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#line console 0</span>
Router-2811-0<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment">#password 111111</span>
Router-2811-0<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment">#login</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>使用 配置线 连接电脑的 COM&#x2F;RS232 接口和路由器的 Console 接口</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250227183815860.png" alt="image-20250227183815860"></p>
<p>然后在笔记本配置终端，主要是波特率，这里是默认的9600</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250227183955525.png" alt="image-20250227183955525"></p>
<p>确定即可连接上路由器</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250227195957859.png" alt="image-20250227195957859"></p>
<h2 id="配置VTY的密码"><a href="#配置VTY的密码" class="headerlink" title="配置VTY的密码"></a>配置VTY的密码</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Switch-3560-24PS-0<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment">#line vty 0</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment">#password aaaaaa</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment">#login</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250227195607185.png" alt="image-20250227195607185"></p>
<h2 id="保存配置文件"><a href="#保存配置文件" class="headerlink" title="保存配置文件"></a>保存配置文件</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router-2811-0<span class="token comment">#copy running-config startup-config</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="路由器配置"><a href="#路由器配置" class="headerlink" title="路由器配置"></a>路由器配置</h1><h2 id="基础-1"><a href="#基础-1" class="headerlink" title="基础"></a>基础</h2><h3 id="路由器硬件结构"><a href="#路由器硬件结构" class="headerlink" title="路由器硬件结构"></a>路由器硬件结构</h3><p>内部组成：CPU + ROM + Flash + NVRAM + RAM</p>
<p>接口：RJ-45 端口，Serial 接口，Console 端口</p>
<hr>
<h2 id="路由器地址规划"><a href="#路由器地址规划" class="headerlink" title="路由器地址规划"></a>路由器地址规划</h2><table>
<thead>
<tr>
<th>设备名称</th>
<th>接口</th>
<th>IP地址</th>
<th>子网掩码</th>
</tr>
</thead>
<tbody><tr>
<td>Router-2811-0</td>
<td>F0&#x2F;0</td>
<td>172.16.126.1</td>
<td>255.255.255.252</td>
</tr>
<tr>
<td></td>
<td>S0&#x2F;0&#x2F;0</td>
<td>23.1.1.1</td>
<td>255.255.255.0</td>
</tr>
<tr>
<td></td>
<td>loopback0</td>
<td>192.168.0.1</td>
<td>255.255.255.255</td>
</tr>
<tr>
<td>Router-2811-1</td>
<td>F0&#x2F;0</td>
<td>172.16.254.1</td>
<td>255.255.255.252</td>
</tr>
<tr>
<td></td>
<td>S0&#x2F;0&#x2F;1</td>
<td>23.1.2.1</td>
<td>255.255.255.0</td>
</tr>
<tr>
<td></td>
<td>loopback0</td>
<td>192.168.0.2</td>
<td>255.255.255.255</td>
</tr>
<tr>
<td>Router-2811-2</td>
<td>S0&#x2F;0&#x2F;0</td>
<td>23.1.1.254</td>
<td>255.255.255.0</td>
</tr>
<tr>
<td></td>
<td>S0&#x2F;0&#x2F;1</td>
<td>23.1.2.254</td>
<td>255.255.255.0</td>
</tr>
<tr>
<td></td>
<td>F0&#x2F;0</td>
<td>23.1.3.254</td>
<td>255.255.255.0</td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#interface fa0/0</span>
Router-2811-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.126.1 255.255.255.252</span>
Router-2811-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#interface Serial0/0/0</span>
Router-2811-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 23.1.1.1 255.255.255.0</span>
Router-2811-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span>

Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#interface fa0/0</span>
Router-2811-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.254.1 255.255.255.252</span>
Router-2811-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#interface Serial0/0/1</span>
Router-2811-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 23.1.2.1 255.255.255.0</span>
Router-2811-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span>

Router-2811-2<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#interface Serial0/0/0</span>
Router-2811-2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 23.1.1.254 255.255.255.0</span>
Router-2811-2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span>
Router-2811-2<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#interface Serial0/0/1</span>
Router-2811-2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 23.1.2.254 255.255.255.0</span>
Router-2811-2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span>
Router-2811-2<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#interface FastEthernet0/0</span>
Router-2811-2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 23.1.3.254 255.255.255.0</span>
Router-2811-2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="loopback地址规划"><a href="#loopback地址规划" class="headerlink" title="loopback地址规划"></a>loopback地址规划</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#interface loopback 0</span>
Router-2811-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 192.168.0.1 255.255.255.255</span>
Router-2811-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown </span>

Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#interface loopback 0</span>
Router-2811-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 192.168.0.2 255.255.255.255</span>
Router-2811-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<hr>
<h1 id="交换机VLAN配置"><a href="#交换机VLAN配置" class="headerlink" title="交换机VLAN配置"></a>交换机VLAN配置</h1><h2 id="基础-2"><a href="#基础-2" class="headerlink" title="基础"></a>基础</h2><h3 id="VLAN"><a href="#VLAN" class="headerlink" title="VLAN"></a>VLAN</h3><p>简介参考计算机网络：<a href="https://c1oudfl0w0.github.io/blog/2024/01/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#%E8%99%9A%E6%8B%9F%E5%B1%80%E5%9F%9F%E7%BD%91VLAN">https://c1oudfl0w0.github.io/blog/2024/01/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#%E8%99%9A%E6%8B%9F%E5%B1%80%E5%9F%9F%E7%BD%91VLAN</a></p>
<p>类型：</p>
<ul>
<li>基于端口划分的 VLAN（静态 VLAN）</li>
<li>基于 MAC 地址划分 VLAN（动态 VLAN）</li>
</ul>
<p>交换机中默认的管理 VLAN 为 VLAN 1，不能被移除</p>
<hr>
<h2 id="三层——互联地址规划"><a href="#三层——互联地址规划" class="headerlink" title="三层——互联地址规划"></a>三层——互联地址规划</h2><table>
<thead>
<tr>
<th>设备名称</th>
<th>接口</th>
<th>IP地址</th>
<th>子网掩码</th>
</tr>
</thead>
<tbody><tr>
<td>Switch-3560-24PS-0</td>
<td>F0&#x2F;1</td>
<td>172.16.126.2</td>
<td>255.255.255.252</td>
</tr>
<tr>
<td>Switch-3560-24PS-1</td>
<td>F0&#x2F;1</td>
<td>172.16.254.2</td>
<td>255.255.255.252</td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#interface f0/1</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no switchport</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.126.2 255.255.255.252</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span>

Switch-3560-24PS-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int f0/1</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no switchport</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.254.2 255.255.255.252</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="二三层——配置trunk链接"><a href="#二三层——配置trunk链接" class="headerlink" title="二三层——配置trunk链接"></a>二三层——配置trunk链接</h2><table>
<thead>
<tr>
<th>设备名称</th>
<th>trunk端口</th>
<th>access端口</th>
<th>归属vlan</th>
</tr>
</thead>
<tbody><tr>
<td>Switch-3560-24PS-0</td>
<td></td>
<td>F0&#x2F;1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>F0&#x2F;2</td>
<td></td>
<td>Vlan2</td>
</tr>
<tr>
<td></td>
<td>F0&#x2F;3</td>
<td></td>
<td>Vlan3</td>
</tr>
<tr>
<td></td>
<td>F0&#x2F;4</td>
<td></td>
<td>Vlan4</td>
</tr>
<tr>
<td></td>
<td>F0&#x2F;5</td>
<td></td>
<td>Vlan5</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Switch-3560-24PS-1</td>
<td></td>
<td>F0&#x2F;1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>F0&#x2F;2</td>
<td></td>
<td>Vlan30</td>
</tr>
<tr>
<td></td>
<td>F0&#x2F;3</td>
<td></td>
<td>Vlan40</td>
</tr>
</tbody></table>
<p>配置中继链路：</p>
<blockquote>
<p>交换机的端口分为接入链路和中继链路，在接入模式下，端口仅属于一个 VLAN，而 trunk 是一种封装技术，它是一条点到点的链路，主要功能就是仅通过一条链路就可以承载跨交换机的多个 VLAN 的通信</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// 配置端口模式及封装协议
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int f0/2</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport trunk encapsulation dot1q</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport mode trunk</span>

Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#int f0/3</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport trunk encapsulation dot1q</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport mode trunk</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#int f0/4</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport trunk encapsulation dot1q</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport mode trunk</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#int f0/5</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport trunk encapsulation dot1q</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport mode trunk</span>

Switch-3560-24PS-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int f0/2</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport trunk encapsulation dot1q</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport mode trunk</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#int f0/3</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport trunk encapsulation dot1q</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport mode trunk</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>执行完三层后二层对应的端口会自动变成trunk</p>
<p>可使用 <code>show int trunk</code> 进行验证，最终的效果：</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250423111744991.png" alt="image-20250423111744991"></p>
<h2 id="二三层——配置VTP域"><a href="#二三层——配置VTP域" class="headerlink" title="二三层——配置VTP域"></a>二三层——配置VTP域</h2><table>
<thead>
<tr>
<th>设备名称</th>
<th>VTP域名</th>
<th>VTP模式</th>
<th>VTP密码</th>
</tr>
</thead>
<tbody><tr>
<td>Switch-3560-24PS-0</td>
<td>Parent_Com</td>
<td>Server</td>
<td>123456</td>
</tr>
<tr>
<td>Switch-3560-24PS-1</td>
<td>Sub_Com</td>
<td>Server</td>
<td>123456</td>
</tr>
<tr>
<td>Switch-2960-24TT-0</td>
<td>Parent_Com</td>
<td>Client</td>
<td></td>
</tr>
<tr>
<td>Switch-2960-24TT-1</td>
<td>Parent_Com</td>
<td>Client</td>
<td></td>
</tr>
<tr>
<td>Switch-2960-24TT-2</td>
<td>Parent_Com</td>
<td>Client</td>
<td></td>
</tr>
<tr>
<td>Switch-2960-24TT-3</td>
<td>Parent_Com</td>
<td>Client</td>
<td></td>
</tr>
<tr>
<td>Switch-2960-24TT-4</td>
<td>Sub_Com</td>
<td>Client</td>
<td></td>
</tr>
<tr>
<td>Switch-2960-24TT-5</td>
<td>Sub_Com</td>
<td>Client</td>
<td></td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#vtp domain Parent_Com</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#vtp mode server</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#vtp password 123456</span>

Switch-2960-24TT-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#vtp mod client</span>
Switch-2960-24TT-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#vtp mod client</span>
Switch-2960-24TT-2<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#vtp mod client</span>
Switch-2960-24TT-3<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#vtp mod client</span>

Switch-3560-24PS-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#vtp domain Sub_Com</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#vtp mode server</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#vtp password 123456</span>

Switch-2960-24TT-4<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#vtp mod client</span>
Switch-2960-24TT-5<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#vtp mod client</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="二三层——业务地址规划"><a href="#二三层——业务地址规划" class="headerlink" title="二三层——业务地址规划"></a>二三层——业务地址规划</h2><table>
<thead>
<tr>
<th>设备名称</th>
<th>接口</th>
<th>IP 地址</th>
<th>子网掩码</th>
</tr>
</thead>
<tbody><tr>
<td>Switch-3560-24PS-0</td>
<td>Vlan1</td>
<td>172.16.1.101</td>
<td>255.255.255.0</td>
</tr>
<tr>
<td>Switch-2960-24TT-0</td>
<td>Vlan1</td>
<td>172.16.1.201</td>
<td>255.255.255.0</td>
</tr>
<tr>
<td>Switch-2960-24TT-1</td>
<td>Vlan1</td>
<td>172.16.1.202</td>
<td>255.255.255.0</td>
</tr>
<tr>
<td>Switch-2960-24TT-2</td>
<td>Vlan1</td>
<td>172.16.1.203</td>
<td>255.255.255.0</td>
</tr>
<tr>
<td>Switch-2960-24TT-3</td>
<td>Vlan1</td>
<td>172.16.1.204</td>
<td>255.255.255.0</td>
</tr>
<tr>
<td>总公司↑<br />分公司↓</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Switch-3560-24PS-1</td>
<td>Vlan1</td>
<td>172.16.129.101</td>
<td>255.255.255.0</td>
</tr>
<tr>
<td>Switch-2960-24TT-4</td>
<td>Vlan1</td>
<td>172.16.129.201</td>
<td>255.255.255.0</td>
</tr>
<tr>
<td>Switch-2960-24TT-5</td>
<td>Vlan1</td>
<td>172.16.129.202</td>
<td>255.255.255.0</td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip routing</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#interface vlan1</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.1.101 255.255.255.0</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span>

Switch-3560-24PS-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip routing</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#interface vlan1</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.129.101 255.255.255.0</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span>

Switch-2960-24TT-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#interface vlan1</span>
Switch-2960-24TT-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.1.201 255.255.255.0</span>
Switch-2960-24TT-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span>

Switch-2960-24TT-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int vlan1</span>
Switch-2960-24TT-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.1.202 255.255.255.0</span>
Switch-2960-24TT-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span>

Switch-2960-24TT-2<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int vlan1</span>
Switch-2960-24TT-2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.1.203 255.255.255.0</span>
Switch-2960-24TT-2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span>

Switch-2960-24TT-3<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int vlan1</span>
Switch-2960-24TT-3<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.1.204 255.255.255.0</span>
Switch-2960-24TT-3<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span>


Switch-3560-24PS-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int vlan1</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip add 172.16.129.101 255.255.255.0</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown </span>

Switch-2960-24TT-4<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int vlan1</span>
Switch-2960-24TT-4<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip add 172.16.129.201 255.255.255.0</span>
Switch-2960-24TT-4<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span>

Switch-2960-24TT-5<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int vlan1</span>
Switch-2960-24TT-5<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip add 172.16.129.202 255.255.255.0</span>
Switch-2960-24TT-5<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shutdown</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<table>
<thead>
<tr>
<th>部门</th>
<th>VLAN 名</th>
<th>VLAN ID</th>
<th>IP 地址段</th>
<th>网关 IP 地址</th>
</tr>
</thead>
<tbody><tr>
<td>服务器区</td>
<td>VLAN_Server</td>
<td>2</td>
<td>172.16.2.0&#x2F;24</td>
<td>172.16.2.254</td>
</tr>
<tr>
<td>开发部</td>
<td>VLAN_KFB</td>
<td>3</td>
<td>172.16.3.0&#x2F;24</td>
<td>172.16.3.254</td>
</tr>
<tr>
<td>销售部</td>
<td>VLAN_XSB</td>
<td>4</td>
<td>172.16.4.0&#x2F;24</td>
<td>172.16.4.254</td>
</tr>
<tr>
<td>财务部</td>
<td>VLAN_CWB</td>
<td>5</td>
<td>172.16.5.0&#x2F;24</td>
<td>172.16.5.254</td>
</tr>
<tr>
<td>总公司↑<br />分公司↓</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>开发部</td>
<td>VLAN_Sub_KFB</td>
<td>30</td>
<td>172.16.130.0&#x2F;24</td>
<td>172.16.130.254</td>
</tr>
<tr>
<td>销售部</td>
<td>VLAN_Sub_XSB</td>
<td>40</td>
<td>172.16.131.0&#x2F;24</td>
<td>172.16.131.254</td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// 创建 VLAN
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#vlan 2</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-vlan<span class="token punctuation">)</span><span class="token comment">#name VLAN_Server</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-vlan<span class="token punctuation">)</span><span class="token comment">#vlan 3</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-vlan<span class="token punctuation">)</span><span class="token comment">#name VLAN_KFB</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-vlan<span class="token punctuation">)</span><span class="token comment">#vlan 4</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-vlan<span class="token punctuation">)</span><span class="token comment">#name VLAN_XSB</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-vlan<span class="token punctuation">)</span><span class="token comment">#vlan 5</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-vlan<span class="token punctuation">)</span><span class="token comment">#name VLAN_CWB</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-vlan<span class="token punctuation">)</span><span class="token comment">#ex</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int vlan2</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.2.254 255.255.255.0</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int vlan3</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.3.254 255.255.255.0</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int vlan4</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.4.254 255.255.255.0</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int vlan5</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.5.254 255.255.255.0</span>

Switch-3560-24PS-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#vlan 30</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-vlan<span class="token punctuation">)</span><span class="token comment">#name VLAN_Sub_KFB</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-vlan<span class="token punctuation">)</span><span class="token comment">#vlan 40</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-vlan<span class="token punctuation">)</span><span class="token comment">#name VLAN_Sub_XSB</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-vlan<span class="token punctuation">)</span><span class="token comment">#int vlan30</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.130.254 255.255.255.0</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int vlan40</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 172.16.131.254 255.255.255.0</span>


Switch-2960-24TT-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip default-gateway 172.16.2.254</span>

Switch-2960-24TT-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip default-gateway 172.16.3.254</span>

Switch-2960-24TT-2<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip default-gateway 172.16.4.254</span>

Switch-2960-24TT-3<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip default-gateway 172.16.5.254</span>

Switch-2960-24TT-4<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip default-gateway 172.16.130.254</span>

Switch-2960-24TT-5<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip default-gateway 172.16.131.254</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="二层——端口划分到VLAN"><a href="#二层——端口划分到VLAN" class="headerlink" title="二层——端口划分到VLAN"></a>二层——端口划分到VLAN</h2><p>将交换机端口分配到VLAN中</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Switch-2960-24TT-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#interface f0/2</span>
Switch-2960-24TT-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport access vlan 2</span>
Switch-2960-24TT-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#interface f0/3</span>
Switch-2960-24TT-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport access vlan 2</span>

Switch-2960-24TT-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int f0/2</span>
Switch-2960-24TT-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport access vlan 3</span>

Switch-2960-24TT-2<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int f0/2</span>
Switch-2960-24TT-2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport access vlan 4</span>

Switch-2960-24TT-3<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int f0/2</span>
Switch-2960-24TT-3<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport access vlan 5</span>


Switch-2960-24TT-4<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int f0/2</span>
Switch-2960-24TT-4<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport access vlan 30</span>

Switch-2960-24TT-5<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int f0/2</span>
Switch-2960-24TT-5<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport access vlan 40</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br>

<p>配置完成后使用<code>show vlan</code>查看 VLAN 信息</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250423110927667.png" alt="image-20250423110927667"></p>
<p>这里说明 fa0&#x2F;2~3 属于 VLAN 2</p>
<hr>
<h2 id="终端机配置"><a href="#终端机配置" class="headerlink" title="终端机配置"></a>终端机配置</h2><table>
<thead>
<tr>
<th>设备名称</th>
<th>接口</th>
<th>IP地址</th>
<th>子网掩码</th>
<th>默认网关</th>
</tr>
</thead>
<tbody><tr>
<td>Server-PT-0</td>
<td>F0</td>
<td>172.16.2.1</td>
<td>255.255.0.0</td>
<td>172.16.2.254</td>
</tr>
<tr>
<td>Server-PT-1</td>
<td>F0</td>
<td>172.16.2.2</td>
<td>255.255.0.0</td>
<td>172.16.2.254</td>
</tr>
<tr>
<td>PC-PT-0</td>
<td>F0</td>
<td>172.16.3.1</td>
<td>255.255.0.0</td>
<td>172.16.3.254</td>
</tr>
<tr>
<td>PC-PT-1</td>
<td>F0</td>
<td>172.16.4.1</td>
<td>255.255.0.0</td>
<td>172.16.4.254</td>
</tr>
<tr>
<td>PC-PT-2</td>
<td>F0</td>
<td>172.16.5.1</td>
<td>255.255.0.0</td>
<td>172.16.5.254</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>PC-PT-3</td>
<td>F0</td>
<td>172.16.130.1</td>
<td>255.255.0.0</td>
<td>172.16.130.254</td>
</tr>
<tr>
<td>PC-PT-4</td>
<td>F0</td>
<td>172.16.131.1</td>
<td>255.255.0.0</td>
<td>172.16.131.254</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>PC-PT-5</td>
<td>F0</td>
<td>23.1.3.1</td>
<td>255.255.255.0</td>
<td>23.1.3.254</td>
</tr>
<tr>
<td>Server-PT-2</td>
<td>F0</td>
<td>23.1.3.2</td>
<td>255.255.255.0</td>
<td>23.1.3.254</td>
</tr>
</tbody></table>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250227120149490.png" alt="image-20250227120149490"></p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250227120404130.png" alt="image-20250227120404130"></p>
<hr>
<h1 id="网络路由配置"><a href="#网络路由配置" class="headerlink" title="网络路由配置"></a>网络路由配置</h1><p>关于路由器 Internet 部分的 IP 配置已经在上面配路由器的时候配置好了，这里直接配置 OSPF 协议</p>
<h2 id="基础-3"><a href="#基础-3" class="headerlink" title="基础"></a>基础</h2><h3 id="路由表"><a href="#路由表" class="headerlink" title="路由表"></a>路由表</h3><p>为经过路由器的每个数据包寻找一条最佳的转发路径，并将该数据包有效地传送到目的站点</p>
<p>包含：</p>
<ul>
<li>目的IP地址</li>
<li>子网掩码</li>
<li>下一跳地址（next-hop）</li>
<li>传输接口</li>
<li>度量值</li>
</ul>
<h3 id="路由分类"><a href="#路由分类" class="headerlink" title="路由分类"></a>路由分类</h3><ul>
<li>直连路由：路由器接口上配置的网段地址会自动出现在路由表中，并与接口相关联</li>
<li>静态路由：管理员在路由器中手动配置的路由</li>
<li>动态路由：路由选择协议自动生成，常用的路由选择协议包括 RIP 协议、OSPF 协议等</li>
</ul>
<h3 id="IP路由过程"><a href="#IP路由过程" class="headerlink" title="IP路由过程"></a>IP路由过程</h3><p>PC1 发送数据包给 PC2，但是 PC2 与 PC1 不在同一个网段</p>
<p>那么 PC1 将数据发送给网关路由器 R1</p>
<p>R1 接收到数据帧后，检查 MAC 地址，通过后将IP数据包发送到网络层</p>
<p>R1 检查数据包的目的IP地址与 R1 路由表进行匹配，找到路由器 R2，发包</p>
<p>同样的方法直到交付到 PC2</p>
<h3 id="动态路由协议OSPF"><a href="#动态路由协议OSPF" class="headerlink" title="动态路由协议OSPF"></a>动态路由协议OSPF</h3><p>术语：</p>
<ul>
<li>路由器标识（Router ID）</li>
<li>邻居</li>
<li>邻接</li>
<li>链路和链路状态</li>
<li>邻居表</li>
<li>链路状态数据库 LSDB</li>
<li>路由表</li>
<li>LSA</li>
</ul>
<p>工作过程：</p>
<ul>
<li>发现邻居：路由器通过发送 Hello 报文获取邻居信息，建立邻居关系</li>
<li>建立邻接关系</li>
<li>传递链路状态信息</li>
<li>计算路由：SPF 算法计算最短路径树，建立路由表</li>
</ul>
<p>区域划分：</p>
<ul>
<li>区域内部路由器</li>
<li>骨干路由器</li>
<li>区域边界路由器（ABR）</li>
</ul>
<p>当某个区域与骨干区域在物理上不相连时，需要建立<strong>虚链路</strong>，使其逻辑上相连</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250423115742383.png" alt="image-20250423115742383"></p>
<p>虚链路配置规则</p>
<ul>
<li>虚链路必须配置在两台 ABR 路由器之间</li>
<li>传送区域不能是一个末梢区域</li>
</ul>
<p>配置命令</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment"># area  area-id  vritual-link  router-id</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<hr>
<h2 id="内网-OSPF"><a href="#内网-OSPF" class="headerlink" title="内网 OSPF"></a>内网 OSPF</h2><p>具体配置需要在网关路由器和三层交换机进行，所有网段均划分到区域0，注意网关路由器连接 Internet 网络的外网接口不参与运行 OSPF 协议</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#router ospf 10</span>
Router-2811-0<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#network 172.16.126.0 0.0.0.3 area 0</span>

Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#router ospf 10</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#network 172.16.2.0 0.0.0.255 area 0</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#network 172.16.3.0 0.0.0.255 area 0</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#network 172.16.4.0 0.0.0.255 area 0</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#network 172.16.5.0 0.0.0.255 area 0</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#network 172.16.126.0 0.0.0.3 area 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此时 router 的 route</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250311105135647.png" alt="image-20250311105135647"></p>
<p>成功学习到内网网段的路由</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250311105237366.png" alt="image-20250311105237366"></p>
<p>内网PC成功ping通路由器，说明实现了总公司内部网络的连通性</p>
<hr>
<h2 id="网络默认路由"><a href="#网络默认路由" class="headerlink" title="网络默认路由"></a>网络默认路由</h2><p>设置路由器在路由表中找不到匹配路由表项时使用的路由</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip route 0.0.0.0 0.0.0.0 23.1.1.254</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#router ospf 10</span>
Router-2811-0<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#default-information originate </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250311110636226.png" alt="image-20250311110636226"></p>
<p>此时三层交换机也学习到了默认路由</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250311112317686.png" alt="image-20250311112317686"></p>
<p>然后把分公司的 OSPF 和默认路由也配置一下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip route 0.0.0.0 0.0.0.0 23.1.2.254</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#router ospf 10</span>
Router-2811-1<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#network 172.16.254.1 0.0.0.0 area 0</span>
Router-2811-1<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#default-information originate </span>

Switch-3560-24PS-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#router ospf 10</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#network 172.16.130.254 0.0.0.0 area 0</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#network 172.16.131.254 0.0.0.0 area 0</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#network 172.16.129.101 0.0.0.0 area 0</span>
Switch-3560-24PS-1<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#network 172.16.254.2 0.0.0.0 area 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250311113246188.png" alt="image-20250311113246188"></p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250311113332373.png" alt="image-20250311113332373"></p>
<hr>
<h1 id="网络地址转换NAT"><a href="#网络地址转换NAT" class="headerlink" title="网络地址转换NAT"></a>网络地址转换NAT</h1><h2 id="基础-4"><a href="#基础-4" class="headerlink" title="基础"></a>基础</h2><h3 id="网络地址转换原理"><a href="#网络地址转换原理" class="headerlink" title="网络地址转换原理"></a>网络地址转换原理</h3><p>实现私有网络访问 Internet 网络</p>
<ul>
<li>内部本地地址：分配给内部网络主机的 IP 地址</li>
<li>内部全局地址：内部网络主机对外部网络用户呈现的 IP 地址</li>
<li>外部本地地址：外部主机在内部网络所使用的 IP 地址</li>
<li>外部全局地址：外部主机在外部网络所使用的 IP 地址</li>
</ul>
<p>分类：</p>
<ul>
<li>静态 NAT：管理员手工配置</li>
<li>动态 NAT</li>
<li>端口地址转换 PAT：内部主机与外部通信时，对数据包的源端口及 IP 地址同时进行转换</li>
</ul>
<hr>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>使用 <code>ip nat</code> 设置总公司路由器的外部接口和内部接口</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int s0/0/0</span>
Router-2811-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip nat outside</span>
Router-2811-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#int f0/0</span>
Router-2811-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip nat inside</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>为 web 服务器 Server-PT-0 配置<strong>静态地址转换</strong>，建立内部本地地址 172.16.2.1 与内部全局地址 23.1.1.2 之间的映射</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip nat inside source static 172.16.2.1 23.1.1.2</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>为其他部门和服务器配置 PAT 转换</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// 定义访问控制列表，拒绝172.16.2.1服务器使用PAT转换
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 1 permit 172.16.4.0 0.0.0.255</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 2 deny host 172.16.2.1</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 2 permit 172.16.2.0 0.0.0.255</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 2 permit 172.16.3.0 0.0.0.255</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 2 permit 172.16.5.0 0.0.0.255</span>

// 定义地址池
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip nat pool XSB 23.1.1.3 23.1.1.100 netmask 255.255.255.0</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip nat pool Other 23.1.1.101 23.1.1.200 netmask 255.255.255.0</span>

Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip nat inside source list 1 pool XSB overload </span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip nat inside source list 2 pool Other overload </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>验证网络地址转换，查看 NAT 的配置：</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325084519674.png" alt="image-20250325084519674"></p>
<p> 验证总公司内部网络与外部网络的连通性：</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325084651809.png" alt="image-20250325084651809"></p>
<p>测试销售部的PC机的PAT转换：</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325084813661.png" alt="image-20250325084813661"></p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325084847465.png" alt="image-20250325084847465"></p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325084948217.png" alt="image-20250325084948217"></p>
<p>分公司同样的操作：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int s0/0/1</span>
Router-2811-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip nat outside</span>
Router-2811-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#int f0/0</span>
Router-2811-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip nat inside</span>
Router-2811-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ex</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 1 permit 172.16.131.0 0.0.0.255</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 2 permit 172.16.130.0 0.0.0.255</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip nat pool XSB 23.1.2.2 23.1.2.100 netmask 255.255.255.0</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip nat pool KFB 23.1.2.101 23.1.2.200 netmask 255.255.255.0</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip nat inside source list 1 pool XSB overload </span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip nat inside source list 2 pool KFB overload </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>验证连通性：</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325090812108.png" alt="image-20250325090812108"></p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325091852631.png" alt="image-20250325091852631"></p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325093410896.png" alt="image-20250325093410896"></p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325093424558.png"></p>
<hr>
<h1 id="配置访问控制列表ACL"><a href="#配置访问控制列表ACL" class="headerlink" title="配置访问控制列表ACL"></a>配置访问控制列表ACL</h1><h2 id="基础-5"><a href="#基础-5" class="headerlink" title="基础"></a>基础</h2><h3 id="ACL"><a href="#ACL" class="headerlink" title="ACL"></a>ACL</h3><p>实质上是一系列对数据包进行分类的条件</p>
<p>路由器或交换机接收到数据包读取其第三层和第四层包头部中的相关信息，根据预先设置好的一组规则对包进行过滤，从而达到访问控制的目的</p>
<p>匹配规则：</p>
<ul>
<li>通常按照 ACL 中各条语句的顺序依次进行匹配</li>
<li>在与某条语句匹配后，则忽略 ACL 中剩余语句的匹配处理</li>
<li>在 ACL 的最后都有一条隐含的 deny any 语句，如果数据包与 ACL 中的所有显式语句都没有匹配上，那么将匹配这条缺省的语句</li>
</ul>
<p>接口的 ACL 分类：</p>
<ul>
<li>入口 ACL：对通过该接口进入路由器或该接口接收到的数据包进行过滤</li>
<li>出口 ACL：对通过该接口离开路由器或该接口转发出去的数据包进行过滤</li>
</ul>
<p>配置注意事项：</p>
<ul>
<li>ACL 对路由器本身产生的数据包不进行过滤</li>
<li>为 ACL 添加新语句时，将会自动添加到整个列表的末尾</li>
<li>因为数据包一旦与某条语句匹配，就不再与其他语句进行匹配，所以需将最严格的语句放在列表顶部，最不严格的放在底部</li>
<li>不能单独删除或修改 ACL 中的任何一条或几条语句，只能删除整个列表</li>
<li>因为隐含的 deny any 存在，可根据需要在 ACL 末尾添加 permit any</li>
<li>每个接口的每个方向只能应用一个 ACL</li>
</ul>
<hr>
<h2 id="总公司部门间互访的权限设置"><a href="#总公司部门间互访的权限设置" class="headerlink" title="总公司部门间互访的权限设置"></a>总公司部门间互访的权限设置</h2><p>配置扩展访问控制列表：</p>
<p>设置规则：</p>
<p>100：允许财务部 172.16.5.0 网段访问财务服务器 172.16.2.2，禁止其他网段访问财务服务器 172.16.2.2，</p>
<p>101：不允许开发部和销售部访问财务部</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 100 remark "Only CWB can access CW_Server:172.16.2.2"</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 100 permit ip 172.16.5.0 0.0.0.255 host 172.16.2.2</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 100 deny ip any host 172.16.2.2</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 100 permit ip any 172.16.2.0 0.0.0.255</span>

Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int vlan 2</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip access-group 100 out </span>

Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 101 remark "KFB and XSB can not access CWB"</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 101 deny ip 172.16.3.0 0.0.0.255 172.16.5.0 0.0.0.255</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 101 deny ip 172.16.4.0 0.0.0.255 172.16.5.0 0.0.0.255</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 101 permit ip any 172.16.5.0 0.0.0.255</span>

Switch-3560-24PS-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int vlan 5</span>
Switch-3560-24PS-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip access-group 101 out</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>验证部门间互访的权限设置：</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325172625683.png" alt="image-20250325172625683"></p>
<p>在开发部PC ping 财务部服务器：</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325172747838.png" alt="image-20250325172747838"></p>
<p>其他服务器正常：</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325172924992.png" alt="image-20250325172924992"></p>
<p>财务部PC ping 财务部服务器：</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325173023132.png" alt="image-20250325173023132"></p>
<p>成功 ping 通</p>
<p>查看 ACL100 对数据包的过滤情况：</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325200045614.png" alt="image-20250325200045614"></p>
<p>可以看到匹配过滤了4次请求，即开发部的 ping 请求</p>
<br>

<p>同样方法测试 ACL101：</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325200519460.png" alt="image-20250325200519460"></p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325200542157.png" alt="image-20250325200542157"></p>
<hr>
<h2 id="配置内部网络对Internet的访问权限"><a href="#配置内部网络对Internet的访问权限" class="headerlink" title="配置内部网络对Internet的访问权限"></a>配置内部网络对Internet的访问权限</h2><p>限制内部网络向外部网络发送数据包，所以将访问控制列表应用在路由器的 f0&#x2F;0 口的 in 方向</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 102 remark "CWB can access WWW and FTP only"</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 102 permit tcp 172.16.5.0 0.0.0.255 any eq www</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 102 permit tcp 172.16.5.0 0.0.0.255 any eq FTP</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 102 deny ip 172.16.5.0 0.0.0.255 any</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 102 permit ip any any</span>

Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int f0/0</span>
Router-2811-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip access-group 102 in</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>验证：</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325201502075.png" alt="image-20250325201502075"></p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325201838233.png" alt="image-20250325201838233"></p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325201921062.png" alt="image-20250325201921062"></p>
<p>可以看到财务部PC可以访问 Internet 中的 WWW 服务和 FTP 服务，但是无法 ping 通</p>
<p>查看 ACL102 对数据包的过滤情况：</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250325202054956.png" alt="image-20250325202054956"></p>
<hr>
<h2 id="内部网络安全设计的配置"><a href="#内部网络安全设计的配置" class="headerlink" title="内部网络安全设计的配置"></a>内部网络安全设计的配置</h2><p>对外部网络进入内部网络的数据包进行过滤，配置 ACL103 在路由器 S0&#x2F;0&#x2F;0 接口的 in 方向上</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// 不允许网络ping内部网络任何节点
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 deny icmp any any echo</span>
// 限制端口
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 deny tcp any any eq 135</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 deny tcp any any eq 139</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 deny tcp any any eq 445</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 deny udp any any eq 445</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 deny tcp any any eq 69</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 deny tcp any any eq 4444</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 deny udp any any eq 4444</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 deny tcp any any eq 3389</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 deny udp any any eq 3389</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 deny tcp any any eq 1433</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 deny udp any any eq 1433</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 deny tcp any any eq 1434</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 deny udp any any eq 1434</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 103 permit ip any any</span>
// 将ACL103应用到S0/0/0接口的in方向
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int s0/0/0</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip access-group 103 in</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<hr>
<h1 id="配置虚拟专用网VPN"><a href="#配置虚拟专用网VPN" class="headerlink" title="配置虚拟专用网VPN"></a>配置虚拟专用网VPN</h1><h2 id="基础-6"><a href="#基础-6" class="headerlink" title="基础"></a>基础</h2><h3 id="VPN"><a href="#VPN" class="headerlink" title="VPN"></a>VPN</h3><p>协议分类：</p>
<ul>
<li>PPTP&#x2F;L2TP：适用于客户端远程访问虚拟专用网</li>
<li>IPSec：适用于可信网关到网关之间的虚拟专用网</li>
<li>MPLS VPN：适用于 ISP 直接向 VPN 客户提供专线 VPN 的服务</li>
</ul>
<p>应用分类：</p>
<ul>
<li>Access VPN</li>
<li>Intranet VPN</li>
<li>Extranet VPN</li>
</ul>
<p>设备类型分类：</p>
<ul>
<li>路由器式 VPN</li>
<li>交换机式 VPN</li>
<li>防火墙式 VPN</li>
</ul>
<h3 id="IPSec"><a href="#IPSec" class="headerlink" title="IPSec"></a>IPSec</h3><p>使用哈希算法实现数据的完整性验证</p>
<p>通过对称加密算法保证数据的私密性</p>
<p>安全协议：</p>
<ul>
<li>AH 协议</li>
<li>ESP 协议</li>
</ul>
<hr>
<h2 id="路由器配置-1"><a href="#路由器配置-1" class="headerlink" title="路由器配置"></a>路由器配置</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// 配置 IKE 策略集
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#crypto isakmp policy 10</span>
Router-2811-0<span class="token punctuation">(</span>config-isakmp<span class="token punctuation">)</span><span class="token comment">#encryption 3des</span>
Router-2811-0<span class="token punctuation">(</span>config-isakmp<span class="token punctuation">)</span><span class="token comment">#hash md5</span>
Router-2811-0<span class="token punctuation">(</span>config-isakmp<span class="token punctuation">)</span><span class="token comment">#group 2</span>
Router-2811-0<span class="token punctuation">(</span>config-isakmp<span class="token punctuation">)</span><span class="token comment">#authentication pre-share</span>
Router-2811-0<span class="token punctuation">(</span>config-isakmp<span class="token punctuation">)</span><span class="token comment">#lifetime 3600</span>
// 配置身份认证的共享密钥
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#crypto isakmp key password123 address 23.1.2.1</span>
// 配置 IPSec 变换集
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#crypto ipsec transform-set Core_to_Sub esp-3des esp-md5</span>
// 配置 ACL，确定需要保护的流量
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 172 permit ip 172.16.0.0 0.0.127.255 172.16.128.0 0.0.127.255</span>
// 配置 crypto map
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#crypto map to_Sub 172 ipsec-isakmp </span>
Router-2811-0<span class="token punctuation">(</span>config-crypto-map<span class="token punctuation">)</span><span class="token comment">#set peer 23.1.2.1</span>
Router-2811-0<span class="token punctuation">(</span>config-crypto-map<span class="token punctuation">)</span><span class="token comment">#set transform-set Core_to_Sub</span>
Router-2811-0<span class="token punctuation">(</span>config-crypto-map<span class="token punctuation">)</span><span class="token comment">#match address 172</span>
// 将 map 应用到出口 s0/0/0
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int s0/0/0</span>
Router-2811-0<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#crypto map to_Sub</span>

// 同理配置分公司
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#crypto isakmp policy 10</span>
Router-2811-1<span class="token punctuation">(</span>config-isakmp<span class="token punctuation">)</span><span class="token comment">#encryption 3des</span>
Router-2811-1<span class="token punctuation">(</span>config-isakmp<span class="token punctuation">)</span><span class="token comment">#hash md5</span>
Router-2811-1<span class="token punctuation">(</span>config-isakmp<span class="token punctuation">)</span><span class="token comment">#authentication pre-share </span>
Router-2811-1<span class="token punctuation">(</span>config-isakmp<span class="token punctuation">)</span><span class="token comment">#group 2</span>
Router-2811-1<span class="token punctuation">(</span>config-isakmp<span class="token punctuation">)</span><span class="token comment">#lifetime 3600</span>
Router-2811-1<span class="token punctuation">(</span>config-isakmp<span class="token punctuation">)</span><span class="token comment">#ex</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#crypto isakmp key password123 address 23.1.1.1</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#crypto ipsec transform-set Sub_to_Core esp-3des esp-md5-hmac</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 172 permit ip 172.16.128.0 0.0.127.255 172.16.0.0 0.0.127.255</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#crypto map to_Core 172 ipsec-isakmp </span>
Router-2811-1<span class="token punctuation">(</span>config-crypto-map<span class="token punctuation">)</span><span class="token comment">#set peer 23.1.1.1</span>
Router-2811-1<span class="token punctuation">(</span>config-crypto-map<span class="token punctuation">)</span><span class="token comment">#set transform-set Sub_to_Core</span>
Router-2811-1<span class="token punctuation">(</span>config-crypto-map<span class="token punctuation">)</span><span class="token comment">#match address 172</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int s0/0/1</span>
Router-2811-1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#crypto map to_Core</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="NAT流量豁免"><a href="#NAT流量豁免" class="headerlink" title="NAT流量豁免"></a>NAT流量豁免</h2><p>测试总公司与分公司之间的连通性</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250424002643781.png" alt="image-20250424002643781"></p>
<p>开启 debug</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250424105406404.png" alt="image-20250424105406404"></p>
<p>由此可见，172.16.3.1 被转换为公网 IP 地址23.1.1.3，也就是 PC 机 172.16.3.1 发送给分公司 PC 机 172.16.130.1 的流量并未经 IPSec VPN 通道发送，而是通过 NAT 转换之后进入公网，而目标 IP 地址是私有 IP 地址，公网中的路由器无法完成转发</p>
<p>由于上述原因，在网络中同时配置 NAT 和 IPSec VPN 时，需要在 NAT 关联的 ACL 中删除需要 IPSec VPN 保护的流量，即私网到私网的流量，这样才能保证这些流量不会经 NAT 进行地址转换后进入公网，而是经 IPSec VPN 重新封装后进入公网</p>
<p>删除原来的 NAPT 及与之关联的 ACL：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#no ip nat inside source list 1 pool XSB overload</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#no ip nat inside source list 2 pool Other overload</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#no access-list 1</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#no access-list 2</span>
// 配置豁免了 IPSec VPN 保护流量的 ACL
// ACL140 替代原来的 ACL <span class="token number">1</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 140 deny ip 172.16.0.0 0.0.127.255 172.16.128.0 0.0.127.255</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 140 permit ip 172.16.4.0 0.0.0.255 any</span>
// ACL150 替代原来的 ACL <span class="token number">2</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 150 deny ip 172.16.0.0 0.0.127.255 172.16.128.0 0.0.127.255</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 150 deny ip host 172.16.2.1 any</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 150 permit ip 172.16.2.0 0.0.0.255 any</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 150 permit ip 172.16.3.0 0.0.0.255 any</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 150 permit ip 172.16.5.0 0.0.0.255 any</span>
// 建立 ACL 与 Pool 之间的关联
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip nat inside source list 140 pool XSB overload</span>
Router-2811-0<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip nat inside source list 150 pool Other overload</span>


// 分公司同理
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#no ip nat inside source list 1 pool XSB overload</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#no ip nat inside source list 2 pool KFB overload</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#no access-list 1</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#no access-list 2</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 130 deny ip 172.16.128.0 0.0.127.255 172.16.0.0 0.0.127.255</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 130 permit ip 172.16.130.0 0.0.0.255 any</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 131 deny ip 172.16.128.0 0.0.127.255 172.16.0.0 0.0.127.255</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#access-list 131 permit ip 172.16.131.0 0.0.0.255 any</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip nat inside source list 130 pool KFB overload</span>
Router-2811-1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip nat inside source list 131 pool XSB overload</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此时总公司与分公司可以正常通信</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250424200454832.png" alt="image-20250424200454832"></p>
<p>测试内部网络与外部网络通信的情况</p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250424200732405.png" alt="image-20250424200732405"></p>
<p><img src="/blog/2025/02/18/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%AE%AD/image-20250424200709775.png" alt="image-20250424200709775"></p>
<p>可见经过 NAT 配置的修改，IPSec VPN 和 NAT 可同时正常工作</p>

    </div>
    
    
    
    
    
    
    
</div>

            </div>
        </transition>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/blog/js/main.js"></script>
    
    




    
    

<div id="vcomments"></div>

<script src="/blog/js/lib/valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        app_id: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
        app_key: 'SzWOnY0PWLGNuL6jW8TZYc7j',
        visitor: 'true',
        placeholder: '写点什么吧(●ˇ∀ˇ●)',
        serverURLs: 'https://u9mzlkun.lc-cn-n1-shared.com',
    });
</script>

    <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>