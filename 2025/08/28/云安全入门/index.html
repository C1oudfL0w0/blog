
<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <title>云安全入门 | 雲流のLowest World</title>
  <meta name="author" content="C1oudfL0w0" />
  <meta name="description" content="" />
  <meta name="keywords" content="" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
  <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
  <!-- cdn挂掉的时候要可以引用本地 -->
<!-- <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script> -->
<script src="/blog/js/vue.global.prod.min.js"></script>


<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />


<link rel="stylesheet" href="/blog/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<link rel="stylesheet" href="/blog/css/search.css" />
<script> const mixins = {}; </script>


<!--改成了prismjs高亮-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- 引入不蒜子-->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script type="text/javascript" src="/blog/js/lib/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/blog/js/lib/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<!-- 引入clipboard -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

<script type="text/javascript" src="/blog/js/lib/codeBlock/codeCopy.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/blog/js/lib/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="雲流のLowest World" type="application/atom+xml">
</head>

<body>
  <!--flag{never_g0nna g1ve_you up}-->

  <!-- 页面点击特效 -->
  <script type="text/javascript" src="/blog/js/love-click.js"></script>

  <!-- 浏览器标题 -->
  <script async type="text/javascript" src="/blog/js/FunnyTitle.js"></script>

  <!-- 动态背景 -->
  

  <!--文章目录-->
  
    <div id="toc" class="toc-article">
    <h3><i class="fas fa-stream"></i>  目录</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91%E8%AE%A1%E7%AE%97%E6%A6%82%E5%BF%B5"><span class="toc-number">2.</span> <span class="toc-text">云计算概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.</span> <span class="toc-text">模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">2.2.</span> <span class="toc-text">分类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E9%9D%A2"><span class="toc-number">3.</span> <span class="toc-text">攻击面</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AC%E6%9C%89%E4%BA%91"><span class="toc-number">3.1.</span> <span class="toc-text">公有云</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%81%E6%9C%89%E4%BA%91"><span class="toc-number">3.2.</span> <span class="toc-text">私有云</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AWS"><span class="toc-number">4.</span> <span class="toc-text">AWS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#LocalStack-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E7%8E%AF%E5%A2%83"><span class="toc-number">4.1.</span> <span class="toc-text">LocalStack 搭建本地环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#S3-%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8"><span class="toc-number">4.2.</span> <span class="toc-text">S3 对象存储</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">4.2.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bucket-Policy-%E5%9F%BA%E7%A1%80%E7%BB%93%E6%9E%84"><span class="toc-number">4.2.2.</span> <span class="toc-text">Bucket Policy 基础结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aws-cli-%E6%93%8D%E4%BD%9C"><span class="toc-number">4.2.3.</span> <span class="toc-text">aws-cli 操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E6%A1%B6"><span class="toc-number">4.2.3.1.</span> <span class="toc-text">创建存储桶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#s3api-%E5%AD%98%E5%82%A8%E6%A1%B6%E7%AD%96%E7%95%A5%E6%93%8D%E4%BD%9C"><span class="toc-number">4.2.3.2.</span> <span class="toc-text">s3api 存储桶策略操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E6%A1%B6%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">4.2.3.3.</span> <span class="toc-text">存储桶文件操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webapi-%E6%A3%80%E7%B4%A2"><span class="toc-number">4.2.4.</span> <span class="toc-text">webapi 检索</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQS-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-number">4.3.</span> <span class="toc-text">SQS 消息队列</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A0%87%E5%87%86%E9%98%9F%E5%88%97"><span class="toc-number">4.3.1.</span> <span class="toc-text">创建标准队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E5%87%BA%E9%98%9F%E5%88%97"><span class="toc-number">4.3.2.</span> <span class="toc-text">列出队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E6%B6%88%E6%81%AF"><span class="toc-number">4.3.3.</span> <span class="toc-text">发布消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF"><span class="toc-number">4.3.4.</span> <span class="toc-text">接收消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%B6%88%E6%81%AF"><span class="toc-number">4.3.5.</span> <span class="toc-text">删除消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%98%9F%E5%88%97"><span class="toc-number">4.3.6.</span> <span class="toc-text">删除队列</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SNS"><span class="toc-number">4.4.</span> <span class="toc-text">SNS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cognito"><span class="toc-number">4.5.</span> <span class="toc-text">Cognito</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sts"><span class="toc-number">4.5.1.</span> <span class="toc-text">sts</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#assume-role-with-web-identity"><span class="toc-number">4.5.1.1.</span> <span class="toc-text">assume-role-with-web-identity</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>
    <script>
    (function () {
        function initTocHighlight() {
            var tocLinks = document.querySelectorAll('#toc .toc-link');
            if (!tocLinks.length) return;

            // 收集所有标题锚点对应的 DOM 元素
            var headings = [];
            tocLinks.forEach(function (link) {
                var href = link.getAttribute('href');
                if (!href) return;
                var id = decodeURIComponent(href.slice(1));
                var el = document.getElementById(id);
                if (el) headings.push({ el: el, link: link });
            });
            if (!headings.length) return;

            var activeLink = null;
            var offset = 80;

            function highlight() {
                var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                var current = null;

                for (var i = 0; i < headings.length; i++) {
                    if (headings[i].el.getBoundingClientRect().top <= offset + 10) {
                        current = headings[i];
                    }
                }

                // 仅在用户确实滚动过、且到达页面底部时，才强制高亮最后一个
                if (scrollTop > 100 && window.innerHeight + scrollTop >= document.documentElement.scrollHeight - 50) {
                    current = headings[headings.length - 1];
                }

                // 页面顶部且没有标题进入视口时，高亮第一个
                if (scrollTop == 0) {
                    current = headings[0];
                }

                if (current && current.link !== activeLink) {
                    // 清除所有高亮
                    tocLinks.forEach(function (link) {
                        link.classList.remove('toc-active');
                    });

                    // 高亮当前项
                    current.link.classList.add('toc-active');
                    activeLink = current.link;

                    // TOC 容器自动滚动，使当前项可见
                    var tocEl = document.getElementById('toc');
                    var linkRect = activeLink.getBoundingClientRect();
                    var tocRect = tocEl.getBoundingClientRect();
                    if (linkRect.top < tocRect.top || linkRect.bottom > tocRect.bottom) {
                        activeLink.scrollIntoView({ block: 'center', behavior: 'smooth' });
                    }
                } else if (!current && activeLink) {
                    tocLinks.forEach(function (link) {
                        link.classList.remove('toc-active');
                    });
                    activeLink = null;
                }
            }

            var ticking = false;
            window.addEventListener('scroll', function () {
                if (!ticking) {
                    requestAnimationFrame(function () {
                        highlight();
                        ticking = false;
                    });
                    ticking = true;
                }
            });

            // 初始高亮
            highlight();
        }

        // 等待页面完全加载后再初始化（确保文章标题 DOM 已渲染）
        if (document.readyState === 'complete') {
            initTocHighlight();
        } else {
            window.addEventListener('load', initTocHighlight);
        }
    })();
    </script>
  

  <!--返回顶部-->
  <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
    <a title="返回顶部">↑</a>
  </div>
  <script src="/blog/js/totop.js"></script>

  <div id="layout">
    
    <div id="content-background" ref="contentBackground" data-images="https://pic.imgdb.cn/item/65d61d809f345e8d03b8bc7a.png"></div>
    
    <transition name="fade">
      <div id="loading" v-show="loading">
        <div id="loading-circle">
          <h2>LOADING</h2>
          <p>第一次加载文章图片可能会花费较长时间</p>
          <p>要不挂个梯子试试？（x</p>
          <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
          <img src="/blog/images/loading.gif" />
        </div>
      </div>
    </transition>
    <transition name="into">
      <div id="main" v-show="!loading">
        <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
        <a href="/blog/search">
            <i class="fa-solid fa-search fa-fw"></i>
            <span>&ensp;Search</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
            <a href="/blog/search">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-search fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Search</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

        <div class="article">
    <div>
        <h1>云安全入门</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/8/28
        </span>
        
        <span class="category">
            <a href="/blog/categories/Web/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Web
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/%E4%BA%91%E5%AE%89%E5%85%A8/" style="color: #00a596">云安全</a>
            </span>
            
        </span>
        
        <!--文章字数统计-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <!-- 安装插件npm install hexo-wordcount --save -->
        <span class="post-count">4.9k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">21分</span>
      </span>
    </span>
    
    <!--不蒜子统计访问数-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    总文章阅读量：<span id="busuanzi_value_page_pv"></span>次
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://wiki.teamssix.com/CloudService/">https://wiki.teamssix.com/CloudService/</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/bfengj/Cloud-Security?tab=readme-ov-file">https://github.com/bfengj/Cloud-Security?tab=readme-ov-file</a></p>
<p><a target="_blank" rel="noopener" href="https://lzcloudsecurity.gitbook.io/yun-an-quan-gong-fang-ru-men/">https://lzcloudsecurity.gitbook.io/yun-an-quan-gong-fang-ru-men/</a></p>
<span id="more"></span>

<hr>
<h1 id="云计算概念"><a href="#云计算概念" class="headerlink" title="云计算概念"></a>云计算概念</h1><p>云计算是一种计算模型，它提供了一种通过互联网远程使用共享计算资源的方式。这些计算资源包括计算机处理能力、存储空间、数据库和软件等。这样，用户就可以在需要时随时随地获取这些资源，而不用自己拥有和维护这些硬件和软件。</p>
<h2 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h2><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250828092948551.png"></p>
<ul>
<li>IaaS (Infrastructure-as-a-Service)：基础设施即服务。这种模式提供了基础设施层的服务，如虚拟机、存储、网络等，用户可以根据需要自己搭建和管理系统。</li>
<li>PaaS (Platform-as-a-Service)：平台即服务。这种模式提供了平台层的服务，如数据库、编程框架等，用户可以在这个平台上开发和部署自己的应用程序。</li>
<li>SaaS (Software-as-a-Service)：软件即服务。这种模式提供了应用层的服务，如电子邮件、协作工具等，用户可以直接使用这些软件。优点是减少安装、减少的繁琐升级操作、统一管理。</li>
</ul>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><ul>
<li>公有云：公有云是由云服务提供商提供的服务，可以由多个客户共享。常见的公有云服务包括亚马逊云（AWS）、谷歌云（GCP）、微软云（Azure）等。公有云通常提供自动化、弹性和可伸缩性，适用于应用程序和数据的开发和部署。</li>
<li>私有云：私有云是由单个组织拥有和管理的云服务，只能由该组织的员工使用。私有云常用于保护敏感数据和满足特殊需求。私有云提供了更高的安全性和控制性，适用于数据中心的迁移和现有应用程序的升级。</li>
<li>混合云：混合云是私有云和公有云的结合。它允许组织在公有云和私有云之间进行数据和应用程序的流动。混合云可以提供最佳的安全性和灵活性，适用于多种业务场景。</li>
</ul>
<p>建立云环境时会用到虚拟化（KVM、Vmware）和容器化（K8S、Docker）技术</p>
<hr>
<h1 id="攻击面"><a href="#攻击面" class="headerlink" title="攻击面"></a>攻击面</h1><h2 id="公有云"><a href="#公有云" class="headerlink" title="公有云"></a>公有云</h2><p>需要先了解对应公有云的文档：</p>
<p>AWS：<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/">https://docs.aws.amazon.com/</a><br>GCP：<a target="_blank" rel="noopener" href="https://cloud.google.com/docs?hl=zh-cn">https://cloud.google.com/docs?hl=zh-cn</a><br>Azure：<a target="_blank" rel="noopener" href="https://azure.microsoft.com/zh-cn/">https://azure.microsoft.com/zh-cn/</a><br>阿里云：<a target="_blank" rel="noopener" href="https://help.aliyun.com/">https://help.aliyun.com/</a><br>腾讯云：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/api">https://cloud.tencent.com/document/api</a></p>
<p>攻击主要分为两类：</p>
<p>针对租户的攻击：对于在云上的目标，依然存在常见的Web漏洞，SQL注入、弱口令、文件上传、SSRF，除此之外上云还出现了新的攻击方式，例如：AccessKey泄露接管服务器、存储桶配置不当、传统漏洞结合云特性获取实例元数据。</p>
<p>针对云平台的攻击：</p>
<ol>
<li>云产品进行文件处理属性时引发漏洞</li>
<li>攻击中间件</li>
<li>数据库产品配置</li>
<li>开源产品已知问题</li>
<li>虚拟化逃逸</li>
</ol>
<h2 id="私有云"><a href="#私有云" class="headerlink" title="私有云"></a>私有云</h2><p>除了公有云的攻击点以外，还有：</p>
<ol>
<li>私有云缺乏有效隔离，可横向攻击</li>
<li>使用的开源组件列表漏洞</li>
<li>虚拟化逃逸取得宿主机控制权</li>
<li>常规应用漏洞（Shiro、Fastjson 等…）</li>
</ol>
<p>虚拟化</p>
<p>云原生</p>
<hr>
<h1 id="AWS"><a href="#AWS" class="headerlink" title="AWS"></a>AWS</h1><blockquote>
<p>全称 Amazon web service (亚马逊网络服务)，是亚马逊公司旗下云计算服务平台，为全世界各个国家和地区的客户提供一整套基础设施和云解决方案。</p>
</blockquote>
<p>以 AWS 为例，具有如下云服务（各个厂商叫法可能有所区别）：</p>
<ul>
<li><p>S3：对象存储 Simple Storage Service，简单的说就是一个类似网盘的东西，当然跟网盘是有一定区别的。</p>
</li>
<li><p>EC2：弹性计算服务 Elastic Compute Cloud，简单的说就是在云上的一台虚拟机。</p>
</li>
<li><p>RDS：云数据库 Relational Database Service，简单的说就是云上的一个数据库。</p>
</li>
<li><p>IAM：身份和访问管理 Identity and Access Management，简单的说就是云控制台上的一套身份管理服务，可以用来管理每个子账号的权限。</p>
</li>
</ul>
<p>从存储来说，AWS 提供了 S3 作为对象存储工具，可以帮助我们存储大量的数据，并且 S3 可以被 AWS 的其他服务所访问</p>
<p>从服务器资源来说，AWS 提供了 EC2 作为虚拟化的云服务器，提供各种类型的主机，如计算型、通用型、内存计算型、GPU 计算型，等等来满足业务对服务器的需要</p>
<p>在数据库方面，AWS 提供了如 RDS（包含 Mysql、MariaDB、Postgresql）作为关系型存储以及分布式大型关系型数据库 Aurora，同时提供了多种 Nosql 数据库，如 DynamoDB 等，以及数仓如 RedShift</p>
<hr>
<h2 id="LocalStack-搭建本地环境"><a href="#LocalStack-搭建本地环境" class="headerlink" title="LocalStack 搭建本地环境"></a>LocalStack 搭建本地环境</h2><p>总之是一个能在本地起云服务环境的工具</p>
<p><a target="_blank" rel="noopener" href="https://docs.localstack.cloud/aws/getting-started/installation/">https://docs.localstack.cloud/aws/getting-started/installation/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/container/409775.html">https://www.freebuf.com/articles/container/409775.html</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7116453600338903048">https://juejin.cn/post/7116453600338903048</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/mzl87/article/details/140460913">https://blog.csdn.net/mzl87/article/details/140460913</a></p>
<p>这里用 docker compose 起了</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">localstack</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> <span class="token string">"$&#123;LOCALSTACK_DOCKER_NAME:-localstack-main&#125;"</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> localstack/localstack
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"127.0.0.1:4566:4566"</span>            <span class="token comment"># LocalStack Gateway</span>
      <span class="token punctuation">-</span> <span class="token string">"127.0.0.1:4510-4559:4510-4559"</span>  <span class="token comment"># external services port range</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token comment"># LocalStack configuration: https://docs.localstack.cloud/references/configuration/</span>
      <span class="token punctuation">-</span> DEBUG=$<span class="token punctuation">&#123;</span>DEBUG<span class="token punctuation">:</span><span class="token number">-0</span><span class="token punctuation">&#125;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"$&#123;LOCALSTACK_VOLUME_DIR:-./volume&#125;:/var/lib/localstack"</span>
      <span class="token punctuation">-</span> <span class="token string">"/var/run/docker.sock:/var/run/docker.sock"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> compose up<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>进入容器，安装 aws-cli，具体安装版本见： <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/getting-started-install.html">https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/getting-started-install.html</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token string">"https://awscli.amazonaws.com/awscli-exe-linux-aarch64.zip"</span> <span class="token parameter variable">-o</span> <span class="token string">"awscliv2.zip"</span>
<span class="token function">unzip</span> awscliv2.zip
./aws/install
<span class="token comment"># 我这里是root用户所以直接安装</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250828152625536.png"></p>
<p>配置 aws-cli，这里 ak 和 sk 都直接填 <code>test</code> 了，区域填 <code>us-east-1</code>，格式填 <code>json</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws configure<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后去 ~&#x2F;.aws&#x2F;config 下添加一个端点 url，指向本地搭建的 LocalStack 服务，这样后面就不用加 endpoint_url 参数了</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">default</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">region</span> <span class="token punctuation">=</span> <span class="token value attr-value">us-east-1</span>
<span class="token key attr-name">output</span> <span class="token punctuation">=</span> <span class="token value attr-value">json</span>
<span class="token key attr-name">endpoint_url</span> <span class="token punctuation">=</span> <span class="token value attr-value">http://172.18.0.2:4566</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<hr>
<h2 id="S3-对象存储"><a href="#S3-对象存储" class="headerlink" title="S3 对象存储"></a>S3 对象存储</h2><p>对象存储（Object-Based Storage），也可以叫做面向对象的存储，现在也有不少厂商直接把它叫做云存储。</p>
<p>Amazon S3 (Simple Storage Service) 简单存储服务，是 Amazon 的公开云存储服务，与之对应的协议被称为 S3 协议，目前 S3 协议已经被视为公认的行业标准协议，因此目前国内主流的对象存储厂商基本上都会支持 S3 协议。</p>
<p>在 Amazon S3 标准下中，对象存储中可以有多个桶（Bucket），然后把对象（Object）放在桶里，对象又包含了三个部分：<code>Key</code>、<code>Data</code> 和 <code>Metadata</code></p>
<p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250828100454222.png"></p>
<ul>
<li><p><code>Key</code> 是指存储桶中的唯一标识符，例如一个 URL 为：<code>https://teamssix.s3.ap-northeast-2.amazonaws.com/flag</code>，这里的 teamssix 是存储桶 Bucket 的名称，&#x2F;flag 就是 Key</p>
</li>
<li><p><code>Data</code> 就很容易理解，就是存储的数据本体</p>
</li>
<li><p><code>Metadata</code> 即元数据，可以简单的理解成数据的标签、描述之类的信息，这点不同于传统的文件存储，在传统的文件存储中这类信息是直接封装在文件里的，有了元数据的存在，可以大大的加快对象的排序、分类和查找。</p>
</li>
</ul>
<p>操作 S3 的方式：</p>
<ul>
<li>AWS 控制台</li>
<li>AWS-cli</li>
<li>AWS SDK</li>
<li>REST API</li>
</ul>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>Bucket：存储桶，默认不公开</p>
<p>特点：</p>
<ul>
<li>命名需全球唯一。每个帐号默认可建 100 个，可申请至最多 1000 个</li>
<li>创建者的拥有权不可转让，也不可以从一个 Region 转去别的 Region</li>
<li>没有对象存储数量限制<br></li>
</ul>
<p>Object：Bucket 里面每一个存储的数据就是对象，由对象名（键），和数据（值）组成</p>
<p>对象的键（Key）可以很长，甚至按照一定前缀格式来指定，从而模拟文件夹的层级结构，比如 Photo&#x2F;Family&#x2F;2020-01-25-new-year&#x2F;altogether.jpg</p>
<p>每一个对象其实还包含一些元信息（Meta-data），包括系统指定的文件类型，创建时间，加密算法等，和用户上传时指定的元信息。元信息在对象创建后都无法更改。</p>
<p>我们也可以为对象指定最多 10 个标签（Tag），标签的键和值的最大长度是 128 和 256 个字符。这个标签和元信息有什么不同呢？标签是可以修改和新增的。它最大的好处，是可以结合权限控制，生命周期管理，和数据分析等使用。</p>
<p>单个文件上传最大是 5GB。超过的话，需要使用 multipart upload API。最大支持 5TB。<br><br></p>
<p>一致性特性：</p>
<ul>
<li>没有锁的功能。如果同时（几乎）发起两个更新对象的 PUT 请求，键相同，那么，以到达 S 3 时间先后处理更新。</li>
<li>不同对象的更新，没法做到原子操作。</li>
<li>对全新的对象来说，它是 Read-after-Write Consistency 的。也就是写了之后马上读，肯定就是你刚才上传的数据。</li>
<li>如果你要更新数据，那就变成 Eventual Consistency 了。也就是说，更新后马上读，可能是旧的数据，也可能是新的。</li>
</ul>
<p>如果你先调用 GET 请求访问一个不存在的资源，S3 告诉你它不存在。然后你马上上传数据，再调用一个 GET，这时候是有可能仍然请求不到的<br><br><br>版本控制：一经启用无法暂停</p>
<hr>
<h3 id="Bucket-Policy-基础结构"><a href="#Bucket-Policy-基础结构" class="headerlink" title="Bucket Policy 基础结构"></a>Bucket Policy 基础结构</h3><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"Version"</span><span class="token operator">:</span><span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>          <span class="token comment">// 必须，当前固定</span>
  <span class="token property">"Statement"</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"Sid"</span><span class="token operator">:</span><span class="token string">"可选唯一标识符"</span><span class="token punctuation">,</span>
      <span class="token property">"Effect"</span><span class="token operator">:</span><span class="token string">"Allow"</span>|<span class="token string">"Deny"</span><span class="token punctuation">,</span>
      <span class="token property">"Principal"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token property">"AWS"</span><span class="token operator">:</span><span class="token string">"arn:aws:iam::&lt;AWS_ACCOUNT_ID>:root"</span>          <span class="token comment">// 或者 &#123;"AWS":["arn1","arn2"]&#125; 等</span>
        <span class="token comment">// 也可以是 "*"（匿名）或 "Service":"s3.amazonaws.com"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"Action"</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token string">"s3:GetObject"</span><span class="token punctuation">,</span>
        <span class="token string">"s3:PutObject"</span><span class="token punctuation">,</span>
        <span class="token string">"s3:DeleteObject"</span><span class="token punctuation">,</span>
        <span class="token string">"s3:ListBucket"</span><span class="token punctuation">,</span>
        <span class="token string">"s3:ListBucketMultipartUploads"</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"Resource"</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token string">"arn:aws:s3:::bucket-name"</span><span class="token punctuation">,</span>                      <span class="token comment">// bucket 本身</span>
        <span class="token string">"arn:aws:s3:::bucket-name/*"</span>                    <span class="token comment">// bucket 下所有对象</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"Condition"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>                                    <span class="token comment">// 可选字段</span>
        <span class="token property">"StringEquals"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token property">"s3:x-amz-server-side-encryption"</span><span class="token operator">:</span><span class="token string">"AES256"</span> <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    ...                                            <span class="token comment">// 也可以添加 Deny 语句或多条 Allow</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<table>
<thead>
<tr>
<th>字段</th>
<th>作用</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td><code>Version</code></td>
<td>策略语法版本</td>
<td>固定为 <code>2012-10-17</code></td>
</tr>
<tr>
<td><code>Statement</code></td>
<td>权限声明列表</td>
<td>至少一条</td>
</tr>
<tr>
<td><code>Sid</code></td>
<td>语句 ID</td>
<td>可选，主要用于日志跟踪&#x2F;排查</td>
</tr>
<tr>
<td><code>Effect</code></td>
<td>结果</td>
<td><code>Allow</code> 或 <code>Deny</code></td>
</tr>
<tr>
<td><code>Principal</code></td>
<td>主体</td>
<td><code>AWS</code>、<code>Federated</code>、<code>Service</code>，或 <code>&quot;*&quot;</code>（所有人）</td>
</tr>
<tr>
<td><code>Action</code></td>
<td>可执行接口</td>
<td><code>s3:*</code>（全部）或细粒度如 <code>s3:GetObject</code> 等</td>
</tr>
<tr>
<td><code>Resource</code></td>
<td>资源 ARN</td>
<td>Bucket 或对象范围</td>
</tr>
<tr>
<td><code>Condition</code></td>
<td>进一步限制</td>
<td>基于 IP、时间、加密方式等</td>
</tr>
</tbody></table>
<hr>
<h3 id="aws-cli-操作"><a href="#aws-cli-操作" class="headerlink" title="aws-cli 操作"></a>aws-cli 操作</h3><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli_s3_code_examples.html">https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli_s3_code_examples.html</a></p>
<p>部分操作 s3 和 s3api 都有对应的命令</p>
<h4 id="创建存储桶"><a href="#创建存储桶" class="headerlink" title="创建存储桶"></a>创建存储桶</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3 mb s3://amzn-s3-demo-bucket<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3api create-bucket <span class="token punctuation">\</span>
    <span class="token parameter variable">--bucket</span> amzn-s3-demo-bucket <span class="token punctuation">\</span>
    <span class="token parameter variable">--region</span> us-east-1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250829144508356.png"></p>
<h4 id="s3api-存储桶策略操作"><a href="#s3api-存储桶策略操作" class="headerlink" title="s3api 存储桶策略操作"></a>s3api 存储桶策略操作</h4><p>写入存储桶策略：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3api put-bucket-policy <span class="token parameter variable">--bucket</span> amzn-s3-demo-bucket <span class="token parameter variable">--policy</span> file://policy.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>policy.json：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
   <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
         <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
         <span class="token property">"Principal"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>
         <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"s3:GetObject"</span><span class="token punctuation">,</span>
         <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:aws:s3:::amzn-s3-demo-bucket/*"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
         <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Deny"</span><span class="token punctuation">,</span>
         <span class="token property">"Principal"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>
         <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"s3:GetObject"</span><span class="token punctuation">,</span>
         <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:aws:s3:::amzn-s3-demo-bucket/MySecretFolder/*"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
         <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
         <span class="token property">"Principal"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"AWS"</span><span class="token operator">:</span> <span class="token string">"arn:aws:iam::123456789012:root"</span>
         <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
         <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"s3:DeleteObject"</span><span class="token punctuation">,</span>
            <span class="token string">"s3:PutObject"</span>
         <span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:aws:s3:::amzn-s3-demo-bucket/*"</span>
      <span class="token punctuation">&#125;</span>
   <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>读取存储桶策略：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3api get-bucket-policy <span class="token parameter variable">--bucket</span> amzn-s3-demo-bucket<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250829145855902.png"></p>
<h4 id="存储桶文件操作"><a href="#存储桶文件操作" class="headerlink" title="存储桶文件操作"></a>存储桶文件操作</h4><p>复制本地文件到 s3：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3 <span class="token function">cp</span> /tmp/test.txt s3://amzn-s3-demo-bucket/test2.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250829144810414.png"></p>
<p>直接移动文件到 s3：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3 <span class="token function">mv</span> test.txt s3://amzn-s3-demo-bucket/test2.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>列出 s3 下的存储桶</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3 <span class="token function">ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>列出存储桶中的所有前缀和对象：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3 <span class="token function">ls</span> s3://amzn-s3-demo-bucket<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>可用 <code>--recursive</code> 参数递归列出所有对象</p>
<p>s3api 下的操作：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3api list-buckets <span class="token parameter variable">--query</span> <span class="token string">"Buckets[].Name"</span>
<span class="token comment"># 会跨区域列出所有存储桶</span>

aws s3api list-objects <span class="token parameter variable">--bucket</span> amzn-s3-demo-bucket <span class="token parameter variable">--query</span> <span class="token string">'Contents[].&#123;Key: Key, Size: Size&#125;'</span>

aws s3api list-objects-v2 <span class="token parameter variable">--bucket</span> amzn-s3-demo-bucket
<span class="token comment"># 这个会列出更详细的信息</span>

aws s3api put-object <span class="token punctuation">\</span>
    <span class="token parameter variable">--bucket</span> amzn-s3-demo-bucket <span class="token punctuation">\</span>
    <span class="token parameter variable">--key</span> my-dir/MySampleImage.png <span class="token punctuation">\</span>
    <span class="token parameter variable">--body</span> MySampleImage.png
<span class="token comment"># 上传文件</span>

aws s3api get-object <span class="token parameter variable">--bucket</span> text-content <span class="token parameter variable">--key</span> dir/my_images.tar.bz2 my_images.tar.bz2
<span class="token comment"># 下载文件</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>直接访问 <a target="_blank" rel="noopener" href="http://localhost:4566/amzn-s3-demo-bucket/test2.txt">http://localhost:4566/amzn-s3-demo-bucket/test2.txt</a> 可以读取刚才上传的文件</p>
<hr>
<h3 id="webapi-检索"><a href="#webapi-检索" class="headerlink" title="webapi 检索"></a>webapi 检索</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/iteye_18543/article/details/81576616">https://blog.csdn.net/iteye_18543/article/details/81576616</a></p>
<p>四个参数：prefix、delimiter、MaxKeys、Marker</p>
<hr>
<h2 id="SQS-消息队列"><a href="#SQS-消息队列" class="headerlink" title="SQS 消息队列"></a>SQS 消息队列</h2><p>SQS (Simple Queue Service) 可以用来帮助不同的应用程序之间进行可靠的消息传递，它就像是一个消息中转站，可以把消息从一个地方发送到另一个地方，确保消息的安全送达和处理，让应用程序之间更好地进行通信和协作。</p>
<p>Queue URL 的主要构成部分是 Account ID 和 Queue</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"Version"</span><span class="token operator">:</span><span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>                                   <span class="token comment">// 固定</span>
  <span class="token property">"Statement"</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"Sid"</span><span class="token operator">:</span><span class="token string">"可选的语句 ID"</span><span class="token punctuation">,</span>
      <span class="token property">"Effect"</span><span class="token operator">:</span><span class="token string">"Allow"</span> | <span class="token string">"Deny"</span><span class="token punctuation">,</span>
      <span class="token property">"Principal"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token comment">// 账户/角色/服务/匿名</span>
        <span class="token property">"AWS"</span><span class="token operator">:</span><span class="token string">"arn:aws:iam::&lt;ACCOUNT_ID>:role/&lt;RoleName>"</span>      <span class="token comment">// 单一主体</span>
        <span class="token comment">// 也可以是列表或 “*”（匿名）</span>
        <span class="token comment">// 还可以是 &#123;"Service":"sqs.amazonaws.com"&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"Action"</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token string">"sqs:SendMessage"</span><span class="token punctuation">,</span>
        <span class="token string">"sqs:ReceiveMessage"</span><span class="token punctuation">,</span>
        <span class="token string">"sqs:DeleteMessage"</span><span class="token punctuation">,</span>
        <span class="token string">"sqs:GetQueueAttributes"</span><span class="token punctuation">,</span>
        <span class="token string">"sqs:ChangeMessageVisibility"</span><span class="token punctuation">,</span>
        ...                                    <span class="token comment">// 按需</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"Resource"</span><span class="token operator">:</span><span class="token string">"arn:aws:sqs:&lt;REGION>:&lt;ACCOUNT_ID>:&lt;QUEUE_NAME>"</span><span class="token punctuation">,</span>
      <span class="token property">"Condition"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>                                           <span class="token comment">// 可选</span>
        <span class="token property">"StringEquals"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token property">"aws:SourceAccount"</span><span class="token operator">:</span><span class="token string">"123456789012"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"IpAddress"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token property">"aws:SourceIp"</span><span class="token operator">:</span><span class="token string">"203.0.113.0/24"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"ArnEquals"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token property">"aws:SourceArn"</span><span class="token operator">:</span><span class="token string">"arn:aws:lambda:&lt;REGION>:&lt;ACCOUNT_ID>:function:&lt;NAME>"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"NumericGreaterThan"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token property">"sqs:ApproximateNumberOfMessages"</span><span class="token operator">:</span> <span class="token string">"0"</span> <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>aws-cli api 文档：<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cli/latest/reference/sqs/">https://docs.aws.amazon.com/cli/latest/reference/sqs/</a></p>
<p>webapi 文档：</p>
<p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/AWSSimpleQueueService/latest/APIReference/API_SendMessage.html">https://docs.aws.amazon.com/zh_cn/AWSSimpleQueueService/latest/APIReference/API_SendMessage.html</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/AWSSimpleQueueService/latest/APIReference/API_ReceiveMessage.html">https://docs.aws.amazon.com/zh_cn/AWSSimpleQueueService/latest/APIReference/API_ReceiveMessage.html</a></p>
<h3 id="创建标准队列"><a href="#创建标准队列" class="headerlink" title="创建标准队列"></a>创建标准队列</h3><p>docker 容器内需要有 less，没有的话 <code>apt-get install less</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws --endpoint-url<span class="token operator">=</span>http://localhost:4566 sqs create-queue --queue-name test_DocAndEvents <span class="token parameter variable">--region</span> us-east-1
aws --endpoint-url<span class="token operator">=</span>http://localhost:4566 sqs create-queue --queue-name test_BusinessLayer <span class="token parameter variable">--region</span> us-east-1
aws --endpoint-url<span class="token operator">=</span>http://localhost:4566 sqs create-queue --queue-name test_DocProcessor <span class="token parameter variable">--region</span> us-east-1
aws --endpoint-url<span class="token operator">=</span>http://localhost:4566 sqs create-queue --queue-name test_Notifications <span class="token parameter variable">--region</span> us-east-1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250828153937511.png"></p>
<h3 id="列出队列"><a href="#列出队列" class="headerlink" title="列出队列"></a>列出队列</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws --endpoint-url<span class="token operator">=</span>http://sqs.us-east-1.localhost.localstack.cloud:4566 sqs list-queues<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250828154144951.png"></p>
<h3 id="发布消息"><a href="#发布消息" class="headerlink" title="发布消息"></a>发布消息</h3><p>测试 test_DocAndEvents 队列是否正在运行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws --endpoint-url<span class="token operator">=</span>http://sqs.us-east-1.localhost.localstack.cloud:4566 sqs send-message --queue-url http://sqs.us-east-1.localhost.localstack.cloud:4566/000000000000/test_DocAndEvents --message-body <span class="token string">"hello world"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250828154339677.png"></p>
<h3 id="接收消息"><a href="#接收消息" class="headerlink" title="接收消息"></a>接收消息</h3><p>测试是否可以使用 test_DocAndEvents 队列的消息</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws --endpoint-url<span class="token operator">=</span>http://sqs.us-east-1.localhost.localstack.cloud:4566 sqs receive-message --queue-url http://sqs.us-east-1.localhost.localstack.cloud:4566/000000000000/test_DocAndEvents<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250828154601162.png"></p>
<p>仅接收最后 10 条</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws --endpoint-url<span class="token operator">=</span>http://sqs.us-east-1.localhost.localstack.cloud:4566 sqs receive-message --queue-url http://sqs.us-east-1.localhost.localstack.cloud:4566/000000000000/test_DocAndEvents --max-number-of-messages <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="删除消息"><a href="#删除消息" class="headerlink" title="删除消息"></a>删除消息</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws sqs delete-message --queue-url http://sqs.us-east-1.localhost.localstack.cloud:4566/000000000000/test_DocAndEvents --receipt-handle YWEwODNkNTgtOTk1OS00M2E3LWE1ZjctZGZmOWRiY2E2MjRjIGFybjphd3M6c3FzOnVzLWVhc3QtMTowMDAwMDAwMDAwMDA6eGhpYml0X0RvY0FuZEV2ZW50cyA4MDdiODlkNi1mNDgxLTQ2ZDItOGJmZi1hZmRkY2MyZWJkZjcgMTcxMDk0NzE0Ni42NTkwMTEx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h3 id="删除队列"><a href="#删除队列" class="headerlink" title="删除队列"></a>删除队列</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws --endpoint-url<span class="token operator">=</span>http://localhost:4566 sqs delete-queue --queue-url http://localhost:4566/000000000000/test_BusinessLayer<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<hr>
<h2 id="SNS"><a href="#SNS" class="headerlink" title="SNS"></a>SNS</h2><p>SNS（Simple Notification Service）可以帮助开发人员向移动设备、电子邮件、消息队列等多种终端发送通知消息，让你能够轻松地向用户传递重要信息和实时更新。简单来说，SNS 就像是一个消息广播系统，让你能够快速、可靠地将消息发送给订阅者，确保他们及时收到你发送的通知。</p>
<p>aws-cli： <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cli/latest/reference/sns/#cli-aws-sns">https://docs.aws.amazon.com/cli/latest/reference/sns/#cli-aws-sns</a></p>
<table>
<thead>
<tr>
<th><strong>操作</strong></th>
<th><strong>命令</strong></th>
<th><strong>说明</strong></th>
<th><strong>常用参数</strong></th>
</tr>
</thead>
<tbody><tr>
<td>创建主题</td>
<td><code>aws sns create-topic --name MyTopic</code></td>
<td>返回 TopicArn</td>
<td><code>--name</code></td>
</tr>
<tr>
<td>删除主题</td>
<td><code>aws sns delete-topic --topic-arn arn:aws:sns:REGION:ACCOUNT:MyTopic</code></td>
<td>不能再次使用</td>
<td><code>--topic-arn</code></td>
</tr>
<tr>
<td>订阅主题</td>
<td><code>aws sns subscribe --topic-arn arn:aws:sns:REGION:ACCOUNT:MyTopic --protocol email --notification-endpoint user@example.com</code></td>
<td>需要确认订阅</td>
<td><code>--protocol</code>, <code>--notification-endpoint</code></td>
</tr>
<tr>
<td>取消订阅</td>
<td><code>aws sns unsubscribe --subscription-arn arn:aws:sns:REGION:ACCOUNT:MyTopic:3e4fb6b2-…</code></td>
<td>之后接收不到消息</td>
<td><code>--subscription-arn</code></td>
</tr>
<tr>
<td>发布消息</td>
<td><code>aws sns publish --topic-arn arn:aws:sns:REGION:ACCOUNT:MyTopic --message &quot;Hello from CLI!&quot;</code></td>
<td>也可带 MessageStructure、Subject 等</td>
<td><code>--message</code>, <code>--subject</code>, <code>--message-structure</code></td>
</tr>
<tr>
<td>列出主题</td>
<td><code>aws sns list-topics</code></td>
<td>支持分页（<code>--max-retries</code>、<code>--page-size</code>）</td>
<td><code>--max-results</code></td>
</tr>
<tr>
<td>列出订阅</td>
<td><code>aws sns list-subscriptions</code></td>
<td>同样分页</td>
<td><code>--max-results</code></td>
</tr>
<tr>
<td>获取主题属性</td>
<td><code>aws sns get-topic-attribute --topic-arn arn:… --attribute-name DisplayName</code></td>
<td>属性可读写</td>
<td><code>--attribute-name</code></td>
</tr>
<tr>
<td>设置主题属性</td>
<td><code>aws sns set-topic-attribute --topic-arn arn:… --attribute-name DisplayName --attribute-value NewName</code></td>
<td>替换或新增</td>
<td><code>--attribute-name</code>, <code>--attribute-value</code></td>
</tr>
<tr>
<td>删除主题属性</td>
<td><code>aws sns delete-topic-attribute --topic-arn arn:… --attribute-name DisplayName</code></td>
<td></td>
<td><code>--attribute-name</code></td>
</tr>
<tr>
<td><strong>发布多媒体（使用 MessageStructure json）</strong></td>
<td><code>aws sns publish --topic-arn arn:... --message &#39;&#123;&quot;default&quot;:&quot;Hello&quot;, &quot;email&quot;:&quot;Hello via Email&quot;&#125;&#39; --message-structure json</code></td>
<td>发送多种格式</td>
<td><code>--message-structure</code></td>
</tr>
<tr>
<td><strong>使用 AWS‑CLI 的 <code>--cli-input-json</code></strong></td>
<td><code>aws sns publish --cli-input-json file://payload.json</code></td>
<td>适合长、复杂的消息</td>
<td>见 below 说明</td>
</tr>
<tr>
<td><strong>等待主题删除完成</strong></td>
<td><code>aws wait sns-topic-deleted --topic-arn arn:…</code></td>
<td>当你想同步流程</td>
<td><code>--topic-arn</code></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>创建主题、列出主题</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws sns create-topic <span class="token parameter variable">--name</span> MyTopic

aws sns list-topics<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250829110309885.png"></p>
<p>订阅主题，其中 <code>--notification-endpoint</code> 可以指定多种协议</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws sns subscribe --topic-arn arn:aws:sns:us-east-1:000000000000:MyTopic <span class="token parameter variable">--protocol</span> email --notification-endpoint user@example.com

aws sns subscribe --topic-arn arn:aws:sns:us-east-1:000000000000:MyTopic <span class="token parameter variable">--protocol</span> http --notification-endpoint http://192.168.65.254:23333<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250829110319986.png"></p>
<p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250829111428824.png"></p>
<p>http 端收到的响应：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">192.168.65.254:23333</span></span>
<span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Amazon Simple Notification Service Agent</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip,deflate</span></span>
<span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">*/*</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">keep-alive</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">text/plain; charset=UTF-8</span></span>
<span class="token header"><span class="token header-name keyword">x-amz-sns-message-type</span><span class="token punctuation">:</span> <span class="token header-value">SubscriptionConfirmation</span></span>
<span class="token header"><span class="token header-name keyword">x-amz-sns-message-id</span><span class="token punctuation">:</span> <span class="token header-value">79569c97-d38d-40e3-8447-7678994a8807</span></span>
<span class="token header"><span class="token header-name keyword">x-amz-sns-topic-arn</span><span class="token punctuation">:</span> <span class="token header-value">arn:aws:sns:us-east-1:000000000000:MyTopic</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">1171</span></span>

&#123;"Type": "SubscriptionConfirmation", "MessageId": "79569c97-d38d-40e3-8447-7678994a8807", "TopicArn": "arn:aws:sns:us-east-1:000000000000:MyTopic", "Message": "You have chosen to subscribe to the topic arn:aws:sns:us-east-1:000000000000:MyTopic.\nTo confirm the subscription, visit the SubscribeURL included in this message.", "Timestamp": "2025-08-29T03:14:11.585Z", "Token": "75732d656173742d312ff0d80c59f0d80c59f0d80c59f0d80c59f0d80c59f0d8", "SubscribeURL": "http://localhost.localstack.cloud:4566/?Action=ConfirmSubscription&amp;TopicArn=arn:aws:sns:us-east-1:000000000000:MyTopic&amp;Token=75732d656173742d312ff0d80c59f0d80c59f0d80c59f0d80c59f0d80c59f0d8", "SignatureVersion": "1", "Signature": "agiodi/j5SRUu13tURtpKl+YborNOE9V2SLfNviwRnG7JOPOrdCNl2SMEmlzr+qEBC6APv+2wAVg2UiQu1pYpXzTn4WW4pdDd00fqi4elq7rTPm4wEAfcytR9akdfE/dxnz/Ti2ziAjNGMLHW0vHMFcXyvNHzEr6ylTDQ7X8Nod5J8FW7czdZo3IVDkDY5Bz3u4skWATHtgtmI1dD8fMapCAs04aX9pBF690UN6MngwvAOKNE42n0K56T+sWFL2sAzzbZzX3hQ8ubE6crKAAQ4hi8IgI1u9+evbyr0W0F0UeFlrfi8AN0x4d74J54gx0Lb/T1MBeR4vdz9+r2GfiYA==", "SigningCertURL": "http://localhost.localstack.cloud:4566/_aws/sns/SimpleNotificationService-6c6f63616c737461636b69736e696365.pem"&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在进行 Subscribe 时，如果当前和订阅的主题不在一个 AWS 账号下，还需要进行<strong>确认订阅</strong>操作，在进行确认操作的时候，就需要使用主题返回的 Token 值了</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws sns confirm-subscription <span class="token punctuation">\</span>
    --topic-arn arn:aws:sns:us-east-1:000000000000:MyTopic <span class="token punctuation">\</span>
    <span class="token parameter variable">--token</span> 75732d656173742d312ff0d80c59f0d80c59f0d80c59f0d80c59f0d80c59f0d8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250829111937678.png"></p>
<hr>
<h2 id="Cognito"><a href="#Cognito" class="headerlink" title="Cognito"></a>Cognito</h2><p>AWS Cognito 是一项托管服务，可帮助开发人员轻松添加用户身份验证和授权功能到应用程序中。它提供了用于注册、登录和管理用户的功能，支持常见的身份验证方法，如用户名&#x2F;密码、社交媒体登录和身份提供商集成。Cognito 还提供了用户身份验证的安全性、可伸缩性和可定制性，并与其他 AWS 服务集成，使开发人员能够构建安全可靠的应用程序。</p>
<p>文档：<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/cognito/latest/developerguide/cognito-identity.html">https://docs.aws.amazon.com/zh_cn/cognito/latest/developerguide/cognito-identity.html</a></p>
<p>要使用 Cognito 需要在<a target="_blank" rel="noopener" href="https://ap-southeast-2.signin.aws.amazon.com/oauth?client_id=arn:aws:signin:::console/cognito&code_challenge=pSNVOgzQXR9_5t2HlQt3ScnWByHQxZgfM8t2x4pRf0U&code_challenge_method=SHA-256&response_type=code&redirect_uri=https://console.aws.amazon.com/cognito?hashArgs=%2523&isauthcode=true&oauthStart=1756458425672&state=hashArgsFromTB_ap-southeast-2_39a6454693831963">控制台</a>先创建一个 Amazon Cognito 身份池，然后填入创建的身份池 ID 去调用 SDK 获取临时凭证，最后通过临时凭证去操作资源</p>
<p>调用 SDK 的部分以 javascript 为例：<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/cognito/latest/developerguide/getting-credentials.html">https://docs.aws.amazon.com/zh_cn/cognito/latest/developerguide/getting-credentials.html</a></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Set the region where your identity pool exists (us-east-1, eu-west-1)</span>
<span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>region <span class="token operator">=</span> <span class="token string">'us-east-1'</span><span class="token punctuation">;</span>

<span class="token comment">// Configure the credentials provider to use your identity pool</span>
<span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AWS<span class="token punctuation">.</span>CognitoIdentityCredentials</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">IdentityPoolId</span><span class="token operator">:</span> <span class="token string">'IDENTITY_POOL_ID'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">Logins</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// optional tokens, used for authenticated login</span>
        <span class="token string-property property">'graph.facebook.com'</span><span class="token operator">:</span> <span class="token string">'FBTOKEN'</span><span class="token punctuation">,</span>
        <span class="token string-property property">'www.amazon.com'</span><span class="token operator">:</span> <span class="token string">'AMAZONTOKEN'</span><span class="token punctuation">,</span>
        <span class="token string-property property">'accounts.google.com'</span><span class="token operator">:</span> <span class="token string">'GOOGLETOKEN'</span><span class="token punctuation">,</span>
        <span class="token string-property property">'appleid.apple.com'</span><span class="token operator">:</span> <span class="token string">'APPLETOKEN'</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make the call to obtain credentials</span>
<span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token comment">// Credentials will be available when this function is called.</span>
    <span class="token keyword">var</span> accessKeyId <span class="token operator">=</span> <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span>accessKeyId<span class="token punctuation">;</span>
    <span class="token keyword">var</span> secretAccessKey <span class="token operator">=</span> <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span>secretAccessKey<span class="token punctuation">;</span>
    <span class="token keyword">var</span> sessionToken <span class="token operator">=</span> <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span>sessionToken<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>由于我这里没有注册 aws，实际操作可见 <a href="https://c1oudfl0w0.github.io/blog/2025/08/27/The-Big-IAM-Challenge/#Do-I-know-you?">The-Big-IAM-Challenge Do I know you?</a></p>
<h3 id="sts"><a href="#sts" class="headerlink" title="sts"></a>sts</h3><p>Security Token Service (STS) 安全令牌服务允许请求一个有限权限的凭据</p>
<p>aws-cli 文档：<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cli/latest/reference/sts/#cli-aws-sts">https://docs.aws.amazon.com/cli/latest/reference/sts/#cli-aws-sts</a></p>
<h4 id="assume-role-with-web-identity"><a href="#assume-role-with-web-identity" class="headerlink" title="assume-role-with-web-identity"></a>assume-role-with-web-identity</h4><blockquote>
<p>返回一组临时安全凭证，用于已在移动端或 Web 应用程序中通过了 Web 身份提供商进行身份验证的用户</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">assume-role-with-web-identity <span class="token punctuation">\</span>
--role-arn <span class="token operator">&lt;</span>value<span class="token operator">></span> <span class="token punctuation">\</span>
--role-session-name <span class="token operator">&lt;</span>value<span class="token operator">></span> <span class="token punctuation">\</span>
--web-identity-token <span class="token operator">&lt;</span>value<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>三个参数：</p>
<ul>
<li><code>role-arn</code>：即 arn 那串，调用者所承担的角色的 Amazon 资源名称 (ARN)</li>
<li><code>role-session-name</code>：可以自定义</li>
<li><code>web-identity-token</code>：身份提供商提供的 OAuth 2.0 访问令牌或 OpenID Connect ID 令牌，需要从身份池 ID 获取</li>
</ul>
<p>获取 token 可以查看 aws-cli 文档： <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/de_de/cli/latest/reference/cognito-identity/index.html">https://docs.aws.amazon.com/de_de/cli/latest/reference/cognito-identity/index.html</a></p>

    </div>
    
    
    
    
    
    
    
</div>

      </div>
    </transition>
    
    <transition name="fade">
      <div id="preview" ref="preview" v-show="previewShow">
        <img id="preview-content" ref="previewContent" />
      </div>
    </transition>
    
  </div>
  <script src="/blog/js/main.js"></script>
  
  




  
  

<div id="vcomments"></div>
<script defer src="/blog/js/lib/valine.min.js" onload="
    new Valine({
        el: '#vcomments',
        app_id: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
        app_key: 'SzWOnY0PWLGNuL6jW8TZYc7j',
        visitor: 'true',
        placeholder: '写点什么吧(●ˇ∀ˇ●)',
        serverURLs: 'https://u9mzlkun.lc-cn-n1-shared.com',
    });
"></script>


  <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2026 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>