
<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <title>静态程序分析 | 雲流のLowest World</title>
  <meta name="author" content="C1oudfL0w0" />
  <meta name="description" content="" />
  <meta name="keywords" content="" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
  <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
  <!-- cdn挂掉的时候要可以引用本地 -->
<!-- <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script> -->
<script src="/blog/js/vue.global.prod.min.js"></script>


<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />


<link rel="stylesheet" href="/blog/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<link rel="stylesheet" href="/blog/css/search.css" />
<script> const mixins = {}; </script>


<!--改成了prismjs高亮-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- 引入不蒜子-->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script type="text/javascript" src="/blog/js/lib/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/blog/js/lib/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<!-- 引入clipboard -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

<script type="text/javascript" src="/blog/js/lib/codeBlock/codeCopy.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/blog/js/lib/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="雲流のLowest World" type="application/atom+xml">
</head>

<body>
  <!--flag{never_g0nna g1ve_you up}-->

  <!-- 页面点击特效 -->
  <script type="text/javascript" src="/blog/js/love-click.js"></script>

  <!-- 浏览器标题 -->
  <script async type="text/javascript" src="/blog/js/FunnyTitle.js"></script>

  <!-- 动态背景 -->
  

  <!--文章目录-->
  
    <div id="toc" class="toc-article">
    <h3><i class="fas fa-stream"></i>  目录</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">2.</span> <span class="toc-text">基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E7%9A%84%E8%AF%84%E5%AE%9A%E6%A0%87%E5%87%86"><span class="toc-number">2.1.</span> <span class="toc-text">静态分析的评定标准</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1"><span class="toc-number">2.2.</span> <span class="toc-text">抽象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%91%E4%BC%BC"><span class="toc-number">2.3.</span> <span class="toc-text">近似</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="toc-number">2.3.1.</span> <span class="toc-text">控制流</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E8%A1%A8%E7%A4%BA%EF%BC%88IR%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">中间表示（IR）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%99%A8%E4%B8%8E%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E5%99%A8"><span class="toc-number">3.1.</span> <span class="toc-text">编译器与静态分析器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AST-amp-IR"><span class="toc-number">3.2.</span> <span class="toc-text">AST &amp; IR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E5%9C%B0%E5%9D%80%E7%A0%81%EF%BC%883-Address-Code%EF%BC%8C3AC%EF%BC%89"><span class="toc-number">3.3.</span> <span class="toc-text">三地址码（3 Address Code，3AC）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%9D%97-Basic-Blocks%EF%BC%88BB%EF%BC%89"><span class="toc-number">3.4.</span> <span class="toc-text">基本块 Basic Blocks（BB）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B5%81%E5%9B%BE-Control-Flow-Graphs%EF%BC%88CFG%EF%BC%89"><span class="toc-number">3.5.</span> <span class="toc-text">控制流图 Control Flow Graphs（CFG）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-number">4.</span> <span class="toc-text">安全问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%B5%81%E5%AE%89%E5%85%A8"><span class="toc-number">4.1.</span> <span class="toc-text">信息流安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6-vs-%E4%BF%A1%E6%81%AF%E6%B5%81%E5%AE%89%E5%85%A8"><span class="toc-number">4.1.1.</span> <span class="toc-text">访问控制 vs 信息流安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%B5%81"><span class="toc-number">4.1.2.</span> <span class="toc-text">信息流</span></a></li></ol></li></ol></li></ol>
    </div>
    <script>
    (function () {
        function initTocHighlight() {
            var tocLinks = document.querySelectorAll('#toc .toc-link');
            if (!tocLinks.length) return;

            // 收集所有标题锚点对应的 DOM 元素
            var headings = [];
            tocLinks.forEach(function (link) {
                var href = link.getAttribute('href');
                if (!href) return;
                var id = decodeURIComponent(href.slice(1));
                var el = document.getElementById(id);
                if (el) headings.push({ el: el, link: link });
            });
            if (!headings.length) return;

            var activeLink = null;
            var offset = 80;

            function highlight() {
                var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                var current = null;

                for (var i = 0; i < headings.length; i++) {
                    if (headings[i].el.getBoundingClientRect().top <= offset + 10) {
                        current = headings[i];
                    }
                }

                // 仅在用户确实滚动过、且到达页面底部时，才强制高亮最后一个
                if (scrollTop > 100 && window.innerHeight + scrollTop >= document.documentElement.scrollHeight - 50) {
                    current = headings[headings.length - 1];
                }

                // 页面顶部且没有标题进入视口时，高亮第一个
                if (scrollTop == 0) {
                    current = headings[0];
                }

                if (current && current.link !== activeLink) {
                    // 清除所有高亮
                    tocLinks.forEach(function (link) {
                        link.classList.remove('toc-active');
                    });

                    // 高亮当前项
                    current.link.classList.add('toc-active');
                    activeLink = current.link;

                    // TOC 容器自动滚动，使当前项可见
                    var tocEl = document.getElementById('toc');
                    var linkRect = activeLink.getBoundingClientRect();
                    var tocRect = tocEl.getBoundingClientRect();
                    if (linkRect.top < tocRect.top || linkRect.bottom > tocRect.bottom) {
                        activeLink.scrollIntoView({ block: 'center', behavior: 'smooth' });
                    }
                } else if (!current && activeLink) {
                    tocLinks.forEach(function (link) {
                        link.classList.remove('toc-active');
                    });
                    activeLink = null;
                }
            }

            var ticking = false;
            window.addEventListener('scroll', function () {
                if (!ticking) {
                    requestAnimationFrame(function () {
                        highlight();
                        ticking = false;
                    });
                    ticking = true;
                }
            });

            // 初始高亮
            highlight();
        }

        // 等待页面完全加载后再初始化（确保文章标题 DOM 已渲染）
        if (document.readyState === 'complete') {
            initTocHighlight();
        } else {
            window.addEventListener('load', initTocHighlight);
        }
    })();
    </script>
  

  <!--返回顶部-->
  <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
    <a title="返回顶部">↑</a>
  </div>
  <script src="/blog/js/totop.js"></script>

  <div id="layout">
    
    <div id="content-background" ref="contentBackground" data-images="https://pic.imgdb.cn/item/65d61d809f345e8d03b8bc7a.png"></div>
    
    <transition name="fade">
      <div id="loading" v-show="loading">
        <div id="loading-circle">
          <h2>LOADING</h2>
          <p>第一次加载文章图片可能会花费较长时间</p>
          <p>要不挂个梯子试试？（x</p>
          <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
          <img src="/blog/images/loading.gif" />
        </div>
      </div>
    </transition>
    <transition name="into">
      <div id="main" v-show="!loading">
        <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
        <a href="/blog/search">
            <i class="fa-solid fa-search fa-fw"></i>
            <span>&ensp;Search</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
            <a href="/blog/search">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-search fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Search</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

        <div class="article">
    <div>
        <h1>静态程序分析</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/3/4
        </span>
        
        
        <!--文章字数统计-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <!-- 安装插件npm install hexo-wordcount --save -->
        <span class="post-count">2.6k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">10分</span>
      </span>
    </span>
    
    <!--不蒜子统计访问数-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    总文章阅读量：<span id="busuanzi_value_page_pv"></span>次
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>大作业所迫，8周时间试图产出一个静态分析工具，正好我也试试能不能写一个当毕设（</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://fushuling.com/index.php/2025/01/08/%e9%9d%99%e6%80%81%e5%88%86%e6%9e%90%e5%85%a5%e9%97%a8/">https://fushuling.com/index.php/2025/01/08/%e9%9d%99%e6%80%81%e5%88%86%e6%9e%90%e5%85%a5%e9%97%a8/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1b7411K7P4/">https://www.bilibili.com/video/BV1b7411K7P4/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.o2oxy.cn/4414.html">https://www.o2oxy.cn/4414.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.o2oxy.cn/4400.html">https://www.o2oxy.cn/4400.html</a></p>
<span id="more"></span>

<hr>
<h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><p>静态分析（Static Analysis）：在运行一个程序 P 之前，通过静态分析 P 来推测其行为，并且确定是否满足一些特定的性质</p>
<p>我们需要关心的是：</p>
<ul>
<li>是否存在私有信息泄露（Private Information Leak）</li>
<li>是否有空指针的解引用（Null Pointer Dereference）操作</li>
<li>类型转换（Type Cast）操作是否安全</li>
<li>两个变量能否指向同一个内存地址</li>
<li>是否存在无法满足的断言（assert）语句</li>
<li>是否存在控制流无法到达的代码（Dead Code）</li>
</ul>
<hr>
<h2 id="静态分析的评定标准"><a href="#静态分析的评定标准" class="headerlink" title="静态分析的评定标准"></a>静态分析的评定标准</h2><ul>
<li>Sound：即<strong>全面的</strong>或者<strong>完备的</strong>，简单来说，满足 Sound 即允许错报不允许漏报</li>
<li>Truth：<strong>真实的</strong>，顾名思义，就是一个程序真正存在的漏洞，是最理想的分析结果</li>
<li>Complete：<strong>完整的</strong>，简单来说，满足 Complete 即允许漏报但不允许错报</li>
</ul>
<p><img src="/blog/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/image-20250304100113739.png" alt="image-20250304100113739"></p>
<p>那么很明显，同时满足 Sound 和 Complete 是几乎不可能的，Truth 是 Sound 的子集，Complete 又是 Truth 的子集，Sound 属于一种 <strong>Overapproximate</strong>，即过拟合，而 Complete 属于一种 <strong>Underapproximate</strong>，即弱拟合</p>
<p>在真实的程序分析中，显然我们要先做到 Sound，在此基础上向 Truth 上靠拢，宁可误报不能漏报</p>
<hr>
<h2 id="抽象"><a href="#抽象" class="headerlink" title="抽象"></a>抽象</h2><blockquote>
<p>将具体域的值映射到抽象域中</p>
</blockquote>
<p>例如按符号（+，-，0）给变量值做划分，大于0就划分为+，小于0就划分为-</p>
<p>而不确定的值划分为 unknown ，错误的值划分为 undefined</p>
<p><img src="/blog/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/image-20250304104612811.png" alt="image-20250304104612811"></p>
<h2 id="近似"><a href="#近似" class="headerlink" title="近似"></a>近似</h2><p>定义计算抽象值的转换规则</p>
<p><img src="/blog/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/image-20250304112824254.png" alt="image-20250304112824254"></p>
<h3 id="控制流"><a href="#控制流" class="headerlink" title="控制流"></a>控制流</h3><p><img src="/blog/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/image-20250304113018189.png" alt="image-20250304113018189"></p>
<p>所有 control flows 的汇聚点，都要执行合并（merge）：抽象做近似</p>
<hr>
<h1 id="中间表示（IR）"><a href="#中间表示（IR）" class="headerlink" title="中间表示（IR）"></a>中间表示（IR）</h1><h2 id="编译器与静态分析器"><a href="#编译器与静态分析器" class="headerlink" title="编译器与静态分析器"></a>编译器与静态分析器</h2><p>编译流程：</p>
<p><img src="/blog/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/image-20250311144903686.png" alt="image-20250311144903686"></p>
<ul>
<li><p><strong>Scanner</strong>： 扫描源代码，进行<strong>词法分析</strong>（Lexical Analysis），词法分析会用到<strong>正则表达式</strong>（Regular Expression），词法分析后的结果为一个标记（Token）串。</p>
<p>以自然语言为例：<code>You dkasnd&amp;^$Roewn godd</code>，由于不能构成单词，所以不能通过 Scanner</p>
</li>
<li><p><strong>Parser：</strong> 遍历标记串，进行<strong>语法分析</strong>（Syntax  Analysis），这里的语法分析分析的是上下文无关的语法（Context Free  Grammer），解析器的内部应该是实现了一个有限状态机，用于<strong>识别和分析每个语法块格式的正确性</strong>，语法分析的结果为一棵抽象语法树（Abstract Syntax Tree，AST）。</p>
<p>以自然语言为例：<code>Like your hair I</code>，词法正确但是语法不正确，不能通过 Parser</p>
</li>
<li><p><strong>Type Checker</strong>： 会遍历抽象语法树，进行<strong>语义分析</strong>（Semantic  Analysis），不过编译器的语意分析是简单的，主要是分析属性语法（Attribute  Grammer），比如说变量类型，并适当调整一下语法树。语义分析的结果我们称之为<strong>装饰过的抽象语法树</strong>（Decorated AST）。</p>
<p>以自然语言为例：<code>Apples eat you</code>，词法、语法正确，但是语义上不正确，不能通过 Type Checker</p>
</li>
<li><p><strong>Translator：</strong> 会将抽象语法树翻译成<strong>中间表示</strong>（Intermediate  Representation, IR），IR 的出现解耦了编译器的机器相关（Machine Dependent）部分和机器无关（Machine  Independent）部分，上述几个层次在不同架构的机器上面是可以几乎不加改动地复用的。</p>
</li>
<li><p><strong>Code Generator</strong>： 会将 IR 转化成物理 CPU 能够直接执行的比特序列，也就是机器代码</p>
</li>
</ul>
<p>可以把 IR 之前的部分类比为前端， IR 后面的部分类比为后端</p>
<hr>
<h2 id="AST-amp-IR"><a href="#AST-amp-IR" class="headerlink" title="AST &amp; IR"></a>AST &amp; IR</h2><p>对于这个代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">do</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>AST 和 IR 的结果分别是：</p>
<p><img src="/blog/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/image-20250311150031223.png" alt="image-20250311150031223"></p>
<p>AST：之前接触过 <a href="https://c1oudfl0w0.github.io/blog/2024/02/10/AST%E6%B3%A8%E5%85%A5/#%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90">https://c1oudfl0w0.github.io/blog/2024/02/10/AST%E6%B3%A8%E5%85%A5/#%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90</a></p>
<p>解析出来的语法树用json表示为：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Program"</span><span class="token punctuation">,</span>
  <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
  <span class="token property">"body"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"DoWhileStatement"</span><span class="token punctuation">,</span>	<span class="token comment">// do-while结构</span>
      <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
      <span class="token property">"body"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>	<span class="token comment">// body</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"ExpressionStatement"</span><span class="token punctuation">,</span>
        <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
        <span class="token property">"expression"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"AssignmentExpression"</span><span class="token punctuation">,</span>
          <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
          <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
          <span class="token property">"operator"</span><span class="token operator">:</span> <span class="token string">"="</span><span class="token punctuation">,</span>
          <span class="token property">"left"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Identifier"</span><span class="token punctuation">,</span>
            <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"i"</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token property">"right"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"BinaryExpression"</span><span class="token punctuation">,</span>
            <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
            <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
            <span class="token property">"left"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Identifier"</span><span class="token punctuation">,</span>
              <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
              <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
              <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"i"</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token property">"operator"</span><span class="token operator">:</span> <span class="token string">"+"</span><span class="token punctuation">,</span>	<span class="token comment">// 右子树根节点</span>
            <span class="token property">"right"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Literal"</span><span class="token punctuation">,</span>
              <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
              <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
              <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
              <span class="token property">"raw"</span><span class="token operator">:</span> <span class="token string">"1"</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"test"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"BinaryExpression"</span><span class="token punctuation">,</span>
        <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
        <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span>
        <span class="token property">"left"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"MemberExpression"</span><span class="token punctuation">,</span>
          <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
          <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
          <span class="token property">"object"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Identifier"</span><span class="token punctuation">,</span>
            <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
            <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"a"</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token property">"property"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Identifier"</span><span class="token punctuation">,</span>
            <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>
            <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"i"</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token property">"computed"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token property">"optional"</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"operator"</span><span class="token operator">:</span> <span class="token string">"&lt;"</span><span class="token punctuation">,</span>	<span class="token comment">// 右子树根节点</span>
        <span class="token property">"right"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Identifier"</span><span class="token punctuation">,</span>
          <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
          <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span>
          <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"v"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"sourceType"</span><span class="token operator">:</span> <span class="token string">"module"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br>

<p>IR：三地址码</p>
<ol>
<li>i &#x3D; i + 1</li>
<li>临时变量 t1 &#x3D; a[i]</li>
<li>if t1 &lt; v goto 1，即回到第一步重复执行</li>
</ol>
<br>

<p>可以看出来，抽象语法树（AST）是源代码结构的一种抽象表示，以树状的形式表现编程语言的语法结构，相对而言层次较高，和语法结构更接近，并且依赖于具体的语言类，缺少和程序控制流相关的信息</p>
<p>而 IR 与机器代码接近，通常与具体的语言无关，简单通用，包含程序的控制流信息，也是我们做静态分析的基础</p>
<hr>
<h2 id="三地址码（3-Address-Code，3AC）"><a href="#三地址码（3-Address-Code，3AC）" class="headerlink" title="三地址码（3 Address Code，3AC）"></a>三地址码（3 Address Code，3AC）</h2><p>通常使用 3AC 形式的 IR</p>
<p>所谓的三地址码是指：每个三地址码指令，都可以被分解为四个元组（运算符，运算对象1，运算对象2，结果）</p>
<p>因为每个陈述都包含了三个变量，所以它被称为三地址码。</p>
<p>例子：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">a<span class="token operator">+</span>b<span class="token operator">+</span><span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>转化成三地址码：这里是<code>结果 运算符 对象1 运算符 对象2</code></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">t1 <span class="token operator">=</span> a <span class="token operator">+</span> b
t2 <span class="token operator">=</span> t1 <span class="token operator">+</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>其中a, b是原始变量，3是常数，t1和t2是编译过程中生成的临时变量</p>
<br>

<p>系统中常见的三地址码指令：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">x <span class="token operator">=</span> y bop z <span class="token comment">//bop：二元运算，二进制算术或逻辑运算</span>
x <span class="token operator">=</span> uop y <span class="token comment">//uop：一元运算（减号、否定、强制转换）</span>
x <span class="token operator">=</span> y
<span class="token keyword">goto</span> L <span class="token comment">//L： 表示程序位置的标签  goto L就是一种无条件跳转</span>
<span class="token keyword">if</span> x <span class="token keyword">goto</span> L <span class="token comment">// if ... 满足条件后再xxx属于一种条件跳转</span>
<span class="token keyword">if</span> x rop y <span class="token keyword">goto</span> L <span class="token comment">//rop：关系运算符（>、&lt;、==、>=、&lt;=等）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br>

<p>真实案例：<a target="_blank" rel="noopener" href="https://github.com/soot-oss/soot">https://github.com/soot-oss/soot</a></p>
<p>观察一下这个 java 方法调用的 3AC，部分涉及到 JVM 的设计</p>
<p><img src="/blog/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/image-20250311154008354.png" alt="image-20250311154008354"></p>
<p><img src="/blog/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/image-20250311154140232.png" alt="image-20250311154140232"></p>
<hr>
<h2 id="基本块-Basic-Blocks（BB）"><a href="#基本块-Basic-Blocks（BB）" class="headerlink" title="基本块 Basic Blocks（BB）"></a>基本块 Basic Blocks（BB）</h2><p>具体定义是：<strong>一个基本块中只能有一个入口和一个出口</strong></p>
<p>入口就是其中的第—个语句，出口就是其中的最后一个语句。对一个基本块来说，执行时只从其入口进入，从其出口退出</p>
<p>在具体程序中，我们划分 BasicBlock 的方式就是找到不同的 leader，即不同 BasicBlock 的入口点，通过不同的入口点划分不同的 BasicBlock</p>
<p>划分 leader 的原则：</p>
<ul>
<li><strong>程序的第一条语句</strong>：即整个程序最初的入口</li>
<li><strong>转移语句的目标语句</strong>：比如一个 goto 语句跳转到了第三句代码，那么这个第三句代码必然是 leader</li>
<li><strong>紧跟在条件转移语句后面的语句</strong>：比如第三句代码是一个 goto 语句，那么第四句代码必然是 leader</li>
</ul>
<p>3AC 的例子：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>x <span class="token operator">=</span> <span class="token function">input</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>y <span class="token operator">=</span> <span class="token function">x</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>z <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token function">y</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token keyword">if</span> z <span class="token operator">&lt;</span> x <span class="token keyword">goto</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>p <span class="token operator">=</span> x <span class="token operator">/</span> <span class="token function">y</span>
<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>q <span class="token operator">=</span> p <span class="token operator">+</span> <span class="token function">y</span>
<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>a <span class="token operator">=</span> <span class="token function">q</span>
<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>b <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token function">a</span>
<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>c <span class="token operator">=</span> <span class="token number">2</span>a <span class="token operator">-</span> <span class="token function">b</span>
<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword">if</span> p <span class="token operator">==</span> q <span class="token keyword">goto</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token keyword">goto</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token keyword">return</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>按照第一条原则，程序的第一条语句必须是 leader，我们可以得到 leader：(1)</p>
<p>按照第二条原则，转移语句的目标语句必须是 leader，我们可以得到 leader：(3) (7) (12)</p>
<p>按照第三条原则，紧跟在条件转移语句后面的语句必然是 leader，我们可以得到 leader：(5) (11) (12)</p>
<p>对三个集合进行合并，整个程序的 leader 便是：(1) (3) (5) (7) (11) (12)</p>
<p>通过不同的 leader 划分不同的 BasicBlock，我们可以划分出该程序的 BasicBlock 分别为：</p>
<ol>
<li>{<strong>(1)</strong> (2)}</li>
<li>{<strong>(3)</strong> (4)}</li>
<li>{<strong>(5)</strong> (6)}</li>
<li>{<strong>(7)</strong> (8) (9) (10)}</li>
<li>{<strong>(11)</strong>}</li>
<li>{<strong>(12)</strong>}</li>
</ol>
<hr>
<h2 id="控制流图-Control-Flow-Graphs（CFG）"><a href="#控制流图-Control-Flow-Graphs（CFG）" class="headerlink" title="控制流图 Control Flow Graphs（CFG）"></a>控制流图 Control Flow Graphs（CFG）</h2><p>有了 BasicBlock 作为工具，我们就可以很清晰的画出程序的 Control Flow Graph，即控制流图</p>
<p>类似于 IDA 的 Flow chart</p>
<p><img src="/blog/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/image-20250311163206322.png" alt="image-20250311163206322"></p>
<p>CFG 控制流程图，是一个过程或程序的抽象表现，是用在编译器中的一个抽象数据结构，由编译器在内部维护，代表了一个程序执行过程中会遍历到的所有路径</p>
<p>它用图的形式表示一个过程内所有基本块执行的可能流向, 也能反映一个过程的实时执行过程</p>
<p>CFG 能反映出一个过程的许多信息，包括但不限于：</p>
<ul>
<li>是哪一个过程;</li>
<li>一个过程的入口（第一个基本块）和出口（最后一个基本块）；</li>
<li>一个基本块的所有可能的下一个基本块（所有的出口）；</li>
<li>一个基本块的所有可能的上一个基本块（所有的入口）；</li>
<li>一个基本块所对应的语句表</li>
</ul>
<p>CFG 的节点是 BasicBlock，只有两种情况下从块A到块B存在边：</p>
<ul>
<li><p><strong>从A的末尾到B的开头有一个有条件或无条件的跳转</strong></p>
<p><img src="/blog/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/image-20250311163903640.png" alt="image-20250311163903640"></p>
</li>
<li><p><strong>B立即按照原始指令顺序跟随A且A不会以无条件跳转结束</strong></p>
<p>因此这种A以无条件跳转结尾的情况下，A与B之间不存在边</p>
<p><img src="/blog/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/image-20250311165659509.png" alt="image-20250311165659509"></p>
<p>若A不以跳转结尾，那么二者间存在边</p>
<p><img src="/blog/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/image-20250311165739355.png" alt="image-20250311165739355"></p>
</li>
</ul>
<p>在日常的分析中，我们会经常把跳转到指令标签替换为跳转到基本块，这样就简化了我们分析的难度</p>
<p><img src="/blog/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/image-20250311165820963.png" alt="image-20250311165820963"></p>
<p>对于前面给出来的 3AC 代码块而言，CFG 如下</p>
<p><img src="/blog/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/image-20250311165904957.png" alt="image-20250311165904957"></p>
<hr>
<h1 id="安全问题"><a href="#安全问题" class="headerlink" title="安全问题"></a>安全问题</h1><h2 id="信息流安全"><a href="#信息流安全" class="headerlink" title="信息流安全"></a>信息流安全</h2><h3 id="访问控制-vs-信息流安全"><a href="#访问控制-vs-信息流安全" class="headerlink" title="访问控制 vs 信息流安全"></a>访问控制 vs 信息流安全</h3><p>访问控制（Access Control）：是一种保护敏感数据的标准方法，主要用于检查程序是否有权访问某些信息，<strong>关注如何访问信息</strong></p>
<p>信息流安全（Information Flow Security）：是一种端到端的方法，跟踪信息如何流经程序，以确保程序安全地处理信息，<strong>关注信息如何传播</strong></p>
<h3 id="信息流"><a href="#信息流" class="headerlink" title="信息流"></a>信息流</h3><p>如果变量 x 中的信息被转移到变量 y 中</p>

    </div>
    
    
    
    
    
    
    
</div>

      </div>
    </transition>
    
    <transition name="fade">
      <div id="preview" ref="preview" v-show="previewShow">
        <img id="preview-content" ref="previewContent" />
      </div>
    </transition>
    
  </div>
  <script src="/blog/js/main.js"></script>
  
  




  
  

<div id="vcomments"></div>
<script defer src="/blog/js/lib/valine.min.js" onload="
    new Valine({
        el: '#vcomments',
        app_id: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
        app_key: 'SzWOnY0PWLGNuL6jW8TZYc7j',
        visitor: 'true',
        placeholder: '写点什么吧(●ˇ∀ˇ●)',
        serverURLs: 'https://u9mzlkun.lc-cn-n1-shared.com',
    });
"></script>


  <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2026 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>