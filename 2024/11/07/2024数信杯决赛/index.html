
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>2024数信杯决赛 | 雲流のLowest World</title>
    <meta name="author" content="C1oudfL0w0" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
    <!-- cdn挂掉的时候要可以引用本地 -->
<!-- <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script> -->
<script src="/blog/js/vue.global.prod.min.js"></script>


<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />


<link rel="stylesheet" href="/blog/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<link rel="stylesheet" href="/blog/css/search.css" />
<script> const mixins = {}; </script>

<!-- 引入jQuery-->
<!-- <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> -->
<script src="/blog/js/jquery.min.js"></script>

<!--改成了prismjs高亮-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- 引入不蒜子-->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<!-- 引入clipboard -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="雲流のLowest World" type="application/atom+xml">
</head>

<body>
    <!--flag{never_g0nna g1ve_you up}-->

    <!-- 页面点击特效 -->
    <script type="text/javascript" src="/blog/js/love-click.js"></script>

    <!-- 浏览器标题 -->
    <script async type="text/javascript" src="/blog/js/FunnyTitle.js"></script>

    <!-- 动态背景 -->
    

    <!--文章目录-->
    
    <div id="toc" class="toc-article">
    <h3><i class="fas fa-stream"></i>  目录</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%94%BB%E9%98%B2%E9%83%A8%E5%88%86%EF%BC%88%E6%B8%97%E9%80%8F-amp-%E5%BA%94%E6%80%A5%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">攻防部分（渗透&amp;应急）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%AE%89%E8%AF%84%E4%BC%B0"><span class="toc-number">2.1.</span> <span class="toc-text">数安评估</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#flag1"><span class="toc-number">2.1.1.</span> <span class="toc-text">flag1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flag2"><span class="toc-number">2.1.2.</span> <span class="toc-text">flag2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%EF%BC%88CTF%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">数据安全（CTF）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#easycms%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">easycms（复现）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Holdon"><span class="toc-number">3.2.</span> <span class="toc-text">Holdon</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B2%BB%E7%90%86%EF%BC%88Oracle%E8%BF%90%E7%BB%B4%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">数据治理（Oracle运维）</span></a></li></ol>
    </div>
  

    <!--返回顶部-->
    <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
        <a title="返回顶部">↑</a>
    </div>
    <script src="/blog/js/totop.js"></script>

    <div id="layout">
        
            <div id="content-background" ref="contentBackground" data-images="https://pic.imgdb.cn/item/65d61d809f345e8d03b8bc7a.png"></div>
            
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>第一次加载文章图片可能会花费较长时间</p>
                    <p>要不挂个梯子试试？（x</p>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/blog/images/loading.gif" />
                </div>
            </div>
        </transition>
        <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
        <a href="/blog/search">
            <i class="fa-solid fa-search fa-fw"></i>
            <span>&ensp;Search</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
            <a href="/blog/search">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-search fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Search</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>2024数信杯决赛</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/11/7
        </span>
        
        <span class="category">
            <a href="/blog/categories/%E7%BA%BF%E4%B8%8B%E8%B5%9B/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                线下赛
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/CVE/" style="color: #ffa2c4">CVE</a>
            </span>
            
        </span>
        
        <!--文章字数统计-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <!-- 安装插件npm install hexo-wordcount --save -->
        <span class="post-count">2.3k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">11分</span>
      </span>
    </span>
    
    <!--不蒜子统计访问数-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    总文章阅读量：<span id="busuanzi_value_page_pv"></span>次
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>想去打 hackergame 了（</p>
<span id="more"></span>

<hr>
<h1 id="攻防部分（渗透-amp-应急）"><a href="#攻防部分（渗透-amp-应急）" class="headerlink" title="攻防部分（渗透&amp;应急）"></a>攻防部分（渗透&amp;应急）</h1><h2 id="数安评估"><a href="#数安评估" class="headerlink" title="数安评估"></a>数安评估</h2><h3 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h3><blockquote>
<p>请选手通过数据安全评估手段分析人事招聘系统，接管因未授权所造成的功能或接口隐患，并将其企业会员拉美科技有限公司手机号作为答案提交。<br>【答案标准】例：若获取的手机号为13812345678，则最终答案为：13812345678。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://192.168.94.110/">http://192.168.94.110/</a> 骑士cms</p>
<p>访问 ?s&#x3D;a ，发现开了debug模式</p>
<p>dirsearch 扫出 phpMyAdmin，未授权直接进去了</p>
<p>在 qs_admin 拿到 admin 账密：<code>admin:114145e496608de636a182ca7710a015:nZ7MsM</code></p>
<p>在 qs_admin_identity_token 拿到 token：1391e419f5b3873b93ba8f2e9cf9d12e</p>
<p>在 qs_admin_log 拿到 flag1</p>
<p><img src="/blog/2024/11/07/2024%E6%95%B0%E4%BF%A1%E6%9D%AF%E5%86%B3%E8%B5%9B/image-20241107093851891.png" alt="image-20241107093851891"></p>
<p>在 qs_config 中得到部分配置</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">/</span>qishicms<span class="token operator">/</span>qs_config<span class="token operator">/</span>		http:<span class="token comment">//192.168.94.110/phpMyAdmin/index.php?route=/sql&amp;pos=0&amp;db=qishicms&amp;table=qs_config</span>

   正在显示第 <span class="token number">0</span> <span class="token operator">-</span> <span class="token number">24</span> 行 <span class="token punctuation">(</span>共 <span class="token number">199</span> 行<span class="token punctuation">,</span> 查询花费 <span class="token number">0.0003</span> 秒。<span class="token punctuation">)</span>


<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>qs_config<span class="token punctuation">`</span></span>


id	name	is_frontend	<span class="token keyword">value</span>	note	is_secret	
<span class="token number">1</span>	sitename	<span class="token number">1</span>	骑士人才系统	网站名称	<span class="token number">0</span>	
<span class="token number">2</span>	sitedomain	<span class="token number">1</span>	http:<span class="token comment">//192.168.94.110/	域名	0	</span>
<span class="token number">3</span>	sitedir	<span class="token number">1</span>	<span class="token operator">/</span>	目录	<span class="token number">0</span>	
<span class="token number">4</span>	contact_tel	<span class="token number">1</span>	<span class="token number">000</span><span class="token operator">-</span><span class="token number">0000000</span>	网站联系电话	<span class="token number">0</span>	
<span class="token number">5</span>	fileupload_type	<span class="token number">0</span>		文件上传方式	<span class="token number">0</span>	
<span class="token number">6</span>	fileupload_size	<span class="token number">1</span>	<span class="token number">5120</span>	文件上传最大限制<span class="token punctuation">(</span>kb<span class="token punctuation">)</span>	<span class="token number">0</span>	
<span class="token number">7</span>	fileupload_ext	<span class="token number">1</span>	bmp<span class="token punctuation">,</span>png<span class="token punctuation">,</span>gif<span class="token punctuation">,</span>jpeg<span class="token punctuation">,</span>jpg<span class="token punctuation">,</span>pdf<span class="token punctuation">,</span>doc<span class="token punctuation">,</span>docx<span class="token punctuation">,</span>xls<span class="token punctuation">,</span>xlsx<span class="token punctuation">,</span>zip<span class="token punctuation">,</span><span class="token number">7</span>z<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	文件上传后缀	<span class="token number">0</span>	
<span class="token number">8</span>	contact_email	<span class="token number">0</span>	xxx<span class="token variable">@xxx.xxx</span>	网站联系邮箱	<span class="token number">0</span>	
<span class="token number">9</span>	contact_address	<span class="token number">1</span>	<span class="token number">00</span>省<span class="token number">00</span>市<span class="token number">00</span>路<span class="token number">00</span>号<span class="token number">0</span>大厦<span class="token number">00</span>楼	联系地址	<span class="token number">0</span>	
<span class="token number">10</span>	bottom_other	<span class="token number">1</span>	Copyright © <span class="token number">2021</span> <span class="token number">74</span>cms<span class="token punctuation">.</span>com <span class="token keyword">All</span> <span class="token keyword">Right</span> Reserved Powe<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	其他说明	<span class="token number">0</span>	
<span class="token number">11</span>	icp	<span class="token number">1</span>	icp000000000	备案号	<span class="token number">0</span>	
<span class="token number">12</span>	isclose	<span class="token number">1</span>	<span class="token number">0</span>	暂时关闭网站	<span class="token number">0</span>	
<span class="token number">13</span>	close_reason	<span class="token number">1</span>		关闭网站原因	<span class="token number">0</span>	
<span class="token number">14</span>	<span class="token keyword">statistics</span>	<span class="token number">1</span>		第三方统计代码	<span class="token number">0</span>	
<span class="token number">15</span>	logo	<span class="token number">1</span>		网站logo	<span class="token number">0</span>	
<span class="token number">16</span>	closereg	<span class="token number">1</span>	<span class="token number">0</span>	关闭会员注册	<span class="token number">0</span>	
<span class="token number">17</span>	reg_prefix	<span class="token number">0</span>	user_	注册生成用户名前缀	<span class="token number">0</span>	
<span class="token number">18</span>	agreement	<span class="token number">0</span>	请完善注册协议	注册协议	<span class="token number">0</span>	
<span class="token number">19</span>	privacy	<span class="token number">0</span>	请完善隐私政策	隐私政策	<span class="token number">0</span>	
<span class="token number">20</span>	map_lng	<span class="token number">1</span>	<span class="token number">112.565573</span>	地图经度	<span class="token number">0</span>	
<span class="token number">21</span>	map_lat	<span class="token number">1</span>	<span class="token number">37.869472</span>	地图纬度	<span class="token number">0</span>	
<span class="token number">22</span>	map_zoom	<span class="token number">1</span>	<span class="token number">13</span>	地图缩放级别	<span class="token number">0</span>	
<span class="token number">23</span>	map_ak	<span class="token number">1</span>		百度地图ak	<span class="token number">0</span>	
<span class="token number">24</span>	map_server_ak	<span class="token number">0</span>		百度地图服务端ak	<span class="token number">0</span>	
<span class="token number">25</span>	points_byname	<span class="token number">1</span>	积分	积分代替名	<span class="token number">0</span>	<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h3><blockquote>
<p>请选手通过数据安全评估手段分析人事招聘系统，获取该系统的shell权限，并将系统用户uid为1000的用户名作为答案提交。<br>【答案标准】例：若系统uid为1000的用户名为admin，则最终答案为admin。</p>
</blockquote>
<p>查询一下</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">/</span>		http:<span class="token comment">//192.168.94.110/phpMyAdmin/index.php?route=/server/sql</span>
您的 <span class="token keyword">SQL</span> 语句已成功运行。

<span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">'%secure%'</span><span class="token punctuation">;</span>



require_secure_transport	<span class="token keyword">OFF</span>	
secure_auth	<span class="token keyword">ON</span>	
secure_file_priv	<span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">-</span>files<span class="token operator">/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">/</span>		http:<span class="token comment">//192.168.94.110/phpMyAdmin/index.php?route=/server/sql</span>
您的 <span class="token keyword">SQL</span> 语句已成功运行。

<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">"%plugin%"</span><span class="token punctuation">;</span>



default_authentication_plugin	mysql_native_password	
plugin_dir	<span class="token operator">/</span>usr<span class="token operator">/</span>lib64<span class="token operator">/</span>mysql<span class="token operator">/</span>plugin<span class="token operator">/</span>	
replication_optimize_for_static_plugin_config	<span class="token keyword">OFF</span>	<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>测试发现 admin 登录接口传入的password会直接md5加密一次</p>
<p><img src="/blog/2024/11/07/2024%E6%95%B0%E4%BF%A1%E6%9D%AF%E5%86%B3%E8%B5%9B/image-20241107093254631.png" alt="image-20241107093254631"></p>
<p>但是直接传入无法登录，应该不是一次md5加密，测试发现也不是两次md5</p>
<p>采用移动端登录，抓包发现请求头这里多了个 admintoken，</p>
<p>qs_member 表中得到 <code>13758293461:87c37a4a0c9a7485e90dee10f2aacd93:sfuqvq</code></p>
<p>把加密后的 password 和 pwd_hash 都替换到 qs_admin，然后就能以 123456 为密码进后台了</p>
<p><img src="/blog/2024/11/07/2024%E6%95%B0%E4%BF%A1%E6%9D%AF%E5%86%B3%E8%B5%9B/image-20241107110135356.png" alt="image-20241107110135356"></p>
<p>后台进去之后更新缓存，然后就能上传php文件了</p>
<p>但是测试发现上传的文件好像存在二次渲染和内容检测</p>
<p>最后是在前台的头像上传处传 gif 马才成功拿shell的</p>
<p>执行<code>cat /etc/passwd</code>拿到flag2</p>
<hr>
<h1 id="数据安全（CTF）"><a href="#数据安全（CTF）" class="headerlink" title="数据安全（CTF）"></a>数据安全（CTF）</h1><h2 id="easycms（复现）"><a href="#easycms（复现）" class="headerlink" title="easycms（复现）"></a>easycms（复现）</h2><blockquote>
<p>CVE-2024-31022</p>
</blockquote>
<p>账密爆破得到admin:admin</p>
<p>审计源码，注意到这里有文件读取可以目录穿越：</p>
<p>cms-admin&#x2F;ajax&#x2F;templatecf.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'template'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name static-context">CustomFields</span><span class="token operator">::</span><span class="token function">templateFields</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'template'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">templateFields</span><span class="token punctuation">(</span><span class="token variable">$template</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token variable">$theme</span> <span class="token operator">=</span> <span class="token class-name static-context">CandyDB</span><span class="token operator">::</span><span class="token function">col</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'SELECT option_value FROM '</span><span class="token operator">.</span><span class="token constant">DB_PREFIX</span><span class="token operator">.</span><span class="token string single-quoted-string">'options WHERE option_key = :key'</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'theme'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token constant">THEME_PATH</span><span class="token operator">.</span><span class="token variable">$theme</span><span class="token operator">.</span><span class="token string single-quoted-string">'/templates/'</span><span class="token operator">.</span><span class="token variable">$template</span><span class="token operator">.</span><span class="token string single-quoted-string">'.php'</span><span class="token punctuation">;</span>
    
    <span class="token variable">$contents</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>后缀写死php</p>
<p>注意到这里有个uploader.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span>

<span class="token comment">// todo: Make this a little more secure! </span>

<span class="token keyword">require_once</span> <span class="token string single-quoted-string">'../core/config.php'</span><span class="token punctuation">;</span>

<span class="token comment">// files storage folder</span>
<span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'../uploads/'</span><span class="token punctuation">;</span>

<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/png'</span> 
<span class="token operator">||</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/jpg'</span> 
<span class="token operator">||</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/gif'</span> 
<span class="token operator">||</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/jpeg'</span>
<span class="token operator">||</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/pjpeg'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>	
    <span class="token comment">// setting file's mysterious name</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'YmdHis'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'.jpg'</span><span class="token punctuation">;</span>
 
    <span class="token comment">// copying</span>
    <span class="token function">copy</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$dir</span><span class="token operator">.</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// displaying file</span>
    <span class="token variable">$array</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'filelink'</span> <span class="token operator">=></span> <span class="token constant">URL_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'uploads/'</span><span class="token operator">.</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
    <span class="token keyword">echo</span> <span class="token function">stripslashes</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token punctuation">&#125;</span>
<span class="token comment">//</span>
<span class="token comment">//&#123;</span>
<span class="token comment">//    "error": "Hi! It's error message"</span>
<span class="token comment">//&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>能文件上传，但是后缀写死了为jpg</p>
<p><img src="/blog/2024/11/07/2024%E6%95%B0%E4%BF%A1%E6%9D%AF%E5%86%B3%E8%B5%9B/image-20241107150718582.png" alt="image-20241107150718582"></p>
<p>Plugins 里面能开启那个一片空白的插件，对应源码里的blog，但是没啥用</p>
<p>写的 text 可以 xss ，但是没啥用</p>
<p>install.php 只要指定 install 参数就可以无限重装，观察写入的 sql 语句，尝试在 email 处闭合括号进行注入，失败</p>
<br>

<p><a target="_blank" rel="noopener" href="http://www.nsfocus.net/vulndb/97525">http://www.nsfocus.net/vulndb/97525</a></p>
<p><a target="_blank" rel="noopener" href="https://web.archive.org/web/20240424094723/https://www.xuxblog.top/2024/03/25/CandyCMS-Pre-Auth-RCE/">https://web.archive.org/web/20240424094723/https://www.xuxblog.top/2024/03/25/CandyCMS-Pre-Auth-RCE/</a></p>
<p>原来直接闭合往 config.php 写shell就行了！</p>
<p>漏洞点就在 install.php 这里</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token php language-php"><span class="token delimiter important">&lt;?</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'install'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token delimiter important">?></span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Installer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>

        <span class="token php language-php"><span class="token delimiter important">&lt;?</span>

        <span class="token variable">$currentmodal</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%o'</span><span class="token punctuation">,</span> <span class="token function">fileperms</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'./core'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$currentmodal</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"0755"</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$currentmodal</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"0777"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token variable">$result</span> <span class="token operator">=</span> @<span class="token function">chmod</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token operator">.</span><span class="token string double-quoted-string">"core"</span><span class="token punctuation">,</span> <span class="token number">0755</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token function">diehard</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Sorry, we couldn't modify the directory permissions of /core."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'PHP_SELF'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'install.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$dbhost</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dbhost'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$dbusername</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dbusername'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$dbpassword</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dbpassword'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$dbname</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dbname'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$dbprefix</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dbprefix'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token variable">$config</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;?\n\n"</span><span class="token punctuation">;</span>
<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"/**\n"</span><span class="token punctuation">;</span>
<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"* @package CMS\n"</span><span class="token punctuation">;</span>
<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"* @version 0.1\n"</span><span class="token punctuation">;</span>
<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"* @copyright Copyright 2012 (C) Cocoon Design Ltd. - All Rights Reserved\n"</span><span class="token punctuation">;</span>
<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"*\n"</span><span class="token punctuation">;</span>
<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"* Config for CMS - Will be generated by installer\n"</span><span class="token punctuation">;</span>
<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"*/\n\n"</span><span class="token punctuation">;</span>

<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"# This is set to MySQL by default but can be changed to your DB of choice\n"</span><span class="token punctuation">;</span>
<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"define('DB_DRIVER', 'mysql');\n\n"</span><span class="token punctuation">;</span>

<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"define('DB_HOST', '<span class="token interpolation"><span class="token variable">$dbhost</span></span>');\n"</span><span class="token punctuation">;</span>
<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"define('DB_USERNAME', '<span class="token interpolation"><span class="token variable">$dbusername</span></span>');\n"</span><span class="token punctuation">;</span>
<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"define('DB_PASSWORD', '<span class="token interpolation"><span class="token variable">$dbpassword</span></span>');\n"</span><span class="token punctuation">;</span>
<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"define('DB_NAME', '<span class="token interpolation"><span class="token variable">$dbname</span></span>');\n"</span><span class="token punctuation">;</span>
<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"define('DB_PREFIX', '<span class="token interpolation"><span class="token variable">$dbprefix</span></span>');\n\n"</span><span class="token punctuation">;</span>

<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"define('SALT', '873hjcbdi1kammcvjnj0u3jn');\n\n"</span><span class="token punctuation">;</span>

<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"# Define where CMS is installed WITH trailing slash\n"</span><span class="token punctuation">;</span>
<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"define('CMS_PATH', \$_SERVER['DOCUMENT_ROOT'].'<span class="token interpolation"><span class="token variable">$dir</span></span>');\n\n"</span><span class="token punctuation">;</span>

<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"define('URL_PATH', '<span class="token interpolation"><span class="token variable">$dir</span></span>');\n"</span><span class="token punctuation">;</span>

<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"define('THEME_PATH', CMS_PATH.'themes/');\n"</span><span class="token punctuation">;</span>

<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"define('THEME_URL', URL_PATH.'themes/');\n"</span><span class="token punctuation">;</span>

<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"define('PLUGIN_PATH', CMS_PATH.'plugins/');\n"</span><span class="token punctuation">;</span>

<span class="token variable">$config</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">"define('PLUGIN_URL', URL_PATH.'plugins/');"</span><span class="token punctuation">;</span>


<span class="token variable">$fp</span> <span class="token operator">=</span> @<span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'core/config.php'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$fp</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">diehard</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Sorry, we couldn't write to core/config.php."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>

    <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里会写文件到 core&#x2F;config.php，文件的内容是 $config 参数拼接的，这个参数是我们可控的，那么直接闭合注入我们的php代码即可</p>
<p>选择在 $dbprefix 这里进行代码注入</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">cms_'<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2024/11/07/2024%E6%95%B0%E4%BF%A1%E6%9D%AF%E5%86%B3%E8%B5%9B/image-20241108231218248.png" alt="image-20241108231218248"></p>
<p>此时的 core&#x2F;config.php</p>
<p><img src="/blog/2024/11/07/2024%E6%95%B0%E4%BF%A1%E6%9D%AF%E5%86%B3%E8%B5%9B/image-20241108231421423.png" alt="image-20241108231421423"></p>
<p>就写入我们的php代码了</p>
<p>因为后面有文件包含所以安装完就会直接执行我们的代码</p>
<p><img src="/blog/2024/11/07/2024%E6%95%B0%E4%BF%A1%E6%9D%AF%E5%86%B3%E8%B5%9B/image-20241108231503478.png" alt="image-20241108231503478"></p>
<hr>
<h2 id="Holdon"><a href="#Holdon" class="headerlink" title="Holdon"></a>Holdon</h2><p><a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a> 源码泄露</p>
<p>可以知道flag就在web根目录下，文件名为 flllllllllllllllllllllllllllllll4lllllllllll4g.php</p>
<p>那么需要找一个能够文件读取的地方</p>
<p>观察controller</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> 

<span class="token keyword">class</span> <span class="token class-name-definition class-name">BaseController</span>
<span class="token punctuation">&#123;</span>

	<span class="token keyword">private</span> <span class="token variable">$viewPath</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">loadView</span><span class="token punctuation">(</span><span class="token variable">$viewName</span> <span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$viewData</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token variable">$this</span><span class="token operator">-></span><span class="token property">viewPath</span> <span class="token operator">=</span> <span class="token constant">BASE_PATH</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"/View/<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$viewName</span><span class="token punctuation">&#125;</span></span>.php"</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">viewPath</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			<span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$viewData</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">include</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">viewPath</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
	
<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> 


<span class="token keyword">class</span> <span class="token class-name-definition class-name">UserController</span> <span class="token keyword">extends</span> <span class="token class-name">BaseController</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">actionList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token variable">$params</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">;</span>
		<span class="token variable">$userModel</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token variable">$listData</span> <span class="token operator">=</span> <span class="token variable">$userModel</span><span class="token operator">-></span><span class="token function">getPageList</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token variable">$this</span><span class="token operator">-></span><span class="token function">loadView</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'userList'</span><span class="token punctuation">,</span> <span class="token variable">$listData</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">actionIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$listData</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">loadView</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'userIndex'</span><span class="token punctuation">,</span><span class="token variable">$listData</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里用 <code>extract</code> 接收参数给变量赋值，存在变量覆盖</p>
<p>而 &#x2F;View&#x2F;userIndex.php 这里</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$img_file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$img_file</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/../favicon.ico'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token variable">$img_dir</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token variable">$img_file</span><span class="token punctuation">;</span>
<span class="token variable">$img_base64</span> <span class="token operator">=</span> <span class="token function">imgToBase64</span><span class="token punctuation">(</span><span class="token variable">$img_dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="'</span> <span class="token operator">.</span> <span class="token variable">$img_base64</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'">'</span><span class="token punctuation">;</span>       <span class="token comment">//图片形式展示</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>那么我们只需要覆盖 img_file 路径就能任意读文件了</p>
<p><img src="/blog/2024/11/07/2024%E6%95%B0%E4%BF%A1%E6%9D%AF%E5%86%B3%E8%B5%9B/image-20241107140953602.png" alt="image-20241107140953602"></p>
<hr>
<h1 id="数据治理（Oracle运维）"><a href="#数据治理（Oracle运维）" class="headerlink" title="数据治理（Oracle运维）"></a>数据治理（Oracle运维）</h1><p>dump下来sql文件到本地测试，删去开头的数据库信息和<code>TABLESPACE &quot;T_TABLESPACE&quot;</code>，注释掉所有<code>DROP</code>即可导入</p>
<p>猜测评测的匹配语句，编写我们的正则表达式，注意 oracle 好像用不了unicode</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">"个人基本概况信息"</span>
<span class="token keyword">WHERE</span> 
 REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"IDNumber"</span><span class="token punctuation">,</span> <span class="token string">'((?&lt;=[^\d])|^)((1[1-5])|(2[1-3])|(3[1-7])|(4[1-6])|(5[0-4])|(6[1-5])|(71)|(8[1-2]))\d&#123;4&#125;(19|20)\d&#123;2&#125;((0[1-9])|10|11|12)(([0-2][1-9])|10|20|30|31)\d&#123;3&#125;[0-9Xx]((?=[^\d])|$)'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"IDDate"</span><span class="token punctuation">,</span><span class="token string">'((?:19|20)\d\d)-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"Gender"</span><span class="token punctuation">,</span><span class="token string">'男|女'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"Name"</span><span class="token punctuation">,</span><span class="token string">'^[一-龥]&#123;2,5&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"Marital"</span><span class="token punctuation">,</span><span class="token string">'单身|已婚|离异'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">"个人联系信息"</span>
<span class="token keyword">WHERE</span> 
 REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"MOBILE"</span><span class="token punctuation">,</span><span class="token string">'^1[3-9]\d&#123;9&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"TELEPHONE"</span><span class="token punctuation">,</span><span class="token string">'^\d&#123;3,4&#125;-\d&#123;7,8&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"EMAIL"</span><span class="token punctuation">,</span><span class="token string">'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]&#123;2,&#125;$'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">"个人地理位置信息"</span>
<span class="token keyword">WHERE</span> 
 REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"Country"</span><span class="token punctuation">,</span><span class="token string">'^[一-龥]&#123;2&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"City"</span><span class="token punctuation">,</span><span class="token string">'^[一-龥]&#123;2,4&#125;$'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">"个人职业信息"</span>
<span class="token keyword">WHERE</span> 
 REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"Employer"</span><span class="token punctuation">,</span> <span class="token string">'^\w&#123;0,5&#125;[一-龥]&#123;0,4&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"DATE"</span><span class="token punctuation">,</span><span class="token string">'((?:19|20)\d\d)[- /.](0[1-9]|1[012])[- /.](0[1-9]|[12][0-9]|3[01])'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"PTitle"</span><span class="token punctuation">,</span><span class="token string">'^\w&#123;0,2&#125;[一-龥]&#123;0,6&#125;$'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">"传统鉴别信息"</span>
<span class="token keyword">WHERE</span> 
 REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"CVN"</span><span class="token punctuation">,</span> <span class="token string">'^\d&#123;1,3&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"EXP"</span><span class="token punctuation">,</span><span class="token string">'((?:19|20)\d\d)(0[1-9]|1[012])(0[1-9]|[12][0-9]|3[01])'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"Code"</span><span class="token punctuation">,</span><span class="token string">'^\d&#123;4,6&#125;$'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">"金额信息"</span>
<span class="token keyword">WHERE</span> 
 REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"CTACCOUNT"</span><span class="token punctuation">,</span> <span class="token string">'^\d&#123;7,9&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"CTBALANCE"</span><span class="token punctuation">,</span><span class="token string">'^\d&#123;4,6&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"CTCURRENCY"</span><span class="token punctuation">,</span><span class="token string">'^[一-龥]&#123;2,4&#125;$'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">"合同基本信息"</span>
<span class="token keyword">WHERE</span> 
 REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"CONTRACTNO"</span><span class="token punctuation">,</span> <span class="token string">'^SA-\d&#123;5&#125;-\d&#123;4&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"CTDATE"</span><span class="token punctuation">,</span><span class="token string">'^\d&#123;4&#125;-\d&#123;1,2&#125;-\d&#123;1,2&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"CONTRACTAMOUNT"</span><span class="token punctuation">,</span><span class="token string">'^\d&#123;7,9&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"CURRENCY"</span><span class="token punctuation">,</span><span class="token string">'^[一-龥]&#123;2,4&#125;$'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">"保单基本信息"</span>
<span class="token keyword">WHERE</span> 
 REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"PolicyNo"</span><span class="token punctuation">,</span> <span class="token string">'^AA-\d&#123;4&#125;-\d&#123;10&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"Insurer"</span><span class="token punctuation">,</span><span class="token string">'^[一-龥]&#123;2,4&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"Beneficiary"</span><span class="token punctuation">,</span><span class="token string">'^[一-龥]&#123;2,4&#125;$'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">"特殊风险标的信息"</span>
<span class="token keyword">WHERE</span> 
 REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"Equipment"</span><span class="token punctuation">,</span> <span class="token string">'^LMN'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"Driver"</span><span class="token punctuation">,</span><span class="token string">'^\d&#123;17,19&#125;$'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">"交易基本信息"</span>
<span class="token keyword">WHERE</span> 
 REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"TDate"</span><span class="token punctuation">,</span> <span class="token string">'((?:19|20)\d\d)(0[1-9]|1[012])(0[1-9]|[12][0-9]|3[01])'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"EFFDATE"</span><span class="token punctuation">,</span><span class="token string">'((?:19|20)\d\d)(0[1-9]|1[012])(0[1-9]|[12][0-9]|3[01])'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- AND REGEXP_LIKE("Place",'') 这个不知道为什么全是乱码</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">"交易对手信息"</span>
<span class="token keyword">WHERE</span> 
 REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"CUSTOMERNAME"</span><span class="token punctuation">,</span> <span class="token string">'^[一-龥]&#123;2,4&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"CUSTOMERBANK"</span><span class="token punctuation">,</span><span class="token string">'^[一-龥]&#123;4,8&#125;$'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> REGEXP_LIKE<span class="token punctuation">(</span><span class="token string">"ACCOUNT"</span><span class="token punctuation">,</span><span class="token string">'^\d&#123;16,20&#125;$'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>但是最后也才砍了160分。。</p>

    </div>
    
    
    
    
    
    
    
</div>

            </div>
        </transition>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/blog/js/main.js"></script>
    
    




    
    

<div id="vcomments"></div>

<script src="/blog/js/lib/valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        app_id: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
        app_key: 'SzWOnY0PWLGNuL6jW8TZYc7j',
        visitor: 'true',
        placeholder: '写点什么吧(●ˇ∀ˇ●)',
        serverURLs: 'https://u9mzlkun.lc-cn-n1-shared.com',
    });
</script>

    <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>