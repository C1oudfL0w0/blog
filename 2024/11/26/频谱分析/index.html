
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>频谱分析 | 雲流のLowest World</title>
    <meta name="author" content="C1oudfL0w0" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
    <!-- cdn挂掉的时候要可以引用本地 -->
<!-- <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script> -->
<script src="/blog/js/vue.global.prod.min.js"></script>


<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />


<link rel="stylesheet" href="/blog/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<link rel="stylesheet" href="/blog/css/search.css" />
<script> const mixins = {}; </script>

<!-- 引入jQuery-->
<!-- <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> -->
<script src="/blog/js/jquery.min.js"></script>

<!--改成了prismjs高亮-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- 引入不蒜子-->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<!-- 引入clipboard -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="雲流のLowest World" type="application/atom+xml">
</head>

<body>
    <!--flag{never_g0nna g1ve_you up}-->

    <!-- 页面点击特效 -->
    <script type="text/javascript" src="/blog/js/love-click.js"></script>

    <!-- 浏览器标题 -->
    <script async type="text/javascript" src="/blog/js/FunnyTitle.js"></script>

    <!-- 动态背景 -->
    

    <!--文章目录-->
    
    <div id="toc" class="toc-article">
    <h3><i class="fas fa-stream"></i>  目录</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A9%E7%94%A8gqrx%E5%92%8Crtl-433%E5%88%86%E6%9E%90433MHz%E9%81%A5%E6%8E%A7%E9%97%A8%E9%93%83%E4%BF%A1%E5%8F%B7"><span class="toc-number">2.</span> <span class="toc-text">利用gqrx和rtl_433分析433MHz遥控门铃信号</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7"><span class="toc-number">2.1.</span> <span class="toc-text">工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84"><span class="toc-number">2.2.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.3.</span> <span class="toc-text">步骤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A9%E7%94%A8Universal-Radio-Hacker%E5%88%86%E6%9E%902-4G%E9%81%A5%E6%8E%A7%E8%BD%A6%E4%BF%A1%E5%8F%B7"><span class="toc-number">3.</span> <span class="toc-text">利用Universal Radio Hacker分析2.4G遥控车信号</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7-1"><span class="toc-number">3.1.</span> <span class="toc-text">工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-1"><span class="toc-number">3.2.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-1"><span class="toc-number">3.3.</span> <span class="toc-text">步骤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A9%E7%94%A8GNU-Radio-Compaion%E5%92%8Cqsstv%E8%A7%A3%E8%B0%83%E5%8D%AB%E6%98%9F%E4%BC%A0%E8%BE%93%E7%9A%84%E5%9B%BE%E5%83%8F"><span class="toc-number">4.</span> <span class="toc-text">利用GNU Radio Compaion和qsstv解调卫星传输的图像</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7-2"><span class="toc-number">4.1.</span> <span class="toc-text">工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-2"><span class="toc-number">4.2.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-2"><span class="toc-number">4.3.</span> <span class="toc-text">步骤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E4%BD%8E%E5%8A%9F%E8%80%97%E8%93%9D%E7%89%99%E8%AE%BE%E5%A4%87%E7%9A%84BLE%E6%95%B0%E6%8D%AE%E5%8C%85%E8%8E%B7%E5%8F%96%E6%99%BA%E8%83%BD%E8%AE%BE%E5%A4%87BLE%E9%80%9A%E4%BF%A1%E5%AF%86%E9%92%A5"><span class="toc-number">5.</span> <span class="toc-text">分析低功耗蓝牙设备的BLE数据包获取智能设备BLE通信密钥</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6"><span class="toc-number">5.1.</span> <span class="toc-text">前置条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-3"><span class="toc-number">5.2.</span> <span class="toc-text">步骤</span></a></li></ol></li></ol>
    </div>
  

    <!--返回顶部-->
    <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
        <a title="返回顶部">↑</a>
    </div>
    <script src="/blog/js/totop.js"></script>

    <div id="layout">
        
            <div id="content-background" ref="contentBackground" data-images="https://pic.imgdb.cn/item/65d61d809f345e8d03b8bc7a.png"></div>
            
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>第一次加载文章图片可能会花费较长时间</p>
                    <p>要不挂个梯子试试？（x</p>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/blog/images/loading.gif" />
                </div>
            </div>
        </transition>
        <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
        <a href="/blog/search">
            <i class="fa-solid fa-search fa-fw"></i>
            <span>&ensp;Search</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
            <a href="/blog/search">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-search fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Search</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>频谱分析</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/11/26
        </span>
        
        <span class="category">
            <a href="/blog/categories/%E6%9D%82%E9%A1%B9/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                杂项
            </a>
        </span>
        
        
        <!--文章字数统计-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <!-- 安装插件npm install hexo-wordcount --save -->
        <span class="post-count">3.4k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">12分</span>
      </span>
    </span>
    
    <!--不蒜子统计访问数-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    总文章阅读量：<span id="busuanzi_value_page_pv"></span>次
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>貌似都是无线电方面的</p>
<span id="more"></span>

<hr>
<h1 id="利用gqrx和rtl-433分析433MHz遥控门铃信号"><a href="#利用gqrx和rtl-433分析433MHz遥控门铃信号" class="headerlink" title="利用gqrx和rtl_433分析433MHz遥控门铃信号"></a>利用gqrx和rtl_433分析433MHz遥控门铃信号</h1><p>无线遥控门铃通常工作在 ISM 频段，比如 315Mhz, 433Mhz 和868&#x2F;915Mhz</p>
<p>在信号调制方面则以 OOK&#x2F;ASK&#x2F;FSK 为主，这几种调制方案应用非常广泛，如无线基站，遥控钥匙和胎压系统 TPMS 都有它们的身影</p>
<p>在无线钥匙领域 OOK 的简单性是其它调制方案所不及的，仅需要将载波信号发送到功放和天线，即可表现 “1” 或不发射任何信号即代表 “0”</p>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p>Gqrx：开源的图形化软件定义无线电（SDR）接收器，支持频谱显示、信号调谐、解调和录制等功能</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> gqrx-sdr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>rtl_433：专门用于解码来自 433 MHz 无线频段的各种设备信号，如无线温度计、气压计、门窗传感器等，支持多种信号解码方式，包括但不限于协议分析、频谱分析、调制解调等，广泛应用于物联网设备的信号破解和无线电通信的实验研究</p>
<h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>解析信号文件，播放信号并查看信号的频谱图</p>
<p>尝试解读经典 433MHz 的无线门铃中的信号信息</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li><p>在 gqrx 软件中播放并查看信号的频谱图</p>
<p>设置设备类型为other</p>
<p>Device String 参数：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">file</span><span class="token operator">=</span>/home/kali/桌面/rev_lab/cap433_200ksps.cf32,freq<span class="token operator">=</span><span class="token number">433920000000</span>,rate<span class="token operator">=</span><span class="token number">200000</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Input rate 设置为 200000 （对应 200ksps 采样率）</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241127174748076.png" alt="image-20241127174748076"></p>
<p>点击播放按钮，即可查看录制信号文件的频谱以及播放信号</p>
<p> <img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241127174853730.png" alt="image-20241127174853730"></p>
</li>
<li><p>利用 rtl_443 工具解析信号</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rtl_433 <span class="token parameter variable">-r</span> cap433_200ksps.cf32 <span class="token parameter variable">-A</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241127212031531.png" alt="image-20241127212031531"></p>
<p>在浏览器中打开链接，可以具体分析信号：</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241127212201727.png" alt="image-20241127212201727"></p>
</li>
</ol>
<hr>
<h1 id="利用Universal-Radio-Hacker分析2-4G遥控车信号"><a href="#利用Universal-Radio-Hacker分析2-4G遥控车信号" class="headerlink" title="利用Universal Radio Hacker分析2.4G遥控车信号"></a>利用Universal Radio Hacker分析2.4G遥控车信号</h1><p>遥控车小车的遥控器常工作在 2.4 GHz 频段，许多无线设备（如 Wi-Fi、蓝牙、无线鼠标等）也使用 2.4 GHz 频段</p>
<h2 id="工具-1"><a href="#工具-1" class="headerlink" title="工具"></a>工具</h2><p>Universal Radio Hacker（简称 URH）是一个开源的软件工具，专门用于无线电信号的分析、解码和破解。它允许用户通过软件定义无线电（SDR）硬件（如 RTL-SDR、HackRF）捕捉和分析无线电信号，支持从低频到高频范围的信号捕获。URH 提供了图形化界面，能够进行详细的信号分析，帮助用户识别各种无线协议，包括调频（FM）、幅度调制（AM）、调频调制（FSK）、ASK、OOK 等多种调制方式。它还允许用户以可视化的方式查看信号波形、频谱图和水晶图，从而更好地理解信号特性</p>
<p>URH 具有强大的信号分析功能，不仅可以录制和播放信号，还支持信号的解调和分析，自动化的协议解析功能，帮助用户快速破解和理解无线协议。此外，URH 还允许用户在发现信号之后对其进行解码、重放，并根据需要修改协议参数进行实验</p>
<h2 id="目的-1"><a href="#目的-1" class="headerlink" title="目的"></a>目的</h2><ul>
<li>解读并分析 2.4GHz 遥控车的信号</li>
<li>尝试分析信号协议的格式</li>
</ul>
<h2 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li><p>打开并分析信号</p>
<p>点击Autodetect parameters按钮，可以直接自动分析信号的基本参数以及调制信息</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202144206946.png" alt="image-20241202144206946"></p>
<p>信号中的这些部分是环境中的噪声干扰，可以用鼠标滑动选中后直接按键盘上的 Delete 按钮删除</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202144415182.png" alt="image-20241202144415182"></p>
<p>微调Noise部分，使得粉红色区域能覆盖掉所有的底噪</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202144745965.png" alt="image-20241202144745965"></p>
<p>Modulation 选择 FSK ，此时再次点击 Autodetect parameters 按钮，即可分析2.4G遥控器的信号内容：</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202144900553.png" alt="image-20241202144900553"></p>
</li>
<li><p>尝试分析协议格式</p>
<p>点击 Analysis 菜单，选择 Analyze Protocol 即会自动执行针对协议的分析</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202145247170.png" alt="image-20241202145247170"></p>
<p>观察分析的结果，可以发现二进制串多为以下格式：</p>
<pre class="line-numbers language-plain" data-language="plain"><code class="language-plain">00110011 00110010
110011 00
01111111
110110 11
010110011 0011001
10101010
011011 00<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>猜测对应的是操控小车的操作</p>
</li>
</ol>
<hr>
<h1 id="利用GNU-Radio-Compaion和qsstv解调卫星传输的图像"><a href="#利用GNU-Radio-Compaion和qsstv解调卫星传输的图像" class="headerlink" title="利用GNU Radio Compaion和qsstv解调卫星传输的图像"></a>利用GNU Radio Compaion和qsstv解调卫星传输的图像</h1><p>SSTV技术本身比较简单，它使用模拟信号将图像“编码”并通过无线电波传输。传输过程中的图像会被分割成多条扫描线，每一条扫描线通过无线电信号发送，并被地面接收站解码为完整的图像。这种方式不需要复杂的数字数据连接，适合在无线电频段上使用，尤其是像太空站这种远离地面的场景</p>
<h2 id="工具-2"><a href="#工具-2" class="headerlink" title="工具"></a>工具</h2><p>GNU Radio Companion (GRC) 是一个开源的软件开发环境，专为信号处理而设计，特别是在无线通信和无线电频谱分析方面。它提供了一个图形化界面，允许用户通过“块”来构建无线电系统，而无需编写复杂的代码。这些“块”是不同的信号处理模块，如滤波器、调制解调器、放大器等，可以被用户拖放到工作区，并通过连接来组成信号处理链。GNU Radio Companion广泛用于软件定义无线电（SDR）应用中，支持实时信号处理，可以用于教育、研究和实际的通信系统设计。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> gnuradio<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>QSSTV 是一款专门用于接收和发送 SSTV（慢扫描电视）信号的软件，通常用于业余无线电通信。它能够通过电脑与无线电设备的连接，解码 ISS 等发射的 SSTV 信号，并将其转化为图像文件。QSSTV支持多种常见的 SSTV 模式，如 Robot 36 和 Martin 1 等，并能将接收到的图像显示出来。它也是无线电爱好者和业余无线电操作员常用的工具之一，能够与标准的SSTV发射器和接收器兼容，适用于爱好者捕捉和分享来自太空的图像</p>
<h2 id="目的-2"><a href="#目的-2" class="headerlink" title="目的"></a>目的</h2><ul>
<li>解调模拟的卫星信号文件</li>
<li>解码SSTV信号，并尝试提取其中的图像</li>
</ul>
<h2 id="步骤-2"><a href="#步骤-2" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li><p>利用GNU Radio对信号源文件进行FM解调</p>
<p>源文件名 <code>fm-complex64-sample_rate-48khz-dec_ratio-3_1</code> 中已经包含了一些和信号有关的信息</p>
<ul>
<li>fm：调制类型</li>
<li>complex64：信号数据类型</li>
<li>sample_rate-48khz：采样率</li>
<li>dec_ratio-3_1：抽取率（原始信号与实际有效信号之比，这里是 3:1）</li>
</ul>
</li>
<li><p>打开GNU Radio，新建一个项目文件，双击 samp_rate 选项卡，将值改为 48000：</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202195538819.png" alt="image-20241202195538819"></p>
<p>点击搜索按钮，输入 File Source，双击搜索到的 File Souce 选项卡</p>
<p>将出现的模块拖到最左边，双击，在 File 一栏中输入信号文件的路径，Repeat 改为 No</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202195724016.png" alt="image-20241202195724016"></p>
<p>继续搜索：Rational Resampler，拖动到File模块的右边</p>
<p>拖动 File 的 Out，与 Rational Resampler 的 In 相连</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202195904525.png" alt="image-20241202195904525"></p>
<p>用同样的方法查找并添加 NBFM Receive 模块，并连接流程图</p>
<p>双击 NBFM Receive 模块，填写参数：</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202200026828.png" alt="image-20241202200026828"></p>
<p>需要注意的是，Audio Rate 是降采样后的频率，Quadrature Rate 才是信号的原始频率，由于抽取率是3:1，因此音频的频率是48&#x2F;3&#x3D;16kHz</p>
<p>用同样的方法添加 Wav File Sink 模块，并连接</p>
<p>双击编辑参数，File 一栏填写需要保存的文件路径，Sample Rate 一栏改为 int(samp_rate&#x2F;3) 或者 16000</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202200339633.png" alt="image-20241202200339633"></p>
<p>保存后，点击右上角的运行按钮，来运行流程图</p>
<p>几秒钟后，在对应的文件夹中就出现了 wav 文件</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202200557649.png" alt="image-20241202200557649"></p>
</li>
<li><p>利用 Audacity 查看并转换解调的信号文件</p>
<p>打开 Audacity，并在 File -&gt; Open 导入刚刚的 wav 文件</p>
<p>点击 File -&gt; Export Audio，Export to Computer</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202202426601.png" alt="image-20241202202426601"></p>
</li>
<li><p>利用 qsstv 将信号中的音频转换成图片</p>
<p>Options -&gt; Configuration</p>
<p>Sound 选项卡中的 Sound Input 改为 From File，点击OK保存</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202202656527.png" alt="image-20241202202656527"></p>
<p>在 Receive 选项卡中，点击播放按钮，选择刚刚 Audacity 导出的 wav 文件</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202202722020.png" alt="image-20241202202722020"></p>
<p>即会自动对刚刚的 wav 文件中的音频进行 SSTV 解码</p>
</li>
<li><p>此图片在 ISCTF2024 中亦有记载</p>
<p>可以看到这里面是被拆了的二维码点阵，缺了一角是定位点</p>
<p>直接去 QRazybox 手动修复：<a target="_blank" rel="noopener" href="https://merri.cx/qrazybox/">https://merri.cx/qrazybox/</a></p>
<p>注意尺寸是29*29</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202210730691.png" alt="image-20241202210730691"></p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202210827890.png" alt="image-20241202210827890"></p>
<p>得到flag：<code>ISCTF&#123;Th3_ROmaNtic_Of_Rad1o&#125;</code></p>
</li>
</ol>
<hr>
<h1 id="分析低功耗蓝牙设备的BLE数据包获取智能设备BLE通信密钥"><a href="#分析低功耗蓝牙设备的BLE数据包获取智能设备BLE通信密钥" class="headerlink" title="分析低功耗蓝牙设备的BLE数据包获取智能设备BLE通信密钥"></a>分析低功耗蓝牙设备的BLE数据包获取智能设备BLE通信密钥</h1><p>IOT 中，低功耗蓝牙协议（BLE）广泛应用于智能设备之间的通信，如智能手表、智能家居设备、无线耳机等</p>
<p>BLE（Bluetooth Low Energy）协议采用主从架构，通常由一个“主设备”和多个“从设备”组成，支持多种操作模式以确保高效和低能耗通信，协议的常见操作：</p>
<ul>
<li>广播（Advertising）：BLE设备通过广播数据包来通知周围的设备其存在，这些广播数据包不需要与其他设备建立连接，因此被称为无连接广播。广播数据包可以包含设备的基本信息、服务UUID（服务标识符）、制造商信息等。广播操作通常用于发现设备、获取设备信息或启动配对过程<ul>
<li>广告包结构：广告包（Advertising Packet）通常包含一个设备地址、广播数据、广告间隔等信息。广告间隔是指BLE设备发送广告数据包的频率</li>
</ul>
</li>
<li>扫描（Scanning）：BLE设备可以通过扫描来接收其他设备的广播数据包。扫描分为主动扫描和被动扫描两种方式。主动扫描时，设备会主动向广播设备发送扫描请求，从而获取更多的信息；而被动扫描时，设备仅接收广播数据包。</li>
<li>连接（Connection）：连接是BLE设备间进行通信的基础。一旦BLE设备通过广播发现了目标设备并完成了配对或配对后建立了连接，设备就可以交换数据。BLE连接通过连接请求（Connection Request）和连接响应（Connection Response）过程来完成。<ul>
<li>连接过程通常包括设备地址交换、协商连接参数（如连接间隔、数据包大小等）等步骤</li>
<li>连接完成后，设备通过数据包交换进行通信</li>
</ul>
</li>
<li>数据传输（Data Exchange）：在BLE连接中，数据传输是通过数据包进行的。数据包包含了通信双方交换的数据内容、特征值（Characteristics）等信息。BLE支持通过GATT（Generic Attribute Profile）协议来进行数据传输，GATT定义了通信中的服务（Services）、特征（Characteristics）和描述符（Descriptors）。<ul>
<li>读取和写入操作：设备可以通过GATT进行属性读取（Read）或写入（Write）操作，这些操作可以应用于设备的各种传感器数据、配置信息等</li>
</ul>
</li>
<li>配对与加密（Pairing and Encryption）：BLE协议支持设备配对和加密操作，以提高通信安全性。配对过程中，设备交换配对信息，如加密密钥或确认码。BLE支持多种安全模式，如 Just Works、Passkey Entry 和 Out of Band，以及加密机制来保护数据安全。<ul>
<li>加密数据：通过交换加密密钥，BLE通信中的数据流可以被加密，以防止恶意监听和数据篡改。</li>
</ul>
</li>
<li>断开连接（Disconnection）：在BLE设备完成数据交换后，可以通过发送断开连接的命令（Disconnection Request）来中止连接。设备之间的连接通常是短暂的，设计上是为了降低能耗</li>
</ul>
<hr>
<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><p>通过逆向该设备的 app 可知，app 与设备的交互使用了 session_key 作为每次连接后的AES会话密钥，这个密钥在每次连接配对时交换产生，在每次断联后被废弃，下次重新生成</p>
<p>session_key 生成规则：</p>
<ol>
<li><p>app与设备建立连接，交换设备型号版本等必要信息。</p>
</li>
<li><p>app订阅智能设备UUID为 <code>bd4ac6100b4511e38ffd0800200c9a66</code> 的Indication。</p>
</li>
<li><p>由 app 先生成 8 byte 的随机数A，由控制字符 <code>01000000 +[8 byte随机数A]+[4 byte其他字符]</code> 组成一个指令，由固定密钥 <code>2eacd8f48c2dfe15325f25ad8fc8eb96</code> 加密后，加上 2 Byte 的CRC内容（有效数据为前 16 byte），Write 给目标设备 UUID 为<code>bd4ac6100b4511e38ffd0800200c9a66</code> 的服务。</p>
</li>
<li><p>智能设备收到上述指令后，生成 8 byte 的随机数B，由控制字符 <code>02000000 +[8 byte随机数B]+[4byte其他字符]</code> 组合指令，由固定密钥 <code>2eacd8f48c2dfe15325f25ad8fc8eb96</code> 加密后，加上 2 Byte 的其他数据（有效数据为前 16 byte），通过 Indicate 订阅返还给app。</p>
</li>
<li><p>app与智能设备完成密钥交换，令 <code>session_key=A+B</code> ，即为本次通信使⽤的 AES 密钥，本次会话后续所有通信均由 session_key 进行加密后再传输。</p>
</li>
</ol>
<h2 id="步骤-3"><a href="#步骤-3" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li><p>用 Wireshark 分析无线电嗅探设备捕获的数据包</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202212132680.png" alt="image-20241202212132680"></p>
<p>有显示通信来源、目的地、BLE数据包类型，例如 ADV_IND 是 BLE 协议中最常见的广播类型，主要用于设备的可发现广播</p>
<p>这种数据包用于通知附近的设备它的存在，常见于设备希望让其他设备发现并连接到它时。例如，当⼀个 BLE 设备启动并希望被其他设备发现时，它会发送 ADV_IND 类型的广播包。</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202213408567.png" alt="image-20241202213408567"></p>
<p>展开 Bluetooth Attribute Protocol 选项树，可以看到详细的应用层信息。例如92号数据包是交换设备名称等变量</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202213621082.png" alt="image-20241202213621082"></p>
<p>最终找到216号数据包，逆向app后已知的交换随机数密钥的 Service UUID：<code>bd4ac6100b4511e38ffd0800200c9a66</code></p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202213743333.png" alt="image-20241202213743333"></p>
</li>
<li><p>解密并还原 session_key</p>
<p>key 用的是前面逆向得到的 2eacd8f48c2dfe15325f25ad8fc8eb96</p>
<p>iv 用0填充</p>
<p>CBC&#x2F;NoPadding 模式</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202214653482.png" alt="image-20241202214653482"></p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202214712162.png" alt="image-20241202214712162"></p>
<p>得到 A 为 c2f4c40274acbc32</p>
<p>在220号数据包拿到另一个UUID</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202214325525.png" alt="image-20241202214325525"></p>
<p>同样解密得到 B 为 616b507c0e066eee</p>
<p>那么得到 session_key &#x3D; A + B &#x3D; c2f4c40274acbc32616b507c0e066eee</p>
<p>继续找到⼀个后续的交互数据包，尝试用这个 session_key 解密</p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202214844605.png" alt="image-20241202214844605"></p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202214831498.png" alt="image-20241202214831498"></p>
<p><img src="/blog/2024/11/26/%E9%A2%91%E8%B0%B1%E5%88%86%E6%9E%90/image-20241202214925813.png" alt="image-20241202214925813"></p>
<p>说明 c2f4c40274acbc32616b507c0e066eee 就是加密后续 BLE 数据包的有效 session_key</p>
</li>
</ol>

    </div>
    
    
    
    
    
    
    
</div>

            </div>
        </transition>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/blog/js/main.js"></script>
    
    




    
    

<div id="vcomments"></div>

<script src="/blog/js/lib/valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        app_id: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
        app_key: 'SzWOnY0PWLGNuL6jW8TZYc7j',
        visitor: 'true',
        placeholder: '写点什么吧(●ˇ∀ˇ●)',
        serverURLs: 'https://u9mzlkun.lc-cn-n1-shared.com',
    });
</script>

    <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>